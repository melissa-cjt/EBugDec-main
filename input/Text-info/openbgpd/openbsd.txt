Changes made between OpenBSD 7.1 and 7.2
OpenSSH version 9.1.
Added Wacom One S (CTL-472) support to uwacom(4).
Changed mfii(4) to allow the firmware more time to transition out of the UNDEFINED state.
rpki-client(8) version 8.1.
OpenBGPD version 7.7.
Updated unbound(8) to 1.16.3.
Updated awk(1) to the September 12, 2022 version.
Updated libexpat to version 2.4.9.
Fixed line length trimming in ps(1) -f mode.
Added iked(8) connection statistics for successful and failed connections, error types, and other events that can be printed with "ikectl show stats".
Added sftp(1) client support for "users-groups-by-id@openssh.com".
Added a "user-groups-by-id@openssh.com" extension request to sftp-server(8) that allows the client to obtain user/group names that correspond to a set of uids/gids.
Added RequiredRSASize for sshd(8). RSA keys that fail to meet this minimum length will be ignored for user and host-based authentication.
Changed ftp(1) to use non-blocking connect(2) with ppoll(2) and timeout instead of alarm(3). This allows failing over to another IP address for hosts that have more than one.
Changed ssh-agent(1) to attempt FIDO key signing without a PIN and use the error to determine whether a PIN is required and prompt only if necessary.
Implemented the F_SHORTER filter in bgpd(8).
Bumped rpki-client(8) version to 8.0.
Adjusted rpki-client(8) chunked encoding handling.
Allowed reading of MSR_TSC on vmm(4) Intel hosts.
Moved the relayd(8) daemon(3) call to just before forking the children so the parent disassociates from its controlling terminal and shell, but not from its children.
Made rpki-client(8) handle multiple X.509 locations by picking the first location and issuing a warning.
Added apldcms(4), a driver for the touchpad on Apple M2 laptops.
Implemented RRDP_ABORT in rpki-client(8).
Accelerated wc(1) word counting.
Added the recvmmsg system call that allows receiving multiple msghdrs at once.
Added UFS2 support to landisk boot blocks.
Made resolvd(8) write /etc/resolv.conf in a more atomic manner.
Added softraid(4) RAID 1C boot support to sparc64.
Made newer mime type definitions take precedence over existing ones in httpd(8).
Fixed ssh(1) key_lookup() on tokens with built-in UV.
Changed vmm(4) to send all port io emulation to userland.
Added forest (-f) mode to ps(1).
Updated awk(1) to the August 30, 2022 version.
Added privilege separation to snmpd(8).
Imported snmpd_metrics(8). This allows those who need to use net-snmpd the ability to access base snmpd(8) metrics.
Added the new "configtest" action to rc.d(8).
Stopped vnconfig(8) from printing the device name on failure.
Changed ts(1) to parse the user format string once.
Added qcgpio(4) and qciic(4) drivers for the Qualcomm GPIO and I2C controllers found on the SC8280XP SoC. These drivers make the keyboard, trackpoint and touchpad work on the ThinkPad X13s.
Added apldc(4), apldchidev(4), apldckdb(4), and aplrtkit(4) to arm64. These drivers implement support for the Dockchannel-base keyboard found on Apple M2 laptops.
Made sure only one bgpd(8) roa softreconfig runner is run at any time.
Fixed tmux(1) window size reporting.
Avoided a potential NULL dereference in ssl(3) ssl_set_pkey().
Added a missing input validation step to pipex(4) mppe keylenbits.
Added support for ASPA objects (draft-ietf-sidrops-aspa-profile-10) to rpki-client(8).
Added initial support for mmio assist to vmd(4).
In cases where a file in the rpki-client(8) validated cache directory is no longer valid while the newer file in the .rrdp directory is not yet valid, stopped rpki-client(8) from copying the old file over the newer file.
Fixed the growth check in compress(1) and gzip(1) in cases of small files or files with sufficiently random data.
Made fdisk(8) print a warning when a GPT partition start or end is outside the usable LBA area of the device.
Changed rc.subr(8) to copy the message to stdout when using logger(1) to avoid needing to check syslog when running in debug mode.
Fixed installboot(8) messaging when verbose (-v) and dry-run (-n) modes are combined with softraid(4).
Fixed integer overflows in the iwm(4) and iwx(4) firmware file parsers.
Changed the /sbin daemons dhcpleased(8), mountd(8), nfsd(8), pflogd(8), resolvd(8), slaacd(8), and unwind(8) to be dynamically linked to allow them to benefit from all the additional mitigations that dynamically linked executables gain. NFS mounting of /usr must now use statically configured IP addresses.
Added a printed message when ld.so(1) fails inside execve(2) to clarify the failure mode when a dynamic executable is run while /usr isn't mounted.
Updated unbound(8) to 1.16.2.
Worked around MSI and INTx issues on the Qualcomm SC8280XP in acpipci(4). This makes the onboard nvme(4) work on the ThinkPad x13s.
Made fdisk(8) print a warning when an MBR partition starts or extends past the end of the device.
Updated libfido2 to 1.11.0.
Added SPI support for interrupts on ThinkPad x13s.
Added power button support to aplsmc(4).
Added support for the changed layout of the "state" register on Apple's M2 SoC "Avalanche" performance cores to aplcpu(4).
Added delay(9) implementations acpitimer_delay() and acpihpet_delay() to acpitimer(4) and acpihpet(4), respectively.
Changed rpki-client(8) verbose filemode to print details about encapsulated certificates and allow specifying verbose filemode a second time to print in PEM format.
Added delay_init() to provide basic delay(9) implementation management on i386 and amd64.
Fixed a potential kernel panic when an msdosfs partition is filled by fixing instances where msdosfs passed a NULL proc pointer to detrunc().
Added NFS client support to the luna88k RAMDISK kernel.
Added support for agentx(3) to snmpd(8).
Stopped building Mesa against llvm on 32-bit powerpc.
Changed mips64, octeon, and loongson to trigger deferred clock interrupts from splx(9).
Dropped detection code for Cyrix CPUs older than the Cyrix M2.
Improved bioctl(8) RAID level parsing to check numeric levels before checking single character levels. This allows recognition of RAID 10 as a valid but unsupported level.
Changed ssh(1) to attempt fido(4) key signing without a PIN and use the error code returned to fall back only if necessary. This avoids PIN prompts for FIDO tokens that don't require them.
Added local bind mode to ypldap(8). In this mode ypldap binds its RPC sockets to loopback, so YP services are only available to the host ypldap is running on. In local bind mode one does not need to run portmap(8).
Fixed vldc(4) event filters.
Removed the "-c" compatibility option from vnconfig(8).
Removed the obsolete kern.nselcoll sysctl(2).
Solved an issue when multiple nexthops change concurrently in bgpd(8).
Added support for booting from RAID 1C softraid(4) volumes on arm64.
Added a notification when a paste buffer is deleted to tmux(1).
Added a Nobr terminfo capability to tell tmux(1) the terminal does not use bright colors for bold.
Dropped detection code for 386sx/386dx CPUs. OpenBSD/i386 hasn't actually supported running on either for some time.
Corrected the rx data rate for rtl8192eu urtwn(4) devices.
Added support for booting from RAID 1C softraid(4) volumes on amd64.
Fixed a race between pflow_output_process() and pflow_clone_destroy() in pflow(4).
Fixed Xorg(1) when using the luna88k 1bpp framebuffer hardware.
Added support to sftp-server(8) for the home-directory extension defined in draft-ietf-secsh-filexfer-extensions-00.
Simplified TSC synchronization testing on amd64.
Fixed overflow of the number of errors in renice(8) by setting error instead of incrementing it.
Corrected handling of an abnormal fastcgi termination in httpd(8).
Added vi(1) Home/End bindings to tmux(1).
Made the UTC timezone acceptable for certificate validity intervals, sshsig verification times, and authorized_keys expiry-time options by suffixing dates/times with a 'Z' character for sshd(8) and ssh-keygen(1). Also added certificate validity intervals specified in raw seconds-since-epoch as a hex value (e.g. "-V 0x1234:0x4567890") to ssh-keygen(1).
Allowed spdmem(4) to attach to gdiumiic(4).
Disallowed the AS Resources extension on ROA EE certificates for rpki-client(8).
Added iic(4) at glxpcib(4) to get spdmem(4) to attach on 2F-based loongson systems.
Prevented mandoc(1) from turning breakable hyphens in segment identifiers into underscores.
Made putenv(3) return an error if the string starts with the '=' character. This matches the behavior on FreeBSD and NetBSD.
Added seconds to the uptime display of top(1).
Set the default openrsync(1) connection timeout that rpki-client(8) uses to 15 seconds.
Updated libxcvt to 0.1.2.
Added display of an error with the failing path if the xterm(1) unveil(2) fails.
Added a slowcgi(8) -t flag to change the request timeout.
Added support for wildcards in fw_update(8) patterns.
Corrected sparc64 ofwboot to default to the softraid volume on the boot device to make root on softraid work out of the box on sparc64 and be more consistent with softraid boot on other architectures.
Added aplaudio(4), a driver that ties together aplmca(4) and various codecs to present an audio(4) interface to the system.
Added aplmca(4), a driver that controls the hardware block that takes data from apldma(4), serializes it and sends it out on the i2s ports.
Fixed a tmux(1) crash when searching for .* with extremely long lines.
Fixed a bug in pf(4) where a pool defined like "172.16.0.0/16" would count as a pool size of one address. Also fixed random selection of source address to be uniform across the whole pool.
Fixed patch(1) locate-hunk in empty files.
Fixed patch(1) in the case of reversing a patch that creates a file.
Added connection timeout functionality to openrsync(1) via the --contimeout option.
Added an "all" state to tmux(1) allow-passthrough to work even in invisible panes.
Raised the "staff" login class data-size-cur on arm64 to be the same as that for amd64 in login.conf(5).
Randomized the rekey interval of arc4random(3).
Killed virtual address randomization for the arm64 EFI runtime.
Enforced allowance of only one image specified for vmctl(8) create.
Added stack frames to crypto(3) AES-NI x86_64 assembly to silence a false positive from valgrind.
Added a "show swap" command to ddb(4) to help debugging.
Added a "processing" message for when pkg_add(1) is transferring data to inform the user that pkg_add is still working.
Added "show all routes" and the ability to show individual routes (e.g. "show route 0xfffffd807e9b0000") to ddb(4).
Changed rc(8) to only attempt to set the yp(8) domainname if it has not been set yet.
Retired identification code for Rise CPUs.
Fixed an fdisk(8) regression to allow editing an MBR of all zeroes.
Changed fdisk(8) to restrict user actions if neither GPT nor MBR structures can be found on the disk.
Updated libX11 to version 1.8.1.
Updated freetype to version 2.12.1.
Modified pms(4) to discard relative movement packets outside of the [-127, 127] range to prevent cursor jumps when using the trackpoint on some Lenovo laptops.
Added an OpenIKED Vendor ID payload in the iked(8) initial handshake to make it easier to handle interoperability problems with older versions in the future.
Added support for the new DART variant found on the Apple M2 SoC.
Moved to 7.2-beta.
Changed ssh-keygen(1) to prompt the user for confirmation when enrolling a resident key on a security token before overwriting a key with matching application and user ID strings.
Restrict pledge("vminfo") callers to read-only swapctl(2) operations.
Set default sleep value of ico(1) to 10ms.
Updated xcb-protos to version 1.15.2.
Added handling for framebuffers where the first pixel isn't page-aligned to wsfb(4).
Added support for using the power button to wake up from suspend to axppmic(4).
Implemented support for framebuffers that don't start on a page boundary (like those on the new 14" and 16" Macbook Pro).
New ypconnect(2) system call creates a socket based upon the IP address encoded directly in a locked ypbinding file, thereby removing a horrible hack to support YP lookups in programs using strong pledge(2) rules.
Changed ypbind(8) to immediately reach out to learn the TCP port number for a remote ypserv(8) once we've learned the UDP port number and append the answer to the binding file.
Updated xrefresh(1) to version 1.0.7.
Updated xmessage(1) to version 1.0.6.
Updated xmag(1) to version 1.0.7.
Updated xkbutils(1) to version 1.0.5.
Updated xev(1) to version 1.2.5.
Updated xwud(1) to version 1.0.6.
Updated xpr(1) to version 1.1.0.
Updated xmodmap(1) to version 1.0.11.
Updated xfontsel(1) to version 1.1.0.
Updated xconsole(1) to version 1.0.8.
Updated xclipboard(1) to version 1.1.4.
Fixed an interrupt storm upon suspend on Amlogic arm64 boards.
Added sxirintc(4), a driver for the "wake up" interrupt controller found on various Allwinner SoCs.
Added the openssl(1) ciphers -s option to show only the ciphers supported by the specified SSL method.
Implemented the fundamentals for suspend/resume on arm64.
Implemented the Baillie-PSW primality test in crypto(3).
Added an implementation of the integer square root using a variant of Newton's method with adaptive precision to crypto(3).
Stopped building lldb(1) support libraries on arches where lldb is not installed.
Added a method (ESC D) to enter ddb(4) on serial drivers that do not have a true BREAK mechanism.
Bumped rpki-client(8) version to 7.9.
Made the EFI bootloader provide the extra parameters necessary to use non-standard UARTs as console.
Switched bootloaders to the extended BOOTARG_CONSDEV struct.
Added send side RFC 7911 (ADD-PATH) support to bgpd(8).
Added llvm-profdata(1) to base so that ports can benefit from profiled builds.
Added anti-feline input protection to fdisk(8) by refusing to process input of excessive length.
Added iked(8) support for sending certificate chains with intermediate CAs in multiple CERT payloads.
Fixed a bug in cron(8) where it could exit silently if ppoll(2) exited. Now it will log to syslog(3) instead of stderr.
Retired NexGen CPU identification code.
Added support for hyperlinks with capture-pane -e and a mouse_hyperlink format to tmux(1).
Updated capitals and countries in quiz(6).
Got rid of mandoc(1) archaic table markup for header and footer lines in favor of flexbox CSS. Rendering now adapts to browser windows of arbitrary narrowness.
Added xhci(4) support for the dual role controllers integrated on the Qualcomm Snapdragon 8cx gen 3 SoC.
Improved accessibility of man.cgi(8).
Bumped to LibreSSL 3.6.0.
Made iked(8) ignore any CERT payload after the first rather than failing the exchange when more than one CERT payload is received.
Updated to xorgproto version 2022.1.
Updated to Xft(3) version 2.3.4.
Updated to Xcursor(3) version 1.2.1.
Made netstart(8) create virtual interfaces up front if specified on the command line.
Implemented dig(1) support for SVCB and HTTPS record types.
Made timeout(1) -s accept HUP like kill(1) and GNU timeout(1) do.
Changed dhclient(8) to defer to dhcpleased(8) by doing execve ifconfig and providing syslog warnings about deprecated options.
Made unix(4) domain sockets locking per-socket rather than coarse locking of the entire domain sockets layer.
Fixed a bwfm(4) crash during USB detach.
Added reference counting of vms and vcpus to vmm(4).
Introduced a blocklist backend and keyword to snmpd(8) which deprecates filter-pf-addresses.
Added ssl(3) checks to ensure we do not initiate or negotiate handshakes with versions below the minimum required by the security level.
Updated to nsd(8) 4.6.0.
Added tmux(1) support for OSC 8 hyperlinks.
Fixed an off by one error in a vmd(8) vm memory range check.
Added -m option to ts(1).
Unlocked the pledge(2) system call.
Added ts(1), a timestamp utility.
Added support for using non-standard UARTs (such as the Synopsys DesignWare UART) as an early console.
Added support for the Synopsys DesignWare UART found on the Ryzen Embedded V1000 SoCs to com(4).
Ensured that uvm_swap_get() will always sleep rather than returning an error. Previously an error could be returned to the fault handler which would result in processes dying when a system was under a lot of memory pressure.
Made the page daemon consider pmemrange regions when trying to free pages from the inactive list. Previously the page daemon could use a lot of CPU without freeing a page because the global limits were satisfied.
Ensured progress in the swapper by pre-allocating pages in a DMA-reachable region.
Ensure uvm_swap_io() can succeed, even in out of memory situations, by reserving a second segment for the page daemon.
Added bgplgd(8), a fastcgi daemon that provides a REST JSON API to bgpctl(8).
Fixed pf(4) syncookies during fast tcp port reuse.
Altered installer behavior so the vlan(4) question won't be asked unless another network interface exists.
Started allowing arguments to the sftp(1) -D option. (e.g. sftp -D "/usr/libexec/sftp-server -el debug3")
Reworked the rttimer code to fix icmp_pmtu_timeout crashes.
Introduced Large Receive Offloading of TCP segment offloading for ix(4). Also added a tso option to ifconfig(8) to enable and disable this feature.
Unlocked kbind(2).
Fixed a lock order reversal in nfs_inactive().
Added support for RFC 9234 (Route Leak Prevention and Detection Using Roles) to bgpd(8).
Allowed the pluart(4) baud rate to be changed.
Added rpki-client(8) skiplist option.
Fixed a panic triggered by ifconfig bnxt0 down by changing bnxt(4) devices to not run rx and tx interrupt handlers when the interface is not running.
Fixed bwfm(4) ifconfig media display on devices with sta_info command version 3.
Fixed missing interrupts for trackpads on some machines after resume by making sure amdgpio(4) restores pin configuration on resume.
Implemented privilege separation in xlock(1).
Added the --null flag to grep(1) which makes grep print an ASCII NUL byte after the file name to make the output unambiguous.
Updated xsm(1) to version 1.0.5.
Updated xlsfonts(1) to version 1.0.7.
Updated xload(1) to version 1.1.4.
Updated xedit(1) to version 1.2.3.
Moved the wait for autoconf interfaces from rc(8) to netstart(8) to fix tunnel interfaces that depend on working autoconf interfaces.
Updated xdpyinfo(1) to version 1.3.3.
Updated xclock(1) to version 1.1.1.
Updated xcalc(1) to version 1.1.1.
Increased the disklabel(8) auto partitioner's maximum size for /usr to 30G.
Updated xauth(1) to version 1.1.2.
Updated setxkbmap(1) to version 1.3.3.
Updated mkfontscale(1) to version 1.2.2.
Updated listres(1) to version 1.0.5.
Updated iceauth(1) to version 1.0.9.
Updated editres(1) to version 1.0.8.
Updated bitmap(1) to version 1.1.0.
Updated appres(1) to version 1.0.6.
Improved accessibility of mandoc(1) -T html -O toc output by using the <nav> element in the DPUB-ARIA doc-toc role.
Fixed crypto(3) prime recognition when doing trial divisions.
Fixed gzip byte counts with 32-bit integers.
Fixed an issue where a device could show up 32 times by only probing device 0 on PCI busses corresponding to a PCIe root port or a PCIe switch/bridge downstream port.
Bumped MAXCPUS to 256 on arm64.
Ensured cursor remains on selected item on menu in tmux(1).
Bumped bgpd(8) version to 7.4.
Fixed a logic bug in pf_find_state() that could cause pf(4) to incorrectly block a packet.
Added stftemp(4), a driver for the temperature sensor integrated on the StarFive JH7100 SoC.
Fixed a missing kqueue(2) wakeup to fix a Go test hang.
Implemented CPU_BUSY_CYCLE with the riscv64 ZiHintPause extension.
Fixed bugs in the handling of tap inputs in wscons(4).
Restored ETHERTYPE_NHRPA case to tcpdump(1).
Added gpiorestart(4), a driver that resets a SoC/board/machine using a GPIO pin.
Stopped refusing valid IPv6 addresses in -X connect SOCKS support of nc(1).
Added the -b option to sysupgrade(8) to set an alternative base directory to which the installation files will be downloaded to.
Added stfpinctrl(4), a driver for the pinctrl/gpio block found on the StarFive JH7100 SoC.
Fixed a pf(4) NULL dereference panic triggered by relayd(8).
Updated unbound to 1.16.0.
Removed the unused uvm_km_valloc_prefer_wait(9) and uvm_km_free_wakeup(9) functions.
Fixed rpki-client(8) path validation of AS numbers.
Bumped pbuild's datasize-cur from 2G to 3G on i386.
Added stfclock(4), a driver for the clock controller found on the StarFive JH7100 SoC.
Imported libdrm 2.4.111.
Matched groff behavior to allow arbitrary argument delimiters for \C in mandoc(1).
Iterated the tied algorithm in pkg_add(1) to prevent O(n^2) behavior when packages contain several hundred copies of the same file.
Added handling of 9k devices which do not support antenna B to iwm(4).
Fixed multiple memory leaks in awk(1).
Made SetEnv directives first-match-wins in both ssh_config(5) and sshd_config(5).
Dropped DSA keys from the SSH keys generated by default by ssh-keygen -A.
Allowed btrace(8) to execute the END probe upon receiving a SIGTERM signal.
Changed dump(8) to not treat the first argument as a 4.3BSD option string if it contains a '/'.
Ensured that when running sysupgrade(8) on -stable that it will move to the next release, not -current.
Implemented and enabled IPv4, TCP, and UDP checksum offloading for igc(4).
Enabled aq(4) on arm64.
Implemented a rudimentary version of the roff(7) \A escape sequence for mandoc(1).
Rewrote rpki-client(8) rsc.c using ASN.1 templates to implement the constrained versions of the RFC 3779 structures.
Implemented verify-required certificate option in ssh-keygen(1).
Implemented a max-communities filter match for bgpd.conf(5).
Added sfgpio(4), a driver for the GPIO controller found on the SiFive FU740 SoC.
Made grep(1) provide full context when using match count (-m).
Added an ACL list for multiple users attaching to the tmux(1) socket.
Made a first pass at providing kstats for mvneta(4) from the hardware counters.
Limited locked memory to 64k.
Fixed a crash in libpcap when it would walk off the end of the array performing frees.
Made ssh(1) unconditionally call freezero(3) to guarantee that the password is removed from RAM even when sshpkt functions fail.
Introduced a new daemon_execdir variable to rc.d(8) for changing to a specified directory before running rc_exec.
Migrated tcpdump(8) printing of ASnumbers from the old asdot format to asplain format.
Fixed non-transitive extended community handling in bgpd(8).
Added RFC 9234 "BGP Role" support to tcpdump(8)
Made mg(1) automatically delete trailing whitespace on RET in c-mode and auto-indent-mode.
Stopped telling fdisk(8) that macppc HAS_MBR.
Added support for the ehci(4) controller on marvell 3720 boards.
Fixed a kernel panic in pf(4) if IP options with an ICMP payload were truncated. Such packets will now be dropped instead.
Made xterm(1) use a much safer FD-passing idiom for updating utmp(5).
Added kernel locking in nfsrv_rcv() because NFS subsystem is not MP-safe yet.
Converted KVA allocation to kmalloc(9) on hppa, mips64, and sparc64.
Repaired a FILE leak in resolvd(8).
Replaced rc.d(8) $rcexec variable with an rc_exec function. This will require a mechanical change from ${rcexec} to rc_exec in rc.d scripts. Kept compatibility to give people a chance to fix their custom scripts.
Fixed system(3) to ignore SIGINT and SIGQUIT until the shell exits.
Made vmm(4) load the vmcs before reading vcpu registers. This fixes vmctl(8) send on Intel hosts using vmd(8).
Changed the semantics of "hid_none" for hid_start_parse(3) to allow matching of all possible kinds of report IDs.
Made mandoc(1)'s roff_expand() parse left-to-right rather than right-to-left.
Fixed luna88k MULTIPROCESSOR kernels booting with CPU modules installed in arbitrary slots.
Released LibreSSL 3.5.3.
Boosted mvclock(4)'s priority such that it wins against syscon(4).
Unlocked umask(2).
Corrected veb(4) to avoid calling if_enqueue from an smr critical section.
Added an additional vmm(4) fault type, fixing vm receive.
Updated nsd(8) to upstream version 4.5.0.
Corrected reorder_kernel to also handle redirecting stderr to logged output when $KERNEL_DIR.tgz exists.
Arranged scp(1) so it won't ftruncate(2) files early when in sftp(1) mode.
Added login.conf.d to mtree(8).
Fixed iwx(4) setting of HT/VHT bits in rate flags of the Tx command that could cause a firmware panic.
Added /etc/login.conf.d/* to changelist(5).
Elminated a race condition in kqueue(2)'s knote_remove().
Prevented use of "-u" when fdisk(8) is operating on GPT formatted disks.
Made the CPU frequency scaling duration relative to the load when in automatic mode on battery.
Fixed rwlock(9) implementation to be fair to writers. Previously, readers could grab the lock even if writers were waiting first.
Aligned fdisk(8) logic with that used in the kernel to allow the protective EFI GPT partition to be in MBR partitions 0-3, not just 0.
Added support for AX210/AX211 devices to iwx(4).
Added preliminary support for decoding RSC objects in filemode to rpki-client(8).
Allowed ssh-keygen(1) existing -U (use agent) flag to work with "-Y sign" operations.
Fixed rebooting a received vm in vmd(8).
Backported an upstream zlib fix for CRC calculation.
Updated zlib to version 1.2.12.
Fixed the watchdog in the installer so that the watchdog is reset after each download and each set installation.
Added check to acme-client(1) to ensure the challenge token is turned into a filename that is base64url encoded.
Added error handling to kbd(8) for when setting the keyboard encoding fails.
Changed IN_EXPERIMENTAL (aka 240/4) to no longer be considered not forwardable.
Introduced a mutex for ratecheck(9) and ppsratecheck(9).
Imported the HDKF code from OpenSSL 1.1.1o into crypto(3).
Bypassed rpki-client(8) timeout in file mode.
Merged the UVM swap-backed and object-backed inactive page lists.
Standardized memory units to bytes in vmm(4), vmctl(8), and vmd(8).
Rate limited uvn_flush errors during pageout messages, preventing slowdown of system boot when a filesystem is full.
Made pf(4) more paranoid about IGMP/MKP messages.
Activated parallel IP forwarding, starting 4 softnet tasks but limiting the usage to the number of CPUs.
Disabled bcmgenet DMA as part of hardware reset, preventing the hardware from ending up in a partially initialized state during netboot.
Installed useful btrace(8) scripts in /usr/share/btrace.
Prevented out-of-bounds array access with binaries that use unsupported relocations on amd64.
Enabled running of IP input and forwarding with a shared netlock.
Enabled pkg_add(1) caching by default.
Updated libdrm to version 2.4.110.
Altered sndiod(8) to wait until the buffer is drained before closing the device.
Changed pf(4) handling of IGMP and ICMP6 MLD packets to allow multicast control packets to work by default.
Introduced sio_flush(3) to stop playback immediately.
Fixed a potential leak of an SK device in ssh(1).
Fixed a memory leak on the session-bind path of ssh-agent(1).
Protected the global lists with a mutex and moved rttimer entries into a temporary list to make route timers MP safe.
Decoupled IP input and forwarding from protocol input to allow parallel IP processing while the upper layers are still not MP safe.
Removed the ASN.1 decoder tag/length cache (TLC) from crypto(3).
Added dt(4) tracepoints for vmm(4) vm exit reporting.
Added cpu frequency sensors for each core on CPUs that have MPERF/APERF support.
Reimplemented the page allocation code using bus_dma(9) APIs to make sure DMA addresses are translated properly on architectures with an IOMMU. This fixed amdgpu(4) and radeondrm(4) on powerpc, sparc64, and arm64 machines.
Updated libX11 to version 1.7.5.
Updated xterm(1) to version 372.
Extended ksmn(4) to show CCD temperatures if available.
Increased rx buffer size on uaq(4) to 62kB.
Added missing uuid_dec_le() to init_fp() so fdisk(8) -A works on big-endian architectures.
Updated vi(1) to apply expandtab to the output of a ! command.
Protected arp(4), ND6, and pppoe(4) with the kernel lock so that IP forwarding can be run in parallel.
Updated various wireless drivers to use memset(3) to initialize ieee80211_rxinfo struct properly.
Prevented a crash in vi(1) when cursor key support is disabled.
Introduced dedicated link entries for snapshots to pfsync(4).
Repaired rge(4) hardware vlan tagging.
Changed crypto(3) to avoid expensive RFC 3779 checks during certificate verification.
Updated Mesa to version 21.3.8.
Added concatenated JSON output to rpki-client(8) filemode.
Made ssh(1) try to continue running local I/O for channels in OPEN state during transport rekeying to allow escapes to work in the client if the connection stalls during a rekey event.
Made rpki-client(8) hard error when parse_filepath() is passed an unknown repository id.
Restored vte(4) original MDC speed control register value on vte_reset, needed for Vortex86DX3 machines.
Enabled kstat(4) and kstat(1).
Fixed kbd(8) so it doesn't fail silently when executed by a regular user.
Made device matching in iwx(4) more similar to linux iwlwifi.
Allowed more than one CRL URI in certificates for rpki-client(8)
Made use of the fact that repositories are unique objects in pkg_add(1) and annotated the quirks repository as cached, allowing for a large speed increase.
Relaxed address availability check for multicast(4) binds so processes listening for the same multicast address do not need to be the same UID.
Fixed witness lock issue found where pfsync(4) holds the mutex and an interrupt grabs the kernel lock.
Updated afterboot(8) to direct the user to use binary packages.
Changed to a simpler formula to calculate a default kern.maxthread value: 2*NPROCESS.
Simplified machine command handling in ddb(4).
Fixed openrsync(1) on sparc64 by eliminating a redundant second conversion of the int value from little to host endian.
Extended rpki-client(8) -f filemode to decode and print TAL details.
Changed compress(1) to print a more accurate message when -v is used with -k.
Added missing arches (aarch64, mipsel64, powerpc64) to categories in sendbug(1).
Fixed calculation of the width of spanned columns in mandoc(1).
Fixed memory leak in ipmi(4) get_sdr on failure.
Added support for more power sensors to ipmi(4).
Added support for switching from glass console to serial console on arm64 systems that default to glass console.
Allowed bsd.rd and bsd/bsd.mp to boot on Oracle Cloud amd64 instances.
--------
Changes made between OpenBSD 7.0 and 7.1
Moved to OpenSSH 9.0.
Stopped suspending the tpm(4) device upon hibernation, preventing some systems from hanging when hibernating a second time.
Fixed pfctl(8) rdr-to rules failing on certain port ranges when explicitly specified.
Added mvpinctrl(4) support for the CP115 block found on Marvell CN9K SoCs.
Added mvclock(4) support for the AP807 block found on Marvell CN9K SoCs.
Fixed ure(4) vlan transmission with hw tagging.
Added preliminary ure(4) support for RTL8156B and bug fixes for RTL8153/RTL8156.
Fixed aq(4) occasional errors seen on rockpro64.
Ensured azalia(4) matches on Intel 300 Series audio, fixing attaching on the Dell G3 3590.
Stopped printing "You may wish to update your font path" with use of pkg_add(1) for paths which are under /usr/local/share/fonts.
Implemented aplintc(4) support for multiple dies, making OpenBSD work on the M1 Ultra.
Ensured that an interrupted arm64 install from the ramdisk kernel can be restarted.
Added support for the sftp-server(8) "copy-data" protocol extension to allow server-side copies to be performed without going via the client.
Added sftp(1) "cp" command which supports server-side copying of files.
Ensured i386/amd64 machines boot from partition 'a' when selected, rather than the partition marked active.
Reinstated a drm(4) workaround to get framebuffer size from efifb, preventing fatal errors for the BESSTAR TECH HM90 with Ryzen 9 4900H.
Fixed glass console and getty(8) interference with Xorg on arm64.
Added quiesce/wakeup hooks to sync vcpu state in vmm(4).
Ensured pcap_lookupdev(3) matches only on complete interface names.
Enabled mtw(4) on i386, macppc and arm64.
Implemented reboot/powerdown support in aplsmc(4).
Implemented most of CMS related checks in rpki-client(8) required by RFC 6488 section 3.
Added fix in zlib for CLEAR_HASH macro.
Added OSC 7 capability to tmux(1) for setting titles.
Fixed a small ntpd(8) leak.
Rate limit rad(8) router advertisements according to RFC 4861.
Fixed iwm(4) 802.11ac throughput at a distance.
Made sure nothing can map address zero on RISC-V.
Fixed crash in slaacd(8) when receiving a negative length field for DNS labels.
Added code to update hw.power whenever AC state changes on resume.
Added support for XBox One game controller on usb.
Fix IP output routines on raw sockets so route sourceaddr can take effect using sendto(2) or similar.
Avoid calling setrtable(2) unless "rtable" is set explicitly in login.conf.
Prevent panic in softraid(4) while rebooting if softraid has been disabled.
Prevent announcing VHT capabilities on iwm(4) and iwx(4) for 2GHz bands during scans.
Fixed argument list leak in scp(1).
Enabled interrupt moderation on aq(4), aiming at around 20k per second.
When choosing networks during SSID selection, give a higher score to 11ac and 11n access points, prioritizing 11ac.
Fixed attach of multiple iwm(4) or iwx(4) interfaces in the same machine.
Add initial 802.11ac support to iwm(4).
Added 802.11ac/VHT TX rate adaptation support to the wifi stack.
Made sure sshd(8) does not try to resolve ListenAddress when re-execing.
Fixed ssh-keygen(1) SEGV when using -Y check-novalidate.
New logic for pkg_add(1) to avoid excessive moving of files during updates when possible.
Avoid legacy CSS2 syntax and use CSS3 two-value syntax in mandoc(1).
Updated time zone database to tzdata2022a.
Made tcpdump(8) show 802.11ac VHT capability and operation IEs in -v mode.
Add tmux(1) option to control if it scrolls into history on clear.
Make sure iked(8) vroute messages are correctly aligned, fixes autoconfiguration of addresses on octeon.
Added an option in tmux(1) to set the character for unused areas of the terminal.
Updated nsd(8) to version 4.4.0.
Bumped LibreSSL to 3.5.2.
Fixed reading motherboard time on Apple machines with old SMC firmware.
Make su(1) honor the login class routing table when doing a full login with su -l.
Fixed infinite loop in libcrypto for certain elliptic curve public key operations.
Enabled IP header checksum offloading in ix(4).
Changed the way $macros are expanded in bgpd.conf(5).
Fix TX rate used by rtwn(4) and urtwn(4) for RTS frames.
Fixed sndiod(8) crash.
Enabled checksum offloads on aq(4).
Added -k flag to gzip(1) and gunzip(1) to retain (de)compressed file.
Made sure armv7,arm64 and risc-v FDT bootloader code does not write beyond the FDT data structure.
Added 802.11ac support on iwx(4).
Added initial 802.11ac (VHT) support to the wifi stack.
Improved TX performance on urtwn(4) RTL8192EU devices.
Improved message fragment retransmissions for iked(8).
Fix crash in IPSec while doing parallel IP forwarding.
Add missing error check for x509 constraints code in libcrypto.
Enable vlan promisc, header stripping and vlan RX/TX offload on aq(4).
Let unwind(8) probe for DNS64 presence with an absolute name, so asr doesn't add search domains and retry.
Made fdisk(8) preserve the EFI System partition when auto-allocating space on GPT disks with magic Apple partitions.
Fixed receive filter handling in aq(4).
Fixed masked signal traps while in a debugger.
Fixed overflow protection code in rpki-client(8).
Enabled PL011 UART FIFO support in pluart(4).
Fixed RISC-V lld link code when dealing with object files created with "ld -b".
Added kernel interfaces for atomic load and store functions for int and long to be used in reference counted struct members.
Prevented an assert in uvm_page.c when freeing an anon after swapping out its memory.
Added mtw(4) to fw_update(8).
Prevented aq(4) nics from writing to mbufs taken off the ring when the interface was taken down.
Updated libexpat to 2.4.7.
Improved roaming stability on iwn(4), particularly with wpa_supplicant.
Switched aucat(1) internal sample representation and default file encoding to 24-bit.
Switched sndiod(8) internal sample representation to 24-bit fixed point.
Renamed net80211 ioctl(2) struct ieee80211_channel to struct ieee80211_chaninfo.
Updated to xf86-video-amdgpu 22.0.0.
Prevented a possible deadlock in cad(4).
Made the arm64 ramdisk installer fetch bwfm(4) firmware from the EFI System Partition on Apple Silicon devices for use during installation and addition to the newly installed system.
Added support for the BCM4387 to bwfm(4).
Improved handling of static compressed gzip files in httpd(8).
Added openvpn ports (udp/1194 & tcp/1194) to /etc/services.
Added an ofw interface to write to an nvmem cell.
Added RTC support to aplsmc(4).
Added nvmem support to aplpmu(4) and made it available on Apple SPMI PMUs.
Added pax(1) support for mtime/atime/ctime extended headers in !SMALL builds.
Ensured apldart(4) keeps the DART enabled in front of the display controller to preserve its access to the framebuffer and continued display.
Added handling for vmd(8) hitting resource limits when starting a vm and added memory error messages for the user.
Modified aplintc(4) to support a newer interrupt controller, making OpenBSD run on M1 Pro/Max machines.
Added rtable capability to login.conf(5).
Provided a login class for vmd(8).
Added mbuf tags to prevent output loops in etherip(4).
Fixed backtraces on i386 and armv7.
Added a gzip-static option to httpd.conf(5), allowing delivery of precompressed files with content-encoding gzip.
Added a malloc(3) cache of regions between 128k and 2M to accommodate programs allocating and deallocating regions of these sizes quickly.
Fixed setusercontext(3) error when /etc/login.conf is not present.
Protected pfsync(4) tdb flags and lists with a mutex to prevent crashes involving pfsync, IPsec and parallel forwarding.
Enabled cduart(4) on arm64.
Released LibreSSL 3.5.0.
Fixed kernel stack alignment on riscv64.
Unlocked getsockname(2).
Updated Mesa to 21.3.7.
Updated to unbound(8) 1.15.0.
Made it possible to bind and connect to non-default ports in bgpd.conf(5).
Randomized the password used in fakepw in ssh(1).
Released OpenSSH 8.9.
Extended and reordered the process accounting information structure acct(5). Flag Day for the acct(2) file format.
Added seq(1), a command to print sequences of numbers.
Added new _MAXCOMLEN (a proper string expanded to 24 bytes including the NUL) to syslimits, allowing replacement of the MAXCOMLEN symbol from sys/param.h in userland.
Updated libexpat to 2.4.6.
Stopped hiding the mtu on "bridge" interfaces which do handle l3 traffic in ifconfig(8).
Improved stack unwinding on riscv64 in ddb(4).
Made audio(4) event filters MP-safe.
In rpc.rusersd(8) unveil(2) "/dev" read-only instead of using chroot(2).
Updated to libX11 1.7.3.1.
Capped the daemon login class datasize at either 1G or 4G depending on the architecture and set the bgpd class datasize to either 16G or 1G.
Made ping(8) print out the source address and sequence number when the signature on an icmp echo reply doesn't match.
Made fw_update(8) use the /snapshots directory only on -current.
Fixed vi(1) recovery mode.
Added aplcpu(4), a driver to control the CPU performance levels on Apple SoCs.
Prevented a potential crash when slaacd(8) receives more than 7 nameservers.
Updated xorg-server to 21.1.3, leaving in place an earlier change to compute the screen resolution from dimensions returned by the screen, reverted by upstream.
Moved to OpenBSD 7.1-beta.
Enabled subpixel rendering in FreeType.
Used installboot(8) in install.md for armv7.
Made apmd(8) replace /etc/random.seed for hibernate-resumes.
Enabled TLS verify by default for outbound "smtps://" and "smtp+tls://", restoring documented smtpd(8) behavior.
Introduced mpfgpio(4), a driver for the PolarFire SoC MSS GPIO controller.
If S4 is not available, use S5 for the ACPI-transitions in hibernate support.
Corrected architecture checking to prevent partial building of binutils-2.17 on unsupported systems.
Introduced mpfiic(4), a driver for the PolarFire SoC MSS I2C controller.
Included minimal UBSan libraries, for runtime detection of undefined behavior.
Correlated uaudio(4) and ucc(4) devices attached over USB in order to adjust the volume of the correct attached audio device rather than the first one attached. (Reverted 2022/03/29)
Fixed suspend/resume issues with com(4) at acpi(4).
Ensured the pf(4) "set prio" values are checked consistently.
Prevented reopening of tun(4)/tap(4) interfaces which are being destroyed.
Rewrote vxlan(4) to operate independently of bridge(4), create and bind udp sockets and prevent loops.
Prevented tweaks to tun(4) if_flags when the NET_LOCK isn't held.
Used fdisk(8) -b to create the desired 1MB MSDOS boot partition for macppc rather than relying on /usr/mdec/mbr.
Added support to explicitly power on some PCIe devices on the M1 and M1 Pro/Max through a GPIO controlled by the SMC.
Added basic GPIO support to aplsmc(4).
Improved tracking of mbuf memory usage in the whole system.
Made rcctl(8) look for the login class in both login.conf and login.conf.d/${class}.
Enabled receive checksum offloading on ixl(4).
Stopped smtpd(8) from verifying the cert or CA for a relay using opportunistic TLS.
Updated Devel::PPPort to 3.6.4.
Unveil(2) _PATH_LOGIN_CONF_D.
Introduced support for storing capability databases in /etc/login.conf.d, allowing easy addition of custom login classes from packages.
Switched to using fdisk(8) -b to create boot partitions on multiple architectures.
Stopped unregistering firmware with fw_update(8) when the SHA256.sig cannot be fetched.
Enabled acpibat(4) use with the Surface Go 3.
Fixed getcap(1) -f option when passed multiple files.
Enabled more flexible device matching for I2C devices.
Increased armv7 ramdisk size.
Added a CRL check for manifests to rpki-client(8).
Re-enabled ixl(4) IPv4, TCP4/6 and UDP4/6 checksum offloading.
Switched ssh(1) hpdelim interface to accept only ":" as a delimiter.
Enabled hardware vlan tagging for ixl(4).
Implemented the poll(2) system call on top of the kqueue(2) subsystem, obsoleting the old, non-MP-safe poll backend.
Plugged a leak in libtls CRL handling.
Reworked ix(4) checksum/vlan offloading and enabled it for IPv6.
Added ps(1) status flag "c" to indicate a process is chrooted.
Allowed ddb(4) trace through interrupt on macppc.
Released rpki-client(8) 7.6.
Allowed riscv64 installation on a disk with a GPT.
Enabled support for displaying an estimated battery recharge time in apm(8) and apmd(8).
Grew the dmesg(8) buffer on i386 from 4 to 8 pages.
Enforced RFC 6384 certificate policy for RPKI in rpki-client(8).
Moved to rpki-client(8) 7.6.
Made fdisk(8) -A preserve BIOS boot partition.
Used installboot(8) in riscv64 install.md.
Added a key in tmux(1) copy mode to toggle the position indicator.
Introduced apldma(4), a driver for the DMA controller found on Apple SoCs.
Allowed ssh-keygen(1) -Y find-principals to match wildcard principals in allowed_signers files.
Added a tmux(1) option to show arrows for the active pane indicator.
Attempted to guarantee that on copy-on-write faulting, the new copy can't be written to while any thread can see the original version of the page via a not-yet-flushed stale TLB entry.
Changed isakmpd(8) to log a warning when proto is NULL rather than dereferencing it.
Updated libexpat to 2.4.4, fixing CVE-2022-23852 and CVE-2022-23990.
Introduced aplnco(4), a driver for the Numerically-controlled oscillator (NCO) clock which drives the audio clocks on Apple silicon.
Introduced tascodec(4), a driver for the TI TAS2770/TAS5770 digital audio amplifier codec found on Apple M1 Macs.
Prevented a file descriptor leak in touch(1) after futimens(2) failure.
Increased ddb(1) access to registers on macppc and powerpc64.
Properly handled .mft files in rpki-client(8), preventing replay attacks using old but still valid files.
Added a cwm(1) "group-last" command that shows only the previously active group.
Update awk(1) to Dec 8, 2021 version.
Allowed rsync:// URIs as files in rpki-client(8) -f mode.
Fixed an issue where com(4) would attach for a disabled serial port leading to misdirection of the hardware variant and a subsequent hang when /etc/rc runs ttyflags(8) -a.
Made vmm(4) dt(4) tracepoints amd64-only.
Made fw_update(8) re-download existing files with failed checksums.
Allowed rpki-client(8) to display more than one file in -f mode.
Made ed(1) flush all stdio streams before running a shell command.
Fixed and reenabled active scans on iwm(4) and iwx(4).
Enabled dt(4) on macppc.
Added optimization for tiny x in cos(3) and sin(3).
Disabled assembly implementations of trig functions on x86 platforms.
Copied the cos(3) software implementation from FreeBSD-13.
Improved how quirks are handled on sdhc(4)-compatible drivers.
Introduced cdsdhc(4), a driver for the Cadence SD/SDIO/eMMC host controller.
Made transferring multiple files in scp(1) mode create the destination if it doesn't already exist.
Updated libexpat to 2.4.3.
Allowed more memory ranges in hibernate.
Introduced a validated cache which holds all the files successfully verified by rpki-client(8).
Enabled openssl(1) pkey -{,pub}check and pkeyparam -check.
Implemented new-style OpenSSL BIO callbacks in crypto(3).
Updated drm(4) to linux 5.15.14.
Allowed pin-required FIDO keys to be added to ssh-agent(1).
Made bpf(4) MP-safe.
Implemented powerdown in arm64.
Improved performance of rev(1).
Set cpuspeed to 0 in apm(8) when hw.cpuspeed cannot be retrieved.
Fixed sdhc(4) for Jasper Lake eMMC.
Added Synopsys Designware UART support to com(4).
Unlocked getpeername(2).
Modified the installer to use fw_update(8) to install non-free firmware files if present on the install media.
Added Intel Jasper Lake to azalia(4).
Introduced aplsmc(4), a driver for the SMC found on Apple M1 SoCs.
Fixed GOST skip certificate verify handling.
Fixed a problem where unveil("/", "r") and unveil("usr/bin/id", "rx") cause an error when read accessing /usr/bin.
Stopped fw_update(8) from downloading SHA256.sig when not needed, to allow installing local files without network access.
Removed apldwusb(4).
Fixed possible use after free with long lines in less(1).
Applied MP-safe changes from dwge(4) to dwxe(4).
Made ssh-keysign(8) use the requested signature algorithm and not the default for the keytype.
Made ssh(1) UpdateHostkey signature verification logic more strict.
Fixed sshd(8) signature algorithm selection logic for UpdateHostkeys.
Fixed wrong pointer assignment causing the driver to read block ack request information sent by firmware from the wrong offset in iwx(4).
Returned to a shell-script based fw_update(8), written to be usable by the install script, allowing earlier retrieval of downloaded firmwares.
Added a basic printer for EAPOL packets to tcpdump(8).
Changed ssh-keygen(1) to allow selection of hash algorithm at sshsig signing time.
Fixed an ssh-keygen(1) NULL dereference when using find-principals and matching an allowed_signers line that contains a namespace restriction but no restriction specified on command line.
Introduced mpfclock(4), a driver for the PolarFire SoC MSS clock controller.
Fixed hibernate setups where a removed umass(4) device results in a renumbered softraid(4) device.
Restricted the pci(4) ioctl interface to devices detected by hthe kernel, preventing Xorg PCI probes from breaking the WiFi chip on M1 macs.
Made the dhcpleased(8) host name DHCP option configurable.
Corrected checksums written by fdisk(8) on big-endian architectures to be little-endian as per spec.
Rewrote arm64 kernel FPU handling code to fix the random crashes seen with SMP kernels on Apple M1.
Added attempts to turn on less-capable mouse modes when tmux(1) turns on more-capable ones, in case the terminal doesn't support the desired mode.
Added missing locking to pmap_extract(9) and pmap_unwire(9) on arm64 and riscv64.
Reintroduced support for vmctl(8) start -B net -b bsd.rd, which emulates a PXE boot and performs an autoinstall.
Prevented a potential race when assigning new wskbd(4) keymap.
Fixed veb(4) vport handling to prevent improper drop of packets leaving a vport interface.
Unlocked the bottom part of the uvm fault handler.
Added the chip ids used on Apple M1 Pro/Max and Apple T2 Macs to bwfm(4).
Reworked garbage collector for unix(4) sockets to prevent potential kernel panics.
Added address locators for the ACPI "bus" and used these to fix the order of the com(4) devices to match the traditional order on the ISA bus.
Made "set skip on ..." in pf.conf(5) dynamic.
Allowed bare numbers for key and mouse bindings in cwm(1).
Made uniq(1) skip() each input line only once, improving performance.
Introduced apliic(4), a driver for the I2C controller found on various Apple SoCs.
Protected ipsec(4) input and output with the kernel lock to allow forwarding of non-ipsec traffic in parallel.
Disabled minimum power consumption in bwfm(4) hostap mode, improving connection reliability when used as an access point.
Updated to nsd(8) 4.3.9.
Made dhcpd(8) start listening on DOWN interfaces.
Made iwm(4) attach to PCI devices with product ID 0x31dc, part of the 9560 chip family.
Introduced mtw(4), a driver for MediaTek MT7601U wifi devices.
Added unbound and host-bound options for ssh(1) PubkeyAuthentication for hardware devices unable to sign longer pubkey authentication challenges.
Required host-bound userauth requests for forwarded SSH connections.
Gave ssh-agent(1) the ability to parse restrict-destination-v00@openssh.com constraints and to apply them to keys.
Made ssh-add(1) accept a list of "destination constraints" that allow restricting where keys may be used in conjunction with an ssh-agent/ssh that supports session ID/hostkey binding.
Fixed radeondrm(4) console colors on sparc64.
Introduced aplmbox(4), a driver for the mailbox that provides a communication channel with additional cores integrated on Apple SoCs.
Updated to LLVM 13.0.0.
Attached com(4) over acpi(4) on amd64.
Added create permissions to unveil(2) on ldapd(8).
Restricted usbhidctl(1) and usbhidaction(1) file system access with unveil(2).
Implemented em(4) support for selecting SMGII or SerDes mode depending on the plugged-in SFP transceiver and for reading out transceiver information via ifconfig(8).
Used "rng-seed" and "kaslr-seed" properties from the device tree to mix extra entropy into the pool for arm64.
Added pclk clock used by dwdog(4) on RK3399 to rkclock(4).
Increased tee(1) I/O buffer size from 8KB to 64KB.
Added handling of multi-port controllers to uslcom(4).
Added a pane-border-format pane option to tmux(1).
Reduced unnecessary usage of sys/cdefs.h includes.
Cleaned up unnecessary sys/param.h includes across the kernel and userland, replacing some macros with local copies.
Added a "vnode" parameter to VOP_STRATEGY(9).
Added acpipci(4) support for interrupts represented by ACPI PCI Interrupt Link Devices, making PCI interrupts work on QEMU's SBSA target.
Fixed a potential DOS associated with BIO_indent(3) when a caller asks for a negative number of bytes of output.
Fixed a bug where iked(8) sent zero-prefixed NAT-T messages on port 500, causing parsing errors.
Introduced aplpmgr(4), a driver for the power management controller found on various Apple SoCs.
Taught the net80211 stack to remove corresponding frames from ic_pwrsaveq when a power-saving client decides to leave our hostap interface, preventing a panic.
Allowed fdisk(8) to extend the default OpenBSD partition to the end of the disk, rather than truncating at the end of the last full cylinder.
Fixed spurious abort of a VM by vmd(8) when the scheduler moves a VM to a different core while it is sleeping on a lock.
Fixed broken vmd(8) "boot device cdrom" feature after a fix in seabios.
Switched iwx(4) to new -67 firmware images.
Disabled probe requests during scans in iwx(4) again, preventing device timeouts for some devices.
Implemented bgscan_done() handlers for iwx(4) and iwm(4).
Introduced an optional driver-specific bgscan_done() handler which allows the driver to take control of the roaming teardown sequence, ensuring that race conditions between firmware state and net80211 state are avoided.
Fixed an xserver 1.21.1 crash when attempting to run fvwm(1) on an x61/965gm with the modesetting driver on amd64.
Prevented a potential race which could make umount(8) fail spuriously in the installer.
Improved the testing of credentials against inserted FIDO keys, reducing spurious "Confirm user presence" notifications for key handles relating to FIDO keys which are not currently inserted.
Ensured ^C may be used to kill ssh(1) sessions where SessionType=none.
Fixed removal of SAs that could not be flushed with ipsecctl(8) -F.
Fixed booting from an IDE block device on the Sun Blade 100.
Prevented select(2) from blocking if registering found pending events.
Enabled uhid(4)/fido(4) on riscv64.
Unlocked accept(2) and accept4(2) syscalls.
Added iked(8) -V to display the version.
Prevented a crash in slaacd(8) due to updating an interface which no longer exists.
Let iwx(4) and iwm(4) use per-Tx-queue interface timers to ensure timeout if a particular Tx queue gets stuck.
Added ssh-keygen(1) -Y match-principals operation to perform matching of principals names against an allowed signers file.
Dropped support for netscape certificates and server gated keys in openssl(1).
Released LibreSSL 3.4.2.
Prevented the possible creation of MBRs with overlapping partitions 0 and 3 in fdisk(8).
Fixed a panic when running utvfu(4) on xhci(4).
Fixed timestamp printing in Signed Certificate Timestamps.
Switched to calculating pppoe(4) session duration using system uptime rather than UTC.
Updated to openchrome(4) 0.6.409.
Switched LLD_ARCHs to llvm-ar(1).
Introduced pcyrtc(4), a driver for the NXP PCF85063A/TP RTC chips.
Implemented RFC6840 (AD flag processing) if using trusted name servers.
Aligned memory allocation for USB device drivers and USB HC drivers, enlarging the USB memory pool.
Added ikectl(8) "show certinfo" to show trusted CAs and certificates.
Introduced iicmux(4), a driver that switches between I2C busses connected to a single I2C controller by using the pin muxing facilities of an SoC.
Made config(8) -c cmdfile use lines from the command file for all input, not just commands. This allows complex actions like changing device parameters.
Allowed interface names as scope-id in IPv6 link-local addresses in unbound(8).
Made futexes work in shared anonymous memory.
Fixed monitor mode on iwm(4) and iwx(4).
Made uniq(1) ignore trailing newlines when comparing lines.
Fixed a crash when xrandr(1) is invoked with X server 21.1.1.
Added display of DNS information from sppp(4) to ifconfig(8).
Disabled active scanning on iwm(4) 9260 and 9560 to prevent a device lockup.
Installed missing scope identifiers for IPv6 link-local addresses for unwind(8) and resolvd(8).
Fixed hilkbd(4) Swedish keyboard layout on non-PS/2 style keyboards.
Improved and simplified timer handling in rc.d(8) "stop" and "reload".
Switched to using long filenames by default with mount_msdos(8) on FAT filesystems.
Added support for controlling keyboard LEDs to aplhidev(4).
Implemented the probe variable in bt(5).
Updated awk(1) to the Nov 3, 2021 version.
Added support for 40MHz channels to iwn(4).
Reduced the time overhead of kqueue(2)-based poll(2) and select(2) systems calls by keeping knotes between the system calls.
Made config(8) -e work with ramdisk kernels.
Fixed crashes in httpd(8).
Fixed iwn(4) with 4965 devices.
Retired switch(4), switchd(8) and switchctl(8).
Updated to Xserver(1) 21.1.1.
Updated to libXi 1.8.
Updated to libXfixes 6.0.0.
Updated to xorgprotos 2021.5.
Updated to fontconfig 2.13.94.
Updated to Freetype 2.11.0.
Added support for PPP IPCP extensions for DNS to sppp(4).
Fixed broken key exchange negotiation with matching proposals in iked(8).
Added the sntrup761x25519-sha512@openssh.com hybrid ECDH/x25519 + Streamlined NTRU Prime post-quantum KEX to the default KEXAlgorithms list fo ssh_config(5) and sshd_config(5).
Fixed ssh-keysign(8) for KEX algorithms that use SHA384/512 exchange hashes.
Added gpiokeys(4) for arm64, a driver which handles events triggered by GPIO keys such as lid status and power button.
Published rpki-client 7.5.
Limited the number of publication points under a given TAL in rpki-client(8).
Documented install.site(5), OpenBSD installation and upgrade customization.
Fixed handling of interrupts shared between multiple swiic(4) devices.
Allowed passing a different signal than SIGTERM in the default rc_stop() function in rc.subr(8).
Made the kqread event filter MP-safe.
Corrected httpd(8) version string checking, responding with 505 Version Not Supported rather than 400 Bad Request when the version format is incorrect.
Limited the number of openrsync(1) processes being spawned by rpki-client(8) to 16.
Fixed ASN1_TIME_diff(3) with NULL times.
Added a cursor-style option to tmux(1).
Fixed "(null node)" panics on run(4).
Improved handling of FIDO keys on tokens which provide user verification on the device itself, including biometric keys.
Corrected "!" escape handling in the installer when accepting WEP/WPA passphrase.
Updated awk(1) to the October 12, 2021 version.
Added uniq(1) support for arbitrarily long input lines.
Prevented awk(1) access to uninitialized data.
Improved SNI hostname validation.
Stopped binding audio devices exposed by sndiod(8) to physical devices.
Fixed "null node" panics in run(4).
Added a cursor-colour option to tmux(1).
Added aplhidev(4) support for the keyboard/touchpad on Apple M1 laptops.
Enabled RFC 3779 (X.509 Extensions for IP Addresses and AS Identifiers) code in OpenSSl.
Fixed octal escape parsing in tr(1) backslash().
Disabled xterm(1) mouse tracking by default.
Added aplspi(4), a driver for the SPI controller found on the Apple M1 SoC.
Added igc(4), a driver for the Intel 2.5Gb Ethernet controllers.
Made athn(4) attach to the Sony UWA-BR100.
Changed sysctl(8) default to hw.perfpolicy=auto at startup, defaulting to 100% performance with AC power connected and using the auto algorithm when on battery.
Fixed UNIX domain sockets leak in soclose().
Updated to libepoxy 1.5.9.
Limited rpki-client(8) HTTP requests to 2GB of data.
Implemented openrsync(1) --max-size and --min-size.
When downloading resident keys from a FIDO token, made ssh(1) pass back the user ID that was used when the key was created and append it to the filename the key was written to (if not the default).
Unlocked the kevent(2) system call.
Updated to libfido2 1.8.0.
Made iked.conf(5) proto config option accept a list to allow specifying multiple protocols for a single policy.
Improved unhibernate performance by skipping attach of irrelevant devices.
Enabled vmx(4) on arm64.
Cleaned up irrelevant uses of 3rd mode_t parameter for open(2)/openat(2), unused when not creating files.
Ensured armv7 and arm64 efiboot allocate fresh memory for the device tree with at least one page of free space to extend into. This fixes booting on VMWare Fusion.
Added rejection of malformed Subject Alternative Names at certificate creation time to LibreSSL.
Added a way to force a color to RGB in tmux(1) and a format to display it.
Fixed pfctl(8) $nr incorrect macro expansion.
Fixed vi(1) use after free with unsaved buffer.
Added -s and -S to tmux(1) display-popup to set popup and border style.
Fixed application-set fg and bg in tmux(1) panes.
Added httpd(8) custom error page facility.
Added mount -ur/uw support to tmpfs.
Unlocked top part of UVM fault hander on mips64.
Used unveil(2) for the possible btrace(8) script file, dt(4) and ksyms(4) nodes.
Used ifconfig(8) "join" command by default in hostname.if(5) files, replacing the old "nwid".
Switched nsd(8) to enable default DNS cookies on, matching behavior as released in OpenBSD 7.0.
Updated to nsd(8) 4.3.8.
Implemented poll(2), select(2), ppoll(2) and pselect(2) on top of kqueue.
Stopped prompting whether to fall back to HTTP in the installer, making the fallback automatic.
Fixed a panic by prohibiting renames of tmpfs mount-points.
Set klist lock for sockets to make socket event filters MP-safe.
Made pipe event filters MP-safe.
In httpd(8), stopped sending content alongside responses to HEAD requests.
Stopped duplicating "Connection: close" headers in relayd(8), only adding it if it's not a websocket response.
Provided common btrace(8) scripts kprofile.bt (to save kernel stackframes and produce flamegraphs) and runqlat.bt (to measure the latency of the scheduler runqueues).
Added call to unveil(2) to restrict stty(1) -f filesystem access.
Added support for tpm2 CRB interface to tpm(4), fixing recent S4 regressions on the Surface Go 2 caused by a firmware change.
Retired asynchronous crypto API.
Added new OpenSSL api SSL_write_ex, SSL_read_ex and SSL_peek_ex.
Annotated an httpd(8) 413 error with "request body too large" in the error log.
Fixed double free after allocation failure in bpf(4).
Provided a way to determine our maximum legacy version for TLS in libssl, unbreaking RSA KEX for the TLS client when the non-version specific method is used with TLSv1.0 or TLSv1.1.
Called pledge(2) later to prevent it from killing various games using ncurses when both stdout and stderr are redirected to a non-tty.
Removed unusable route(8) -T and exec support from ramdisk.
Reinstated the fips mode test functions to libcrypto.
Added rcctl(8) "ls rogue" to show daemons which are running but not set as "enabled" in rc.conf.local(8).
Fixed a potential buffer overflow in openssl(1) certhash.
Renamed Pacific/Enderbury timezone to Pacific/Kanton.
Fixed an interrupt storm on dwge(4) variants which support Energy Efficient Ethernet when connected to a switch which does so as well.
Ensured enabled resolvers are honored by unwind(8) to keep unused forwarders disabled properly.
Implemented rsync(1) --compare-dest, allowing specification of additional directories to check for files to be available.
Prevented ssh(1) memory leak if getaddrinfo returns no addresses.
Added protocol version checking to httpd(8).
Ensured use of the correct encoding in xenocara when /etc/kbdtype is present with an attached ucc(4) keyboard.
Removed hifn(4), safe(4) and ubsec(4) crypto drivers.
Removed fdisk(8) "disk" editing command.
Fixed httpd(8) to respond with 400 Bad Request when a client sends header lines without a colon.
Bumped to LibreSSL 3.5.0.
Added -T to set a popup title in tmux(1).
Stopped ignoring carp(4) interfaces in dhcpleased(8).
Removed an unused decoding of c/h/s from the MBR read from disk by fdisk(8).
Updated to xterm(1) 369.
Corrected installer to use "inet autoconf" properly for hostname.if(5) files.
Returned to use of the SFTP protocol for scp(1).
Added initial 40MHz support to the iwx(4) driver.
Fixed a problem with repeat in tmux(1) copy mode.
Released LibreSSL 3.4.1.
Replaced lrint(3), lrintf(3), llrint(3) and llrintf(3) implementations from NetBSD with the existing FreeBSD implementations we were already using for lrintl(3) and llrintl(3).
Fixed a tmux(1) redraw problem on automargin terminals.
Modified syslog.conf(5) examples to use TLS rather than the plaintext protocols.
Fixed file descriptor leak of /dev/tty on doas(1) auth failure.
Added realpath(1), a wrapper for realpath(3) for use in ports.
Enabled enforcing of RLIMIT_MEMLOCK on powerpc64.
Reverted to use iwm(4) firmware v17 on Intel AC 7265, fixing instability issues on X1 Carbon gen3.
Cached the old BSSID when roaming with iwx(4).
Explicitly stopped iwx(4) Rx block ack when roaming between access points.
Added support for 802.11n 40MHz channels to the iwm(4) driver.
Added monitoring of 20/40MHz channel width changes in beacons sent by our access point, notifying drivers when the channel width has changed.
Added support for 40MHz channels to net80211 RA.
Fixed establishing legacy INTx interrupts on machines without a (usable) MSI interrupt controller.
Merged bugfixes from upstream into less(1) including fixes for the prompt hiding feature (CTRL-P) and an integer overflow.
Cached the old BSSID when roaming with iwm(4) so firmware commands can continue using it while roaming to a new AP.
Stopped pkg_add(1) from communicating warnings starting with "XXX" which appeared to indicate errors.
Ensured iwm(4) uses only the HT (high throughput) frame format for data frames.
Allowed AUTH->AUTH state transitions in the iwm(4) and iwx(4) drivers again, needed if the access point uses band-steering.
Removed the ifconfig(8) autoconfprivacy deprecation warning.
Retired the Loongson platform.
Fixed iwm(4) performance drop after roaming between APs in 11n mode.
Applied a workaround in mvkpcie(4) to fix an external abort under load with athn(4).
Added relicensed wireless firmwares from Realtek for rsu(4), rtwn(4) and urtwn(4) devices, allowing these devices to work without requiring a separate firmware download.
Added a workaround for buggy athn(4) devices to prevent filling up the node cache when used in hostap mode.
Made redistributable firmwares available across all architectures.
Fixed memory leak in fuse(4) when calling namei(9).
Fixed a panic when iwx(4) cannot find firmware at boot time.
Released LibreSSL 3.3.5 and 3.2.7.
Enabled X509_V_FLAG_TRUSTED_FIRST by default in the legacy verifier.
Deleted expired DST Root CA X3.
Prevented iwm(4) and iwx(4) attempts to transition toward the same state where this would result in a redundant or illegal state transition and a potential hang.
Removed the constraint that fdisk(8) -b specified block count or block size must be greater than 63.
Added support to pchgpio(4) for Cannon Lake H and Tiger Lake H platforms.
Fixed a crash in tmux(1) when a session with multiple clients is destroyed but tmux does not close completely due to other sessions.
Introduced gpiocharger(4), a driver providing support for battery chargers connected to GPIO pins, such as those found on the Pinebook Pro.
Introduced gpioleds(4) for arm64, a driver providing support for LEDs connected to GPIO pins, such as those found on the Pinebook Pro.
Reset the Tx timer upon validation of a BA notification sent by iwx(4) and iwm(4) firmware.
Added support to umb(4) for SIMCom SIM7600.
Released rpki-client 7.3.
Removed wpath from less(1) secure mode pledge.
Added iwx(4) Tx aggregation support.
Added an ADDBA_OFFLOAD capability for wifi devices to manage Tx block ack sessions entirely in firmware.
Released OpenBGPD 7.2.
Cleared length of keys in vnconfig(8) alongside keys themselves.
--------
Changes made between OpenBSD 6.9 and 7.0
Released OpenSSH 8.8.
Corrected sshd(8) initialization of supplemental groups when executing an AuthorizedKeysCommand or AuthorizedPrincipalsCommand helper program (not enabled by default) as a different user.
Updated timezone information to remove DST for Samoa.
Avoided a potential overread in x509_constraints_parse_mailbox().
Fixed a memory leak in rpki-client(8).
Adjusted bgpctl(8) RIB_GENERIC_ADDPATH MRT message handling to work with other MRT implementations.
Added a workaround to amdgpu(4) for machines where the framebuffer size reported by the hardware is incorrect.
Prevented ucc(4) keyboards from changing the wsmux(4) keyboard layout.
Moved objcopy to base set to allow KARL to work on all installs.
Fixed pchgpio(4) issues with dead touchpads after resume.
Moved to OpenBGPD 7.2(8).
Prevented strlcpy(3) from reading too much in btrace(8).
Allowed xenodm(1) login when ~./Xauthority does not exist.
Fixed disklabel(8) generation on sparc64.
Silently ignored invalid requests to change the encoding of a ucc(4) keyboard.
Changed dhcpleased(8) client identifier transmission to match other dhcp client implementations.
Fixed the ssh(1) "Allocated port" debug message for unix sockets.
Switched scp(1) back to using the original scp/rcp protocol by default for release.
Unlocked the top part of the VM fault handler on i386.
In pchgpio(4), worked around a BIOS bug on Lenovo Thinkpads based on Intel's Tiger Lake platform to properly restore the GPIO pin used for the touchpad interrupt upon resume.
Zeroed out potential passwords when freeing memory or handling parsing errors in iked(8).
Fixed acme-client(1) SAN generation for CSRs.
Implemented flushing for TLSv1.3 handshakes.
Made scp(1) SFTP mode (including error logging) more scp-like.
Prevented a crash on strict alignment architectures of tcpdump(8) WireGuard printer.
Set the rpki-client(8) X.509 validation depth limit to 12 or double the current depth.
Simplified dhcpleasectl(8) and added syntax to match dhclient(8) (interface), allowing one to be aliased to the other.
Allowed CanonicalPermittedCNAMEs=none in ssh_config(5).
Made pmap_extract() mpsafe on hppa and amd64.
Limited rpki-client(8) to 300 deltas to sync an RRDP repository rather than fetching a snapshot.
Put back the mux_ctx memleak fix for SSH_CHANNEL_MUX_CLIENT in ssh(1).
Enabled cy(4) on amd64.
Retried broadcast with dhcpleased(8) when the dhcp server is unreachable via unicast UDP.
Added a theoretical limit of 512 to the number of allocated vcpus in vmm(4).
Introduced /etc/bsd.re-config(5), which can be used to configure the kernel using config(8), allowing use of KARL while making changes to the GENERIC kernel.
Checked the installer's /tmp/i/hostname.* files for a configured IP address so that configurations without a broadcast address are detected as well.
Defaulted to using named curve parameter encoding in libcrypto.
Identified TPM2.0 devices and performed the 2.0-specific "suspend" command, allowing the lenovo xlr9 and xlnano using the latest BIOS (which added S3) to resume.
Stopped setting the highspeed bit on bcm2835-sdhci sdhc(4) controllers, fixing bwfm(4) wifi on the Raspberry Pi 3 Model B+.
Zeroed out iwx(4) Tx descriptors of frames which are done to prevent the device from writing to the former DMA address of a buffer which has been taken off the Tx ring.
Fixed a bug in iwx(4) Tx done interrupt processing which could cause fatal firmware errors under load and memory corruption.
Stopped ignoring SIGINT in sftp(1) while waiting for input if editline(3) is not used.
Imported Mesa 21.1.8.
Altered scp(1) to use the SFTP protocol by default. The original scp/rcp protocol remains available via the -O flag.
Changed iwm(4) and iwx(4) to sleep for 1 second while loading firmware to match what iwn(4) does. This fixes some issues with suspend/resume.
Modified doas(1) to retry up to 3 times on password authentication failure.
Fixed vmm(4) vcpu locking issues.
Added the uaq(4) driver for Aquantia AQC111U/AQC112U USB ethernet devices.
Added kprobes provider for dt(4).
Ensured that iwm(4) and iwx(4) will reload firmware from disk on down/up and not during resume.
Made traceroute(8) faster by sending probes and doing DNS lookups asynchronously.
Add add-path support in MRT dumps (RFC8050) to bgpd(8).
Disabled building all of the non-unicode fonts except for ISO8859-1.
Fixed iwx(4) crystal latency values to match those used by Linux iwlwifi.
Altered slowcgi(8) so it no longer sends debug logging to syslog unless debug logging is requested via the new -v flag.
Made all vi(1) signal handler functions async-signal-safe.
Deleted mention of the X11 README file from root.mail since it is no longer installed.
Added the aq(4) driver to support Aquantia 1/2.5/5/10Gb/s PCIe ethernet adapters.
Added unveil(2) calls to xterm in the case where there are no exec-formatted or exec-selected resources set.
Added the ability for snmpd(8) to send SNMPv3 traps.
Changed diff(1) to consider two files sharing the same inode identical.
Imported timeout(1) utility from NetBSD. timeout(1) can be used to run commands with a time limit.
Added client-side support for DNS configuration to iked(8).
Removed from0 support from openrsync(1).
Made rc(8) quietly attempt an early mount of /var/log in case someone has created it to avoid /var overflow issues.
Added http_proxy support to rpki-client(8) http handler.
Added aplpinctrl(4) driver for the Apple GPIO controller found on the M1 SoCs.
Changed the printing of the hibernate image size from bytes to megabytes.
Added "machine sysregs" command to ddb(4) on amd64.
Added support for obtaining sense status and source slot of a media to chio(1) and ch(4).
Added include and exclude options to rsync(1) usage message.
Made resolvd(8) accept dns proposals for the loopback addresses.
Implemented < and > operators in btrace(8) filters.
Changed usage of %n from a syslog warning to syslog and abort for printf(3) (and associated variants).
Increased hibernate writeout speed.
Disabled the RSA/SHA-1 signature algorithm by default in ssh(1).
Implemented -naccept in the s_server option of openssl(1).
Implemented reporting of supplemental groups in ps(1).
Changed traceroute(8) wait time to default to 3 seconds and allow setting of wait time as low as one second.
Altered passwd(1) to use stderr for printer error and informational messages. This allows easier parsing of what passwd(1) is doing if spawned from a GUI.
Fixed a crash with i915 graphics by removing bogus Linux code that tried to deal with something that is impossible on OpenBSD.
Fixed dwiic(4) timeouts requesting data from at least one touchpad.
Fixed automatic upgrade after fetching response file with dhcp.
Released LibreSSL 3.3.4.
Switched macppc to use ld.lld.1(1).
Added ucc(4), a driver for USB HID Consumer Control keyboards.
Fix crash in mandoc(1) when a manpath directory contained a symbolic link that pointed to a directory.
Implemented reception of "VLAN 0 priority tagged" packets.
Fixed an off-by-one error in bwfm(4).
Changed iwn(4), iwm(4), and iwx(4) devices to hide detailed firmware error reports by default.
Added veb(4) to the list of pseudo devices that ifconfig(8) can create.
Imported initial support for the SM2 cipher into LibreSSL.
Added the signify keys for 7.1 base sets, packages, and firmware.
Moved to 7.0-beta.
Set the uhidpp(4) battery level sensor status to unknown while charging to handle devices reporting zero during charge, preventing certain sensorsd.conf(5) actions from triggering inappropriately.
Fixed iostat(8) per-device values when systat(1) is in boot time mode ('b'), not normalizing based on the sleep interval.
Made jot(1) -b, -c and -w mutually exclusive.
Made cdio(1) discard the current input line when Ctrl-C is used during line editing and provide a fresh prompt rather than exiting the program.
Updated unbound(8) to 1.13.2.
Added a -B flag to tmux(1) to remove borders from popups and added a menu to popups as well as options to convert a popup into a pane.
Added to dhcpleased.conf(5) the ability to ignore routes or nameservers from a lease and to ignore servers entirely.
Prevented a loop when bwfm(4) receives an unsolicited association status event right after successful association.
Added pipe variants of the tmux(1) line copy commands.
Changed the default snmp(1) version to -v3 and removed the default community.
Made amd64 hw.setperf percentages proportional to the enhanced speed step frequencies on Intel processors. The default hw.setperf=99 corresponds to the maximum ordinary speed, and setting it to 100 enables turbo mode.
Ensured some programs (including sftp(1)) do not ignore Ctrl-C when awaiting user input.
Added support for two-character font names (BI, CW, CR, CB, CI) to the tbl(7) layout font modifier.
Added Tiger Lake LP (INT34C5) support to pchgpio(4).
Updated nsd(8) to 4.3.7.
Allowed "any" to be used as a listen on address in snmpd.conf(5).
Fixed Encode(3p) loading module from an incorrect relative path.
Added scp(1) -O and temporary -s (SFTP) flags to select the sftp protocol.
Made scp(1) -3 the default for remote-to-remote copies.
Improved handling of ~ prefixed paths in scp(1) in SFTP mode.
Allowed setting of the engineid in snmpd(8).
Updated libXaw to 1.0.14.
Updated xrdb(1) to 1.2.1.
Handled "inet autoconf" in the ramdisk.
Fixed a panic at shutdown relating to azalia(4) on the X1 Extreme Gen 1.
Implemented reception of multiple paths per BGP session in bgpd.conf(5) and made it possible to match on path-id in bgpctl(8) show rib outputs.
Switched default snmpd(8) and snmp(1) auth back to hmac-sha1.
Fixed a panic reported in upd(4).
Cleaned up the fdisk(8) MBR/GPT initialization code, making -g independent of -i, leaving four mutually exclusive initialization options (-i, -b, -u and -A) with the last option specified executed (allowing the existing -i -g to work as intended).
Added basic support for zero width joiners to tmux(1).
Added client focus hooks to tmux(1).
Fixed ure(4) after a media link change on RTL8153/B devices.
Fixed a leak with wg(4) keepalive.
Added a new "nameserver" command to route(8), sending nameserver proposals to resolvd(8) using the dns proposal protocol over the route socket.
Increased iked(8) default data bytes limit for Child SAs to 4 GB, preventing excessive rekeying and lost data in high performance setups.
Updated xf86-video-amdgpu to 21.0.0.
Prevented a kernel panic in sparc64 due to page boundary misalignment.
Added experimental support for using the SFTP protocol for file transfers in scp(1).
Enabled riscv64 multiprocessor support.
Ensured rkpwm(4) can find the clock when using a recent device tree.
Fixed incorrect status code for expired mails resulting in a misleading bounce report in smtpd(8).
Left resolv.conf(5) to resolvd(8) rather than recreating after finding nameservers.
Fixed display of incorrect patterns on LUNA's wscons(4) with 1bpp framebuffer when backspace is typed.
Switched iwx(4) to -63 firmware images as shipped in iwx-firmware-20210512, including fixes addressing fragattacks vulnerabilities.
Supported the new iwx(4) firmware session protection command, required for successful associations with new firmware.
Allowed cad(4) recognition as boot interface when using netboot, making autoinstall/upgrade work.
Released rpki-client(8) 7.2.
Fixed suspend/resume of machines with certain radeondrm(4) hardware.
Added RK3399 Type-C PHY clocks and PCIe PHY reference clocks to rkclock(4).
Delayed installation of sensors until a device with battery support is connected, allowing sensorsd(8) to pick up hotplugged uhidpp(4) devices.
Made window-linked and window-unlinked window options in tmux(1).
Corrected awk(1) -F null string behavior to ensure -F '' behaves consistently with -v FS="".
Made dhclient(8) defer to dhcpleased(8) when the inet autoconf flag is set. When run, dhclient will signal dhcpleased to request a new lease rather than requesting one itself.
Fixed an attachment problem for dwctwo(4) for certain devices issuing NAK interrupts during split transactions.
Fixed potential races in slaacd(8) and dhcpleased(8) when two processes are configuring the same IP.
Ensured MRT dumps containing add-path information will be dumped properly by bgpctl(8) (RFC 8050).
Implemented Extended Optional Parameters Length for BGP OPEN Message (RFC 9072) in bgpd(8), allowing sending of more than 255 bytes of optional parameters.
Passed make flags to kernel and lib builds, making hacking on ramdisks/the installer much faster.
Fixed an mbuf leak in xnf(4).
Added the possibility to send vendor class identifier and client identifier using dhcpleased.conf(5).
Updated pixman to 0.40.0.
Forced luna88k to use the serial console when no graphics board is found.
Enabled LEDs for the mue(4) LAN7800 chip as found on the Raspberry Pi 3 Model B+.
Enabled iwm(4) and ix(4) on riscv64.
Added riscv64 userland timecounter support.
Fixed strchr() and strrchr() on mips64.
Added a ForkAfterAuthentication directive to ssh_config(5), equivalent to ssh(1) -f.
Added a StdinNull directive to ssh_config(5) to prevent reading from stdin, equivalent to ssh(1) -n.
Let allowed signers files used by ssh-keygen(1) signatures support key lifetimes and verification mode to specify a signature time at which to check.
Fixed ix(4) with older amd64 and current riscv64 hardware if MSI is not enabled for the device.
Synced dwctwo(4) with the NetBSD-current code base, enabling the USB on-board ethernet controller through mue(4) and enabling the two USB uhub3 ports on the Raspberry Pi 3 Model B+.
Made dhcpleased(8) always configure provided routes, regardless of whether the address received in the lease is already configured.
Made slaacd(8) send rDNS proposals on ramdisks, allowing resolvd(8) to learn nameservers and update /etc/resolv.conf with IPv6 resolvers.
Updated Mesa to 21.1.5.
Introduced a short wait in rc(8) after netstart(8) finishes until an IPv4 or IPv6 default route is present before continuing boot. Fixed setups depending on working network and DNS resolution during early boot when using autoconfiguration (dhcpleased(8) or slaacd(8)).
Added AMD 17h/6xh Root Complex to ksmn(4).
Used exclusive locks under /dev/ to ensure single instances of resolvd(8), slaacd(8) and dhcpleased(8).
Added installboot(8) "-p" to prepare by creating a new filesystem on the partition reserved for the bootloader on relevant architectures.
Fixed an alignment fault observed on an octeon machine while pppoe(4) negotiated a large MTU.
Fixed races which were slowing ipsec(4) throughput.
Stopped asking iwx(4) to send probe requests on passive channels, fixing firmware going unresponsive after association.
Fixed an iwx(4) edge case where devices failed to resume after system suspend.
Supported auto-tagging for ".It Va" in mandoc(1).
Switched to dhcpleased(8) / resolvd(8) in base.
Prevented a kernel panic after VFS shutdown.
Added a SessionType directive to ssh_config(5), equivalent to the -N (no session) and -s (subsystem) command line flags.
Ensured the TX FIFO isn't overrun for longer transfers in dwiic(4).
Added uaudio(4) and umidi(4) to riscv64.
Corrected various min/max cluster numbers for FAT12/16/32 in newfs_msdos(8).
Fixed a read buffer overrun in X509_CERT_AUX_print(3).
Switched iwm(4) to newer firmware images available in iwm-firmware-20210512. This provides FragAttacks fixes for the updated devices.
Avoided a potential buffer overflow in backslash escaping in awk(1).
Reverted drm_mm to the 5.7.y version to prevent X startup failures on laptops with raven ridge and picasso apus using amdgpu.
Updated drm(4) to linux 5.10.47.
Fixed iwx(4) against access points using TKIP as the group cipher.
Introduced CPU_IS_RUNNING() and used it in scheduler-related code to prevent waiting on non-running CPUs.
Disallowed the use of an empty list between "while" and "do" in ksh(1).
Updated libdrm to 2.4.107.
Allowed spaces to appear in usernames for scp(1) local to remote and scp -3 remote to remote copies.
Displayed provider ID for a umb(4) SIM in ifconfig(8).
Fixed a crash in mandoc(1) when an input file contains tbl(7) or eqn(7) input unsupported by -T man(1) output mode.
Updated libz to zlib 1.2.11.
Prevented athn(4) from calling ieee80211_find_rxnode() on bad frames in an attempt to prevent creation of bogus node cache entries.
Implemented various fixes addressing firmware errors in iwm(4) and iwx(4).
Added SMP support to risc64.
Defaulted to attempting RRDP first in rpki-client(8) -r.
Added rktcphy(4), a driver for the Type-C PHY controller found on the Rockchip RK3399.
Expanded info callback support for TLSv1.3.
Made tcpdump(8) split the 802.11 sequence number field into its sequence number and fragment number components rather than printing the whole field in decimal.
Made anonymous object reference counting independent from the KERNEL_LOCK().
Enabled dt(4) on sparc64.
Added btrace(8) display of time spent in userland when analyzing the kernel stack in the flame graph tool and fixed a parsing bug.
Implemented 64-bit DMA mode in cad(4).
Added riscv64 drm(4) support.
Corrected a potential memory leak associated with pfsync(4) update requests.
Added basic radeondrm/X support for riscv64 and supported xf86-video-radeon and xf86-video-amdgpu drivers.
Allowed (w)hole disk allocation for GPT disks in arm64, using fdisk(8) -A when an Apple APFS ISC partition is detected and fdisk -ig otherwise. Created EFI SYS boot partitions only on ROOTDISK GPT disks.
Added titmp(4), a driver for the TI TMP451 temperature sensor.
Introduced locks around the global pf(4) state list.
Ensured the values for fdisk(8) -b and -l are treated as 512-byte block counts.
Fixed node leaks in iwm(4) and iwx(4) which caused the drivers to get stuck when roaming between access points.
Added vmd(8) support for variable length vionet rx descriptor chains.
Added an fdisk(8) -A option to initialize a GPT without removing special boot partitions.
Removed default communities, changed seclevel default from none to enc and only allowed SNMPv3 by default in snmpd(8). Changed default authentication to SHA-256 and privacy protocol to AES in snmpd(8) and snmp(1).
Made fdisk(8) available to architectures other than amd64 and i386 and extended the syntax to allow specification of the boot partition type and offset.
Stopped attempting to install a default route with route(8) in netstart(8) if using inet autoconf.
Increased the setitimer(2) timer limit to UINT_MAX seconds.
Introduced sfclock(4), a driver for the SiFive Power Reset Clocking Interrupt (PRCI).
Introduced sfcc(4), a driver for the SiFive level two cache controller.
Introduced plic(4), a driver for the RISC-V Platform-Level Interrupt Controller.
Implemented enhanced route refresh (RFC 7313) in bgpd(8).
Added simple BGP enhanced route refresh message decoding to tcpdump(8).
Fixed an iked(8) bug where no flows are added if a single address is configured in the config address instead of a pool.
Added Broadcom BCM5725 to brgphy(4).
Implemented classless static routes dhcp option in dhcpleased(8).
Fixed a panic due to pfsync(4) deferral timeout handling.
Fixed an issue preventing applications from selecting the non-ALTIVEC code path on macppc.
Enabled nvme on riscv64.
Introduced sfuart(4), a driver for the SiFive UART, and added support for it as a console.
Added the ability for fdisk(8) to recognize "HiFive! FSBL" and "HiFive! BBL" GPT partitions.
Enabled dwpcie(4) on riscv64 and added support for the PCIe host bridge found on the SiFive FU740 SoC.
Made fdisk(8) always create an EFI SYS partition if the -b option is specified when initializing a GPT.
Limited the workaround for AMD errata 400 ("APIC Timer Interrupt Does Not Occur in Processor C-States")to family 0fh and 10h.
Serialized the internals of kqueue(2) with a mutex.
Ensured a USB mouse will attach if otherwise qualified even if the usage report does not include X and Y usages.
Prevented interleaved stack traces in ddb(4) from multiple CPUs.
Added -F for tmux(1) command-prompt and used it to fix "Rename" on the window menu.
Added different tmux(1) command histories for different types of prompts.
Fixed tmux(1) problems with xterm in VT340 mode.
Added an "always" value to the extended-keys option to always forward those keys to applications inside tmux(1).
Added the Spleen 12x24 and 16x32 font on amd64's RAMDISK_CD and RAMDISK kernels.
Prevented a hang in sshd(8) when interrupted.
Enabled MSI-X support for powerpc64.
Added libexecinfo, a library providing backtrace functions.
Stopped fatal error in amdgpu(4) on failing to map visible VRAM.
Prevented stack overflow in vmd(8) due to large dhcp packets on local interfaces.
Ensured (W)hole disk partitioning cannot be used if an "APFS ISC" is found on the disk, required for Apple M1 machines to boot.
Used installboot(8) on arm64 ramdisks.
Matched host certificates against host public keys in sshd(8), allowing use of certificates with private keys held in an ssh-agent.
Released OpenBGPD 7.0.
Unlocked connect(2).
Prevented a race condition which could result in sshd(8) not shutting down until the next time it receives a new connection.
Allowed ssh_config(5) SetEnv to override $TERM.
Disabled PPGTT on Intel machines with cherryview/braswell graphics to avoid memory corruption.
Implemented multicast support in mvpp(4).
Adjusted density for partitions on a 4k disk in newfs(8) when fragsize and density are not passed on the command line to ensure sufficient inodes to hold a src tree on a 2G fs.
Relaxed media length checking to allow EFT GPT partitions to be smaller than the full disk.
Added GPT support to armv7 installboot(8).
Added arm64 support for booting from disks with 4k sectors.
Allowed locking of a randomly assigned lladdr in vmd(8).
Enabled pool cache on knote(9) pool.
Unlocked setrtable(2).
Added RTLD_NODELETE support.
Introduced per-CPU panic(9) message buffers.
Prevented crashes on amd64 when TLB entries which should have been invalidated were used.
Fixed iwx(4) firmware reloading after a failure to parse the firmware file.
Attached unsupported video devices to uvideo(4) but not video(1), rather than leaving it unmatched.
Added a -R flag to usbhidctl(1) to dump the raw report descriptor bytes.
Fixed a problem in iked(8) where no flows are loaded when a single config address without pool is configured.
Avoided "mac clock not ready" panics in iwm(4) and iwx(4).
Added hid_get_report_desc_data() to usbhid(3) to access raw report descriptor data.
Fixed overlap check in disklabel(1) autoalloc code.
Added initial arm64 support for installing on a disk with a GPT.
Added an experimental post-quantum hybrid key exchange method based on Streamlined NTRU Prime (coupled with X25519) to iked(8) as sntrup761x25519.
Added cad(4), a driver for Cadence GEM.
Prevented watchdog resets on some i.MX 64-bit machines with a recent U-Boot and watchdog enabled on boot in imxdog(8).
Added aplns(4) to provide support for Apple NVME storage as found in Apple M1 devices.
Relaxed criteria for recognizing GPT formatted media, allowing GPT disk images added with dd(1) onto larger physical media to be recognized by fdisk(8) and the kernel.
Improved bgpd(8) graceful restart capability handling.
Added aplspmi(4), a driver for the Apple SPMI controller.
Added aplpmu(4), a driver for the Apple "sera" SPMI power management unit that contains the RTC on Apple M1 systems.
Updated libexpat to 2.4.1.
Fixed futex(2) errno handling to match what Mesa expects and prevent failure to properly report timeouts.
Used so_lock to protect key management (PF_KEY) sockets.
Added support for pf(4) divert-to on tpmr(4) and veb(4).
Fixed a segmentation violation in ssh(1) in an UpdateHostKezs debug() message when the update removed more host keys than remain present.
Created audio devices for armv7.
Added apldwusb(4), a glue driver for the Synopsys DesignWare USB 3 controllers found on the Apple M1 SoC.
Added apldart(4) support for a DART with two sets of registers, needed to support the Synopsis DesignWare USB 3 controller.
Skipped inspecting non-udp packets on local interfaces for vmd(8).
Added TLS options cafile=(path), nosni, noverify and servername=(name) to smtp(1).
Fixed overflows when reading multiple bytes from AML over an i2c bus in acpi(4).
Allowed specification of TLS ciphers and protocols in smtp(1).
Added a meta viewport element to the HTML output for mandoc(1) -Thtml.
Fixed __ppc_lock for page faults that recursively grab the lock on powerpc.
Added PCI support to riscv64.
Increased the maximum data size on powerpc64 to 32GB.
Fixed a kernel crash in tty(4).
Disabled global page table mappings when using PCID to prevent crashes when not flushed from TLB.
Fixed ssh(1) to restore file descriptors to non-blocking mode on exit.
Prevented guest virtio drivers from causing stack and buffer overflows in vmd(8).
Fixed uaudio(4) on certain machines such as the RPI4 by adding a pre-DMA-write barrier after data is stored to memory.
Dropped fragmented 802.11 frames.
Fixed a race condition in vmm(4) relating to incorrect physical cpu tracking.
Fixed state key reference underflow when both state keys are identical in pf(4).
Made additional free inodes on luna88k bsd.rd by specifying density=4096.
Increased the default buffer space on PF_UNIX sockets to 8k and made the values tuneable via sysctl(2).
Limited the number of concurrent RTR connects to 32 in bgpd(8).
Prevented httpd(8) from trying to chunk encode an empty http body coming from an fcgi upstream.
Prevented frame injection via forged 802.11n A-MSDUs.
Updated en_US.UTF-8.src to Unicode 13.0.
Implemented the tbl(7) layout modifiers "b" (bold) and "i" (italic) in mandoc(1) HTML output mode.
Added pledge(8) for ftpd(8) user processes.
Fixed IPsec(4) NAT-T to work with pipex(4).
Fixed ssh(1) started with ControlPersist incorrectly executing a shell when the -N option was specified.
Allowed router solicitations from the unspecified address (::) in rad(8).
Updated libexpat to 2.3.0.
Worked around x86 machines that advertise the "hardware reduced" ACPI feature, advertise S4 and S5 support, but fail to populate the SLEEP_CONTROL_REG and SLEEP_STATUS_REG descriptions in the FADT. This fixed the ASUS Zenbook 14.
Limited the printf(1) \x escape sequence to two characters.
Added support for RTL8168FP/RTL8111FP/RTL8117 to re(4).
Added an 'expires' column to CSV & JSON output of rpki-client(8).
Unlocked lseek(2).
Unlocked the top part of the fault handler.
Fixed hangs on riskv64 by replacing timer(4) with code based on the powerpc64 implementation of the randomized statclock code.
Added support to binutils for riscv64.
Prevented base pkg tools from looking under /usr/local in general.
Tweaked net80211 RA heuristics to avoid picking Tx rate choices that may be too optimistic.
Added 802.11n Tx aggregation support to iwm(4).
Worked around a problem with certain athn(4) hardware that caused problem when running in HostAP mode with clients that use Tx aggregation.
Disabled base-gcc on amd64.
Retired OpenBSD/sgi platform.
Changed int_TS_RESP_verify_token to avoid a double free.
Made kernel stop all threads when terminating via pledge_fail().
Made iwn(4), iwm(4) and iwx(4) keep track of beacon parameters at run-time.
Used relative reference URIs in Location header on directory redirects in httpd(8), adding support for front-ending httpd with a TLS-terminating gateway that forwards unencrypted http traffic.
Imported libc++ and libc++abi 11.1.0 releases.
Imported LLVM 11.1.0 release including clang, lld, and lldb.
Enabled dt(4) for GENERIC kernels on amd64, arm64, i386, and powerpc64.
Fixed vmctl(8) client "wait" state corruption in vmd(8) when a wait is canceled and restarted, allowing multiple waiting clients.
Implemented support for Rx aggregation offload in iwm(4) and iwx(4) and re-enabled de-aggregation of A-MSDUs in net80211 for all drivers capable of 11n mode.
Fixed an issue on machines where the EFI memory map has more than 64 entries.
Added gfrtc(4), a driver for the real-time clock interface of Google's Goldfish Android virtual hardware platform, used for the RTC on qemu-system-riscv64 -M virt.
Only skipped pf(4) once for packets injected by a divert-packet socket, allowing pf to still act later on a diverted packet.
Imported initial OpenBSD/riscv64 port.
Changed error reporting for bwfm(4) to use the long version of the firmware path. This makes it easier to find the correct files to add to the bwfm-firmware port.
Added protections against guests with bad virtio drivers to vmd(8)
Made kqueue(2) timer re-addition reset an existing timer to use the new timeout period.
Changed cwm(1) maximization and full-screen mode toggling to keep the cursor within the window, preventing focus loss.
Cleaned up TLS v1.2 certificate request handshake data. This fixed a bug where decoding was broken when the number of certificate types exceeded SSL3_CT_NUMBER.
Fixed __builtin_bitreverse32 on 32-bit powerpc, needed to build clang-11.
Added indication of whether an mg(1) function is unsuitable for a startup file.
Added keep-alive support to the rpki-client(8) HTTP module.
Added "dired-jump" command to mg(1) to open a dired buffer containing the current buffer's directory location.
Enabled all Thinkpad X1 Extreme 1 speakers and atmos dolby in azalia(4).
Corrected multicast decryption for iwx(4).
Moved to 6.9-current.
--------
Changes made between OpenBSD 6.8 and 6.9
Provided U-Boot binaries that work on Raspberry Pi 3 and 4 and firmware for Raspberry Pi 4, allowing use of the same installation method as for 3 without separate UEFI firmware.
Released LibreSSL 3.3.2.
Implemented a control message to get the state of iscsid(8) and slowed iscsictl(8) loading to prevent mount errors during startup.
Returned to 6.8 behavior of sending two direct ACKs upon receipt of a data segment.
Ensured WEP and plaintext interface link state update by iwi(4)
Switched athn(4) 802.11n Tx rate adaptation from MiRA to RA.
Fixed a problem where athn(4) devices would use a different channel than the one selected by net80211.
Implemented version 2 of virtio(4) at fdt, as used by Parallels on the Apple M1, allowing use of OpenBSD as VM.
Fixed incorrect parsing of bgpd(8) config files due to endianess.
Switched back to the legacy X.509 verifier for release.
Fixed bgpctl(8) show mrt for UPDATE messages.
Fixed tcpdump(8) parsing of wg(4) packets on powerpc64.
Made iwx(4) attach to AX201 devices with PCI ID 0x06f0.
Ignored expandtab setting when in vi(1) command mode.
Prevented inappropriate privilege elevations with X server XInput input validation failure.
Created install*.img files for arm64, sparc64 and octeon.
Allowed mixing of TLS and non-TLS configuration parameters within httpd(8).
Allowed specification of TLS ciphers and protocols within smtpd.conf(5).
Fixed dhcpleased(8) handling of invalid T1 or T2 responses.
Fixed an iked(8) bug where host routes were deleted upon IKE SA rekey.
Stopped requesting unused "classless-static-routes" dhcp-options(5), which resulted in dhcpleased(8) failing to install a default route.
Introduced graphaudio(4), a driver to support linking together audio components based on the audio graph description.
Added support to rkclock(4) for the fractional dividers for the i2s clocks, fixing audio on the Pinebook Pro.
Made apm(8) report apmd(8) failures.
Updated nsd(8) to 4.3.6.
Fixed an rpki-client(8) hang after hash check failure.
Ensured printing of all mount(2) flags in ddb(4) "show all mounts".
Added a flag to prevent attachment of certain video devices not currently supported by uvideo(4), such as the Chicony Integrated IR Camera.
Improved vmm(4) exit handling for AMD SVM and Intel VMX, fixing a potential boot loop on AMD hosts.
Added vmd(8) support for booting from compressed kernel images.
Added support to ugold(4) for TEMPerGold and additional TEMPerHUM devices.
Excluded the first page and added a guard page between I/O virtual address space allocations on arm64.
Included the default cert.pem file path in tls_load_file error messages in rpki-client(8).
Implemented ZONEMD (RFC 8976) in dig(1) to convey a message digest of the content of a DNS zone.
Updated nsd(8) to 4.3.6rc1.
Changed tmux(1) search-again with vi keys to work like vi(1).
Added RRDP (The RPKI Repository Delta Protocol, RFC 8182) support to rpki-client(8).
Added the rsync(1) option --no-motd to suppress the information output by the client at the start of a daemon transfer.
Allowed smtpd.conf(5) specification of tls protocols and ciphers on relay actions.
Propagated host-side tap(4) lladdr to guest vm process to allow unicast dhcp and bootp renewals with vmd(8)'s built-in dhcp server.
Cleaned up events on vmd(8) pause or resume and fixed an issue leading to broken serial console by cleanly tearing down and restoring emulated device state on vm send/receive.
Ignored WSMOUSEIO_GTYPE ioctl failure when checking /dev/wsmouse to ensure a driver is loaded to listen if a USB mouse is later plugged in.
Added vid/pid table to umb(4) allowing matching to alternate configurations.
Ensured WEP and plaintext interface link state update by ipw(4).
Finished conversion of dhclient(8) timers to allow monotonic accounting for the active lease.
Added ARMv8-5 instruction set related CPU features to arm64.
Updated to xf86-video-r128 6.12.0.
Inverted the mg(1) "R" indicator to mean that a "*" next to a file's name indicates that it is read-only. Made the active buffer indicator more visible by changing it to ">".
Permitted kern.somaxconn when the unix pledge(2) is used, allowing Go programs to use "unix" without also including "inet".
Provided apm(4/arm64) with battery information.
Prevented an amd64 kernel crash with protection fault due to an invalid offset when reading /dev/kmem.
Made wscons(4) touchpad tap detection less restrictive for multi-finger taps and improved tap detection.
Defined a USB quirk for ums(4) and umt(4) devices needing to keep their pipes open at all times.
Fixed an iked(8) interop problem with strongswan if make-before-break is enabled.
Made vmctl(8) properly indicate VMs are stopped instead of "running" with "vmctl status".
Updated device-tree bindings for cwfg(4) to correct attaching and account for monitoring interval change, making cwfg(4) export values under hw.sensors as expected when using a Pinebook Pro.
Fixed a race between tx/rx handshakes in wg(4).
Added mg(1) quoted strings capability in list values and limitation to characters allowed in symbol names.
Made it possible to disable the "autoconf" flag but keep "temporary" enabled in ifconfig(8).
Added btrace(8) -n (no action) mode, which parses the program and then exits.
Added a "batch" mode to mg(1) via the "-b" command line option which will initialize a pty, run the specified file of mg commands and then exit.
Added rpki-client(8) -V option to show version.
Removed vmd(8) booting from kernels in raw/qcow2 images.
Unlocked sendsyslog(2).
Made ifconfig(8) "-mplslabel" work with mpw(4).
Enabled DTLSv1.2.
Made iwx(4) attach to AX201 devices with PCI ID 0x34f0. Needs fw_update(1).
Fixed a problem where iwn(4) firmware would generate bogus block ack requests and stall traffic.
Used the correct rdomain when adding and deleting routes with mpip(4) and mpw(4).
Released LibreSSL 3.2.5.
Fixed efiboot on some machines from CD-ROM due to unaligned pointers.
Added client-detached notification in tmux(1) control mode.
Stopped deleting control socket upon apmd(8) exit, preventing accounting of unveil(2) violations when stopping normally.
Skipped xenodm(1) IPv6 link local addresses for TCP listener authorizations, matching what is done by startx(1).
Added wsfb(4) support for 30-bit color.
Stopped xenodm(1) from adding authorizations for TCP connections by default and added "listenTCP" to explicitly add authorizations for existing IP addresses on startup.
Made ftp(1) set timestamps only on files.
Removed the 30s minimum delay for xlock(1) timeouts.
Updated unbound(8) to 1.13.1.
Prevented a WPA failure in ipw(4) due to a state mismatch between firmware and net80211 during the association sequence.
Added a deprecation warning for autoconfprivacy to ifconfig(8).
Implemented RA in iwm(4) and iwn(4).
Introduced RA, a new 11nm Tx rate adaptation module for net80211. Unlike MiRa, RA does not attempt to precisely measure actual throughput but simply deducts a loss percentage from the theoretical throughput which can be achieved by a given MCS.
Updated Spleen kernel fonts to version 1.9.0.
Emulated "[inet] autoconf" hostname.if(5) lines with "dhcp" so users testing dhcpleased(8) will still be able to upgrade manually while the installer uses only dhclient(8).
Changed ifconfig(8) to adjust terminology to reflect "temporary address extensions" rather than the former "privacy extensions," including the addition of an AUTOCONF6TEMP flag (to replace the negative flag "INET6_NOPRIVACY").
Used unveil(2) for apmd(8).
Forced the interface up when AUTOCONF4 or AUTOCONF flags are enabled.
Added SMP support to arm64.
Added a tmux(1) "absolute-centre" alignment to use the center of the total space instead of the available space.
Added tmux(1) split-window -Z to start the pane zoomed.
Fixed ksh(1) redrawing of a multiline PS1 prompt in vi mode and added support for ^R (redraw) in insert mode.
Requested client certificate only when required in smtpd(8).
Increased the maximum length for CHAP challenges to 96 octets to ensure npppd(8) can handle longer challenges, such as those sent by Juniper.
Prevented a potential hang when trying to remove a tun(4) interface.
Recognized Apple Firestorm cores on arm64.
Added support for 30-bit color modes to simplefb(4).
Prevented disklabel(8) from adjusting the swap 'b' partition size if physmem is zero to keep the auto-allocate code from putting a filesystem on that partition.
Enabled ixl(4) on arm64.
Added support for sdhc(4) on the Raspberry Pi in ACPI mode.
Added support for rk809 to rkpmic(4), as seen on the Rock Pi N10 with the rk3399pro.
Removed workaround permitting Go executables to do syscalls directly, forcing them to use shared libc like all other dynamic binaries.
Completed slaacd(8) implementation of RFC 8981 temporary address extensions.
Introduced an IOVA allocator to smmu(4).
Added an initial attempt to support 8-bit ASIDs such as those on Apple's M1 SoC.
Updated clock interrupt count atomically on mips64.
Fixed a problem which prevented use of sysupgrade(8) when an interface failed to come up and dhclient(8) didn't notice link-timeout expiration.
Released OpenSSH 8.5.
Added a configurable button mapping for tap gestures on touchpads to wsconsctl(8).
Fixed visibility of sndioctl(1) output when used through a pipe.
Separated reading of general and touchpad-specific wsmouse(4) settings and corrected identification of device type when reading touchpad parameters fails.
Added the ability to define single value variables in the mg(1) startup file and use them with find-file.
Removed tmux(1) support for popups where the content is provided directly to tmux.
Introduced bgpd(8) rde evaluate all to work around path hiding in IXP route-server environments.
Allowed mixing of alternative devices (-F) with different capabilities in sndiod(8) by treating any device as full-duplex.
Updated perl(1) to 5.32.1.
Added support for PCIe on the NanoPi R4S to rkpcie(4).
Added smmu(4), a driver for the ARM System MMU.
Added acpiiort(4), a driver for the ACPI I/O Remapping Table.
Added apldart(4), a driver for the IOMMU on Apple M1 SoCs.
Added logger(1) support to rcctl(8), rc.subr(8) and rc.d(8) for daemons logging to stdout/stderr.
Increased RX buffers available to the bwfm(4) chip to 256, allowing use of the Apple M1's wifi.
Introduced dhcpleased(8), a dhcp daemon to acquire IPv4 address leases from servers.
Added aplpcie(4), a driver for the PCIe host bridge on Apple M1 SoCs.
Added support for version 7 of the bwfm(4) PCIe interface.
Prevented nvme(4) attachment to devices with size zero.
Added resolvd(8), a daemon to rewrite resolv.conf(5).
Cleared interrupts on luna88k processors more efficiently at boot time.
Allowed specification of a path to the mg(1) startup file on the command line.
Added support for adding and deleting mac addr entries on nvgre(4).
Added support for adding and deleting address table entries to bpe(4), veb(4) and etherbridge.
Added aplintc(4), a driver for the interrupt controller found on Apple M1 SoCs.
Introduced veb(4), a Virtual Ethernet Bridge driver.
Added apldog(4), a driver for the watchdog on Apple M1 SoCs, allowing reboot of the machine.
When cutting off the head of an overlapping fragment during pf(4) reassembly, reinserted the fragment into the lookup table with the correct index.
Added cryptox(4), a driver for armv8 cryptographic extensions.
Added ping(8) -g option to provide a visual display of packets received and lost.
Made the libunwind cache thread-safe.
Fixed disestablishing of PCI interrupt handlers on octeon.
Added etherbridge, the internals of a reusable learning bridge interface providing common code reusable for other drivers needing a mac learning bridge.
Added a MONITOR flag to ifaces to indicate they are used only for watching packets which will not be enter the network stack for processing.
Appended .html suffixes to temporary files in mandoc(1) to allow recognition by browsers.
Added exuart(4) support for the UART found on the Apple M1 SoC.
Enabled multiple opens of a video(4) device as described in the V4L2 specification.
Added bgpctl(8) "show rtr" to display basic information about RTR sessions.
Added RTR support to OpenBGPD.
Added PermitRemoteOpen to ssh(1) for remote dynamic forwarding with SOCKS.
Added support for X11 color names and other variations for OSC 10/11 and added OSC 110 and 111 to tmux(1).
Restored rdsetroot(8) -x usage on stripped bsd.rd.
Updated to xterm(1) 366.
Added iked(8) dynamic address configuration for roadwarrior clients, with a new "iface" config option which can be used to specify an interface for the virtual addresses received from the peer.
Synced cert.pem with Mozilla NSS root CAs (except "GeoTrust Global CA").
Created /dev/ drm nodes with the same names as linux to simplify libdrm and negate the need for certain ports patches.
Prevented the kernel from being stuck in an endless recursion during TCP path MTU discovery when pf(4) changes the routing table when sending packets.
Moved UNIX domain sockets out of the kernel lock, using the new "unp_lock" rwlock(9) as solock()'s backend to protect the whole layer.
Enabled build and install of lldb(1).
Added an optional "group none" transform for child SAs in iked(8) to ensure the ability to negotiate optional PFS.
Added a barrier between reading the cqe flags and the command ID to prevent completion of the wrong scsi io for nvme(4) drives.
Removed the maxburst feature from tcp_output.
Corrected raidlevel verification specified by the -c option in bioctl(8).
Added a RAID1C (raid1 + crypto) softraid(4) discipline, encrypting data like the CRYPTO discipline and accepting multiple chunks during creation and assembly like the RAID1 discipline.
Moved to 6.9-beta.
Added the new tmux(1) -S flag to new-window to select the existing window if one with the given name already exists, rather than failing.
Disabled sndiod(8) autovolume by default and set the default volume to 127. Setting "-w on" will replicate the previous behavior of automatically decreasing playback volume when new programs start playing.
Upgraded to OpenSSL 1.1 compatible crypto API in iked(8).
Implemented the nc(1) -D socket debug option in tcpbench(1), allowing analysis of TCP connections.
Introduced uhidpp(4), a driver for Logitech HID++ devices.
Added support for the Netgear ProSecure UTM25 to octeon.
Turned off the direct ACK on every other data segment, saving processing time and improving network performance.
Changed pf_route so pf(4) only runs when packets enter and leave the stack.
Properly implemented "rde med compare strict" in bgpd(8) and ensured that the order of prefixes is always correct.
Introduced ftp(1) support for sending the If-Modified-Since header while fetching over http or https. Switched to using the timestamps from the remote server's Last-Modified header if available when saving local files and introduced the ftp "-u" flag to disable this behavior.
Fixed a crash that could occur in sndiod(8) when a usb device is unplugged.
Fixed path MTU discovery for ESP tunneled in IPv6.
Changed route-to in pf.conf(5) to send packets to IPs instead of interfaces.
Added basic support for BCM4379, found on the Apple M1 SoCs, to bwfm(4).
Completed code cleanup to avoid linker issues by satisfying -fno-common on all architectures.
Made editing GPT in fdisk(8) safer by defaulting offset to the beginning of the largest free space and preventing the creation of overlapping partitions.
Stopped relying on USB devices to correctly present their indices, instead searching for the correct interfaces. This fixes E+ Corp. DAC Audio devices.
Applied unveil(2) to ldapd(8).
Fixed termination assert in kqueue(2) to avoid a panic.
Added support for RSA-PSS PKCS1 signatures to iked(8).
Recognized Apple Icestorm cores on arm64.
Ensured AI_ADDRCONFIG takes routing domain into account when checking for available address families.
Renamed the HostbasedKeyTypes keyword in ssh_config(5) and the HostbasedAcceptedKeyTypes keyword in sshd_config(5) to HostbasedAcceptedAlgorithms.
Disabled logging to syslog(3) for libunbound with unwind(8). Does not prevent logging to stderr with "unwind -d".
Fixed a data toggle out of sync problem for ugen(4) and uhidev(4) devices on xhci(4) controllers. (Reverted 2021-02-15).
Raised the mcx(4) max number of queues/interrupts from 1 to 16.
Introduced the bgpd.conf(5) per neighbor and global config option "reject as-set yes/no" to allow rejection of received UPDATES with AS_SET segments. These rejected prefixes can be viewed with bgpctl(8) "show rib in error".
Fixed wg(4) ioctl to handle multiple wgpeers.
Fixed filtering on kstat(1) unit numbers.
Used stoeplitz to provide a flowid for tcp packets when enabled.
Updated the default system.fvwmrc for fvwm(1).
Implemented DNS64 synthesis in unwind(8).
Prevented memory corruption or improper page access in vmm(4) due to improper TLB flushing for now by wiring the pages used by virtual machines.
Added support for ipmi(4) on PowerNV systems.
Set up ims(4) devices in X11 to behave like touchpads.
Introduced ujoy(4), a restricted subset of uhid(4) for game controllers which uses /dev/ujoy/* device nodes.
Fixed a memory leak in httpd(8).
Removed the snmpd(8) traphandler process.
Renamed the PubkeyAcceptedKeyTypes keyword to PubkeyAcceptedAlgorithms in ssh_config(5) and sshd_config(5).
Added support for INVALID_KE_PAYLOAD in iked(8) CREATE_CHILD_SA exchange.
Printed rewritten addresses in tcpdump(8) logged with pflog(4) for rdr-to, nat-to and af-to rules.
Disabled com(4) on sparc64 for m3000s. Console i/o should fall back to ofw routines.
Implemented intx support in mvkpcie(4).
Enabled athn(4) for arm64.
Introduced locking for amaps and anons, improving build performance.
Fixed the httpd(8) example configuration not to generate errors when running without TLS keys already in place.
Unlocked getppid(2).
Introduced new function if_unit(9), returning a pointer to the interface descriptor corresponding to the unique name.
Added a tmux(1) -N flag to never start the server even if the command would normally do so.
Dumped the max payload size and max read request size in the pcie cap in pcidump(8).
Prevented a panic in some acpi firmware that provided invalid memory regions in their reserved memory region reporting table.
Pledged the doas(1) "-C" code path.
Implemented unwind(8) listening on TCP.
Allowed use of ospfd(8) on interfaces that share the same IP.
Used an 8th order FIR low-pass filter for resampling in sndiod(8) and for aucat(1), removing most of the aliasing noise during resampling.
Created a path MTU host route for IPsec(4) over IPv6.
Updated to xterm(1) 363.
Disabled base-gcc on loongson and octeon.
Added PerSourceMaxStartups and PerSourceNetBlockSize options to sshd(8).
Enabled powerpc support for floating-point exceptions.
Added support for SSL_get_shared_ciphers(3) in TLSv1.3 and fixed to correctly return ciphers shared by the client and the server.
Fixed -s option for cmp(1).
Added "strip" directive to relayd.conf(5).
Fixed a boot-time crash on sparc64 due to mutex use during the message buffer initialization.
Made CheckHostIP default to "no" in ssh_config(5).
Added a "xenodm" login class for xenodm(1) and increased openfiles to 512 to avoid running out of file descriptors with a busy desktop.
Ensured sleep(3) calls nanosleep(2) if seconds is zero, now delegating all decisions about whether or not to yield the CPU.
Allowed a process to open a video(4) device multiple times. Fixes webcam usage with Firefox and BigBlueButton.
Fixed problems which could arise with software such as bacula and icinga when a root certificate was specified as both a trusted and an untrusted certificate.
Began distributing the gzip'd version of bsd.rd on all platforms with boot methods supporting it.
Fixed a use after free in carp(4).
Updated to libc++ and libc++abi 10.0.1.
Added requests for a new certificate without requiring -F when acme-client(1) detects an added or removed SAN in the config file not reflected in the existing certificate on disk.
Updated to compiler-rt 11.0.0.
Used native display resolution 1368x768 for Lynloong all-in-one computers.
Made loongson kernels recognize Lynloong LM9002/9003 and LM9013.
Changed the pool(9) timeouts to use the system uptime instead of ticks.
Handled permanent redirects (RFC 7538) in ftp(1) fetch.
Added kstat(1) to ogx(4).
Updated to xkbcomp(1) 1.4.4.
Updated to xinit(1) 1.4.1.
Updated to xprop(1) 1.2.5.
Updated to xev(1) 1.2.4.
Updated to fonttosfnt(1) 1.2.1.
Added a -C flag to tmux(1) run-shell to use a tmux command rather than a shell command.
Corrected amltemp(4) attachment to allow thermal management despite temperature sensor reading failure on Amlogic SoCs.
Added trace points for malloc(9) and free(9), making them traceabe via dt(4) and btrace(8).
Enabled IPv4 and TCP/UDP checksum offload on transmission in ogx(4).
Renamed smtpd(8) pony process to dispatcher and klondike to crypto.
Set klist lock for pipes.
Added singly-linked tail queue macros from FreeBSD.
Added bgpctl(8) "show sets" to display information about the roa-set, as-sets and prefix-sets loaded into bgpd(8).
Introduced power-saving mode on POWER9 (ISA v3).
Updated to libexpat 2.2.10.
Added support for kern.video.record to sysctl(8).
Introduced kern.video.record for video(4) devices, an analog to the kern.audio.record sysctl(8) parameter for audio(4) devices. By default, kern.video.record will be set to zero and blank all data delivered by drivers attaching to video(4).
Used per-CPU counter for fault and stats counters reached in uvm_fault().
Added support to dwpcie(4) for the PCIe controller found on Amlogic G12A/G12B/SM1 SoCs.
Fixed "any" and "dynamic" keywords for flows in iked(8) and added proper IPv6 support.
Added PCIe support to amlpciephy(4).
Fixed a memory leak in ld.so's malloc.
Added Gemini Lake I2C id to dwiic(4), making the touchpad work on the Teclast F7 Plus laptop.
Corrected accounting of zero length TDs in xhci(4), preventing free TRBs from running out.
Fixed hangs on amd64 bsd.rd due to misreported core clock frequency on newer Intel Comet Lake models.
Added a global "nowake" channel for threads avoiding wakeup(9) to tsleep(9).
Added Wake on LAN support to rge(4).
Added a specific headline to netstat(1) for TCP state and IP protocol.
Prevented a crash due to premature release of resources by the smtpd(8) filter state machine.
Allowed the provision of dhclient(8) options on "dhcp" lines in hostname.if(5) files.
Fixed a memory leak in smtpd(8) resolver.
Introduced a send hold timer in bgpd(8) to detect stalls on the sending side of a TCP connection, acting as a last resort to detect faulty peers.
Fixed ofw regulators that use "active-low" polarity.
Added PCIe clocks to amlclock(4).
Implemented select(2) and pselect(2) on top of kqueue(2). (Reverted 2021-01-08).
Made clang the default compiler on loongson.
Added an ssh_config(5) KnownHostsCommand that allows the client to obtain known_hosts data from a command in addition to the usual files.
Prevented initiation of new additional SAs for each policy upon every ikectl(8) config reload.
Introduced smtp(1) -a to perform authentication before sending a message.
Fixed DRI3 support on amdgpu(4) and ati(4).
Accepted reject and blackhole routes for IPsec PMTU discovery.
Prevented leaking of ipsec_hosts in iked(8) when building hosts_list.
Fixed booting on powerpc64 machines with memory banks higher in physical address space, needing a larger TCE table.
Introduced klistops, introducing a way to associate lock operations with a klist.
Fixed dig(1) EDNS Client Subnet option (+subnet=).
Fixed IPv6 link-local address handling for nameservers to talk to and address to bind to in dig(1).
Added support for the i.MX8MP PCIe clocks, USB clocks and second ethernet.
Made large read and write transactions work in amliic(4).
Updated to the December 18, 2020 version of awk(1).
Added fd close notification for kqueue-based poll(2) and select(2).
Corrected the first packet of an ipsec(4) SA to have sequence number 1.
Added "amlogic,meson-g12a-dwmac" to dwge(4).
Added amlpinctrl(4) support for the "Always On" GPIOs.
Introduced a delay to work around an issue in bwfm(4) on the BCM43602 that was triggering "unexpected pairwise key update" errors.
Made pfctl(8) detect and reject bogus ranges before loading the ruleset to prevent a panic.
Made tmux(1) synchronize-panes a pane option and added set-option -U flag to unset an option on all panes.
Updated to xcb-proto 1.14.1.
Updated to Xserver(1) 1.20.10.
Prevented a race in dhclient(8) privsep which could cause autoinstall to fail by calling ftp(1) without a local address.
Correctly enumerated files with more than INT_MAX lines with the cat(1) -n flag.
Updated to unbound(8) 1.13.0.
Updated to nsd(8) 4.3.4.
Fixed TCP going over an interface with fq codel enabled.
Avoided spurious "input packet decapsulations failed" errors in netstat(1) -W with A-MSDU enabled.
Allowed booting of amd64/i386 from 4TB GPT formatted disks.
Flushed the reorder buffer after gap timeout to prevent frames from remaining in the buffer until the next frame is received.
Validated ghostbuster records (RFC 6493) in rpki-client(8).
Fixed 802.11 RSN capabilities announced to peers.
Fixed a potential NULL pointer dereference due to malformed ASN.1 in a certificate revocation list or a timestamp response token.
Fixed the calculation of "maxlen" in iwm(4) and iwx(4) when there are multiple MPDUs in one packet.
Limited the URL embedded in .cer files in rpki-client(8) to alphanumeric characters and punctuation.
Added dwgpio(4), a driver for the Synopsys DesignWare GPIO controller.
Added iked(8) support for RSASSA-PSS signature verification (RFC 7427).
Fixed a race condition in wsmux(4).
Allowed exporting prefixes from multiple sessions in bgpd(8) into the same pf(4) table, preventing a prefix from being removed from the table on the first withdrawal even if an alternative exists.
Prevented a TOCTOU race in single_thread_set() by extending the scope of the lock.
Enabled auto-negotiation on the SerDes links, allowing in-band-status to work between mvpp(4) and mvsw(4) on the ClearFog GT 8K.
Allowed rad(8) to handle all rdomains in a single daemon.
Made uvm_pagealloc() mp-safe.
Ensured rekeying of every child SA in iked(8).
Fixed ldapd(8) cert and key path inference for absolute paths.
Taught lld to link the macppc kernel.
Added support for 1000base-x and 2500base-x connections to mvneta(4).
Added mvsw(4), a driver for Marvel "SOHO" switches.
Added the iked(8) "set stickyaddress" option, which attempts to assign the same "config address" when an IKESA is negotiated with the DSTID of an existing IKESA.
Added support for the use of !command to mygate(5), so that netstart has a late opportunity to perform network configuration.
Updated to libX11 1.7.0.
Handled an autoconf interface changing its rdomain in slaacd(8).
Added iked(8) support for multiple address pools.
Set the specified TOS/DSCP for interactive use prior to TCP connect in ssh(1).
CLeaned up passing of struct passwd from monitor to preauth privsep process in ssh(1).
Used a counter instead of random IV for AES-GCM in iked(8), eliminating the risk of random collisions.
Changed kqueue_scan() to keep track of collected events in the given context.
Killed rpki-client(8) connection upon openrsync(1) server stall.
Added a simple --timeout implementation to openrsync(1).
Fixed very old umass(4) devices where the INQUIRY command succeeds but with a residue equal to the requested bytes.
Fixed a panic seen with mbuf chains on arm64.
Fixed incorrect behavior when using dhclient.conf(5) to change the lease renew/rebind/expiry timing.
Added iked(8) -s socket option to specify a control socket.
When doing an sftp(1) recursive upload or download of a read-only directory, ensured that the directory was created with write and execute permissions in the interim to allow the transfer.
Fixed urtwn(4) repeated DEAUTH and loss/restoration of link.
Allowed specific sndio(7) devices to be used for play-only and rec-only modes.
Fixed panics on the HoneyComb LX2K with amdgpu(4).
Prevented accidental truncation of large memory segments on loongson.
Added ACPI support to imxiic(4).
Implemented the key material exporter for TLSv1.3.
Prevented process exit in multithreaded programs from reporting the wrong error code.
Added multicast support to bwfm(4) to allow IPv6.
Added acpige(4), a driver for ACPI generic event devices, used on the HoneyComb LX2K to implement power button handling.
Added pchgpio(4), a driver for the GPIO controllers found on modern Intel PCHs.
Revised the initialization of the drm(4) Linux emulation layer to call it only when the first drm instance attaches.
Extended pcamux(4) with ACPI support.
Added support for the VF610 I2C controller to imxiic(4).
Made sure not to replace 0.0.0.0 with a dynamic address in iked(8) if it is a network address.
Added 10G media support to mvpp(4).
Added SFP+ support to ofw, including support for direct attach cables.
Added support for the PL2303HXN series chips to uplcom(4).
Added support for the PCA9547 I2C mux to pcamux(4).
Added witness(4) check for uninitialized (or zeroed) lock usage.
Prefixed ssh(1) keyboard interactive prompts with "user@host" for easier identification of connections.
Displayed any other hostnames/addresses associated with a new hostkey when ssh(1) prompts the user to accept it.
Implemented auto chain for the TLSv1.3 server.
Updated to freetype 2.10.4.
Fixed athn(4) in client mode against APs that use WPA1/TKIP as the group cipher.
Fixed urtwn(4) against access points using WPA1/TKIP as the group cipher.
Fixed a panic associated with locks and drm(4) on macppc with Powerbook5,6 and RV350.
Fixed issues with network stopping after the first down/up cycle in mvpp(4).
Fixed link state change behavior in 82598 ix(4) chips.
Increased speed of the dependency check pass for pkg_add(1).
Allowed use of ## and # in tmux(1) styles and added a "w" format modifier for width.
Added clock support for i.MX8MP.
Implemented iked(8) "from dynamic," installing flows where "dynamic" is replaced by the received dynamic IP address.
Fixed ilogb(3) implementation, preventing a potential infinite loop.
Changed from rwlock(9) to mutex(9) for linux rwlocks.
Removed the -L option from dhclient(8).
Fixed wg(4) on macppc by keeping track of allowed ips pointer correctly.
Added the ClearFog GT 8K to mvclock(4).
Enabled iked(8) support for ASN1_DN ipsec identifiers.
Fixed rare crashes of unwind(8) when DNS answers are larger than the maximum imsg size.
Fixed rpki-client(8) checks for manifest validity interval.
Released OpenBGPD-6.8p1.
Added recognition of Cortex-A78AE, Cortex-X1 and Neoverse V1 arm64 CPUs.
Corrected an issue where openssl(1) verify might not error on expired certificates.
Fixed an issue in the TLS 1.3 code that caused stalls in haproxy and other software.
Changed crypto(3) to call its get_issuer() callback to try and find a suitable certificate in cases where it has failed to find a print certificate from the supplied roots and intermediates.
Added the 'any' keyword to iked.conf(5) for requests to allow "request address any".
Enabled brightness keys on powerbooks where the keyboard attaches as ukbd(4).
Set initial default display brightness on macppc via of_setbrightness() to ensure wscons(4) and ofw are in sync.
Added 'dynamic' keyword to iked.conf(5) to allow configuration of flows to dynamically assigned addresses.
Implemented RFC 8914 Extended DNS Errors for dig(1).
Added tracking of address proposal creation times to be able to establish total lifetime. This information is used to renew pltime/vltime of privacy addresse per RFC 4941.
Changed slaacd(8) Duplicate Address Detection (DAD) to only generate a new address if we are using Semantically Opaque Interface Identifiers.
Added a directive to httpd(8) to check if a path is accessible.
Fixed detection of duplicate locations in httpd(8).
Added support for passing a bootmac command line argument to RAMDISK on powerpc64.
Make iked(8) accept ANY dynamic address with 'request addr 0.0.0.0'.
Fixed the "entry point at 0x10010000" hang reported on amd64 machines by using a 64MB block to load the kernel.
Changed astfb(4) to allow it to become the console on powerpc64.
Added support to request IP addresses as IKEv2 initiator to iked(8). If 'request addr 0.0.0.0' is configured, any address will be accepted.
Added the ability to force the selection of source IP address via route(8).
Created a new "location (found|notfound)" option for httpd.conf(5) to allow testing for resource path existence.
Prevented kernel reuse of mbuf memory when generating the ICMP6 response to an IPv6 packet.
Updated to unbound(8) 1.12.0.
Added notices to syslog whenever the "%n" format string component of printf(3) is used.
Stopped allowing configuration of the same neighbor multiple times in bgpd(8).
Edited syspatch(8) to ensure SHA256.sig has at least three lines.
Added limited emulation of unaligned access in the powerpc64 kernel.
Added AMD Vi and Intel VTD IOMMU support. This creates separate domains for each PCI device and can provide protection against invalid memory access.
Fixed wsconsctl(8) display commands when using drm(4) drivers on macppc.
Fixed a deadlock between uvn_io() and uvn_flush().
Added a top-level 'reboot' command to ddb(4).
Added a -legacy_verify flag to openssl(1) to force use of the old validator.
Fixed a memory leak when parsing bgpd(8) roa-set lists.
Added a workaround for PCIO devices that cannot address the full 64-bit PCI address space to powerpc64. Needed for radeondrm(4) and amdgpu(4) since Radeon GPUs only implement 36, 40, or 44 bits of address space.
Introduced a system-wide mutex that serializes msgbuf operations.
Fixed brightness setting on MacBooks.
Updated to fonttosfnt(1) 1.2.0.
Added retguard macros to powerpc64 locore functions.
Changed ping(8) to drain the raw socket of packets received before we were fully setup to avoid reporting ICMP responses intended for other instances of ping(8) running in parallel.
Made sysupgrade(8) specify a version when it uses fw_update(1) to avoid the situation where upgrading a pre-6.8 snapshot to 6.8 release with "-r" would install firmware packages from snapshots.
Ensured copyout(9), copyinstr(9) and copyoutstr(9) bail out properly if called with a length of 0 on arm64, hppa and mips64.
Modified daily(8) to stop reporting disk status and networking statistics.
Released OpenBGPD portable 6.8p0.
Released rpki-client(8) 6.8p0.
Added powerpc64 retguard macros for setjmp/longjmp.
Released LibreSSL 3.2.2.
Implemented linux interval tree functions for drm(4).
Added basic support for kclock timeouts to timeout(9).
Updated to nsd(8) 4.3.3.
Added RETGUARD implementation for powerpc and powerpc64.
Stopped exempting file systems from security(8) on the basis of nodev and nosuid options, which may not be used for file systems mounted beneath.
Supported use of more than one URI in the TAL file for rpki-client(8), sorting with a preference for https.
Prevented a crash due to httpd(8) listening on port 443 with missing TLS certificates.
Optimized arm64 copyin(9), copyout(9) and kcopy(9) by doing 16-byte copies if possible.
Added doas.conf(5) "nolog" option to avoid syslog(3).
Added Intel 495 Series LP PCH and Ice Lake graphics pci(4) ids.
Fixed a pledge violation in csh(1) where redirecting input from a file containing ^T would cause csh(1) to perform a tty ioctl operation against a non-tty.
Fixed a write hang-up on file system in vnd(4).
Enabled ssh_config(5) UpdateHostkeys by default when the configuration has not overridden UserKnownHostFile.
Added bsd.mp to powerpc64's installXX.{img,iso}.
Preferred ed25519 signature algorithm variants over ECDSA in ssh_config(5) and sshd_config(5).
Introduced "if_cloners_lock" rwlock and used it to serialize if_clone_{create,destroy}(), avoiding multiple race conditions.
Added astfb(4), a driver for the framebuffer of the Aspeed BMC found on many POWER8 and POWER9 systems.
Added Intel 400-series chipsets to dwiic(4).
Relaxed checks in pfctl(8) and pf(4) to accept any valid routing domain, even if it does not yet exist.
Moved mfokclock(4) from loongson to make it available for other platforms and renamed it to mfokrtc(4).
Removed osrelease from system.fvwmrc, as the version string matches the kernel of the fvwm(1) build machine, not the user's kernel.
Moved to 6.8-current.
--------
Changes made between OpenBSD 6.7 and 6.8
Reintroduced checks against heavy amap allocations for MAP_SHARED to prevent a panic reachable with mmap(2).
On arm64 and powerpc64, changed kcopy(9) to perform 64-bit and 32-bit copies whenever possible, needed for kbind(2) to update PLT/GOT entries atomically when doing lazy binding.
Added support for the PCA9546 I2C switch to pcamux(4).
Set length correctly in ugen(4) to prevent incorrect copy of descriptors to userland and kernel memory leaks.
Added the TP-LINK UE300 to ure(4).
Added support for Comet Lake I2C controllers to dwiic(4), needed for the trackpad on machines such as the 8th generation Lenovo X1.
Fixed a segfault in pstat(8) -v.
Released OpenSSH 8.4.
Added powerpc support for POWER9P "Axone" CPUs.
Updated LibreSSL to 3.2.2.
Made apmd(8) always ask the kernel about current hw.perfpolicy rather than maintaining state.
Added a new "set cert_partial_chain" config option to iked.conf(5) to allow verification of partial certificate chains if a trusted intermediate CA is found in /etc/iked/ca.
Used an IPI on powerpc64 so hw.setperf affects all cores in the mp kernel.
Allowed handling of long lines in an smtpd(8) aliases table.
Ensured sysupgrade(8) on systems with multiple root disks will proceed on the disk with auto_upgrade.conf present.
Moved to Mesa 20.0.8 in response to hard hangs on certain systems.
Fixed eeprom(8) error when setting variables on macppc.
Cleared the screen in ksh(1)'s vi editing mode before redrawing the line with ^L.
Capped ssh(1) channel input buffer size at 16MB, avoiding high memory use when a peer advertises a large window but is slow to consume sent data.
Fixed a memory leak in x509_constraints_extract_names.
Fixed frame pointer slot on aarch64 for functions not saving callee registers with reguard enabled.
Added a bsd.schema to ldapd(8) including a shadowPassword and an sshPublicKey attribute which can be used to extend existing LDAP users with the additional bsdAccount objectclass.
Added a check for pfctl(8) that an rtable exists when parsing the config.
Disabled acpivout(4) brightness control on machines aware of Windows 8, enabling inteldrm to handle brightness ioctls.
Provided a naptime variable for userspace via kvm_read(3), usable by vmstat(8).
Defaulted to showing full IPv6 address entries in the routing tables displayed by route(8) show and netstat(1) -r.
Introduced abl(4), a new driver to control the backlight brightness on Intel-based Apple machines, and allowed it to be controlled through wsconsctl(8).
Added a "-s timeout" feature to rpki-client(8) with a one hour default, allowing fresh attempts with cron(8) if rpki-client gets stuck.
Prevented established TCP and TLS sockets of syslogd(8) from staying open forever if a client aborted the connection silently.
Ensured certain registers are read before a potential sleep in trap()
Added support for "&" and "|" operators in btrace scripts.
Fixed smtpd(8) handling of user names containing "@" symbols.
Prevented improper disabling of the backlight in umstc(4) when brightness is adjusted to 0.
Allowed snmp(1) mibtree to take one or more arguments to be converted to a chosen output format.
Skipped scanning file systems which are both nodev and nosuid for SUID, SGID and device files with security(8).
Added an explanation for acme-client(1) account creation failure.
Allowed slaacd(8) to handle all rdomains in a single daemon.
Fixed "$@" splitting with empty IFS in ksh(1).
Used READ(16)/WRITE(16) commands for disks large enough to require them to access the last sectors, fixing large 512E devices plugged into USB to ATA/ATAPI bridges which mistakenly use 4K sector addresses/sizes.
Imported login_ldap(8), using ldap(1) rather than openldap.
Allowed theoretical multiple attachment of asmc(4) controllers.
Changed rpki-client(8) -n behavior to automatically validate the repo.
Added support for the RK3308 MAC to dwge(4).
Modified trunk(4) to keep port interfaces UP on removal, matching aggr(4) behavior.
Enabled btrace(8).
Added btrace(8) -p flag to filter all actions by PID.
Fixed outbound bpf(4) tap for ogx(4).
Handled AGL interfaces on octeon, making management network ports usable on some machines.
Allowed use of -N without a command to change or add a note to an existing key in tmux(1).
Added RK3308 temperature sensors to rktemp(4).
Added RK3328 PWM, also found in the RK3308, to rkpwm(4).
Added control for backlight compensation to video(4).
Added tsc_delay(), a delay(9) implementation based on the TSC, to amd64.
Allowed specification of supported TLS protocols in ftp(1) "-S protocols".
Added mpii(4) to powerpc64.
Added kstat to cnmac(4).
Updated Mesa to 20.1.7.
Added a 30 second timeout for OCSP requests in iked(8).
Allowed a-z keys for tmux(1) display-panes to jump to higher-numbered panes.
Moved to 6.8-beta.
Moved ntpd(8) to unsynced mode if no replies are received for awhile due to connectivity issues.
Fixed make(1) :S with anchors and replacement.
Improved PLL1(CPU_PLL) stability for the Allwinner H3/H2+.
Added support for requiring user-verified FIDO keys in sshd(8).
Improved detection of the proper powerpc64 boot device by choosing the disk matching the bootduid of the boot kernel.
Added top(1) "t" to toggle the display of routing tables.
Allowed disabling of iked(8) DPD liveness checks by setting dpd_check_interval to 0 in iked.conf(5).
Updated Mesa to 20.1.6.
Fixed a race in single-thread mode switching.
Corrected multiple input validation deficits in X server extensions.
Fixed an integer overflow in libX11 which could lead to a double free.
Added a dpd_check_interval configuration option to iked.conf(5).
Released LibreSSL 3.2.1.
Added support for non-localhost fastcgi sockets to httpd.conf(5).
Rehashed main pf(4) rulesets after rule expiration.
Implemented UHS-I support in the sdmmc(4) midlayer and enabled it in amlmmc(4).
Updated unbound(8) to 1.11.0.
Added filtering by routing table to top(1).
Added support for the IBM POWER8 host bridge.
Introduced xicp(4), a driver for the interrupt control presenter hardware found on POWER8 CPUs.
Added the new iked(8) configuration option "set enforcesingleikesa" to limit the number of connections for each peer.
Added powerpc64 support for "normal" external interrupts, needed for running POWER8 and earlier CPUs.
Updated to libfido2 46710ac06.
Prevented concurrent CREATE_CHILD_SA and INFORMATION exchanges in iked(8).
Added fstat(1) support for looking up unix domain sockets by file name.
Moved sysctl(2) CTL_DEBUG from DEBUG to the new DEBUG_SYSCTL.
Added the tmux(1) n: modifier to get the length of a format.
Allowed SIOCSWGDPID and SIOCSWGMAXFLOW ioctls for non-root, preventing switch(4) interfaces from appearing partially as bridge(4) devices for unprivileged users running ifconfig(8).
Added support for IODA2 bridges such as those found on POWER8 chips.
Added powerpc support for POWER8 CPUs.
Added unveil(2) to the main process of relayd(8).
Added optional iked(8) time-stamp validation for OCSP.
Enabled PAN (Privileged Access Never) on arm64 CPUs supporting it.
Added initial tcpdump(8) support for handling geneve packets.
Updated xkbcomp(1) to 1.4.3.
Properly implemented amlmmc(4) setting of signal voltage.
Added Exar XR17V35x serial port support.
Added sdmmc(4) support for eMMC HS200 mode.
Added a ROUTE_FLAGFILTER socket option for routing sockets, allowing routing daemons to opt out of receiving messages for L2 and broadcast route entries.
Prioritized incoming certificate requests by the order of CERTEQ payloads in the received message in iked(8).
Updated awk(1) to the August 7, 2020 version.
Added optional time limits for the AddKeysToAgent keyword in ssh_config(5).
Allowed the combination of video(1) "-dc" options, reset and display control values.
Added kstat(1) -w option, allowing update and printing of stats at a specified wait interval.
Added pms(4) support for the Elantech v1 touchpad with firmware version 0x20022.
Updated compiler-rt to 10.0.1.
Released LibreSSL 3.1.4.
Stopped blocking IPIs when acquiring the rendezvous mutex of mips64, which may fix some hangs on sgi.
Added the ability to filter which kstat(1) entries are displayed.
Added P-521 to the list of curves supported by default for TLS.
Updated LLVM to 10.0.1 including clang, lld and lldb.
Stopped preventing TCP connections to IPv6 anycast addresses.
Set IPv6 source address selection to prefer the address with the highest preferred lifetime in case of a tie.
Allowed pf(4) to divert packets from bridge(4) to local socket.
Avoided reading one byte before the path buffer in mountd(8).
Added the ability to set and display video(1) control values directly on the CLI.
Changed tmux(1) searching to behave more like emacs and prevented regex searching from overlapping when searching forward.
Built installXX.{img,iso} powerpc64 files.
Added powerpc64 cd9660, msdos and inet6 ramdisk support.
Improved ure(4) TX performance by combining multiple packets into one xfer as possible.
Corrected ssl(8) handling of server requests for an OCSP response.
Added additional scsi devices on powerpc64.
Updated LLVM to 10.0.0, including clang, lld and lldb.
Added support for Gear Head keyboards.
Updated libpcap to 9.0.
Added the pcap-filter(5) "sample NUM" primitive to allow capture of 1/NUM packets.
Allowed scp(1) and sftp(1) -A option to explicitly enable agent forwarding.
Updated libcbor to v0.7.0.
Added support for AX201 devices to iwx(4).
Added support for remote coverage to kcov(4).
Updated Spleen kernel fonts to version 1.8.2.
Fixed a race condition for isoc devices during device close.
Fixed potential information leak via X server pixel data uninitialized memory.
Fixed heap corruption in the X input method client in libX11.
Enabled userland timecounter code on sparc64.
Updated awk(1) through the July 30, 2020 version.
Added Intel Wi-Fi 6 AX201 pci(4) device ID.
Fixed a panic in wscons(4).
Implemented IPv6 source address selection as outlined in RFC 6724 section 5.
Fixed bogus frame sizes being returned by xhci(4).
Released rpki-client(8) 6.7p1 including OpenBSD 6.7 Errata 015.
Fixed rpki-client(8) return value check for openssl API used during pubkey validation.
Added tmux(1) -d option to display-message to set delay.
Added / as an alias for g (grep) in top(1).
Avoided nvram lock timeout on sparc64 systems with onboard BCM5704 bge(4) instances that come without a fitted EEPROM/NVRAM.
Ported NetBSD's arm64 disassembler for ddb(4).
Fixed potential use-after-free and double-free issues in PEM_X509_INFO_read_bio(3).
Increased the powerpc64 MAXCPUS to 48, the maximum cores available in any POWER9 system.
Updated nsd(8) to 4.3.2.
Added support for the AMDI0010 touchpad on the Inspiron 5505.
Increased the mcx(4) event queue size, preventing a potential interrupt storm on the ConnectX-4.
Implemented IPIs on powerpc64.
Prevented an unveil(2) failure with chdir / on sensorsd(8).
Built bsd.mp on powerpc64.
Created /dev nodes for sparc64 and powerpc console.
Prevented mg(1) from running out of memory or segfaulting with query-replace-regex ^.
Added support for Intel AX200 Bluetooth usb(4) devices.
Forced long-names on msdos filenames for installboot on most 32-bit architectures.
Filtered vlan and svlan packets by default for tpmr(4).
Changed tpmr(4) from ifconfig [-]trunkport to add|del synopsis.
Added rge(4) support for newer RTL8125 chipset (RTL8125B).
Introduced powerpc64 GENERIC.MP.
Corrected ruleset checksum calculation to allow pfsync(4) to verify rulesets are identical on all nodes.
Improved processing of lost frames during 802.11 Rx aggregation.
Handled iked(8) TEMPORARY_FAILURE notification on IKESA rekeying.
Fixed a dst/src iked(8) port configuration bug with multiple flows.
Ensured only pseudo-terminal devices use reprint delays.
Switched the default pager from "more(1) -s" to less(1).
Added a new column to wsfontload(8) -l output to report the number of characters contained in a loaded font.
Updated Spleen kernel fonts to version 1.8.1.
Fixed gain calibration for some iwn(4) devices (5000 and up).
Enabled xhci(4) in the powerpc64 BOOT kernel.
Fixed the initial sndiod(8) alternate device number, preventing device number 1 from being skipped on first use.
Added additional Atheros pci(4) IDs.
Improved the powerpc64 kernel linker script and installed proper page protections via pmap_bootstrap().
Passed boothowto and bootduid parameters to the booted powerpc64 kernel via the device tree.
Implemented userland timecounting for macppc and octeon.
Added initial powerpc64 X sets.
Randomized the system stoeplitz key.
Added installboot powerpc64 support.
Added video(1) white balance temperature control through w/W keys.
Enabled multiq support for ix(4).
Added a "%k" TOKEN to ssh_config(5) that expands to the effective HostKey of the destination.
Added %-TOKEN, environment variable and tilde expansion to UserKnownHostsFile in ssh_config(5).
Introduced an initial bootloader for OpenBSD/powerpc64.
Added a ktrace(1) -T option to make time-related system calls more prominent.
Fixed a potential crash when bringing down an mcx(4) interface.
Optimized character rendering in 32bpp mode, providing double-pixel rendering for the common font widths and a signicant speed increase.
Added a SENSOR_ENERGY sensor type which uses microjoules.
Implemented userland timecounter for arm64.
Prevented root from freezing the UTC clock with settimeofday(2) at securelevel 2.
Fixed iked(8) public key authentication interoperability with *swan and other IKEv2 implementations by making CERT and CERTREQ payloads optional.
Corrected handling of padding cells while searching in tmux(1).
Allowed additional control over the use of ssh-askpass(1) in ssh-add(1), including force-enable/disable.
Introduced xics(4), a driver for the OPAL virtual ICS.
Added powerpc64 FDT interrupt support.
Added support for routing interrupts to other CPUs in ampintc(4) and agintc(4).
Fixed performance problems relating to tty subsystem abuse.
Enabled background scanning on iwx(4) devices.
Fixed athn(4) use with WPA2 APs.
Stopped creation of non-existent bridge(4) interfaces.
Used su(1) -fl to avoid sourcing the target user's .profile in rc.d(8)/rcctl(8).
Synchronized each core's CP0 cycle counter using the IO clock counter on mips64 and octeon, making the cycle counter usable as timecounter.
Improved speed of scrolling by optimizing rasops(9) write-only framebuffer console.
Implemented linear and power-of-two histograms in btrace(5).
Added the Spleen 6x12 font to wsfont.
Corrected trackstick/button attachment of Windows Precision Touchpad imt(4) devices, fixing behavior on certain Dell Latitude laptops.
Fixed information leak in semctl SEM_GET.
Enabled spleen16x32 and spleen32x64 fonts on armv7 for GENERIC kernels.
Taught su(1) -l -f to start a regular shell for non-csh shells rather than a login shell.
Introduced opalsens(4), a driver for sensors provided by the OPAL firmware.
Enabled TLSv1.3 for the generic TLS_method().
Corrected route(8) handling of ::/0 and "route add -inet 0.0.0.0 -prefixlen 0 (gateway)".
Switched iwx(4) from -46 to -48 firmware.
Added support for set -o pipefail to ksh(1), potentially helping error checking.
Protected the whole pipex(4) layer by NET_LOCK().
Increased the buffer size for OFW parameter name strings, making it possible to dump the full device tree on POWER9 systems using eeprom -p.
Added support for timecounting in userland, improving speed and responsiveness in programs which make many time of day calls.
Repaired athn(4) in client mode against WPA2 access points.
Added support for the D-Link DWA-121 rev B1 urtwn(4) device.
Introduced kstat(1), a subsystem to allow the kernel to expose statistics to userland (and kstat(8), the userland side).
Fixed ls(1) -R mode to not display subdirectories of a directory beginning with '.' and ensure directory names are always displayed.
Modified uvideo(4) to fix webcam detection in Firefox 78.
Began natively compiling for the powerpc64 architecture.
Fixed mbuf leak in urtwn(4) with frames CCMP-encrypted by hardware.
Fixed an xconsole(1) crash by starting it after setting the background.
Prevented a core dump in ftp(1) during fetch abort.
Fixed intermittent failing pms(4) device initialization seen on some Synaptics devices.
Used an LFENCE instruction everywhere RDTSC is used for a time measurement, reducing the jitter in TSC skew measurements.
Prevented ssh(1) port forwarding clients from keeping a connection alive when it should be terminated.
Updated awk(1) to July 2, 2020 version.
Initialized v4l2_requestbuffers for libv4l compatibility, allowing view of video encodings not directly supported by video(1).
Fixed gpu hangs when starting Xorg seen with 4.19 and 5.7 drm.
Removed support for the socket keyword in snmpd.conf(5).
Removed the -f (force) option in rpki-client(8).
Added support for the mcx(4) ConnectX-6 Dx.
Introduced arch/powerpc64.
Prevented creation of bogus sd(4) devices for nvme(4) namespaces which are configured but have size 0.
Updated Spleen kernel fonts to version 1.8.0.
Prevented possible libevent state corruption in vmd(8).
Introduced a darker xenodm(1) login widget and a lower contrast default background.
Allowed switching between alternate devices (-F) with sndioctl(1).
Fixed a problem where switching to a vt and back was needed to see rc output and login prompt on some intel machines with skylake and newer graphics.
Converted macppc, octeon and loongson to use machine-independent installboot.
Updated to freetype 2.10.2.
Switched the default CDDB database for cdio(1) to gnudb.gnudb.org:8880.
Fixed merging of files that lack newlines for diff3(1), OpenRCS and OpenCVS.
Allowed ssh-add(1) "-d -" to read keys to be deleted from stdin.
Fixed variable shadowing in vpci(4) which led to a noticeable delay while attaching devices using multiple msi-x vectors.
Introduced a framework for MII busses.
Introduced mvpp(4), a driver for the Marvell Packet Processor v2 as used on the Armada 7K and 8K SoCs.
Implemented rss/toeplitz support for ixl(4) 710 chips.
Allowed sshd_config(5) longer than 256k.
Ensured the STOP command sent by sd(4) on powerdown will not result in hanging the machine if commands to the USB mass storage fail.
Modified ldapd(8) use of "ldaps" and "tls" keywords to enable only the libtls defaults for protocols and ciphers. The new "legacy" keyword can be used before these keywords in ldapd.conf(5) to enable them all.
Enabled wg(4).
Stopped incrementing openclass for a literal "[" in awk(1), allowing parsing of expressions such as "/[[/[]/".
Increased pbuild datasize limit to 8G to allow Firefox to build with Rust 1.44.
Implemented pci_intr_establish_cpu() for pyro(4) and vpci(4)-based sparc64 systems.
Introduced gettime(9) and getuptime(9) and substituted these for time_second(9) and time_uptime(9) throughout the kernel to prevent split-read problems on 32-bit platforms.
Introduced opalcons(4), a driver for the OPAL console.
Added support for the Ericsson F5521gw Mobile Broadband Modem.
Resolved a panic in bridge_ioctl() by ensuring the netlock is held when calling ioctl handlers and dropped for the wg(4)-specific ioctls.
Enabled critical temperature detection in iwx(4) firmware.
Added ssh(1) support for fido(4) WebAuthn (verification only).
Added an ioctl allowing userland to access read-only support information about pci devices via the vpd register.
Enabled nvme(4) on i386.
Fixed vmd(8) ns8250 lockup due to a race condition, helping to prevent linux vm crashes when the return key is held on boot.
Updated Spleen kernel fonts to version 1.7.1.
Added wg(4), an in-kernel driver for Wireguard vpn communication.
Added bcmtmon(4), a driver for the temperature sensor on the Raspberry Pi 4.
Added bwfm(4) support for BCM4359 SDIO variants such as the AP6359SA module found on the RockPro64 WiFi module.
Fixed a fatal firmware error at run-time on iwx(4).
Added WPA2 (CCMP) crypto offload support to iwx(4).
Added pcamux(4), a driver for the PCA8548 I2C switch.
Added bge(4) support for the BCM5719 A1.
Fixed broken HID descriptors of Elecom trackballs with 6 or 8 buttons.
Fixed a crash in re(4).
Enabled multiple queues on vmx(4).
Added intrmap, an api that picks CPUs for devices to attach interruptions to.
Added d and D keys to tmux(1) customize mode to reset to defaults.
Added a symmetric toeplitz implementation with integration for nics, usable through the stoeplitz_to_key(9) API.
Supported -T html -O tag for mandoc(1) by passing a file:// URI to the pager.
Fixed an sdhc(4) panic on the MACCHIATObin due to unaligned memory access.
Added support for the XIVE interrupt controller found on POWER9 CPUs.
Added tmux(1) -b flags to insert a window before (like the existing -a for after) to break-pane, move-window and new-window.
Implemented the gensub(), systime() and strftime() functions for awk(1).
Fixed sndiod(8) crashes when USB devices are disconnected.
Added netstat(1) -R to show a summary of rdomains with associated interfaces and tables.
Added a tmux(1) -A option to pause a pane manually.
Added escodec(4), a driver for the Everest ES8316 audio codec used on the Pinebook Pro.
Added rkiis(4), a driver for the I25 controller found on the Rockchip RK3399.
Added simpleamp(4), a driver for "simple audio amplifier," one of the aux devices for simpleaudio(4).
Added simpleaudio(4), a driver for "simple audio cards." This is a wrapper connecting the I25 controller, the codec and some aux devices.
Introduced a framework for digital audio interfaces.
Populated a list of 256 brightness levels as a fallback when the device tree does not specify a list, making the Pinebook Pro display work with the dtb from Linux 5.7.
Updated awk(1) through the June 5, 2020 version.
Provided an optimized implementation of ffs(3) in the kernel on arm64/powerpc/powerpc64.
Added cwfg(4), a driver for the Cellwise CW201x fuel gauge on the Pinebook Pro.
Added opal(4), a driver that interacts with the OPAL firmware on powerpc64 and implements RTC functionality.
Added IBM POWER9 host bridge pci(4) id.
Prevented rcs(1) removal of locked revisions with rcs -orange, avoiding leaving behind a lock for a revision which no longer exists.
Added Intel 200 Series HD Audio pci(4) id.
Prevented a use-after-free when a wireless device is detached.
Updated drm(4) to linux 5.7.
Added Marvel 88SE9215 and 88SE9235 AHCI pci(4) ids.
Prevented callers inspecting unrelated fields in the libc resolver function asr_run().
Moved Powerbook5,4 audio from aoa(4) to snapper(4), adding the missing TAS3004 volume control.
Added ssl(8) support for additional GOST curves and aliases for 256-bit GOST curves.
Added support for pausing a tmux(1) pane when the output buffered for a control mode client is too far behind, controllable with refresh-client -f and -A.
Prevented the HID parser from overflowing if a malicious device provides too many PUSH.
Added support for the Cortex-A78 cpu.
Improved TLSv1.3 client certificate selection to allow use of EC certificates.
Fixed pf.conf(5) "route-to TABLE least-states" in an anchor.
Updated perl(1) to 5.30.3.
Introduced acpihid(4) for ACPI HID event and 5-button array devices.
Added support for hardware vlan tagging to mcx(4).
Added an SK hynix NVMe pci(4) id.
Released LibreSSL 3.2.0.
Added umstc(4), a driver for Microsoft Surface Type Cover keyboards.
Began looking for non-expired certificates first when building a chain, making certificate validation possible for various sites that are serving expired AddTrust certificates.
Improved CPU frequency scaling in automatic performance mode by removing accounting for offline CPUs.
Added to ssh_config(5) a selection of keywords allowed to expand shell-style ${ENV} environment variables on the client side.
Adjusted to complete group key renewal immediately if no station is associated when ieee80211_proto.c runs.
Prevented a panic where athn(4) attempted to transmit old, unencryptable frames after switching to a new group key in hostap mode.
Enabled building wsmoused(8) and wsfontload(8) on arm64 and armv7.
Fixed display glitches on smaller screens or with larger fonts in efifb(4) associated with remapping and attaching.
Enabled scrollback in simplefb(4).
Prevented unconditional initialization of VGA on amd64 boot causing video distortion.
Corrected getopt_long(3) parsing of a trailing dash in an option group, which was being incorrectly returned as an argument.
Removed mail.local(8) support for world-writable mail spools.
Added AES-GCM mode ciphers for IKEv2, configurable in iked.conf(5) with the new "ikesa enc" options aes-128-gcm, aes-256-gcm, aes-128-gcm-12 and aes-256-gcm-12.
Rewrote the entropy enqueue ring to collect damage asynchronously and adapted the dequeue to mix a selection of "best" ring entries, exponentially backing off the dequeue timeout, to compensate rapidly for weak seeding in unidentifiable conditions and ensure quality to arc4random() calls early in boot.
Introduced detection of /etc/random.seed reuse.
Reworked kernel loading with octboot(4), which now does not rely on a mounted filesystem.
Prevented a fatal iwx(4) firmware error when the driver moves out of AUTH state.
Rewrote m88k mutex code as a slight variation of the MI mutex code, potentially improving stability and rendering mutex spinning time visible in top(1).
Allowed passage of unencrypted 802.11 frames during hardware decryption post-processing, fixing failure of some ral(4) devices to receive packets on encrypted networks.
Added support to urtwn(4) for TP-Link TL-WN822N-EU v5 (and v4).
Restricted ssh-agent(1) from signing web challenges for FIDO keys, preventing ssh-agent forwarding on a host that has FIDO keys attached from granting the ability for the remote side to also sign challenges for web authentication using those keys.
Increased the default number of ldom and ttyV devices for sparc64 from eight to sixteen.
Passed boothowto from the sparc64 bootloader to the kernel using .openbsd.bootdata.
Added wsmoused(8) support to efifb(4).
Added support for the ThingM blink(1) USB notification light.
Stopped syslogd(8) from closing UDP sockets for sending messages when DNS lookup of a UDP loghost fails, alloiwing them to be used to send if DNS is working during the next SIGHUP.
Made non-root filesystems FFS2 for landisk, sgi and luna88k.
Made ldomctl(8) "init-system -n" check vcpu and memory constraints.
Relaxed filename checks in syspatch(8) to allow use of hyphens.
Adjusted dwpcie(4) timing to improve likelihood of a successful PCIe link on the i.MX8MM. Avoids a failure to detect em(4) on the HummingBoard Pulse.
Added RB_GOODRANDOM passed from bootloader to kernel in boothowto, indicating confidence a "great seed" was loaded.
Added an Atheros QCA986x/988x pci(4) ID.
Enabled the FFS2 option on the luna88k ramdisk.
Added support for the Marvell Xenon SDHC, used as storage on the Armada 3700 and 8040 SoCs. This should make eMMC7CD show up on the MACCHIATObin.
Added support for the SD card detect pins on the Turris Mox.
Added mkvpcie(4), a driver for the Aardvark PCIe controller found on the Armada 3700 SoC.
Fixed the ksh(1) exit code when evaluating a || compound list to prevent termination of the shell when running under -e.
Added an ASMedia ASM1182e PCIe switch pci(4) id.
Fixed an uninitialized variable and potential stack overflow with IPv6 connections in smtpd(8).
Implemented a carp(4) transmit bypassing the ifq on output, enqueuing the packet directly on the parent interface.
Opened up a 4GB memory bus window for mvneta(4) on the Marvell Armada 3700, making the second ethernet controller/port work on the Turris Mox.
Released OpenSMTPD 6.7.0p1.
Moved back to FFS1 by default for MFS.
Updated unbound(8) to 1.10.1.
Added support for TLS 1.3 server to send certificate status messages with oscp staples.
Released rpki-client(8) 6.7p0.
Offloaded CCMP (WPA2) encryption and decryption to iwm(4) hardware, reducing CPU load during traffic bursts.
Introduced a "dark mode" for directory listings and error pages in httpd(8).
Made OpenBSD boot on the odroid c4 with power domain in amldwusb(4).
Added amlpwrc(4), a driver for the power domain controller found on Amlogic SoCs.
Fixed a hang in rpki-client(8) by properly waiting for exiting openrsync(1) processes.
Made FFS2 the default for newfs(8).
Changed install images called *.fs to *.img to accommodate some UEFI bootloaders.
Restored VGA fonts on VT switch, preventing an unusable screen when switching to a VT with a custom VGA font from X.
Added a decode error alert when a TLS server provides an empty certificate list.
Began initial development of an OpenBSD/powerpc64 port.
In tmux(1):
Added an option to set the pane border lines style as single lines, double or heavy, simple or number (the pane numbers).
Added a client flag 'active-pane' which stores the active pane in the client and allows it to be changed independently from the real active pane stored in the window.
Added a -D flag to run in non-daemonized mode.
Added a customize mode (C) where keys and options can be browsed and changed.
Added M-+ and M-- to expand and collapse all items in tree mode.
Changed refresh-client -F to -f and added -f flags to attach-session and switch-client.
Added -e for new-session to set environment variables.
Added the 'e' key in buffer mode to open the buffer in an editor.
Added -W and -T flags to command-prompt to only complete a window and a target.
Ensured that a TLSv1.3 server has provided a certificate before attempting validation.
Implemented kqueue(2) support for video(4).
Updated to xkbprint 1.0.5.
Updated to libXxf86dga 1.1.5.
Updated to libXrandr 1.5.2 and xrandr(1) 1.5.1.
Updated to libxcb 1.14 and xcb-proto 1.14.
Fixed CCMP replay checks with 11n Rx aggregation and CCMP hardware offloading.
Disabled ohci(4) on the amd64 ramdisk kernel.
Fixed dhclient(8) domain-search option processing.
Enabled TLSv1.3 support in relayd(8).
Set ddb(4) "/t" to show a trace via TID on all architectures.
Updated nsd(8) to 4.3.1.
Added -rls1_3 and -no_tls1_3 options to openssl(1) s_server.
Preserved group/world read permission on known_hosts files across runs of ssh-keygen(1) "-Rf /path".
Fixed an iked(8) policy lookup edge case for simultaneous transport and tunnel mode SAs.
Enabled the TLSv1.3 server in openssl(1).
Improved reporting of remaining power with batteries of different capacities in acpi(4).
Allowed specifying -d multiple times in slowcgi(8).
Added bgpctl(8) support for VPNv6 in the family option of the "show rib" command.
Fixed two out-of-bounds array accesses in ioctl code pathways in wscons(4).
Made "reason" parsing in bgpctl(8) more generic and introduced it to the "reload" command.
Added an optional "domain name" acme-client.conf(5) option allowing use of multiple domain sections with the same name and creation of an rsa and an ecdsa key for the same domain name.
Fixed a crash on landisk in unwind(8) due to cmsg buffer misalignment.
Prevented hangs in existing processes due to an indefinite wait for flushing when closing a tty.
Moved to 6.7-current.
--------
Changes made between OpenBSD 6.6 and 6.7
Released LibreSSL 3.1.1.
Prevented the generation of corrupt OSPF Router (Type 1) LSAs in ospfd(8) and ospf6d(8).
Prevented a panic in m_copydata(9) in ip6_pullexthdr() due to an invalid or corrupted hop6 option.
Prevented a panic when a WPA2-enabled athn(4) hostap interface is reconfigured while the queue contains frames.
Correctly disabled reading with the private community when read-write is set to disabled in snmpd.conf(5).
Corrected handling of invalid ssh.com private keys using ssh-keygen(1) -i.
Prevented a tmux(1) crash when removing the automatic-rename option.
Prevented an occasional synchronization problem when playing youtube videos in chromium.
Added an expandtab option to vi(1) which expands tabs to spaces in insert mode and when shifting and indenting/outdenting, similiar to the expandtab option in vim.
Prevented a segfault by ensuring vmd(8) correctly terminates vm processes.
Configured abcrtc(4) to allow trickle charging of a connected battery or capacitor.
Added the ifconfig(8) 'nomimo' nwflag which disables MIMO in 11n mode, allowing working around packet loss in 11n mode if the wireless network device has unused antenna connectors.
Fixed an issue in smtpd(8) where usernames always expanded to the @ wildcard if defined in the virtual alias file.
Added tcpci(4), a driver supporting TCPCI-compliant USB Type-C port controllers.
Added bcmclock(4) and bcmmbox(4) to armv7, fixing a hang because the clock for sdhc(4) cannot be enabled.
Prevented an infinite dhclient(8) loop when the DHCP server disappears immediately after offering a lease.
Offloaded CCMP (WPA2) encryption and decryption to athn(4) hardware, reducing CPU load during traffic bursts.
Mapped em(4) descriptor rings coherent, improving performance on selected ARM64 machines with non-cache-coherent PCIe controllers.
Added i.MX8MM support to dwpcie(4).
Added imxpciephy(4), a driver for the i.MX7D's PCIe PHY, also implemented on the i.MX8MM.
Allowed display of TLSv1.3 extension type with openssl(1) -tlsextdebug.
Added bcmbsc(4), a driver for the Broadcom Serial Control (BSC) controller.
Added RTL8821CE and RTL8822CE pci(4) ids.
Added dsxrtc(4), a driver for the Maxim DS3231/DS3232 I2C RTC.
Reduced the minimum allowed number of chunks in a CONCAT volume from 2 to 1, increasing the number of volumes which can be created on a single disk with bioctl(8) from 7 to 15.
Increased the default number of audio devices to 4.
Added bcmgpio(4), a driver for the Broadcom BCM283x GPIO controller.
Added iked(8) support for switching rdomain on ipsec(4) encryption/decryption, configurable per policy with the new 'rdomain' option in iked.conf(5).
Added support for automatically moving traffic between rdomains on ipsec(4) encryption or decryption, reducing the attack surface for network sidechannel attacks.
Stored local-address by address family in bgpd(8), allowing configuration of both an IPv4 and IPv6 local-address on a group with correct binding of neighbors. Introduced 'no local-address' to reset a previously-set local address back to zero.
Correctly parsed "0/0" as the default route when specifying the classless-[ms-]static-routes options in dhcpd.conf(5).
Indicated the marked pane in tmux(1) choose mode in reverse, and added keys to set (m) and clear it (M), and to jump to the starting pane (H).
Added bcmsdhost(4), a driver for the Broadcom "sdhost" SD controller found on the Raspberry Pi.
Allowed tmux(1) main-pane-width and height to be specified as percentages.
Added bcmdmac(4), a driver for the DMA controller found on BCM283x SoCs.
Added support for the additional sdhc(4) controller found on the Raspberry Pi.
Added a Broadcom BCM2711 pci(4) id.
Prevented mcx(4) interface lockups due to completion queue overflow.
Added a -groups option to the openssl(1) s_server, allowing EC groups to be configured.
Added quirks for the sdhc(4) controller on the Raspberry Pi, providing microSD card or WiFi support depending on the firmware configuration.
Added support for hardware with sdhc(4) controllers on busses only supporting 32-bit access.
Added bcmirng(4), a driver for the RNG200 random number generator found on the Raspberry Pi 4.
Fixed brightness keys on the x395 and other thinkpads with AMD graphics.
Added bcmclock(4), a driver for the BCM283X CPRMAN clock controller.
Added bcmmbox(4), a driver for the VideoCore messagebox interface on BCM283X.
Added bcmpcie(4), a driver for the PCIe controller found on the Raspberry Pi 4.
Disabled MSI for the AMD Hudson2 azalia(4) HDA to fix random lock ups.
Disabled access for regular users to /dev/audio* and /dev/rmidi*, creating these devices owned by root:_sndiod.
Rewrote the cron(8) flag-parsing code to be getopt-like, allowing tight formations like -ns and flag repetition. Renamed the "options" field in crontab(5) to "flags".
Fixed a panic when using pppac(4) without pipex(4).
Fixed an incorrect test for root in drm linux compatibility code.
Allowed use of the IgnoreRhosts directive anywhere in an sshd_config(5) file, not just before Match blocks, and made it a tri-state option.
Added crontab(5) -s flag to the command field, indicating that only a single instance of the job should run concurrently.
Allowed cwm(1) configuration of window size based on percentage of the master window during horizontal and vertical tiling actions.
Added the sndioctl(1) -n option to suppress variable names in output and the -q option to suppress output when setting variables, as in mixerctl(1).
Added support for printing RFC 2332 NBMA Next Hop Resolution Protocol (NHRP) to tcpdump(8).
Added support for the Armada 3720 CPU clock to mvclock(4).
Fixed a "route contains no arp information" bug where a kernel routing table entry was incorrectly deleted upon insertion of a new entry.
Switched powerpc to a machine-independent mplock implementation, allowing use of witness(4).
Added cron(8) support for random values using the ~ operator.
Added bse(4), a driver for the Broadcom GENET v5 network interface found on the Raspberry Pi 4.
Added brgphy(4) support for the Broadcom BCM54210E.
Made slaacd(8) honor the rdomain in which it runs when configuring the default route.
Fixed mvneta(4) on arm64.
Fixed a problem in iwn(4) where the link gets stuck since every CCMP encrypted frame is discarded by the AP as a replay.
Updated to Xserver(1) 1.20.8.
Stopped processing packets under non-exclusive netlock, preventing concurrency in the socket layer.
Added acpi(4) support for the _CCA method, indicating whether DMA is cache-coherent.
Added a -f filter argument to the tmux(1) list commands like choose-tree.
Prevented data corruption on UDP receive socket buffers by grabbing the exclusive NET_LOCK() in the softnet thread.
Added omcm(4), omclock(4) and omsysc(4) drivers that support the new bus structure used in current mainline Linux device trees.
Added an -s flag to tmux(1) copy-mode to specify a different pane for the source content.
Added TOKEN percent expansion to ssh(1) LocalForward and RemoteForward when used for Unix domain socket forwarding.
Released LibreSSL 3.1.0.
Updated perl(1) to 5.30.2.
Added support for RK3328 Crypto/RNG clocks.
Fixed an automatic Tx rate control issue in iwn(4).
Ensured legacy ssl(8) session ID is persistent during a client TLS session, fixing an issue using TLSv1.3 with smtp.mail.yahoo.com.
Added glass console support to rkdrm(4).
Fixed the MAC address on Pandaboard-ES by increasing smsc(4) buffer size used to fetch device tree properties.
Fixed the ifconfig(8) "media:" line for 11n wifi interfaces during and after bgscan.
Added vmm(4) IOCTL handler to set the access protections of the ept.
Modified iked(8) to always prefer generic signature authentication.
Implemented support for "usb-nop-xceiv" PHYs.
Fixed an iked(8) pubkey leak in the CA process for ASN-DN IDs.
Prevented dhcpd(8) from referencing freed memory after releasing a lease with an unusually long UID.
Added support for the cd-gpios property on ommmc(4).
Enabled ffs2 in sgi bootblocks and ramdisks.
Made ffs2 the default filesystem type on installs except for landisk, luna88k and sgi.
Removed sitaracm(4).
Added omrng(4), a driver for the random number generator found on TI OMAP SoCs.
Moved to 6.7-beta.
Implemented __atomic_is_lock_free for powerpc.
Fixed powerpc libunwind for cpus without altivec.
Modified mixerctl(1) to use /dev/audioctlN instead of /dev/mixerN.
Restored enabling and setting the output tap delay in rkemmcphy(4), fixing the eMMC module on the rockpro64.
Added rkrng(4), a driver for the random number generator found on various Rockchip SoCs.
Fixed an automatic Tx rate control issue in iwm(4) and iwx(4).
Fixed a crash when quotas were turned on while a process was traced with ktrace(1).
Gave ssh-keygen(1) the ability to dump the contents of a binary key revocation list with ssh-keygen -lQf /path.
Made libossaudio use sndio(7) instead of the kernel mixer(4) interface.
Switched the default compiler on powerpc to clang.
Changed the sparc64 bootblocks to be able to read from ffs1, ffs2 and softraid, and enabled the ffs2 option for both floppies.
Added a W position to tmux(1) display-menu -y to use the line above or below the status line containing the window list.
Exposed the first 8 midi(4) devices to sndiod(8) clients if no -q options are used.
Added a -T flag to tmux(1) resize-pane to trim lines below the cursor.
Added non-regex search variants to tmux(1).
Fixed MIMO rates with firmware-based rate scaling in iwm(4).
Prevented stack trace saving from inspecting untrusted data on amd64, arm64 and i386.
Reduced temporary address valid lifetime to 2 days in slaacd(8).
Added support for additional Allwinner A80 clocks and resets in sxiccmu(4).
Added imxpwm(4), a driver for the PWM controller found on various NXP i.MX SoCs.
Enabled FFS2 on the landisk ramdisk.
Fixed CPU frequency scaling support on the Librem5 Devkit.
Added support for "alpha" suffixes in packages-specs(7), removing the need for workarounds in certain ports distfiles.
Fixed amlpciephy(4) USB3 support when USB has not been initialized by U-Boot.
Fixed user database corruption resulting from use of the ikectl(8) reload command.
Added support for tmux(1) overlay popup boxes, created with the display-popup command.
Prevented a system hang when tsleep(9) with PCATCH returned immediately without error when called during execve(2).
Enabled use of em(4) with MSI-X.
Corrected inappropriate rate selection in uaudio(4) preventing recording on devices supporting fewer rates for recording than playback.
Fixed brightness controls on certain machines where the initial brightness values are returned out of range.
Added the ikectl(8) "show sa" command to print information about the state of negotiated IKE SAs, their Child SAs and the resulting IPsec flows.
Enabled backlight control use on the Pinebook Pro via wsconsctl(8).
Fixed snmp(1) agent address parsing to allow IPv6 addresses to be used based on format, allow those without brackets to skip the port if it results in a nonsensical address (allowing use of ::1), and try to connect to the address immediately.
Fixed a crash when no device ports have been registered in ofw.
Taught i386 boot(8), cdboot(8) and pxeboot(8) about ffs2.
Added clock support for i.MX8MM.
Disabled apm(4) on the i386 floppy ramdisk.
Added bdpmic(4), a driver for the ROHM BD71837 and BD71847 Power Management IC.
Added support for reading the i.MX8MM temperature sensors to imxtmu(4).
Fixed absolute timeout checking in __thrsleep(2).
Added the MAXTSLP macro, the maximum sleep duration, to tsleep_nsec(9).
Updated to unbound(8) 1.10.0.
Switched USB to use non-coherent buffers for data transfers, dramatically improving performance on some ARM SoCs where the USB controller is not coherent with the caches.
Added an ikectl(8) "reset id" command to reset all SAs from policies with matching destination IDs.
Unlocked the flock(2) system call.
Reworked AMD smt/core/package detection, helping prevent cores being misidentified as threads.
Added panel support to rkanxdp(4).
Aggregated duplicate bgpd(8) roa table prefix/source-as combos as a single entry with the longest maxlen length.
Corrected iked(8) calculation of IPv6 address leases from small address pools.
Taught macppc boot(8) about ffs2.
Taught sparc64 boot(8) (but not the sparc64 bootblocks) about ffs2.
Bumped nvme(4) max physio() i/o size to 128K.
Resolved syscall speculation in armv7 cpus as in arm64, changing the system call ABI to skip two instructions and inserting speculation-blocking sequences.
Blocked apmd(8) autoaction for 60 seconds after resume, preventing spurious suspend/resume cycles.
Allowed hppa boot(8) to read from an ffs2 filesystem.
Added /dev/drm[0-3] on arm64.
Added a tmux(1) -d flag to run-shell to wait for delay before running the command (or delay with no command).
Added a tmux(1) copy-mode -H flag to hide the position marker in the top right.
Added tmux(1) C-g to cancel command prompt with vi(1) keys as well as emacs, and q in command mode.
Modified tmux(1) -S server socket to be created with umask 177 rather than 117.
Allowed alpha boot(8) to read from an ffs2 filesystem and adapted its custom installboot to deal with ffs2. Also fixed the partition read code to deal with offsets greater than 2G.
Used lfence in place of stac/clac on pre-SMAP CPUs to protect against Load-Value-Injection attacks against the kernel.
Fixed a kernel crash due to unlimited recursion caused by local outbound UDP broadcast/multicast packets sent by a spliced socket.
Unlocked the fnctl(2) system call.
Added a policy relookup to iked(8) to replace the default policy based on a received cryptographic parameter proposal.
Added ure(4) support for Lenovo OneLine Plus Dock Ethernet.
Prevented a panic due to missing sysctl(2) input validation.
Prevented a kernel hang when no unlocked ffs_softdep worklist items could be processed.
Adapted biosboot(8) so that it can read boot(8) from an ffs2 filesystem.
Fixed "ipmi0: sendcmd fails" errors when there is an ipmi(4) sensor which is enumerated but has failed to be read.
Improved ucom(4) to fix firmware upload on some microcontroller boards using DTR and RTS as signaling lines to reset the device and enter the bootloader.
Generated three different BIRD outputs with rpki-client(8) -B: v1 with IPv4 and IPv6 routes, and v2.
Added a PCI attachment driver for com(4) to support memory-mapped PCI devices which are part of a Low Power Subsystem (LPSS).
Updated perl(1) Term::ReadKey to 2.38.
Implemented microsecond resolution using microuptime(9) to avoid a hard hang when starting X on Intel Cherry Trail Atom processors.
Allowed amd64 boot(8) to read from an ffs2 filesystem. Enabled ffs2 for floppy.
Enabled the Rockchip video drivers.
Implemented the page fault handler for CMA GEM buffers and made drm(4) attach to rkdrm(4), making KMS work on the RK3399 SoC.
Stopped counting pages mapped as PROT_NONE against the RLIMIT_DATA limit, helping code which reserves large chunks of address space but populates it sparsely.
Fixed MiRA's sub-frame error rate computation.
Allowed loongson boot(8) to read from an ffs2 filesystem.
Fixed endian swapping in xhci(4), allowing it to work again on octeon and other big endian architectures.
Added rkdwhdmi(4), a driver for the HDMI transmitter found on the Rockchip RK3399 SoC.
Added support for X553 controllers to ix(4).
Introduced VPLL clock frequency setting to rkclock(4).
Implemented support for read transfers larger than 32 bytes for rkiic(4) controllers and registered the i2c bus, allowing future HDMI support.
Allowed arm64 and armv7 efiboot(8) to read from an ffs2 filesystem.
Injected failure to fetch entropy with an rdrand() timeout as an entropic event, along with an additional rdtsc measuring the vmexit latency.
Introduced mandoc(1) nodes which are semantically transparent, skipped when looking for previous or following high-level macros.
Worked around a race condition in iwm(4) interrupt handling, and synced the fix to iwx(4).
Introduced the sndioctl(1) utility to control audio parameters exposed by sndiod(8).
Added a check in vmm(4) for pvclock(4) struct crossing of page boundaries, which could potentially corrupt host memory.
Tightened rdmsr on svm in vmm(4).
Added a workaround for delayed SMR dispatch, starting the SMR thread when all CPUs are ready for scheduling.
Added the $REQUEST_SCHEME variable to httpd.conf(5), allowing preservation of the original connection type (http or https) for redirect locations.
Increased throughput of the ifq pressure drop mechanism for bwfm(4).
Fixed security vulnerabilities in smtpd(8). Corrected an out-of-bounds read in smtpd allowing an attacker to inject arbitrary commands into the envelope file to be executed as root, and ensured privilege revocation in smtpctl(8) to prevent arbitrary commands from being run with the _smtpq group. Released OpenSMTPD 6.6.4.
Added retries and timeouts for test packets to radiusctl(8).
Added usb(4) device support for an AMD hub on the APU2 and a Synaptics vendor id and two fingerprint readers.
Fixed a tcpdump(8) crash when printing the contents of a malformed packet where the packet length was smaller than the size of the usbpcap header.
Unlocked the ioctl(2) system call.
Added support for devaliases for vnet in ldom.conf(5).
Enforced that ksh(1) TMOUT is an integer literal to prevent command execution from the environment at shell initialization time.
Added rkanxdp(4), an attachment driver for anxdp(4) on the RK3399.
Added anxdp(4), a driver for the Analogix Display Port controller.
Added rkvop(4), a driver for the RK3399's Video Output Processors.
Added rkdrm(4), a driver providing kernel mode setting (KMS) functionality for the graphics hardware integrated on Rockchip SoCs.
Added transport mode for child SAs to iked.conf(5).
Worked around a panic when first accessing PCI config space on some rkpcie(4) cards by introducing a delay after link training.
Added support for devaliases for vdisk in ldom.conf(5).
Introduced a tmux(1) selection_active format for when the selection is present but not moving with the cursor.
Updated en_US.UTF-8.src to Unicode 12.1.
Ensured the first 2MB page of the amd64 kernel is correctly mapped read-only in the direct map.
Corrected http auth combined with proxy auth in ftp(1).
Corrected ftp(1) access to an https server with user/password through the "http_proxy" environment variable.
Detected and prevented simple ssh(1) configuration loops when using ProxyJump.
Fixed an mbuf corruption issue in net80211 hostap mode when overlarge SSIDs are used.
Added IPv6 support to umb(4).
Added openssl(1) s_client -tls1_3 and -notls1_3 options.
Addressed an arm64 speculative execution issue by changing the arm64 system call ABI to skip two instructions and inserting a barrier after each system call.
Fixed an issue where a vmm(4) guest could write to host memory by passing bogus addresses in pvclock(4).
Added -a to the list-keys command in tmux(1) to also list keys without notes with -N.
Introduced iwx(4), a driver for Intel AX200 WiFi devices.
Prevented buffer overflows with uthum(4) by not assuming the report length given by the hardware is necessarily smaller than the length of the on-stack buffer.
Pushed the KERNEL_LOCK() inside pgsigio() and selwakeup(), allowing separate addressing of the three subsystems: signal, poll/select and kqueue.
Fixed host(1) to provide the correct name of the server to query.
Released OpenSSH 8.2.
Implemented a workaround for missing Tx completion interrupts in iwm(4) which could lead to failed decisions to roam to other APs.
Checked battery life against autoaction level on power change events in apmd(8), making -z/-Z work with acpibat(4).
Removed ~/.digrc support in dig(1).
Added iwx(4) to fw_update(1).
Fixed the Pinebook Pro's trackpad by ensuring only hid_input items are accepted when walking the HID descriptor.
Added support for the RK3399's VOP clocks to rkclock(4).
Implemented "strip" option in httpd.conf(5) for fastcgi to be able to have multiple chroots under /var/www for FastCGI servers.
Moved dig(1) to /usr/bin.
Allowed use of window-htile and window-vtile with the "empty" group clients in cwm(1).
Extended the ipsecctl(8) parser to set the udpencap flag and port number of an SA.
Added ssh(1) -Q key-sig option for all key and signature types, teaching ssh -Q to accept ssh_config(5) and sshd_config(5) algorithm keywords as an alias for the corresponding query.
Fixed PIN entry bugs on FIDO ssh-keygen(1).
Updated to libfido2 780ad3c25.
Added support for handling hello retry requests in the ssl(8) TLSv1.3 client.
Added support for very old firmware umsm devices with umsm(4) rather than umb(4).
Added additional Apollo Lake pci(4) ids.
Added Pericom PI7C9X2G404EL PCIe packet switch pci(4) id.
Added additional Gemini Lake pci(4) ids.
Enabled rge(4).
Allowed mail.local(8) to be run as non-root, opening a pipe to lockspool(1) for file locking.
Added an sshd_config(5) "Include" directive to allow inclusion of files.
Unlocked the close(2) and dup(2) system calls.
Made acpivout(4) stop calling ACPI methods directly to allow changing brightness other ways on certain machines, including the x395.
Fixed a security vulnerability in smtpd(8) which could lead to a privilege escalation on mbox deliveries and unprivileged code execution on lmtp deliveries. Released OpenSMTPD 6.6.2.
Added support for the urtwn(4) tp-link tl-wn823n (TRL8192EU).
Added tmux(1) support for adding a note to a key binding with bind-key -N and using this to add descriptions to the default key binding. Using list-keys -N shows key bindings with notes. Changed the default ? binding to show a readable summary of keys.
Set the default brightness level on attachment for pwmbl(4).
Fixed pwmbl(4) attachment on the Pinebook Pro.
Updated to xserver 1.20.7.
Updated to libepoxy 1.5.4.
Added simplepanel(4), a driver for simple display panels. This allows enabling of the Pinebook Pro display panel.
Fixed dig(1) support for queries not on port 53, enabling dig -p as well as "set port=" in nslookup(1).
Added a new __tmfd __syscall(2) that creates a new, unnamed file in /tmp.
Prevented an amdgpio(4) interrupt storm seen on the Matebook D.
Added support for legacy message callbacks, making openssl(1) s_client -msg work for handshake messages.
Enabled umt(4) on arm64.
Completed the initial TLSv1.3 implementation.
Extended bgpctl(8) 'show neighbor' to include the received and set prefix count, as well as the max-prefix out limit if set.
Implemented bgpd.conf(5) max-prefix NUM out to limit the number of announced prefixes, avoiding leaks of full tables to upstreams and peers.
Retired mesh(4).
Switched to encrypted records in the TLSv1.3 server.
Enabled processing and use of signature algorithms in TLSv1.3.
Allowed dhclient(8) configuration of carp(4) interfaces.
Removed ssh-rsa (SHA1) from the list of allowed CA signature algorithms.
Implemented client hello processing in the TLSv1.3 server.
Implemented sending client certificate requests for the TLSv1.3 server.
Switched npppd.conf(5) to use pppac(4) instead of tun(4).
Added ssh-keygen(1) "find-principals" to look up the principal associated with a signature from an allowed-signers file.
Added pppac(4) code for a dedicated PPP Access Concentrator interface.
Recognized BCM4345 rev 9 as shipped with the Pinebook Pro as an AMPAK AP6256 module in bwfm(4).
Improved bwfm(4) on the Pinebook Pro by acking SDIO interrupts earlier on dwmmc(4).
Enabled the TLSv1.3 client in libssl, making it available to clients using libtls, including ftp(1) and nc(1).
Implemented support for SSL_peek() in the TLSv1.3 record layer.
Prevented a panic when trying to map a zero-length framebuffer node in the Pinebook Pro's u-boot.
Removed the rtfps(4) driver.
Removed diffie-hellman-group14-sha1 from the default ssh(1) key exchange.
Fixed cursor issues and suspend/resume on amdgpu(4) due to incomplete unmapping. This may help radeondrm(4) issues as well.
Updated to Mesa 19.2.8.
Allowed configuration of the ospfd(8) interface setting "type p2p" to be configured globally or per area.
Imported dt(4), a driver and framework for Dynamic Profiling, and an accompanying bug tracer that speaks the bt(5) language.
Made __thrsleep(2) and __thrwakeup(2) MP-safe.
Enabled mmhub power gating on picasso within amdgpu(4).
Fixed ftp(1) tls_handshake() usage, which would break ftp if an handshake wasn't successfully completed in one try.
Fixed ssh-keygen(1) not displaying the authenticator touch prompt.
Fixed support for additional I2C busses in piixpm(4) for older SB800 SMBus controllers. Prevented sensors from attaching four times on old AMD machines.
Added support for TLSv1.3 as a protocol to libtls, making tls_config_set_protocols(3) recognize and handle "tlsv1.3".
Introduced a new mdoc(7) macro .Tg ("tag") to explicitly mark a place as defining a term.
Invalidated the knote(9) list of uhid(4) after device detach, preventing a crash that can happen when kqueue still holds references to knotes pointing to the device.
Implemented ldomctl(8) "panic -c" to panic a guest domain (and enter ddb(4)).
Renamed ssh-add(1) -O to -K to load resident keys from a FIDO authenticator.
Implemented a df subcommand for snmp(1) which outputs disk and memory information in a df(1) format.
Implemented a -Cs option in snmp(1) for snmp walk and bulkwalk, allowing subsections of a tree to be skipped.
Added a -p command line option to iked(8) allowing configuration of the UDP encapsulation port.
Implemented "start -c" in ldomctl(8) to automatically connect to the console.
Allowed pfctl(8) to recursively flush rules and tables.
Removed IPsec flow blocking unencrypted IPv6 traffic in iked(8).
Fixed acpivout(4) screen brightness adjustment through function keys, better supporting machines using exponential brightness scaling.
Updated to libXt 1.2.0, xauth 1.1, xhost 1.0.8, viewres 1.0.6, fonttosfnt 1.1.0 and libXmu 1.1.3.
Added amlsm(4), a driver for the "secure monitor" firmware interface.
Added amltemp(4), a driver for the temperature sensors on various Amlogic SoCs.
Fixed Etron EJ168 USB 3.0 Host Controllers via USB 2 devices.
Unlocked kqueue(2).
Added the capability for armv7 boot from another block device than the one from which efiboot was loaded.
Added thermal sensor clocks to amlclock(4).
Removed the tmux(1) terminal type in favor of flags DECSLRM and DECFRA.
Added a human-readable mode (-h) to systat(1).
Introduced *sleep_nsec(9) to allow sleeping for a specified minimum duration, allowing use at the syscall layer and elsewhere within the kernel where this minimum duration is required.
Added support for the SIERRA MC7700 to umsm(4).
Removed the sli(4) driver.
Fixed channel duplication (-j option) in sndiod(8).
Prevented a kernel panic with "dangling vnode" during forced unmount.
Removed the dpt(4) driver for DPT EATA SCSI RAID.
Added an ADATA SX82000 Pro pci(4) id.
Added -Z to the default tmux(1) switch-client command in tree mode.
Allowed use of the smtpd(8) session username in built-in filters when available.
Corrected verification of TLS certificates in nc(1).
Implemented scrolling in top(1) using the 9 and 0 keys.
Allowed ipmi(4) to attach using mmio.
Updated to xorgproto 2019.2, libX11 1.6.9, libXi 1.7.10, libXvMC 1.0.12, libxkbfile 1.1.0 and libXpm 3.5.13.
Allowed freeing of anons as a list of pages rather than one at a time, allowing for more efficient memory freeing.
Introduced a -n option to ldomctl(8) to validate the configuration file and exit.
Prevented a use-after-free causing crashes with uhidev(4) devices.
Fixed RAID volume WWIDs for mpii(4) LSI controllers on sparc64, allowing autoconf(9) to identify the volume as the root device and boot off hardware RAID.
Added timeout_set_flags(9) and TIMEOUT_INITIALIZER_FLAGS(9), allowing the caller to initialize timeouts with arbitrary flags.
Added the ability to download FIDO2 resident keys from a token via the ssh-keygen(1) -K option and save public/private keys into the current directory.
Unlocked pipe(2) and pipe2(2).
Introduced option filter-pf-addresses to snmpd.conf(5), allowing the OPENBSD-PF-MIB::pfTblAddrTable tree to be filtered out when many prefixes are stored in pf tables, reducing CPU usage during bulk walks.
Introduced efficient page freeing in reverse order from uvm, greatly improving cases of massive page freeing.
Prevented read-only tmux(1) clients from limiting the size.
Stopped performing a top-level sort(1) when -c is used with a -k field.
Added ne(4) support on cbus(4).
Implemented support for generating FIDO2 resident keys. "ssh-add -O" will load resident keys from a FIDO2 token and add them to an ssh-agent. Removed the -x option currently used for the FIDO/U2F-specific key flags, now under -O.
Removed single letter flags for moduli generation in ssh-keygen(1) and moved all moduli generation options to under the -O flag. Breaks existing ssh-keygen commandline syntax for moduli-related operations.
Updated perl to 5.30.1.
Stopped switching to new APs found during background scans with RSSI levels which will also trigger background scans, helping to prevent repeated switching in areas where APs are tuned for low transmit range.
Increased the net80211 node cache size.
Updated to xterm(1) 351.
Populated logical disk port WWNs with their RAID volume's WWID in mpii(4).
Ran cu(1) in restricted mode using -r in vmctl(8) and ldomctl(8).
Attached Symbios Logic Flash Accelerator eMLC cards.
Added support for regex searches in tmux(1) copy mode.
Stopped generating "cpu" nodes for disabled CPUs in ACPI mode for efiboot, fixing booting on ACPI machines where the MADT table lists CPUs which are disabled.
Added point-to-point ospf6d(8) support for broadcast interfaces.
Introduced TIMEOUT_SCHEDULED flag and tos_scheduled statistic to timeout(9).
Updated to makedepend(1) 1.0.6.
Updated to xrdb(1) 1.2.0.
Ensured rdr-to with loopback destination will work even when IP forwarding is disabled.
Added amdgpio(4), a driver for the GPIO controller found on newer AMD SoC/chipsets.
Added arm64 support for lldb.
Prevented ftp(1) from following remote redirects to local files.
Allowed forwarding of a different agent socket to a specified path in ssh(1).
Reduced stalling with lossy wifi by improving net80211 handling of the Rx block ack sequence number window and queue.
Disabled TSX when MSR_ARCH_CAPABILITIES sets TSX_CTRL on amd64 and i386. Currently, TSX is disabled unconditionally when possible even if TAA_NO is set.
Fixed rpki-client(8) -j option, which had not been producing any output.
Validated authentication lengths in ripd(8) before use to prevent crashes.
Updated to unbound(8) 1.9.6.
Updated to nsd(8) 4.2.4.
Reenabled firmware-based Tx retries at lower rates for iwm(4), reducing packet loss.
Implemented unwindctl(8) status memory to show cache memory usage.
Avoided false positives in witness(4) when detecting lock order reversals by using separate rwlock initializations for userland and kernel maps.
Fixed arm64 speculative execution of instructions after ERET, which had led to spectre-like effects on some processors.
Rejected leases in dhclient(8) not providing a subnet mask for the address being provided.
Added fido(4), an HID driver for FIDO/U2F security keys.
Added parsing of DDR4 and LPDDDR3/4 SPD memories to spdmem(4).
Updated bind to 9.10.8-P1, the last ISC-licensed release.
Added support to lm(4) for NCT6775F, NCT5104D, NCT6779D and NCT679[1235]D sensors.
Added AMD FCH (KERNCZ) to the list of supported devices in piixpm(4).
Updated piixpm(4) to support newer AMD chips like Hudson-2 and KERNCZ and implemented multi-bus support for SB800, Hudson-2 and KERNCZ.
Extended the expected SPD types to include DDR4 and low-power DDR3/DDR4.
Added pledge(2) inet to dig(1).
Updated bind to 9.10.5-P3. This tree is only used to build host(1), dig(1) and nslookup(1).
Made rpki-client(8) work with the existing cache and not exit if rsync(1) exits non-zero.
Allowed ssh(1) security keys to act as host keys as well as user keys.
Added support for gen2 negotiation to rkpcie(4) and enabled gen2 link state training when the dtb is configured with max-link-speed = 2.
Introduced a bypass keyword to smtpd(8) so that built-in filters can bypass processing when a condition is met.
Updated to libXfont2 2.0.4.
Updated to font/util 1.3.2.
Updated to font/encodings 1.0.5.
Tightened permissions for USB device nodes.
Removed gpr(4).
Used ssh-sk-helper for all security key signing operations and security key enrollment. Most ssh(1) tools no longer need to link against libfido2 or interact with /dev/uhid* directly.
Added support for CIDR in a: spf atoms in smtpd(8).
Attached pvclock(4) with a lower priority in case of unstable tsc rather than not attaching at all.
Prevented an overflow due to xen(4) failing to release the interrupt source when unmasking the interrupt.
Reintroduced socket locking inside socket event filters.
Fixed an issue where adjtime(2) could be set so low that time could be frozen until reboot.
Allowed sleeping inside kqueue event filters.
Prevented a hang in the boot loader on the HP EliteBook 830 G6.
Modified tmux(1) source-file to allow reading from stdin.
Updated to X server 1.20.6.
Started virtual machines defined in vm.conf(5) in a staggered fashion, helping prevent overload of the host and improper tsc calibration in guests.
Modified ldpd(8) to lookup the adjacency by LSR id as well as source IP address, as the remote peer may change its LSR id.
Ensured that ld.so(1) removed the LD_LIBRARY_PATH environment variable for set-user-ID and set-group-ID executables in low memory conditions.
Provided proper concurrency control when pausing a vm in vmd(8).
Fixed isakmpd(8) IKE pcap file creation.
Fixed empty response packages sent out by ripd(8) when entries are skipped due to split-horizon simple.
Swapped smtpd(8) filter response protocol fields to match query protocol. Filters used will need updating.
Re-enabled "syscall call-from" checking.
Modified -z mode verification in signify(1) to save the header and output it, so signify -zV >saved.tgz will keep the signature for later checks.
Reduced the maximum number of frame buffers for uvideo(4) to allow running higher resolutions without running out of kernel memory.
Removed kernel VM86 support.
Added a check when IP forwarding is disabled to ensure packet destination address matches interface address.
Reset the login class each time through the loop when using -L (loop) mode with su(1). Fixes CVE-2019-19519.
Retired piixpcib(4).
Stopped hardcoding the cache directory for rpki-client(8). Cache and output directory will use defaults for root users and must be specified by non-root users.
Enabled full use of jumbo frames on bnx(4) devices.
Added DEBUG_PKG_CACHE functionality to pkg_add(1), fetching debug patches when packages are installed.
Fixed xenodm(1) to use the libc authentication layer correctly.
Fixed insufficient username validation performed by libc's authentication privilege separation layer and added additional validation points, further validating in login(1) and su(1).
Fixed a panic when tearing down vms with vmm(4).
Prevented a radiusd(8) crash when user does not exist.
Prevented escalation to the auth group in xlock(1) through path-related environment variables and disabled mesa and opengl functionality.
Added display of mode sense data to scsi(8) debug.
Added pwmfan(4), a driver for PWM-regulated fans.
Added rkpwm(4), a driver for the RK3399's PWM controller.
Added support for the RK3399's PWM clock to rkclock(4).
Added tcpdump(8) support for printing RFC 8300 Network Service Header (NSH).
Added tcpdump(8) support for VXLAN-GPE.
Rewrote dhcpv6 parsing in tcpdump(8) to match the rfc, correctly handling dhcpv6 messages.
Assumed grep(1) -R passed with "." rather than printing a warning by default.
Reverted switch to tickless backend.
Allowed forcing specific domains to be resolved by specific resolvers in unwind.conf(5), handling typical split-horizon setups.
Simplified sysupgrade(8) directory check and creation (/home/_syspatch). It can now be a symlink.
Accepted netmask for IPv6 properly in ifconfig(8).
Added a create-vdisk command to ldomctl(8) analogous to amd64's vmctl(8) create.
Added uvm_objfree to uvm to efficiently free all pages from a uvm object, used in the buffer cache for considerable speedup when freeing pages.
Added rkemmcphy(4), a driver for the RK3399's eMMC PHY.
Added support for the RK3399's eMMC clock to rkclock(4).
Introduced msyscall(2), permitting system calls from selected code regions only: the main program, ld.so(1), libc.so and sigtramp. This is intended to harden against a mixture of W^X failures and JIT bugs allowing syscall misinterpretation.
Modified root's crontab(1) to run rpki-client(8) and reload bgpd(8) configuration, enabling RPKI ROA filtering.
Modified buffer cache to use individual uvm_objs per buffer to speed page lookups.
Decayed the unwind(8) resolver histogram data over time to reflect strategy performance.
Removed the -r flag in rpki-client(8). CRLs will always be checked.
Added the "console" command to ldomctl(8) which executes cu(1) on the domain's console.
Printed guest domain vcctty(4) devices in status output in ldomctl(8).
Removed km_mapblocks from kmemstats and its always-zero column from the ddb(4) "show malloc" output.
Implemented a hexdump command in the bootloader, helping to inspect the memory layout created by the firmware and useful for UEFI debugging.
Added list-io command to ldomctl(8), listing the available PCIe devices to be used with the iodevice parameter in ldom.conf(5).
Measured performance of resolving strategies in unwind(8), sorting them and choosing the next best strategy when one fails.
Removed captive portal detection from unwind(8).
Reinstated support for monitor mode and multiple frames in iwm(4).
Updated GLU to 9.0.1.
Updated libdrm to 2.4.100.
Added support for TLS 1.3 post handshake handshake messages and key updates to LibreSSL.
Fixed scsi(8) softraid crypto volumes on 4K-sector disks.
Faked disk info to match expected boot disk when EFI bootloader has been received via TFTP, fixing a hang during HP Elitebook UEFI boot.
Fixed kernel crash in pf_ioctl with WITH_PF_LOCK and NET_TASKQ > 1.
Switched to tickless backend in timeout(9), adding new interface timeout_at_ts(9) to avoid backwardly compatible behavior.
Allowed use of 'auth' as an origin in smtpd.conf(5).
Added support for MSI-X for iwm(4) devices.
Allowed use of mail-from and rctp-to as for and from parameters in smtpd.conf(5).
Computed RSSI on 9k iwm(4) devices as for previous generations, fixing spurious signal strength values of over 100%.
Added a tmux(1) p format modifier for padding to width.
Stored smtp(1) session usernames in an envelope, allowing the ruleset to match specific users or mailing addresses.
Added "no-touch-required" options to ssh-keygen(1) and sshd(8) to disable touch requirement for authorized_keys and certificates.
Added an sshd_config(5) PubkeyAuthOptions directive allowing specification of whether sshd(8) should check whether user presence was tested before a security key was made.
Withdrew all proposals on slaacd(8) startup to prevent indefinite retention of nameservers on interfaces no longer flagged for autoconf.
Prevented a timeout in ssh(1) when the server doesn't immediately send a banner, such as with multiplexers like sslh.
Allowed rc.d(8) script to reload sndiod(8).
Added tracking of which interfaces have learned nameservers to unwind(8).
Improved ksmn(4) temperature conversion precision.
Added a quirk to handle Apollo Lake, Gemini Lake and 100 Series Intel SD/MMC sdhc(4) controllers which should not have voltages set to 0V.
Added Gemini Lake SD/MMC controller pci(4) ids.
Ensured proper kernel stack alignment on mips64, fixing a panic on octeon related to pppoe(4).
Adjusted on-wire signature encoding for ecdsh-sk ssh(1) keys to better match ec25519-sk keys.
Fixed an off-by-one TRB issue in bulk transfers larger than 64k, making udl(4) work on xhci(4).
Added iwm(4) support for 9260 and 9560 devices.
Enabled ESP UDP-encapsulation with the iked(8) -t flag.
Added -keyopt option to openssl(1) cms subcommand, providing rsa_padding_mode:oaep for cms -encrypt and rsa_padding_mode:pss for cms -sign.
Added -f for full size to join-pane in tmux(1).
Added rge(4), a new driver for Realtek 8125 PCI Express 2.5Gb ethernet devices.
Repaired the "set delay" option for pf(4) to function as specified in pf.conf(5).
Added the initial framework for the TLSv1.3 server.
Used disable-bt overlay with raspberry pi to use pluart(4) as console, rather than the 'mini uart'.
Added a -d option to pkg_add(1) to add debug packages if present alongside intended updates or additions.
Fixed a segmentation fault in ncurses(3).
Implemented HTTP/1.1 in ftp(1).
Added direct support for U2F/FIDO2 security keys in ssh(1).
Began resolving captive portal hosts internally in unwind(8).
Changed tmux(1) new-session -A to attach to the best existing session when a session name is not specified, rather than creating a new session.
Added an option to tmux(1) to set the key sent by backspace for systems using ^H.
Prevented non-root users from using ioctl(2) to alter the address of a network interface.
Prevented non-root users from setting the parameters of pppoe(4) interfaces.
Prevented a local user from causing the system to hang by reading specific registers when Intel Gen8/Gen9 graphics hardware is in a low power state.
Prevented writes to memory allowed by the Intel Gen9 graphics hardware.
Notified the user via TTY or $SSH_ASKPASS when ssh(1) security keys must be tapped/touched in order to perform a signature operation.
Enabled ed25519 support in ssh(1).
Fixed iwm(4) support and loaded new firmware for 3168 devices.
Enabled rpki-client(8).
Printed the URL when sysupgrade(8) fetches new sets.
Prevented a crash in ieee80211_node2req() which could be triggered by an ioctl(2) if the driver had not yet initialized the channel map.
Implemented DNS proposals in unwind(8) to learn nameservers from network autoconfiguration daemons.
Moved /usr and var remounting earlier to allow unwind(8) to start before pf(4) is configured.
Added a Content-Security-Policy HTTP header to mandoc(1) that allows only CSS.
Added an opportunistic run of fw_update(1) to sysupgrade(8) before rebooting to run the upgrade.
Introduced a "trusted" modifier to ntpd(8), for peers which should be on a local net, used in situations where https constraints cannot be used but auto settime is desired.
Stopped connecting to available open wifi networks when an interface is marked up. This behavior must now be explicitly enabled with ifconfig(8) join "".
Added support for active scan to bwfm(4).
Lowered the priority of APs which fail to connect in the ifconfig(8) join list, allowing switching wifi networks by moving between them without having to down/up the interface or suspend/resume.
Triggered a background scan when root runs the ifconfig(8) scan command, updating the list of cached APs for future scans and forcing a search for a better AP to roam to.
Switched 8260 and 8265 iwm(4) devices to -34 firmware.
Added support for buttons 2 and 3 to imt(4).
Enabled DNSSEC validation in unbound(8) by default.
Prevented non-root users from setting the WEP key on an(4) wireless network devices.
Added -F flag to tmux(1) send-keys to expand formats in search-backward and forward copy mode commands.
Performed constraint validation against 9.9.9.9 and 2620:fe::fe by default in ntpd.conf(5).
Fixed a bug where outstanding frames on the iwn(4) aggregation queue interfere with roaming to another AP.
Raised net80211's "beacon miss" threshold to avoid frequent reconnects to APs suffering packet loss due to distance.
Removed mobileip(4).
Added ogx(4), a driver for the OCTEON III network processor.
Reinstated OpenSSL(1) CMS.
Switched iwm(4) 3160, 7260 and 7265 to -17 firmware images.
Enabled DQA mode for iwm(4).
Added support for iwm(4) firmware paging, required for newer 8k device firmware.
Fixed a possible crash in smtpd(8) when combining "from rdns" with nested virtual aliases under a particular configuration.
Released smtpd(8).
Added opportunistic DoT support to unwind(8).
Hooked rpki-client(8) up to the build.
Enabled CMS in ssl(8).
Added initial infrastructure for U2F/FIDO support in ssh(1).
Constrained and corrected the routes being deleted when applying a new lease in dhclient(8) and corrected route comparison. This corrects a network failure with "arpresolve: ... route contains no information".
Released OpenBGPD 6.6p0.
Added support for RSA-PSS to crypto(3).
Added an ASR resolver type to unwind(8), using the libc asynchronous resolver directly with DHCP-provided nameservers. Switched to the ASR resolver rather than DHCP when behind a captive portal.
Made background scans less frequent when choosing the same AP.
Began marking stale prefixes in the Adj-RIB-out during graceful reload of bgpd(8) and fixed prefix_withdraw to check the correct prefix flags before removing a prefix from the update or withdraw tree.
Added an Intel 9260 wifi card pci(4) id.
Added Marvell 88SE9128 AHCI pci(4) id.
Fixed a bug with the fatal bgpd(8) non-existing prefix call to ensure the missing prefix is inserted into the prefix tree.
Fixed bgpd(8) crashes where the nexthop_runners tail queue was corrupted.
Improved error handling for bwfm(4) connection attempts.
Added code laying groundwork for the use of multiple processors on armv7.
Made vmx(4) transmit mp-safe.
Corrected clock_getres(2) to provide the actual resolution of a given clock.
Released OpenSMTPD 6.6.0.
Allowed switching to framebuffer "glass" console on armv7, mirroring previous changes to arm64.
Added retguard for octeon/mips64.
Added a missing unveil(2) of /etc/shells for passwd(1).
Printed IP addresses in verbose mode in nc(1).
Reverted change to nc(1) fixing the -N flag due to regress failures for tls.
Added sxisid(4), a driver to read the on-chip eFuses.
Added new -N name option to ftp(1), allowing calling scripts to change the progname and produce better error messages.
Updated timezone information to reflect DST changes for Fiji and Norfolk Island.
Rewrote the time validity check for mtfs in rpki-client(8) to correctly account for the timezone.
Added the system clock interface nanoboottime(9), returning the UTC time at which the system booted in seconds and nanoseconds.
Added sxipwm(4) and pwmbl(4), drivers which jointly add support for the backlight controller on the Pinebook.
On newer ThinkPads reporting HKEY version > 1, allowed acpivout(4) to claim backlight controls rather than wscons(4), allowing use of the fine-grained backlight BCL steps defined in acpi(4).
Changed acpivout(4) to increment and decrement screen brightness based only on brightness level changes of 5% or higher.
Prevented an infinite loop when aborting ulpt(4)'s pipe after an I/O error.
Implemented the "parallel boot" feature on compatible sparc64 firmware.
Corrected a memory leak in unwind(1) when the list of DHCP resolvers doesn't change.
Stopped checking whether the IPv6 source address of a neighbor advertisement is from a neighbor's address, not required in accordance with RFC 4861.
Added support for dynamic queue allocation (DQA) to iwm(4).
Corrected cache flush operations on arm64 which were being incorrectly treated as write operations. This fixes a bug where cache flushing caused Firefox to abort.
Fixed the -N flag for nc(1) to shut down the socket when input stops, or when tls is in use and either side of the socket goes away.
Added rpki-client(8) output formats for bird and CSV.
Fixed a potential NULL dereference for revoked hostkeys in ssh(1).
Added support for percentage sizes to tmux(1) resize-pane ("-x 10%") and changed split-window and join-pane -l to accept similar percentages, deprecating the -p option.
Made sparc64 autoconf(4) try to match the devid against the bootpath if link->port_wwn doesn't work, helping when booting off of an mpii(4) controller.
Used unveil(2) to reduce filesystem access in vmstat(8), iostat(8) and systat(1).
Changed httpd(8) to send a 408 response when a timeout happens while headers are being received, but close the connection if no request is received.
Added an azalia(4) quirk for the ALC285 on the X1C7 to avoid a clicking noise on the headphone output.
Moved to 6.6-current.
--------
Changes made between OpenBSD 6.5 and 6.6
Fixed a use-after-free in iwm(4) interrupt handling.
Fixed a bug probing BCM2835 (Raspberry Pi) devices.
Released LibreSSL 3.0.2.
Stopped setting the IPv4 address in umb(4) unless both address and gateway information are available.
Prevented an acpi(4) panic when reading past the end of an AML array.
Released OpenSSH 8.1.
Returned to counting packets rather than operations to manage interface load.
Added an option to dump rpki-client(8) data in JSON format.
Added moxtet(4), a driver for the Turris Mox modules.
Added mvspi(4), a driver for the SPI controller on the Armada 3700 SoC.
Added SPI clocks to mvclock(4).
Added the amliic(4) and pcxrtc(4) drivers to the arm64 ramdisk kernel, adding support for the RTC on the odroid-n2.
Added amliic(4), a driver for the I2C controller found on Amlogic SoCs.
Synced arm64 pbuild resource limits with amd64 to allow building larger packages.
Fixed stalls seen in tcpbench(1) for dwge(4) and dwxe(4).
Added amlclock(4) support for i2c clocks.
Added amlpinctrl(4) support for i2c pins.
Fixed net80211's accounting of discarded input control frames.
Added a workaround for cdn.openbsd.org occasionally responding with a 503 by attempting a single additional fetch with ftp(1).
Added a workaround for Cortex-A73 errata 858921.
Updated unbound(8) to 1.9.4 and fixed CVE-2019-16866, which could cause Unbound to crash upon receiving a certain query from addresses allowed by Unbound's ACL.
Added support for setting the CPU clock frequencies to amlclock(4), enabling DVFS.
Fixed a padding oracle in PKCS7_dataDecode and CMS_decrypt_set1_pkey, a port of Edlinger's Fix for CVE-2019-1563.
Stopped calling fatal() when pftable additions and deletions mix in bgpd(8).
Fixed a problem where valleyview and cherryview machines would be flooded by HPD events, and allowed both to boot without a display connected.
Properly initialized dhcpd(8) icmp(4) echo requests to zero to avoid leaking four bytes of uninitialized memory.
Implemented the "set" subcommand in snmp(1).
Updated Spleen kernel fonts to 1.5.0.
Mixed information from portions of sysctl hw into /dev/random as part of rc(8) to increase entropy.
Recognized Cortex-A34 and Cortex-A65AE.
Began pruning some unused items at the point of upgrade to help prevent an over-large /usr directory after multiple upgrades.
Enabled CPU voltage regulators for armv7 and arm64.
Added pwmreg(4), a driver which implements a voltage regulator that uses a PWM controller to set the voltage.
Added amlpwm(4), a driver for the PWM controller found on various Amlogic SoCs.
Replaced dwge(4) with a new driver based on dwxe(4).
Added IPI support to armv7.
Made umb(4) add a default route when configuring the interface, to be used only when no other interface is available.
Implemented bgpctl(8) show rib 8.8.8.8 or-shorter to show all routes covering 8.8.8.8.
Added ksmn(4), a driver for the temperature sensor available in the AMD Family 17h processors (Zen/Zen+/Zen2).
Added AMD64 17h/3xh Root Complex device pci(4) id.
Retired support for the sgi platform.
Prevented disconnections due to messages being ignored when the same AP delivers packets on a new channel.
Enabled eephy(4) on octeon.
Added support for Marvell 88E1545 to mii(4).
Fixed a vmd(8) memory leak in the virtio(4) network TX path.
Implemented DVFS support on armv7.
Allowed sysctl(8) to work in single-user mode by ignoring unveil(2) errors on paths which don't exist because /var is not mounted.
Enabled thermal zone handling code for armv7.
Registered sxitemp(4) as a thermal sensor.
Implemented setting the CPU clock for Allwinner A10/A20 SoCs in sxiccmu(4).
Added a -F option to sndiod(8) allowing alternate devices to be specified and a -Q option to specify an alternate MIDI port. It is now possible to switch between devices without disconnecting clients.
Added A20 GMAC clocks to sxiccmu(4).
Added a basic implementation of SRS to smtpd(8).
Added the RK3328 and RK3399 GMAC clocks to rkclock(4).
Implemented server certificate validation in smtp(1).
Added snmp(1) support for some HP LaserJet systems.
Added initial SNMPv3/USM support to snmp(1).
Updated NSD to 4.2.2.
Added support for binary protocol health checking to relayd(8).
Fixed sd(4) to stop issuing unhandled READ CAPACITY 16 commands to older USB devices, preventing them from returning bad data for number of sectors.
Made startx(1)/xinit(1) work again on modern systems using inteldrm(4), radeondrm(4) and amdgpu(4).
Added octpip(4), a driver for the Octeon packet input processing unit.
Implemented hardware vlan tagging in iavf(4).
Corrected multiple unveil(2) violations due to login.conf.db access and stat(2) on _PATH_MASTERPASSWD_LOCK.
Allowed quoted SSIDs in the installer, rather than ignoring those containing whitespace.
Made wireless drivers call if_input() only once per interrupt, reducing drops caused by the ifq pressure drop mechanism and increasing throughput.
Updated unbound(8) to 1.9.3.
Prevented a potential panic caused by vmm(4) decrementing the number of VMs twice in one of the vm_create() error paths.
Added information about system call memory write protection and stack mappion violations to system accounting. Now daily(8) will print a list of affected processes and lastcomm(1) will flag violations with 'M'.
Increased datasize-cur for pbuild in login.conf(5) to 4GB for sparc64.
Enabled nvme(4) on octeon.
Added octpcie(4), a driver for the PCIe controller found on OCTEON II and OCTEON III.
Added sfp(4), a driver allowing communication with SFPs connected over an I2C bus and reading pages over the SFP framework.
Added SFP and I2C ofw frameworks.
Removed tz, the kernel timezone.
Disabled base-gcc on armv7.
Allowed prepending a list of algorithms to the default set in ssh(1) by starting the list with the ^ character.
Added mcprtc(4), a driver for the Microchip MCP79400 RTC and similar.
Added mviic(4), a driver to support the I2C controller on the Armada 3700 SoC.
Added I2C clock gates to mvclock(4).
Added support for filter-reports to smtpd(8), allowing filters to send freetext reports to other filters/report handlers.
Added mvdog(4), a driver to support the watchdog on the Armada 3700 SoC.
Fixed a crash at power down when Supermicro X8DTH-i/6/iF/6F fails to attach uhci(4) via PCI and AHCI.
Added support for the Allwinner H6 to sxipio(4) and sxiccmu(4).
Fixed a potential endless loop when em(4) is in an error state.
Added the set_blksz() and set_nblks() audio(9) driver functions, allowing audio drivers to easily set the block size, matching both playback and recording constraints.
Introduced "junk" built-in filter actions to smtpd(8).
Added support to amlclock(4) for obtaining CPU clock frequency.
Enabled amlmmc(4), a driver for the SD/MMC controller found on various Amlogic SoCs.
Added clang(1) support to macppc.
Dropped support for building with gcc(1) on armv7.
Added bnxt(4) support for MSI-X.
Added sshsig, a lightweight signature and verification ability for OpenSSH, to ssh-keygen(1). Signatures can be made and verified using ssh-keygen -Y sign|verify.
Implemented setting the CPU clock for Allwinner A64 SoCs in sxiccmu(4).
Made net80211 expose reasons for association failures to have ifconfig(8) display them in "scan" output and on the ieee80211(9) status line.
Reset the current wireless PHY mode to "auto" when a scan begins if in media autoselect mode, preventing AP selection error when an interface has been switched to a fixed PHY mode.
Fixed a tap-detection code error in wscons(4) that may prevent handler switching to the DETECT state when necessary.
Removed configured IPv6 addresses remaining when slaacd(8) detects a link-state change but no new router advertisement.
Added amldwusb(4), amlusbphy(4) and amlpciephy(4), drivers for the USB controller and PHYs on the Amlogic G12A/B SoCs.
Prevented WPA APs from appearing as non-WPA to the AP selection logic if the driver announces RSN support.
Added ure(4) support for RTL8153B.
Fixed iwm(4) frame length check.
Used acpi(4) information to attach amd64 PCI busses as on arm64.
Used unveil(2) at startup for ping(8) and traceroute(8) to render the filesystem read-only.
Built and enabled amdgpu(4) on arm64.
Added amlpinctrl(4), a driver to configure pins and control GPIOs on Amlogic SoCs.
Added support for ethernet on Lenovo USB-C docks.
Disabled base gcc(1) on i386.
Kept ieee80211_node(9) structures cached across scans.
Added imxtmu(4), a driver to upport the temperature sensors on i.MX8M SoCs.
Fixed a crash resulting from radeondrm(4) error handling.
Added amlrng(4), a simple random number generator driver for Amlogic SoCs.
Ensured -n is honored when deleting entries in arp(8).
Added amclock(4), a driver for the Amlogic SoC clocks.
Began reporting qsfp monitor values in ifconfig(8).
Added amlreset(4), a driver to support signal controller blocks on Amlogic SoCs.
Fixed a kernel crash with pf(4) when "set timeout interval 1" was used in pf.conf(5).
Added amluart(4), a driver for the UARTs found on various Amlogic SoCs.
Allowed for "port smtp" and "port smtps" on listen statement in smtpd(8).
Fixed an iked(8) conflict when IKE SA and Child SA rekeying happened at the same time, resulting in lost messages.
Added Comet Lake pci(4) ids.
Ensured -n is honored when setting ndp(8) entries.
Stopped smtpd(8) processing of records of unexpected types, fixing an issue where CNAME records generate bogus results.
Fixed incorrect vmctl(8) output when using vmctl stop with no further arguments.
Added Intel 100 series LP eMMC/SDXC and Intel WHL-U Host pci(4) ids.
Added kern.utc_offset to sysctl(2). This is a successor to the DST/TIMEZONE options(4), which are incompatible with KARL. Also switches to using an offset in minutes east of UTC.
Lowered sysupgrade(8) timeout to 30 minutes per set.
Fixed a race condition in the invalidation of remote TLB entries for mips64.
Removed support for semantically opaque interface identifiers (RFC 7217) for IPv6 link local addresses.
Increased the /usr auto-allocation size in disklabel(8).
Switched to loading the TAL installed in /etc/rpki by default in rpki-client(8). Added a -t tal option to pass in TAL files by hand and set the argument to the filename of the output file.
Added a configuration option for reverse scrolling to wsmouse(4).
Added support for additional Elantech-4 touchpad models.
Increased default datasize for pbuild in login.conf(5) to 6GB.
Added support for the SMBus System Interfaces (SSIF) to ipmi(4).
Restored MSRs and PAT on main CPU after resume, potentially improving performance of the console on many amd64 machines.
Enabled TCP and UDP checksum offloading by default for ix(4).
Added missing sxiccmu(4) OHCI clocks for the Allwinner R40.
Implemented Linux compatibility acpi(4) interfaces and enabled the ACPI support code in radeon(4) and amdgpu(4).
Removed snmpctl(8) in favor of snmp(1).
Fixed a segfault in the iked(8) parser when specifying an invalid transform.
Prevented a race condition where the acct(2) syscall and accounting thread both tried to close a vnode.
Fixed an iked(8) NAT traversal detection bug when "local" option is not explicitly set.
Implemented backlight control for amdgpu(4), allowing setting of the backlight using wsconsctl(8).
Modified azalia(4) to enable speaker routing on the ThinkPad X1C7.
Fixed a segmentation fault in awk(1).
Allowed PXE booting using U-Boot by relaxing requirements of the EFI PXE protocol.
Enabled amdgpu(4) on amd64.
Added Union Memory NVMe pci(4) ids.
Modified ospfd(8) to warn when a neighbor changes its source IP address.
Ensured that mail rejected by the LMTP server in smtpd(8) will stay queued, rather than bouncing.
Added clock support to sxirtc(4), needed by newer Linux DTs.
Added sxisyscon(4), a driver for the system controller found on various Allwinner SoCs.
Fixed pluart(4) output when a machine is under load.
Imported from OpenSSL 1.1.1 to ultimately support CMS in crypto(3).
Moved to 6.6-beta.
Used unveil(2) to restrict ldpd(8) filesystem access.
Added TSC synchronization for multiprocessor machines and re-enabled TSC as the default amd64 time source.
Imported snmp(1), a new snmp client which aims to be netsnmp-compatible for supported features.
Added --address argument to openrsync(1) to bind to the specified address when connecting to an rsync daemon.
Began supporting WPA2 CCMP encryption/decryption in hardware with iwm(4).
Disabled filesystem access for dhcpd(8) invoked with -A/-C/-L through use of unveil(2).
Removed -d dst and -t minutes_west from date(1) as part of the kernel timezone removal effort.
Added recognition of the azalia(4) Realtek ALC285.
Mitigated CVE-2019-1125, a potential exploit utilizing a variant of the Spectre side-channel vulnerability in Intel CPUs built since 2012.
Added uvideo(4) support for dual functions on integrated USB cameras.
Added uvideo(4) support for the KSMedia 8-bit IR format.
Improved bgpd(8) RIB reload behavior and removed 'route-collector yes|no' from the bgpd config in favor of 'rde rib Loc-RIB no evaluate', which can be altered during runtime.
Fixed random kernel hangs on some sparc64 machines by blocking interrupts while sending an IPI on sunv4 (as on sun4u).
Fixed vnode leak bugs in unveil(2) and realpath(3) where namei(9) reference counted the equal parent and lookup vnode twice.
Implemented smbios(4) support on arm64.
Increased maxusers to 80 on arm64, allowing growth up to 128.
Ensured a one-shot-upgrade on compatible systems by having the bootloader us fchmod -x upon discovering and opening /bsd.upgrade, so that the file cannot be re-executed on the next boot.
Added Ampere vendor and eMAG PCIe pci(4) ids.
Fixed an smtpd(8) crash on excessively large input.
Fixed a umount(8) device busy error when unveil(2) and chroot(8) are used together.
Added tpmr(4), an 802.1Q two-port MAC relay implementation.
Fixed dual booting of MacOS 9.2.2 formatted disks.
Enabled the AUTOCONF4 dhclient(8) flag, set on startup and able to be set/unset by ifconfig(8).
Prevented a panic when setting up a gre(4) tunnel when IPv6 duplicate address detection sends a packet too soon.
Made nc(1) proxy auth work with http 1.1-speaking webservers.
Added support for 802.11n Tx aggregation to net80211 and iwm(4).
Added iavf(4) driver for Intel Ethernet Adaptive Virtual Functions compatible with SR-IOV virtual functions of Intel 700 series and newer ethernet controllers.
Added octeon bootloader to files copied to the boot partition. To use the bootloader, the firmware must be configured to load file "boot" instead of "bsd."
Increased the maximum channels for uaudio(4) devices from 16 to 64.
Fixed booting from nvme(4) on sparc64.
Moved ldomd(8) configuration format from ldomctl(8) into ldom.conf(5).
Added recognition of sparc64 PCI buses which don't support INTx.
Added Sun Static Direct I/O pci(4) ids.
Added checks for programs trying to access files hidden by unveil(2) and added these violators to the lastcomm(1) output and daily mail.
Fixed a pledge(2) violation in ssh(1) when a combination of a Yubikey, GnuPG and remote forwarding is used.
Made SMTPS default to port 465 in relay-host.
Ensured that -n overrides -t in lock(1), irrespective of order.
Skipped sending mail in secure mode (-S) in vi(1) when executing the :pre[serve] command or dying from SIGTERM, allowing creation of the recovery file without adding to the pledge(2).
Disabled caches and MMU on 32-bit ARM before jumping to the kernel entry point, to meet OpenBSD/armv7 kernel expectations of a boot with these off while UEFI and U-Boot work with them enabled.
Applied unveil(2) to switchd(8).
Ensured bridge(4) will choose the physical interface for delivery when multiple ports share the same MAC address.
Removed the default timeout from lock(1).
Prevented a possible race condition during dhclient(8) startup.
Increased efficiency of poll() in bgpd(8) by allocating increased send and receive buffers for socketpair().
Allowed the ssh-keygen(1) verbose flag when searching for host keys in known hosts, printing the matching hosts's random art signature.
Prevented a kernel crash in pf(4) by adding a check to prevent expired once rules from being added to pf_rule_gcl.
Changed the bgpd(8) Adj-RIB-Out to a per-peer set of RB trees, improving speed.
Added a bootloader for octeon to be enabled later. The loader program is accompanied by the octboot(4) device, which allows loading and launching kernels.
Prevented integer overflow when checking mbuf limits.
Fixed a race condition in ntpd(8) and adjusted to re-resolve and retrieve constraints after clock syncing to correct shifts during time adjustment.
Made realpath(3) posixly correct by changing the kernel implementation not to succeed on final path components which do not exist.
Added support for PKCS8 as an optional format for storage of private ssh(1) keys, enabled via ssh-keygen -m PKCS8.
Added tls-cert-bundle option to unbound.conf(5). TLS connections are not reused by unbound(8), so TCP and TLS handshakes will disproportionately increase latency compared to UDP.
Fixed a direct map bug affecting amd64 machines with greater than 1023GB physical memory.
Provided a notification to stderr to indicate messages have been shown when mandoc(1) output is printed without a pager, to indicate messages may have preceded the output.
Added an interface to set/update a data property to ldomctl(8).
Ensured that sndiod(8) will not lose track of which volume controls belong to different instances of the same program upon disconnection and reconnection.
Included SHA2-variant RSA key algorithms in KEX proposal, allowing ssh-keyscan(1) to harvest keys from servers that disable SHA1 ssh-rsa.
Added access to timeout(9) status and statistics to sysctl(2), allowing throughput tracking of the timeout layer from userspace.
Restricted filesystem access for dhclient(8) using unveil(2).
Enforced a per connection limit of 128 SACK holes managed at the tcp(4) socket, further preventing an unlikely attack where the lists of SACK options grow due to an attacker attaching all sack holes to a limited number of TCP connections, consuming CPU.
Added the missing openssl(1) option dsa -modulus.
Ensured that uvideo(4) devices are allowed sufficient probe buffer size for the given version.
Implemented Linux kthread(9) drm(4) interfaces.
Added OpenBSD::Unveil, a perl interface to unveil(2).
Fixed a vfs(9) unlinking failure due to unveil(2), which led to a file system which could not be unmounted.
Added support for version 3.0 of the 'mdstore' protocol to ldomctl(8).
Fixed a race condition in mpii(4) devices by waiting for ports to finish scanning.
Added user instructions to manually run /usr/libexec/reorder_kernel in case of syspatch(8) kernel update failure.
Handled unreliable ntp peers by removing them from the pool upon non-response in ntpd(8), preserving good peers and re-resolving to find a replacement.
Modified octeon to allow all network interfaces for root device selection when there is no explicit device class match for a given boot device.
Improved file cleanup code for syslogd(8) that had been blocked by unveil(2), preserving the ability to remove a stale /var/run/syslog.pid file.
Prevented a panic with bwfm(4) devices due to an overflowing async ring buffer.
Added aggr(4), a dedicated driver to implement 802.1AX link aggregration.
Fixed a free(3) size panic when detaching a crypto softraid(4) volume on i386.
Updated the mac/vlan filters appropriately when the mac address changes on an ixl(4) device.
Added server time.cloudflare.com to ntpd.conf(5).
Improved handling of Raven, Raven2 and Picasso amdgpu(4) devices.
Added tsleep_nsec(9), msleep_nsec(9) and rwsleep_nsec(9), which take timeouts in nanoseconds and use INFSLP to indicate a timeout should not be set.
Stopped a segfault in mandoc(1) when /tmp is not writable.
Locked the kernel when removing file descriptors from the descriptor table, preventing a race with kevent(2).
Fixed a bug in pf(4) where the next hop interface configured with 'route-to' was not used when using source address tracking.
Added thermal zone handling code to link together thermal sensors and cooling devices to actively or passively cool devices. Registered cpu(4) as a cooling device to support passive cooling and rktemp(4) as a thermal sensor.
Switched the default compiler on octeon to clang(1).
Updated Mesa to 19.0.8.
Stored the current filter parameter in the smtpd(8) session, fixing a bug where filters in a chain received a null parameter.
Reintroduced ifiq_input counting backpressure by counting the number of times a nic has tried to queue packets before the stack processes them as a measure of load on the network stack, and beginning to drop packets when the load is too high.
Implemented proper HDMI audio support for serial DVO.
Updated libexpat to 2.2.7, including a fix for a potential denial-of-service attack (CVE-2018-20843).
Modified amd64 and i386 to write back and invalidate caches before updating CPU microcode and added a compiler-level memory barrier to the instruction.
Updated unbound(8) to 1.9.2.
Fixed a problem with the bgpd(8) session engine which caused it to spin with a poll timeout of 0.
Enabled MSI-X interrupts.
Allowed additional video(4) ioctls for the video pledge needed by chromium.
Fixed sign handling in emulated floating point operations on sparc64.
Added support for OCSP stapling to relayd(8).
Added support for bypassing iommu translation on sparc64, providing potentially substantial performance improvements.
Implemented suspend/resume support for MSI-X interrupts.
Fixed an endless loop of peer_down errors on bgpd(8) due to an uninitialized peer id.
Removed irrfilter from bgpctl(8). Other tools can be used to generate AS and prefix sets based on IRR data, such as bgpq3 (in ports).
Added the glkgpio(4) driver for the gpio controllers on Intel's Gemini Lake SoC.
Stopped retrying to get the usb descriptor in usbd_new_device() when the call times out, making reattaching USB at resume happen more quickly.
Readded communities lost after the bgpd(8) community changes by dumping them explicitly with mrt.
Added an option to build octeon kernels using clang(1).
Unlocked getrlimit(2) and setrlimit(2) syscalls.
Added ps(1) '-o pledge' option, which prints a comma-separated list of pledges active on each process.
Exported the state of unveil(2) to allow display by ps(1) and added status flags 'u' or 'U' to process installed unveils not yet locked and locked, respectively.
Invalidated icache when changing pmap(1) mapping on octeon, preventing running of previous instructions.
Made taskq_barrier(9) work for multi-threaded task queues.
Updated clang(1) build infrastructure for LLVM 8.0.0.
Updated LLVM to 8.0.0.
Unlocked read(2) and write(2) syscalls.
Switched KARL to using install(1) -F rather than cp for fsync(2) to reduce likelihood of an incomplete kernel transfer to disk.
Fixed conversions to long double on sparc64.
Made resource limit access MP-safe.
Encrypted private ssh(1) keys that are not in use as protection against speculation and memory sidechannel attacks like Spectre, Meltdown, Rowhammer and Rambleed.
Added a -A flag to show-options in tmux(1) to show parent options.
Added a DNS probe to determine whether ntpd(8) should attempt an (auto) settime or give up.
Added -f flag to reput and reget in sftp(1) and settled on use of the -p and -R forms of existing switches.
Modified test (aka "[") in ksh(1) to allow use of string greater/less than operators, matching the behavior of test(1) and other shells like bash and dash.
Fixed potentially stalling TCP connections on wifi by stopping probe of Tx rate in the case of transmission failure or excessive retries.
Updated libc++, libc++abi and libunwind to 8.0.0.
Added the aplgpio(4) driver for the gpio controllers on Intel's Apollo Lake SoC.
Imported Kristaps Dzonsons' RPKI validator, rpki-client(8).
Prevented a panic in pci_intr_establish(9) by assigning an address to the BAR used by the MSI-X tables if none has been assigned.
Rewrote bgpd(8) community matching and handling code and improved performance for setups using many communities.
Removed the old userland realpath(3) and replaced it with __realpath(), a kernel implementation. This will prevent calling readlink() on every component of a path and improve performance for unveil(2).
Added a -c option to logger(1) for passing LOG_CONS to syslog(3).
Replaced chroot(2) with unveil(2) for acme-client(1).
Rewrote doas(1) environment inheritance not to inherit, and instead reset to the target user's values.
Restricted sysctl(2) filesystem access to read only _PATH_DEVDB and /dev through unveil(2).
Stopped tmux(1) from looping if a menu item contains invisible characters.
Converted assorted kernel code from use of hz(9) to timeout_add_sec(9) et al.
Added additional Apollo Lake pci(4) ids.
Prevented a crash when the environment variable is present but empty in tmux(1).
Protected against a kernel crash due to missing inp_ppcb when fstat(1) was called often and TCP was aborted with reset.
Added regular expression support for the format search, match and substitute modifiers in tmux(1).
Implemented elliptic curve (ECDSA) domain keys in acme-client(1).
Modified tmux(1) to pass the target on to new commands with if -F.
Changed the number of wsmouse(4) devices created by MAKEDEV to 10, allowing X input configs for many devices at once on newer machines.
Implemented SHA-2 support for snmpd(8) authentication (RFC 7860).
Added the mcx(4) driver to sparc64.
Implemented MSI-X support on sparc64.
Allowed drm(4) allocation of memory without constraints if the hardware supports 64-bit DMA.
Introduced ntpd(8) automatic settime mode.
Included mount_nfs(8) on the amd64 ramdisk_cd.
Skipped PCI host bridges and devices not present with acpi(1) when establishing the mapping between ACPI device nodes and PCI devices.
Added the ukspan(4) driver for the Keyspan USA19HS USB serial adapter.
Implemented RFC 8555 "Automatic Certificate Management Environment (ACME)" to enable acme-client(1) to communicate with the v02 Let's Encrypt API. IMPORTANT NOTE: Users must change the api url in /etc/acme-client.conf to https://acme-v02.api.letsencrypt.org/directory. The v01 API will no longer be usable. Additionally, the acme-client(1) -A and -D flags have been removed.
Enabled mcx(4) on arm64.
Added a -v flag to source-file in tmux(1) to show the commands and line numbers.
Introduced an ECDSA privsep engine and the code required for smtpd(8) to load and use ECDSA certificates.
Supported 64BIT DMA for io in mpii(4).
Increased MAXCPUs to 32 in arm64, allowing use of all cores on the Ampere eMAG.
Prevented corruption of the pckbc(4) command queue when the first of multiple synchronous commands to timeout clears the command queue.
Allowed mg(1) beginning-of-buffer and end-of-buffer commands the ability to take a numeric argument and remove n/10th of the way from the top or bottom of the current buffer respectively.
Fixed MSI/MSI-X on arm64 machines with agintc.
Implemented mcx(4) rx filtering using the flow table.
Switched bintime routines to bintimeadd(9) and introduced bintimecmp(9), with similar behavior to the timeradd(3) macros.
Used a simple hash table to look up blocks by the fast-hash in openrsync(1) and used a rolling computation, putting openrsync speed on par with gpl rsync for file updates.
Added mandoc(1) support for 'prefers-color-scheme: dark'.
Called pmap_growkernel(9) before uvm is initialized on arm64 to ensure machines with large amounts of physical memory do not fail to initialize uvm.
Added support for the Cortex-A65 CPU.
Re-enabled RETGUARD leaf function optimization for arm64.
Added relayd(8) support for SNI with new 'tls keypair' option to load additional certificates.
Checked the type of a network statement when looking for duplicates in bgpd(8). This fixes added network 0.0.0.0/0 after 'network inet static'.
Added MSI-X support for acpipci(4), pciecam, dwpcie(4) and rkpcie(4).
Changed vmctl(8) syntax to specify command options before the create, start and stop commands, matching commonly-expected style.
Added mcx(4) jumbo frame support, setting the port MTU up to 9500.
Worked around an ntpd(8) bootstrap failure in a dnssec environment by repeating a failed DNS lookup after an incorrect time leads to dnssec validation failure and disallows setting the correct time.
Made improvements to bgpd(8) peer finding in the case where many peers have been configured.
Fixed ubcmtp(4) multitouch by properly reading multi-finger data on type4 devices with padding between finger data.
Fixed a tmux(1) crash when killing the current window.
Supported virtio(4) 1.0 for virtio_pci.
Modified tcpdump(8) to support '-T erspan' and allow arbitrary gre protocols.
Allowed specifying area by number as well as id in ospf6d(8).
Updated perl(1) to 5.28.2.
Shutdown the service port when behind a captive portal with unwind(8), allowing bypass of captive portals that correctly answer SOA queries for the root zone and return NXDOMAIN for the captive portal redirect domain if edns0 is present.
Implemented 'show mrt neighbors' in bgpctl(8), a command to print the neighbor table of MRT TABLE_DUMP_V2 dumps.
Replaced the tmux(1) parser code, unifying parsing of the configuration file and string commands (and allowing constructs formerly unique to configuration to be used in string commands).
Updated Mesa to 19.0.5.
Prevented more than one thread from opening a wscons(4) device in read/write mode.
Ignored APM_UPDATE_TIME events in i386/amd64 apm(4). This prevents constant erosion of the system wallclock on certain systems.
Stopped duplicate lease negotiation and application in dhclient(8) when RTM_IFINFO reports a change to the MTU of the interface, which had been confusing Google Compute Engine.
Added amdgpu(4) from linux 4.19.44 to support recent AMD Radeon cards.
Modified vmd(8) to drop fatalx calls when claiming a new vm id, preventing a crash of vmd and existing vms.
Adjusted ssh(1) to default to using the rsa-sha2-512 signature algorithm when signing certificates with an RSA key. This will render these certificates incompatible with OpenSSH < 7.2 unless the default is overridden by use of the ssh-keygen(1) -t flag.
Fixed integer overflow in block size calculation in aucat(1), fixing truncation of contents of files with rate above 64kHz generated in offline (-n) mode.
Used unveil(2) on tetris(6).
Prevented dhclient(8) from repeatedly obtaining a new/renewed lease when interface-mtu is present in a lease.
Mitigated Intel's Microarchitectural Data Sampling vulnerability by using the new CPU VERW behavior if available or by using the proper sequence from Intel's "Deep Dive" doc in the return-to-userspace and enter-VMM-guest paths. Updated vmm(4) to pass through the MSR bits so that guests can apply the optimal mitigation.
Added tcpdump(8) handling specific to ERSPAN type I.
Improved athn(4) support for AR9271 to use the correct clock control register.
Fixed vmd(8) -b to allow use of 'vmctl start foo -b /bsd -d disk.img -cL'.
Adjusted ospfctl(8) to accept address and number format for 'ospfctl show database area XXX'.
Modified vmctl(8) to treat vms disabled in vm.conf the same as any other vm which is stopped.
Stopped changing router-id on ospfd(8) reload if unspecified.
Attached two dwiic(4)-pci devices that are now functioning, enabling correct behavior of the trackpad and trackpoint of the Dell Precision 7520.
Added support to the amd64 BIOS bootloader to load a kernel at a random virtual address.
Allowed specification of a cmdfile for config(8) rather than piping in commands for -ef.
Added support for 'boot device' to vm.conf(5) grammar, the '-B device' counterpart from vmctl(8).
Added tee(1) to the ramdisk filesystem to provide a moving progress bar during auto upgrade/install and a clean log.
Emulated kvm pvclock in vmm(4), compatible with pvclock(4) in OpenBSD.
Added elf(3) support for -znoretpolineplt and made -zretpolineplt the default. Affects i386 and amd64.
Fixed ifconfig(8) newflags. Added a new 'stayauth' nwflag which can be set to let net80211 ignore deauth frames, useful when deauth frames are being spoofed by an attacker.
Ensured the extended acpi(4) PM register descriptions actually exist before using them, fixing machines with ACPI 1.0.
Added first drm render node to the fbtab(5) list of devices to change when logging in on ttyC0. Added drm0 to loongson and added the complete set of wscons and drm devices to arm64.
Added simple menus to tmux(1) tree, client and buffer modes.
Added the colemak keyboard layout.
Added support for remapping ACPI(4) PM registers using the 'extended' gasio representation from the FADT, fixing the Lanner NCA-1510.
Enabled reporting of the vm state through use of the vmctl(8) 'status' command.
Modified ld.so(1) to prune visited leaves when walking dependencies to call init functions in topological sort order, greatly reducing cost.
Repaired and improved v6 default route selection in install.sub, fixing autoinstalls.
Added support for IKEv2 Message Fragmentation (RFC 7383) to iked(8).
Implemented interrupt controller functionality in rkgpio(4), allowing use of the fusbtc(4) interrupt on the RockPro64.
Added fusbtc(4) to support the Fairchild FUSB302 USB Type-C controller.
Synced vm state in vmd(8) when (un)pausing a vm to ensure both vmm(4) and vmd(8) processes know the vm is paused.
Handled some unhandled instructions for SVM which led to vmm(4) guest termination, as well as RDTSCP and INVLPGA instructions.
Added sysupgrade(8) support to the sparc64 bootloader.
Added logging of ssh(1) PermitOpen and PermitListen violations.
Added a fallback to ehci(4) which enables the USB ports on the RockPro64.
Added support for simple tmux(1) menus usable with mouse or keyboard. Introduced the command "display-menu" to show a menu bound to the mouse on status line by default.
Enabled switching between wireless and wired interfaces in dhclient(8), setting the default route with the interface address and allowing two default routes in the routing table. A wired interface will be preferred when connected.
Explicitly disabled BCM4331 chips present in 2011-2012 Apple Mac systems to prevent an interrupt storm that can result when the Mac EFI firmware enables, but does not disable, the wireless controller.
Added Intel Atom C3000 pci(4) ids.
Added port protection support to switch(4). Domain membership is checked for unicast, flooded (broadcast) and local (host-network-bound, e.g. trunk) traffic.
Introduced malloc_conceal(3) and calloc_conceal(3), which return memory in pages marked MAP_CONCEAL and call freezero() on free().
Implemented DNS block lists in unwind(8).
Fixed a bridge(4) memory leak when multiple interfaces do MAC filtering.
Added support for from/to in relayd(8) filter rules.
Introduced a -k flag to sysupgrade(8) to preserve the files in /home/_sysupgrade after upgrading.
Added measurement of poll intervals with monotonic clock to acpisbs(4).
Added consistent use of 'ifconfig $_if [-inet| -inet6]' to clear existing configurations completely after restarting an install.
Added a sysctl(2) accessor to struct pf_status to allow export of current status and statistics without super-user rights via sysctl. Used this to print systat pf.
Changed the behavior of swap-window -d in tmux(1) to match swap-pane.
Preserved dhcp configuration when restarting an install.
Modified systat(1) to allow the use of 'b' to switch to stats since boot.
Added ucrcom(4), a driver for the serial console of certain chromebooks.
Removed ld.so-local stack-protector handling functions on retguard systems, as hard-traps are used.
Set the REQUEST_URI CGI variable to the requested URI and query string instead of the rewritten ones in httpd(8).
Fixed integer overflow with an excessively large number of kqueue(2) events.
Added support for more Intel 300 Series PCH to ichiic(4).
Moved bgpd(8) pfkey socket to the parent process. The refreshing of the keys is done whenever the session state changes to IDLE or ACTIVE, which should behave better when reloading configs with auth changes.
Fixed a bug in pkg_info(1) -S where version elements were ignored.
Ensured mcx(4) completion queues are always rearmed to prevent rx or tx completion stalling.
Adjusted unwind(8) to try to resolve the DNSSEC trust anchor only if we have a validating resolver context.
To restore lockf(3) deadlock detection, introduced a list for all pending blocked locks to be scanned before waiting on a blocking lock in order to determine whether sleeping would cause a deadlock.
Enforced store/load order when setting or clearing AST flag on mips64, preventing an unlikely case with inter-CPU ASTs where the receiving CPU uses stale state. Ensured that the clearing store is performed before other memory accesses, preventing potential loss of an AST request.
Issued a write-write barrier before sending IPI on mips64, preventing a receiving CPU from observing an old state when processing the interrupt.
Made the interrupt and trap return paths check for ASTs with interrupts disabled, fixing unintentional delay of ASTs on MP mips64.
Fixed reloading of network statements that have no fixed prefix specification in bgpd(8).
Fixed a logic error when configuring the alc(4) driver to use msi.
Fixed the case where switchd(8) does not save a copy of a packet needing forwarding.
Added support for the EFI Random Number Generator Protocol, using it to XOR random data into the buffer we feed the kernel for amd64.
Relaxed a check in knote(9) to prevent a panic without KERNEL_LOCK().
Began to assume eDP is present on port A when there is no VBT, making inteldrm(4) work on a Gemini Lake system (HP Stream Laptop 14-cb1XX) where finding the VBT fails.
Improved the interaction among efifb(4), inteldrm(4) and radeondrm(4) for a serial console by introducing a 'primary' device, the one set up and used by firmware. This should help X to work correctly out of the box with multiple cards or with a serial console.
Added mcx(4) driver for Mellanox ConnectX-4 (and later) Ethernet controllers.
Began to allow panes to be empty in tmux(1), allowing output to be piped to them with split-window or display-message -I.
Adjusted installer to remember 'autoconf' if install restarts.
Added a 'forwarded' log format extending the 'combined' log format for httpd(8), allowing tracking of request origins behind a proxy. This format is compatible with log analyzers like GoAccess and Webalizer.
Fixed endless loop / OOB write on 64 bit systems with large buffers.
Improved man(1) matching for requests for a specific section.
Renamed the -c option in sysupgrade(8) to -s to indicate snapshots, and implemented a -r option to force an upgrade to the next release.
Added a -n option to sysupgrade(8) for a no-reboot option.
Adjusted sysupgrade(8) to only fetch and upgrade if a new snapshot is available.
Avoided opening httpd(8) log files on 'no log,' preventing startup failures where the log/directory is missing but logging is disabled anyway.
Avoided running the activate function for a partially-attached ehci(4) driver, preventing a panic during suspend for the Realtek DASH ehci.
Added support for the cryptographic coprocessor found on newer AMD Ryzen CPUs/APUs.
Allowed non-root users to become master when they are the first to open a drm(4) device.
Increased datasize and maxproc for the pbuild class in login.conf(5).
Used the proper UAC-v2.0 request in uaudio(4) to read the device controls, fixing STALL errors in mixer requests causing the mixer to be unusable.
Protected tun(4) wakeup with KERNEL_LOCK, rather than NET_LOCK.
Pulled cdfs and cdrom production into the full ramdisk build for i386.
Added a 'set_rate' method to the envy(4) codec API, allowing card-specific codec initialization code called when the sample rate is changed. Implemented this method for ESI Juli@ cards, switching the AK5385 and AK4358 chips among single-, double- and quad-speed modes depending on host sample rate and suppressing aliasing noise.
Enabled mvmdio(4) and mvneta(4) on arm64.
Enabled EnvyHT-specific sample rates (above 96kHz) on the host controller for envy(4) devices.
Added support for the Armada 3720 pinctrl controller to mvpinctrl(4). This controller also includes GPIO controller functionality.
Added mvuart(4) to support the Armada 3720's serial console.
Added support for the Armada 3720 clocks to mvclock(4) and added mvuart(4) to support the serial console.
Allowed enabling of regulators with the 'regulator-always-on' property.
Added unveil(2) to chpass(1).
Fixed user options crash in tmux(1).
Began the process of making Makefiles more similar across architectures.
Restricted hotplugd(8) filesystem access with unveil(2).
Fixed a memory leak in window tree search in tmux(1).
Added an equivalent test for master in drm_fb_helper_is_bound() for drm(4). This prevents black screens on hotplugging a new display with X(7) running, which required a vt switch.
Added a check to ospfd(8) and ospf6d(8) that any "depend on" interfaces are in the same rdomain.
Changed default Ruby version in ports(7) to 2.6.
Removed the KERNEL_LOCK from the bridge(4) output fast-path.
Cranked BUFCACHEPERCENT back down to 20 after the increase to 80 exposed a few problems.
Started a cleanup of boot media creation and made the process use the new vnconfig(8) vnd-auto-allocate mode.
Removed the need for the -A option from vnconfig(8).
Silenced all of the OKs from signify(1) while it is verifying the install sets for sysupgrade(8).
Modified syspatch(8) to default to using cdn.openbsd.org if there isn't a proper /etc/installurl.
Changed sysupgrade(8) to re-verify the signature only for SHA256 when checking the old files.
Regenerated moduli(5).
Imported libdrm 2.4.98.
Removed vnconfig(8) functionality from mount_vnd(8).
Added sysupgrade(8), a tool to upgrade OpenBSD to the next release or a new snapshot.
Split vnconfig(8) out of mount_vnd(8).
Extended the maximum size of the bgpd(8) shutdown communication message to 255 bytes. Made the same adjustment to bgpctl(8).
Fixed a potential panic in inteldrm(4) caused by an interrupt coming in before the interrupt handler is set up.
Adjusted tmux(1) to automatically scroll when dragging to create a selection with the mouse when the cursor reaches the top or bottom line.
Added support for the USB serial adapter found in Juniper SRX 300 to uslcom(4).
Used unveil(2) to restrict file system access in relayd(8) to read only. Reverted (r1.175). "check script" needs access to the filesystem.
Added a watchdog for unattended upgrade to reboot after 30 minutes in case the script halts.
Changed most bootloaders to boot from /bsd.upgrade if it is present.
Implemented SIOCGIFSFFPAGE in bnxt(4) so that ifconfig(1) can get transceiver information from it.
Added the pci(4) product id for the VMware nvme(4) interface.
Added support for ccp(4) at acpi(4).
Added pinctrl(4) support for 'pinconf-single' devices and support for bias and drive-strength properties, needed for HiSilicon SoCs.
Added the octiic(4) driver for OCTEON two-wire serial interfaces.
Removed file name and line number output from witness(4), along with the wrapper for mutexes.
Added -no-clear variants of copy-selection and copy-pipe to tmux(1) which do not clear the selection after copying.
Checked for linkstate instead of IF_STA_POINTTOPOINT for originating router LSAs for P2P interfaces in ospfd(8), making 'passive' work on P2P interfaces.
Modified vmm(4) to flush guest TLB entries if the guest disables paging.
Began to change only the clock frequency and skip setting voltage on arm64 systems supporting DVFS which do not expose a regulator.
Added support for official Linux device tree bindings and the 'stub' clocks handling CPU clock frequency on the Hi3670.
Stopped prompting for disks that do not contain a root partition during upgrades. This defaults to the correct disk when full disk encryption is in use, and will be useful for future unattended upgrades.
Set vlan(4) to use if_vinput instead of if_input, bypassing ifiqs and improving vlan input speeds.
Added if_vinput so pseudo (ethernet) interfaces can bypass ifiqs, running interface input handlers directly rather than queuing the packets for a nettq to run and improving performance.
Disabled mobileip(4).
Added support for rxprio to gre(4).
Implemented the roff(7) .break request, preventing infinite loops.
Built clang(1) on powerpc.
Used IPL_TTY to prevent 'locking against myself' panics for drm/i915.
Fixed crashes seen with the 'intel' X driver with the new inteldrm(4) kernel driver by fixing rbtree_postorder_for_each_entry_safe() implementation.
Fixed unreliable 'ifconfig mode' with some wireless drivers by interpreting ENETRESET from ifm_change() as success in ifmedia_ioctl().
Added stdio pledge(2) to nl(1) after opening a file but before doing operations.
Completed conversion of rdsetroot(8) to -lelf on alpha.
Adjusted dma-range bufcache to 80% from 20%, to learn the downsides of this change based on user reports.
Avoided an underflow in the rip6 delivered counter in netstat(1).
Fixed netstat(1) statistics so 'netstat -s -f inet6 -p rip6' correctly copies out rip6counters, not ip6counters.
Adapted radeon_detach_kms() to struct drm_device being split from drm softc. Avoids uvm_fault() when firmware is missing and radeondrm(4) is forcibly detached.
Added a subsystem lock for vfs_lockf.c, allowing calling lf_advlock() and lf_purgelocks() without the kernel lock.
Implemented factored-out txprio and rxprio checks.
Implemented rxprio in mpw(4), mpe(4) and mpip(4). Added rxprio support to etherip(4) and bpe(4).
Added support to ifconfig(8) for getting and setting rxprio, finishing support for RFC 2983. Implemented configuring rxprio in vlan(4).
Modified pfctl(8) to always check for namespace collisions on table commands.
Fixed pfctl(8) table definition parsing as unprivileged user, printing a brief notice if -v was given to help find duplicate definitions by hand.
Modified sshd(8) -T to assume any attribute not provided by -C does not match, allowing it to work when sshd_config(5) contains a Match directive with or without -C.
Released OpenSSH 8.0.
Switched powerpc to big PIC to allow clang(1) to build libc++abi and libc++.
Used txprio to control the use of exp as a priority field for mpw(4), mpip(4) and mpe(4). Intermediate LSPs can use the exp field to manage prioritization of encapsulated traffic.
Prevented attaching drivers to devices for which a driver was attached early with simplebus on armv7 and arm64.
Adjusted myx(4) i2c reads to read only one byte at a time, increasing reliability.
Fixed sff page reads for myx(4) devices on little endian architectures.
Rewrote rdsetroot(8) using elf(3).
Imported xf86-video-amdgpu 19.0.1 for amd64 and i386.
Implemented tx mitigation by calling the hardware transmit routine per several packets rather than for individual packets. Defers calls to the transmit routine to a network taskq, or until a backlog of packets has built up.
Introduced 'pfctl -FR' to reset pfctl(8) settings to defaults.
Removed old -vlan and -vlandev code from ifconfig(8), using these instead as aliases for -vnetid and -parent.
Added basic support to ifconfig(8) to display xfp and qsfp+ information.
Implemented SIOCGIFSFFPAGE to allow ifconfig(8) to get transceiver information from myx(4) devices.
Applied strvis(3) to strings from USB devices in usbdevs(8).
Removed the potential for double-frees in copied cipher data by zeroing and freeing following EVP_CIPHER_CTX_copy() in evp(3). Used calloc(3) when allocating cipher_data to avoid use of uninitialized memory.
Updated shared drm code, inteldrm(4) and radeondrm(4) to linux 4.19.34. This adds support for Intel Broxton/Apollo Lake, Amber Lake, Gemini Lake, Coffee Lake, Whiskey Lake, Cannon Lake and Ice Lake hardware.
Stopped using splnet(9) when running the network stack now that it is using the NET_LOCK for protection, reducing latency spikes.
Increased information displayed for -v and -vv options for tcpdump(8) during md5 authentication.
Added missing compatibles for newer Linux kernel bindings to mvpinctrl(4).
Fixed a leak in SSL_dup_CA_list() in ssl(3).
--------
Changes made between OpenBSD 6.4 and 6.5
Added support for X722 to ixl(4).
Added wavelength, printing alarm low/high thresholds and a flag for warning/alarm indications when printing transceiver information in ifconfig(8).
Added support for fetching and parsing SFF module information and diagnostics to ifconfig(8). This supports ix(4) and some ixl(4) devices with up to date firmware.
Implemented support for SIOCGIFSFFPAGE in ixl(4) to allow userland reads of sfp/qsfp module information.
Added handling for missed service errors specific to isochronous transfers in xhci(4) to ensure transfer completion. This fixes crashes and deadlocks in upper layers.
Fixed URE_WDT6_SET_MODE register definition, allowing ure(4) detection after boot.
Began adding support to detect /bsd.upgrade kernel and boot from that if present rather than the default /bsd. This is intended to allow for unattended upgrades in future releases.
Made azalia(4) initialize Dolby Atmos codecs in the resume path, allowing stereo sound to persist across suspend/resume cycles.
Adjusted the logic for setting timeout to 0 in bgpd(8) to add an rpending flag set only when reading the session buffer was exited early because MSG_PROCESS_LIMIT was hit.
Changed to a stricter comparison when checking keyboard variants in wscons(4) to fix an issue where kbd(8) layouts with particular bitmasks were wrongly detected as French.
Added '-Dsnapshot' as a synonym for -Dsnap in pkg_add(1).
Switched to using rdsetroot(8).
Corrected printing of tcp(4) flag names to console in debug mode.
Loosened a kernel check in response to routing message address bits being set without corresponding socket addresses. This was keeping broken ports from working, so this change will act as a temporary workaround until bugs can be found and corrected.
Fixed hack(6) to write savegames and score files to the current directory instead of /var.
Altered audio(4) to try and start playback automatically as soon as there is enough data. Useful to quickly test and debug low level drivers with simple shell commands.
Added support to tcpdump(8) for printing cdp over both gre(4) and ppp(4).
Changed ospfd(8) to set the link ID of the type 3 link to the subnet's IP address, per RFC 2328.
Implemented legacy fallback for the TLS 1.3 client in ssl(3).
Provided ssl(3) chain/cert chain APIs, allowing chains to be managed on a per-certificate basis.
Improved support for tipmic(4) power management ICs on the ASUS E200HA.
Fixed a potential null-pointer dereference in acpi(4).
Added support to update over wireless with bwfm(4) network devices to arm64 bsd.rd.
Added support to rsync(1) for use of the -x option, which prevents crossing of file system boundaries. This behavior matches GPL rsync.
Added an argument in tmux(1) copy commands to set the prefix for the buffer name, allowing the buffers for different sessions to be named separately.
Fixed a bug by beginning to store and restore cursor across reflow in tmux(1) by working out a position based on unwrapped lines rather than a grid offset.
Stopped loading /etc/tmux.conf if given -f in tmux(1).
Edited bpf(4) to reject negative and too large timeouts passed to BIOCSRTIMEOUT. Negative timeouts could lead to a panic.
Moved to OpenSSH 8.0.
In ksh(1), bound ^L (ctrl-l) to clear the screen rather than redrawing.
Fixed a segmentation fault in dhclient(8) due to an uninitialized string.
Fixed a bug in radiusd(8) where the radius module doesn't work when the size of the radius message changes.
Corrected access to doorbell, fixing ring 2 test failure in radeondrm(4) on carrizo-l/mullins. This applies only to gfx7/sea islands hardware.
Disabled MSI for AMD Summit Ridge/Raven Ridge HD Audio in azalia(4) as a workaround for a bug where audio playback stops after varying amounts of time.
Restricted which filesystems are available for swap in vfs(9), ruling out obvious misconfigurations.
Introduced new variable NOLIBSTATIC= to prevent installation of a static library when it isn't built or is unwanted.
Fixed ddb(4) not to write its history out of the region.
Switched to the group number assigned in RFC8031 for curve25519 in iked(8), rather than a private-use group number.
Started deleting contents of /var/syspatch when upgrade completes. syspatch(8) did this when installing the first syspatch of a new release, and this will do it sooner.
Moved to 6.5 release. 'pkg_add -u -Dsnap' will now be needed until release.
Added a config option to specify the preference of name servers to unwind(8).
Stopped detaching non-removable sdhc devices during resume, allowing hibernation with the root filesystem on internal emmc.
Added printing of some msi and msi-x details to pcidump(8).
Changed 'vmctl status id' to report the VM's general state based on whether the host process is running. This makes vmctl(8) reliably report 'STATE: RUNNING' or 'STATE: STOPPED.'
Added human-readable parsing and display of RFC1035 data in the domain-search option of dhclient(8). It is now possible to append and prepend domains to the list provided by the server.
Fixed a crash in tmux(1) when scrolled lines became larger than the total lines.
Fixed the openssl(1) enc -iter flag, which uses the pbkdf2 key derivation function.
Ensured that vmm(4) flushes stale TLB entries when uvm(9) removes entries from a guest VM's EPT upon teardown or in low memory situations.
Enabled RF_KILL interrupts on resume for iwm(4).
Modified radiusd(8) to continue updating the authenticator and message authenticator, and to correctly display message-authenticator.
Made 'secret' a required configuration for both client and radiusd(8) module.
Fixed iwm(4) interrupt handler to set RUNNING flag when RF switch is enabled.
Added retguard macros to kernel setjmp()/longjmp() on amd64.
Improved support within imxgpc(4) for i.MX8MQ devices.
Stopped incorrectly advertising MCE/MCA support in vmm(4). This fixes a Linux guest VM boot problem on Ryzen machines. Stopped advertising support for SSBD and related speculative exec control features on AMD.
Modified the ddb(4) reboot command to skip anything which might cause an additional panic.
Changed rebound(8) to issue a warning and carry on in cases where inet6(4) is not available.
Implemented "Authentication Domain Names" configuration in unwind(8) per RFC 8310 section 7.1 for DoT servers.
Stopped using a prefetchable mapping for the registers for ixl(4) devices to prevent geneRation of pcie errors, then reenabled the full pre-reset code path.
Grew the minimum size of /usr to 1300M when using the disklabel(8) auto partitioner, as the bare minimum size of /usr for all amd64 install sets is 920M.
Fixed a memory leak in radiusd(8).
Changed the way bgpd(8) peers are reloaded by moving the struct peer into bgpd_config. Now parent and session engines are merging the lists.
Modified the autopartitioner in disklabel(8) to grow minimum size for /usr to 1300M, allowing space for the current amd64 minimum sets size of 920M used, additional space for upgrades and relinking of libraries and kernels.
Fixed output accounting when bridge(4) is down.
Restored -t behavior to route(8).
Corrected LED GPIO pin for AR9287-based usb devices.
Added the ability to openrsync(1) to combine rsync:// and -e by splitting rsync_socket() into rsync_connect to establish a TCP connection to the remote daemon, and rsync_socket() to run the actual protocol.
Fixed a memory leak in radiusd(8).
Added leaf function optimization for retguard which keeps the retguard cookie on register instead of storing it in frame.
Modified several daemons to avoid calling dup2(oldd, newd) when oldd == newd, preventing the descriptor from keeping CLOEXEC flag and being closed unexpectedly by exec().
Set -E disklabel(8) editing prompt to always display the disk device whose label is being edited and change '>' to '#' when in expert mode.
Adjusted unwind(8) to use getaddrinfo_async(3) when resolving captive portal hosts, rather than resolving internally.
Added retguard macros to setjmp(3)/longjmp(3) on amd64.
Restricted the number of allowed wsmux(4) devices to prevent malloc from panicking when the device minor is sufficiently large.
Modified pfctl(8) to fail on invalid netmasks when filling tables, preventing CIDR networks with more than one "/" from being loaded into tables.
Updated nsd(8) to 4.1.27.
Began to use stricter validation checks for A-MPDUs in the net80211 input path, requiring RUN state to accept A-MPDUs and refusing them from unassociating cients in hostap mode.
Corrected AR9287 USB device EEPROM read offset.
Adjusted midi(4)-related flow control messages to be sent only once half the client buffer space has been consumed, avoiding sending unneeded messages on the network.
Set aucat(1) to wait until server disconnect to close the socket, preventing loss of the last bytes.
Added support for Exar XR21V1410 USB serial adapters and added the uxrcom(4) driver to allow disabling of hardware flow control.
Added wsconsctl(8) support for display of fontwidth and fontheight values.
Fixed stop-selection in tmux(1).
Merged unbound(8) 1.9.1.
Fixed interaction between ClientAliveInterval and RekeyLimit that could cause an ssh(1) connection to close incorrectly.
Added pci(4) power-down support for AR8152 ethernet controllers.
In vmm(4), use sgdt/sidt to reset the GDT/IDT limits after exiting the guest VM on VMX, preventing a default limit set too high on exit.
Modified adjtime(2) to se EINVAL if delta overflows 64 bits of microseconds to be consistent with practices elsewhere.
Introduced a new rwlock, tc_lock, which allows adjfreq(2) and the kern.timecounter.hardware sysctl(2) to read/write the active timecounter pointer and the .tc_adj_freq member of the active timecounter safely. This prevents torn read/writes when dropping KERNEL_LOCK and ensures the active timecounter doesn't change during an adjfreq(2) call.
Fixed ssh(1) authentication failures when 'AuthenticationMethods any' in a Match block overrides a more restrictive global default.
Created a warning-no-op for openrsync(1) indicating that -z support is not yet written.
ospfd(8) now aborts reloading if the router-id changes.
Fixed issues with pctr(4) and suspend. cpu(4) callback will now restore the pctr(4) settings after suspend/hibernate.
Modified ssl(8) to defer signal algorithm selection until the certificate is known and it is time for signature generation.
Added a chain member to CERT_PKEY and provided functions for manipulating it.
Increased the default RSA key size to 3072 bits in ssh(1). This provides security equivalent to 128 bits, which is the smallest symmetric cipher enabled by default.
Added the syspatch(8) signify key for OpenBSD 6.6.
Switched to precision scrolling in wstpad in wscons(4).
Adjusted unwind(8) to check resolvers based on change of state rather than at regular intervals. Resolvers are now rechecked when no longer behind a captive portal.
Added a fix to azalia(4) for the right-side speaker on the Dolby Atmos system of the Huawei Matebook 1, allowing it to play in stereo.
Fixed route origin validation in bgpd(8).
Modified signify(1) such that -n will zero the gzip timestamp.
Used the debugger mutex for 'ddb_mp_mutex' to prevent a race condition that could leave it locked if one CPU incremented 'db_active' while another was in the critical section.
Added a simple spinning mutex for ddb(4) which spins even if 'db_active' or 'panicstr' has been set and disables IPIs in the critical section.
Moved adjtimedelta into the timehands and adopted the lockless read protocol used for system boot time and uptime to ensure safe read/writes for adjtime(2) callers.
Corrected DMA channel number selection on the AR816x family of controllers in alc(4).
Added support for Meinberg DCF600USB devices to umbg(4).
Prevented render nodes from being flagged as primary nodes by drm(4).
Added support for QCA AR816x/AR817x for alc(4).
Added -E option to specify an alternative escape character in cu(1).
Fixed rc.d(8) to correctly run an rdomain 0 rc.d daemon in rdomain 0 rather the current routing table when started from a non-default rdomain(4) shell.
Modified ixl(4) devices to run event callbacks directly in the atq processing, preventing multiple link state events from firing with the same callback and causing an infinite loop.
Corrected IPv6 parsing in sasyncd(8).
Changed the parsing of dhclient.conf(5) 'prepend' statements to 'supersede' and 'append' to 'default' when the option data cannot be prepended or appended to. A parsing warning will be issued to allow users to adjust their configuration files.
Began to ensure that outer ICMP packet destination IP and inner protocol packet source IP addresses match in ICMP and ICMP6 packets with pf(4), to prevent passage of nonsensical packets.
Switched to xorgproto.
Updated to xserver 1.19.7.
Added a cursor_character format to tmux(1).
Corrected a bug in mandoc(4) where an empty final line of input could lead to a buffer overflow.
Merged Mesa 18.3.5.
Addressed an issue with uaudio(4) where a busy system could cause audio playback to cease when a status of USBD_IOERROR led to erroring out early in uaudio_pdata_intr().
Extended the #[] style syntax to allow status lines in tmux(1) to extend up to five lines in height, configurable with a single option. Added the 'align' option for alignment within the status lline array, entries in tree mode and pane status lines; 'list' for the window list and 'range' to configure ranges of text for mouse bindings.
Edited vmctl(8) to allow an existing VM to be started by referencing its ID.
Added kubsan(4), an undefined behavior sanitizer for the kernel, which will print findings about undefined behavior at runtime to the system console. This is limited to architectures using clang(1) as their default compiler and is not enabled by default.
Made changes to rasops(9) to correct font filtering. Invoking the -l option of wsfontload(8) will now allow display of all currently loaded fonts.
Added format variables for default tmux(1) variables in various modes. Added a -a display-message flag to list variables with values.
Fixed tmux(1) to forcibly kill the previous job before starting new.
Installed rsync as openrsync(1).
Added support for configuring BIOCSFILDROP with tcpdump(8). This allows tcpdump to be used as a makeshift firewall.
Added the SM4 block cipher from the Chinese standard GB/T 32907-2016 to LibreSSL.
Fixed multiple buffer over-reads in ctfdump(1).
Changed dwiic(4) to fetch timing parameters from ACPI and have it attach on Intel 300 series devices.
Improved and enabled isochronous transfers in xhci(4). This allows laptop cameras on many newer laptops to work properly.
Fixed rad(8) to only accept one ICMPv6 and one route socket. This fixed a scenario where the ICMPv6 socket was also used as the route socket for a short while.
Changed slaacd(8) and rad(8) to refuse a control socket if it already has one.
Fixed ieee80211(9) autojoin for WEP networks by actually saving the WEP auth key.
Fixed display glitches in efifb(4).
Added a -v flag to tmux(1) to aid with debugging formats such as the status line format.
Changed printing of bgpd(8) configuration to show options set to non-default values.
Added a fallback of direct serial hardware access to uefiboot(8) for those UEFI machines that have serial ports but whose firmware does not have the serial io protocol.
Added acpicmos(4) to RAMDISK_CD for amd64.
Made searching for uppercase characters in less(1) use mbtowc(3) rather than the buggy and outdated step_char() and correctly use iswupper(3) rather than isupper(3), further improving UTF-8 support.
Fixed the balancing of octciu(4) work queue interrupts.
Backported support for probing ARMv8 hardware acceleration capabilities on armv7 in preparation for adding support for the probing code for arm64.
Improved speed of C++ unwinding by implementing a red-black tree based cache in libunwind.
Made rad(8) imsg(3) handling more paranoid.
Fixed resizing of tmux(1) control clients.
Cleaned up less(1) UTF-8 handling in backc() and do_append().
Modified tmux(1) to allow multiple modes to be open in a pane.
Changed tset(1) and ttys(5) to use hardware tabs as the default since almost all terminals now support them.
Added a new driver for USB Audio Class v2.0 devices to uaudio(4). The new driver maps audio blocks to USB transfers allowing precise synchronization and better reliability. This replaces the current one for USB Audio Class v1.0 devices.
Added copy_output() and underrun() methods to audio(4) to support drivers using bounce buffers (e.g. uaudio(4)).
Fixed delayed completions for isochronous transfers using uhci(4).
Added support for origin mode to tmux(1).
Separated fields output by pcidump(8) with commas since some fields are strings now.
Made slaacd(8) imsg(3) more paranoid for everything but the control socket.
Made vmd(8) to wait for the controlling end of a pty to become writeable before waiting for read events. This fixed an issue where a recent kqueue pty change caused vmd to hammer the log.
Added amdgpu to the list of possible driver firmware for fw_update(1).
Taught pcidump(8) about pci class and subclass names.
Moved adjtimedelta from kern_time.c to kern_tc.c in preparation for upcoming MP-safety changes to the timecounting layer.
Deleted unnecessary calls to setlocale(3) from touch(1), uuencode(1), uudecode(1), and spell(1). Also made usage() static and return from main() rather than exit(3).
Switched to the use of safe memory reclamation (SMR) in octcrypto(4/octeon) to reduce the need for atomic operations.
Made it possible to build xterm(1) with OPT_TRACE.
Changed acme-client(1) to use temporary strings for calls to basename(3) to make the code more portable, as basename can change the contents of its argument on other platforms.
Fixed 'announce inet none' for bgpd(8). It had cleared more than just the AFI/SAFI pairs where the AFI is inet.
Updated xf86-video-ati to 19.0.0. This fixes an Xorg segfault.
Made xterm(1) stop using its broken, hand-rolled wcwidth implementation in preference over the system wcwidth(3).
Fixed dirname(3) usage in acme-client(1) to be more portable.
Fixed a use-after-free in OpenSSH's pkcs#11 code.
Changed acpithinkpad(4) to default to the ACPI method and fallback to the CMOS method if the ACPI method fails. This makes screen backlight changes work for the x260. Unmasked the microphone mute event which is needed on the x260.
Updated Spleen kernel fonts to the latest released version.
Updated the error message that disklabel(8) displays for the interactive 'n' command to show that -F or -f is required.
Fixed booting on 486s without cpuid by returning early in microcode loading if cpuid is not available.
Improved cleanup of the configuration on shutdown of bgpd(8). This helps to detect memory leaks.
Improved portability of OpenSSH by moving checks for lists of users or groups into their own functions.
Modified sshd(8) to reset last-seen time when sending a keepalive. This prevents premature termination of a connection when ClientAliveCount=1.
Fixed parsing of rules using "once" in pfctl(8). 'match one' and 'anchor "a" once' had been erroneously allowed.
Unmasked keyboard brightness and screen brightness events in acpithinkpad(4). This keeps wscons(4) keyboard.backlight in sync and allows reaction to screen brightness keys. On newer ThinkPads, made thinkpad_brightness{up,down} use the ACPI method for adjusting screen brightness. This fixes screen brightness on the x270, x280, t470s, t470p, x1c6 and potentially additional models.
Modified ixl(4) to ignore rx interrupts before the interface is running. This prevents a crash in cases where the PXE rom has left rx interrupts pending.
Changed Mesa build to include LLVM support on amd64 and i386 now that libelf and a shared libLLVM are included in base. This will allow building of the radeonsi Mesa driver, adding accelerated support for radeon parts built on the Graphics Core Next (GCN) architecture.
Increased UFS dirhash memory slightly to increase directory performance now that very tiny machines are less common.
The install*.fs and install*.iso files increased in size due to clang library changes.
Built and installed llvm includes, llvm-config and a shared libLLVM, required to build the radeonsi Mesa driver.
Applied a background initialization progress fix from mfii(4) to mfi(4).
Combined queue drops with errors as fails when showing interface stats in netstat(1). To view queue drops or errors alone, use -d or -e respectively.
Exposed interface queue drops in the interface view of sysstat(1). Queue drops and errors may be viewed with the use of 'd' and 'e' respectively, or as a combined statistic, using 'f'.
Added support for RFC 6455 Websockets connection upgrade to relayd(8).
Modified pppx(4) to allow IPv6 to flow through.
Changed mandoc(1) #include sys/termios.h to #include termios.h to match that of other userland programs and improve portability to other systems.
Simplified xftcolor config for cwm(1).
Changed man(1) error message in cases where the manual page is not found and the architecture is unknown. It will now note the unknown architecture rather than the name of the manual page.
Finished removal of improper detection of input line breaks in mandoc(1), instead using the NODE_LINE flag.
Fixed an i386 segfault in ipsecctl(8) with the -ss option by adding padding to the struct sadb_x_counter to comply with alignment constraints documented in RFC 2367 (2.2).
Fixed a hang that could happen when more than one writer awaited a read-locked rwlock(9) by waking all waiters upon unlock.
Introduced handling of malloc(3) failure in nm(1) to prevent crashing with NULL pointer access.
Corrected an error where processing manual pages continued incrementing suffix numbering globally. The HTML formatter state is now reset after processing in mandoc(1).
Updated to libfontenc 1.1.4.
Removed use of unveil(2) from the unwind(8) main process to allow configuration reloading.
Increased the character limit for vm names to 64 for vmm(4).
Set a limit on the number of allowed stacked wsmux devices in wscons(4) to prevent exhaustion of the kernel stack.
Added a timeout to refill the rx ring when empty for em(4).
Fixed a crash where ld(1) would assume input files are ELF objects and try to free uninitialized memory.
Tied group number and name together during configuration in cwm(1).
Began UTF-8 cleanup of store_char() within less(1).
Increased accessibility for mandoc(1) through the addition of HTML sectioning elements.
Fixed bgpd(8) leak of non-dynamic objects on configuration reload when adding an already-present network to the list of announcements.
Improved handling of HT protection for 'mode 11n' hostap and switched to use of CTS-to-self frames rather than RTS/CTS for HT protection. Corrected ieee80211(9) misclassification of certain devices as 11a/g which led to unnecessary use of HT protection.
Corrected ieee80211(9) to pick up the AP's 11g ERP protection setting properly in 11n client mode.
Updated athn(4) to explicitly configure timing of control frames. The chip is updated with values for SIFS interval and ACK/RTS/CTS timeout with configuration changes, like ath9k in Linux.
Fixed two race conditions in sshd(8) relating to SIGHUP by extending messaging to communicate that it is safe for parent processes to restart.
Ensured expected behavior when setting PKCS11Provider=none in ssh(1).
Added new mmap(2) flag MAP_CONCEAL. Memory under MAP_CONCEAL is not written to the disk in the event of a core dump.
Ensured actions will not be carried out in cwm(1) using the last group when the requested one is not found.
Fixed bug where IPv6 fragments with malformed extension headers could be erroneously passed by or cause a panic in pf(4).
Set TLS handshakes to automatically complete as part of read/write calls to prevent attempts to read data that does not exist.
Added mpip(4), an IP tunnel interface for "IP Layer 2" over MPLS pseudowires. This can be used to quickly set up an IP tunnel over an MPLS fabric without the need to configure bgpd(8) and mpe(4) interfaces.
Modified iwm(4) to use CTS-to-self for HT protection if requested by the AP, rather than always using RTS.
Disabled RTS threshold by default for ieee80211(9). This has been replaced by a heuristic in 11n and is not clearly preferable in many situations. RTS will continue to be used for certain drivers and when 11g protection is enabled by the AP when 11b clients are around.
Implemented support for dynamic RTS threshold in MiRA, improving throughput and latency on 11n networks.
Fixed cases where iwn(4) scan misreported the channel of wifi networks.
Moved to 6.5 Beta.
Corrected return values for non-fatal TLS alerts to prevent attempted use of non-existent record data following user cancellation.
Improved handling of TLS errors in nc(1) to prevent silent failures.
Introduced safe memory reclamation (SMR), a mechanism for reclaiming shared objects that readers can access without locking. This provides a basis for read-copy-update operations. SMR-protected objects are not destroyed while readers are using them, and a callback may be scheduled with the use of smr_call(9) as an alternative to waiting.
Increased the built-in certificate validity for simple configurations in ikectl(8) from 365 to 4500 days, preventing the need to install new CA certificates on all client machines. Default validity for server certificates remains at 1 year.
Added bgpd(8) support for '*', local-as and neighbor-as for ext-community matching. If local-as/neighbor-as is used as an expansion of AS number then bgpd will default to the 4-byte AS type to encode the community.
Re-enabled interrupts on resume with RF switch disabled on iwn(4) devices.
Prevented packet loss due to rxr overfilling the ring buffer on ix(4) devices.
Implemented support for pwe3 ioctls.
Improved ixl(4) support to avoid a deadlock in ixl_down when calling ifq_barrier.
Added a configtest flag (-n) to cwm(1).
Corrected ssl(3) handling of oversize record layer writes.
Introduced 'group-close-[n]' action to cwm(1) to close all windows within a specified group.
Corrected ssl(3) build error on luna88k with gcc(1).
Added support for yv12 encoding to video(1).
Added Dynastream ANTUSB-2 to uscom(4) devices.
Removed -S from install commands across the tree.
Updated xterm to version 344.
Reworked iwm(4) Tx rate selection to increase Tx throughput, especially on clean channels.
Removed 11n support from AMRR in ieee80211(9).
Replaced several hand-rolled functions with wcwidth(3) in less(1) in an ongoing effort to improve unicode support.
Restored dhclient(8) behavior of clearing existing addresses when setting a new address.
Fixed a regression introduced in OpenSSH 7.9 where the client reused the server's algorithm lists for KEX, ciphers and MACs. Removed the diffie-hellman-group-exchange-sha1 KEX method.
Added support for recognition of the following arm CPUs: Cortex A76AE, Cortex Deimos, Neoverse E1 and Neoverse N1.
Updated the en_US.UTF-8 locale(1) to Unicode 10.
Improved the clang(1) X86FixupGadgets pass to further reduce ROP gadgets produced during compilation. Added a command line switch to disable this functionality.
Fixed strptime(3) to consume one leading space with %e iff given, allowing data from strftime(3) to round trip safely.
Changed ssdfb(4) to allow usage of mmap(2) so the framebuffer can be used outside of the kernel. Also allowed brightness levels to be changed.
Fixed an issue with xhci(4) transfers that could cause an "invalid CSW" error.
Changed rsync(1) --delete behavior to better interoperate with GPL rsync.
Implemented --numeric-ids in rsync(1).
Updated Xau(3) to 1.0.9.
Added TLSv1.3 alert handling to ssl(3).
Fixed an endless loop in sysctl(8) when sysctl(2) fails to retrieve sensor data.
Changed aucat(1) to use reallocarray(3) in place of potentially problematic usage of malloc(3).
Added Cortex A76 to the list of arm64 CPUs not affected by spectre variant 2 branch injection attacks.
Removed atomic_* operations in the tx start and completion paths of ix(4).
Addressed inconsistent behavior when ksh(1) evaluates arithmetical expressions.
Fixed tcp-md5 issues in bgpd(8) by making sure to set the sockaddr length field on the pfkey socket.
Repaired a regression in stmpd(8) 'hostnames' mapping to select hostname based on the IP address of a listener.
Prevented a panic in timeout_add(9) by rejecting negative input to spkr(4).
Adjusted vmm(4) to allow preservation and restoration of guest debug registers.
Completed various adjustments to allow for future support of flow-aware transport of pseudowires (RFC 6391).
Changed ether_output to use a routes gateway address (if available) for AF_MPLS frames.
Simplified NFS checking in rc(8) reorder_libs().
Added support for setting custom FastCGI parameters in httpd(8).
Adjusted ifconfig(8) to display whether bwfm(4) firmware is using 802.11AC.
Updated Mesa to 18.3.4. (Removed -fno-tree-pre from CFLAGS on sparc64 after the changes to login.conf removed the need to limit memory usage at build time).
Synchronized staff datasize-cur in login.conf(5) for hppa and sparc64 with the defaults for other architectures.
Implemented fixes for bgpctl(8) large community parsing.
Changed llvm PowerPC code generation to avoid generating unaligned floating point load and store instructions.
Fixed a race condition in wscons(4) involving the wsevsrc_* functions.
Made several improvements to the portability of bgpd code.
Added a vnode(9) error flag to prevent fsync(2) from reporting successful syncing when a past write failure has led to a buffer discard in vfs(9).
Added rsync(1) support for --port=PORT and ":port" in the rsync:// URL. Unlike in the original rsync, service names are supported.
Corrected usb(4) to publish a new attached device only once it is fully initialized, preventing a race condition.
Converted openssl(1) pkeyutl to the newer style of option handling.
Adjusted unwind(8) to restart the DoT resolver alongside the other resolvers when log verbosity changes.
Improved time interpretation for at(1) by assuming that a time that is already past refers to the next day.
Implemented the conv=fsync feature in dd(1) (mirroring GNU dd), performing an fsync(2) after the final write to output.
Added chown pledge(2) to rsync(1), allowing root to gift files to other uids.
Adjusted rsync(1) to set access time information with sub-second resolution.
Changed vmm(4) to allow guests to see PA bits in CPUID, removing an unintentional guest memory size limit of 64GB.
Fixed a case where ddb(4) would modify two variables instead of one on 64-bit architectures.
Relaxed userland stack pointer checking to allow PROT_NONE permissions on a page in addition to MAP_STACK.
Added support for -o, -D and -a in rsync(1).
Changed dpath pledge(2) to allow mkfifoat(2) and mknodat(2).
Allowed configuration of the rdomain for mpe(4) and mpw(4) interfaces.
Removed casts to (unsigned) to avoid range reduction bugs from parse.y based parsers.
Updated perl(1) to 5.28.1.
Added support for server and client finished messages in ssl(3) TLSv1.3 client implementation.
Added a new futex(2)-based rwlock(9) implementation. The existing rwlock implementation will be used for architectures lacking atomic primitives.
Changed socket(2) options to allow calling of SO_PEERCRED on sockets created with socketpair(2).
Adapted rsync(1) to use md4 from crypto(3).
Integrated group ID send/receive and remapping into rsync(1).
Added -g option and associated getpw pledge to rsync(1).
Simplified imsg communications and improved privilege separation of dhclient(8). resolv.conf.tail(5) will now be read (allowing additional details to be supplied) with each proposal.
Implemented support for -e and --rsh=name options in rsync(1).
Added long-opts aliases for single-letter options present in rsync(1). Added missing -no-OPT long options.
Adjusted bgpctl(8) show requests to handle the case where no neighbors are defined in bgpd(8).
Implemented handling of Certificate and CertificateVerify messages in TLSv1.3.
Began explicitly supporting VPNs in bgpd(8), redefining and changing the syntax of bgpd.conf(5). IMPORTANT NOTE: If MPLS VPNs are used, configuration will need to be adjusted.
Moved the on-disk trust anchor for unwind(8) to /var/db/unwind.key, as it doesn't need to be in a directory writable by group _unwind. Additionally, began tracking it in changelist(5).
Imported Kristaps' openrsync into the tree and began adjustment to match style(9) guidelines.
Removed the implicit RTF_MPATH flag that rt_ifa_add() set on new routes.
Simplified check for whether /usr/share is on an NFS filesystem in reorder_kernel.sh.
Corrected PPC target in llvm to reflect that a long double is the same as a double on OpenBSD/powerpc.
Set pkcs11.so to initialize pkcs11 interaction to allow it to ask for the smartcard's PIN during ssh-keygen(1) with -D.
Adjusted pfctl(8) parser to insist anchor names must not be empty.
Further simplifed trust anchor handling in unwind(8), allowing removal of wpath and cpath pledges from the parent process.
Set logging of X.509 peers' certificate subject names during tls client authentication in httpd(8).
Added Allwinner V3s support.
Adjusted scp(1) to accept shell-style brace alternations (e.g. "{foo,bar}") when verifying that filenames sent by the server match client requests.
Changed ssh(1) to log when a connection is dropped for attempting to run a command when ForceCommand=internal-sftp is in effect.
Updated to xf86-video-apm 1.3.0, xf86-video-s3virge 1.11.0, xf86-video-chips 1.3.0, xf86-video-i128 1.4.0, xf86-video-neomagic 1.3.0 and xf86-video-i740 1.4.0.
Fixed ipv4 checksum calculation for mpls_input.c that was being performed in memory half the necessary size.
Fixed a race condition for install(1). This patch makes the -S option a no-op, its functionality becoming the default behavior.
Fixed stack info leak in execve(2).
Made clear in the documentation that httpd(8) supports fastcgi over TCP.
Imported unbound(8) 1.9.0 and updated unwind's copy of libunbound.
Removed rpath from the pledge in cut(1) when only stdin is used.
Rewrote trust anchor handling in unwind(8) to stop using libunbound's auto trust anchor feature, allowing tightening of the resolver process pledges.
Implemented processing of EncryptedExtensions in the ssl(3) TLSv1.3 client.
Added lock stack trace saving for witness(4). This setting is not enabled by default.
Adjusted bwfm(4) to correct possible memory leaks by changing it to consistently use m_freem(9) and adding an assert to identify overruns of the task ring queue.
Reworked fec(4) handling of descriptors and buffers. Added recovery in the case of a full transmission queue.
Improved handling of roff identifiers that end with a tab character in mandoc(1).
Fixed a possible memory leak in tcp_usrreq().
Replaced overlapping memcpy(3) with memmove(3) in getpathname() for fsck_ffs(8) and fsck_ext2fs(8).
Added display of rcpt address for RCPT errors in smtpd(8).
Added -b to display-panes like run-shell in tmux(1).
Fixed addend handling for relaxing R-PPC-PLTREL24 relocations in ld.bfd(1), making -Wl and -relax work well enough to link base clang on macppc.
Fixed a potential out-of-bounds read when regcomp(3) is passed a bad expression.
Adjusted ps(1) to work in single user mode where /var/run is unavailable or in cases where /dev does not exist.
Added an example unwind.conf(5). (Note that unwind(8) works without a config file in many cases).
Converted openssl(1) pkey to the newer style of option handling.
Added handling of Cisco's Encapsulated Remote Switch Port Analyzer (ERSPAN) protocol to tcpdump(8).
Fixed printing of major and minor from dev_t in various parts of the tree.
Fixed NULL-deference crash in ssh(1) in the PKCS#11 code.
Fixed a potential mbuf double free in the out-of-band soreceive() path.
Added support for defining variables through the environment in pkg-config(1).
Implemented as-override in bgpd(8), a feature where the neighbor AS is replaced by the local AS in AS paths.
Added --validate flag to pkg-config(1) and updated version to 0.29.0.
Added a pthread_get_name_np(3) to match pthread_set_name_np(3) in pthreads(3).
Fixed an undefined case when neither -msave-args or -mno-save-args are specified in LLVM.
Imported libc++, libc++abi and libunwind version 7.0.1.
Adjusted members of glob_t to match POSIX in glob(3). IMPORTANT NOTE: This required a libc major version bump.
Implementing parsing and processing of TLSv1.3 ServerHello messages in ssl(4).
Fixed a panic caused by bwfm(4) by handling control messages that exceed MLEN.
Applied a fix to update the caller-supplied pointer in semundo_adjust() to prevent a potential use-after-free panic.
Allowed tun(4) access to AF_MPLS packets from userland.
Converted openssl(1) rsautl to the newer style of option handling.
Improved support for Marvell wi-fi microcontroller SoCs with the creation of the mvgicp(4) driver.
Fixed exception handling issues with clang++(1) on platforms not using ld.lld(1) as the default linker.
Added captive portal detection for unwind(8).
Enabled -msave-args when building an amd64 kernel with clang(1).
Increased datasize in login.conf(5) for sparc64 to accommodate Mesa.
Adjusted pfctl(8) to show the routing address selected by "route-to" when "pfctl -s states" is used.
Improved stack trace saving on amd64 and i386.
Added retries to acme-client(1) when not all challenges are validated.
Fixed wscons(4) to remove a potential use-after-free panic involving wskbclose().
Fixed ixl(4) calculation of physical function ID, improving the function of the second port on dual port cards.
Added libelf to allow future use by Mesa.
Applied connection timeouts from an initial ssh(1) attempt to subsequent attempts.
Fixed lost interrupts in fec(4) which could lead to full TX queues.
Incremented efiboot version to 0.14. This is the first version to support softraid(4).
Added kernel locking for clocks in clock_gettime.
Adjusted pf.conf(5) to allow non-numerical port specifications in line with other rules and added an error message regarding ranges without start values.
Fixed compilation of amd64 kernel when optimization is disabled.
Improved mandoc(1) tbl(7) centering in mdoc(7) documents.
Implemented booting from softraid on arm64.
Modified unwind(8) to grant non-privileged users access to status information. Use of reload and logging commands requires root.
Enabled unused IQ/ADC calibration code in the athn(4) driver. Completed and enabled noisefloor calibration code.
Adjusted tc_setclock not to rewind the system uptime during resume/unhibernate.
Corrected handling of TLS sigalgs extensions for TLSv1.0/TLSv1.1 for ssl(3).
Modified bwfm(4) to query firmware for RSSI levels and current transmit rate on behalf of ifconfig(1).
Implemented -msave-args in clang(1)/llvm.
Updated compiler-rt to 7.0.1.
Enabled CRYPTO for arm64 RAMDISK to allow use of softraid(4) crypto during installation.
Fixed a bug in calendar(1) that led to duplicate display of events when -B was used.
Improved imsg processing in unwind(8) to be more paranoid, excepting the control socket (so users can't bring down unwind).
Adjusted pckbc(4) to discard unwanted mouse events from the keyboard input channel while on the console.
Modified mail.lmtp(8) to strip carriage returns from lmtp responses.
Added a dedicated sysctl(2) node for witness(4).
Imported Mesa 18.3.2.
Modified rtwn(4) to accept control frames in monitor mode.
Made -N and -r mutually exclusive in pfctl(8), allowing either disabling DNS or enabling additional reverse lookups, not both.
Enabled ixl(4) on sparc64.
Implemented -a ("archive" mode, synonymous with -RpP) for cp(1).
Adjusted fstat(1) to filter multiple pids and multiple users at the same time.
Switched i386 to use lld as the default linker.
Stopped accounting/updating priorities for idle threads, fixing an accounting bug where top(1) would report high CPU usage for idle threads of secondary CPUs right after booting.
Implemented the ability to break into ddb(4) using imxuart(4).
Modified ld.lld(1) to produce binaries compatible with the W^X implementation on i386.
Unveiled _PATH_DEVDB in su(1) and wall(1) due to the use of ttyname(3).
Added domain-s (DNS over TLS) to services(5).
Imported LLVM 7.0.1 release.
Implemented DNS over TLS (DoT) in unwind(8).
Added a kernel fix for a potential panic when a negative value is used to index an array, validating in wscons(4) the user-supplied device index given to WSMXUIO_ADD_DEVICE.
Adjusted mpe(4) mpls rtable behaviour to match mpw(4), removing a special case in mpls_input. Reworked mpe_input to patch ipv4 checksum and handle ipv6.
Added 'uselease' statement to dhclient(8) to replace 'append,' 'default,' 'ignore,' 'prepend' and 'supersede' actions on lease-provided values.
Improved support for nmea(4) devices, providing altitude and ground speed values as sensors.
Added an scp(1) client check for whether filenames sent during remote -> local directory copies satisfy the user-specified wildcard, and a -T flag to disable this functionality in case of this check rejecting wanted files.
Made ssh-keyscan(1) return a non-zero exit status if it finds no keys.
Added a delay to fix pms(4) touchpad driver issue on ThinkPad X1 Gen6.
Tagged the start of witness(4) output with prefix "witness:" to allow easier data extraction.
Changed an abort(3) call to an _exit(2) in crypto(3) to guarantee termination of the running program without potentially leaving key material in core files.
Fixed a double free in ldap(1).
Eliminated a bug wherein the ttl 0 could be incorrectly decremented to ttl 255 for incoming mpls packets.
Fixed microsecond output of timestamp deltas (-tttt) for tcpdump(8).
Enabled ccp(4) on arm64 and armv7 ramdisks.
Set ssh(1) to accept the host key fingerprint as a synonym for "yes" when accepting an unknown host key, allowing pasting of fingerprints obtained through other means to have the client perform the comparison for you.
Forced progressmeter to update at the beginning and end of a transfer, fixing a bug where it wouldn't display on quick scp(1)/sftp(1) transfers.
Fixed a crash on long lines when switching to another file in vi(1).
Increased default datasize on arm64 to 768M to prepare for building clang 7.
Removed SHA224 and GOST-based signature algorithms from use in TLS 1.2.
Set route(8) to display the same flags in RTM_IFINFO messages as ifconfig(8).
Reworked mpw(4) to be an actual ethernet interface.
Removed support for obsolete "host/port" syntax in ssh(1). This is no longer commonly used and may be confused with CIDR notation.
Changed bridge(4) to only copy packets for span ports if the bridge is up.
Imported unwind(8), a hybrid validating stub and recursive resolver. It actively observes the local net to decide how best to resolve names.
Moved 802.11n rateset definitions out of MiRA to make them available to net80211 and drivers in general. Added short guard interval support.
Added the apm(4) subsystem to arm64.
Taught ldpd(8) to ask if a potential pseudowire interface is pwe3-capable.
Changed scp(1)/sftp(1) to sanitize scp filenames via snmprintf.
Allowed auto-incrementing of certificate serial number for certificates signed in a single command line for ssh-keygen(1).
Reworked how tcp(4) md5 signatures are configured in ldpd(8). Now configuration is allowed against a prefix in addition to a neighbour.
Added a specific panic to stop the kernel booting in case of an RPC error during NFS boot of a diskless(8) host.
Pledged video(1) in response to the newly-added promise.
Reordered PCI device assignment in vmd(8) to fix Linux network interface numbering. Previously, changing assigned disks would change the interface name under some Linux distributions. IMPORTANT NOTE - if you have existing Linux guest VMs, you'll need to modify your configuration files on a one-time basis.
Increased maximum MTU of bnxt(4) to match the linux driver.
Provided SSL_get_client_ciphers() and SSL_get1_supported_ciphers() (part of the OpenSSL 1.1 API).
Added support to crypto(3) for xchacha20 and xchacha20-poly1305, extending the nonce range and allowing use of random nonces.
Modified syspatch not to return an error if a rollback is attempted when no patches have been installed.
Syspatch(8) now warns the user to reboot after installation of a new kernel and identifies the location of errata on the local machine.
Removed undocumented 24 hour limits for timeouts from select(2), pselect(2), poll(2) and ppoll(2).
Added a -J option as a shortcut for -o Proxyjump= to scp(1) and sftp(1) to match ssh(1)'s interface.
Switched sntrup implementation source from supercop to libpqcrypto in ssh(1).
Added the ability to parse epoch seconds to strptime(3). Added a -f pformat flag to parse the given time with strptime to date(1).
Fixed problem where unveil(2) system call can leak memory.
Added video promise to pledge(2), allowing ioctls on video(4) devices selected from video(1) and firefox wbrtc implementation.
Introduced a dedicated entry point data structure for file locks.
Provided the initial TLSv1.3 client implementation in LibreSSL.
Introduced -v flags for ssh-add and ssh-pkcs11-helper in ssh(1).
Improved logging to record actual time values and specify whether a TLS certificate is not yet valid or expired when using ntpd(8) constraints.
Factored out several functions duplicated between client and server for ssh(1).
Removed obsolete SSH v.1 functions in ssh(1).
Enables manual validity checking for constraints in the X.509 certificate in ntpd(8). This should prevent failure of automatic validity checking based on incorrect system time, allowing use of the HTTP header's report of server time.
AMD64 machines will now support 2TB of physical memory, extendable in the future.
Improved handling of CPUID[1].ECX[OSXSAVE] bit.
Adjusted bgpd(8) to use Adj-RIB-Out to push UPDATE messages to peers, improving memory usage.
Made handling of MSR_SMBASE and MSR_SMM_MONITOR_CTL more correct in vmm(4). These will now generate general protection fault as per spec.
Adjusted mac filters to allow viewing vlan traffic and arp requests on vlans in ixl(4).
Added refresh for arp(8) entries that are about to expire.
Added support in bgpd(8) and bgpctl(8) for group descriptions in control messages that accept a neighbor description.
Added support for ECDSA keys in PKCS#11 tokens.
Added a -T option to test whether ssh(1) keys in an agent are usable.
Imported xorgproto 2018.4.
Added support for a new kcov(4) trace mode called KCOV_MODE_TRACE_CMP to trace comparison instructions and switch statements, usable during fuzzing to generate even more coverage.
Set the shell to strip quotation marks from daemon_flags when starting a daemon with rc.d(8), making the details in pexp match what appears in the process list.
Restored correct display of treasure when snake runs over the money in snake(6). Adjusted cursor location during space warp and display of the pinball bonus.
Changed imsg header definitions to use standard types.
Fixed BN_is_prime_* calls in libcrypto(3), openssl(1), ssh(1) and sshd(8).
Handled link state change interrupts in ixl(4).
Serialized tc_windup() calls and modified some timehands.
Committed refactored ssh(1) packet parsing API.
Changes to dhclient(8) now handle changes to SSID or LLADDR by retrieving a new lease. This mproves performance when join connects to new networks.
Improved join error handling inifconfig(8).
Added a pwraction sysctl(8) that allows conversion of a power button into a sleep button if desired.
Set an ssh(1) password prompt to begin with a carriage return to obscure portions of a password entered too early.
Enabled myx(4) on the large ramdisk for amd64.
Finished randomizing remaining layers of pmap_kernel.
Enabled ixl(4) on amd64.
Added a TLS record handling implementation.
Moved boottime into the timehands.
Added a partial port of EC_KEY_METHOD from OpenSSL 1.1 to libcrypto. Added various apis from OpenSSL 1.1 to LibreSSL.
Set removal of a currently active network from the join list to disconnect as well.
Added "join any" option to allow users to automatically connect via join() to any open wifi network. Known networks are preferred.
Increased the socket buffer size for sendsyslog(2) to 1 MB for fewer messages dropped by syslogd(8).
Updated to libpixman 0.36.0 in xenocara.
Added protective check for negative length integers in nfs clients and servers, as well as negative length NFS strings.
Reconnected bfd(4) to the build after updating for sounlock() api change.
Set dhclient(8) to ignore HUP signals. Starting a new dhclient will handle this use case by killing and executing a new copy.
Began validating relative timeout before sleeping for futex(2).
Began validating inputs to adjtime(2), settimeofday(2) and clock_settime(2).
Changed the default digest type to sha256 for openssl(1). Added support for pbkdf2 with OpenSSL-compatible flags.
Removed vmm(4) and disabled vmd(8) and vmctl(8) for i386 host systems.
Renamed TLS extension-handling functions to better fit TLSv1.3.
Enabled use of a 64-bit register when required for inline assembly on sparc64, correcting sparc64 kernels compiled with clang(1).
Continued work to prepare the network stack for fine-grained locking.
Added support for the SSD1306 OLED display.
Modified signify(1) and doas(1) to prevent passwords from being retained in memory when errors are encountered.
Prevented users from specifying multiple join or nwid arguments in one ifconfig(8) call.
Fixed crash conditions in unveil(2), along with some cases where unveil would return ENOENT instead of EACCESS.
Enabled bwfm(4) in RAMDISK_CD for amd64, allowing use during installs.
Laid groundwork for TLSv1.3.
Added a -h flag to sftp(1) chown(8), chgrp(1), and chmod(1) commands to request they not follow symlinks.
Added support for a "lsetstat@openssh.com" extension. This replicates the functionality of the existing SSH2_FXP_SETSTAT operation but does not follow symlinks.
Updated to exit syspatch(8) correctly after updating itself. Improvement to readability of patches to install on first boot.
For external LSAs the type (1 or 2) is encoded in the metric field. Fixed a problem where ospfd(8) and ospf6d(8) overwrite this information when "depend on" is used and the specified interface is down.
Added Allwinner H3/H5 ohci(4) clocks.
Repaired inter-word spacing of postscript and pdf outputting by mandoc(1).
Corrected setting of default colours in tmux(1).
"No data" frames will no longer be processed in ieee80211_input(9) before decryption and incorrectly counted as decryption failures.
Characters that will not be copied are no longer highlightable in tmux(1).
Allowed programs to set the Checking Disabled flag on DNS requests.
Prevented ntpd(8) from starting when an instance is already running.
Added support for building sparc64 kernels with clang(1).
Fixed mailq(8) output for smtpctl(8).
Code review and clean up of locate(1).
Fixed minor issues in ksh(1).
Modified ttyflags(8) to improve memory usage.
Cleanup and improvement of dhclient(8).
Redundant debug message removed for iwn(4).
Added support for gpio(4) bus and improved card detection on Octeon systems.
Fixed an off-by-one error in pfkeyv2_sysctl_policydumper().
Improved support for Broadcom trackpad mouse ubcmtp(4) by validating interfaces and claiming them during *attach().
Validated interfaces for if_ral passed to *match().
Improved syslog(3) to support program names including "." and "_".
Updated xf86-video-ati to 18.1.0.
Set clang(1) to disable the correct performance options based on architecture. Clang now checks CPU architecture and not system architecture when setting protection flags.
Enabled uhci(4) USB support for ARMv7.
Fixed pfctl(8) to exit immediately when -i interface is given with -F all to prevent invalid usage from flushing anything.
Modified pfctl(8) to warn about table namespace collisions across all anchors and during -n test runs as well.
Antiquated mincore(2) will not be needed and was removed, eliminating an interface that exposed physical machine information unnecessarily.
Bug fixes for otus(4) devices based on the Atheros AR9001U chipset.
Changed mandoc(1) html output to display tooltips using css exclusively.
Clarified in documentation that OpenBSD ignores the LC_NUMERIC category as a safety practice, and outlined best practices for portable programs.
Addition of the imxsrc(4) i.MX system reset controller driver, used to assert the reset pins for the PCIe controller, etc.
Bug fixes in pfctl(8).
Added abcrtc(4) Abracon AB1805 real-time clock driver.
Eliminated alloca(3) call from vioqcow2.c and replaced with malloc(3) to prevent known-location object placement by an attacker.
Implemented Event()/Signal()/Wait() AML operations for acpi(4).
Improved the "not my pool" searching loop in malloc(3) and made the number of pools variable. Optimization of multi-threaded case by adjusting default number of pools to 8.
Hacking on virtio(4), including defines, bug fixing and pci device list.
kern_time.c will not allow cancellation of ongoing adjtime(2) until after full permission checks.
Adjusted nc(1) to use memset(3) instead of bzero(3) for portability and POSIX compliance.
Pledge(2) and unveil(2) unbound-anchor(8).
Improved portability of mandoc(1) to other operating systems. Improved html and css used for html generation.
Prevented radeondrm(4) from using aperture memory to overlap the framebuffer.
Improved ddb(4) readability by printing right-aligned hex values.
Fix for rcs(1) to allow correct lock resolution before expansion of keywords, so expansion can happen with the correct values and files don't show up as modified.
Added the ability for arm64 efiboot to boot from partitions other than "a".
Spleen font enabled in wsfont, along with font selection logic to allow selecting larger fonts when available at runtime in rasops(9).
Implemented an if_enqueue handler for vlan(4), bypassing the ifq handling for a performance improvement in particular configurations.
Disabled ret-protector and retpoline protections in the clang(1) compiler to regain build performance.
Adjusted httpd(8) to start when TLS is configured but keys and certificates are not yet present.
Fixed snmpd(8) child processes so they properly detach from the terminal.
Moved /etc/acme-client.conf to /etc/examples/acme-client.conf.
Changed ksh(1) to skip most of the mail check if MAIL is not set.
Made ntpd(8) log DNS failures, even if they are only temporary.
Made the output of usbdevs(8) fit in 80 characters when a serial number is printed.
Added inteldrm for fw_update(1).
Made mdoc(7) represent .Pp, .sp, and some SYNOPSIS and .Rs features with the HTML p element.
Added a pledge(2) to the parent process of file(1).
Added the ability to exit grdc(6) by pressing "q".
Cleaned up and corrected various output quirks in mandoc(1).
Simplified the code in dhclient(8) that processes bpf(4) captures.
Corrected HTML output errors emitted by mandoc(1) for man(7) .RS blocks.
Corrected accounting of the memory allocated when creating a set in bgpd(8).
Updated xf86-video-mga to version 2.0.0 and xf86-video-mach64 to 0.9.6.
Fixed the incorrect assumption there was no such thing as an "mda session" in smtpd(8) so the session id is logged properly.
Introduced an smtpd 'timeout' reporting event to smtpd(8) to notify filters that a timeout occurred during the smtp session.
Added support for ohci(4), as found on the pine64 and enable it for RAMDISK as well.
Stopped tail(1) from reopening the file when it is stdin.
Made the kernel build without INET6 again.
Fixed a memory leak of ciphercontext when rekeying in ssh(1).
Added a simplebus print function so unconfigured devices appear in the dmesg(8) of arm64 systems.
Increased MAXTSIZ to 256MB because large binaries have grown even larger when compiled with retpoline.
Made smtpd(8) stop stripping the escaping of dots when sending to filters to prevent truncated mail.
Added SNMPv3 support to tcpdump(8). The "-vv" option can be used to retrieve the asn1 dumps.
Added a timeout to refill the mbufs if dwxe(4) runs out of mbufs for the RX ring.
Fixed pfctl(8) to print usage and exit in cases where only one of "-t table" or "-T command" is present.
Changed ospf6d(8) to detect and remove routes with priority RTP_OSPF that were inserted by another program into the kernel routing table.
Added support for the Abracon AB1805 Real-Time Clock and similar variants with abcrtc(4).
Made ospfd(8) send a router LSA update when an interface has been removed.
Added the configuration option "fib-priority" to ripd(8) which allows setting a custom priority for routes ripd inserts into the kernel routing table.
Changed nanosleep(2) to loop tsleep(9) to ensure coverage of the full timeout range. While here, remove the hundred million second upper bound.
Fixed user(8) to experience a fatal error should a bad uid range be specified on the command line.
Changed uudecode(1) to print the offending ASCII code when an invalid character is found in the encoded stream.
Numerous cleanups and code refactoring in mandoc(1).
Turned -mretpoline on by default for clang(1) on amd64. Explicitly turn it back off for SMALL_KERNEL kernel builds.
Added support for IPv6 VPN routes to bgpd(8).
Added the configuration option "fib-priority" to ospf6d(8) which allows setting a custom priority for routes ospf6d inserts into the kernel routing table.
Added the ability to pass sdmmc(4) the maximum segment size that a SD/MMC host controller can handle for DMA transfers.
Added the configuration option "fib-priority" to ospfd(8) which allows setting a custom priority for routes ospfd inserts into the kernel routing table.
Fixed mbuf related crashes in switch(4).
Made bgpd(8) check to see if a control socket or address is in use before using it. If it is in use then abort startup or let a reload fail. Stopped sockets from being unlinked during a normal shutdown.
Changed vmd(8) so that when netbooting a vm using the "-B net" option vmd sets the hostname in the DHCP lease to the name of the vm. This makes for easier use of dedicated autoinstall response files for different vms.
Converted arithmetic(6) to use unsigned variables to avoid overflows.
Changed nc(1) to check for a range of ports only if the first argument is a digit. This removed the potential for confusing port ranges with hyphenated port names.
Added use of speed estimates to improve wscons(4) gesture detection.
Added a terminate imsg to stop long running commands in cases where bgpctl(8) exits before bgpd(8) finishes the work.
Added the new matching criteria "from rdns" to smtpd.conf(5) to allow matching of sessions based on the reverse DNS of the client.
Added Backbone Provider Edge interfaces (bpe(4)).
Fixed a bug in wump(6) that caused nonsensical movement of the Wumpus.
Taught tcpdump(8) that LLDP has its own group address.
Folded ext-communities into filter_community so bgpd(8) can match multiple ext-communities at the same time. Adjusted bgpctl(8) to reflect this.
Fixed detection of MELTDOWN-proof Intel CPUs.
Added the ability to use a DUID to specify the root disk for octeon systems.
Modified the "-l" option of netstat(1) to show only the UDP sockets that can receive packets from any other host. (Sockets that are in a state similar to TCP sockets in the LISTEN state.)
Fixed tmux(1) parsing of empty colon-separated fields.
Changed wsmux(4) to return an error for ioctl(2) commands that are inappropriate when there are no child devices attached.
Made the freelist "best fit" code a little smarter so it will not use a block if half or more of the block would be wasted. This causes more effective re-use of blocks.
Made several improvements to mandoc(1) escape sequence handling and manual font selection.
Changed mg(1) to allow all non-ephemeral buffers to be toggled between writeable and read-only using "toggle-read-only-all".
Fixed printf statements of snmpctl(8) and snmpd(8) when they are compiled with -DDEBUG.
Added the ability to read from stdin using "-f -" to kdump(1).
Made kcov(4) multi-processor safe.
Added optional per-cpu counters for interface statistics.
Updated to unbound(8) version 1.8.3.
Fixed unbound(8) dns64 allocation for returned internal queries.
Extended the vmctl(8) "start -B" argument to work for disk, cdrom, and net. SeaBIOS respects disk and cdrom. The kernel understands net.
Taught libtool(1) to build shared libraries with a soname.
Implemented the fw_cfg interface in vmd(8) which can be used to set the boot order when a boot device was forced.
Started passing the IO ports 0x510, 0x511, 0x514, and 0x518 to vmd(8) in order to pass options to SeaBIOS.
Updated nsd to version 4.1.26.
Improved malloc(3) speed for the multi-threaded case by reducing lock contention.
Fixed mec(4) phy discovery on sgi O2 systems.
Updated xf86-video-openchrome to version 0.6.176.
Added basic MPLS support to libpcap.
Modified behavior of vmd(8) so the guest will stop or exit at the next reboot after "-B" is used to specify a specific boot device.
Fixed a bunch of cases where the dhcpd(8) "pf table handler" process did not exit during a number of failure conditions.
Made sure in iked(8) the prefixlen returned by mask2prefixlen6 is never bigger than 128 and that the daemon will exit when the mask is not contiguous.
Changed conversion of a netmask into a prefixlen to be more strict for eigrpd(8), ldpd(8), and snmpd(8).
Removed an ugly hack in the ssl(3) client certificate verification code that worked around broken GOST implementations.
Corrected ssh(1) calculation of initial bandwidth limits.
Modified rtwn(4) and urtwn(4) to handle 2 transmit chains in the computation of transmit power for the RTL8192UE.
Added support for "-" as an input file for stdin to sed(1), as specified by POSIX.
Added "-not" as a shell-friendly alias for "!" in find(1).
Added very experimental support for DNS over https (RFC 8484) to rebound(8)).
Introduced tx-mail and tx-rcpt report events for smtpd(8).
Made sure that when bgpd(8) is converting a netmask to prefixlen that it never returns a value bigger than 128.
Implemented a simple bgpd(8) ruleset optimizer that merges filter rules that differ only by filter sets.
Added a new "-B device" argument to vmctl(8) start to allow setting of the boot device. It allows kicking off an OpenBSD autoinstall by using 'vmctl start "installer" -Lc -B net -b bsd.rd -d disk.img'.
Made it possible to define the bootdevice in vmd(8). If VMBOOTDEV_NET is used the internal dhcp server will pass "auto_install" as the boot file to the client and the boot loader will pass the MAC address of the first interface to the kernel to indicate PXE booting.
Implemented a time-based method for tracking motion states of touches in wscons(4).
Disabled pvclock(4) on old hardware that lacks a stable clock.
Stopped axen(4) from calling usbd_delay_ms() in an interrupt context.
Changed bgpctl(8) to set the routing table when adding a network.
Applied fix to savecore(8) to unbreak 'savecore -c'.
Added support for RTL8192EU adapters to urtwn(4).
Added the 'vmctl wait <VM>' command to vmctl(8).
Introduced into vmd(8) IMSG_VMDOP_WAIT_VM_REQUEST, a control message registering a vmctl peerid which should be informed when the VM is stopped.
Cleaned up the validation of .Pp, .PP, .sp and .br in mandoc(1), resolving duplicate handling issues, handling missing cases and improving diagnostics.
Began performing forward-confirmed reverse DNS verification on incoming connections in smtp(1).
Stopped processing the top 32 bits of the 64 bit interrupt mask register in macebus(4) on the SGI O2. The CRIME interrupt controller has only 32 interrupt sources.
Fixed handling of lld-linked executables on mips64.
Added Spleen font 8x16, 12x24, 16x32 and 32x64 variants.
Added support for Xeon E3-1200 v6/7 host device and nVidia Quadro M1200.
Added new midicat(1) utility to send to or receive from MIDI ports.
Removed midiplay.
Restore inadvertently removed function prototype for ASN1_dup in crypto(3), fixing usage on I32LP64 platforms.
Modified syslogd(8) to honor SIGINT/QUIT when running in the foreground, allowing stopping 'syslogd -F' with ^C.
Fixed various overflows in perl(1).
Fixed a bgpd(8) memory leak and use-after-free of the peer ID in the bgpctl(8) code path by flushing the Adj-RIB-Out as soon as the peer state is PEER_DOWN.
Modified top(1) to allow reversing sort order by prefixing the field with a dash.
Enabled configuration of explicit congestion notification propagation on tunnel interfaces.
Corrected lock initialization for crypto(3).
Prevented discovered prefixes from overriding explicitly configured prefixes in rad(8).
Modified ssh(1) not to truncate username or hostname in 'user@host's password: ' prompts.
Removed an extra tick from tvtohz(9) on timeout reload.
Fixed malformed output when querying certain databases with ldap(1), matching the functionality of openldap's ldapsearch.
Released mandoc.css from mandoc(1) into the public domain.
Changed vmd(8) to keep a list of known VMs and reuse the VM IDs. When using '-L', the IP addresses of the VMs are stable.
Removed fontcacheproto, xf86miscproto, libXfontcache and libXxf86misc.
Adjusted installboot(8) not to allow the bootstrap to overlap the start of the OpenBSD area of the disk.
Expanded detail available about networks saved by 'join' when a user uses the ifconfig(8) 'joinlist' option.
Improved error handling and logging in qcow2 within vmd(8).
Added the pvclock(4) guest driver for paravirtual clocks, improving timekeeping on KVM guests.
Added an ssh_config(5) "Match final" predicate.
Provided new mandoc(1) output option -O tag[=term] to move directly to the definition of "term" when opening the manual page in a pager.
Added support for 'local inet6' interfaces to vmd(8).
Deleted malloc_usable_size() function, which exposed some of the internal workings of malloc(3) and can be replaced by allocation.
Initialized cached last sequence numbers for received packets to invalid values rather than dropping the first packet received from each AP in each QoS class, which would affect the first packet of the WPA2 4-way handshake on certain APs and could lead to connection delay or failure.
Fixed the case in ksh(1) where the recursion detection isn't reset when the command is interrupted.
Applied unveil(2) to boot images specified by the -o option in makefs(8). Added exiting with an error status when writing a CD image fails.
Fixed malloc(3) compilation on alpha.
Made case-insensitive extended regular expressions the default in man(1) -k searches, improving POSIX compliance.
Adjusted wscons(4) to use sigio(9).
Added usb(4) device ids for D-Link DWA-171 rev C1 and Xiaomi mini USB WiFi.
Silenced (to log level debug2) ssh(1) failure messages when loading the default hostkeys.
Fixed syspatch(8) build on macppc and arm64.
Fixed a crash in bgpd(8) when printing an error message that a network prefix-set is not found.
Added new KERN_CPUSTATS sysctl(2) for identifying offline CPUs. Made use of this in systat(1) and top(1).
Added a check to prevent a truncated cmsghdr leading to an embedded length longer than the supplied buffer in kdump(1).
Added a fix to avoid leaking kernel memory in struct kevent(2) padding.
Modified tcpdump(8) to allow root privileges to be dropped completely at runtime.
Corrected tty hang-up in getty(8).
Finished transition of ld.so(1) to GNU_RELRO.
Added support for Allwinner A64's eMMC controller. This makes the eMMC work on the Pinebook.
Changed rad(8) to avoid a fatal error if IPV6_LEAVE_GROUP fails due to a destroyed or detached interface.
Adjusted vlan(4) to use txprio, not link0 and llprio, to set the dotlp in the header. IMPORTANT NOTE: if you're using llprio and link0, a configuration update will be needed.
Redirected stderr of ProxyCommands to /dev/null when ssh(1) is started with ControlPersist.
Fixed an ssh(1) client bug where a redundant ssh-agent socket was retained for the life of the connection.
Fixed an ssh(1) bug where when only RSA-SHA2 signature types were specified, authentication would always fail for RSA keys.
Repaired legacy ciphers for ssl(8) prior to 1.1 by setting a legacy signature algorithm for MD5_SHA1 and using it as the non-signature algorithm default.
Introduced a prefix of '@' to suppress echo of sftp(1) batch commands.
Added support for txprio configuration in vxlan(4).
Added [template] to display-panes and choose-{buffer,client,tree} usage in tmux(1).
Ported an additional mitigation for an openssl(1) timing vulnerabiity in ECDSA signature generation.
Plugged a memory leak in host()'s error code path in bgpd(8).
Used the txprio setting to populate the tos in keepalive packets.
Modified snmpd(8) to use unveil(2) despite inability to use pledge(2), closing an attack vector.
Added txprio support to gre(4), mgre(4), egre(4), nvgre(4) and eoip(4).
Added support for txprio settings on interfaces with ifconfig(8). This adds a txprio argument with a setting which can be changed to 'payload,' 'packet' or a number between 0 and 7.
Modified dhclient(8) to restart when an SSID change is noted in RTM_80211INFO, ensuring that the correct lease is discovered or renewed and the lease file is properly updated.
Added the new routing socket message RTM_80211INFO to provide details of 802.11 interface state changes and added support to route(8).
Added a mechanism for managing asyncronous IO signal registrations.
Set the hardmtu on ethernet encapsulated interfaces so the MTU can be raised above 1500.
Limited the number of interface units to the number of device minors, preventing the creation of tap(4) and tun(4) devices which can't be opened from userland because of the limit on the number of dev_t minor numbers.
Built clang(1) on mips64.
Changed the proc message formatting API in smtpd(8) to accept NULL as a valid string.
Adjusted ripd(8) to accept 'interface ifX' without parameters.
Added implementation of the SM3 hashing function within crypto(3). The SM2/SM3/SM4 algorithms are mandatory for legal use of cryptography within China.
Added automatic threading initialization for crypto(3).
Fixed ssl(8) to free the server TLS transcript in case session reuse has failed.
Enabled the -D option for ping6(8).
Fixed the vnetid range in ifconfig(8). 0 and 4095 are reserved IDs per 802.1Q and vlan(4).
Added support to ping(8) and traceroute(8) for setting the traffic class on IPv6 packets.
Reduced needed pledge(2) use further in tcpdump(8).
Removed ethers(5) YP support from libc, allowing more effective use of pledge(2) in some programs.
Modified nc(1) to report to stderr in verbose mode when the listen system call has finished, allowing writing of race-free scripts as server status can be checked.
Cleaned up and simplified the ssl(8) handshake transcript code, providing a more readable API with code that uses a BUF_MEM instead of a BIO.
Fixed a case where if a server asked the client for a certificate that doesn't exist, a handshake transcript would be left behind in ssl(8).
Changed the default listen port for switchd(8) from 6633 to 6653, the IANA standardized OpenFlow port. When a listen port is not specified in switchd.conf(5), it will be randomized.
Used the original client border width to adjust initial placement of clients containing {P,US}Position requests where they are explicitly set to 'ignore' in cwmrc. This prevents unintentional client offset in cwm(1).
Improved use of unveil(2) within passwd(1).
Introduced the 'smtp-in' keyword to smtpd(8) to allow less ambiguous reporting of smtp-in and smtp-out events.
Expanded reporting of tx events in smtpd(8).
Fixed a problem associated with keeping default ribs alive and Adj-RIB-In/Out in bgpd(8). The RIB will only be recreated if the FIB distribution flags changed or the rtableid changed and there is a FIB.
Applied unveil(2) to tcpdrop(8).
Fixed clipping during float to integer conversions in aucat(1).
Fixed an error in tmux(1) by ensuring that a non-repeating key used when repeating be treated as an entirely new key press.
Tested TLS interoperability between LibreSSL and OpenSSL by implementing a simple SSL client and server in C, then creating four binaries by linking them with LibreSSL or OpenSSL to test API compatibility.
Defined TLS_CA_CERT_FILE rather than having every application create their own define for /etc/ssl/cert.pem.
Corrected unzooming and redrawing of panes in switch-client for tmux(1).
Implemented SAFE-INIT-CHAR for ldap(1).
Allowed join(1) to join on a multibyte separator.
Added new vm.malloc_conf sysctl for malloc(3) flags.
Began work to add feature flags for LibreSSL.
Introduced bn_rand_interval() to allow specifying an interval from which a BIGNUM is chosen uniformly at random.
Improved the filters for touchpad scrolling in wscons(4).
Modified icmp_input_if() m_pullup to increase the maximum size of required data at the start to simplify code and reduce m_pullup calls.
Implemented coordinate blinding for EC_POINT in ssl(8). Renamed the TLS Supported Elliptic Curves extension to Supported Groups re: RFC 7919.
Adjusted snmpd(8) promises to remove an unnecessary rpath promise and unveil(2) the snmpe process.
Fixed the case where an mbuf cluster is used in icmp(4) to correctly offset the data and generalize checking.
Implemented C11's aligned_alloc(3).
Adjusted ntpd(8) to be stricter with TLS configuration.
Updated the opensslfeatures.h to include all of the OPENSSL_NO_* flags that exist in ssl(8). Defined OPENSSL_NO_ASYNC, as libcrypto does not have built-in async features.
Fixed an error introduced to tcp(4) that broke setting of a fixed socket send buffer size due to out-of-sync algorithms.
Introduced a real Adj-RIB-Out to bgpd(8) and removed the update_rib introduced before 6.4.
Added a pledge(2) to ripe and rde in ripd(8) and used unveil(2) to remove file system access for the parent process.
Changed dhclient(1) to log "LLADDR changed" and "restarting" when LLADDR is modified and the restart is actually executed, no longer saying 'restarting' twice.
Adjusted smtpd(8) to apply filter rules only to filtered interfaces.
Explicitly disabled xdm-authorization-1 support in X(7) server.
Changed dhclient(8) to ignore incoming packets and routing socket messages and to cancel any pending protocol timeout when reacting to SIGHUP.
Modified top(1) to accept numeric user IDs, making 'top -U 0' and 'u-1000' work.
Modified getent(1) to prefer user names over numeric user IDs.
Disabled LOCKF_DIAGNOSTIC for lockf(3).
Allowed smtpd(8) to fork processes at startup and maintain a socketpair with them.
Merged libdrm 2.4.96.
Changed smtpd(8) to log tls events as 'tls' and not 'starttls'.
Increased max frame size and hard MTU to allow use of vlan(4) and jumbo frames on ure(4).
Added unveil(2) support to htpasswd(1) and ifstated(8).
Added C11's timespec_get(3) to libc.
Relaxed unveil(2) restrictions for shells needed to run shell scripts that starts with a '#!' line.
Added unveil(2) support to ospfd(8) and ospf6d(8).
Changed mbufs and mbuf(9) clusters to be backed by large pools and relaxed the oversubscribe limit of socket buffers.
Fixed route collector mode in bgpd(8).
Updated libtool(1) to handle both DT_RUNPATH and the older DT_RPATH elements.
Corrected handling of symlinks in syspatch(8).
Changed ieee80211(9) to avoid joining a network where crypto is found but cleartext was expected.
Added acpipci(4) on amd64.
Added tracking of memory usage for sets and tries in bgpd(8) and display of memory usage to bgpctl(8).
Fixed memory leak in csh(1).
Changed nc(1) to show what went wrong with a unix domain socket rather than failing silently.
Added unveil(2) support to rebound(8), getconf(1), kvm_mkdb(8) and bdftopcf(1).
Disabled setuid on Xserver(1) in response to recent disclosure of vulnerabilities.
Fixed calculation of ASPATH_HEADER_SIZE by using offsetof() instead of the sizeof calculation in bgpd(8).
Disabled -logfile and -modulepath when running Xserver(1) with elevated privileges, as these could cause arbitrary overwriting of files (CVE-2018-14665).
Fixed a kernel resource leak in doaccept().
Added a 'terminal' colour which can be used instead of 'default' in style options for tmux(1).
Added unveil(2) support to Xserver(1), passwd(1), spamlogd(8) and spamd(8).
Implemented constant width font escape sequences for html output in mandoc(1).
Incremented major versions for crypto(3), ssl(3) and libtls due to libcrypto symbol removals and libssl changes to struct visibility/sizes.
Further restricted the pledge(2) in switchctl(8).
Fixed bgplg(8) show ip bgp out/in, updated usage message and added missing neighbor argument. Added 'show ip bgp ovs' and 'show ip bgp ext-community' commands.
Fixed minor issues in csh(1) found by coverity.
Fixed qcow2 disk images larger than 4GB in vmd(8).
Adjusted mandoc(1) handling of tags containing whitespace to better interoperate with ctags(1).
Fixed a bug in mandoc(1) when handling blank lines inside preformatted html sections.
Adjusted join(1) to allow joining on NULL columns.
Fixed an off-by-one error in ldap(1) when wrapping long LDIF lines.
Imported Mesa 17.3.9.
Corrected HFSC so it no longer forces packet priority to the highest setting when enabled.
Switched amd64 to ld.lld(1) as the default linker.
Added unveil(2) support to sensorsd(8).
Removed instances of #ifdef INET6 from tcpdump(8) code.
Set ipsec(4) to use a monotonic clock for SA creation and lookup timestamps.
Adjusted ld.lld(1) to accept both '--foo bar' and '--foo=bar' style options in the manner of GNU linkers.
Fixed cvs(1) handling of checking out commits by date when there is a vendor branch with a commit on top of it.
Adjusted the bgpd(8) RDE to act on XON/XOFF messages to properly throttle dumping of prefixes to peers.
Added the ability to query a switch(4) instance via its control device to switchctl(8).
Set kdump(1) to display the errno returned by futex(2).
Fixed mail.lmtp(8) to not consider connect(2) errors a permanent failure.
Switched alpha to futex(2)-based condvars, mutexes and semaphores.
Added missing unveil(2) of /etc/shells to su(1) for -m option.
Backported llvm's libunwind hardware floating point handling and added quad-precision floating-point support routines for mips64.
Enabled the integrated llvm assembler on mips64.
Adjusted CPU identification in amd64 to take the 'package' into account when calculating the 'smt' ID on modern AMD CPUs to avoid knocking out too many processor threads.
Copied the root check from ping(8) into traceroute(8).
Updated X(7) to libX11 1.6.7 and libSM 1.2.3.
Added vmctl(8) support for creating and converting disk images from existing images.
Fixed slowcgi(8) calculation of the file descriptor limit before accepting a new connection. This prevents a failure when slowcgi is close to the file descriptor limit.
Changed ssh-keygen(1) to include the signing algorithm used by the CA when printing certificate contents.
Removed potential for a spurious end-of-RIB being sent by bgpd(8).
Corrected wrong results produced by join(1) during full and outer join operations.
Added support for windows larger than are visible on the attached client to tmux(1).
Improved tmux(1) clipboard handling.
Added tmux(1) support for extended underline styles on terminals offering them.
Fixed fmt(1) accounting of NUL for allocation size and moved to use of reallocarray(3).
Reworked processing of gre(4) keep alive packets.
Adjusted time scheduler statistics so time spent spinning in interrupts is no longer accounted for within the system time of a process.
Fixed regression in pf(4) that caused quick on anchor rules to be ignored.
Adjusted bitmap tables and output routines of banner(6).
Added a linker script to assist lld with building biosboot(8).
Added traffic class of ipv6 headers to gre(4) encapsulation.
Addressed crashes when checking for duplicate user(8) entries.
Used the up_rib tree to withdraw all prefixes of a peer which is used to reload peers into a new RIB in bgpd(8). Removes one additional full RIB tree walker.
Rate-limited the interval over which a VM can reboot, preventing VM reboot loops in vmd(8). Three VM restarts less than six seconds apart are assumed to be unintentional, and the VM is stopped.
Made httpd(8) omit HSTS headers for unencrypted connections per RFC 6797.
Fixed mrt table dumps in bgpd(8).
Linked libc++.so against libc++abi.so to allow linking of C binaries against C++ shared libraries.
Exposed net.inet.ip.arpq.drops to sysctl(8) to aid debugging of dropped packets without counter increases.
--------
Changes made between OpenBSD 6.3 and 6.4
Many changes not listed here.
Fix "heap full" errors in the amd64 boot loader when loading microcode.
Add support in com(4) for Exar XR17V354 4-port devices.
Add TCP support to snmpd(8). Apart from processing multiple requests in parallel, this implements RFC 3430.
Make relayd(8) set destination host state to HOST_DOWN in case of TCP read timeout.
6.1, 6.2 and 6.3 SECURITY FIX: Correct heap overflow bugs in perl(1).
A source code patch is available for 6.1, 6.2 and 6.3.
Make ENGINE_finish() succeed on NULL in LibreSSL, simplifies caller code.
Make ksh(1) count $SECONDS using monotonic clock.
Fix for mg(1) when trying to write backups in home dir when run under a different effective user.
Remove hfsc support from pfctl(8).
Don't panic if ipmi_sendcmd() fails.
Make sshd(8) more resilient against user enumeration timing attacks.
Implemented MAP_STACK option for mmap(2). At pagefaults and syscalls the kernel will check that the SP points to MAP_STACK memory.
Stop using the PID in ping(8).
Make httpd(8) listen on all IPv4 and IPv6 addresses for "listen on *".
More steps for i386 Meltdown fixes, will trigger some performance issues.
Make re(4) handle newer devices with only 64bit BARs, and map 32bit BAR as a fallback.
Add mixer save/restore capability to the audio(4) driver for use during suspend/resume.
Add support in umsm(4) for Huawei k3772-based devices.
Make sasyncd(8) schedule events against the monotonic clock so it fires punctually even if system clock is changed.
Have fstat(1) print rtable for internet sockets unless it's the default.
In tmux(1), add x and X to choose-tree to kill an item.
Make sure the kernel doesn't call logwakeup() while holding a mutex to prevent lock ordering issues.
Make mandoc(1) define a previously undefined integer as being zero.
Make ksh(1) support 64bit integer operations on 32bit arches too.
Added octcrypto(4), a driver for the octeon cryptographic unit, providing hardware-accelerated implementations for several encryption and authentication algorithms for ipsec(4). Disabled for now.
Make smtpd(8) spfwalk check for legitimate IPv4 and IPv6 addresses before printing.
Make headers, manpages and kernel prefer and recommend AF_UNIX name rather than AF_LOCAL.
In kqueue, test for preexisting conditions when re-enabling events.
Make pcidump(8) print BARs for bridges as well.
On amd64, add support for EFI Random Number Generator and use it to XOR random data into the kernel.
Add a hook to the standalone boot code to use a firmware-supplied random function in addition of the machine dependent random function to insert entropy into the booted kernel.
IPv6 fix for gif(4).
Attach the mbuf tag on output gif(4) packets to suppress loops over the interface and avoid leak of the tag on every packet.
For certain arm devices, if the PHY address isn't specified, only attach a single PHY. Makes Theobrama Systems RK3399-Q7 SoM network interfaces work.
Make shutdown(8) print deadline estimates in the local timezone.
Enable islrtc(4) on arm64 GENERIC and RAMDISK kernels.
Added islrtc(4), a driver for the ISL208 real time clock.
Work around libtool exec limitations.
Correct libtls tls_config_clear_keys(3) behaviour, leaving other configuration data intact.
In libtls, switch to OPENSSL_init_ssl(3) to prevent an openssl configuration file from being loaded behind our backs.
Add support in dwmmc(4) for GPIO card detection.
Increase em(4) delay after reset to 20ms and add a fix for i219 based devices.
In UEFI, respect the parts where mappings indicate they can be made non-readable, non-executable or read-only.
Fixed tmpfs(4) to not attempt calling copyin(9) itself.
Patch binutils 2.17 so it passes option -Wno-null-pointer-arithmetic when compiled with LLVM 6.0.0.
Updated llvm to 6.0.0.
Make fstat(1) print a p flag for file descriptors opened after pledge(2).
Better rounding to cylinder boundaries in disklabel(8).
In ssh(1), allow "Sendenv -PATTERN" to clear environment previously labeled for sending.
Fix file descriptor leak in httpd(8) after processing ranged requests.
Use existing pf state to speed up UDP socket lookup.
Fix memory leak in libcrypto if EVP_Digest() fails.
In libcrypto, tighten up various checks for X509_VERIFY_PARAM functions.
In ssh(1), relax checking of authorized_keys environment="..." options to allow underscores in variable names
Stop using a non-portable .R man(7) macro in mandoc(1).
Update mandoc(1) to use documented and portable character escape sequences for .Do/.Dq.
Import pcap_set_immediate_mode() from mainline libpcap which allows a libpcap-based program to process packets as soon as they arrive.
Remove obsolete PF_TRANS_ALTQ from pf(4). Note the required steps in the update guide if updating from source.
Update default IPQoS in ssh(1) and sshd(8).
Libcrypto fixes in X509_NAME_add_entry().
Fix crash in dig(1) when +trace option is enabled and a truncated reply forces fallback to TCP.
Deactivate WITNESS checks in ddb(4), when db_active is set.
On vlan(4) interfaces, use link0 to use llprio in transmitted packets.
Imported regenerated moduli files for ssh(1).
Tweak vlan printing in tcpdump(8) to properly decode priority field.
OpenSSH 7.7 released.
Enabled mvrng(4) for arm64 GENERIC and RAMDISK kernels.
Fix in bgpd(8) for aspath_verify() regarding 2-byte vs 4-byte AS path entries.
Enabled imxiomuxc(4) on arm64 GENERIC and RAMDISK kernels.
Unhook libXfont from xenocara builds, obsoleted by libXfont2.
Enabled dwpcie(4), fec(4) and imxccm(4) on arm64 GENERIC and RAMDISK kernels.
Add minimal driver dwpcie(4) for the Synopsys Designware PCIe core.
Added support for more Intel Apollo Lake devices found on some NUC and Celeron based systems.
In com(4), add support for register shift/IO-width to allow UARTs using 32-bit registers instead of 8-bit, found on some armv7, arm64 and amd64 SoCs.
Add support for arbitrary-length integers in test(1).
Fix binutils 2.17 to build without warnings on LLVM 6.0.0.
Enabled imxanatop(4) on armv7 RAMDISK kernels.
Fix for previously incorrect MII speed setting on armv7 fec(4).
Fixes in apply(1) for realloc(3) noticed when malloc.conf(5) had the J option enabled.
LibreSSL 2.7.2 released.
Fixes for UFS2 with softdep enabled.
Implemented an EFI driver to allow PXE boot over EFIs Simple Network Protocol, allowing TFTP boot on U-Boot based armv7 and arm64 machines.
Fix '-v' option to procmap(1) when using -a to help show holes in the process map.
Enabled mvtemp(4) on arm64 GENERIC kernels.
Added mvtemp(4) a driver for temperature sensors found on Marvell Armada SoCs.
Fix mbuf reuse when sending ARP responses to prevent stale mbuf state affecting the ARP reply packet.
Fix 64bit integer overflows in expr(1).
Fix a hang in i386 vmware guests in /sbin/init.
Recommit of the i386 Meltdown fix.
Fix '-i' on dhclient(8) to discard previously defined values.
Enable imxiic(4) and imxanatop(4) on arm64 GENERIC and RAMDISK kernels.
Enable imxgpc(4), imxgpio(4) and imxesdhc(4) on GENERIC and RAMDISK kernels for the arm64 platform.
Also move imxgpc(4), imxgpio(4) and imxesdhc(4) drivers so they can be shared between arm64 and armv7.
Fix potential overflow in cut(1) for 64bit systems.
Updated bdftopcf to version 1.1.
Moved driver for imxuart(4) so it can be shared by arm64 and armv7.
Updated xterm(1) to version 331.
Updated unbound(8) to 1.7.0.
Enable mvclock(4), mvicu(4), mvpinctrl(4), mvgpio(4) and mvrtc(4) on GENERIC and RAMDISK kernels for arm64 platforms.
Added support for mvrtc(4), a real time clock integrated on various Marvell Armada SoCs.
Fixed some setlocale(3) bugs.
Add support in the flattened device tree code for legacy binding of Marvell devices for "usb-nop-xceiv" PHYs.
Fix memory leak in sparc64 ofwboot when booting softraid(4) crypto devices.
Prevent tmux(1) from crashing in certain cases with empty windows.
Fixed network locking in pppx(4).
Fix in libcrypto for CVS-2018-0739 regarding ASN.1 recursive definition depth.
Remove RDTSCP from CPUID flags reported to vmm(4) guests.
Fix remaining external file system locking so VOP_LOCKs are done in accordance with how WITNESS wants it.
Fix memory leak in pf(4) when adding same table twice.
Check for possible NFS race after sleeping to prevent future lock ordering problem.
Mark ext2fs inode recursive lock as RWL_IS_VNODE to help when WITNESS is enabled.
Configure dwxe(4) TX and RX chain delay based on device tree properties.
In the X.org DRM code, defer disabling the vblank IRQ until next interrupt.
Updated time zone data to tzdata2018d.
Added acpicmos(4), a driver that implements SystemCMOS access support.
SSLeay history from 0.4 to 0.8.1b added to SSL manpages.
Make sure nc(1) clears password buffers in non-terminating cases.
Fix wrong execution and out of boundary writes in apply(1).
Make sure programs violating a pledge(2) promise cannot block the final SIGABRT.
Try harder to execute code protected by mutexes after entering ddb(4).
Exclude SIGKILL from ptrace(2) interception to prevent deadlock when parent waits for the traced process.
--------
Changes made between OpenBSD 6.0 and 6.1
Disabled smtpd(8) client-initiated renegotiation.
Used m_devget(9) to replace ure(4) code which incorrectly assumes a received packet must fit into a single mbuf cluster, potentially fixing observed pool corruption.
Set the interface flag to VMIFF_UP when using the vmctl(8) -i option, making vmd(8) ensure the interfaces are up on startup.
Allowed additional protocol matching to enable umodem(4) to attach to the serial console on the OverDrive 1000.
Fixed a panic triggered by init(8) on the OverDrive 1000 with A1120 (Cortex A57 r1p2) after changing vfp state.
Prevented editing messages in mail(1) from corrupting the mailbox.
Stopped rejecting etherip(4) packets protected with ipsec(4).
Added iked(8) support for RFC 4754 (ECDSA) and RFC 7427 authentication.
Fixed the prefixlen sent by RTM_NEWADDR on new addresses without masks.
Implemented a missing command in vioblk(4) and allowed > MAXPHYS transfers, allowing Ubuntu 14.04 amd64 guests to work.
Added support for additional Allwinner H3 clocks to sxiccmu(4).
Implemented TLS ticket support in httpd(8). This is off by default and can be enabled with a 2h ticket lifetime.
Booted in vmd(8) using BIOS from /etc/firmware/vmm-bios by default. The "vmm" BIOS must be installed using fw_update(1).
Updated to Mesa 13.0.6.
Implemented mvxhci(4), a driver for Marvell's XHCI controller, and mvahci(4), for Marvell's AHCI controller. These enable use of USB and SATA, respectively, on devices like the SolidRun ClearFog or Omnia Turris.
Prevented panics on the ClearFog by not loading the empty memory region mainline u-boot provides into uvm(9).
Handled interrupts after retiring a cpuid instruction, allowing vmd(8) to proceed.
Implemented kernel W^X for arm64.
Added tmux(1) support for the strikethrough attribute (SGR 9).
Prevented unusable configurations where both WEP and WPA are active by disabling one when a key for the other is set.
Fixed errors in NS8250 (UART) vmm(4) emulation that had caused seabios not to be able to output data.
Showed inet6 proposals in route(8) monitor.
Read the free clusters bitmap in 1MB chunks, rather than attempting to read it all together, causing a panic in malloc(9) with large NTFS filesystems.
Added sensorsd(8) command line option -f to specify an alternative config file.
Released OpenSSH 7.5.
Enabled snooping on Kaby Lake U/Y PCH HDA in azalia(4) to avoid audio glitches.
Matched the Kaby Lake and Lewisburg (Skylake-EP PCH) MACs with I219 PHYs.
Added Intel Kaby Lake and 3168/8265 wlan pci(4) device ids.
Added AMD A1100 pci(4) ids and additional qemu and virtio devices.
Introduced slaacd(8), a Stateless Address Autoconfiguration Daemon.
Fixed brk(2) and synced the brk()/sbrk() aarch64 implementation with arm.
Enabled dhcrelay6(8), implementing RFCs 3315, 4649 and 6221.
Added h and l for collapse and expand in tmux(1) choose mode with vi(1) keys.
Configured and applied the multitouch-tracking functions of wsmouse to ubcmtp(4).
Handled various shutdown and reboot cases in vmmci(4), allowing powering off the VM even when unresponsive, stuck in ddb or shutdown on the VM guest side.
Closed the tty when a vmd(8) VM is powered down.
Added minimal support for deep linking into man(7) pages to mandoc(1).
Fixed a segfault when sshd(8) attempts to load RSA1 keys and protocol v.1 support is enabled for the client.
Updated LLVM to 4.0.0.
Modified mg(1) to keep the current buffer instead of switching to scratch when aborting switch-to-buffer, bringing mg in line with emacs.
Ported ctags-style, less(1) :t internal searching from terminal output to HTML output in mandoc(1).
Printed title="..." in addition to id="..." attributes for macro keys in mandoc(1) that can be searched for by apropos(1), such that the semantic function appears in a tooltip when hovering with the mouse.
Resolved simultaneous IKE and Child SA rekeying in iked(8).
Made ifconfig(8) "scan" show WPA information for other APs correctly while the interface operates in hostap mode.
Stopped limiting physmem to 2GB on arm64.
Brought SROP mitigation to arm64.
Added code to initialize the USB 3 PHY on Exynos 5.
Allowed ssh(1) to use certificates accompanied by a private key file but no corresponding plain *.pub public key.
Added support for RTL8153 devices.
Made ifconfig(8) "scan" display AP encryption correctly if WEP is configured on the local wifi interface.
Fixed a panic in pfsync(4) when the syncdev is destroyed.
Disabled writing of autolinks in mandoc(1) to prevent writing of potentially dangerous raw HTML tags with markdown.
Introduced "machdep.forceukbd" to force the first USB keyboard as console input, allowing use of a USB keyboard in ddb(4) even if the BIOS emulates a pckbd(4).
Added a -Dsnap option to pkg_add(1) that forces %c to use snapshots.
Fixed autoboot on the OverDrive 3000.
Added exrtc(4), a driver for the RTC found on Samsung Exynos SoCs.
Ensured that the mirror server ends up in installurl(5) when the distribution sets are fetched from a mirror and the siteXX.tgz file is fetched from a local server.
Always created the installurl(5) file during installation and upgrade if not present.
Fixed a use-after-free when sending usb(4) root hub control transfers.
Made the armv7 kernel recognize all the memory on the Odroid XU4.
Explicitly loaded bootaa64.efi on the ESP to allow the SoftIron OverDrive 3000 to load without manual intervention.
Accepted RSA keys when updating ssh(1) hostkeys if HostkeyAlgorithms contains any RSA keytype.
Fixed case insensitivity to hostname matching in ssh(1).
Fixed a regression in ssh(1) 7.4 server-sig-algs where SHA2 RSA signature methods were excluded.
Enabled amphy(4) for udav(4) and urlphy(4) for url(4).
Plugged file descriptor leaks of auth_sock in ssh(1).
Fixed ssh(1) hashing of hosts with a port number.
Enabled syscon(4) on armv7, allowing reboot of the Odroid XU4.
Fixed an off-by-one error in xnf(4) which led to ring stalls when the consumer index equaled the consumer event index.
Added syscon(4), a driver providing reboot/poweroff functionality through the generic "regmap" interface.
Added a "regmap" interface allowing devices to provide access to their registers to drivers elsewhere in the device tree.
Corrected the TLS error message displayed by nc(1) if the handshake after accept fails.
Fixed the logic in sq(4) preventing it from receiving broadcast frames before configuring an address, allowing use of dhclient(8).
Added copying of the rpi3 u-boot to the installed disk to the arm64 ramdisk installer.
Prevented mandoc(1) memory exhaustion due to user-defined macros exceeding the stack limit by discarding what remains in the open stack levels on abort.
Used the target mask for the boot CPU upon ampintc(4) attachment to pick the target CPU interface when establishing an interrupt, allowing interrupts to work on machines that boot up on a CPU attached to a CPU interface that isn't zero.
Changed priq enqueue policy to drop lower priority packets, allowing high priority traffic a place in the queue and low priority bulk traffic a chance to regulate its throughput.
Corrected handling of TLS PRF with MD5+SHA1 in ssl(3).
Introduced recallocarray(3), a blend of calloc(3) and reallocarray(3) which additionally clears released memory.
Corrected tmux(1) collection of strings when on terminals not supporting UTF-8.
Saved and restored the cursor in tmux(1) when redrawing a combined UTF-8 character in its existing position so the next character is added in the correct place.
Attached exiic(4) and other exynos drivers using the FDT.
Stopped copying the on-disk /etc/hosts file to the bsd.rd /tmp dir for use during upgrade, and switched to creating a minimal hosts file that does not risk filling the filesystem.
Provided a rolling handshake hash in ssl(3) which starts when the cipher suite has been selected, and converted the final MAC to use this handshake hash.
Updated to Unicode 8.
In 11n hostap mode, dynamically adjusted HT protection settings based on the presence of non-HT nodes in the node cache. OpenBSD 11n APs will now disable HT protection if it is not necessary. Fixed display of HT protection settings in tcpdump(8).
Allowed R (resize auto-partition) after A as well as when started with -A in disklabel(8).
Sent VPLS MAC withdrawals in ldpd(8) as specified by RFC 4762, which can improve convergence time in VPLS networks.
Implemented RFC 5561 (LDP Capabilities), RFC 5918 (Typed Wildcard FEC), RFC 6667 (Typed Wildcard FEC for PWid) and RFC 5919 (LDP End-of-LIB) in ldpd(8).
Implemented support for PWid group wildcards in ldpd(8) as specified in RFC 4447.
Allowed specification of an alternate control socket in ldpd(8), needed to run multiple instances. Additionally, allowed ldpd to run on a non-default rdomain.
Introduced mandoc(1) -mdoc -Tmarkdown output mode.
Fixed ssh-keygen(1) -H corrupting known_hosts containing entries which have already been hashed.
Enabled FFS2 on armv7 and arm64 ramdisks.
Added the new sysctl(2) machdep.lidaction to allow hibernating or suspending when the lid closes.
Added a "locked lladdr" option in vm.conf(5) to prevent VMs from spoofing MAC addresses.
Allowed MPLS switching and VPLS across rdomains.
Fixed a bug allowing a man-in-the-middle attack against WPA wireless clients. A malicious AP could trick clients into connecting to itself rather than the desired AP, then all frames would be sent in the clear.
Added an "owner" option to vm.conf(5) to set user/group ownership for pre-configured VMs, allowing matching users console access and the power to start/stop VMs.
Dynamically attached edma(4) using the FDT.
Created the /etc/installurl file during upgrade if a mirror was used and the file did not yet exist.
Modified the installer logic to determine the default answer for the "Location of sets?" question. Presents "http" as the default answer if /etc/installurl exists, correcting an issue where "cd" was overriding "http".
Handled touchpad input in wsmouse(4).
Bumped block size for dd(1) for arm64, for a substantial speed increase.
Added support to psci(4) for the older generation spec of PSCI, which supports shutdown and reset only if the function ID is explicitly provided in the device tree.
Switched to xenodm(1).
Updated Mesa to 13.0.5.
Attached acpithinkpad(4) to LEN0268 HID, found on newer thinkpads.
Implemented ampintcmsi(4) in ampintc(4) to support MSI for arm64.
Implemented an API for establishing legacy PCI interrupts for amd64.
Introduced pciecam(4), a driver for generic ECAM compatible PCI host controllers.
Introduced the "e" command to dc(1), equivalent to "p" but writing to stderr.
Added a generic ahci(4) frontend for FDT and enabled ahci(4) on arm64.
Added acpisbs(4), an ACPI smart battery subsystem driver reading data over smbus.
Added pledge(2) to man.cgi(8).
Allowed specification of an alternate socket path in eigrpctl(8).
Stopped grabbing the NET_LOCK() when using poll(2) on unix domain sockets, fixing the "X freeze" while scanning with wireless interfaces.
Disabled BFD to allow continued work on unlocking the socket layer.
Updated to unbound(8) 1.6.1 release.
Bumped the default size of the MSDOS partition on octeon from 16MB to 32MB.
Used memcpy(3) a character row at a time to the framebuffer in rasops(9), rather than sending pixel by pixel. This greatly speeds up the text framebuffer on some EFI implementations.
Fixed asynchronous system traps on arm64, allowing processes to be killed using Ctrl-C.
Restored a local change to xkeyboard-config(7) to handle Ctrl-Alt-Backspace to kill X by default.
Removed trailing whitespace in the installer that ended up passing a bogus argument to ftp(1), disabling redirection and running ftp in the background.
Added SMP config and IPI control logic for the Loongson 3A.
Added an IPI counter to mips64.
Added EDNS0 support, allowing for various DNS extensions, including UDP DNS packets larger than 512 bytes.
Added miniroot and ramdisk hooks for the Raspberry Pi 3. The u-boot-aarch64 and raspberrypi-firmware packages are now required to run make release on arm64.
Updated to nsd(8) 4.1.15.
Updated to unbound(8) 1.6.1rc3.
Implemented ddb(4) backtrace support for arm64.
Fixed ipcomp(4) with IPv6 transport mode.
Fixed a bug in chmod(1)'s symbolic mode without -h and -R flags where permissions on the symbolic link were nonetheless changed.
Surrounded the host name with brackets in ssh(1) for ProxyJump/-J to allow use of literal IPv6 addresses.
Increased UDP packet buffer to 4096 bytes from 512 to handle broken DNS servers not attempting to use EDNS0.
Restored the keyboard backlight value on system resume for asmc(4).
Added a new implementation of a standalone LMTP client to smtpd(8).
Fixed powerdown with vmmci(4) VMs using a shutdown and no reset.
Allowed negation of the authenticated keyword in smtpd(8), i.e. accept ! authenticated [...].
Created an empty /root/.ssh/authorized_keys file with correct permissions.
Corrected handling of ldapd(8) requests to delete individual attribute values.
Disabled aen handling on mfii(4), which led to excessive load.
Introduced naming of tmux(1) session groups, allowing use of these names with -t instead of a target session.
Fixed relayd(8) and relayctl(8) to show "send/expect failed" rather than "tcp read timeout" when appropriate.
Correctly released the NET_LOCK() before calling unp_detach().
Fit the installer to 80 columns.
Updated to xkeyboard-config 2.20.
Stopped potentially freeing a grant table entry still in use due to an incorrect test while allocating, which may allow a second allocation in xen(4).
Used an additional poll(2) during tls_handshake() in nc(1) and respected the -w timeout option to avoid waiting in a busy loop. Applied the same fix to tls_close().
Retried BS->ExitBootServices() if it fails on EFI boot for arm64, as in amd64.
Correctly flushed and invalidated the instruction cache upon entering a page with pmap_enter(9), allowing use of the AMD Seattle.
Raised ampintc(4) IRQs to the proper levels, allowing interrupts to work on the AMD Seattle SoC.
Updated to terminfo-20170128.
Enabled the short slot time feature in 802.11n mode.
Improved parsing of the HTTP request line in httpd(8), allowing quick detection of non-ASCII requests.
Enabled per-CPU caches on mbuf pools and stopped counting individual pool items, limiting mbufs by how much memory can be allocated for pages by the system.
Handled physical disk state changes in mfii(4).
Listed openfiles-max explicitly in default /etc/login.conf files to prevent raising openfiles-cur over the implicit -max value, resulting in the setting not being applied at all.
Implemented Dynamic Profiling for i386.
Implemented mfii(4) scsi command timeouts.
Added the ability for MegaRAID SAS fusion chips to abort tasks in mfii(4).
Implemented intr_barrier(9) for arm64.
Updated libdrm to 2.4.75.
Added support to nc(1) for IPv6 proxy addresses.
Updated Perl to 5.24.1.
Prevented a netlock-related deadlock with the X server during iwm(4) scans.
Prevented arm64 efiboot failures by ensuring data are saved before turning off the MMU and removing cache contents.
Added a connection username to ssh(1) packet log messages and a preamble string for disconnect messages.
Added a window or pane id "tag" to each format tree and used it to separate jobs in tmux(1).
Fixed 11b clients sending bogus ratesets in association requests and rates when an AP is selected after a scan.
Fixed a bug in vmt(4) that led a "guest shutdown" to result in a reboot.
Fixed httpd(8) support for HTTP pipelining by handling all requests in the buffer.
Synced the video(4) V4L2 (Video for Linux Two) API with Linux kernel version 4.10-rc6.
Prevented panics in hostap mode by removing unnecessary global counters from struct ieee80211com.
Disabled client-initiated TLS renegotiation by default in relayd(8).
Correctly skipped pages marked as unreadable rather an aborting a uvm(9) core dump.
Fixed bioctl on mfi(4).
Added AMRR support to rtwn(4).
Implemented "all event" (1003) mouse mode in tmux(1).
Disabled client-initiated renegotiation for libtls servers.
Reimplemented httpd(8) support for byte ranges, preventing overuse of memory and applying the watermark and throttling mechanisms to range requests.
Prevented athn(4) from using RTS for non-data frames and stopped athn 11n hostap from applying HT protection to non-11n clients.
Built mkuboot(8) on arm64.
Made MiRA handle out-of-range single frame error rate (SFER) values.
Re-enabled cross-binutils now that parts can be built on aarch64.
Added a fallback to treating a page as preformatted text if mandoc(1) parsing reveals that it is neither mdoc(7) nor man(7).
Disabled pgt(4) and acx(4) on sparc64 due to kernel space constraints, allowing GENERIC.MP to boot again on the T5220.
Fixed rtwn(4) IQ calibration code.
Allowed selection of the routing domain to be used for kill states by host or by label by adding a "-V rdomain" option to pfctl(8).
Prevented pkg_info(1) -e spec cases where the spec would be displayed rather than the name of the package.
Fixed a failure of pkg_add(1) + signify(1).
Enabled psci(4) and plrtc(4) for arm64.
Enabled NET_LOCK().
Constructed a BN-gcd_nonct to avoid the possibility of a sidechannel timing attack during RSA private key generation.
Added the arm64 architecture.
Added -S no verifytime to ftp(1) to permit an unvalidated TLS connection when the time is unknown.
Prevented use of control and space characters in the answer to the "System hostname" installation question.
Added support for SVM in vmd(8).
Added a -groups option to openssl(1) s_client, allowing specification of supported EC curves as a colon-separated list.
Added support for setting the openssl(1) supported EC curves, changing the default list of EC curves to be X25519, P-256 and P-384.
Updated LLVM to 4.0.0 rc1.
Prevented a deadlock by allocating a new file descriptor in accept(2) and accept4(2) before checking whether the socket head's queue is empty and possibly sleeping.
Added the display of process groups to ddb(4)'s ps /w.
Fixed the 6x_bootscript u-boot commands to work with SABRE Lite boards.
Displayed the thread ID rather than the process group ID in ddb(4)'s default "ps" view, allowing easy use of tr /p.
Added support for multiple transmit ifqueues per network interface.
Introduced TLS ticket support.
Renamed pfind into tfind(9) to reflect that it deals with threads.
Fixed make release for use of the KEEPKERNELS setting by including make cleandir right before building kernels.
Fixed a race for multi-threaded processes by allocating all memory chunks (and potentially sleeping) before freeing the old array of open files.
Added bcmdog(4), a watchdog timer for the Raspberry Pi.
Enabled simplefb(4) on arm64.
Added the openprom(4) interface to arm64.
Switched spamd(8) to nonblocking descriptors so a short write can be obtained when the socket buffers are full, rather than blocking.
For arm64 machines which don't load the kernel at the start of physical memory (e.g. Raspberry Pi 3), changed pmap(9) to avoid mapping memory outside kernel VA space.
Added drivers for the Raspberry Pi 3.
Built gpioctl(8) and hotplugd(8) on arm64.
Added support for creating RAMDISK kernels for arm64.
Built firmware for usb devices on arm64.
Disabled TLS session cache and tickets by default.
Provided clang(1) as cc, c++ and cpp, and lld as ld(1).
Introduced the KEEPKERNELS variable: when set in mk.conf or the environment, "make cleandir" does not descend into kernel build directories, ensuring kernel object files survive "make build" on slower architectures.
Added the build infrastructure for lld.
Updated to xf86-input-vmmouse 13.1.0.
Disabled the shader cache in Mesa (which relied on 64 bit operations) on powerpc, restoring 3D functionality.
Fixed races of iwm(4) driver code against MiRA timeouts, which could lead to crashes in situations like changing channels while the interface is up.
Added the acme-client(1) option domain full chain certificate "path".
Implemented acme-client(1) domain chain certificates.
Added Allwinner A64 devices to OpenBSD/arm64, allowing use on the Pine64.
Removed acme-client(1) command line arguments -a/c/f/k/s/C in favor of using these in the configuration file, specified by -f configfile and viewable with the new -n option. Also changed command line option -n to -A for a new account key and -N to -D for a new domain key.
Added support for the Allwinner A64 PIO controller clock.
Added support for the Allwinner A64 (sun50i-a64) to sxipio(4).
Changed bsd.obj.mk to only chown(8) :wobj when the command will succeed, allowing use of bsd.prog.mk outside /usr/src by users not belonging to the wobj group.
Implemented EHCI and MMC clock support for the Allwinner A64 SoC in sxiccmu(4).
Started creating and using installurl(5), created during installation if an OpenBSD mirror server is used to download sets. This file is used by the installer, syspatch(8), and pkg_add(1). Retired use of the /etc/pkg.conf file.
Added a warning in iked(8) when the address pool is exhausted.
Added per-cpu counters for rtstat.
Added output packet counters to the ifq structure.
Changed /etc/mirror.conf to /etc/installurl.
Ceased sending IPv6 atomic fragments in response to CVE-2016-10142.
Added a method by which the SABRE Lite/BD-SL-i.MX6 u-boot may load a dtb and bootarm.efi, then call bootefi.
Updated Mesa to 13.0.3.
Fixed a panic when removal of the BFD flag on a route(8) was attempted after deletion of the route.
Enabled TKIP as pairwise cipher when the wpaprotos option for ifconfig(8) enables WPA1, fixing a problem where WPA1 could not be used without using the wpaciphers option to enable TKIP.
Made mandoc(1) HTML output more human readable by introducing simple indentation and altering line break logic around tags.
Allowed pflow(4) changing of receiver and sender ip/port without switching address family.
Changed spamd(8) -l to use getaddrinfo(3) so that strings will provide useful error messages and IPs and hostnames may be parsed as an argument to bind(2).
Added printing of the interface mtu of RTM_IFINFO messages in route(8) monitor mode.
Fixed a panic when set-field with VLAN is set in switch(4), but no VLANs are classified in the packet.
Updated to nsd(8) 4.1.14.
Fixed a kernel crash associated with 11n hostap by resetting block ack state and canceling related timeouts when a HT node disassociates.
Prevented a wireless frame injection attack where an attacker knowing the WPA group key might inject a unicast frame by sending a group-encrypted frame to the AP with particular addresses set, then forwarded by the AP as unicast.
Updated the clang(1) build infrastructure for LLVM 3.9.1.
Added HTTPS proxy support for ftp(1) with ssl.
Made it possible to remove VMs from the internal queue in vmd(8).
Added support for draft-ietf-idr-shutdown to bgpd(8).
Fixed timeout in traceroute(8) when poll(2) returns after receiving a packet not intended for it.
Disabled and locked the Silicon Debug feature on modern Intel CPUs. This implements a countermeasure against using Direct Connect Interface (DCI) to debug CPUs via USB3.
Added vmmci(4), a simple guest-side driver for vmm(4) VMs.
Updated to FreeType-2.7.1.
Fixed the less(1) -t command for the case when it goes down by just a few lines, clearing the status before printing content on the last line of the screen.
Finished initial 11n support for athn(4), supporting MCS 0-15 in client and hostap mode.
Added an imsg communication channel between vmd(8) and individual virtual machines.
Stopped an error message in the installer by checking whether /tmp/i/hosts exists before calling sed -i on it.
Stopped ftp(1) from attempting to read .netrc when anonymous FTP is forced (-a).
Removed mfc hash tables and used the OpenBSD routing table for multicast routes, allowing access to the multicast routes in route(8).
Edited syspatch(8) checksum handling to match the installer.
Prevented arm64 execution of kernel pages by userland and user pages by the kernel, and userland reads of executable pages that were not mapped explicitly with a read flag. Made a distinction between executing and reading pages.
Increased strictness of the pledge(2) of the ramdisk version of the ftp(1) client, which operates only in URL mode.
Added rd(4) to the arm64 list of devices.
Added 64 bytes of entropy from Hyper-V hosts into the kernel entropy pool via acpihve(4).
Added smfb(4) display of resolution and color depth when attaching.
Stopped requiring 11n wireless drivers to provide an ic_ampdu_rx_start() function, fixing receiving A-MPDUs with an 11n-enabled athn(4) driver.
Fixed audio distortion with azalia(4) on the Acer TravelMate B117-M.
Used a verified list of distribution set files for installation extracted from the SHA256.sig file signed by the OpenBSD project.
Converted multiple daemons to use a shared log.c file.
Added sxirtc(4) support for the RTC found on the Allwinner H3.
Added Intel Xeon E5v4 pci(4) ids.
Avoided a side-channel cache-timing attack that could leak the ECSDA private keys when signing.
Fixed boot(8) crashing on some amd64 machines when booting from softraid crypto.
Highlighted all occurrences of the tmux(1) search string after searching in copy mode.
Fixed a crash in sort(1) when sort -m is given no files.
Enforced https for connections to ftplist.cgi and ftpinstall.cgi on platforms which have TLS-enabled ftp(1).
Updated compiler-rt to version 3.9.1.
Added the -delete option to find(1).
Added simplefb(4), a driver to support the framebuffer set up by the firmware on some platforms that use device trees. Works on Allwinner (sunxi) and Raspberry Pi (broadcom) armv7 platforms.
Added https support to the OpenBSD installer.
Enabled listening on more than one listen address for UDP and TCP by syslogd(8), allowing acceptance of network input via both IPv4 and IPv6.
Enabled the xbf(4) driver for the paravirtual disk interface "Blkfront," native to the Xen hypervisor.
Added the Cortex A32 CPU.
Wiped all WPA parameters, including the 802.1x configuration, when WPA is disabled on an interface.
Connected to the syspatch(8) test repository over https.
In passwd(1), cleared the buffer used when the user retypes the new password.
Added ftp(1) SSL support, allowing the install script to perform https fetches.
Fixed an ssh(1) deadlock when keys/principals commands produce a lot of output and a key is matched early.
Updated to terminfo-20161126.
Fixed EFI_CALL() to pass arguments properly in efiboot when the number of arguments is 0.
Discarded the pf(4) packet statekey only if invalid, allowing its use to establish a reverse link.
Converted a relative path to an absolute one with realpath(3) before chdir(2) when syslogd(8) has been started with a relative path. This allows the program to re-exec itself after startup of the privsep parent or when restarting after a SIGHUP.
Added support for the second sxipio(4) device on the Allwinner A80.
Allowed using 11n mode with APs not advertising support for all of MCS 0-7.
Skipped rates not supported by both peers when calculating the set of MCS rates below a particular MCS.
Passed through cacheline size information to vmm(4) guests, preventing failures running Java.
Implemented booting from softraid on 4K sector disks.
Added support for the second sxipio(4) device on the Allwinner H3.
Added support for "arm,gic-400" to ampintc(4).
Supported p2p links in ripd(8) where endpoints aren't in the same subnet.
Updated and added wide character support types to arm64.
Fixed efiboot to read disklabels on 4K sector size disks properly by converting the sector number in the partition table to the sector number in 512 byte blocks.
Added a "muststaple" option to ftp(1), so that oscp stapling can be required for sites expected to provide it.
Extended the size of user virtual address space from 2GB to 1TB on mips64, improving ASLR and complementing W^X added earlier on some systems, improving the architecture's security.
Removed PIM support from the multicast stack.
Added support for ECDHE with X25519 to ssl(3).
Added octmmc(4), a driver for the OCTEON MMC host controller.
Fixed a bug in pax(1) where archives smaller than 512 bytes would trigger a next volume prompt.
Disabled TKIP (WPA1) by default.
In ifconfig(8), made ifconfig if0 wpa and ifconfig if0 -wpa reset WPA parameters to their defaults, and made ifconfig if0 wpaprotos reset WPA crypto parameters to settings appropriate for the specified WPA protocol version.
Compiled libc++ and libc++abi with clang by default, allowing our build system to self-host itself after the initial clang bootstrap.
Added experimental support for xen(4) device hot-plugging.
Prevented an "ifa == rt->rt_ifa" assertion panic by removing interface addresses in the case of a route add error.
Extended the multicast sockets and multicast hash table support to multiple domains.
Introduced the NET_LOCK(), a rwlock used to serialize accesses to the part of the network stack not yet ready to be executed in parallel or where new sleeping points are not possible.
Released OpenSSH 7.4.
Fixed an off by one when saving and restoring an array of registers in arm64.
Implemented support for cross-compiling arm64 in Makefile.cross.
Completed implementation of TKIP countermeasures in hostap mode.
Prevented an mpath conflict for /32 RTF_CLONING routes by inserting a RTF_CLONED route at a higher priority than its parent.
Imported OpenBSD/arm64.
Fixed IO clock speed and system reset on Octeon III.
Added a dhcrelay(8) command-line option for replacing Relay Agent Information on the incoming packets.
Added the xp(4) driver for LUNA's I/O processor.
Provided the "machdep.lidsuspend" sysctl on Loongson.
Added support for Intel Bluetooth devices found on x250 and x260 Thinkpads.
Allowed starting of disabled and pre-configured VMs by name to vmctl(8).
Implemented support for cold reboot of a guest in vmm(4).
Added the TSC timecounter and used it on Skylake machines.
Disabled Unix-domain socket forwarding when privsep is disabled in ssh(1).
Fixed dhcrelay(8) support on enc(4) interfaces.
Printed the correct netmask instead of /0 when flushing a route(8).
Made v6 tunnel address handling consider IPv6 scope.
Implemented dhcrelay(8) support for layer 2 relaying and added further Relay Agent Information options per RFC 3046.
Passed WSDISPLAYIO_{GET,SET}PARAM to ws_{get,set}_param in efifb(4), allowing the brightness on some machines to be adjusted through wsconsctl(8).
Added support for the FTDI Suunto dive computers to uftdi(4).
Added umsm(4) support for Option iCON 505 devices.
Updated Mesa to 13.0.2.
Corrected xbf(4) driver attachment failure when optional feature properties aren't found.
Added support for MIMO Tx rates (MCS 8-15) to iwm(4).
Stopped enabling HT protection (RTS) unconditionally in iwm(4) if the AP requires protection from 20Mhz-only STAs on a 40 Mhz channel, as we do not support 40Mhz channels.
Fixed tmux(1) send-keys with UTF-8.
Added fdt_attach_args and simplebus for implementing fdt-capable drivers on octeon.
Made it possible to install patches with syspatch(8) even if not all sets are installed. Syspatch will skip the patch but continue to list it as available, allowing later use if sets are installed in the future.
Supported relay of DHCP requests through multiple relays in dhcrelay(8), rather than dropping requests already relayed. A hop counter will be incremented with each relay, per RFC 1542, and requests with this value exceeding 16 silently dropped.
Forwarded packets not only as L3 broadcasts, but also as L2, when the BROADCAST flag is set on a BOOTREPLY in dhcrelay(8).
Applied pledge(2) to dhcrelay(8) with "stdio route".
Added MiRA support to iwn(4).
Cleaned up syspatch(8) directories not containing a tarball, meaning the syspatch was not applied properly.
Added xbf(4), a driver for Xen Blkfront.
Made prefix work in all tmux(1) tables, allowing C-b to be bound in the copy mode tables.
Fixed potential buffer overflow(s) in link_ntoa(3) as described by CVE-2016-6559. This prevents stack overflow of a static buffer in libc through use of a particular struct sockaddr_dl argument, allowing write to arbitrary locations in the data segment.
Allowed booting of X552 SFP+ without a module plugged in.
Prevented loss of the default route when netstart(8) is run a second time on the interface pointed to by that route.
Fixed a panic by ensuring iwm(4) calls ieee80211_mira_choose() only while in RUN state.
Fixed hostctl(8) -t on vmm(4) VMs.
Made ssh(1) IdentityFile successfully load and use certificates that have no corresponding bare public key.
Generated an explicit error when running syspatch(1) on an unsupported release.
Ensured syspatch(1) rollback tarballs created from empty lists of files result in errors, rather than attempting to patch installations with missing base sets and incomplete rollback tarballs.
Harmonized battery state thresholds across platforms.
Fixed ssh(1) public key authentication when multiple authentication is in use.
Implemented the connection state machine for OpenFlow 1.0 and 1.3 in switchd(8) to detect invalid state transitions and invalid protocol version switching after the hello messages exchange.
Added "lldp" to the ether protocol name database.
Changed "menu-window" to display all windows in cwm(1), adding "menu-window-hidden" to recreate the original behavior.
Replaced "bind" and "mousebind" options in cwm(1) with "bind-key" and "bind-mouse".
Updated media types upon SFP module change in ix(4).
Switched the iwm(4) driver to MiRA rate adaptation in 11n mode.
Added a new implementation of MiRA, a rate scaling algorithm for 802.11n, designed for use with MIMO and Tx aggregation.
Implemented usermod(8) -g =uid functionality to create a new group with a unique UID.
Stopped overlaying DMA fragment descriptors with free list handling, decreasing the risk of races due to caching and/or prefetching between the HC and DMA engine.
Added a sshd_config(5) DisableForwarding option that disables X11, agent, TCP, tunnel and Unix domain socket forwarding.
In ssh(1), refused to accept a certificate forced-command when it also appears in an authorized keys/principals command= restriction unless they are identical.
Made send -N work for all keys in tmux(1), not just in copy mode.
Corrected a bit test in user(8) that made it impossible to set a password hash with usermod(8) if an additional flag was specified.
Added support for the Allwinner sun7i-a20-mmc to sximmc(4).
Implemented basic support for boot.conf(8) on the vmd(8) disk image.
Set -m/memory size of a VM to 512M if not specified in vmctl(8).
Added the vmctl(8) start -n option to add a network interface to the specified virtual switch.
Fixed a potential double-free in vmd(8) whn ufs_open() has failed.
Increased the default datasize limit in login.conf(5) on amd64 from 512M to 768M, allowing xenocara to be built with extra options in malloc.conf.
Removed DHO_ROUTERS and DHO_STATIC_ROUTES options from the effective lease in dhclient(8) when DHO_CLASSLESS_[MS_]STATIC_ROUTES are present, in accordance with RFC 3442.
Added AArch64 backend build infrastructure.
Enabled support for the X550 family of 10 Gigabit controllers in ix(4).
Stopped manually adding a route to an alias IP via 127.0.0.1 in the installer, as this is now automatically handled by the kernel.
Fixed active media reporting for multi-speed fiber modules in ix(4).
Added vmd(8) support for booting the kernel from the disk image, making the kernel/-k argument optional. If not specified, the /bsd kernel will be sought in the primary hd0a partition of the first disk image itself.
Forbade combining af-to with route-to in pfctl(8).
Fixed a switch(4) panic on detach hook when interfaces are destroyed.
Implemented switchd(8) support for version negotiation using hello messages, preventing connections from switching the version in the middle of the operation.
Used CPUID flags to allow hyperv(4) to determine working components and avoid attaching when Xen viridium emulation is turned on.
Added disabled VMs into vmd(8)'s queues and allowed vmctl(8) to display them.
Added support for Allwinner sun9i-a80-usb-mod-clk and sun9i-a80-usb-phy-clock compatible clocks to sxiccmu(4).
Added the ability to change media type to ix(4).
Disabled a code path on Loongson 2 that uses a MIPS64r2 register not implemented by the CPU, preventing boot failure.
Turned on the ix(4) PHY power during attach, as it can be disabled by booting into another OS.
Made "addlocal" an alias to "add" on bridge(4), as it does not distinguish between routing/forwarding ports.
Made tcpdump(8) indicate basic rates listed in beacons with an asterisk.
Set iwm(4)'s RTS retry limit to a more reasonable value, preventing small frames from getting stuck in the firmware's Tx queue.
Enabled builds with a dedicated user that cannot elevate privileges or write to /usr/src or /usr/xenocara. Enabled builds with a dedicated user for xenocara.
Updated libdrm to 2.4.73.
Fixed "addlocal" ports on switch(4).
Recognized active SPF+ DA modules as IFM_10G_SFP_CU in ix(4).
Added support for multiple listening sockets to snmpd(8). The default is to listen on 0.0.0.0 and ::, allowing better handling of dual-stack setups.
Added drivers for PCI host bridge and built-in UARTs on Loongson 3A.
Made iwm(4) pass Tx/Rx MCS rates to bpf(4) to allow examination with tcpdump(8).
Added an extra check that the hop-by-hop header is always the first extension header after the IPv6 header in pf(4).
Inherited route(8) label when creating dynamic routes for path MTU.
Fixed tmux(1) dragging not to stop when the wheel is pressed.
Added support for the Sierra Wireless EM7455 LTE module.
Serialized posts to the txstart register in re(4), preventing tx stall.
Turned on margins in tmux(1).
Added support for lid state detection in ykbec(4).
Added a simple openflow client to switchctl(8) to dump switch(4) information.
Checked for available space before installing a patch with syspatch(8).
Copied mips64 memmove(3) data by using 64-bit loads and stores rather than 32-bit operations, roughly doubling the routine's throughput.
Increased the number of TX descriptors to 256 in hvn(4), increasing the NVS message ring size and resulting in a performance improvement of about 30%.
Reflected interface priorities when inserting RTF_CONNECTED routes, fixing a bug where bringing interfaces up and down when multiple RTF_CLONING routes exist for a given subnet could make it impossible to insert new ARP/NDP entries.
Automatically created a default lo(4) per rdomain, with unit number matching the rdomain and index stored in the rtable/rdomain map.
Added a type for counters to malloc(3) and added wrappers around common operations on percpu counters.
Updated to xf86-video-ati 7.7.1.
Fixed a crash in tmux(1) with run-shell -b and no window pane available.
Added support for Allwinner sun9i-a80-apb1-clk compatible clocks to sxiccmu(4).
Fixed truncated display of UTF-16 decoded elements in ifconfig(8).
Added the Apple NVMe controller pci(4) id.
Improved source IP address handling in snmpd(8) by sending replies using a source address equal to the destination address of queries and introducing a configuration option to snmpd.conf(5) to set the source address of packets sent to trap receivers.
Stopped installing perl(1) .ph files.
Respected -Ooffset for the disklabel location in makefs(8).
Added support for sun9i-a80, the Allwinner A80, to sxiccmu(4) and sxipio(4).
Added a disklabel(8) option creating a disklabel with the information provided by disktab(5).
Taught switch(4) device read(2) operations to behave like a stream socket, allowing userland programs to use it without special treatment.
Supported more than one tag entry for the same search term in mandoc(1).
Only used the routing table for source address selection when processing IP options, and ensured the next hop is directly reachable when IPOPT_SSRR is set.
Implemented support for flow-mod message validation in switchd(8).
Split various kernel process IDs from TID, giving processes a PID unrelated to the TID of their initial threads.
Bumped ftp(1)'s cipher default from "all" to "legacy."
Added OCSP stapling support to httpd(8).
Added interrupt handling routines for Loongson 3A.
Added an auto-login mode to xenodm(1).
Validated address ranges for AllowUser/DenyUsers at ssh(1) configuration load time and refused to accept bad ones, fixing a problem where invalid CIDR address ranges always matched.
Added support for server side OCSP stapling to libtls and nc(1).
Added crypto(3) support for X25519.
Removed the obj, xobj and src directories from the base set, so local setups will not be overwritten during upgrades.
Enabled crypto(3) assembler code for nist 256p curve on amd64.
Stopped processing more than three consecutive TLS records in ssl3_read_bytes() to prevent a peer from causing a loop.
Implemented a Key-Value Pair exchange interface via a text-based pvbus(4) interface.
Fixed libtls OCSP handshakes.
Corrected CONSPEED for octeon to the original 115200.
Updated x11proto to 7.0.31.
Added OCSP client side support to libtls.
Required secure defaults for TLS with acme-client(1).
Made it possible to change the link layer address on cnmac(4) interfaces.
Used x2APIC if it is enabled by BIOS.
Added the -d flag to the cvs(1) update command, so directories are created with "cvs up".
Raised the mtu on myx(4) devices to 9380 bytes.
Allowed the installer for verify local set files even if the prefetch area would not fit on the local disk by searching for and creating a prefetch area only for nonlocal sources.
Truncated lengths of ip packets encapsulated in gre(4) or etherip(4) if they would cause the position to go past snapend in tcpdump(8).
Fixed an issue where the installer was not able to fetch local sets without a SHA256.sig file in a directory unreachable by the unprivileged users.
Improved the security model of vmm(4) by restricting pledged vmm processes to prevent use of vmm ioctls on other VMs.
Updated to FreeType 2.7. Subpixel hinting, also known as ClearType hinting, is now enabled by default.
Removed the option to set hints on pages in the malloc(3) cache.
Prevented an integer underflow in tcpdump(8).
Stopped forcing RTS for every frame in 11n mode on iwn(4).
Stopped pf(4) once rules from attempting to remove their parent rules.
Stopped using a bitfield in the vmm(4) msr store index structure to prevent VMABORTs during vmentry.
Accepted carp(4) advertisements whose destination is not for multicast
Deduplicated the CRS parsing code and handled acpi(4) implementations, fixing a problem where the wrong number of resources were defined inside the EC device, preventing initialization of acpiec(4).
Fixed bind(2) of link local addresses to raw sockets.
Masked and unmasked the interrupt source in an intx-specific interrupt handler, fixing lockups on nvme(4) controllers.
Repaired ssh(1) port forwarding for non-privileged ports as a non-root user.
Fixed issues with redundant dhcpd(8) servers and CARP-using interfaces by comparing server-identifiers and rejecting packets only after applying the value specified in dhcpd.conf(5).
Disabled xterm(1) Tektronics 4014 emulation.
Made the IPv6 network stack simply drop empty non-atomic fragments, rather than attempting to insert them into the queue.
Updated nsd(8) to 4.1.13.
Only attached sxitimer(4) on sun4i and sun5i, as the timers on later SoCs lack the 64 bit counter used as a timecounter here, and have generic timers instead.
Removed short option names for makefs -o.
Exited autoinstall in the case of missing or duplicate mountpoints, as well as when a template is rejected by disklabel(8).
Added xenodm(1), a stripped down xdm (X Display Manager) for OpenBSD.
Stopped disabling the external pl310 l2 cache on pandaboard.
Taught tcpdump(8) how to read OpenFlow packets.
Fixed a panic when using tmpfs when an Access Flag fault happens on a kernel page.
Attached sxitimer(4) using the FDT.
Used deterministic pseudo-random numbers when the -T flag is used with makefs(8), allowing repeatable builds.
Stopped setting MIIF_AUTOTSLEEP in fec(4) and sxie(4), which had led to tsleep in an interrupt context, causing panics.
Added support for the acpi(4) timer opcode.
Implemented a driver for Marvell's Mbus bridge.
Fixed the clock on the Olimux A10s OLinuXino-Micro board by running sxitimer(4) from the 24MHz clock.
Added NetWM-compliant fullscreen support to video(1).
Added generalized access to per cpu data structures and counters, cpumem_get(9) and counters_alloc(9).
Added vmm(4) for i386.
Mitigated against mpii(4) device attachment racing with mountroot.
Removed support for fixed ECDH cipher suites.
Stopped forcing iwm(4) to use RTS for all frames unless required by the AP.
Fixed a mandoc(1) bug where macro searches returned pages containing only the first specified macro of a set.
Fixed an ntpd(8) random termination bug by preserving child process IDs.
Corrected early termination in bgpd(8) when a max-prefix of 1 in bgpd.conf(5) would close the session on the first prefix.
Added the ddb(4) examine /m format, "display in unsigned hex with character dump at the end of each line."
Corrected an issue when openbsd.randomdata was made readonly which led to poor random number generation in the kernel early on.
Installed a signal handler for tty-generated signals and waited for the ssh(1) child to suspend before suspending ftp(1), allowing ssh to restore the terminal mode as needed when suspended at the password prompt.
Randomized the MAC address in vmd(8) on the host side if not specified by the user. The prefix is incremented by one to differentiate from those addresses generated by OpenBSD in the kernel: fe:e1:bb:xx:xx:xx.
Added the vmd(8) option to specify an interface group per virtual switch, to be added to all VM tap(4) interfaces in the switch.
Removed the artificial maximum number of unix domain sockets in syslogd(8).
Ensured mbufs are clean when a packet is reinserted to local input processing, and that the packet is in the routing domain of the interface where it is inserted.
Rewrote tmux(1) command queue handling to add a global command queue and avoid multiple nested command queues.
Imported makefs(8), a tool to create filesystem images from a directory, supporting cd9660, ffs and msdosfs. Used this to build bsd.rd.
Updated libdrm to 2.4.71.
Switched rebound(8) to a re-exec model to reduce sharing.
Allowed adding an interface to a vmd(8) interface group with the group keyword.
Fixed cvs(1) update -r and -A to correctly set or reset the sticky tags for files.
Changed the default non -b behavior of config(8) to operate with the new compile behavior:
create a Makefile including ../Makefile.inc
run "make obj" to create the obj directory
run "make config" to use the logic in ../Makefile.inc to re-run config with the correct -b options, creating a layout in obj/
exit 0
Moved kernel builds to compile/CONFIG/obj@ -> /usr/obj/... and committed stock GENERIC and RAMDISK kernels to ensure the src tree can be "readonly" during builds, de-escalating to $BUILDUSER as required.
Added bgpd(8) and bgpctl(8) support for draft-ietf-idr-large-community (later RFC 8092).
Displayed unknown attributes and information known about a prefix when looking at its details in bgpctl(8).
Fixed revision lookups for cvs(1) branches.
Added support for BCE (background color erase) to tmux(1).
Fixed a logic issue in header parsing in smtpd(8) which could cause smtp(1) sessions to hang.
Taught tcpdump(8) to decode bgp path attribute draft-ietf-idr-large-community.
Added the hostname to the display in systat(1).
Renamed the cdce(4) CDCE_ZAURUS option to CDCE_CRC32 for clarity.
Added a -N flag to tmux(1) command-prompt to execute a command as soon as a non-number key is pressed in copy mode.
Enabled vmm(4) on amd64.
Allowed four vio(4) interfaces in each VM and fixed a bad interrupt assignment causing IRQ9 to be shared between the second disk device and the interfaces, causing poor network performance.
Added "fattr" to the pledge(2) promises made by make -t, which uses utimes(2) for its touch(1) built-in.
Added partial UTF-8 line editing support for ksh(1) vi input mode.
Fixed an off by one error in sed(1) when no matches were found in a substitute.
Added support for double and triple clicking in tmux(1) and used these for select-word and select-line in copy mode.
Converted tmux(1) copy mode key bindings from vi-copy and emacs-copy to copy-mode or copy-mode-vi. Keys are bound to "send-keys -X copy-mode-command".
Added support for UTF-8 in the tmux(1) command prompt.
Enabled the noperm option for mount_mfs(8).
Unregistered the ssh(1) KEXINIT handler after receipt of the message, preventing an unauthenticated peer from repeating the KEXINIT and causing allocation of up to 128MB until the connection is closed.
Stopped echoing RFC 3046/Option 82/Relay Agent Information in dhcpd(8).
Added psci(4), a driver for the reset and power down portion of the ARM Power State Coordination Interface (PCSI) specification.
Updated to xkeyboard-config 2.19.
Attached sxiccmu(4) using the FDT.
Re-enabled fetching sets from local sources as root.
Fixed a heap overflow in the sysctl(8) code.
Stopped using MIPS64r2 instructions on Loongson 2.
Prevented infinite loops for uvm_init(9) amap allocations with >=2^17 slots.
Made iwn(4) write an MCS index into the radiotap rate field and enabled display of the MCS with tcpdump(8).
Made sxidog(4) set cpuresetfn.
Dynamically attached sysreg(4) and sxipio(4) using the FDT.
Fixed SD/MMC on the Beaglebone Black and Pandaboard.
Fixed large I/Os to RAID5 volumes with many chunks by setting the maximum number of CCBs in a work unit to the number of chunks.
Implemented a driver for Marvell Armada's clock gates.
Switched rebound(8) to read resolv.conf to find upstream name servers, automatically restarting if that file changes. Started listening on port 54 to avoid collisions with other DNS servers and used the dnsjackport sysctl(2) to steal DNS connections from libc.
Introduced sysctl(2) KERN_DNSJACKPORT to hijack DNS sockets. When set to a port number, all DNS socket connections will be redirected to localhost:port.
Supported the Marvell Armada's system controller to allow reset of the machine.
Added switchd(8) support for multipart replies and implemented a simple ofp 1.3.5 error message sending function.
Added a driver for the Marvell Armada 380 core clock.
Fixed vxlan(4) to align 32 bit at the outer IP header and comply with the assumptions of ether_input().
Honored the permissions of the root directory on mount(8) with the "noperm" option.
Enabled pledge(2) in vmm(4) and the VM processes.
Enabled switchd(8) and switchctl(8).
Correctly terminated VMs on shutdown of vmd(8).
Per RFC 6842, modified dhcpd(8) to echo the client-identifier value, disambiguating packets for relays and clients when chaddr is 0. Also forced dhclient(8) to drop packets when the server provides a client-identifier value not matching the value sent by the client.
Enabled hardware VLAN tagging on hvn(4). A PowerShell command must be executed to configure trunk(4) mode on virtual interfaces.
Used BUILDUSER as the owner of new links/directories created in "make obj" when started as root. Built kernels as root to avoid permission issues when the source tree is not owned by ${BUILDUSER}.
Improved performance in hostap mode for rt2560 chips by disabling RTS for long frames in ral(4).
Per RFC 5424, added millisecond precision timestamps to syslogd(8).
Fixed the audio(4) condition used to decide whether to automatically start the device, preventing a device opened in full-duplex mode from starting with an empty play buffer.
Made imxdog(4) set cpuresetfn and then removed the unneeded sections of the imx platform, including the imx board IDs.
De-escalated to an unprivileged user during "make build" and "make release". DESTDIR must be on a partition with the noperm flag set for "make release" to work correctly as an unprivileged user.
Added support to vm.conf(5) for enhanced networking configuration and virtual switches.
Added cwm(1) CM-a for "nogroup".
Allowed bgpd(8) route announcement based on a route-label.
Determined mute status at the time of acpithinkpad(4) attach, to be used later by the audio subsystem.
Switched syslogd(8) to use RFC 5424 ISO format for timestamps with -Z option, converting all logging to UTC.
Added a new vmd(8) "priv" process, responsible for ioctls and restricted operations not allowed under pledge(2).
Stopped supporting SUDO builds.
Avoided a potential MITM in acme-client(1) by using a single tls_config.
Converted timeouts needing a process context to timeout_set_proc(9) where use of rtalloc_mpath(9) inside ip_output() might require a write lock.
Fixed an smtpd(8) smtp session logic bug which could lead to a server crash.
Prevented two potential deadlocks by avoiding holding timeout_mutex while interacting with the scheduler.
Disabled sitaracm and added the new ompinmux(4) driver for omap pin muxing/pad configuration that attaches with the FDT, handling 16- and 32-bit values.
Set IFCAP_VLAN_MTU capability in cpsw(4), avoiding "ifconfig: SIOCSETVLAN: No buffer space available" when creating vlan interfaces without first lowering the mtu.
Implemented switchd(8) socket server code, ofrelay, which properly handles async I/O, partial/multiple messages, connection limits and file descriptor accounting.
Implemented ssh(1) proxy mux mode.
Implemented fork+exec for vmd(8).
Removed support for pre-authentication compression from ssh(1).
Added logic for figuring out CPU clock rate and usable memory areas by using Loongson EFI.
Fixed a kernel panic when destroying interfaces attached to the switch(4) without prior removal.
Ran acpidump(8) at system startup and stored ACPI tables in the /var/db/acpi directory for later use by sendbug(1).
Taught ntpd(8) how to use socket status to shut down the daemon and its constraint process to use exec*() instead of just forking, allowing use of pledge(2).
Removed xscale support from arm.
Taught switchd(8) how to create flows for new connections using OpenFlow 1.3.5 and implemented the OXM filters to use with flow matching and Set-Action.
Added sysctl(2) kern.allowkmem (default 0) which controls the ability to open /dev/mem or /dev/kmem at securelevel > 0.
Introduced the hashfree(9) function to free hash tables.
Attached imxocotp(4) using the FDT.
Reworked Per Packet Info handling in hvn(4), bringing support for IP and protocol checksum offloading and initial code for hardware VLAN tagging and jumbo frames.
Removed sqlite3.
Added the Yamaha UR22 audio interface and a quirk to allow it to attach as uaudio(4).
Added a fix to ssl(3) to avoid unbounded memory growth triggered by a TLS client repeatedly sending OCSP status request TLS extensions.
Switched m88k to RELRO.
Added the plain curve25519-sha256 KEX algorithm to ssh(1).
Made various improvements to support for iwm(4) devices.
Added an option to give syslogd(8) a server CA used to validate client certificates.
Added support for the Sierra Wireless MC7455 umsm(4) modem.
Completed bus_dmamap_load_raw(9) implementation for ARM.
Added pledge(2) to pstat(8).
Switched softraid crypto to bcrypt_pbkdf(3). New volumes will be created by bioctl(8) with bcrypt PBKDF, while existing ones continue to use PKCS5 PBKDF2 until a passphrase change is made.
Allowed only standard dot notation for target IPv4 addresses in traceroute(8) and ping(8).
Set the "triple" on arm to armv7-unknown-openbsdX.Y-gnueabi, making the compiler generate code for armv7 by default (providing proper atomic operations) and select the correct default ABI.
Converted imxccm(4) and imxiomuxc(4) to attach to the fdt using the "early" locator.
Used a locator to allow "early" attachment of designated drivers.
Added bcrypt_pbkdf(3) support to the softraid(4) crypto boot loader code.
Prevented a crash in ehci(4) when host controller drivers attempted to use invalid device descriptor bMaxPacketSize values.
Merged ping6(8) into ping(8).
Enabled Hyper-V guest drivers.
Added omwugen(4), a driver for the TI logic that generates wakeup events and routes interrupts to the GIC/ampintc(4). Makes ommmc(4) interrupts work on pandaboard.
Added RTM_INVALIDATE as a route(8) message.
Added fork+exec to ntpd(8) and switchd(8).
Always set the MAC address when initializing an axen(4) chip, making ifconfig(8) "axen0 lladdr" work.
Limited the number of fonts which can be loaded.
Added LSI/Avago SAS3 pci(4) ids and added support for these to mpii(4).
Introduced rwsleep(9), equivalent to msleep(9) but for code protected by a write lock.
Stopped creating a BFD descriptor when the route(8) is created.
Added uwacom(4), a basic pointer driver for Wacom USB tablets.
Switched amd64, i386 and sparc64 boot code to libsa machine-independent softraid.
Introduced machine-independent softraid.{c,h} in lib/libsa.
Used PLL6 as a parent clock for the SDx clocks for frequencies > 400 kHz, making sximmc(4) much faster.
Deleted support for 32bit frame backtracing on sparc64.
Tightened pledge(2) for fsdb(8).
Removed /dev/sound in favor of /dev/audio.
Enabled -static -pie on arm.
Only freed the old cached next hop route(4) when the new one is valid.
Added full UTF-8 support to column(1).
Removed CMS.
Added ISRG Root X1, the letsencrypt CA root.
Fixed system reboot seen on the Allwinner sun5i-r8.
Removed support for tape block devices.
Purged routes attached to an address when the address is removed.
Improved the auto disk selection and applied it for installs as well as upgrades.
Switched the cubie miniroot from the Allwinner A10-based Cubieboard1 to the Allwinner A20-based Cubieboard2.
Introduced Dynamic Profiling, a ddb(4)-based and gprof(1)-compatible kernel profiling framework.
Imported LLVM 3.8.1.
Added infrastructure to build syspatch(8).
Added new Intel 10GbE pci(4) ids.
Made the SSP read-only on the sparc64 kernel by moving the randomdata section into RX text.
Increased the socket buffer size limit from 256 KB to 2 MB.
Added support for Bidirectional Forwarding Detection (RFC 5880/5881).
Introduced a fork+exec privilege separation model in httpd(8) and relayd(8).
Added support for a multipoint-to-multipoint mode in vxlan(4)
Retired support for the zaurus platform.
Switched signify(1) to SHA512/256.
Enabled a limited version of doas(1) on the install media.
Enabled PIE on arm.
Used per-ifp tasks to process incoming packets.
Added the necessary pieces to enable NAT on enc(4) in iked(8).
Removed ping(8) reverse DNS lookups by default in preparation for the merge with ping6(8).
Added the concept of "verified auth" to sessions, set via ioctl(2) and allowing user and parent process recording to use to bypass authorization requirements.
Enabled SGI for iwm(4) and iwn(4).
Added signify(1) -z option for signing gzip(1) archives.
Worked to make log.c similar in all daemons.
Provided an implementation of red black trees using functions.
Added switch(4) support to ifconfig(8).
Turned smtpd(8) server preference on for ciphers by default.
Added ioctls(2) to get/set VCPU registers.
Added a set of emulated vmd(8) legacy devices (PIT, PIC, RTC).
Switched OpenBSD/armv7 to ARM EABI (soft-float).
Switched relayd(8) to TLS session tickets to do TLS session resumption, no longer needing to store SSL session data on the server. Keys are rotated every two hours.
Imported switch(4), a standalone in-kernel OpenFlow switch.
Added iatp(4), a driver for the i2c touchpad and touchscreen found on the chromebook pixel.
Displayed all route flags in route(8) get and show and netstat(1) -r output.
Retired support for the sparc platform.
Converted openbsd.randomdata to read-only in userland and the amd64 and i386 kernels, allowing a read-only stack protector cookie, which will prevent spraying attacks.
Imported acme-client(1).
Removed SIGTRAP, SIGFPE, SIGBUS and SIGSEGV handlers from dump(8).
Enabled cd9660 in efiboot.
Split the gre(4) interface into gre(4) and mobileip(4).
Stopped attempting to support IPv4-mapped IPv6 addresses in ftpd(8).
Converted driver reports of RSSI in the 20-100 range via ieee80211_ioctl(9) to negative values to fix dBm values displayed by ifconfig(8) "scan" with several drivers.
Added admin -C option to cvs(1) to set a revision's commitid.
Added -E and -S options to rlog(1) to configure revision separators.
Added Estonian keyboard mapping.
Stopped flushing RTF_CLONED children when adding a new route(8).
Drop gif(4) support in bridge(4) in favor of etherip(4).
Enabled raspos24 for efifb(4), allowing qemu with UEFI.
Fixed 32-bit time handling in openssl(1).
Fixed "audio0: different play and record parameters" errors by setting i2s "msb" and "bps" fields for both play and record directions.
Used a per-table rwlock to serialize ART updates and walks, rather than taking the kernel lock.
Changed le(4) buffer address to enable support of I/O processor in the future.
Updated to DejaVu fonts 2.37.
Retired obsolete gre(4) ioctls.
Enabled the use of the numpad Enter key on cwm(1) menus.
Added support for the SD/MMC clock to the generic clock code and used it in sximmc(4).
Added Allwinner H3 (xun8i-h3) support to sxipio(4).
Removed pax(1) support for -E none.
Made the full filesystem pkg_check(8) check optional and enabled bypass of a plist check for a file by doubling the use of -q.
Stopped a tmux(1) crash when display-message is used without a client.
Changed cpio(1)'s -t option to be a modifier of -i and simplified the recognition of -f- and TAPE=- to mean stdin/stdout.
Added support for the usb clock on sun5i-a13.
Re-enabled acpibkbd(4) by default.
Fixed negated ssh(1) address matching for address lists consisting of a single negated match.
Added a clock reset signal and frequency-setting APIs.
Enabled SNI support in httpd(8).
Provided an API that enables server-side SNI support, adding the ability to provide additional keypairs and allow the tls_server(3) to determine which servername the client requested.
Implemented interfaces to disable clocks and to enable/disable all clocks for a device.
Removed the hardcoded clock frequencies for specific armv7 hardware by using the new clock API to get clock frequencies from the device tree and hardware controlling the clocks.
Added code to sxiccmu(4) to enable the PLL6 clock.
Restored IO performance on Cortex A9 systems which explicitly needed the PL310 L2's store buffer drained.
Added a minimal ofw clock framework on armv7.
Dynamically attached exuart(4) using the FDT.
Changed login(1) sleep to one second between retries.
Replaced bcmmuart(4) with com(4).
Marked armv7 device memory as execute-never to prevent a speculative instruction fetch to access it.
Avoided overly large fragments on 4k disks by having disklabel(8) start with a default fragsize of 2048, double it for large disks and then cap based on sector size.
Removed sshd_config(5) UseLogin option and support for having /bin/login manage login sessions.
Used additional information from dhcp to autoinstall(8).
Replaced sxiuart(4) with com(4).
Added Ralink RT5392 and additional RT5390 chipsets to the ral(4) driver.
Gave 5GHz APs a slight priority when a wireless device scans all bands at once and good matches exist in either band.
Tracked SSIDs in the leases file and switched to only considering leases from the current SSID when starting up dhclient(8) on wifi interfaces.
Eliminated caching for fuse(4).
Changed default to a)bort rather than c)ontinue when attempting to commit to cvs(1) without a log message, and allowed these responses in uppercase.
Added a version of doas(1) allowing only root to drop privileges.
Ensured cleaning of caches on the Cortex-A7 and other armv7 CPUs, fixing SATA problems on Allwinner A20-based boards.
Imported the sximmc(4) driver for the MMC/SD/SDIO controller integrated on Allwinner A1X/A20 SoCs.
Prevented rgephy(4) from attaching twice to the RTL8211E PHY on the Banana Pi.
Made httpd(8) stricter with respect to TLS configuration, not allowing TLS and non-TLS to be configured on the same port or TLS option specification without a TLS listener, and ensuring TLS options are the same when a server is specified on the same address/port.
Removed the sshd(8) -k option and retired configuration keywords applying to protocol 1, as well as the "protocol" keyword.
Fixed a hang seen on the Allwinner sun5i-r8 board during boot when the driver switches to interrupts and no terminal is attached.
Aliased the deprecated qabs() and qdiv() to llabs(3) and lldiv(3) as part of the ongoing removal of quad operators.
Added imxtemp(4), a temperature sensor for the i.MX6 SoC.
Fixed setting the SMP bit in the auxiliary control register of the Cortex-A7, enabling it to use its caches consistently.
Added the dwge(4) driver for the Synopsis Designware GMAC core used on the Allwinner A20 SoCs and later Allwinner SoCs.
Added a minimal ofw regulator framework.
Added ALPN support to libtls.
Took TASKQ_CANTSLEEP away from the softnet taskq, which allows use of rw locks in the network stack.
Began doing a TLB flush whenever an L1 slot is invalidated on armv7, fixing the pmap_fault_fixup issue on Cortex-A7 processors.
Removed the user(8) encrypted password length check.
Retired support for the armish platform.
Dynamically attached agtimer(4), omgpio(4) and omehci(4).
Fixed a serial console hang on the Allwinner sun5i-r8 by resetting the line speed when required in the sxiuart driver, now com(4).
Fixed an ftp(1) crash when the window is resized.
Added armv7 as an officially supported platform.
Began mandatory enforcement of W^X, allowing violations only for binaries marked wxneeded executed from filesystems marked wxallowed.
Normalized received prefixes in ldpd(8).
Implemented mmc power sequencing in imxesdhc(4), making the sdo interface on the cubox-i function and detect the BCM4330 wireless.
Allowed iwm(4) to recover from fatal firmware errors by leaving the interface marked UP and scheduling the init task, as with iwn(4).
Added initial support for Raspberry Pi 2/3.
Added a generic ofw pinctrl framework.
Implemented interrupt controller functionality in the i.MX6 GPIO driver imxgpio(4), allowing hookup of Ethernet interrupt on the Nitrogen6x, SABRE Lite and WandBoard.
Fixed vxlan(4) multicast mode and added support for IPv6 tunnel endpoints.
Dynamically attached virtio(4), plrtc(4), pluart(4) and intc(4) using the FDT.
Renamed a1xintc to sxiintc(4).
Dynamically attached sunxi drivers sxiahci(4), sxidog(4), sxirtc(4) and ehci(4).
Tightened pledge(2) restrictions on route6d(8) and added a -u switch to log route insertions and deletions.
Modified ampintc(4) to attach dynamically and register itself as an interrupt controller. Switched all i.MX6 devices to the new FDT-aware interrupt establish API and enabled imxgpc(4).
Added imxgpc(4), a driver for the i.MX6 General Power Controller, operating as a transparent interrupt controller by handing interrupt handling to its parent, the Cortex-A9 GIC.
Fixed autonegotiation at 100BaseTX for AR8035 routers.
Added cnmac(4) jumbo frame support.
Added mainbus(4) support for pre-registering interrupts on armv7, allowing device drivers to establish interrupts before their interrupt controller attaches, solving various dependency problems.
Added a minimal tpm(4) 1.2 driver to acpi(4) to issue a "save state" command before suspending in order to fix suspend/resume on some newer amd64 machines.
Prevented race conditions leading to missed notifications with xen(4) devices due to multiple CPUs accessing pending event bits.
Fixed tmux(1) minimum size when pane status line is enabled.
Switched TLB maintenance primitives on armv7 to operate on the unified TLB, reducing the number of primitives. Simplified TLB flush handling.
Ensured initialization and reset of "lim" with each loop run in ndp(8), avoiding possible invalid memory access.
Allowed specification of an alternate socket path in ripd(8) to allow running multiple ripd instances.
Removed vi(1)'s "directory" option and TMPDIR support.
Implemented an FDT-aware interrupt establish API for armv7.
Released OpenSSH 7.3.
Set SDEV_UMASS on all umass devices and began probing all the LUNs a device reports, rather than assuming any ATAPI and UFI device always has only one LUN.
Edited pmap(9) on armv7 to flush TLB entries causing pmap_fault_fixup messages on Cortex-A53 and Cortex-A7.
Set hotplugd(8) to close /dev/hotplug on exec() to ensure the daemon doesn't fail to restart due to a child process occupying the device.
Adjusted dhclient(8) to ask for DHO_BOOTFILE_NAME and DHO_TFTP_SERVER by default, potentially useful for autoinstall and able to provide information about what the dhcp server has done with the desired server name and file name info.
Used m_devget(9) to improve the smsc(4) driver.
Added support for Xeon E3-1200 v5 host bridge and some Sunrise Point H PCH ids.
Added recognition of Cortex A35 and Cortex A73 CPUs.
Added checks to uvm_map(9) for potential overflows and underflows, and a check for wraparound before the 'commit' phase of uvm_map() and uvm_mapanon() to prevent hitting assertions or corrupting data structures during that phase.
Added acpials(4), an acpi driver for ambient light sensors.
Removed code paths associated with booting without an FDT in armv7.
Disabled receive ring slot accounting and added a periodic timer to work around missing completion events in xnf(4).
Moved xen(4) interrupt handlers to dedicated task queues.
Added a check to uvm_map(9) that arguments to isavail don't overflow, preventing a possible panic.
Reduced number of sent RX and TX producer notifications for xnf(4).
Allowed vmd(8) to start a VM again after it has been terminated.
Added support for common WebDAV methods in relayd(8).
Modified smtpd(8) to log IP addresses during the authentication phase.
Implemented a true rwlock(9) on i386.
Improved boundary checking for iovcnt in ssh(1).
Added support for interrupts to the Allwinner-R8 chip.
Removed a feature allowing re-use of existing early bootstrap mappings to provide a physical address to bus_space_map(9) in armv7.
Added an open firmware interface to facilitate iterating over GPIOs.
Added a check for zero in the PTE to improve ARM pmap(9) page removal.
Increased the size of forkstat fields in sysctl(8) and vmstat(8) to accommodate large values.
Explicitly excluded firmware from the fuzzy auto-reinstall list in pkg_add(1).
Modified relayd(8) to improve parsing of the host by following RFC 7230 Section 5.4 more strictly.
Added rewriting of backlight level after system resume in acpi(4).
Fixed signed char extension bugs in printf(1).
Wrapped fpgetround(3) so internal calls go directly instead of through the PLT.
Removed the restriction on armv7 that the kernel must be loaded at the bottom of physical memory, making it possible to boot on platforms with physical memory starting at 0x00000000, as the EFI bootloader will only attempt to load kernels at 0x10000000 and above.
Moved to 6.0-current.
--------
Changes made between OpenBSD 5.9 and 6.0
Unbreak rsu(4).
In rtwn(4) and urtwn(4), fix byteswap errors. This repairs urtwn(4) on macppc.
In mesa, disable the code that allocates W|X memory.
Disable tmpfs.
In rarpd(8), avoid a hang when the receive buffer of a route socket becomes full.
In newfs(8), revert the change to scale the default "density" value to create the same number of inodes.
In bgpd(8), initialize the log subsytem in the SE like it is done in the RDE. This avoids all logging from going to /dev/null.
When closing bpf(4) devices, ensure the minor number becomes free for reuse by the device cloning code. This fixes a panic.
In perl(1), patch CVE-2016-1238.
In tcpdump(8), only chroot(2) when run as root.
5.8 and 5.9 RELIABILITY FIX: When signaling an error to an HTTP relay client, the connection can be terminated prematurely, leading to a crash.
A source code patch exists which remedies this problem for 5.8 and 5.9.
In the installer, back out the automatic pkg.conf(5) installpath changes.
In dhclient(8), back out the change that narrowed the BPF read filter rules so only packets sent to the interface's LLADDR pass. Some DHCP servers send frames to the ethernet broadcast address.
In imxuart(4/armv7), re-create the i.MX6 console with the correct minor number on attach.
Disable POOL_DEBUG.
In newfs(8), scale the default "density" value so that on 4K disks the same number of inodes are creates as on DEV_BSIZE devices.
In stty(1), error out if the display and modify mode are combined on the command line. This avoids a pledge(2) violation.
vmm(4/amd64), fix a few CPUID emulation issues.
In ssh(1), fix pledge(2) violation with the -f option.
Attach imx(4/armv7) on i.mx6 quad plus.
In dhclient(8), actually DECLINE and delete unused offers.
In fec(4/armv7), fallback to the known IRQ number on imx.6 if the fdt interrupts-extended property is missing or not the size that is expected.
In rtable(4), prevent an infinite recursion when deleting routes inside rtable_walk().
Prevent NULL-pointer call for filesystems that don't provide vfs_sysctl in their vfsops structs.
In relayd(8), fix a crash when the connection is terminated prematurely.
Fix a double rtfree(9) triggered when IPSEC inserts a more specific route because of PMTU.
In ssh(1): everse the order in which -J/JumpHost proxies are visited to be more intuitive.
In switchd(8), add basic support for OpenFlow 1.3 PACKET_IN+PACKET_OUT, no FLOW_MOD yet.
In bgpd(8), don't quit when the local addresses of a peer can't be figured out. Instead bring the session down.
In tcpbench(1), add AF_UNIX support and also make it possible to randomize the write size in the client.
In rtwn(4) and urtwn(4), respect the RTS threshold set by net80211.
In tcpdump(8), silently ignore chroot(2) setup failure, because pledge(2) provides an even better sandbox. This regain -r support.
In sshd(8), skip passwords longer than 1024 characters in length, so clients can't easily DoS sshd by sending very long passwords.
Use pledge(2) in switchd(8) and switchctl(8).
In softraid(4), plug potential leak of device list.
In switchd(8), parse and print OpenFlow 1.3 PACKET_IN and OXM (Openflow eXtended Match).
In netstat(1), print the relevant counters to tune the TCP SYN cache.
In iwm(4), disable the beacon filter. This make it possible to keep track of HT protection changes.
In net80211, enable RTS for frames above a particular size. This change allows for reasonable throughput on loaded 11g networks whereas before they were practically unusable.
In switchd(8), update OpenFlow 1.3 stub based on the 1.0 code.
In switchd(8), add the -n flag to check the configuration and exit.
In iwm(4), properly keep track of HT protection changes while associated.
Unbreak ural(4), which had been dropping frames on Tx while the IFF_RUNNING flag was set.
In ehci(4), use for ATI controllers the same workaround as for VIA controllers. This should hopefully help people reporting errors with SB700.
Add the tcp.synhashsize sysctl(8) to make the size for the syn cache hash array tunable.
In dhclient(8), narrow the BPF read filter rules so only packets sent to the interface's LLADDR pass. This limits the number of packets that get dropped as a result of dhclient setting BIOCSFILDROP on the bpf descriptor.
Import switch(4), switchd(8) and switchctl(8), a basic work-in-progress OpenFlow implementation (not build by default).
In carp(4), fix the check supposed to prevent "ip" and "ip-stealth" balancing modes from leaking the multicast address.
In sshd_config(5), allow wildcard for PermitOpen hosts as well as ports (bz#2582).
In "rcctl ls", skip all files with a "." in the name, because pkg_add(1) renames files in this way when the checksums don't match.
In netstart(8), unbreak vlan(4) on top of tap(4).
In virtio, always allow MSI/MSI-X. This enables MSI-X with qemu's old "82441FX" pci-bridge.
In sxitimer(4/armv7), explicitly stop the timers before reloading them. This fixes a hang on the Olimex A10s boards.
In doas(1), copy the path to the shell from struct passwd to prevent it from being overridden by a getpwuid(3) call. This happens in a double doas call.
In iwm(4):
Retry Tx of management frames less often.
Fix inverted logic in iwm_tx().
Explicitly set firmware Tx aggregation limit to one (which disables Tx aggregation).
In pstat(8), fix VFLAG formatting.
In ssh(1), reduce timing attack against obsolete CBC modes by always computing the MAC over a fixed size of data.
In kdump(1), ktrace(1) and ltrace(1), add "p" trace point for KTRFAC_PLEDGE, and fix handling of -t+ in ltrace(1).
Attach sunxi(4/armv7) based on the compatible property of the root node of the device tree.
In ssh(1), support UTF-8 characters in ssh banners (bz#2058).
In jot(1), fix a bug causing values to be printed out of bounds if the precision is 0.
In ldpd(8):
Fix parsing of malformed optional TLVs/Sub-TLVs.
Remove potential overflow when validating message's length.
In virtio(4), support MSI-X. This increases performance for interrupt heavy loads.
In libssl, limit the support of the "backward compatible" ssl2 handshake to only be used if TLS 1.0 is enabled.
In ldpd(8):
Update per-neighbor GTSM options on config reload.
Explicitly ignore the Hop Count and Path Vector TLVs.
Improve logging of reserved labels.
Disable acpicbkbd(4) by default until after the release. It causes the kernel to spin forever on certain Chromebooks.
In ssh(1), reduce the syslog level of some relatively common protocol events from LOG_CRIT (bz#2585).
Add a ProxyJump ssh_config(5) option and a corresponding -J ssh(1) command-line flag to allow simplified indirection through a SSH bastion or "jump host".
5.8 and 5.9 RELIABILITY FIX: Splicing sockets in a loop could cause a kernel spin.
A source code patch is available for 5.8 and 5.9.
5.8 and 5.9 RELIABILITY FIX: ufs_readdir failed to limit size of memory allocation, leading to panics.
A source code patch is available for 5.8 and 5.9.
5.8 and 5.9 SECURITY FIX: The mmap extension __MAP_NOFAULT could overcommit resources and crash the system.
A source code patch is available for 5.8 and 5.9.
5.8 and 5.9 RELIABILITY FIX: Tick counting overflows could cause a kernel crash.
A source code patch is available for 5.8 and 5.9.
5.8 and 5.9 RELIABILITY FIX: Invalid file descriptor use with kevent(2) could lead to a kernel crash.
A source code patch is available for 5.8 and 5.9.
5.8 and 5.9 RELIABILITY FIX: Unchecked parameters and integer overflows in the amap allocation routines could cause malloc(9) to either not allocate enough memory, leading to memory corruption, or to trigger a "malloc: allocation too large" panic.
A source code patch is available for 5.8 and 5.9.
5.9 RELIABILITY FIX: Multiple processes exiting with a fd-passing control message on a shared socket could crash the system.
A source code patch is available for 5.9.
5.9 RELIABILITY FIX: A race occuring in the unlocked ARP input path can lead to a kernel NULL dereference.
A source code patch is available for 5.9.
Ensure that amap slot calculation does not overflow. This prevents from too small amaps being allocated by forcing the allocation of a large number of slots.
Ignore the kern.usermount sysctl(8). It is unsafe, because it allows any non-pledge(2)'d program to call the mount/umount system calls. The sysctl will be completely removed in 6.1.
In ip6(4), drop received packets with an IPv4-compatible address as source or destination as per RFC4213.
In fec(4/armv7), do board-specific delay/skew corrections for the Micrel KSZ9021 and KSZ9031 PHYs based on device tree properties instead of the board ID.
Prevent a use-after-free by not updating an ARP entry that has been removed from the table.
In vioblk(4), properly handle poll timeout.
Avoid a panic caused by very big mallocs for the ufs_readdir() buffer which should have been limited to 64 kB.
Avoid a panic caused by very big mallocs that result from uint64-to-int32 truncation when kevent does fd validation.
On amd64, add hvn(4), a work-in-progress driver for the Hyper-V NetVSC.
In calendar(1), when matching a day in the month, ensure the date is still in the month we are interested in. This fixes things like Sunday+5 for months where there is not a 5th Sunday.
In bpgd(8), output the no-longer-so-new AS operators when printing the configuration.
In libtls, split the existing TLS cipher suite groups into four: secure, compat, legacy and insecure.
Check resource limits for mappings established using __MAP_NOFAULT. This prevents callers from triggering a kernel panic and a potential integer overflow in the amap code by forcing the allocation of too many slots.
In imxehci(4), use the device tree voltage regulator information to supply power to the USB bus, because this only supports "fixed" regulators that are controlled through a gpio.
Fix a crash when MNT_DOOMED is passed in the flags to unmount(2).
In syslogd(8), add support for TLS client certificates in syslogd. This allows the remote server to verify the authenticity of received messages.
In tmpfs, don't allow mounting with noval owner. It causes a panic later on.
In factor(6), use an integer version of the Newton method instead of the floating point square root. This fixes a rounding issue.
In imxesdhc(4/armv7) and fec(4/armv7), use the gpio framework to implement card detect instead of hardcoding particular gpios based on board IDs.
Hook up imxgpio(4) to the FDT gpio framework.
Fix path MTU discovery which was slightly broken: it took two ICMP packets to create and change the dynamic route.
In tcp(4), do not increase the size of the socket buffer under memory pressure.
In tcpdump(8), recognize MPLS pseudowire with control words. Also print encapsulated ethernet packets.
In acpimadt(4), properly handle Processor Local X2APIC structures. This makes secondary CPUs attach on the HP DL360 gen 9.
Dynamically attach imxgpio(4) using the FDT.
In mandoc(1), fix a bug causing .so links to gzipped manuals to fail in the absence of a mandoc.db(5) database.
In omap(4/armv7), follow imx and match based on the compatible property of the root node in the fdt instead of attaching the device based on board IDs.
Dynamically attach i.MX6 ehci(4) using the FDT.
In ssh(1), improve crypto ordering for Encrypt-then-MAC (EtM) mode MAC algorithms. This prevents the possibility of a side-channel oracle, though no such oracle has been identified.
In perl(1), fix a bug where XSLoader could try to load from a subdir of the cwd when called via eval (CVE-2016-6185).
In malloc(3), correctly implement the three-valued J/j option.
In syslogd.conf(5), allow space-deliminated fields in syslog.conf in addition to traditional tabs-deliminated fields.
Various cleanups in route6d(8).
Fix several places where calculating ticks could overflow, because on arithmetic overflows the compiler may decide to do anything.
In libtls, correctly handle an EOF that occurs prior to the TLS handshake completing.
Update to tzdata2016f.
Build eeprom(8) on octeon.
On octeon, add openprom(4).
In libcrypto, add several fixes to make OCSP work with intermediate certificates provided in the response.
In ld.so(1), remove unfinished prebind support.
Avoid an integer overflow of the thrsleep() timeout. This prevents a panic.
On the Quad-G5, make hpb(4) attach first when iterating PCI buses to allow openpic(4) to properly map interrupt for the devices instead of possibly dereferencing garbage.
In rtable(4)
In savecore(8), drop support for the undocumented second argument.
In rcs(1), implement the -I option.
In smtpd(8), add the -r option to the enqueuer for compatibility with mailx.
Introduce the "chown" pledge(2).
Update to perl 5.20.3.
In rebound(8), avoid a crash by checking the cache tree for collisions when inserting replies.
In aoa(4/macppc), support the AOAShasta soundchip found on PowerMac9,1.
In ldpd(8):
Add GTSM support (RFC 6720).
Decrease the initialization FSM timeout. This allows quicker recovery of a session with a neighbor.
Improve RFC 4447 compliance.
In cat(1), indent the '$' on blank lines when the -ne options are used.
Make accepted sockets inherit IP_TTL from the listening socket.
Allow resetting the IP_TTL and IP_MINTTL sockopts.
Fix an issue where syslogd.8 would print 15 NUL bytes followed by two blank spaces before the log message for warnings generated while parsing syslog.conf.
Add acpicbkbd(4), a simple keyboard backlight driver for some Chromebooks.
On armv7, allow booting on SolidRun's HummingBoards and CuBoxes.
In sndiod(8), avoid triggering watchdog time-outs which prevent sndiod from resuming.
Update perl Time::HiRes to 1.9739.
Bump LibreSSL to 2.4.2.
In rtadvd(8), prevent a NULL dereference.
In malloc(3), adapt the S option: add C, and remove F and P.
In inet6(4), restore the automagically added /64 route on p2p interfaces in order to send traffic to link-local addresses without default route.
In ssh(1), explicitly check for 100% completion in the progress meter. This avoids a potential floating point rounding error which could cause the progress meter to report 99% on completion.
In vi(1), if /tmp/vi.recover doesn't exist, don't create it. Warn once that it doesn't exist, afterwards fail silently.
In smtpd(8), explicitly enclose SMTP transactions between BEGIN and COMMIT/ROLLBACK filter events.
In ioapic(4/amd64), don't write to the read-only RIRR bit in the IOAPIC redirection register. This may subsequently block interrupt delivery.
In nc(1), add the -M and -m options to specify the outgoing and incoming minimum TTL.
In fts_open(3):
Do not return an error if one of the paths in argv is empty. This prevents programs using fts(3) from reporting an error if one of the paths is empty.
When the list passed is empty, return EINVAL instead of pretending to succeed. This avoids a NULL pointer dereference in a later fts_read(3) call.
Add the net.inet.ip.arptimeout and net.inet.ip.arpdown sysctl(8)'s for ARP timers.
In bgpd(8), use IPV6_MINHOPCOUNT to finish implementing ttl-security for IPv6.
Update to xkeyboard-config 2.18.
In pkg_info(1), implement -z that uses is-branch info to produce "complete" stem--[flavor][%branch] listing.
Add UDP unicast and multicast support for IP_MINTTL and IPV6_MINHOPCOUNT.
On vmm(4/amd64), fix a panic when CPUs fail to spin up for other reasons during boot.
On amd64 and i386, enable the UMIP feature if present.
Enable ure(4) on the architectures where url(4) already is.
5.9 SECURITY FIX: Correct a problem that could result in incorrect parsing/encoding of times in OCSP messages.
A source code patch is available for 5.9.
Repair kill(2) on zombie processes.
In ldpd(8), fix a logic bug causing the advertised transport connection preference (LDPoIPv4 or LDPoIPv6) not to be respected.
In iwn(4), revert the implementation of iwn_update_htprot(). We are still seeing links dropping upon HT protection updates with some iwn chips.
Restore the sys_o58_kill system call. This provides a clean transition for runtimes that make direct system calls.
Make the IPV6_UNICAST_HOPS socket option usable for incoming TCP connections.
In ip6(4), implement IPV6_MINHOPCOUNT support.
In doas(1), revise environment handling. Add a "setenv" keyword to doas.conf(5) for manipulating the environment, the "keepenv" now means only retain everything.
Add ure(4), a driver for Realtek RTL8152 10/100 USB Ethernet adapters.
In pkg_add(1), make scp:// work with PKG_CACHE.
In bcrypt(3), increase the minimum for auto rounds to 6.
In login.conf(5), use auto rounds for bcrypt (on amd64, i386, macppc and sparc64).
Dynamically attach cpsw(4/armv7) with the FDT.
Dynamically attach tiiic(4/armv7) using the FDT. Only match on omap4 compatible controllers such as the one in the am335x on BeagleBone Black.
Dynamically attach omdog(4/armv7) using the FDT.
In pkg_add(1), recognize @option is-branch.
Fix a pledge(2) issue with "fdisk /dev/tty".
In libcrypto:
Fix the ocsp code to actually check for errors when comparing time values. Ensure that it only compared GERNERALIZEDTIME values as per RFC6960.
Ensure that OCSP uses Generalized Time on requests as per RFC6960.
In pf(4), make nat-to usable by in rules and together with divert-to. Collisions with existing states are found and produce a "NAT proxy port allocation failed" message.
Update to nsd 4.1.10.
Log to syslogd(8) when the dmesg(8) buffer overflows and messages are lost.
When pf_test() returns something but PF_PASS, set error to EACCES instead of EHOSTUNREACH. On the latter, ip_forward() can generate undesired ICMP errors.
In pax(1), allow creation of devices or fifo without -p.
In sshd(8), fix AuthenticationMethods during configuration re-parse.
In fec(4/armv7), fetch MAC address from FDT.
In unbound(8):
Update to unbound 1.5.9.
Fix a segfault in the -h option.
Fix QNAME minimisation with various broken DNS servers, often found at CDNs.
In cn30xxgmx(4/octeon), add support for the second GMX interface on the Octeon II. This enables ports eth[0-3] on 8-port EdgeRouters.
In iwm(4):
Explicitly send multicast frames at the lowest rate, instead of picking a rate from the firmware RS table.
Pass the correct Tx rate to BPF (tcpdump(8)) for 5GHz.
Don't loop over CCK rates when building the Link-Quality command's RS table for 5GHz.
Let the firmware deal with DTIM and TSF information details by itself. Fixes some association issues with 8260 hardware.
Clear the in_assoc flag when going down.
Add hyperv(4), the main Hyper-V nexus driver (work in progress).
On amd64, set up the Hyper-V hypercall page and an IDT vector.
In bgpd(8), dvmrpd(8), eigrpd(8), hostapd(8), httpd(8), ifstated(8), iked(8), ipsecctl(8), iscsictl(8), ldapd(8), ldpd(8), ospf6d(8), ospfd(8), pfctl(8), relayd(8), ripd(8), smtpd(8), snmpd(8), vmd(8), ypldap(8), do not allow whitespace in macro names, i.e. "this is" = "a variable".
In ld.so(1), when handling DT_TEXTREL only set the mapping to READ+WRITE, ignore possible EXEC permission for the section, because the proper permission is set late, and there are no thread concerns in this case. This avoids W^X issues.
In efifb(4), add support for drawing a console on a coreboot framebuffer. This is useful on chromebooks that have no legacy vga device or, for newer chipsets, a full console and X with wsfb(4).
In pf.conf(5), change the parser to make af-to on pass out rules an error. This fixes a bug where a nonworking configuration could be loaded.
On m88k, add sc_cookie in sigcontext, as same as other ports.
In audioctl(1):
Reimplement it using new API in a simper way.
Group all encoding parameters in a single string (ex. "s16le") so that we use the same naming scheme as aucat, sndiod and many ports.
Remove "properties" as they are not used any longer.
Remove the list of encodings as there's no benefit in having it.
Add the -q option, to look like sysctl(8).
Remove the unused -a option.
Stop using symlinks in /dev.
In libcrypto, disable DSA_FLAG_NO_EXP_CONSTTIME, always enable constant-time behavior.
In openssl(1), fix a bug loading the default certificate path locations. The files would only be loaded if the CAfile or CApath locations were successfully loaded first.
In ld(1), make creation of text-relocations a fatal error by default, with -znotext to permit it and -ztext to reenable the default of forbidding it.
In bgpd(8), show the "nexthop 1.2.3.4 now valid: via 192.168.0.1" message only in debug mode.
Add ds1307(4), an I2C driver for the Maxim DS1307 Real Time Clock chip.
In iwm(4), send PHY DB commands as async commands. This change makes it work better in RAMDISK kernels.
Make umb(4) also work with devices that implement both NCM 1.0 and MBIM.
Dynamically attach omap uart with FDT.
Remove the lockmgr(9) API.
In rcctl(8):
Cache the result of often used functions.
Implement "rcctl get|getdef all".
In ldpd(8):
Fix a use-after-free.
Fix a memory leak.
Fix removal of dual-stack neighbors.
In cn30xxgmx(4), make the 1 Gbps SGMII settings the default to define a consistent set of parameters even if a link is down.
Add the net.inet.tcp.rootonly and net.inet.udp.rootonly sysctl(8)'s, to mark which ports cannot be bound to by non-root users.
In iwm(4), plug some memory leaks in error paths.
Dynamically attach ommmc(4/armv7) with FDT.
In ldpd(8):
Fix a small LIB-LFIB synchronization issue.
Do not allow configuring the same interface for both LDP and VPLS.
In smtpd(8), also add missing date or message-id when listening on the submit port.
In sshd_config(5), ban AuthenticationMethods="" and accept AuthenticationMethods=any for the default behaviour of not requiring multiple authentication (bz#2398).
In pfctl(8), allow "include" in inline anchors.
In tmux(1), allow a command to be specified to display-panes rather than always just selecting the pane.
In acpitoshiba(4), enable suspend/hibernate fn keys.
In smtpd(8):
Rework the format of the "Received" header so that the TLS part does not violate the RFC.
Increase number of connections a local address is allowed to establish, and decrease the delay between transactions in the same session.
Properly reset the transaction when a filter rejects a message.
Add umb(4), a driver for the Mobile Broadband Interface Model (MBIM) to provide support for USB MBIM devices.
In tmux(1):
Add -F to list-commands.
Automatically exit all modes after 180 seconds of inactivity and if there is pending output.
In ssh(1), remove "POSSIBLE BREAK-IN ATTEMPT!" from log message about forward and reverse DNS not matching (part of bz#2585).
Update to tzdata2016e.
In pkg_add(1), restrict %m and friends to "separate words" so they won't collide with branch specifiers.
In pppoe(4) and sppp(4), don't hardcode vlan/queue priority for pppoe packets, but instead inherit it from the new "llprio" setting on the pppoe(4) interface.
In the timeout_add_*(3), prevent a round to zero.
In pkg_add(1), implement "pkgname%branch" which can be used to restrict matches to a branch matching the pkgpath(7).
Dynamically attach imxdog(4) using the FDT.
Avoid socket splicing loops: if the same mbuf is spliced 128 times, assume that there is a loop and abort the splicing.
In ldpd(8):
Rework the handling of Hello packets in order to improve IPv6 support.
Implement a timeout for the session initialization FSM. This prevents neighbors stuck in the initialization FSM to linger forever as long as the associated transport connection is up.
Implement support for the Configuration Sequence Number TLV.
In utvfu(4), start/stop the audio bulk thread as the consumer opens/closes device.
In uvm_map(9), avoid grabbing the kernel lock for interrupt-safe pools.
In uhidev(4), do not execute the callback if the device is beeing detached. This should prevent a race triggering a use-after-free.
Correct the pledge for "disklabel(8) -R -[fF]".
Dynamically fec(4/armv7) using the FDT.
In sxie(4/armv7) and sxiuart(4/armv7), handle both the nintr 1 (allwinner a10/cortex a8) and nintr 3 (allwinner a20/cortex a7) cases.
On armv7, ignore everything from ":" onward in stdout-path when finding the console node. Characters after this are device-specific settings.
Dynamically attach imxuart using the FDT.
In exuart(4/armv7), override the address found with FDT if the board ID is c210, because the qemu smdkc210 target uses serial0 for console while the exynos4210-universal_c210 dtb specifies stdout as serial2.
Dynamically attach sxiuart using the FDT.
Dynamically attach sxie(4/armv7) using the FDT.
In ldpd(8):
Fix parsing of multiple optional TLVs in label and notification messages. This fixes IxANVL LDP test 15.3.
Make it possible to parse unknown TLVs in the future.
Send an "Unknown FEC" Notification for unexpected wildcard FECs. This fixes ANVL LDP test 15.6.
Add missing ntohl(3) when recording a label request. This fixes the following ANVL LDP tests: 1.5 and 9.4.
Parse the whole Hello packet before processing it. This fixes a bug where we could create a dynamic targeted neighbor in response to a malformed packet.
In ifconfig(8), add the "llprio" parameter to set the priority of packets that do not go through pf(4).
In acpi(4), don't attempt to attach acpitimer(4) if the timer isn't present. The power management timer has been made optional in ACPI 5.0A.
In tetris(6), when eliding a row, clear the invisible row zero, so that no columns can become unusable during game play.
In ldpd(8):
Send a fatal notification when the last hello adjacency is deleted. This fixes the following ANVL LDP tests: 7.17 and 23.3.
Do not shut down the session upon receiving unknown messages. This fixes IxANVL LDP test 22.13.
Set the Message ID for Hello messages too.
Dynamically attach imxesdhc(4/armv7) using the FDT.
Add SGMII support and PHY addresses for 8-port EdgeRouters. This makes plain RJ45 ports eth[4-7] usable.
Dynamically attach i.MX6 ahci(4) using the FDT.
In ldpd(8):
Add one more safety check for Initialization messages. This fixes the following ANVL LDP tests: 6.5, 6.6 and 6.11.
Change what is considered a NACK for our Initialization messages. This fixes the following ANVL LDP tests: 6.19, 6.21 and 6.22.
Discard Hello packet if advertised transport address is of different AF. This fixes IxANVL LDP test 5.13.
Fix quick reconnect when the transport address is changed.
Remove octhci(4). It has been superseded by dwctwo(4).
Do the full W^X check on hppa and mips64.
On armv7, use FDT to find the console to initialize.
Attach acpitoshiba(4) on Libretto, Dynabook and SPA40 laptops.
Enforce W^X and map W|X segments without X permission initially. The dynamic linker will make these read-only and add back X permission after relocation processing.
In ld.so(1), some ELF ABIs still require a PLT that is both writable and executable. To avoid W^X violations, initially map such segments as writable and non-executable, and change the mapping to non-writable and executable after initial relocation processing.
In ld.so(1), accommodate ELF ABIs that require a PLT that is both writable and executable, without causing W^X violations.
In sshd(8), revert src/usr.bin/ssh/kexgexs.c r1.28 ("Check min and max sizes sent by the client"). It caused "key_verify failed for server_host_key" in clients that send a DH-GEX min value less that DH_GRP_MIN.
In doas.conf(5), revert the setenv feature.
In aucat(1), add the -g and -p options to control device and file start position.
Add ktrace support for pollfd[] arrays.
In aucat(1), fix a bug that causes an abort in the last samples of certain files.
In kdump(1), avoid printing the long string format for times in the 1970s.
Let vfprintf(3) return EOVERFLOW rather than ENOMEM for overflow conditions to match POSIX.
In mount_tmpfs(8), allow to set wxallowed on tmpfs filesystems.
In ldpd(8), speed up session establishment after config reload.
In video(1), to match the encoding type, compare against "pixelformat" instead of "description". This fixes the VIDIOC_ENUM_FMT ioctl for utvfu(4).
Move nd6_output()s "short-circuiting" for non-lladdr interface types earlier. This fixes some IPv6 pppoe setups.
In libcrypto, correct a problem that prevents the DSA signing algorithm from running in constant time even if the flag BN_FLG_CONSTTIME is set.
In tmux(1):
Allow #[] in window-status-separator.
Insert new panes after the pane being split in the list rather than always after the active pane.
Cache selected state so that cells going from selected to unselected are not skipped.
In rebound(8), revert r1.27 of src/usr.sbin/rebound/rebound.c that used nonblocking sockets and spinned on them, trying to preemptively avoid kevent.
In ld.so(1), avoid a W^X violation when setting DT_DEBUG on mips64.
In eigrpd(8):
Reset the interface uptime when it is restarted.
Fix a potential SIGBUS on startup.
In netstat(1), display correct the counter for the "no basic MCS set" error.
In dig(1), reduce confusion about the -p option. Parse it, but only permit port 53, and make it an error otherwise instead of a warning.
In smtpd(8), deal with LMTP servers returning continuation lines.
Add uvm_share(9) to share a memory range between two address spaces. Its primary use is to make guest VM memory accessible to the host (e.g. vmd(8)).
In ommmc(4/armv7), reset the bus width back to 1-bit when resetting the host.
In eigrpd(8), improve security by calling exec(3) after fork(2). This way it has separate ASLR/cookies per process.
In doas.conf(5), add the "setenv" directive.
Abort a process if it trips the W^X violation check, unless it came from a filesystem with the wxallowed flag set.
In video(1), add -q to only display the device properties and quit.
In bgpd.conf(5), add the =, !=, - (range), >< (exclusive range) operators to the as-path filters (AS, peer-as, source-as, transit-as).
In iwm(4), fix multicast Rx by updating the MAC context again after sending multicast filter and STA settings during association. This makes ARP and inet6 autoconf work again.
Avoid decreasing uvm_maxkaddr which may cause the "address selector returned unavailable address" panic.
In ssh(1), allow ExitOnForwardFailure and ClearAllForwardings to be overridden when using "ssh -W" (but still default to "yes" in that case) (bz#2577).
In dhclient(8), change the reboot default value to 1 second.
On armv7, rename imxenet(4/armv7) to fec(4/armv7).
In kdump(1), allow printing timestamps relative to the beginning of the trace.
On amd64, fix two issues in the MSI-X code: actually read the MSI-X capability register, and correctly decode the table sizefromits contents.
In gcc(1), fix internal compiler error with long long arithmetic.
In mmap(2), prevent vsize_t underflow when checking RLIMIT_DATA, which made the check ineffective when you already had more memory than your limit allowed.
In iked(8), use the last 32-bits of the IPv6 address to dynamically assign addresses from the pool, instead of the fourth byte.
In intel(4), fix an undefined symbol crash when opting into uxa.
In aucat(1), set exit status to 1 if -n is used without -i and -o.
In nc(1), support the use of service names instead of port numbers.
Let rmdir(2) return EINVAL intead of EBUSY when trying to remove ".". This restores POSIX compliance for rmdir(2) and rmdirat(2).
In newsyslog.conf(5), increase permitted sizes for the daemon and messages logs.
In disklabel(8), unbreak automatic disk allocation based on a template.
In umsm(4), add support for Netgear/Sierra Aircard 340U.
In uvideo(4), correctly set the V4L2_BUF_FLAG_QUEUED and V4L2_BUF_FLAG_DONE buffer flags.
In iked(8):
Fix a bug in the code that replaces unspecified (e.g. 0.0.0.0) addresses by specified (e.g. 192.0.2.1) ones in IPv6 case.
Implement a second address pool specifically for IPv6, so that clients can be given an IPv4 and IPv6 address at the same time.
Remove the net.inet6.ip6.rr_prune sysctl(8).
Add utvfu(4), a USB device driver for Audio/Video capture devices based on the Fushicai USBTV007 chip.
Make xhci(4) usable on machines with xHCI BIOS support like most of the recent DELL.
Add support for using SRPs without the garbage collection machinery.
In sshd(8):
Ensure that the client's proposed DH-GEX max value is at least as big as the minimum the server will accept.
Check min and max sizes sent by the client against what we support before passing them to the monitor.
Fix ptrace PT_WRITE_D that returned EFAULT (broken in src/sys/kern/sys_process.c r1.33).
In libexpat, fix CVE-2016-0718.
In installboot(8), add support for armv7.
In binutils, port over the binutils fix for PR ld/3111: greatly speed up linking of object files that contain lots of dwarf2 symbols by caching symbol tables.
In newfs(8), permit wxallowed on mfs.
In libedit, fix a crash that occurred when the history contained more than twice as many entries as the new limit.
Ensure that softraid(4) crypto is not run on the crypto taskq.
In video(1), guard against using tp_start uninitialized in case no frame was grabbed in verbose mode.
Stop creating and inserting a route entry for ARP and ND automagically.
Flush dynamic route entries attached to an interface when its link state becomes DOWN. This should fix stale RTF_DYNAMIC routes when switching WiFi network during suspend/resume.
Plug a route entry leak triggered under memory pressure.
In video(1), add In mmap(2) support for frame grabbing and make it default over read.(2) unless overriden by the -g flag.
Identify W^X labelled binaries at execve(2) time based upon the WX_OPENBSD_WXNEEDED flag set by ld -zwxneeded.
In sed(1), fix a begin-of-word mismatch.
On amd64, include rdtsc in the rdrand callback.
Deal with interfaces removing the VLAN header before the packet has been feed to the pseudo-interfaces input handlers.
Update to freetype-doc 2.6.3.
In libc on i386, do setjmp cookies for eip, esp, and ebp.
In libc on mips64, do setjmp cookies for gp, sp, and ra.
5.8 and 5.9 RELIABILITY FIX: Bug in the libcrypto library when parsing certain ASN.1 elements.
A source code patch is available for 5.8 and 5.9.
Update to xserver 1.18.3.
Update to freetype 2.6.3.
In smu(4/macppc), add support for new smu-firmware fan commands.
Update to mesa 11.2.2.
Fix a pledge(2) violation with "ncheck_ffs /dev/tty".
In ld(1), implement -z wxneeded.
Fix a pledge(2) violation with "pdisk /dev/tty".
Implement the fork+exec pattern in smtpd(8).
Fix pledge(2) issues in growfs(8).
In nc(1):
Fix -verbose mode when used on a Unix domain socket.
Fix a pledge(2) violation when -P is used and a passwords needs to be supplied.
In iwm(4), add support for Intel Wireless 3165 devices.
In fsirand(8) and fsck_msdos(8), fix a pledge(2) violation that can be triggered by using DIOCGDINFO on a file that is not a disk device.
In disklabel(8), don't crash if no filename is provided.
In iwm(4), add support for Intel Wireless 8260 devices.
In aucat(1), fix file block size rounding and ensure it's large enough to store a full audio block.
In the install script, set the "wxallowed" mount(8) option for the filesystem /usr/local resides on.
No longer allow W^X violations by default. A kernel log message is generated, and mprotect(2) and mmap(2) return ENOTSUP. If the kern.wxabort sysctl(8) is set, a SIGABRT occurs instead. W^X-violating programs can be permitted per FFS/NFS filesystem, using the "wxallowed" mount(8) option.
In aucat(1), when resampling, use the exact resampling factor instead of the ratio between input and output block sizes. This change makes playback/recording rate match exactly the requested sample rate.
In httpd(8), return 400 (Bad Request) instead of 500 (Internal Server Error) for requests not specifying the HTTP version.
When initializing the console, add a short delay so that baud rate changes on the console have a chance of working. This prevents the serial console on the APU from hanging when garbage is echoed to the tty.
In procmap(1), reintroduce vnode-to-filename mapping.
In rc(8):
Skip library reordering if /usr/lib is on an NFS filesystem.
Temporarily remount read-write if /usr/lib is on a read-only FFS filesystem.
Make amaps use less kernel memory. This is achieved by grouping amap slots into chunks that are allocated on-demand by pool(9).
In scp(1) and sftp(1), prevent screwing up terminal settings by escaping bytes not forming ASCII or UTF-8 characters.
In regex(3), fix another one-byte buffer underflow (read access only).
Avoid a use-after-free in ftp(1).
In iwm(4), update to firmware API 16 and enable RTS/CTS frame protection.
In the armv7 install script, use efiboot when setting up the installed disk.
On octeon, prevent gather buffer starvation on currently supported systems.
In acpitz(4), disable active cooling trip points when we lack the right method to operate.
Place a cpu-dependent trap/illegal instruction over the remainder of the sigtramp page, so that it will generate a kernel fault if touched.
Remove the kern.random sysctl(8).
In umsm(4), support the Airprime/Sierra AirCard 313U and the Netgear/Sierra AirCard 770S.
Various improvements to ldpd(8).
In binutils on sparc64, make the PLT read-only. This allows the kernel and ld.so to load binaries without violating W^X.
Add UTF-8 support to fold(1).
On macppc, use 64-bit integers to fix fan scaling calculations.
Build armv7 efiboot.
In libc on hppa, add XOR cookies for rp and sp.
In libc on powerpc, add XOR cookies for r1 (stack) and lr.
Avoid a uvm fault when pulling an msdos-formatted umass(4) stick during mount while the USB stack is busy.
In smtpd(8), start work on improving the log format.
Build eeprom(8) on armv7.
Implement openprom(4) for armv7.
Make eeprom(8) -p print sensible numbers on little-endian platforms.
Remove the -x flag from mount_msdos(8) and always assume the execute bit for readable directories subject to the mask option (-m).
Stop making files executable on msdosfs.
Fix a logic bug in DUID generation: we want to generate DUIDs until we have one that is not a duplicate and not a zero DUID.
In ntpd(8), harden TLS for constraints.
On armv7, dynamically attach imxiic(4/armv7) and use the FDT to enumerate devices on i2c busses. The CuBox-i and Hummingboard now need to be booted with an FDT to see the RTC.
In cnmac(4/octeon), make the TX path MP-safe and add some ifq oactive logic.
On armv7, resolve problems with ommmc(4/armv7) sometimes not attaching properly with recent u-boot versions.
On macppc, hook up smu(4/macppc) to the thermal management framework.
On macppc, add a thermal management framework which controls the fan speed based on the temperature sensor values.
In the install script, log questions and answers during install/upgrade and mail them to the root user in a format usable as a response file for autoinstall(8).
In libcrypto, fix a short-read bug in the previous version of asn1_d2i_read_bio.
On i386, split the ACPI resume trampoline into code and data pages, and protect with proper permissions.
Remove the net.inet6.ip6.v6only sysctl(8).
5.9 RELIABILITY FIX: Possible data corruption in bnx(4).
A source code patch is available for 5.9.
In ieee80211(9), in hostap mode, don't re-use association IDs (AIDs) of nodes which are still lingering in the node cache. This could cause an AID to be assigned twice.
Split the i386 mp hatch trampoline into code and data pages, and protect each with proper W^X policy.
On octeon, accept cnmac as a valid rootdev from uboot (e.g. rootdev=/dev/cnmac0).
Rework the fix to prevent a kernel crash when sendsyslog(2) is called with LOG_CONS and the console device has not been intialized yet.
In regex(3), fix a one-byte buffer underflow (read access only).
Change the random event buffer from a queue to an endless ring so that no events are dropped when the queue is full. They are instead mixed into previous events.
Fix "skeyinit username" run as root.
5.8 and 5.9 SECURITY FIX: Insufficient checks in the uvideo(4) V4L2 ioctl(2) handling leak kernel memory contents to a local user.
A source code patch is available for 5.8 and 5.9.
Completely skip link-layer address resolution and NUD on gif(4).
In uvideo(4), plug some holes in the V4L2 ioctl(2) interfaces that would leak kernel memory to a local user. Also fix a potential integer overflow issue.
In httpd(8), fix some file-descriptor leaks.
Enable the pcf8523 RTC on Hummingboard and CuBox-i.
5.9 RELIABILITY FIX: Issues in smtpd(8).
A source code patch is available for 5.9.
In smtpd(8):
Fix a logic issue in the SMTP state machine that can lead to an invalid state and result in a crash.
Plug a file-pointer leak that can lead to resource exhaustion and result in a crash.
Have POSTREAD flush the D-cache. This eliminates random data corruption on the CuBox-i4Pro.
Add pfcrtc(4), a driver for the NXP PCF8523 Real Time Clock.
In xge(4), enable reception and transmission of Jumbo frames.
In smu(4/macppc), add support for pwm fans.
Initial stab at an EFI bootloader for armv7.
In sysmerge(8), no longer handle /etc/example files.
In install(1), add -F to call fsync(2) on the installed file right before closing it.
In tmux(1), add -q to source-file to suppress errors about nonexistent files.
In eigrpd(8), disable EIGRPv6 on an interface when it loses its link-local address.
Remove the hppa64 port.
Allow zaudio(4) to start when large blocks are requested.
Make the mips64 pmap MP-safe.
In top(1), allow to filter process arguments if they are being displayed.
Avoid a kernel crash when sendsyslog(2) is called with LOG_CONS and the console device has not been intialized yet.
Do SROP mitigation. sendsig() stores a cookie inside the sigcontext. sigreturn(2) checks the syscall entry was from the exact PC addr in the (per-process ASLR) sigtramp, verifies the cookie, and clears it to prevent sigcontext reuse
Try harder to avoid using random data on the disk as an inode, because FFS2 does lazy inode initialization. This avoids crashes when translating a bogus filehandle to a vnode.
Update to libexpat 2.1.1.
In rcs(1), implement Mdocdate keyword substitution.
In imxesdhc(4), add DMA support. It uses ADMA2 "Internal DMA" that is compatible with the SD Host Controller standard.
In chvgpio(4), add support for level, active low gpio interrupts.
In wall(1), enable UTF-8 detection in wall(1). This deliberately ignores UTF-8 characters and replaces them with a single question mark.
In bytgpio(4) and chvgpio(4), add support for writing gpio pins.
In ifconfig(8), stop printing the MPSAFE interface flag. It is a kernel-only hint and printing it only creates confusion.
Add chvgpio(4), a driver for the GPIO controllers found on Intel's Cherry View SoC.
On powerpc, flush page (through the direct map) before mapping it into AGP. This fixes artifacts seen in X on some G5 machines.
In the getpwnam(3) family of functions, stop opening the shadow database by default.
In tcpdump(8), print RA Route Information prefix, preference and lifetime.
Use a Thread Information Block in both single and multi-threaded programs. Make libpthread dlopen(3)'able.
In bytgpio(4), implement ACPI 5.0 GeneralPurposeIo OpRegion support.
Import Term::ReadKey 2.33.
In imxesdhc(4), add support for changing the bus width and set the 4-bit mode capability.
Make the imxesdhc(4) work on the cubox-i.
Revert the default cachepercent to 20.
In tcpdump(8), print the router preference contained in RAs in verbose mode.
Fix efiboot not to hang with a disk whose block size is less than 512.
Fix packet corruption in bnx(4).
Add Dual Data Rate support for eMMC at 52 MHz.
In gcc(1), add support for named initializers for anonymous structs/unions. This is a C11 feature that is starting to get used in places such as Mesa.
In midiplay(1), fix one of the reads past the end of the buffer.
In acpithinkpad(4), avoid a division by zero in wsconsctl(8).
In dc(4), cope with the broken DMA engine of the Davicom DM9102 found on some Sun sparc64 machines.
On sparc64, avoid having to panic on hardware with a broken DMA engine that attempts to read beyond the end of the buffer that was programmed.
Add initial support for MSI-X, only on amd64 for now.
In ssh_config(5), add IdentityAgent.
In sdmmc(4), add high-speed support for SD cards. This causes serious improvement in the read speeds.
In bytgpio(4), don't mask pins configured as direct IRQ. This nbreaks the keyboard on the Asus x205ta.
In ssh(1), fix overriding of StreamLocalBindMask and StreamLocalBindUnlink in Match blocks.
Stop using a soft-interrupt context to process incoming network packets. Use a new task that runs holding the KERNEL_LOCK to execute MP-unsafe code.
5.8 and 5.9 SECURITY FIX: Issues in the libcrypto library (CVE-2016-2108, CVE-2016-2107, CVE-2016-2105, CVE-2016-2106 and CVE-2016-2109). Refer to the advisory.
A source code patch is available for 5.8 and 5.9.
In libssl, fix several issues: missing padding check in aesni functions, overflow in evp encode functions, and use of invalid negative asn.1 types.
Reduce the number of lookups to 1 for non-multicast traffic when pf(4) is disabled.
In ssh, implement IUTF8 as per draft-sgtatham-secsh-iutf8-00.
In telnet(1), don't check if the hostname is a fully qualified domain. This prevents pledge(2) "dns" issues.
In tmpfs, fix some issues regarding timestamp updating.
In ssh:
Support SHA256 and SHA512 RSA signatures in certificates.
Add support for additional fixed DH groups from draft-ietf-curdle-ssh-kex-sha2-03.
On arm and armv7, rework mainbus and implement simplebus to be able to span a tree-like topology based on device tree information.
In ommmc(4/armv7), add support for changing the bus width to ommmc and set the 4-bit mode capability.
Add bus width switching support for MMC. Enable 8-bit bus support on sdhc(4) controllers that support it. This makes the raw transfer rate of the eMMC on the Lenovo Ideacentre Stick 300 go up to 40 MB/s.
In sdhc(4), fix the DMA issues on Bay Trail.
Add support for changing the bus width to the sdmmc(4) subsystem and the sdhc(4) controller. Use this to switch SD cards to a 4-bit bus if they support it.
In sppp(4), fix a bug causing breakage with LCP echoes.
5.9 RELIABILITY FIX: A problem in m_dup_pkt() can result in kernel crashes with carp(4).
A source code patch is available for 5.9.
Convert ldapd(8) to use the libtls API.
In file(1), fix the default type to work properly.
In bytgpio(4), mask all gpio interrupts when attaching. This fixes an interrupt storm on the Lenovo Ideacentre Stick 300.
In sdhc(4) and sdmmc(4):
Implement DMA support (only ADMA2 is supported). There is a remaining issue with simultaneous use of eMMC and external SD card on (some) Intel Bay Trail hardware.
Enable the ADMA error interrupt.
Enable high speed timing for bus clock frequencies over 26MHz and advertise support for it.
In tmux(1), add options to include status text in the pane borders.
Fix several bugs due to uninitialized struct nameidata's.
In softraid(4), panic when attempting to execute a scsi command with no discipline defined.
Fix a bug causing gzip(1) to think the resulting file was got larger during compression.
In daily(8), no longer call mailq(8).
In sysmerge(8), in interactive mode, check syntax of several important files after merging to give some protection against bad merges.
Don't allow the routing table of a bound socket to be changed. This is not intended and will behave unexpectedly if the address is already used in another domain.
In tmux(1), fix keys parsing again to correctly accept Unicode when not prefixed with Escape.
In smtpd(8), fix "smtpctl show queue" reporting "invalid" envelope state.
In ssh(1), close the ControlPersist background process stderr when the daemon is not in debug mode or when logging to a file or syslog (bz#1988).
In MAKEDEV(8), replace /dev/bpf[0-9] with /dev/bpf and /dev/bpf0.
In dhclient(8), if the attempt to broadcast a DHCPDISCOVER packet returns EAFNOSUPPORT, just print an error message and exit.
In installboot(8/i386), plug a couple of leaks of input buffers.
In libssl, allow ^C to break operations such as reading passwords.
In libssl, implement the IETF ChaCha20-Poly1305 cipher suites. The old Google implementation continues to be supported, but the ChaCha20-Poly1305 cipher suites names now refer to the ciphers from draft-ietf-tls-chacha20-poly1305-04.
In libssl, rename EVP_aead_chacha20_poly1305(3) to EVP_aead_chacha20_poly1305_old() and replace it with EVP_aead_chacha20_poly1305_ietf(3). The IETF version will become the standard version.
In ieee80211, rework handling of frames which fall beyond the block ack window.
In netstat(1), display block ack window slide counter.
In compress(1), account for multiple streams in "gzip -l" output.
In httpd(8), simplify TLS configuration handling and prevent a memory leak when there are multiple certificates specified for the same server.
In ifconfig(8), show 11n HT rate in "ifconfig scan" output.
Unbreak fsck_ext2fs(8).
In libedit, initialize the search buffer to avoid a potential read buffer overrun.
In xge(4), correctly set up byteswapping so this chip works on big-endian architectures.
In tmux(1), apply backspace check after working out the actual key, so that M-BSpace can work.
In xge(4), align rx buffers so ip packets will be aligned correctly for the stack.
In ksh(1), do not handle echo "`echo \"hi\"`" in POSIX mode differently than in traditional mode. This aligns ksh's behavior with bash and FreeBSD sh.
In netstat(1), make -W show the new 802.11n counters.
In netstat(1), print tcps_noport with "netstat -s" like it is already done for udp.
In tmux(1), fix problems with meta and Unicode keys.
In rcctl(8), implement daemon_rtable support.
In rc.subr(8), introduce rtable(4) support to rc.subr(8).
In readelf(1), show octeon in "readelf -h" output.
In rc(8), re-link (only the newest) libc.so on startup, placing the objects in a random order.
In softraid(4), don't attempt a rebuild using a hot spare with a sector size greater than the sector size of the softraid volume.
Use pledge(2) in groupadd(8), groupmod(8), groupdel(8), groupinfo(8), user(8), useradd(8), usermod(8), userdel(8) and userinfo(8).
In sysmerge(8), be consistent in batch and interactive mode: ensure sysmerge can be re-run if a file is left for later.
In acpitz(4), if the temperature is below the active cooling level for a tz, turn the fan off regardless of what state it is currently in.
In rtsx(4), match on RTS522A found in 2016 ThinkPads.
Remove systrace support.
In the install script, when upgrading automatically run sysmerge(8) in batch mode before fw_update(1).
On macppc and socppc, don't check if the CPU is inside the idle loop when entering ddb(4). This allows putting breakpoints in interrupt context and have them work if an interrupt fires while the CPU is idle.
In httpd(8), always pass the QUERY_STRING variable to the FastCGI handler.
In Xserver(1), fall back to /dev/ttyC0 when the console device is not a wsdisplay(4).
In ichiic(4), match on Intel 100 Series LP.
In puc(4), match on Intel 100 series and 100 series LP PCH.
In azalia(4), enable snooping on Intel 100 Series LP HDA.
Fix an issue where the 32-bit UEFI bootloader (BOOTIA32.EFI) would not detect a GPT leading to a failure to boot.
On mips64, sync dcaches and invalidate icaches of all active CPUs of a pmap when making a page executable. This prevents some icache inconsistencies that caused process crashes on multiprocessor IP27/IP30 systems under load.
In dwiic(4), match on Cherry Trail.
In synaptics(4), don't stop scrolling when handling TOUCH_RESET events.
In asmc(4), don't try to probe light sensors for machines with none available.
In mpbios(4), don't attach if "default configuration" mode is detected during probe rather than panicking.
In smtpd(8), use automatic DH parameters instead of fixed ones. Also disable DHE by default since it is computationally expensive and a potential DoS vector.
In perl(1), apply fix for perl bug 123562 (CVE-2015-8853).
In changelist(5), don't watch unbound(8)'s DNSSEC root zone key, to reduce security(8) spam.
In re(4), if RTL8111E on PC Engines APU is detected, configure NIC LEDs to display link (instead of the default of a normally-off light for network activity and nothing for ethernet link).
In changelist(5), add the iked(8) default key.
Add the editline(7) manual.
Make setting a vlan(4) interface's lladdr more likely to work.
Use the correct byte-order when checking against baddynamic ports.
In xen(4) and xnf(4), allow to grant memory access to domains other than dom0. This fixes running OpenBSD under QubesOS.
In pod2man(1), enable UTF-8 output by default and provide a --no-utf8 command line option to disable it.
In pax(1), skip empty lines in the input read for "tar -T", "cpio -E", and cpio(1) with stdin.
On amd64, make the aesni crypto implementation MP-safe.
Add a mechanism for dispatching MP-safe crypto operations.
Update to tzdata2016d from from ftp.iana.org.
Bump the default of cachepercent to 90 to see if we can find problems before we try to remove it entirely.
In pppoe(4), remove a hack that prevented changing pppoe params at runtime.
In nvme(4), fix a bug causing memory corruption seen on amd64 (and masked on sparc64).
In rbootd(8), don't bcopy(3) non-exchangeable structs. This should unbreak connection timeouts.
Remove am_maxslot from amap and remove the corresponding output from procmap(1).
In inteldrm(4), make the GMBUS code work on Intel ValleyView.
In rm(1), don't allow removal of "/".
In eigrpd(8):
Fix a corner case in Feasible Condition check.
Fix a segfault when reloading the config multiple times.
Check for subnet overlap between the configured summary-addresses.
Various other fixes and cleanups.
In vlan(4), rework configuration and mark it as MP-safe.
Enable nvme(4) on amd64 and sparc64.
In ssh_config(5), implement the "Include" directive.
In mandoc(1), fix a process group race sometimes causing a spawned less(1) to complain "Stopped (tty output)".
In mg(1), add "sentence-end-double-space".
On octeon:
Enable UART FIFOs.
Enable write buffering with write merging. This improves overall performance notably.
Enable device cloning for bpf(4).
Re-enable pckbd(4) on resume. This fixes problems on (at least) various HP laptops that previously had no working keyboard after resuming from zzz(8).
On amd64 and i386, use a CPUID function to determine presence of general purpose architectural performance counters. This fixes a panic seen on some hypervisors when pctr(1) is used when the hypervisor masks out the counters.
Various improvements to nvme(4).
In libssl, use the correct IV and counter when decrypting the ciphertext for EVP_aead_chacha20_poly1305_ietf(3).
In man(1), give manuals in purely numerical sections priority over manuals of the same name in sections with an alphabetical suffix (e.g. 3p).
In awk(1), fix a crash with empty assignments, (e.g. "BEGIN {i=$1}").
In pstat(8), fix a crash when the -T flag is specified.
In nvme(4), read chip capabilities before operating on it. This ensures the proper timeout for chip enables/disables are obtained.
In mg(1), stop putting a space at the end of a paragraph when using fill-paragraph.
Prevent a kernel panic by providing a dummy function for bridge(4)'s if_output.
On sparc64, (temporarily) disable ahc(4) so that GENERIC.MP kernels don't overflow the 8M reserved for .text and .rodata sections.
In rev(1), enable UTF-8 support.
In libedit, reset the terminal to its initial state before exiting a program that is using libedit.
In bgpd(8), don't exit when receiving an RTM_CHANGE message for an RTF_MPATH route that is actually on an interface.
In pf(4), don't panic if an mbuf(9) already has a statekey. This should help finding the remaining corner cases of packets looped back in the stack.
In vmd(8), place a BOOTARG_END section at the end of the boot arguments list pushed to the VM during boot. This makes it possible to install and run an OpenBSD i386 guest VM using vmm(4).
In libsndio, switch to the "new" audio(4) API.
In ssh(1), don't record duplicate LocalForward and RemoteForward entries (bz#2562).
In bgplg(8), use SERVER_NAME for the hostname displayed on the page.
Increase size of the clone bitmap. This is required for upcoming work on cloning bpf(4).
In vmm(4), support processors without unrestricted guest capability.
Fix EXA detection in r128(4), cirrus(4), mach64(4) and mga(4).
Enable creation of softraid(4) volumes using disks with non-512 byte sectors. This increments the metadata version.
Fix a memory leak in isakmpd(8).
In dhcpd(8), fix an abort due to a missing pledge(2) promise.
Add -f to ndp(8).
In grep(1), don't do reverse search optimization if looking for all matches in a line.
On armv7, map and use the bootconfig/FDT area passed by u-boot and try to init FDT on it. This allows for the use of device tree information.
In Xserver(1), implement VT switching (based on the USL compat interface) in the wscons console backend and use it by default.
Update to xf86-video-ati 7.6.1.
In ihidev(4) and dwiic(4), add support for I2C HID devices with GPIO signalled interrupts.
In rcctl(8), rename the "faulty" list action to "failed".
In tftpd(8), go in the background much later to reduce possible silent failures.
If one of the TCP SYN cache buckets overflow, it might be a collision attack against the hash function. Mitigate this attack by reseeding the hash function as soon as possible.
In uslcom(4), add support for the USB console port on Aruba 7xxx wireless controllers.
In ssh(1), remove fallback from moduli to "primes" file that was deprecated in 2001 and fix log messages referring to primes file (bz#2559).
In wsmouse(4), add support for multitouch input.
In rdistd(1), properly create directories that do not exist on the destination.
Improve support for alphas without all IEEE-mode instructions.
In gcc(1), fix optimization for alphas without the "precise arithmetic trap" extension.
In tmux(1), bump the listen(2) backlog up from 16 to 128.
Implement proxy ARP for ART based on mpath support.
In acpi(4), hook up the gpio interrupt on devices that use it for card detection. This makes the SD card slot on machines based on Intel's Bay Trail SoC fully functional.
In bytgpio(4), add support for gpio-based interrupts.
Add getlogin_r(2) system call that checks and returns errors like the userspace getlogin_r() API.
Remove MLINKS from base. They are no longer required by mandoc(1).
Enable oce(4) on sparc64.
In binutils, fix fallout from the switch to binutils 2.17: the binaries created by 2.17 aren't recognized by the in-tree gdb(1) because it's built with the bfd code from 2.15.
Add the net.inet.tcp.synuselimit sysctl(8) to adjust tcp_syn_use_limit. This is convenient to test the feature and may be useful to defend against syn flooding in a denial of service condition.
In authpf(8), avoid a dereference of a null object.
In tcpdump(8), properly check for the end of captured packet while printing CDP packets.
Ensure that a thread that calls sched_yield(2) ends up on the run queue behind all its sibling threads. This results in significant improvements for processes that suffer from lock, most notably firefox.
Add bytgpio(4), a driver for the gpio controllers found on Intel's Bay Trail SoC.
In netstart(8), don't delete the 224/4 route unless it's being done to ensure that a -reject route can be added. This restores the ability to set an interface route before daemons are started.
Avoid an attack that could prevent reseeding of the hash function used for the hash buckets in the TCP SYN cache.
In sdhc(4), make it possible to override the standard card detect mechanism to appease the SD controller on Intel's Bay Trail SoC.
Avoid a NULL pointer dereference when pulling and unmounting a umass(4) USB stick.
In libssl, fix a memory leak.
Switch from the SolidRun i.MX6 U-Boot to mainline U-Boot on the CuBox-i.
Always include the route priority in routing messages.
Do not populate RTAX_NETMASK when sending a routing message for RTF_HOST entries. This preserves old behavior with ART and fixes a regression.
In rc.d(8), make it possible to get usage as a non-root user.
In less(1) and ul(1), improve handling of ambiguous overstrike sequences.
In gcc(1) on arm, change the default arch target from strongarm (armv4) to arm9e (armv5te without xscale extensions).
Enable ART (Allotment Routing Table).
Ensure that a found proxy ARP entry has the correct flag.
In kernel clock, set ticks 15 seconds before its value wraps. This helps to identify issues around ticks wrap in 15 minutes instead of 240ish days.
In kdump(1), display NAMI records and AF_UNIX socket(2) paths with vis(3).
Update to tzdata2016c from ftp.iana.org.
In pipex(4), don't leak an mbuf when copying a packet fails.
Remove ARM10 and ARM11 support.
Fix various issues with bad gateways being picked up by bgpd(8).
Remove ARM9E support.
In npppd(8), log the reply message from RADIUS server when the authentication fails.
Add pledge(2) to tokeninit(8).
Rename sendsyslog2(2) to sendsyslog(2).
In ral(4), improvements for the RT2860 chip:
Fix watchdog timeouts and dropped frames under load.
Fix a bug where oactive is not set and mbufs are dropped.
Add a counter in the TCP SYN cache and in netstat(1) -s to show how often the hash function is reseeded and the random bucket distribution changes.
On octeon, use the list of the usable memory regions provided by U-Boot instead of the hardcoded regions in memory setup.
In ksh(1), make the "command" builtin POSIX-compliant and consistent with other current shells.
In ld.so(1), let the stack smash handler log to console directly if it is not possible to deliver to syslogd(8).
In vnet(4), plug a memory leak in ioctl(2) code path.
Many improvements of libedit, in particular with regard to UTF-8 support.
In axen(4), initialize the hardware on reset. This allows it to attach reliably and pass traffic, and prevents a panic when unplugging it.
Import libdrm 2.4.67.
Attach dwctwo(4) only on Octeon models that have a DWC2 controller.
Remove support for StrongARM (SA1), IXP12x0, IXP425 and XScale 80200.
In vi(1), avoid a backwards memcpy(3) when issuing ":e +something".
In tmux(1), make scrolling behaviour more sensible and maintain cursor position, as if the same had been done line-by-line.
In pkg_add(1), use a new _pkgfetch user for separation instead of the _pfetch user.
Remove ARM8 and ARM9T support.
Add octuctl(4), a driver for the Octeon II USB Controller Interface, and attachments for ehci(4) and ohci(4).
In puc(4), add support for the TXIC TX382B (currently TX/RX FIFO is not working).
In column(1), lpq(1), ls(1), newfs(8), ps(1), rusers(1), sed(1) and growfs(8), use the COLUMNS environment variable first, and either terminal width or a hardcoded value (typically 80) as appropriate.
In libssl, use explicit_bzero(3) for ASN1 objects on free. Too often these contain sensitive information.
In vi(1), add error checking for the COLUMNS and LINES environment variables to avoid a crash.
In sd(4), prevent a use-after-free of the scsi link structure during detach.
Expose new and much simpler audio(4) ioctls.
In npppd(8), transition to "Req-Sent" had been missing when RTA in "Opened". This caused a timer event leak.
Update to tzdata2016b from ftp.iana.org.
Allocate amap slots for a virtual memory range reserved with sbrk(2) lazily. This avoids wasting kernel memory if the user process does not make use of the allocated memory.
For amaps with only a few slots, allocate the slots via pool(9). This saves some memory and reduces kmem pressure.
5.9 RELIABILITY FIX: Incorrect path processing in pledge_namei() could result in unexpected program termination of pledge(2)'d programs.
A source code patch is available for 5.9.
5.7, 5.8 and 5.9 SECURITY FIX: Insufficient checks in IPv6 socket binding and UDP IPv6 option processing allow a local user to send UDP packets with a source (IPv6 address + port) already reserved by another user.
A source code patch is available for 5.7, 5.8 and 5.9.
In puc(4), add support for the Exar XR17V354 device.
Remove the legacy uiomovei(3) function. It has been replaced by uiomove(9).
In ssh(1), unbreak authentication using lone certificate keys in ssh-agent (bz#2550).
In acpicpu(4), correct the value of SRT_ENDTAG: it was documented incorrectly in early ACPI specs.
In libfontconfig, enable atomics operations on mips64 and mips64el.
In vmm(4), introduce memory ranges to support VMs with 4G or more of RAM.
In ichiic(4), ignore the SMBALERT# interrupt. This fixes booting the GENERIC kernel on ADI RCC-VE with buggy BIOS versions, rendering the internal eMMC flash unusable.
In kdump(1), recognize ipmi, vscsi, pvbus, udl, fuse, trunk, pipex and memrange ioctl(2) requests.
In sd(4), avoid a kernel panic when unplugging an USB umass stick because of a use after free.
Avoid corrupt mount points without a valid device when unmounting.
5.7, 5.8 and 5.9 SECURITY FIX: Lack of credential sanitization allows injection of commands to xauth(1).
A source code patch is available for 5.7, 5.8 and 5.9.
In ssh(1), sanitise characters destined for xauth(1).
In isakmpd(8), don't retransmit responses for unauthenticated messages.
Remove support for vax.
In fdisk(8) and pdisk(8), accept only a character special device as disk.
Rework how mpw(4) interacts with vlan(4). This will allow vlan(4) to become MP-safe.
In xterm(1), use UTF-8 mode by default.
In httpd(8), set the content charset for auto index generated pages.
Make "cp -i" behave as "mv -i" or "rm -i", independently of whether stdin is a tty or not.
Do not remove RTF_STATIC L2 entries from the routing table. Static entries might not have a cloning route to re-create them and hence be gone when their timer expires.
In kdump(1), improve display of unknown and KTR_START records.
Avoid refetching blocks already in the buffer cache. This significantly improves read operations on MSDOSFS.
Update to xrandr 1.5.0.
Update to libXrandr 1.5.0.
In ksh(1), make "set +o" conform with POSIX.
Tweak uvm assertions to avoid locking in some cases.
In file(1), sync "archive" magic from file 5.25.
In ntpd(8) constraints, avoid using %Z specification of strptime(3) which disagress with RFC7231 and can give surprising results on other operating systems.
In tmux(1), improve UTF-8 locale checking.
Update to unbound 1.5.8.
In ksh(1), fix POSIX-compliant behavior of "set -u" regarding "$*" and "$@" specials.
Almost completely rewrite mknod(8) in order to allow a speedup of MAKEDEV(8).
In tmux(1), avoid accessing a NULL pointer.
In vmd(8), set root device to sd0a, instead of wd0a.
In ksh(1):
Don't parse (...|...) patterns in variable substitution inside double quotes. This fixes a POSIX compatibility issue.
Remove the mknod builtin.
In ssh(1), fix ClientAliveInterval when a time-based RekeyLimit is set (bz#2252).
In tmux(1):
Avoid mixing up RGB colours with aixterm colours.
Make the show-* and set-* commands handle a missing target.
On amd64 and i386, unwind the trapframe correctly when a breakpoint is set on "syscall". This prevents a fault in ddb(4) on amd64.
Remove the machdep.userldt sysctl(8).
In ieee80211(9), restore an assignment of device current mode. This fixes iwi(4) fatal firmware errors.
Bump link_maxhdr (the space reserved before an ip packet payload for link headers) from 16 to 64.
In scp(1), improve accuracy of reported transfer speeds.
In sftp(1) and scp(1), improve precision of the progress meter.
In tmux(1), improve wcwidth(1) and mbtowc(1) error handling.
Remove Linux emulation support.
In libssl, add bounds checking for read_ledword().
In libssl, add bounds checking for BN_hex2bn(3) and BN_dec2bn(3).
In acpi(4), add more Windows versions for _OSI checks.
In cpsw(4), detect and only enable the port that is actually used. This avoids device timeouts. Also enable interrupt pacing to limit interrupts at 2K/s.
Set the IFF_MULTICAST flag on tun(4) interfaces so IPv6 addresses can be assigned.
In diff(1), rectify line numbers for "s/.//" commands in ed-style diffs.
In libedit, fix a segfault and functional error in c_gets().
In libssl, remove support for ancient, broken DSA implementations.
Fix a bug when IPsec UDP encapsulation is used for IPv6.
In gcc(1), fix an Internal Compiler Error on alpha when using __sync builtins.
In fnmatch(3), fix negation of POSIX character classes.
Prevent a memory leak in vnet(4/sparc64).
Valdate fs_maxsymlinklen in the superblock of ffs and ext2fs filesystems to avoid use of bogus data.
On alpha and sh, now that time_t is 64-bit, no longer ignore the hardware clock when it reports a year after 2037.
--------
Changes made between OpenBSD 5.8 and 5.9
When doing a lookup in the routing table, account for the fact that L2 entries are always in the first table of a routing domain. This fixes a regression introduced during 5.7 and 5.8.
Fix ECMP routing by passing the correct destination address to the hash routine.
On hppa, hppa64, macppc and sgi, restore validity checks for the disklabels read from disk. This fixes a problem when reading CDROM disklabels.
In pkg_add(1), sanitize the environment thru a whitelist. Only pass what is relevant for ftp(1) and similar programs.
In pdisk(8/macppc), fix display of pdisk partition sizes.
In the installer, fix macppc installs to HFS-partitioned disks.
Ensure the IP header is aligned correctly in the copies of multicast/broadcast packets received by a physical interface with carp(4) interfaces on it.
In ssh(1), fix a spurious error message when an incorrect passphrase is entered for keys.
In patch(1), properly handle ed-files which fully replace input file content.
In smtpd(8), avoid overriding the user-provided address family for a listener.
In eigrpd(8):
Filter RTM_GET messages which are not from us.
Make eigrpd(8) work against newer IOS routers.
Add scope id only for unicast IPv6 packets.
Skip redistributed routes when updating the FIB.
In tcpdump(8), show details of beacon country elements in verbose mode only.
On i386, fix a boot issue on non-ACPI i386 machines that need X permissions on the BIOS region in the ISA hole.
On alpha, re-enable OpenGL.
On alpha, avoid an ICE generated when building mesa with -O2.
In azalia(4), enable snooping on Intel C610.
In random subsystem, avoid a undefined behaviour when using right shift operation.
In em(4), add support for the Intel I219 network chip.
On arm, disable the stack protector when building libstdc++.
In ssh, unbreak SSHv1.
In syslogd(8), prevent an integer overflow in syslogd when parsing the priority.
In /etc/ssl/cert.pem, add a few root certificates from Mozilla's cert store.
In sshd(8), make sandboxed privilege separation the default.
In tar(1), ignore trailing slashes and skip over duplicate slashes in chk_path() to avoid infinite loop when creating intermediate directories.
In ssh(1), add a "Close session" log entry (at loglevel=verbose) to correspond to the existing "Starting session" one.
In tar(1), fix archiving a 101-character absolute path in ustar format.
In httpd(8), fix a double free in the patterns code.
In softraid(4), avoid using uninitialized variables in two corner cases.
In smtpd(8), add the "listen on socket" smtpd.conf(5) rule.
In iwm(4), initialize net80211 callback pointers at attach time. This fixes a crash.
In makemap(8), remove support for "dbm".
Remove the "GenuineIntel" check from x86 mdrandom(). This enables the use of RDRAND and TSC fallback on CPUs from other vendors, notably AMD.
In ssh(1), avoid fatal error for PKCS11 tokens that present empty key IDs (bz#1773).
In ieee80211(9), don't pass QoS "no data" frames to the A-MPDU reordering logic. This avoids major confusion.
In ipmi(4), check the sensor name length more carefully. This avoids a panic on the Dell R210 II.
In sftp(1), fix a regression where existing destination directories would incorrectly terminate recursive uploads (bz#2528).
In wsconsctl(8), hidms and uts(4), permit negative x and y coordinates in mouse.scale.
On hppa64, make __cpu_simple_lock provide serialisation of the critical section. This makes atomic sequences actually atomic.
In 5.8, fix a bug in vlan(4) and carp(4) refcounting. This will cause a panic when root does an "ifconfig destroy" of a the parent interface. (5.7 and -current are not affected.)
In ieee80211(9), log frames which fall outside the BlockAack window in dmesg(8) if the interface debug flag is set.
In pkg_add(1), drop privileges prior to running ftp(1).
On hppa, make __cpu_simple_lock provide serialisation of the critical section. This makes atomic sequences actually atomic.
In ssh(1), turn off more old crypto: hmac-md5, ripemd, truncated HMACs, RC4 and blowfish.
In ssh(1), do not attempt to percent-expand an already-canonicalised addresses. This avoids unnecessary failures when attempting to connect to scoped IPv6 addresses.
In hexdump(1), fix a bug that caused nothing to be skipped when skipping exactly the number of bytes present in a regular file was requested.
In 5.8, fix a kernel crash when root creates, changes or destroys carp(4) interfaces multiple times with ifconfig(8). (5.7 and -current are not affected.)
In ssh(1), make application of rekey limits more accurate (related to bz#2521).
In ieee80211(9):
Work around buggy APs which occasionally emit sequence numbers much higher than the current 11n BlockAck window.
Stop requiring a BlockAck session timeout. Just use it if the AP is asking for it.
In iwn(4), fix off-by-one in a loop termination condition.
In dhcpd(8), avoid a use-after-free when parsing address ranges from a config.
In vmd(8), avoid a double free in an error path.
Update to xkeyboard-config 2.17.
In pchtemp(4), add support for the Intel 9 Series.
In radeondrm(4), enable the code that reads the BIOS from the ACPI VFCT table on platforms with ACPI.
Fix iwn(4) CCMP replay detection so it does not drop out-of-order A-MPDU subframes. This helps 11n mode with WPA.
In the msdosfs code, guard against integer overflow when checking whether writing to a file stays within the maximum file size.
Make write(1) explicitly ASCII only. This prevents sending of potentially harmful bytes to terminals that do not support UTF-8.
In iwm(4) and iwn(4), set max A-MPDU length to 64k instead of 4k and tell the firmware about A-MPDU spacing.
In ieee80211(9), store ADDBA request and response parameters in the block ack record. Now it is possible keep track of the ACK policy and echo it back to the AP. This fixes Apple Airport APs.
On mips64, re-enable OpenGL.
In ssh(1), fix a problem where the mux master would sporadically fail to notice that the client had exited.
In tmux(1), do not wrap cursor at start or end of history.
Use pledge(2) in talk(1) and talkd(8).
On amd64 and i386, add /dev/ipmi0.
In ipmi(4), implement FreeBSD-compatible IOCTL to access BMC.
In iwn(4):
Restore the CCMP key to firmware after HT protection setting updates. This unbreaks WPA in 11n mode.
Pass 802.11 control frames in monitor mode.
In ieee80211(9), restore the BlockAck session timer.
In smtpd(8), when deleting a message, remove associated envelopes from the cache.
In the ext2fs and ufs code, prevent a signed overflow.
In tcpdump(8), fix an infinite loop when printing a country element in a management frame in case we hit channel Tx power limits that cannot be pretty-printed.
In efiboot, work around peculiarities of (buggy) UEFI implementations: always call SetMode(), but don't report an error if the current mode is the same as the desired mode.
In radeondrm(4), prevent a panic when the ROM size is 0.
In sd(4), avoid a possible use-after-free.
In pkg_add(1), update the font cache after removing packages with @fontdir markers.
In tcpdump(8), show 802.11 control frames.
In dhclient(8), dhcpd(8) and dhcrelay(8), be very careful accepting packets via bpf(4).
Enable hostctl(8) on amd64 and i386.
In tail(1), fix off-by-one in argument parsing.
Prevent efifb(4/amd64) from attaching if we are the console.
In smtpd(8), fixe a mismatch between DSN's subject line and its content.
On amd64 and i386, correct signal delivery on systems where the AVX leaf is disabled.
On amd64 RAMDISK_CD, enable pvbus(4), xen(4), xnf(4) and xspd(4).
In libxcb, make sure the socket send buffer is at least 64KB. This should speed up applications that send images to the X server, like Firefox.
In xen(4) and xenstore(4), make a few reliability improvements in the power management interface.
Stop setting the process title in bgpd(8), dvmrpd(8), eigrpd(8), hostapd(8), httpd(8), ldpd(8), npppd(8), ntpd(8), ospf6d(8), ospfd(8), relayd(8), ripd(8), snmpd(8), smtpd(8) and vmd(8). This makes it possible to manage multiple copies of a daemon using the normal infrastructure by symlinking rc.d scripts to a new name.
Use pledge(2) in pdisk(8/macppc).
Implement "ldapctl -r datadir".
On armv7, add A20 support to sxirtc.
In sxitimer(4/armv7), remove A20 support; agtimer is now used instead.
Move to -release mode.
In ldapd(8), add -r to specify an alternative directory to store/read the database.
In ieee80211(9), stop requiring a BlockAck session timeout, but still honour the timeout if the AP requests it.
In tcpdump(8), show 802.11 QoS frames properly.
On armv7, fix the encoding of AP bits for large page second-level short-descriptors.
Revamp /etc/ssl/cert.pem certificate information formatting and sort certificates in a more useful way.
In pdisk(8/macppc), set lblock_start and lblocks to 0 in free space entries like Apple does.
In tmux(1):
Fix new-session with -t after command flags changes.
Support negative trim values in formats to trim from the end.
Add RGB escape sequences for capture-pane -e.
On armv7:
Allow the kernel to boot from a u-boot without the OLD_SUNXI_KERNEL_COMPAT option.
Use ARM Generic Timer (agtimer) instead of sxitimer(4/armv7) on Allwinner sun7i/A20.
Hook OPENBSD-RELAYD-MIB into OPENBSD-SNMPD-CONF.
Sync libedit with NetBSD.
In pkg_add(1), extend URL abbreviation support from pkg.conf(5) so that every URL can be abbreviated.
In ping(8) and ping6(8), fix a regression in -E.
In xen(4), add support for the "control/shutdown" power management facility. At the moment only "poweroff" and "reboot" actions are supported.
In xenstore(4), add support for XS_WATCH, a XenStore notification facility.
In pdisk(8/macppc):
Tweak printing of partitions: always show the pblock and lblock info in the "p" and "P" commands, respectively.
Warn of partitions extending past the end of the media.
Support only base 10 for partition IDs.
In aucat(1), fix unsupported parameters not being detected if compiled in 24-bit mode and sndiod is not running.
In pdisk(8/macppc), improve conformance to OS X's behaviour.
In tmux(1), add support for RGB colour.
In audioctl(1), display play and record parameters that are not independent as a single variable.
Install the relayd(8) SNMP MIB.
In ssh, allow RekeyLimits in excess of 4G up to 2**63 bits (part of bz#2521).
In ftp(1), fix a crash when a server sends a non-standard newline.
In daily(8), run "rcctl ls faulty".
In pdisk(8/macppc), make "r" (reorder, a.k.a. swap) command work with any two existing partitions. Do not allow partition 1 to be moved.
In pkg.conf(5), allow installpath to be set to a bare hostname which implies "http://hostname/pub/OpenBSD/[snapshots-or-version]/packages/[arch]".
In pdisk(8/macppc):
Check block 0 signature, physical block size and physical block count when reading partition map.
Check for unmapped physical blocks and overlapping partitions when reading partition map.
Remove "v" command.
Add hostctl(8), a tool to access key-value stores on the host, currently for hypervisor information stores on pvbus(4). It is not enabled yet.
On amd64 and i386, add /dev/pvbus0.
In pvbus(4), add a key-value interface that allows to get or set values in the underlying information store of the host from the OpenBSD-VM's userspace.
In libpthread, replace the malloc spinlock with a mutex. This makes ports like Firefox significantly more usable.
In mg(1), ensure the backup file has the same mtime as the original file.
In xnf(4), rewrite tx path to use flat transmit ring without fragment chains. This gives a transmit performance improvement and taxes grant table references much less than before.
In xen(4), do not take a grant table entry mutex in xen_grant_table_{enter,remove} since it is unnecessary. This provides a performance improvement as well.
In malloc(3), fix a possible crash when dumping malloc stats.
In xen(4), ensure use of locked atomic operations even on the SP kernel.
In fputwc(3), when encoding fails set the error indicator as required by POSIX and as done by FreeBSD, SunOS 10/11 and glibc.
In vr(4), fix an mbuf leak on encapsulation failure.
In tail(1), fix a crash.
In pf(4), fix a pf_state_key leak.
In ieee80211(9), honour ERP protection on 2 GHz channels in 11n mode.
In vmm(4/amd64), zero the buffer to be copied out to userland to avoid information leak.
In 5.8, fix a kernel crash when root creates, changes or destroys vlan(4) interfaces multiple times with ifconfig(8). (5.7 and -current are not affected.)
In ieee80211(9), iwm(4) and iwn(4), keep track of HT protection settings in beacons and have 11n-capable drivers update hardware configuration accordingly.
In xnf(4), revert the minimum number of rx ring slots back to 32.
In vmx(4), do not send the mbuf to bpf(4) after passing it to the hardware. This could have resulted in a page fault.
In snmpd(8), avoid a potential double free.
In etherip(4), do not return an uninitialised value for the SIOCGLIFPHYRTABLE case.
In ypldap(8):
Implement the "master" request.
Set argument encode / result decode call backs for "maplist".
Set argument encode / result decode callbacks for "all".
In ld.so(1), make a nodelete object lock down the entire load group, not just the specific object.
Update to Mesa 11.0.9.
On arm and armv7, switch to SVC mode when machines with virtualisation extensions boot into a HYP processor mode that has different memory management and register behaviour among other things. This prevents an early crash.
In pdisk(8/macppc), avoid double prompt after creating default map on startup.
In dwiic(4), avoid reading uninitialised memory when expected value types are not present.
In xnf(4), set up interface features based on capabilities provided by the backend.
In xnf(4), set minimum number of slots on the receive ring to 18 as most versions of Xen require at least this number of slots.
Always check destination MAC address of received unicast packets, not only when in promiscuous mode. This is necessary for NICs like virtio(4).
In vxlan(4), drop packets whose VNI flag is not set and VNI is not zero.
In etherip(4), support tunnel VRF.
In pdisk(8/macppc):
Remove "expert" mode and the -d flag. Instead make all commands available all the time.
Change the "P" command: it now shows map data structures.
Stop accepting uppercase aliases for commands documented as lower case.
Eliminate the 'written' field and just use the 'changed' field to mediate when it is appropriate to ask whether changes should be discarded.
Repair creation of initial partition table on a blank disk.
In ieee80211 stack, fix the timeout value sent in ADDBA request and response frames.
In socpcic(4/socppc), avoid use of an uninitialised variable.
In ieee80211(9), fix the timeout value sent in ADDBA request and response frames.
In pdisk(8/macppc), do not silently open a disk read-only when read/write access was requested.
In calendar(1), add a calendar for New Zealand.
On sparc64, check for disks deeper than 4 levels down in the Open Firmware device tree. This makes softraid(4) boot possible on more sparc64 machines.
In xnf(4), do not bump output errors when when tx ring is full.
Add hidmt(4) (a HID-layer driver for multitouch touchpads that conform to the "Windows Precision Touchpad" standard) and imt(4) (an i2c-HID driver that sits between ihidev(4) and hidmt(4)).
In ihidev(4), add the ability to set and get reports and establish interrupt before probing for devices to handle each report ID.
In morse(6), use the <AC> prosign as "@". Support decoding only of other prosigns, including <SK> as we were previously using for "@".
In unbound(8), suppress "cannot assign requested address" log messages unless verbosity is high.
On sparc, fix a race causing hardclock(9) to be sometimes invoked between the end of cpu_configure() and initclocks().
In xnf(4):
Fix a few issues in the transmit path.
Mask interrupts on boot, masking/unmasking is handled by stop/init.
In pdisk(8/macppc), remove the "expert" mode "d"/"D" command.
In mg(1) cscope, skip empty entries in $PATH instead of erroneously interpreting them as ".".
In pdisk(8/macppc), remove the "debugging" mode command to examine the Apple_Patches partition contents.
Add UTF-8 support to colrm(1).
In xen(4), provide a Xen v3 API compatible fallback for event channel hypercalls.
In ls(1), fix a regression (and POSIX violation) introduced with UTF-8 support.
In xenstore(4), fixup a hang while performing a read operation on XenStore.
Add UTF-8 support to ul(1).
In sndiod(8):
Load pki keys before daemonising. Passphrase-protected keys require access to stdin.
Allow time differences between two clock_gettime() calls to be up to 60s without logging a warning.
In morse(6), use distinct codes for left and right parentheses.
In dwiic(4), fix an off-by-one that could result in read operations not reading the last byte.
On the amd64 RAMDISK_CD, enable ikbd(4).
In ldapd(8), properly remove unix sockets upon exit of the parent process.
In mandoc(1), unbreak reading from stdin.
In pdisk(8/macppc), remove support for 1024- and 2048-byte sector devices.
On octeon, attach secondary CPUs by coremask. This fixes a crash that happened if the MP kernel was booted with coremask=1.
On octeon, panic if booting the kernel without CPU 0.
Fix two issues in the systat(1) state view:
Fix peak and rate computations for states that transferred more than 4 GB.
Prevent a possible in the rate and peak when creating new cache entries for existing states.
In pflogd(8), remove broken interface status printing support.
In tmux(1), add hooks for alerts (bell, silence, activity).
On the amd64 RAMDISK_CD, enable sdhc(4) at acpi(4) so eMMC will be available at install time.
In dwiic(4), prevent attach the driver if the device is not present.
In puc(4), add Moxa CP-168U support.
Implement intr_barrier(9) for sh/landisk.
In xspd(4), if the xnf(4) driver is enabled, detach emulated network devices.
In eigrpctl(8), introduce the "eigrpctl clear neighbors" command.
In eigrpd(8):
Do not set the EoT flag in the last startup update.
Add support for manually clearing neighbors.
Fix bug that happened when a passive interface was shut down and then reactivated.
Several fixes in the Conditionally Received (CR) mode.
Fix detection of the Stuck-in-Active (SIA) state.
If an explicit nexthop was advertised for a route, show it in the "eigrpctl show topology".
For each prefix, order routes by their nexthop.
In eigrpctl(8), in the "show" commands, order the routing instances by AF and then by AS.
In ddb(4), add a "show socket" command.
In rpcgen(1), add support for parsing "hyper" and "quad" types, as per RFC 4506.
When enabling a non-volatile memory express controller, wait till CSTS.RDY lights up.
In ssh(1), fix some file descriptor leaks.
In which(1):
Use the default path if there is no PATH in the environment.
Avoid potential read of one byte before the start of a buffer.
Attach dwiic(4) on the Intel Bay Trail i2c controllers.
In dwiic(4), fix several issues:
Properly map bus space
Properly implement the iic(4) operations.
Keep timings set up by the firmware if the SSCN and FMCN methods aren't available.
Add ikbd(4), a driver for HID-over-i2c keyboards.
In calendar(1), add a calendar file for the United Kingdom.
Prevent a NULL dereference when detaching a USB device with ugen(4) disabled or if allocating memory during the attachment process failed.
On octeon, add support for a variety of USB devices.
In ssh, remove roaming support altogether.
5.7 and 5.8 SECURITY FIX: experimental roaming code in the ssh client could be tricked by a hostile sshd server, potentially leaking key material (CVE-2016-0777 and CVE-0216-0778).
A source code patch and workaround is available for 5.7 and 5.8.
In ssh(1), disable experimental client-side roaming support.
Grab the kernel lock before delivering a message to the routing socket when an ARP resolution has been done. This should fix the "receive 1" panic.
In pfctl(8), print an error message when detecting multiple root queues on a single interface.
In acpi(4), fix a bug in dwiic(4) where it would try to access i2c devices on busses they're not attached to.
In ssh(1), eliminate fallback from untrusted X11 forwarding to trusted forwarding when the X server disables the SECURITY extension.
In luit(1), properly disable LNEXT (^V) processing.
Update to xterm 322.
On amd64, enable xen(4), xnf(4) and xspd(4) in GENERIC kernels.
In ihidev(4), fix hid packet length calculation.
In dhcrelay(8), check UDP length for short as well as long values.
Implement VFS read clustering for MSDOSFS.
Make "ifconfig $if mode" a valid subcommand that works independently of the "media" subcommand.
In iwn(4), tell the firmware to retry failed Tx at 1Mbit/s instead of MCS 0. This seems to make tx rate scaling go up faster and helps rx performance.
In vlan(4), do not propagate any of the parent interfaces offload features on svlan(4).
On amd64 and i386, in the TSC fallback code, perturbance is biased towards the lower bytes of a word. Compensate for this with a bit-spreading operation which applies a result byte by byte.
Let smtpd(8) start on machines without a FQDN as hostname.
In pdisk(8/macppc), remove -i.
In ndp(8), do not print an error if the list of prefixes is empty.
Remove wireless turbo mode support. It is a non-standard extension supported only by obsolete devices.
In carp(4), prevent a NULL dereference if SIOCGVH is issued without carpdev argument.
In acpi(4), improve emulation of PM registers on Hardware-reduced ACPI. This makes the transition into S5 (powerdown) work on the ASUS X205TA.
In pdisk(8/macppc), remove -c and -d.
Add dwiic(4) (a driver for the Synopsys DesignWare i2c controller), ihidev(4) (a HID-over-i2c driver) and ims(4) (a HID-over-i2c mouse/trackpad driver).
In the installer validate the data for CGI_{METHOD,TIME,TZ} since it comes from an external source.
In em(4), avoid a use-after-free when posting the packet on 82547 chips after bpf(4).
Make sdhc(4) attach to hardware IDs 80860F14 and PNP0FFF.
Make sure the keyboard mux gets picked up by the primary (console) display and that USB keyboards get paired with the console even if they are not marked as the console keyboard.
In relayd(8), add the host_error output and the http code (when available) to the host-check log.
On amd64 and i386, ensure the keyboard mux gets picked up by the primary (console) display and that USB keyboards get paired with the console even if they are not marked as the console keyboard.
In pdisk(8/macppc), remove -v.
In perl(1), fix "XS File::Spec::canonpath loses taint" (CVE-2015-8607).
In xenstore(4):
Handle zero-length messages.
Prevent infinite loop when receiving and empty reply or directory node.
Fix a bug where cron(8) could skip re-reading the spool after two consecutive changes.
In ipmi(4), if possible, read values from disabled sensors.
Make sdhc(4) attach to acpi(4). This is neede to support the SD host controllers integrated on Intel's Bay Trail SoCs.
In sdmmc(4), add limited support for controllers that implement version 3.0 of the SD host controller standard.
In pdisk(8/macppc), use the device's default disklabel to determine a disk size.
In acpithinkpad(4), add ThinkPad tablet dock/undock ACPI events.
In ipmi(4):
When stopping the watchdog, clear DONTSTOP bits. Without this, BMC records a watchdog timer expiration event.
Print a message to console when the watchdog is enabled or disabled.
Make the eMMC on the ASUS X205TA work.
Add UTF-8 support to ps(1).
On mips64, revert the MP pmap diff. It does not work on non-PMAP_DIRECT systems due to lock recursion.
In jot(1), when generating random sequences, fix the bias at both ends of the specified interval.
In audio(4), fix a bug when closing /dev/audioctl and /dev/mixer they wrongly return ENXIO.
In acpi(4), initial support for Hardware-Reduced ACPI.
In fdisk(8), revamp the display of GPT information, hiding less important information under the -v flag.
In ipmi(4), correct sensor threshold handling by properly checking the response of the Get Sensor Reading Command.
In ftp(1), handle redirects to relative URIs containing "://".
Remove the arp and revarp input queues. Packets of these types are now processed in the softnet task without holding the kernel lock.
In sndiod(8), unbreak support for multiple -L options.
Improve UTF-8 support in ksh(1):
Allow non-ASCII characters to be part of words.
Allow insertion of non-ASCII characters without screwing up the display.
Fix forward movement.
In sis(4), work around buggy zero-length packets produced by the DP83816A.
Enable uonerng(4) in kernels where ualea(4) is already present.
Add uonerng(4), a driver for the Moonbase Otago OneRNG.
On octeon, avoid rendezvous from failing if buffering is enabled.
In Mesa, disable reading of drirc files by default. This allows for a stronger pledge(2) in chromium.
In ieee80211(9), make the A-MPDU reordering buffer more resilient against APs which drop some subframes or let the sequence number jump up by more than 1. This should fix network stalls seen in 11n mode.
In iwn(4) and iwm(4), fix A-MPDU parameters in link quality firmware commands.
In mandoc(1), detect recursive "define" in eqn(7) which avoids infinite loops.
In hack(6), read ^Z as a normal character. This fixes suspend/resume.
In fmt(1), add UTF-8 support for -c.
In ifconfig(8), sync displayed interface flags to reality.
In acpibtn(4), fix the lid sensor for machines that do not generate an event when the lid opens.
Add xnf(4), a Xen virtual networking interface (Netfront) driver.
In cpsw(4/armv7), properly handle the receive queue being full condition instead of hanging.
In em(4), mark the driver MP-safe.
In ipmi(4), fix a panic in odd situations.
On i386, when booting from softraid, get the first, not the last, OpenBSD partition in the MBR.
In vi(1), remove the message catalogs.
In iwm(4), initialize the A-MPDU parameters field in HT capability elements.
In malloc(3), remove the "a" option.
In expr(1), use 64-bit integers for arithmetic.
On amd64, when booting from softraid, get the first, not the last, OpenBSD partition in the MBR.
Prevent integer overflows in sosend(9) and soreceive(9).
In iwn(4), always use a CCK rate as last fallback in the firmware's tx rate retry table. This may make 11n mode work in very noisy environments.
In acpi(4), fix systems that don't implement legacy mode.
Revert sys/dev/pci/if_oce.c r1.87 (which unlocked the interrupt handler rx path).
On mips64, make POWER Indigo2 R8000 boot multiuser again.
In fgetws(3), fix a bug when errno is EILSEQ upon function entry or when the file ends without a terminating L'\n' character.
Fix lots of bugs in the fprintf(3) family of functions.
In mandoc(1), improve handling of .Va and .Vt macros.
In iwn(4), add initial support for 11n mode to the iwn(4) driver. Only MCS 0 to 7 are supported for now.
In ieee80211(9):
Skip over 11n mode during scanning to avoid scanning channels more than once.
Allow switching into 11a and 11b/g mode correctly when the driver supports 11n.
Fix manual scan while associated in 11a mode.
Fix negotiating A-MPDUs with some APs.
Use pledge(2) in spamd-setup(8).
In re(4), mark the driver MP-safe.
In nc(1), use the correct values for TLS certificate and private key flags.
On vmm(4/amd64), do proper termination of VMs by doing proper VCPU run state management. This should fix some of the odd termination errors.
In mg(1), allow macro execution to continue without delay in the event of a visible bell call.
Fix problems with EFI installs involving many disks.
Update to randrproto 1.5.0.
Update to x11proto 7.0.28.
In pchtemp(4):
Add support for Intel 100 Series.
Enable on i386.
Update to freetype-doc 2.6.2.
In mg(1), add dired-find-alternate-file.
In iec(4/sgi), take the PHY out of reset before attaching the interface. This allows for disabling some checks on reboot, making reboots faster especially on IP27.
In sendsyslog2(2), avoid a panic that could occur when writing to the console.
In ix(4), do not grab the kernel lock in the rx and tx paths.
In trunk(4), fix the "lacp_compose_key protection fault trap" when removing a port from a lacp trunk.
Add pchtemp(4), a driver for the thermal sensor on recent Intel PCHs.
In inteldrm(4), unconditionally set the "switchcookie". This fixes synchronous VT switching.
Use pledge(2) in tokenadm(8).
In malloc(3), fix a NULL dereference in case the abort option is disabled.
In nlist(3), avoid out-of-bounds access and excessive memory allocation on a malformed ELF header.
In mg(1), add transpose-words. It is limited to one iteration until "undo" is looked into.
In wscons(4), change keyboard configuration detection to work even when a kbd(8) setting has multiple bits set (e.g. us.dvorak.swapctrlcaps).
In bge(4), mark the start routine as MP-safe.
Set the UltraDMA transfer mode for SATA drives. Some of these drives, such as the Maxtor 7Y250M0, refuse to do DMA unless the transfer mode has been set. This causes reads (and presumably writes) to time out.
In the installer, do not insist on EFISYS partitions on non-root disks and prevent an autoinstall loop.
In re(4), mark the interrupt handler as MP-safe.
Add GENERIC-IP27.MP for MP support on the SGI Octane 350.
Import libdrm 2.4.65.
On amd64 and i386, if available, prefer the rdseed instruction over rdrand when adding entropy to the kernel random number generator.
In puc(4), add the Perle Speed8 LE.
In cp(1), set the times, mode and flags on symlinks when doing cp -p (or mv across filesystems).
In ukbd(4), enable the iso keyboard munge fix for MacBookAir6,2.
In libevent, revert the change to call kevent(2) immediately (which was done to prevent the dispatch loop from bringing down the entire process). tcpbench(1) relies on the old behaviour.
On sgi, add a timecounter for MP, make interrupt masking MP-aware, add launch logic for secondary CPUs and add IPI logic.
In kdump(1), implement basic kevent(2) printing.
In fgetwc(3), set the error indicator when an encoding error occurs, as specified by both the manual page and POSIX.
In file(1), add --brief and --dereference. These are used by xdg-open and xdg-mime.
In mg(1), add -R to open the specified files read-only.
Implement privsep and use pledge(2) in mountd(8).
Use pledge(2) in sndiod(8).
Update to sqlite3 3.9.2.
In rdate(8), expand the size of messages between processes to accommodate larger messages.
Import Mesa 11.0.8. This seems to fix some of the problems with clutter/gnome reported to occur on r600 with Mesa 11.0.6.
Ensure the installer asks for the IPv4 default route in case an interface has been configured via dhcp and then again manually.
Find the OpenBSD disklabel on GPT partitioned softraid volumes in order to allow booting from such volumes.
In asmc(4), make communication with the Apple SMC chip more reliable.
Add viocon(4), the VirtIO console device.
In smtpd.conf(5), switch to "file" backend for the aliases table by default.
In smtpctl(8), support some sendmail-compatible command-line arguments.
In tmux(1), fix a bug where the "attach-session -d" detached the wrong session.
In Xserver(1), default to using the modesetting(4) driver on Broadwell. It works better than the intel(4) driver.
In drm(4), advertise support for DRM version 1.4. This makes the PCI-based probe method in the modesetting(4) driver work.
In Mesa:
Set the configure option to enable floating point textures. This is required by drivers such as r600 to support OpenGL 3.x.
Build the gallium software rasteriser (softpipe). This fixes loading the r300 driver on macppc.
In sndiod(8), implement initial privilege separation and reenable networking.
In uvideo(4), do not delay video(4) attachment if the device does not need to load firmware.
Use pledge(2) in mtree(8).
On alpha, disable pcn(4) on ramdisk kernels.
Move to 5.9-beta.
In dhclient(8), do not exit if a route can not be added.
In rc.d(8), don't report that the daemon has succesfully started if it actually failed because of a config error.
Prevent GPU lockups with KMS and AGP-enable on Uninorth (G4) machines. KMS is now usable on Uninorth machines but X11 output is still corrupted.
Do not match Uninorth bridges until we have a working KMS with AGP support for G4 machines. This allows us to enable agp(4) again for G5 machines which makes X11 usable on the Dual G5 with radeondrm(4).
Make carp_output() MP-safe.
Add UTF-8 support to uniq(1). Let -f recognize non-ASCII blank characters and let -s count characters rather than bytes.
In tmux(1), make input off flag (selectp -d) apply to synchronize-panes too.
Fix urtwn(4) on big-endian architectures.
Make ix(4) MP-safer.
Use pledge(2) in mknod(8).
In casin(3), casinf(3), and casinl(3), give correct results if the imaginary part is zero.
Fix the behaviour of csqrt(3): we should have csqrt(conj(z)) == conj(csqrt(z)).
Avoid modulo bias in the IPv6 stack.
In the scheduler, make the cost of moving a process to the primary CPU a bit higher. This is the CPU that handles most hardware interrupts, so by making it less likely that the softnet taskq runs on that CPU, most of the performance lost by "unlocking" network drivers is restored.
In acpithinkpad(4), add display brightness support, available on the last few ThinkPad generations. This fixes surprising brightness changes that would sometimes happen if you used the brightness keys or if the firmware decided to reset the brightness level for some other reason.
Update to xf86-input-synaptics 1.8.3.
Update to xf86-input-keyboard 1.8.1.
In libevent, prevent the dispatch loop from bringing down the entire process because of incomplete kqueue(2) support for various types of files and filesystems.
In awk(1) and npppd(8), remove modulo bias in the random number generator.
Add the _sndiop user and group in preparation of the sndiod(8) privsep.
In resolver(3), remove support for HOSTALIASES. It is incompatible with pledge(2).
In acpithinkpad(4), avoid panics on older ThinkPads when pressing the ThinkLight key.
In nc(1), print the certificate validity to the verbose output when using TLS.
Avoid grabbing the kernel lock in uvm_unmap() if we have an interrupt-safe map.
In syslogd(8), unbreak adding mark messages to log files.
Remove the Class 3 Public Primary Certification Authority root certificate from /etc/ssl/cert.pem, per recommendation of Symantec/VeriSign.
In asmc(4), add more temperature keys found in MacBook Airs (6,1 and 7,2) and MacBook Pro (10,2).
Update to unbound 1.5.7.
In mountd(8), fix issues with adding and deleting exports when (re)reading the exports(5) file.
Add UTF-8 support to fmt(1). The -c option is not yet handled.
Do not panic when trying to delete an non-existing route with ART.
In relayd(8), handle the HTTP PATCH request correctly.
In tmux(1), allow list-keys and list-commands to be run without a running server.
In acpithinkpad(4), handle the keyboard backlight found on newer Thinkpads.
Add initial 802.11n support to iwm(4).
In mailwrapper(8), update the default MTA reference to smtpd(8).
Use pledge(2) in dhcpd(8).
In acpithinkpad(4), support ThinkLight.
In eigrpd(8), introduce a new command to show traffic statistics.
In tmux(1):
Allow prefix and prefix2 to be set to None to disable.
Add the key-table option to set the default key table for a session.
In smtpd(8):
Bump Diffie-Hellman parameterss to 2048.
Allow overriding the default cipher-suite in smtpd.conf(5).
Remove CA from pki and no longer allow specifying a CA with "pki" keyword. Introduce "ca" keyword to smtpd.conf(5) allow specifying a custom CA.
On sgi, adjust IPI numbers to get the interrupts working.
Avoid dhclient(8) from hanging during boot when the attempt to configure the address fails without dhclient(8) realizing it.
In asmc(4), enable keyboard backlight support.
In wsconsctl(8), add the keyboard backlight variable.
In wscons(4), add new ioctls to control keyboard backlights.
In smtpd(8), implement senders map.
In ieee80211(9):
Finish support for receiving 11n A-MPDUs.
Add 11n/HT negotiation fixes.
Makes 11n negotiation with Linux iwlwifi AP succeed.
In smtpd(8), prepare for support of wildcard CA and DANE.
In fdisk(8), open the disk read-only if none of -i, -e or -u are specified.
Fix a bug where exhausting a tmpfs filesystem leads to kernel panic.
In fdisk(8), add -v to force the display of both GPTs and the MBR.
In libevent, do not print to stderr.
Use pledge(2) in spamlogd(8).
In dhcpd(8), fix a bug where the default-lease-time, max-lease-time, bootp-lease-length statements specified in dhcpd.conf(5) were being ignored.
In nsd(8), disable the database file by default.
Update to nsd 4.1.7.
In ehci(4), work around Nvidia EHCI controllers bugs.
In vmctl(8), allow the "id" argument to be a number or a VM name.
In smtpd(8), add -F to run in foreground while logging to syslog.
In makemap(8), add -U, like the sendmail makemap.
In ssh(1), do not try to load an SSHv1 private key when compiled without SSHv1 support (bz#2505).
Remove now unused plain DES from the kernel crypto framework, including the crypto accelerator drivers.
Use pledge(2) in dhclient(8).
In bnx(4), mark the start routine as MP-safe.
In ksh(1), fix moving trough and deleting multibyte characters in emacs command-line editing mode.
Install the OpenBSD::Pledge Perl module.
Remove plain DES encryption: remove support for DES-CBC encryption in ESP and in IKE main and quick mode from the kernel, isakpmd(8), ipsecctl(8) and iked(8).
In libcrypto, change the counter argument for CRYPTO_chacha_20 to be 64-bits on all platforms. This avoids truncation of the counter on 32-bit platforms.
Do not trigger a KASSERT() if the route we're trying to remove does not exist and we get another matching one instead.
Do not trigger a KASSERT() when destroying/detaching an interface with RTF_CLONED routes attached.
In inteldrm(4), enable support for 3840x2160 60Hz SST.
Rework the if_start MP-safe serialisation so it can serialise arbitrary work.
In malloc(3):
Add random "canaries" to the end of an allocation. This option is enabled with the malloc.conf(5) "C" flag.
When writing junk to freed chunks (current default behavior), check that the junk is still intact when freeing the delayed chunk in order to catch a potential use-after-free.
Add xenstore(4), a driver for XenStore, the configuration storage.
Add xspd(4), a driver for the XenSource Platform Device.
Add xen(4).
In iwm(4), avoid synchronization issues with the firmware that might cause association to be aborted or stop the interface from working until reboot.
Rewrite getusershell(3) to avoid the possibility of overflow.
In doas(1), add -a to specify a non-default authentication style.
In vmctl(8), add the "console" subcommand to connect to a specified VM console by id.
Use pledge(2) in spamd(8).
In tmux(1), add a hooks infrastructure, basic commands, and a couple of client hooks.
Add UTF-8 support to wc(1): amongst other things, add -m for character counting.
Add the root certificate for COMODO RSA Certification Authority to /etc/ssl/cert.pem.
In calendar(1), add -w to display the day of week.
In vmd(8), fix reloading after a previous load error.
In vm.conf(5), allow unquoted slashes in strings. This also allows pathnames to be concatenated with macros.
Merge makemap(8) into smtpctl(8).
In tmux(1), fix bell indicators across detach.
Update to freetype 2.6.2.
In azalia(4), enable snooping on Intel 100 Series HDA.
In ichiic(4), attach on Intel 100 series.
In nc(1), make the random sequence of ports less biased.
In vmm(4), prevent panics caused by opening /dev/vmm in the case of an unsupported configuration or in case vmm0 did not attach.
In ifconfig(8), remove the "txpower" option. It is not relevant anymore.
In newfs(8) and newfs_ext2fs(8), avoid out-of-boundary access on illegal command line arguments.
In the libc locale code, validate input files to prevent out of boundary accesses.
In vmctl(8), print the TTY in the status output.
In vmm(4), restore VMM mode after resume from suspend/hibernate.
In vmd(8), terminate all running VMs on startup: it is not possible to pick up state of "zombie" VMs yet.
In as(1), implement the .inst assembler directive for arm.
Ensure the same CPU numbering is used for the kern.cptime2 sysctl as for kern.proc. This fixes an issue in top(1) where a CPU would seem to be idle even though a thread was reported to be running on it.
In ssh(1), prefer rsa-sha2-512 over -256 for hostkeys.
Update termtypes.master to upstream terminfo-20151128.
In rc.conf(8), merge "multicast_router" and "multicast_host" into a single "multicast" configuration variable.
In bnx(4), make the interrupt handler MP-safe, and perform RX and TX completion outside the kernel lock.
Make pppx(4) packets with npppd(8) through the device. This makes pppx(4) work with pipex.enable=0. Also fix tun(4) not to pass the packets to pipex(4) when pipex.enable=0.
Do not loop on EAGAIN in imsg_read(3); return the error instead. This fixes spinning relayd(8) processes seen on busy TLS relays. Adjust all imsg_read(3) consumers accordingly.
Use pledge(2) in ospfd(8).
Let acpicpu(4) enable the deeper C-states for AMD Family 12h and later processors.
Add an rc(8) script for vmd(8).
In cap_mkdb(1), remove -i.
In ssh, implement SHA2-256 and SHA2-512 for RSASSA-PKCS1-v1_5 signatures for user and host auth.
In vmctl(8), add -c to the "start" subcommand to automatically connect to the VM console after startup.
Add a few kernel lock improvements in the network stack.
5.7 and 5.8 RELIABILITY FIX: a NULL pointer deference could be triggered by a crafted certificate sent to services configured to verify client certificates on TLS/SSL connections.
A source code patch is available for 5.7 and 5.8.
Add a fix for OpenSSL CVE-2015-3195 and one for OpenSSL CVE-2015-3195.
In vmctl(8), re-add the "load" and "reload" commands.
Re-enable acceleration on Broadwell.
Revert xenocara/driver/xf86-video-intel/src/sna/sna_accel.c r1.6 that partly disabled acceleration on Broadwell. The "blt" codepath is not tested well and makes X crash.
Replace vmmctl(8) with vmctl(8).
In smtpd.conf(5), introduce the "limit session" keyword instead of using fixed values in smtpd(8).
In pppx(4), avoid a kernel panic when enqueueing an mbuf chain.
Use pledge(2) in ssh(1).
In vmd(8), add -D and -f.
Add support for an optional vm.conf(5) file in vmd(8). This file will replace vmm.conf(5) in vmmctl(8).
In netstat(1), print the interface index; its name is no longer available.
In myx(4), use an MP-safe start routine.
Add etherip(4).
Add UTF-8 support to rs(1).
Allow network interfaces to provide an MP-safe start routine.
Use the ncurses files in /usr/share/terminfo/* instead of using the custom BDB terminfo(5) databases.
In rebound(8), when running without net, prevent the resolver from having to wait for timeout when queries cannot be forwarded.
In vi(1), after inserting a backslash, don't treat ^H ^? or ^U as special cases.
In doas(1), provide a custom password prompt that includes username and host.
In route(8), print the interface index which is part of the route msg header.
Add privsep and pledge(2) to vmd(8).
In relayd(8), improve the algorithm distributing client sessions over hosts.
In spamd(8), fix STARTTLS support.
In rc(8), fix a bug where it was no longer possible to add shlib_dirs using rc.conf.local(8).
In the installer, improve GPT handling.
On octeon, enable the DR1 region even with 32-bit page table entries.
In azalia(4), fix the speaker audio on IDT 92HD75B3/4 codecs with HP subids.
In cut(1), add UTF-8 support. Implement -c and -n options, and let -d option accept a multibyte delimiter character.
In unbound(8), fix a file descriptor leak in the parent process.
In azalia(4), add an unmute quirk for IDT 92HD75B3/4 codecs with HP subids. This is required to get speaker audio on the HP Elitebook 2540p.
Use pledge(2) to ssh-agent(1).
In Xserver(1):
Make DRI2 work on OpenBSD where we don't have support for DRI3 yet.
Enable glamor on architectures where we have OpenGL.
In ppb(4), properly condigure bridges left unconfigured by the system firmware. This makes the Apple Thunderbolt Giabit Ethernet adapter work when inserted at boot time.
Enable the GSE interrupt on Broadwell. This fixes ACPI brightness control on the MacBookPro12,1 and 3rd generation Lenovo X1 Carbon.
In pcidump(8), print PME# state together with the PCI power state when enabled/asserted.
Add UTF-8 support to cut(1) and ls(1).
In smtpd(8), add received-auth parameter to listener to identify authenticated sessions in locally appended "Received" header when enabled.
Fix an issue with gcc(1) on i386 which in turn fixes the Mesa i965 dri module on i386.
Fix bridge(4) to forward broadcast/multicast frames from gif(4).
In bgpd(8), fix rdomain setups.
Remove the aviion and the solbourne platforms.
Add separate users and groups for tftp-proxy(8) and ftp-proxy(8) so that they don't share the same ones.
In fdisk(8), make -i zap any undesirable GPT hanging around, just like the reinit command does.
In rtadvd(8), fix dynamic prefix tracking.
In smtpd(8):
Support user+tag expansion in aliases.
While delivering to lmtp or mda, accept the optional "as user" parameter in smtpd.conf(5).
Fix IPv6 address parsing in smtpd.conf(5).
Allow the use of the tls+backup:// schema in smtpd.conf(5).
Remove table-passwd, table-sqlite and table-ldap.
In ubcmtp(4), add support for the touchpad found on the MacBookPro12,1.
Use pledge(2) in adventure(6), backgammon(6), boggle(6), bs(6), canfield(6), fish(6), gomoku(6), grdc(6), mille(6), prime(6), ssh-keysign(8), trek(6) and wump(6).
Make it possible to detach bge(4).
Add OpenBSD::Pledge, a Perl interface to pledge(2).
In xhci(4):
Make the integrated SD card reader in the MacBookPro12,1 attach.
Make hotplugging USB 3.0 devices work on the MacBookPro12,1.
Convert the simple list of multipath route entries used by ART kernels to a SRP list. This makes the rtable_* layer MP-safe.
Remove stdethers(8) and stdhosts(8).
In atc(6), battlestar(6) and robots(6), use pledge(2) and move the score file to the user's home directory.
Use pledge(2) in cribbage(6).
In make(1), fix duplicate targets in target list.
In skeyinit(1):
Use pledge(2).
Allow the -n flag to work in -s mode.
In installboot(8), back out pledge(2).
Mark the interrupt handler for pci (but not sbus) attached gem(4) as MP-safe.
In ssh-keygen(1), do not leak a temporary file if there is no known_hosts file.
In sshd(8), don't include port number in tcpip-forward replies for requests that don't allocate a port (bz#2509).
In doas(1), don't write past the end of a buffer after reading too long a line from the configuration file.
On sparc64, don't panic in pmap_enter() if we deplete the pool of pv entries and the PMAP_CANFAIL flag is set.
In pci(4), do not report a bus conflict for bridges that are left (partly) unconfigured by the system firmware.
In df(1), avoid reading past the end of a buffer.
In ugen(4), attach the iPhone 6.
In snake(6), use pledge(2) and move the score file into the user's home directory.
Change the command-line syntax of vmmctl(8).
In efiboot, avoid setting mode to GOP if the mode is unchanged. Also don't panic if the setting mode is failed.
Remove rpc.yppasswdd(8).
Use pledge(2) in installboot(8), login_radius(8) and scp(1).
In chpass(1), login_chpass(8) and passwd(1), delete YP password related code.
In rpc.bootparamd(8), delete YP lookup code.
In syslog.conf(5), disable the *.emerg block by default.
Automatically start vmm(4) when the first VM is created and after the last VM is terminated. This removes the explicit enable and disable cmmands from vmmctl(8) and vmm.conf(5).
In fdisk(8), when prompting for a GPT partition type, use the partition's current type as default; and when prompting for an LBA, show the minimum and maximum values in the prompt.
In ifconfig(8), fix breakage when re-configuring an IPv6 static address.
Stop building Mesa on alpha on mips64 because of gcc and binutils issues.
Replace IFF_OACTIVE manipulation with MP-safe operations.
Add sendsyslog2(2). This makes it possible to remove the direct /dev/console opening code from libc.
On libc, use reentrant versions of getpwnam(3), getpwuid(3), getgrnam(3), and getgrgid(3) within libc to avoid reusing the static buffers returned by the non-reentrant versions.
In tmux(1):
Show libevent version in showmsgs -I.
All kill-session -C to clear alerts in all windows.
Remove the -I part of show-messages.The server start time can be accessed with a new start_time format.
In pciide(4), allow to reliably found disks on Xserve G5 by increasing the delay between the PHY reset and the status check for ServerWorks SATA.
In vi(1), turn on filename tab completion by default.
In telnet(1), don't support repeated connections. This avoids problems with pledge(2).
In atc(6), battlestar(6), hack(6), phantasia(6), robots(6), sail(6), and snake(6), remove the setgid bit.
In canfield(6), remove the setgid bit and move score files into the user's home directory.
Use pledge(2) in fdisk(8) and mount(8).
Remove support for "lookup yp" in resolv.conf(5). It is incompatible with pledge(2).
In vmd(8), add the -d and -v flags.
In vmd(8), add support for logging to stderr or syslog, and to run it in foreground with -d option.
In sndiod(8):
Ensure the /tmp/aucat directory gets the right permissions.
Exit cleanly in the case where the clock is ticking because of a MMC start message.
Remove the unused -M option.
Attach zs(4/macppc) as "zs" rather than "zsc".
In bc(1), fix printing of non-ASCII characters in an error message and fix a number of problems caused by invalid input.
In vmmctl(8), add support for vmm.conf(5).
Add vmd(8) and vmmctl(8).
In tmux(1), if display-time is set to 0, show status messages until a key is pressed.
In ospfctl(8), print what ospfd(8) thinks is connected by adding a "C" to the nexthop output.
In ospfd(8), improve ABR support especially for self-originated stub networks. This solves the last issues when using ospfd(8) in multiple areas.
Import mesa 11.0.6.
Use pledge(2) in nsd(8).
In pcidump(8), print the PCI power state when -v is given.
In fdisk(8), bring GPT partition editing into line with MBR partition editing.
Fix inteldrm(4) on recent Apple hardware.
Make sdhc(4) work with 64-bit memory BARs such as those found on the new PC Engines apu.
In tail(1), improve fixes for running without -f.
In vmm(4), do not create a VM if vmm mode hasn't been enabled.
In fdisk(8), fix several nits in editing partitions.
In mandoc(1), fix multiple issues regarding process group and signal mask handling.
Remove login_tis(8).
In the installer, do not auto-skip X sets on systems without wscons(4).
In em(4), revert all the changes to run the tx completion path without holding the kernel lock. It causes "watchdog timeout" problems.
In cvs(1), disable server-side pserver support.
In sppp(4), remove support for SPPP with framing. It is no longer used.
In ed(1), restore the user-defined prompt (specified with -p) when it was turned off and then on again with "P".
Use pledge(2) in monop(6), skeyinit(1), tetris(6), trpt(8), worm(6) and worms(6).
Repair most cases of "tail +n" usage.
In tmux(1), only assume pasting with at least two characters.
Update to flex(1) 2.5.39 and add various improvements including use of pledge(2).
In fdisk(8), when an existing partition is modified in LBA mode, ensure that the partition table is marked dirty so that it gets written when "quit" is issued.
In tail(1), allow tailing multiple files.
Use pledge(2) in OpenCVS.
In the kernel, don't try and wakeup other threads to handle pending work when it is known there's only one thread in the taskq.
In newsyslog(8), back out pledge(2).
In ssh(1), disallow ConnectionAttempts=0.
In vi(1), remove cscope support.
In the installer, set "prohibit-password" in sshd_config(5) instead of "without-password".
Use pledge(2) in fvwm(1), FvwmPager(1), hotplugd(8), locale(1), sensorsd(8).
Add icdb, the Internal C Database: a simpler replacement for the old Berkeley DB code.
Add getpwnam_shadow(3) and getpwuid_shadow(3). These functions will always open the secure/shadow/master password files.
In cnmac(4/octeon), fix the reception of short non-IP packets by accounting of padding with dynamic short packets.
In tmux(1), add the "s/foo/bar/:" prefix for formats to substitute bar for foo.
Fix a regression introduced by the rtalloc(9) rewrite where only the first route of a multipath chain had a valid next hop and could be used.
In ssh-keygen(1), fix -l for private keys. This was broken in support for multiple plain keys on stdin.
In sndiod(8), disable -L (networking) until privilege separation is implemented.
In fdisk(8), since -e edits the on-disk information, remove GPT and re-read it from disk if appropriate.
In crontab(1), check for setgid(2) failure before executing editor and warn if the exec of shell + editor fails.
In ntpd(8), fix memory leak in remove a constraint code path.
In trpt(8), remove the setgid bit.
In tetris(6), remove the setgid bit and move score files into the user's home directory.
Remove lptest(1), pac(8) and yptest(8),
In bge(4), clear the interface timer when shutting down the interface so the watchdog timer doesn't fire a few seconds later.
In snmpd(8), exclude sensors marked as invalid from the sensors MIB.
Use pledge(2) in cvs(1), getconf(1), newsyslog(8), sa(8) and showmount(8).
Unbreak next-hop caching on multipath setups: when multiple gateways are in use, the next-hop entry might not be on the same interface.
In bgpd(8), in the session engine, handle loss of the pipe with a normal shutdown of sessions and exit.
In ssh-keygen(1), allow fingerprinting from standard input and support fingerprinting multiple plain keys in a file and authorized_keys files (bz#1319).
Use pledge(2) in calendar(1), gprof(1), mail(1), and shutdown(8).
In at(1), make -l comply with POSIX.
Fix a panic that happens when radeomdrm(4) detaches because the hardware couldn't be initialized properly.
In pvbus(4), fix a panic on i386 under VMware.
Add the QuoVadis root certificates to /etc/ssl/cert.pem.
In sshd(8), add a new authorized_keys option "restrict" that includes all current and future key restrictions. Also add permissive versions of the existing restrictions.
In ssh_config(5), add the AddKeysToAgent option.
In intel(4), partly disable acceleration on Broadwell. This avoids use of the render ring which gets stuck after resume.
In ieee80211(9):
Add 11n HT support.
Expose 11n mode to the ifmedia layer and introduce the concept of MCS. Make sure 11n features are enabled only if media type is autoselect or 11n.
Add support for 11n mode to the rate adaptation (AMRR) code.
In Xorg(1), remove the -configure option. It has been broken for a long time.
Use pledge(2) in locate(1), tput(1), tset(1), and user(8).
In rdistd(1), support hardlinked symlinks.
In the binutils tools:
Don't try to preserve setuid bits.
Always strip off setuid/setgid bits when creating copies of files.
In ieee80211(9), fix CCMP (WPA2) in preparation for 11n.
Remove libocurses. It is no longer used.
In mandoc(1), fix a bug where hitting Ctrl-Backslash (= SIGQUIT) in the less(1) process spawned by man(1) causes man(1) to die uncleanly leaving behind its temp files, and kill less(1) uncleanly leaving the terminal in the wrong state.
Use pledge(2) in ar(1), info(1), infokey(1), install-info(1), ldconfig(8), ldd(1), makeinfo(1), objcopy(1), texindex(1), vi(1), xconsole(1) and ypldap(8).
In rs(1), fix a bug with -z where every column was at least as wide as the previous one.
Update to xkeyboard-config 2.16.
In telnet(1):
Remove S/Key support.
Remove support for !shell.
Remove the tracefile command.
Remove the debug command.
Set rtable(4) on the whole process, not only in the socket.
Use pledge(2).
Use pledge(2) in as(1), fdisk(8), gcc(1), ld(1), nm(1), rarpd(8), tcpbench(1) and tftp-proxy(8).
In crypto(9):
Remove unused non-HMAC versions of MD5 and SHA1.
Remove unused ARC4.
In tmux(1) add the window_visible_layout format.
In file(1), with -L, make links actually be followed.
Add vmm(4). It is disabled by default.
In ssh, send SSH2_MSG_UNIMPLEMENTED replies to unexpected messages during KEX (bz#2949).
In sshd_config(5), support "none" as an argument for ForceCommand and ChrootDirectory (bz#2486).
In ssh-keygen(1), for -L, support multiple certificates (one per line) and reading from standard input.
In nc(1), with -V, set rtable(4) on the whole process, not only in the socket.
Revert sys/dev/pci/if_bge.c r1.372. It causes regressions on some models.
In dhclient(8), when link loss is reported, cancel any active timeout and wait for link to return.
Use pledge(2) in cwm(1) and fingerd(8).
In fdisk(8):
Avoid problems with pathological input during edit operations by never attempting to use data past the end of the input.
Refresh the in-kernel copy of the disklabel from the disk after writing the new GPT.
Let "reinit mbr" zero existing MBR and GPT partition information before constructing default MBR.
In cron(8), move the socket to /var/run/cron.sock.
In tmux(1):
Remove the mouse-utf8 option. Instead, always turn on UTF-8 mouse if the client says it supports UTF-8.
Support UTF-8 key bindings.
Remove the mouse_utf8_flag.
Remove the utf8 and status-utf8 options. Make tmux only a UTF-8 terminal.
In fdisk(8), display the full disk size when editing GPT, not the truncated MBR size. Display the "disk too large" message only when no GPT is found.
Use pledge(2) in mg(1), spamdb(8), xclock(1) and Xserver(1).
In mg(1), clear the mini buffer once a question has been displayed.
In ehci(4), mark the interrupt handler IPL_MPSAFE.
Add /dev/vmm.
In bge(4), unbreak the BCM5704 A3 found on some Xserve G5 (RackMac3,1).
In fdisk(8), make GPT on large disks work.
In rs(1):
With -H, do not overrun a static buffer on files longer than 4 kB.
With -K, do not print bogus blank lines in case of premature EOF.
Reduce the memory overhead of our ART routing table from 80M to 70M compared to the existing radix-tree when loading ~550K IPv4 routes.
In newfs(8), remove TMPDIR support.
Install ikeca.cnf by default as ikectl(8) now requires CA-specific sections not present in the general openssl(1) cnf files.
In libc:
Exclude the hidden atexit(3) and pthread_atfork(3) stubs from static links that don't use them.
Split the intra-thread functionality from kill(2) into its own system call thrkill(2). This eliminates the need for locking in pthread_kill(3) and simplifies pthread_cancel(3).
5.7 and 5.8 RELIABILITY FIX: insufficient validation of RSN element group cipher values in 802.11 beacons and probe responses could result in system panics.
A source code patch is available for 5.7 and 5.8.
Use pledge(2) in less(1) and nohup(1).
In less(1), do not save history in secure mode.
Use the correct rdomain(4) when sending gre(4) keepalive packets.
In ehci(4), fix a NULL dereference in case a Root Port Hub interrupt is handled before the soft-interrupt has been established.
In efiboot, avoid a crash when attempting to calculate the header checksum.
Make HFSC work on age(4) and vr(4).
Add the _vmd user and group for the forthcoming vmd(8) daemon.
Revert gnu/usr.bin/gcc/gcc/cp/g++spec.c r1.2 and r.13 in order to go back to the default upstream behaviour when linking a shared library with c++. It is no longer necessary to behave the same as g++ 2.95.
In ssh-keyscan(1), add -c to allow fetching certificates instead of plain keys.
In ncr53c9x, when issuing a non-dma command, set a length variable to 0 upfront to avoid problems on command completition interrupt.
In ssh(1), fix an OOB read in the packet code.
Fix possible system panics due insufficient validation of RSN element group cipher values in 802.11 stack.
Fix a use-after-free in fwvm(1).
In sdmmc(4), always claim to support sector mode for eMMC. This allows BeagleBone Black boards with Micron eMMC to work.
In less(1), remove LESSGLOBALTAGS support.
In efiboot, make "machine disk" show EFI info instead of BIOS info.
In restore(8), make hardlinks of symlinks work.
In efiboot, disable red-zone since EFI is running with a different ABI. This may fix an issue when loading a compressed kernel on MacBooks.
Update to xserver 1.17.4.
Use input handlers for bridge(4). This allows more flexible configurations with vlan(4) and bridge(4) on top of the same physical interface.
Use pledge(2) in xterm(1).
In hypotf(3), fix wrong magic numbers in scaling causing incorrect results for large and small values.
In getty(8), remove ppplogin support.
Radically improve the performance of bgpd(8) filters.
In less(1):
Remove support for "!" to run a shell command.
Remove LESSCHARDEF support.
Remove unused charsets and LESSCHARSET support.
Make HFSC work on de(4) and ie(4/sparc).
In ld.so(1), fix unloading of load groups when the last reference was not on the load_object but rather some descendent.
On i386, fix a regression by reading/writing to CR4 register only if the processor has this capability.
Stop creating the directory /usr/share/nls. If the user does not specify a NLS path, fail early in catopen(3).
In res_init(3), restrict the number, size and address family of nameservers. This fixes a crash in sendmail. Only programs that use the bind resolver internals directly are affected.
Replace less(1) with the cleaned-up fork of less 458 maintained by Garrett D'Amore.
Update to unbound 1.5.6.
Update to nsd 4.1.6.
In the loongson installer, ensure that the partition containing the boot blocks is recognized on the eBenton EBT700.
Use pledge(2) in httpd(8), ikectl(8), slowcgi(8) and wall(1).
For USB mice with wheels, check for the W direction at AC Pan input.
In pkg_add(8), tweak dependencies handling. This might fix some infrequent bugs.
In tcpdump(8), fix a segmentation fault by capping the GRE packet len to tcpdump's snap len.
In tmux(1), pass through right click if mouse is on.
In smtpctl(8), implement the "uncorrupt" subcommand.
In smtpd(8), correctly handle messages that consist solely of headers and do not end with an empty line.
In km(4), match the temperature sensor in GX-412TC SOC.
In ipsecctl(8), decode Chacha20-Poly1305 when dumping SAs.
In iked(8), support Chacha20-Poly1305 for Child SAs.
Fix a potential use-after-free in pf(4).
Disable TCP/UDP TX hardware checksumming if an IPv4 packet contains IP options or if an IPv6 packet contains header extensions.
In rtadvd(8), recognize carp(4) interfaces in order to send the src lladdr option.
In fdisk(8), don't allow the user to enter GPT partition names too large to fit in the GPT partition structure. Also avoid running off the end of the name buffer.
Prevent a panic caused by an infinite recursion in the network stack.
In efiboot, use "Loaded Image Protocol" instead of "Loaded Device Path Protocol" to find the boot device since the MacBook does not support the latter protocol.
In snmpd(8), don't lose the ARP entries when updating an interface.
Add Chacha20-Poly1305 to the OpenBSD Cryptographic Framework and enable it in the software crypto driver and the IPsec/ESP and PF_KEY frameworks.
In whois(1), add -I to use whois.iana.org (root zone database).
In tcpdump(8), print RDNSS nameserver addresses and option names for some other known options that are not otherwise decoded yet (DNSSL, route information).
In libssl, add EVP_aead_chacha20_poly1305_ietf(3), a ChaCha20 with a Poly1305 authenticator for IETF protocols.
Remove ARP load-balacing in order to simplify making ARP MP-safe.
In xhci(4), mark the interrupt handler as IPL_MPSAFE since it only schedules a soft-interrupt.
In ikectl(8):
Accept an "ocsp" option when creating certificates to set the extended key usage for OCSP signing.
Let openssl(1) add valid signed certs to the index file which is required to use the builtin openssl OCSP server.
Switch from SHA-1 to SHA-256.
Introduce ml_purge(9) and mq_purge(9) to free all mbufs on an mbuf list or queue.
In intel(4), fix rendering problems on Broadwell GT3 (Iris 6100/Iris Pro 6200).
In re(4), expand the rx and tx rings so that deviced needing more packets per interrupt can use them.
Rework the netstart(8) script.
In inteldrm(4):
Prevent the desktop "Iris Pro Graphics 6200" from being misidentified as ULT.
Make the mobile "Iris Graphics 6100" be correctly identified as being a ULT part.
Use pledge(2) in bgpctl(8), ldapctl(8), ldapd(8), m4(1), skeyaudit(1) and skeyinfo(1).
In ntpd(8), revert some parts introduced with the original server rtable support, so servers with numeric IP addresses won't be skipped.
In mg(1), mark *Completions* buffer as read-only.
In httpd(8), revert usr.sbin/httpd/httpd.c r1.42 (fix PATH_INFO for "/" requests). It breaks slowcgi(8) and php-fpm setups.
In mandoc(1) do not access a NULL pointer when a .Bd macro has no arguments at all.
In ntpd(8), remove support for sending status reports to syslog on SIGINFO.
In cvs(1), fix a crash in pserver mode when CVSROOT/passwd contains an old DES password.
Fix interaction between inteldrm(4) and efifb(4).
In mg(1), fix opening dired from the command line.
In libcrypto, add support for the Poly1305 Message Authentication Code.
In asmc(4), enable the keyboard backlight led earlier to avoid a race.
In ping(8), back out chacha.
In rebound(8), print stats upon SIGUSR1.
In smtpctl(8), implement the "discover" subcommand.
In ssh(1), fix "PubkeyAcceptedKeyTypes +..." inside a Match block.
Make inteldrm(4) attach to pci(4) instead of vga(4). This is needed for machines where Intel graphics isn't the primary graphics device and on systems with UEFI firmware that put the device in non-VGA mode.
Use pledge(2) and privsep in rdate(8).
Use pledge(2) in at(1), cap_mkdb(1), cron(8), crontab(1) and last(1).
In cnmac(4/octeon), enable TCP/UDP checksum offloading on packet transmission.
Support backspace in softraid(4) boot passphrase prompt.
In lpd(8), remove pidfile support.
Use pledge(2) in apm(8).
In resolv.conf(5), remove support for "[addr]:port" syntax from the "nameserver" line.
In smtpd(8), support aliases(5) entries resolving to maildir:/path.
Add a rcpt-to paramater to smtpd.conf(5).
In unbound(8), don't use a pidfile by default.
In relayd(8), change cipher-server-preference to be on by default.
Document eigrpd.conf(5).
In eigrpd(8):
Print a missing "metric" before the actual metric when printing a redistribute line.
Whenever a summary route is activated, install a respective blackhole route in the FIB.
In pkg-config(1), do not reject properties with no whitespace after the colon.
In repquota(8), don't allow -a together with specifying filesystems.
Fix makemap(8) for values containing a "#".
In dhclient(8), add the ability to use option 119 ("Domain Search") if supplied by the server.
In fdisk(8), add GPT editing.
Remove rip6query(8).
In crontab(1), diff(1) and sendbug(1), remove TMPDIR support.
In top(1), print the uptime too.
In httpd(8), fix PATH_INFO for "/" requests.
In mrouted(8), pppd(8), rarpd(8), rbootd(8), smtpd(8), wsmoused(8), ypserv(8), remove pidfile(3) support.
In smtpd(8), avoid a potential double free.
In ssh(1), expand tildes in filenames passed to -i before checking whether or not the identity file exists in case the shell doesn't do the expansion (bz#2481).
In route6d(8), fix a memory leak.
In ssh(1), do not prepend "exec" to the shell command run by "Match exec" in a config file (bz#2471).
In tmux(1), extend the modifiers allowed before formats.
Use pledge(2) in rtadvd(8).
In cron(8), ftpd(8), route6d(8) and rtadvd(8), remove pidfile support.
Fix installboot(8) on i386/amd64 when softraid is on top of GPT.
Enable asmc(4) on i386.
In asmc(4), fix seldomly seen "comm collision" errors.
In disklabel(8), remove support for the "b0" and "b1" disktab(5) capabilities.
Do not expose nd6 randomid's to userland via ioctl(2).
In ping6(8), remove -g after IPV6_NEXTHOP removal.
In ip6(4), remove IPV6_NEXTHOP implementation.
In telnet(1), remove IP Source Route support.
In ping6(8), implement ping(8)'s -L option.
Remove the NLS support from libc messages.
In tmux(1), remove TMPDIR support.
Use pledge(2) in dig(1), host(1), nslookup(1), quiz(6),
In eigrpd(8), keep conversions between the real and composite bandwidth consistent with what Cisco does.
In ssh(1), fix keyscan output for multiple hosts/addresses on one line when host hashing or a non standard port is in use (bz#2479).
In tcpdump(8), avoid a segfault with malformed DECnet packets.
In ping6(8), move the output of the src address to the -v option. This syncs the output with that of ping(8).
Ignore Router Advertisment's current hop limit.
Wait a short while between setting a USB device's address and reloading its descriptor. This fixes a flaky attach of USB devices on the Thinkpad Helix 2.
In syslogd(8), stop the chrooted child from trying to load the default CA file.
In bgpctl(8):
Print if a route is redistributed or not at least for static and connected.
Allow other MRT message types to be parsed.
Add pair(4), a vether-based virtual Ethernet driver to interconnect rdomains and bridges on the local system.
In cnmac(4/octeon), make use of hardware RX checksum validation.
In catopen(3), verify that an opened message catalog is valid. This avoids integer overflows and out-of-boundary accesses.
Fix renaming in the root directory of FAT filesystems.
In syslogd(8), if a write to a tty is blocked, use an event instead of forking.
In tmux(1), add a format for scroll position.
In ndp(8), don't do DNS lookups when -n is specified.
Split up tun(4) into tun(4) and tap(4).
In ntpd(8), no longer allow upstream NTP servers to be in multiple routing tables.
Don't enable /etc/fonts/conf.d/10-autohint.conf by default. It causes problems with glyphs exceeding the cell size.
Introduce a new sysctl(3) NET_RT_IFNAMES that returns only ifnames to ifindex mappings.
Use pledge(2) in ldpctl(8), ldpd(8), route(8),
Translate calendar files to UTF-8.
On amd64 and i386, enable viornd(4) on RAMDISK_CD.
In eigrpd(8), fix some bugs in the handling of the RTM_GET and RTM_CHANGE messages.
In mandoc(1), avoid a NULL pointer dereference.
Stop linking iked(8) statically. This has benefits like having full ASLR and taking take advantage of libcrypto updates.
Use pledge(2) in addr2line(1), iked(8), login_yubikey(8), nc(1), objdump(1), ps(1), readelf(1), strings(1), su(1), top(1) and w(1).
In bgpd(8), revert usr.sbin/bgpd/parse.y r1.282 that allowed for empty blocks for peers. It broke the grammar by introducing shift/reduce errors.
In tmux(1), fix "tmux killw\; detach".
In bgpd(8), log and ignore received empty route messages.
Use pledge(2) in doas(1), hangman(6) and renice(8).
In libssl:
Avoid a (harmless) read and write overrun in the RC4 code.
Avoid a segfault in "openssl gendh 0".
In ssh(1), fix a memory leak in an error path.
In tmux(1), add a default binding for mouse wheel up to scroll into history.
In ssh(1) and moduli(5), remove Diffie-Hellman moduli entries below 2048 bits.
In eigrpd(8), add support for route summarization.
Add a new getsockopt(2) option IP_IPDEFTTL to retrieve the default TTL.
In write(1), fix writing to other user's tty.
Use pledge(2) in rmt(8).
Replace dnssocket() and dnsconnect() with a SOCK_DNS flag on socket(2).
In vr(4), fix 802.1p VLAN priority code points for VLAN_HWTAGGING.
In tcpdump(8), avoid division by zero by adding an explicit check for a malformed AS segment.
In eigrpd(8), fix a use-after-free.
In iked(8), unbreak OCSP support.
Use pledge(2) in nice(1), radiusctl(8) and radiusd(8).
In libssl, stop supporing legacy time formats that OpenSSL supports.
In eigrpd(8), fix memory leaks in error paths.
In iked(8), remove IKEv1 support.
In radiusd(8), avoid a NULL dereference.
Update to freetype 2.6.1.
In bge(4), move rxeof and txeof outside the kernel lock.
In drm(4), backport a fix to prevent machines from hanging or resetting.
In crunchgen(8), avoid integer overflow with very large files.
Use pledge(2) in bgplg(8) and inetd(8).
Add two new system calls: dnssocket() and dnsconnect().
In drm(4), don't poke registers on the wrong PCI device. This should fix machines such as the Asus EeePC 701.
Use pledge(2) in csh(1), sort(1), savecore(8) and tmux(1).
In ping6(8), implement -w like in ping(8).
In bgpd(8), do not accept fds on the control socket.
In snmpd(8), tighten up the control socket: do not allow users to terminate the daemon by sending corrupted imsgs.
In xinit(1) and xdm(1), don't automatically launch dbus as part of the default user sessions.
In ssh(1), increase the minimum modulus that will be sent or accepted in diffie-hellman-group-exchange to 2048 bits.
Unbreak route6d(8): adding unneeded space to its cmsg item breaks sendmsg(2).
In sysmerge(8), drop usage of TMPDIR.
In ping6(8):
Move -t and -w functionality to -a.
Remove RFC 4620 support.
In iwm(4), fix occasional firmware errors while bringing the interface up or scanning.
In nlist(3) and other nlist implementations, validate parsed ELF values to prevent out of boundary accesses.
In hack(6), disable the "!" command to escape to a shell.
In patch(1), add native support for ed(1)-style diffs. This allows for a stronger pledge(2).
Use pledge(2) in cu(1), getty(8), pwd_mkdb(8), route6d(8), vipw(8) and zic(8).
Add the _rebound user and group in order to improve privdrop for rebound(8).
Use pledge(2) in ftp(1), identd(8), login_token(8), rebound(8) and sdiff(1).
Import rebound(8), a lightweight DNS proxy.
In disklabel(8), remove -B.
In x99token(1), avoid a race between fopen(3) and fchmod(2). This prevents an attacker to open an old file with wrong permissions before the secret is written into it. It also guarantees that a new file with correct permissions is created.
On vax, use MI installboot(8) instead of "disklabel -B" to install boot blocks.
Add proper support for vax to installboot(8).
Use pledge(2) in x99token(1).
Remove the "!" (subshell) and "v" (edit) commands from the ramdisk more(1) command.
On octeon, let the rx path of cnmac(4/octeon) run without the kernel lock.
In smtpctl(8), allow "all" as an argument for the "resume envelope", "pause envelope" and "remove" subcommands.
In tcpdump(8), fix a crash that occurs when printing the filename in a malformed NFS request packet.
5.6, 5.7 and 5.8 RELIABILITY FIX: the OBJ_obj2txt function in libcrypto contains a one byte buffer overrun and memory leak.
A source code patch is available for 5.6, 5.7, 5.8.
In tar(1), use a strict $PATH to run the (de)compressors.
In newsyslog.conf(5), allow the wheel group to read /var/log/maillog.
RELEASE CD ISSUE: the "src.tar.gz" file on the source tree was created on the wrong day and does not match the 5.8 release builds.
A replacement file is available for 5.8.
5.6, 5.7 and 5.8 RELIABILITY FIX: a problem with timer kevents could result in a kernel hang (local denial of service).
A source code patch is available for 5.6, 5.7 and 5.8.
In ping6(8), use ping(8)-like semantics for -I.
In sort(1), copy permissions and ownership when -o will override an input file.
In fsck_ext2fs(8), fsck_ffs(8) and fsck_msdos(8), only accept one filesystem/device as argument for checking.
Use pledge(2) in banner(6), bcd(6), caesar(6), factor(6), fsck_ext2fs(8), fsck_ffs(8), fsck_msdos(8), login_passwd(8), login_reject(8), morse(6), number(6), pig(6), pom(6), ppt(6), rain(6) and random(6).
In ugen(4), prevent a NULL-pointer dereference when closing a ugen(4) node in case the kernel failed to change the interface of a device.
In mg(1), check if a file name can be extracted from a line before marking for deletion.
In sort(1), ignore the setuid/setgid/sticky bits when copying the permissions of an input file to the new output file.
In ping6(8), remove the -b flag.
Make sure RTF_LOCAL route entries are UP when added to the tree.
Use pledge(2) in crunchgen(8), lockspool(1), mklocale(1), netgroup_mkdb(8), newfs_ext2fs(8), nologin(8), smtpd(8). syslogc(8) and yes(1),
In mg(1), when refreshing a dired buffer, avoid losing the files marked for deletion.
In ping6(8), deprecate and remove the -W flag.
Make ftp(1) non-static, allowing for better ASLR.
In ntpd(8), improve the privsep design. In particular, remove the delays that have been introduced by expensive constraint forks.
Use pledge(2) in apropos(1), config(8), dev_mkdb(8), help(1), kvm_mkdb(8), mailwrapper(8), makewhatis(8), man(1), mandoc(1), mesg(1), mkuboot(8), mksuncd(1), skey(1) and whatis(1).
In bgpd.conf(5), allow the blackhole well-known community to be given by name.
In bgpctl(8), add "best" as an alias for "selected".
Use pledge(2) in ac(8), biff(1), clri(8), clri(8)/pax(1)/tar(1), tunefs(8), stty(1) and zdump(8).
In pkg-config(1), handle comma-separated list of arguments.
Disallow "rm -rf /".
Always set the timeout at least one tick in the future for EVFILT_TIMER to avoid looping in softclock().
In bc(1), avoid fork/execve of dc(1). This allows a for a strong pledge(2).
Use pledge(2) in apply(1), arithmetic(6), awk(1), dvmrpctl(8), encrypt(1), env(1), fsirand(8), fstat(1), gencat(1), infocmp(1), kill(1), ln(1), lndir(1), pflogd(8), pkill(1), rcs(1), rpcgen(1), scan_ffs(8), sdiff(1), sendbug(1), spell(1), tftpd(8), tic(1), time(1), tsort(1), ul(1), unexpand(1), which(1), xargs(1), yacc(1) and ypcat(1).
In asmc(4), add location to the fan description.
In mg(1), make functions that accept multiple iterations via C-u N, honour 0. Except C-k which has a defined behaviour.
Make tcpdump(8) print more information from the HT Capabilities element.
In syslogd(8), if it is started with -S, it accepts TLS connections to receive encrypted messages and the server certificates are taken from /etc/ssl.
Use pledge(2) in cmp(1), du(1), eigrpctl(8), eigrpd(8), getcap(1), getent(1), ksh(1), lex(1), ospf6ctl(8), relayctl(8) and relayd(8).
In ksh(1), disable the mknod builtin.
In comsat(8), remove NFS spool support.
In syslogd(8), add the -S option to accept TLS connections and receive encrypted messages.
In smtpd(8), turn the local enqueuer setgid(2) _smtpq and restrict access to the offline queue.
In mg(1), fix a line number bug when calling onlywind().
Use pledge(2) in comsat(8), ospfctl(8), ripctl(8), syslogd(8) and tradcpp(1).
Rename tame(2) to pledge(2).
On amd64 and i386, increase the HEAP_LIMIT from 0x90000 to 0xA0000, to fix an out-of-heap when booting on a large block size (32K) partition.
In tame(2), add the "mcast" request that exposes a small set of multicast (IP_MULTICAST_IF, IP_ADD_MEMBERSHIP and IP_DROP_MEMBERSHIP) join operators.
In ksh(1), don't open history files that don't belong to the user.
Lock the page queues by turning uvm_lock_pageq() and uvm_unlock_pageq() into mtx_enter() and mtx_leave() operations.
Use tame(2) in make(1), portmap(8) and signify(1).
In trunk(4), if the mbuf has a valid flowid, use it instead of using siphash24 and a bunch of header fields we have to parse the mbuf for.
Unlock the softnet task.
In httpd(8), fix an fd leak if a socket connection fails.
In snmpd(8):
Use correct return value for IP-MIB::ipForwarding.
Fix getbulk requests for multiple OIDs.
Add initial support for UEFI/GPT installs to the installer.
In ssh(1), include PubkeyAcceptedKeyTypes in "ssh -G" config dump.
In g++(1), correct handling of enum attributes.
In tmux(1), fix a couple of memory leaks in error paths.
Use tame(2) in cp(1), ctags(1), from(1), getopt(1), head(1), htpasswd(1), lastcomm(1), logname(1), look(1), mkdir(1), mktemp(1), nl(1), paste(1), pr(1), printenv(1), readlink(1), rev(1), rmdir(1), split(1), tee(1), tftp(1), tty(1), users(1) and uudecode(1).
In installboot(8), add initial support for installing UEFI boot files to a GPT EFI System Partition.
In ssh(1), make it possible to use tun(4) and tap(4) networking as non-root user if device permissions and interface flags are pre-established.
In em(4), fix the watchdog timeouts reported by various people.
In skeyinit(1), remove the -C option that converts an S/Key database to the new format.
In smtpd(8), fix a memory leak in an error path.
Use tame(2) in csplit(1), date(1), ed(1), join(1), jot(1), lam(1), lock(1), openssl(1), printf(1), tail(1), touch(1), tr(1), units(1), unvis(1) and what(1).
Fix cu(1) to make xmodem work with -d.
In diff(1), remove the non-standard -l flag that pipes the output through pr(1).
On the alpha ramdisk, remove cd(4).
Use tame(2) in bgpd(8), cal(1), col(1), colrm(1), column(1), comm(1), cut(1), deroff(1), diff(1), diff3(1), dirname(1), expand(1), fgen(1), find(1), fmt(1), fold(1), hexdump(1), id(1), indent(1), kdump(1), logger(1), nm(1), rs(1), stat(1), unifdef(1), vis(1) and write(1).
In disklabel(8), remove -B support on landisk. It has been superseded by MI installboot(8).
On landisk, use MI installboot(8) instead of disklabel(8) -B to put boot blocks on installation media.
In fdisk(8), enhance -g to create a default GPT label in addition to the protective MBR. If -b is specified, an EFI System partition of the requested size is created.
In eigrpd(8):
Add option to configure or disable the DUAL active timeout.
Ignore IPv4 TLVs in IPv6 instances and vice-versa.
When the SIA state is declared for a given destination, reset the adjacency with the unresponsive neighbor(s).
Add the _eigrpd user and group for eigrpd(8).
In rcctl(8), make it possible to give the same action to several daemons at once.
In asmc(4), check the validity flag earlier and do not try to attach invalid (non-existing) keys.
In ahci(4), fix a memory leak in an error path.
Use tame(2) in banner(1), dd(1), df(1), dmesg(8), expr(1), file(1), ls(1) and pwd(1).
Enable eigrpd(8) and eigrpctl(8).
In dc(1):
Remove the "!" command. This makes dc(1) better tameable.
Use tame(2).
On octeon, fix a memory leak in an error code path.
Use tame(2) in cat(1), echo(1), test(1), uname(1) and wc(1).
Add IPv6 transport for pflow(4) data.
When multiple vxlan(4) interfaces are configured with same VNI, select the interface whose tunnel destination corresponded to the incoming packets' source address.
In libssl, fix reference counting and memory leak in error path in an error path.
Use tame(2) in acpidump(8), arp(8), basename(1), chflags(1), finger(1), grep(1), gzip(1), kdump(1), leave(1), md5(1), ntpctl(8), ntpd(8), patch(1), ping(8), ping6(8), script(1), sed(1), sleep(1), sshd(8), tcpdump(8), traceroute(8), uniq(1) and whois(1).
Revert the mmap(2) unlock. It causes vnode-related panics on several architectures in the codepath that implements mmap(2).
In iked(8):
Fix EAP (user-based auth) with IKEv2 in El Capitan.
Remove MD5 from the default proposals
Fix EAP (user-based auth) with IKEv2 in El Capitan.
In pfctl(8), make the "-s all" option show queues.
In libssl, conform with RFC 5280 for times allowed in a X.509 certificate.
In snmpd(8), mitigate the risk of user-injected file descriptor leakage from the optional world-writable restricted control socket.
Add ktracing of argv and envp to execve(2), with envp not traced by default.
Add eigrpd(8) (and eigrpctl(8)), an Enhanced Interior Gateway Routing Protocol daemon.
5.6, 5.7 and 5.8 SECURITY FIX: multiple reliability and security issues in smtpd(8).
A source code patch is available for 5.6, 5.7 and 5.8.
In smtpd(8):
Do not allow connection IDs to wrap and collide with another active connection ID. This allows a local user to force the daemon to exit.
Fix a stack-based buffer overflow in the token expansion code of the (unprivileged) lookup process. This allows a local user to crash the server or potentially to execute arbitrary code.
Allow reading of imsg while discarding fd's when reading from a context where we don't expect/want to receive one. This prevents a local user from exhausting resources and causing smtpd to hang by crafting valid imsg that don't expect a descriptor but passing one anyway.
Prevent users from playing hardlink/symlink/mkfifo games with their offline messages and ~/.forward files. This allows a a local user to hang smtpd or even reset chflags and read the first line of an arbitrary file.
Do not exit on unexpected causes of SIGCHLD. This allows a specially crafted mda to cause smtpd to exit.
Make uid checking on ~/.forward files more strict. This avoids users from creating hardlink to root-owned files and leaking the first line.
Fix a use-after-free and out-of-bounds memory reads in the (unprivileged) lookup process. This avoids crashes or potential arbitrary code execution.
Revert src/sys/net/route.c r1.245. It breaks some NFS setups.
Update to tzdata2015g from ftp.iana.org.
In asmc(4), relax vendor comparison to match variations found in older models such as the MacMini1,1.
On alpha, make the pmap (more) MP-safe by protecting both the pmap itself and the pv lists with a mutex. This should make pmap_enter(9), pmap_remove(9) and pmap_page_protect(9) safe to use without holding the kernel lock.
In iked(8), fix several interoperability issues:
If we don't get a (valid) CERTREQ but a CERT, respond with a local CERT that was selected based on our own policy instead of leaving it out. This seems to be valid with the RFC that makes the CERTREQ optional and allows to ignore it or to apply an own policy.
Don't reject an "empty" CERTREQ (one with no CA hashes), instead treat it as if no CERTREQ were received. This may fix other interoperability issues.
In sndio(7), remove support for the AUCAT_COOKIE environment variable.
Update to pixman 0.32.8.
On amd64, add asmc(4), a driver for the Apple System Management Controller (SMC).
Implement a new "prot_exec" tame(2) request.
In em(4), run the tx completion path without the kernel lock held.
Do not try to refetch a route at the L2 layer if the given one is down and always return EHOSTUNREACH.
Remove Cisco HDLC support from sppp(4). It is no longer used.
Update to libxcb 1.11.1.
Hopefully fix the stability problems seen on SandyBridge and up after the PPGTT code got enabled.
On mips64, fix the R8000 kernel to have all their m[ft]c0 instructions correctly wrapped.
In oce(4), unlock interrupt handler rx path with intr_barrier(9).
In mg(1), fix the location of the cursor when opening a directory using filevisit, findvisitalt and poptofile.
Add support for the Huawei K4511 3G to umsm(4).
5.7 and 5.8 SECURITY FIX: an incorrect operation in uvm could result in system panic.
A source code patch is available for 5.7 and 5.8.
In mmap(2), remove the no longer needed kernel lock in the fixed case.
Add the UVM_FLAG_UNMAP flag to indicate to uvm_map(9) that it should unmap to make space.
5.7 RELIABILITY FIX: various problems were identified in relayd.
A source code patch is available for 5.7.
Fix a panic in inteldrm(4).
In tame(2), make using the "/" path work.
In mg(1), make dired mode treat a double "/" in a path like fundamental mode.
In inteldrm(4), no longer support the "Quanta Transcode" device. This avoids incorrectly overriding the generic match for the HD Graphics P4000.
Enable monitor hot plugging for the framebuffer console.
Add IP26 kernels and boot blocks to the installation media.
In iwm(4):
Fix problems occurring when doing bsd.rd upgrades.
Fix the bug where the firmware stops passing traffic after the MAC address is changed.
Add the Ed25519 SSH host key to changelist(5).
Make carp_input() MP-safe.
Prevent X from crashing the kernel when attaching inteldrm(4) fails.
Protect the list of free map entries with a mutex. This should fix crashes on i386.
Unlock the mmap(2) system call.
Add transpose-paragraphs to mg(1).
Correct a range problem in citrus-utf8 version of wcrtomb(3) in order to match RFC 3629.
In inteldrm(4):
Make the PPGTT code work. This seems to fix the caching issues on Broadwell.
Don't hardcode the type of BARs to be 64-bit.
On octeon and sgi, restore the interrupt mask even on secondary CPUs. This prevents the IPI from being left disabled accidentally on a non-primary CPU which will cause the system to hang eventually.
On octeon, let MP-safe interrupt handlers run without the kernel lock.
In mandoc(1), fix multiple aspects of SYNOPSIS .Nm formatting.
In tmux(1), if the terminal has colors=256, only try to use setaf/setab if they exist.
Fix inteldrm(4) on the GM45 chipset.
In slowcgi(8), output the contents of the environment in debug mode.
In inteldrm(4):
Disable IPS for now. It causes unsynched displays after waking it from standby or after VT switches.
Backport some of the Broadwell fixes.
In tmux(1), free the history when it is cleared.
Ensure the GPT header size is in a valid range before checksumming it. This prevents a crash.
Ensure that RTF_LOCAL route entries always stay UP, even when a link state change occurs.
In inteldrm(4):
Properly implement waitqueue_active().
Enable MSIs on hardware that supports it.
In disklabel(8), expunge VAX SMD special handling.
On sgi, properly handle IP26 streaming cache controller bus error interrupts.
In mg(1), fix where the cursor is positioned after expunging files.
In trunk(4), avoid theoretical m_pullup(9) mishandling by delegating the mbuf reclaiming to the PDU and marker input routines.
In tmux(1), fix two fd leaks and a memory leak.
In ssh(1), add the CertificateFile option to explicitly list a certificate (bz#2436).
In mg(1):
Fix multiple iterations of kill-paragraph.
Add mark-paragraph.
Update inteldrm to the code from Linux 3.14.52.
In ld.so(1) on alpha, avoid write-protecting .data when it shares a page with the GOT and PLT.
On mips64:
When inserting an entry for a KV1 address, avoid having to write back the ASID value.
Use conditional instructions when picking a random TLB set number.
In iwm(4):
While not associated, pass the broadcast ethernet address to the firmware, rather than zeros.
Properly reset the RX ring by clearing RX buffer status memory.
In cwm(1), avoid unnecessary pointer querying.
In trunk(4):
Remove watchdog code since it doesn't do anything useful.
Adapt code to avoid locking protection in the future.
In mg(1), fix line number handling in dired delete functions.
Prevent the efiboot and kernel memory regions from overlapping. This fixes a problem where the kernel fails to boot.
When a connected route is deleted, pass the corresponding priority to rtrequest1(9). Otherwise the route will remain attached to a stale ifa.
In mandoc(1), account for significant whitespace when determining the width of a tag.
Remove SHA-0 and MD2 remnants from openssl(1).
In bpgd(8):
Allow for empty blocks for peers.
Allow to log all updates sent from an individual peer, and, when applied to a group, to disable logging on a sub-member of the group.
In tmux(1), reset the alerts timer always on activity.
Fix a couple of libtool(1) issues.
In mg(1), fix behaviour when opening the same directory twice in dired mode.
On alpha, powerpc and mips64, fix membar positioning in mtx_enter_try(9) and mtx_leave(9).
In ssh(1), fix a possible hang on closed output (bz#2469).
On sparc, increase MAXTSIZ to 64 MB. This is required for gcc/gnat.
Fix suspend on machines with em(4) now that it uses intr_barrier(9).
In syslogd(8), avoid potential event loss due to misuse of TLS read and write in libevent.
Enable IP26 builds.
On mips64, correctly compute the userland pte index in a pte page in the userland tlb miss handler.
Add the -d, -r and -w flags to rmt(8) to make it run in a restricted mode.
In ld.so(1), delete the bind lock, the callback, the sigprocmask stub.
On powerpc, make sure PROT_EXEC is set on the GOT for BSS-PLT binaries.
In em(4), avoid using a mutex in the rx completion path. Instead rely on intr_barrier(9) to avoid having the interrupt handler touch the rx data structures while the interface is brought down.
On sgi, go back to the previous approach when managing individual HPC DMA descriptors: provide an optional storage for a copy of the descriptor in the "sync" (fetch) function, and use the returned address afterwards.
In sysmerge(8), in case of a hard error, avoid missing files for comparison at the next run.
Fix an uninitialized variable in iec(4/sgi).
In tmux(1), let the -l option of join-pane and split-window apply to the new pane instead of the old one when -b is also specified.
Revert r1.25 of src/lib/libssl/src/crypto/bn/bn_print.c. It introduces a NULL dereference.
Implement SRPL_INSERT_AFTER_LOCKED(9).
Make vmx(4) interrupts MP-safe.
Back out r1.125 of src/sys/uvm/uvm_km.c. This avoids page queue corruptions and the resulting uvm_pmr_size_RB_REMOVE_COLOR() faults.
Update to xserver 1.17.2.
In cc(1), enable -msecure-plt by default on powerpc.
In od(1), fix two bugs in the [+]offset[.][Bb] XSI offset syntax.
Fix an uninitialized variable in bios(4) and in arp(4).
Fix an overlapping memcpy(3) in vdsp(4).
In ugen(4), fix a panic when using pcsc-lite.
Unbreak booting from GPT partitions.
Add tls_config_insecure_noverifytime(3) to libtls to disable certificate validity checking.
In LibreSSL, add support for disabling certificate and CRL validity checking.
Remove SHA-0 and MD4 support from libcrypto.
Put the 12x22 font on alpha and macppc installation kernels.
In netstart(8), only print the "IPv6 autoconf" line if there are interfaces to configure.
In ssh-add(1), when adding keys to the agent, don't ignore the comment of keys for which the user is prompted for a passphrase.
In tmux(1), add the -e flag to copy-mode to exit copy mode when scrolling off the bottom.
In libcrypto, check ECDH output buffer length and avoid truncation.
Introduce intr_barrier(9), an interface that guarantees that an interrupt handler that was running has finished.
Introduce sched_barrier(), an interface that acts as a scheduler barrier in the sense that it guarantees that the specified CPU went through the scheduler.
Add the Certplus CA root certificate to /etc/ssl/cert.pem.
In nc(1), display negotiated TLS version and cipher suite in verbose mode.
In libcrypto, add OPENSSL_cpu_caps(), to return the currently running CPU's specific hardware capabilities users of libcrypto might be interested in.
In LibreSSL, if there is hardware acceleration for AES, prefer AES as a symmetric cipher over CHACHA20. Otherwise, prefer CHACHA20 with AES second.
Make if_get() and vlan_input() MP-safe using SRPs.
On arm, use kbind(2) for lazy binding GOT/PLT updates.
In openssl(1):
Fix the "prime" command: when checking a decimal number for primality, do not unnecessarily convert the original decimal number to hex in the output. Hex numbers explicitly specified with -hex remain unchanged.
Add support for AEAD algorithms to the "speed" command.
Remove support for the SSLEAY_CONF environment variable.
Add an ftpproxy6 rc script. ftp-proxy(8) can only open one listening socket at a time, so a second instance of the daemon is required.
Introduce if_input_local(), a function to feed local traffic back to the protocol queues.
In ping6(8), avoid out-of-boundary access on invalid or short packet reads.
In ddb(4), show the non-idle, on-proc threads before showing the stack trace when panicking.
In em(4), add support for the 88E1512/88E1514 phys.
Update to sqlite3 3.8.11.1.
In acpicpu(4), work around broken AML by treating FFH vendor 8 the same as vendor 1 (Intel).
Make the powerpc pmap (more) MP-safe. This should make pmap_enter(9), pmap_remove(9) and pmap_page_protect(9) safe to use without holding the kernel lock.
Add TLS support to nc(1).
Remove RTF_XRESOLVE support from route(4), route(8), netstat(1) and route6d(8).
Introduce refcnt, a wrapper around reference counts.
Introduce rtref(9), a function to increment a reference to a routing entry, and use it in rtable_lookup().
In "ifconfig media", stop advertising media with fixed data rates on wireless interfaces.
Don't generate ICMPv6 packets with incorrect checksums for dropped IPv6 packets.
Fix a use-after-free in route(4).
In openssl(1), remove the engine command and parameters.
Save/restore MSR_APICBASE during suspend/resume. This re-enables x2apic on the application processors at resume.
Remove the unfinished che(4) driver.
In libtls, do not match a wildcard against a name with no host part.
Make room for media types of the future: extend the ifmedia word to 64 bits.
In netstart(8), set "inet6 autoconf" individually on interfaces that have rtsol set in hostname.if(5). Previously, netstart tried to configure them all at once.
Take a first step towards making ix(4) MP-safe.
In mkhybrid(8), cast the isascii(3) argument to unsigned char, to avoid undefined behaviour.
In qle(4), don't copy more sense data than we have space for. This avoids a crash when trying to talk to a Sun STK6140 (although it still doesn't work).
Spoof EFI SYSTEM GPT partitions as MSDOS partitions, as is done with MBR EFI SYSTEM partitions.
No longer grab the kernel lock in the interrupt-safe multi page backend allocator implementation. This is possible because that interrupt-safe uvm maps are now properly locked.
Fix a NULL dereference in bpf(4).
Fix hangs on systems with more than 7 interfaces.
In ddb(4), add ps/o to display just the non-idle on-proc threads.
Don't spoof GPT OpenBSD partitions. Simply record and use the first one found, as is done in MBR processing.
Change device locators type from int to long, for the sake of 64-bit ports without proper device trees.
In ssh(1), expand %i in ControlPath to UID (bz#2449).
In openssl(1), make the s_time command perform a proper shutdown by default. This allows s_time to benchmark a full TLS connection more accurately. The new -no_shutdown flag restores the previous behaviour.
In syslogd(8), instead of having global variables containing the libevent structures, allocate them with malloc. This makes the address space layout more random.
Add kqueue(2) support for wsmouse(4), wskbd(4) and wsmux(4). This is needed for the libinput port.
In LibreSSL:
Remove support for DTLS_BAD_VER. We do not support non-standard and incomplete implementations.
When loading a DSA key from a raw (without DH parameters) ASN.1 serialization, perform some consistency checks on its "p" and "q" values, and return an error if the checks failed.
Enable GPT in the GENERIC kernel.
Avoid division by zero in fsck_ext2fs(8).
Use the full IPv6 source address (rather than only half of it) as input for the syn cache hash. Using only half the address makes it trivial to create syn cache collisions.
Move the if input handler list to an SRP list.
In libc, add hidden _libc_FOO aliases for the system call stubs.
Various cleanups of the ksh(1) code.
Several libtls API changes and improvements.
In tmux(1), add session_last_attached time and format.
Remove link_addr(3).
Add locking for interrupt-safe maps.
In mkhybrid(8), fix various buffer overflows and make it work on unsigned char platforms.
Add client certificate support to libtls.
Move to the next tame(2) API. The flags are now passed as a very simple string.
Introduce reference counts for interfaces. The new if_put() function releases the reference acquired by if_get().
In ntpd(8), plug a memory leak in an error path.
Convert bpf to using an srp list for the list of descriptors.
Implement a singly linked list built with SRPs.
On powerpc, it is no longer needed to use mprotect(2) to take away PROT_WRITE. This fixes ld(1) -Z and paves the way for the new Secure-PLT ABI.
In binutils 2.17, force .ctors, .dtors and .got to be read-only for truly static binaries. This prevents W^X violations on architectures that need an executable GOT (basically BSS-PLT powerpc).
Prevent nc(1) from hanging when writing more than the low water mark of the socket write buffer.
In disklabel(8), avoid a SIGSEGV with FGJ malloc.conf flags when a template is used.
The default backend allocator implementation no longer needs to grab the kernel lock.
Build xf86-video-wsfb on amd64 and i386. It can be used by efifb now.
In efifb(4), make scrolling a bit faster.
Delete ktracing of context switches. It is unused and not particularly useful.
In smtpd(8), insert a Message-Id header if necessary.
In httpd(8), prevent a potential double free introduced in r1.64 of src/usr.sbin/httpd/server.c.
It is no longer necessary to grab the kernel lock for allocating and freeing pages in the (default) single page pool backend allocator.
In libc, fix aliasing of sys_errlist, sys_nerr, sys_siglist, and sys_signame to eliminate duplicate copies of the tables and get direct access internally.
In wsfontload(8), avoid a floating point exception when an invalid font width was specified.
On the minirootXX.fs and iso images, create an EFI system partition using fdisk(8) -b and put the UEFI boot loader on there.
Add support for QEMU PCI serial devices to puc(4).
In awk(1), revert srand() to its old behaviour with regard to what values it returns.
On sgi, remove the need for the memory controller to switch between "fast" and "slow" mode every time a DMA descriptor is updated.
Update to xterm 320.
In pms(4):
Improve tap-and-drag detection for ALPS touchpads.
Support Synaptics touchpads without W mode.
Use the new resolution framework for wrapping catopen(3), catgets(3) and catclose(3), and for dbopen(3).
In wscons(4), add support for xterm-compatible SGR escapes 39 and 49 (reset fg/bg colour to default).
Some symbol cleanup in libc.
In fdisk(8), add a -b option, to be used together with -i, to add a special boot partition on architectures that need it.
In audio(4), improve the search for candidates for the wskbd "record level" control. This may fix "record level" keys on certain keyboards.
In ugen(4), do not use an intermediary buffer on the stack of the caller when submitting a bulk write request. This means big bulk write requests are no longer split into multiple small transfers which libusb consumers do not expect.
Give every consumer of the radix tree a chance to explicitly initialize the shared data structures, instead of relying on another subsystem to do the initialization. ART kernels should now be fully usable because pf(4) and IPSEC properly initialize the radix tree.
In ssh(1) and sshd(8), plug minor memory leaks when options are used more than once (bz#2182).
In netstat(1), fix mbuf memory accounting after the recent *8 pool size change.
Fix a use-after-free in pflow(4).
Add support for the RTL8168H to re(4).
In libkvm, fix a race when fetching files from the kernel.
On i386, fix a race in pmap_page_remove_86() and pmap_page_remove_pae().
On amd64, fix a race in pmap_page_remove().
Adapt ping(8) to tame(2).
In dwc2, fix timeout-related crashes.
Again revert the two uses of rtisvalid(9). They break NFS.
In dwc2, avoid a possible lock recursion panic on transfer timeout.
Modify acpidump(8) to work on systems booted from efi boot.
Bring back the two uses of rtisvalid(9). The bug it exposed has been fixed.
Unconditionally set the RTF_UP flags when adding a route to the table. This makes dhclient(8)-configured default routes usable without relying on the link-state change hooks not present in RAMDISK kernels.
In ugen(4), do not use an intermediary buffer on the stack of the caller when submitting a read request. This means big read requests are no longer split into multiple small transfers which libusb consumers do not expect.
In smtpd(8), remove the session kicking mechanism until it is redesigned. It has an accounting bug leading to some legitimate sessions being kicked if they generate too many consecutive errors.
On sparc64, make pmap_kenter_pa(9) and pmap_kremove(9) MP-safe.
In syslogd(8), log a message about failed log attempts using sendsyslog(2).
Revert the two uses of rtisvalid(9). It breaks dhclient(8)-configured networks on RAMDISK kernels.
Add the uefi boot loader.
In ping6(8), display the correct source address when using a non-default routing table.
In pf(4), don't let route-to, dup-to and reply-to override the block action.
In syslogd(8), bind the *:514 UDP socket with SO_REUSEADDR.
On octeon, increase the transfer FIFOs for dwc2. This improves USB performance.
Convert the (cached) route entry checks in ip{,6}_output() to rtisvalid(9).
In doas(1), restrict the exec path only if the rule specifies a command.
Introduce rtisvalid(9), a function to check if a (cached) route entry can be used or should be released by rtfree(9).
Reject USB requests that could damage the bus integrity.
Fix a use-after-free in tame_namei().
On powerpc, make bus_dmamap_load_raw(9) respect the segment size constraint. This makes xhci(4) work on the G5.
In efifb(4):
Only advertise the color depth that is actually supported. This makes the xf86-video-wsfb driver work.
Map the framebuffer in write-combining mode. This significantly speeds up.
In static binaries, invoke kbind(2) once to disable it.
On m88k and sparc, use kbind(2) for lazy binding GOT/PLT updates.
It is no longer needed to hold the kernel lock for MP-safe bpfs (again).
Bring back the commit that makes bpf_mtap MP-safe by using srp, but now using srp_follow(9) to avoid races and corruption.
Add srp_follow(9) which is necessary to correctly order the taking and releasing of SRP critical sections in situations such as following a chain of data structures linked with SRPs.
In dhclient(8), accept multiple domain names in dhcp option 15 (Domain Name). This allows resolv.conf(5) "search" statements to be built with multiple entries.
In syslogd(8), don't truncate program names and hostnames in syslog.conf(5). This fixes matching with IP addresses if syslogd is started with -n.
In efifb(4), check the driver name so that the driver only attempts to attach when we actually want it to.
In binutils 2.17, raise the number of spare local GOT entries from 5 to 7. This fixes building liblto_plugin.so in the gcc 4.9 port.
In tame(2) mode:
Return EPERM for *chmod(2) if uid/gid change is not towards cr_uid/cr_gid (effective ids).
Consider getfsstat(2) an RPATH.
Rather than killing when *chmod(2) is asked to do setuid/setgid, clear those bits in the request and continue.
Do not install connected routes on loopback interfaces. This will allow systems with AUTOCONF'd addresses to see loopback connected routes in the routing table.
Fix a use-after-free in uow(4).
Compute the checksum before looping back the copy of an IPv6 multicast packet.
Add a framework for resolving libc namespace issues.
In gunzip(1) and uncompress(1), ignore setuid/setgid settings from a compress/gzip file.
In mandoc(1):
Don't die on an assertion if an .Fo macro lacks its mandatory argument.
Drop leading, internal, and trailing blank characters in \o (overstrike) escape sequences.
In ping6(8), remove RH0 support.
In ddb(4):
Automatically perform traces upon panic.
Shrink the message to save vertical space and point to http://www.openbsd.org/ddb.html.
In the kernel, use a global table for domains instead of building a list at run time.
Prepare the kernel to boot from UEFI. Amongst other things, add efifb(4).
Enable xhci(4) on macppc.
On macppc, map the whole config1 space based on the size read from the device tree. This allows supplementary PCIe cards to be properly detected and should prevent the kernel from faulting when reading unmapped PCI addresses.
Prevent cards with no midi connectors from attaching midi(4) devices.
For *chmod(2), allow S_ISTXT in tame(2) mode.
In mandoc(1):
Add a minimal implementation of the read-only number register \n(.$ which returns the number of arguments of the current macro.
Implement the escape sequence \\$* which expands to all arguments of the current user-defined macro.
Parse and ignore the escape sequences \, and \/.
Don't escape breakable hyphens yet when we have to reparse the text line because we spring an input line trap.
Create a miniroot for alpha.
In ws(4) and synaptics(4), read multiple events at once.
In tmux(1), check for name changes at most once every 500 milliseconds.
On sparc64, add support for switching CPUs in ddb(4).
On sh, use kbind(2) for lazy binding GOT/PLT updates.
Make gdb(1) work again on mips64 PIE binaries by making sure a reasonable 64-bit ABI is selected for 64-bit ELF files instead of a 32-bit ABI.
5.8 SECURITY FIX: LibreSSL 2.2.2 incorrectly handles ClientHello messages that do not include TLS extensions, resulting in such handshakes being aborted.
A source code patch is available for 5.8.
In apmd(8), log battery changes every 10%, not every 21%.
In envy(4), disable interrupts while the midi uart is not in use. This avoids generating unused interrupts when a chatty peripheral is connected but not used.
In binutils 2.17, add support for Irix-style "64-bit" archives.
Fix the build of the drm libraries on sparc64.
In envy(4), fix support of M-Audio Delta 44 cards that use different GPIO pins.
In tmux(1):
Allow environment variables in #{}.
Remove the lock-server option.
Plug a memory leak.
In binutils 2.17, do proper GOT slot accounting for symbols that were forced to be local.
Rework the UNIX domain socket garbage collector.
Make ld.so(1) work on hppa when _dl_bind_start gets hidden by the version script.
Fix rare occurrences of wrong floating-point values with MP kernels on Octeon.
On mips64, access the image of the floating point registers via p_md.md_regs instead of directly on the frame. This prevents updates from getting lost.
Ensure that syslogd(8) uses its original command-line arguments when it reloads its configuration and re-executes itself.
Prevent a socket that poll(2) reports is writable from becoming unwritable before write(2) is called.
In doas(1), add a type of "auth-doas" to the perm check to allow login.conf(5) fiddling.
In aucat(1), allow sparse blocks to be used as silence if samples are encoded as signed integers.
Remove SSLv3 support from LibreSSL.
On hppa, use kbind(2) for lazy binding GOT/PLT updates.
Add more overflow checks to libexpat.
5.8 SECURITY FIX: in sshd(8), inverted logic made PermitRootLogin "prohibit-password" unsafe.
A source code patch is available for 5.8.
Let MBR have priority over GPT.
Fix an alignment issue in bridge(4).
Add TIOCGETA to the TAME_IOCTL list. This is used by readpassphrase(3) and libcurses.
In radiusd(8), fix a use-after-free in an error path.
On alpha and mips64, use kbind(2) for lazy binding GOT/PLT updates.
Remove exect(2). It was unused and not portable across arches.
Hide many libc symbols that should not be used.
In cron(8), use ppoll(2) instead of poll(2). This avoids time conversion issues and eliminates a race condition that could delay SIGCHLD and SIGHUP actions.
In syslogd(8), don't use strlcpy(3) on strings that are not NUL-terminated. This prevents a crash.
Fix an out-of-bounds read in tmux(1).
On i386 and powerpc, use kbind(2) for lazy binding GOT/PLT updates.
On i386, enforce the kernel W^X policy by properly setting NX (as needed) for kernel text, PTEs, .rodata, data, bss and the symbol regions.
In restore(8), switch from utimes(2) to utimensat(2).
Re-enable GTP support on amd64 and i386.
Remove the -h option from radiusd(8).
Set the required IPL at the syn-cache pool instead of doing a splsoftnet() explicitly.
Prevent the kernel from removing connected (/64) routes as soon as it configures an AUTOCONF'd address based on a RA.
Fix the GPT code to work with non-DEV_BSIZE disks.
Fix a crash in tmux(1).
Fix a cheating bug in worm(6).
Fix a crash during "ifconfig bridge0 destroy".
In bm(4/macppc), work around slow transfer speed.
In cwm(1):
Don't allow freeze operations on fullscreen.
Implement _NET_CLIENT_LIST_STACKING.
Use IPL_SOFTNET protection for the pool. This fixes a panic.
In sysmerge(8):
Switch from /usr/share/sysmerge to /var/sysmerge.
Use /var/sysmerge/backups for persistent backups and keep three earlier rotations.
Avoid two potential double frees in tame(2).
Fix an fd leak in mv(1).
Apply a symbol export list to ld.so(1) with just the expected dl*() and the two symbols needed by gdb.
Make the Atom S1200 UART work.
In binutils 2.17, introduce -Bsymbolic-functions and related flags.
On amd64 and sparc64, use kbind(2) for lazy binding GOT/PLT updates.
In tame(2):
Perform maximum one cwd lookup.
Fix /tmp handling of unlink(2).
Update to xf86-video-geode 2.11.17.
In cwm(1), make CLIENT_STICKY apply to group hide/unhide rather than client hide/unhide.
In cc(1), make the -msecure-plt option work, which is necessary to generate Secure-PLT ABI code.
On powerpc, add support for the Secure-PLT ABI variant. This will give us better W^X support on powerpc.
In binutils 2.17, fully enable the Secure-PLT ABI.
In libc, restore codeset checking instead of silently falling back to ASCII.
Revert the bpf+srp commits. They cause problems in a bridge setup.
Move to the tame(int flags, char *paths[]) API/ABI.
Explicitly list the symbols permitted to be exported by libc. This will prevent unintentional additions in the future and sets the stage for reductions.
In doas(1), add the cwd context to the syslog entry.
Make urtwn(4) attach to Netgear WNA1000Mv2.
Ensure tls_read(3) and tls_write(3) always set outlen to zero on error.
In rc(8), properly handle double quotes in wsconsctl.conf(5).
In ctags(1), avoid calling system(3) for the -u option.
Update to libdrm 2.4.64.
In ssh(1), fix printing of HostKeyAlgorithms=+... when using -G.
In sshd(8), fix expansion of HostkeyAlgorithms=+...
Regenerate moduli(5).
In cwm(1):
Preserve the command list order from .cwmrc.
Hide the "term" and "lock" commands in the application menu.
Don't let _NET_WM_STATE_STICKY apply to the position and size of a window.
Add the client freeze extension to _NET_WM_STATE Atom, allowing flag to persist.
In em(4), run the part of the interrupt handler that does rx completion without holding the kernel lock.
In relayd(8), don't drop the reply messages when "check icmp" is used with many hosts.
In httpd(8), avoid an HTTP 405 error when using the WebDAV MOVE method.
Whitelist TIOCGPGRP (for tcgetpgrp(3)) in TAME_IOCTL.
In azalia(4), enable beep and CD controls on ALC292.
In sshd(8), fix the inverted logic that broke PermitRootLogin.
If we're allowed to try and use large pages, we try and fit at least 8 of the items. This amortises the per page cost of an item a bit.
In acpi(4), respect the access size when reading or writing to pci config space and ensure writes are properly aligned. This prevents panics and fixes at least battery status passthrough in vmware and the brightness keys on the X220.
In exp2(3), avoid left-shifting a negative integer.
In cwm(1), make the big move and resize bindings match what is in the manual page.
On octeon, use the IPD Clock Count register as a timecounter.
Import an alternative routing table backend based on Yoichi Hariguchi's ART implementation.
In identd(8) and tftpd(8), use SOCK_NONBLOCK to avoid a FIONBIO ioctl(2).
In identd(8), don't exit on unknown write(2) failures.
In azalia(4), enable audio on ThinkPad docks.
Reactivate tame(2) after release.
Remove unused vesafb code.
Update to libepoxy 1.3.1.
In LibreSSL, properly handle missing TLS extensions in client hello as a non-failure.
In ssh:
Don't call unlink(2) with an uninitialised path in ssh-keygen(1).
Don't free an uninitialised pointer in ssh(1).
Fix a double free in an error path.
Improve compat matching for WinSCP and add compat matching for FuTTY.
Enable the build of libOSMesa.
In pf(4), keep the IPv6 fragment size as chosen by sender also for packets that are routed on behalf of route-to.
Prevent mips64 FPU emulation from corrupting the page queues in MP systems.
Do not use a stale local address from the routing table. This prevents an interface address without interface pointer causing a uvm_fault.
On octeon, allow booting the SP kernel with a set of CPUs that does not contain core 0.
Unbreak the ikectl(8) "ca" commands after the removal of $ENV:: overwriting in LibreSSL.
Remove casts from many calls to malloc(3)-like functions.
Update the en_US.UTF-8 locale to Unicode 7.0.0.
Remove the last fragments of ST-506 support.
In whois(1), fix whois server detection for new TLDs.
Accept NULL pointers in rtfree(9). This will simplify upcoming conversions of rt_refcnt-- to rtfree(9).
5.6 and 5.7 SECURITY FIX: a change to sshd(8) resulted in incorrect permissions being applied to pseudo terminal devices, allowing local users to write to (but not read from) them.
A source code patch is available for 5.7.
No longer hold the kernel lock when calling bpf.
Make bpf_mtap MP-safe by using srp.
Avoid a TOCTOU problem in if_input in the bpf handling.
In tmux(1), come out of copy mode when history is cleared.
Add Loongson 3A support.
On alpha, consider ISA interrupts level-triggered if the SRM has explicitly set them up that way. This makes the kernel correctly run with serial console on the Multia.
Enable AlphaBook 1 support in alpha bsd.rd.
In smtpd(8):
Increase the size of acceptable headers lines.
Assume messages use 8-bit bytes by default.
Remove charsets other than UTF-8 from locale(1) output.
Load LC_MESSAGES locale only if the character encoding is UTF-8.
Disable support for loading LC_CTYPE locales other than UTF-8.
In swapctl(8), use vfork(2) & execl(2) instead of system(3) when invoking mount_nfs(8).
In myx(4):
Rework the way the packets on the rx rings are tracked.
Move to a per rx ring timeout for refilling empty rings. This gets rid of the locking around the refilling of the rx ring.
Use a single atomic op instead of one per packet when doing global tx free accounting. This allows packets to be sent a little faster.
On macppc and powerpc, replace the assembly mutexes with a C implementation.
Add ml_requeue(9) and mq_requeue(9) to prepend mbufs on lists/queues.
Move the locate(1) database build directory back to /tmp.
In ntpd(8), avoid calling poll() multiple times with no timeout, racking up CPU time for no real reason.
Add the -A, -P and -t options to nm(1).
Remove discarded attributes from disktab(5).
In rc(8), improve the sysctl.conf(5), mixerctl.conf(5) and wsconsctl(5) parsers.
Let pkg_create(1) recreate packages correctly.
Prevent an mbuf leak when no handler consumed that mbuf.
Fix a case where ceill(3) returns 1.0L.
Rework the /etc/rc script.
In tmux(1), add the "-of" suffix to the "left", "right", "up" and "down" special tokens for the pane index.
Plug two memory leaks in ti(4).
In acpihpet(4), check for a proper HPET period value during attach.
In file(1), add various improvements to the magic(5) parser.
In sndiod(8), don't make system calls when not being used.
Update time zone data to tzdata2015f.
Fix recent regressions in ugold(4).
Improve openssl(1) s_client -starttls xmpp support.
--------
Changes made between OpenBSD 5.7 and 5.8
In sshd_config(5), add prohibit-password as a synonym for without-password. Harden the option by allowing pubkey, hostbased, and GSSAPI authentication only.
In the installer, change the ssh root login question to use the "pubkeys-only" answer instead of "without-password".
In em(4), fix i217 PHY initialization. This fixes a problem where the receipt of packets would stop until the laptop battery is removed.
Skip C2 and C3 states from the FADT if the cpu doesn't have ARAT.
Do not save and restore a read-only capability register in acpihpet(4).
Fix clct(4) which was stuttering to the point of being useless.
In identd(8), don't die on socket operation errors.
In acpicpu(4), provide the fallback C1-via-halt even when _CST can't be evaluated. This fixes systems that only provide _CST for a subset of the CPUs.
Fix incorrect register offsets in acpihpet(4).
In binutils 2.17, work around a NULL dereference when a plt entry is not found.
In netstat(1), show TCP states that were hidden after netstat's conversion from kvm to sysctl.
In rarpd(8), fix a a regression introduced with the support of multiple connected routes.
In pf(4), avoid a panic triggered for a reply-to rule.
On mips64, avoid a potential deadlock by enabling IPIs before calling refreshcreds() in trap().
In httpd(8), fix a problem caused by r1.70 of server.c by re-enabling the buffer event only if it was disabled previously.
Enable the xdm installer question on macppc.
In radiusd(8):
Allow to start without -d.
Use syslog(3) instead of stderr.
Fix radiusd_module to stop when the daemon stops.
Fire pending events when the module starts.
Check the received packet length properly.
Fix a potential out-of-bounds read in fnmatch(3).
On armv7, make use of u-boot 2015.07's unified wandboard config to provide a miniroot to cover all current wandboard variations.
5.6 and 5.7 SECURITY FIX: the patch utility could become desyncronized processing ed(1)-style diffs.
A source code patch exists for 5.6 and 5.7.
Prevent substitution commands ("s///") with a newline in the replacement pattern from confusing patch(1) about the state of the ed(1) child process is in.
Turn off POOL_DEBUG for release.
In httpd(8), repair HSTS header output.
Fix pty permissions in sshd(8).
In the installer, make "without-password" the default answer to the "Allow root ssh login?" question.
Change the sshd_config(5) PermitRootLogin default to "without-password".
In ksh(1), fix the baskslash-escaped codes ("\nnn") usage in PS1.
Allow ssh_config(5) and sshd_config(5) kex parameters options be prefixed by a '+' to indicate that the specified items be appended to the default rather than replacing it.
In envy(4), properly recover when interrupts are blocked for too long. This fixes permanent distortion on MP systems.
In relayd(8), fix a bug where other than the last of multiple forward rules in http protocols would be ignored.
Add linker warnings in case SSLv3_{,client,server}_method are referenced.
On macppc, powerpc and socppc, do not save the status register and restore it for machine check exceptions.
Revert r1.289 of src/sys/dev/acpi/acpi.c (respect the access size when reading or writing to pci config space). It is locking up suspend or boot on some laptops.
Disable tame(2) with ENOSYS for upcoming release cycle.
Acquire the kernel lock in pmap_remove(). The reasons for this can't be stated as the committer has been asked to be polite in his commit message.
In azalia(4), rework the buffer position reporting code.
Build r300g and r600g on macppc and sparc64.
Make the Gallium r300 works on big-endian architectures.
In case the system misses enough audio interrupts for DMA pointers to wrap, recover by detecting and compensating for the missed interrupts. This fixes certain audio hangs on MP machines.
In libsndio and audioctl(1), use the new AUDIO_GETPOS ioctl instead of AUDIO_GETxOFFS and AUDIO_xERROR.
Add the AUDIO_GETPOS ioctl to fetch a snapshot of the 4 counters returned by AUDIO_GETxOFFS and AUDIO_xERROR ioctls.
In mandoc(1), remove the hack of scrolling forward and backward with +G1G. Instead, when using a pager, use another temporary file for the formatted page(s).
For unix domain sequenced packet socket pairs, don't report an EMSGSIZE error when the sent message was not too large.
In doas(1), fix keepenv handling.
In pkg_add(1), make -B cope with bad checksums.
Implement pf(4) divert-reply for raw sockets.
Do not link an ICMP6 socket to the pf state.
In httpd(8), add HSTS to fcgi responses.
Add ktracing of structs iovec, msghdr, and cmsghdr for {,p}{read,write}v(), sendmsg(), and recvmsg().
In gcc(1), implement support for __builtin_complex() to construct complex values. This is required by the upcoming libm work.
In disktab(5) on i386, fix geometry of rdroot entry.
Rather than disabling tame(2) to coredump, leave it enabled but flag that a coredump is happening. This improves behaviour while threaded.
On mips64, allow coalescing of IPI requests on mips64, to make IPI sending non-blocking.
In sshd(8), permit kbind(2) use in the sandbox.
Enforce tame(2) by disabling all TAME_ flags if tame_fail() is reached, not only if TAME_ABORT is set.
5.6 and 5.7 SECURITY FIX: the patch utility could be made to invoke arbitrary commands via the obsolete RCS support when processing a crafted input file.
A source code patch exists for 5.6 and 5.7. These patches remove the RCS support.
5.6 and 5.7 SECURITY FIX: a kernel memory leak could be triggered by an unprivileged user in a failure case when using execve under systrace.
A source code patch exists for 5.6 and 5.7.
In radiusd(8), make the modules priviledge-separated.
In tmux(1), make -q suppress ambiguous option warnings too.
In doas(1):
Implement command matching without execution.
Don't exit when the command line is too long to log.
In patch(1), remove support for automatically checking files out of RCS. This may cause patch to be tricked into running arbitrary shell code with a specially crafted diff.
In disktab(5) on amd64, fix ba# attribute in rdroot entry.
Update to terminfo 20150725.
On alpha, ensure pci_intr_map() will perform proper interrupt swizzling for devices behind a bridge, if the SRM didn't pick an interrupt line for them.
On alpha, adapt the way the vga(4) textmode is obtained in order to support the Alphabook 1.
Add basic support for tag priorities to mandoc(1)
In libsndio, fix an arithmetic mistake causing errors when there are more xruns on the record side than on the play side.
In sndiod(8), clear watchdog timer when device is closed. This fixes a use-after-free in error code paths when the device is closed before the audio is stopped.
Improve syntax error reporting for doas.conf(5).
Prevent a use-after-free in bnx(4).
In pkg_add(1), change the expansion of %m and %c in installpath to the snapshots folder during -beta.
Revert attempted GPT code cleanup.
In httpd(8), escape the " character in the authentication realm.
Make npppd(8) use libradius.
Disable GPT support. It appears to create broken spoofed labels for empty disks.
Implement quoting support in doas.conf(5).
In tail(1), fix a memory leak when -r is used with anything but regular files.
Slam signal handlers harder in tame(2).
Plug a memory leak in execve(2) with systrace(4).
Generate new moduli for ssh.
In security(8), don't risk blocking when reading untrusted user files and for additional safety against race attacks, make sure they are regular files.
Switch pvbus(4) to fully dynamic autoconf.
Add mpw(4) support to ifconfig(8).
In tame(2), always permit kbind (for dynamic linking) and add __thrsigdivert to the SELF list like the other threading calls.
Add a -C option to doas(1) to check config files without running.
In acpi(4), respect the access size when reading or writing to pci config space. This fixes battery status passthrough in vmware.
Add argument matching support to doas(1).
In ldpd(8):
Improve handling of addresses on ldpe.
Add configuration reload support.
Record all fields of the received label mappings.
Add VPLS signaling support.
Fix several IPC synchronization issues.
Improve the show lib command.
Re-enable the reload command.
Introduce two show commands for l2vpns.
Add radius(8) and radiusctl(8).
On amd64 and i386, add pvbus(4), a pseudo-bus to attach non-PCI paravirtual devices and buses.
In mandoc(1), call the pager without the -T option if the temporary file cannot be created.
Add the radius library. This will be used by the RADIUS server and client programs to manipulate RADIUS packets.
In ospfd(8), fix a segfault at startup.
In libssl, correct #if/else logic in BIO's dgram_ctrl (Coverity CID 72741).
In pflow(4), use the kernel socket interface (sosend(9) etc.) instead of shoving packets directly into the network stack with ip_output().
In backgammon(6), ensure the computer's men actually move when the computer's move is printed.
In snmpd(8), properly encode IpAddress, Gauge32, and Counter32 varbinds received from subagents.
Improve tty(4) hiwat handling.
Implement MPLS pseudowire (mpw(4)) to be used with VPLS and VPWS.
In openssl(1):
Avoid NULL deref in openssl s_cb (Coverity CID 24956).
Don't try to run ECDH if ecdh_checks fails in openssl speed (Coverity CID 72744).
In tame(2), crudely canonicalize paths before taming them.
On octeon, add amdcf(4), a new flash driver that allows access to the internal memory on (at least) D-Link DSR500 machines.
Allow the sched_yield, __thrsleep, __thrwakeup, and __threxit syscalls when using tame(2). This allows threaded programs to work.
Avoid a possible NULL dereference in openssl(1) s_server (Coverity CID 78873).
Add a quirk for Cirrus Logic PD6729: earlier silicon versions of this chip would advertize themselves as multi-function devices while they are not.
In syslogd(8), don't accept sockets when syslogd reaches the file descriptor limit. Instead disable the listen event and wait for a second.
In openssl(1), avoid dereferencing NULL (Coverity CID 21746).
In tame(2):
Don't dereference NULL FILE pointers.
Don't let any ioctls through with invalid file descriptors.
In bgpd(8), execute the RDE and session engine process instead of just forking. This way ASLR and stack cookies are per process.
Have tame(2) permit late calls to getpagesize() in programs.
In tmux(1), add an option (history-file) for a file to save/restore command prompt history.
Plug various memory leaks in libssl.
Try to assign a secondary bus number if the BIOS left the CardBus bridge unconfigured.
In httpd(8), ensure http_path is escaped before using it in Location redirection.
In tmux(1), correct the tsl/fsl sequence to ]0 not ]2.
On alpha, avoid having always to follow two pointers in copy{in,out}{,str} to get to the address of the onfault handler.
In openssl(1):
Warn when rename() fails in openssl apps (Coverity CIDs 78795 and 78803).
Remove check that is never true (Coverity CID 78799).
Check return value in openssl s_socket (Coverity CID 21655).
Check return value for ENGINE_ctrl and ENGINE_ctrl_cmd (Coverity CID 21645).
Add kbind(2), a syscall for ld.so to use to securely and efficiently update memory for lazy binding.
In doas(1), use a minimal set of stripped environment variables so that root shells read the right .kshrc.
On alpha and powerpc, make pmap_remove() grab the kernel lock. This makes MP machines work again with the unlocked reaper.
In octeon iobus, get rid of the static list of children devices and use only a lookup table for address hints where needed.
In netstart(8), bring up pflow last as it might send with a source address that is on any of the other interfaces.
In LibreSSL, remove the RSAX engine.
Allow line continuations with backslashes in doas.conf(5).
Make iwm(4) show command codes of unhandled firmware replies.
Change uvm_page[re]alloc_multi to actually use the flags passed in, and return a value so that they may be called with UVM_PLA_NOWAIT.
In ldpd(8):
Remove incomplete support for unnecessary modes of operation.
Rework label mapping algorithms to be more in line with the RFC.
Add full multipath support.
Send label withdraws when appropriate.
Add label withdraw/release wildcard support.
Implement MD5 authentication support.
In the installer, use the %c and %a fields in pkg.conf(5).
Show the tame flag in ps(1).
In ldpd(8):
Send only the best routes to lde.
On RTM_CHANGE, remove the old route before installing the new one.
On IMSG_CTL_KROUTE_ADDR, show all nexthops for multpath routes.
Uninstall associated label bindings when a neighbor is down.
In the install(1), do not use the mode set for the target file as the directory mode when using -D.
Enable GPT kernel support.
Define several new C99 macros in math.h.
In the nextafterl(3) ld80 implementation, make exponents of x and y signed and fix esx and esy comparisons.
In the unbound(8) rc.d(8) script, no longer gerate control keys/certificates if control-enable is used.
unbound(8), enable the control socket by default without using keys/certificates for authentication.
On mips64, add proper kernel locking in fpe_branch_emulate(). This avoids race conditions that could corrupt amap entries.
On octeon, avoid a deadlock caused by disabled IPIs.
In httpd(8), handle error returns from bufferevent_write().
Use two 2q caches for the buffer cache, moving previously warm buffers from the first queue to the second.
Use DEV_BSIZE instead of 512 where appropriate in the kernel. This starts laying the groundwork to allow disks with other sector sizes.
Adapt pms(4) so that the synaptics trackpad in the Dell L400 laptop can move the cursor in X.
In fuse(4), implement basic fh functions to avoid a panic.
In script(1), establish the SIGCHLD handler in the parent process only.
In mandoc(1), do not fork and exec gunzip(1), but just link with libz instead.
Plug a potential memory leak in pf(4).
In ktrace(2), make KTR_SYSRET records variables variables sized, leaving out the retval on error, including a long long retval on successful lseek(), and including a register_t retval for other successes. This fixes lseek reporting on ILP32 archs.
In openssl(1):
Correctly check the return value of strtoll(3) (Coverity CID 105339).
Free a variable on error (Coverity CID 78826).
Free a variable before potentially reusing it (Coverity CID 78824).
Only close a descriptor if not already closed (Coverity CID 78916).
In tcpdump(8), show 11n HTOP primary and secondary channel numbers for 40MHz BSS instead of showing just the primary one and "above" or "below" for secondary.
Rename the tps65090 driver to "tpspmic".
Introduce tame(2), a subsystem which restricts programs into a "reduced feature operating model".
In libssl, remove the logic responsible for outputting most AES-NI instructions as raw byte sequences.
Revert the previous commit in ospfd(8) (properly handle carp interfaces in "backup" mode on start-up), because it breaks on systems without carp.
In doas(1), if execvpe fails with ENOENT, print "command not found", like sudo.
On exynos, make the keyboard driver poll until it can be improved more.
In snmpd(8) and relayd(8), don't return failure for agentx messages with 0-length payloads. This allows snmpd to properly handle ping messages from agentx subagents.
In libssl, abort when ENGINE_remove fails (Coverity CID 21656).
Make tcpdump(8) show HTOP elements in 11n management frames.
In bioctl(8), remove the restriction to disallow the use of a passphrase file during initial creation of a crypto volume.
Remove workarounds in httpd(8) and syslogd(8) now that tls_write(3) has short write semantics.
Give tls_write(3) similar short write semantics as write(2), so implementing daemons with libevent buffers will be easier.
In ftp(1) and ntpd(8), handle short writes and TLS_{READ,WRITE}_AGAIN around tls_write().
In route(8), make all commands accepting the "-priority" switch recognize aliases for common priorities.
In libssl, don't dereference NULL (Coverity CID 78910).
In ntpd(8), prevent the tls constraint state machine from getting hung on STATE_INVALID.
In libssl, remove the SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER workaround.
In snmpd(8), fix malformed packets when returning "no such object/entry" errors for snmp requests.
In virtio(4), do the relatively expensive ISR read without kernel lock.
In bgpctl(8), tag dynamic routes with a "D".
In relayd(8), fix unbounded buffer growth. In the case of a slow client reading large files, we would consume large amounts of memory.
In ospfd(8), properly handle carp(4) interfaces in "backup" mode on start-up.
Abstract the routing table internals behind an rtable_* API.
In acpicpu(4), if _CST provides a C2 or C3 but lacks a C1 that we understand, provide a fallback C1 state using "halt".
In libssl, check the return value of ASN1_STRING_set() (Coverity CIDs 24810 and 24846).
In install(1), add -D to create the full destination path before installing the source into it.
In ssh:
Skip uninitialised PKCS#11 slots (bz#2427).
Don't ignore PKCS#11 hosted keys that return empty CKA_ID (bz#2429).
In sshd(8), only query each keyboard-interactive device once per authentication request regardless of how many times it is listed.
In doas(1), add -s as a shorthand for "doas $SHELL".
In httpd(8), allow to change the default media type globally or per-location.
In mandoc(1), insist that manual page file name extensions must begin with a digit lest pkg.conf(5) be shown when pkg(5) is asked for.
Support HTTP Strict Transport Security (HSTS) in httpd(8).
Have tftpd(8) provide a block of random data when clients request the file /etc/random.seed.
In mandoc(1), clean up the temporary file when the process dies from a signal.
In libssl, remove support for the SSL_OP_TLS_D5_BUG compat hack from SSLeay.
On alpha, correctly set up interrupts. Now the kernel no longer get stuck with an SCSI interrupt storm at the end of autoconf.
In snmpd(8), use RTF_CONNECTED to properly track connected routes.
On alpha, check for errors in the status register after performing a PCI configuration space read, for errors may not cause a machine check. This makes phantom PCI devices disappear on alphabook.
Allow route(8) to show all routes with a priority or all routes without a specific priority.
Allow sysctl(3) to show all routes with a priority or all routes without a specific priority.
Plug a leak in libssl (Coverity CID 78897).
Drop promiscuously received packets if the trunk(4) interface is not in promiscuous mode.
Add the _dpb, _pbuild, _pfetch users to do dpb multi-user builds.
On amd64 and i386, avoid assigning low addresses to PCI BARs. These addresses will never actually be routed to the PCI bus and therefore guaranteed not to work.
In mandoc(1), add initial support for less(1) -T and :t ctags(1)-like functionality to jump to the definitions of various terms inside manual pages.
Make sound cards work on older PowerMacs.
Fix MPLS routing when receiving packet with multiple labels.
Release the kernel lock while tearing down the uvm map in the reaper. This speeds up workloads that fork a lot of processes and, more importantly, reduces latency.
Prevent non-ACPI uniprocessor i386 machines with NX/PAE from panicing in pcibiosattach.
In ldpd(8), filter routes based on RTF_LLINFO and RTF_BROADCAST flags and use RTF_CONNECTED to properly track connected routes.
In httpd(8), always set PATH_INFO.
In sed(1), add the -i flag to do in-place editing.
In ripd(8), filter routes by RTF_LLINFO and RTF_BROADCAST and use RTF_CONNECTED to determine if a route is connected or not.
In binutils 2.17, correctly consume mandatory 0x66 prefix when disassembling aes{dec{,last},enc{,last},imc} instructions (a regression in 2.17) and correctly disassemble aeskeygenassist.
Plug a leak in openssl(1) (Coverity CID 78877).
In ospfd(8) and ospf6d(8), filter broadcast and llinfo routes, and adjust the tracking of connected routes to the new way.
In bpgd(8), only filter RTF_LLINFO or RTF_BROADCAST routes out but not RTF_LOCAL ones since we need those for loopback and point-to-point interfaces.
Make tcpdump(8) decode the country element in 802.11 mgmt frames.
Announce an IP address after inserting its corresponding RTF_LOCAL route and not during the SIOCSIFADDR ioctl. This way addresses are not announced when an error occurs.
Manage spd entries by using the radix api directly instead of reaching around through the routing table.
Fix a regression introduced by the M_PROTO1 loop prevention cleaning because gif(4) was abusing this flag to figure out if the packet was coming from a bridge(4).q
Make rcctl(8) return 0 when using "getall".
Make tcpdump(8) display BSS load information contained in 802.11 mgmt frames.
Update to NSD 4.1.3.
Enable exynos on armv7.
Remove support for SSLv3 from openssl(1) ciphers, s_client, s_server and s_time.
In iked(8), assign the correct destination port value for the destination netmask. This repairs setup of SPD flows that specify port only on the one side of the from-to specification.
Prevent a double free in tmux(1).
In sndiod(8), fix hangs during clean-up after the audio device is disconnected or an unrecoverable error is detected.
In libssl and openssl(1), remove workaround for TLS padding bug from SSLeay days.
In sshd(8), fix an incorrect test for SSH1 keys when compiled without SSH1 support.
Prevent syslogd(8) from writing too much data into the log file.
Make doas(1) fail if /etc/doas.conf is g+w or o+w or is not owned by root.
On amd64 and i386, remove the 4-second delay on reboot and shutdown that was added 8 years ago to "workaround MP timeout/splhigh/scsi race at reboot time". The issue probably has been fixed by now.
Allow (almost) any non-space character to be a part of "word" in doas.conf(5). This allows weird commands like /bin/echo to be used for real.
Remove the IP_ROUTETOETHER pseudo-option. It is hack to support return-rst on bridge(4).
Make tcpdump(8) show 11n HT capabilities in 802.11 management frames.
Introduce doas(1).
In drm(4), introduce a Linux-compatible wait_event API and use it in the inteldrm code.
In libssl, enforce V_ASN1_OCTET_STRING type before accessing the object as octet string (OpenSSL RT #3683).
In httpd(8), prevent having the whole file in RAM when it is read from disk faster than being sent to the client.
Fix Coverity CID 78921 in openssl(1).
Fix Perl srand() to be a deterministic pseudorandom stream.
Plug a memory leak in libssl (Coverity CID 105348).
Ensure the signs of cacosh(3) and cacoshf(3) are correct.
On amd64 and i386, move grab/release of the kernel_lock for softintrs from the ASM stubs to softintr_dispatch().
In getty(8), remove ancient support for edited hostnames.
In btree(3) and recno(3), remove the stubby not working mmaped file support.
In libssl:
Check the return value of all used functions in OCSP_REQUEST_print() (Coverity CID 78796).
After reading a password with terminal echo off, restore the terminal to its original state instead of blindly turning echo on.
Update to Unbound 1.5.4.
In axen(4):
Ignore the 4-byte trailing padding of each received packet when copying to the upper layer.
Add USB 3.0 related code.
Update to libdrm 2.4.62.
Refix memory handling for machines with less than 256M broken by r1.64 of src/sys/arch/octeon/octeon/machdep.c.
In httpd(8), use vis(3) instead of url_encode() for some values like User-Agent.
In libssl, fix a few Coverity CIDs including 125063.
Recognize CARP interfaces when sending packet to a multicast address.
On arm and armv7, account for the fact that the exynos gic is not at a fixed offset from periphbase.
In urtw(4), fix error code paths to not panic the kernel. This makes the driver work with somewhat flaky urtw(4) devices.
In libssl:
The previous fix for Coverity CID 21785 did not cope correctly with the case where seed_len != 0 and seed_in == NULL. Since this situation is an error anyway, bail out early.
Do not allow TS_check_signer_name() with signer == NULL from int_TS_RESP_verify_token() (Coverity CID 21710).
Avoid leaking objects upon error.
Fix unchecked allocations, and make sure we do not leak upon error (Coverity CID 21739 and more).
Fix a memory leak (Coverity CID 78836).
Fix a possible 32-byte buffer overrun (Coverity CID 78869).
Fix two theoretical NULL pointer dereferences which can only happen if you have seriously corrupted your memory (Coverity CIDs 21708 and 21721). Also plug a memory leak.
Remove dead code (Coverity CID 21688).
Flense out dead code (Coverity CIDs 21691 and 21698).
In httpd(8), allow the certificate and key to each be almost 16 kB rather than having a combined total of less than 16 kB.
5.6 and 5.7 SECURITY FIX: a TCP socket can become confused and not properly cleanup resources.
A source code patch exists for 5.6 and 5.7.
In httpd(8):
Fix memory leaks that can occur when config_getserver() fails.
Explicitly check for and handle EOF on a TLS connection.
In rc.d(8), require an exact match of the process name and argument list by default.
Match another Netgear WG111T on uath(4).
In rc.d(8), always use the default flags when running !start so that rc.d scripts launched with -f can be properly stopped, checked and reloaded.
In ugold(4), add support for newer PCsensor TEMPerHUM thermo- and hygrometers.
In sshd(1), fix a NULL dereference when SSHv1 is enabled.
Make "openssl pkeyutl -verify" return exit code 0 on success.
Fix a crash caused by uath(4) if device init fails.
In rcctl(8):
Deprecate the getall subcommand
Implement a new ls subcommand to list daemons according to the argument.
Make it possible to get the daemon_class.
In tcpdump(8), move the BIOCGSTATS ioctl operation done by the tcpdump process into a service provided by the privsep monitor.
In devname(3), fall back to scanning /dev if /var/run/dev.db does not exist.
In find(1), fix a segmentation fault and a use-after-free.
Avoid a situation where we do not set the tcp persist timer after a zero window condition.
On octeon, do not attempt to configure octhci. It is superseded by dwc2.
In tmux(1):
Revert to marking lines as wrapped on newlines. This fixes problems with capturep -J.
Add a -s flag to show-environment to output Bourne shell commands  la ssh-agent.
Add a format to show if client is a control client.
Fix a few problems when running out of file descriptors.
Ignore environment variables that are too long to send to the server.
Reset G0/G1 state when resetting everything else with send-keys -R.
First stab at making the hppa mpsafe.
In devname(3), don't write a warning to stderr if the db cannot be opened. This avoids bogus warnings in chroots.
In tcpdump(8), don't consider \v and \f printable characters.
In cwm(1), introduce "groupsearch" for group menu search.
In xhci(4), do not trust the hardware when it says that the number of remaining bytes to transfer is superior to the length of the transfer.
On i386, amd64 and sparc64, don't call pool_put(9) while holding a mutex to prevent lock ordering problems between the per-pmap mutexes and the kernel lock. This happens because pool_put(9) may grab the kernel lock when it decides to free a pool page.
In ssh, turn off DSA by default. Add HostKeyAlgorithms to the server and PubkeyAcceptedKeyTypes to the client side so it can be turned back on.
In syslogd(8), ensure the privsep parent and syslogd child are kept in sync if the fd limit is reached.
Disable pool_gc on m88k if MULTIPROCESSOR.
Avoid a double free in syslogd(8).
On amd64, prevent possible interrupt recursion before unwinding the stack.
In ssh, re-enable ed25519-certs if compiled without OpenSSL.
In fdisk(8), do not attempt to read a disk sector worth of data from the file containing the MBR template. This allows fdisk(8) to work on 4096-byte disks again.
In file(1), properly handle files >= 4 GB on 32-bit architectures.
Switch "openssl dhparam" default from 512 to 2048 bits.
Fix a use-after-free in et(4).
Unify the mutex implementations on all the mips64 platforms.
In pf(4), avoid strange state match and create behavior when IPsec is involved.
Make bgpd(8) properly handle interface routes since they no longer have a "gateway" sockaddr of type AF_LINK.
Use a new RTF_CONNECTED flag for interface (connected) routes.
Disallow userland from setting RTF_LOCAL and RTF_BROADCAST.
Replace MFREE(9) with m_freem(9).
In ddb(4), return the correct file name entry from the DWARF line table.
In iked(8), repair policy-ikesa-linking.
In vi(1), fix a regression caused by timespec changes when run without a file to edit.
In syslogd(8), add the -T option to accept messages on a TCP socket.
Unbreak option parsing in libfuse.
Make non-kms pci video drivers work again on platforms other than i386 and amd64.
On armv7, use u-boot.img instead of u-boot.bin on the panda and beagle.
In comsat(8), don't discard comsat messages with trailing whitespace.
Add IPv6 support to mail.local(8).
In tmux(1), update the environment with -E when attach-session used on an already attached session or switch-client used on the current session.
Let syslogd(8) run with non-blocking sockets.
On vax, replace the manual buf list management with a fifo bufq.
In qe(4), count outgoing packets.
Remove sudo; it has moved to ports.
Revert r1.111 of xenocara/app/cwm/kbfunc.c: it broke application menu searching.
Add static PIE support to sparc.
On sparc, correctly handle relative-type relocations.
In ssh(1), turn off the 1024-bit diffie-hellman-group1-sha1 key exchange method.
In ssh:
Remove support for legacy v00 certificates.
Refuse to generate or accept RSA keys smaller than 1024 bits.
Put KERNEL_LOCK/KERNEL_UNLOCK around the pipex destination for mbufs until it is properly MP-protected.
On i386, tweak MUTEX_ASSERT_LOCKED and MUTEX_ASSERT_UNLOCKED to only look at the owner.
On i386, make pmap_enter(9), pmap_remove(9) and pmap_page_protect(9) safe to use without holding the kernel lock. Unfortunately there still seems to be an issue that causes deadlocks under pressure.
On m88k, fix MUTEX_ASSERT_LOCKED and MUTEX_ASSERT_UNLOCKED so that they check whether the mutex is locked by the current CPU rather than any CPU.
Introduce shared reference pointers (srp).
Compile-time disable SSH version 1 again.
In ssh, better refuse ForwardX11Trusted=no connections attempted after ForwardX11Timeout expires.
In syslogd(8), add a -U option to specify an explicit address to receive UDP packets.
Fix alignment issues in bridge(4).
In ssh:
Fix math error in remote window calculations that causes eventual stalls for datagram channels.
Call fatal() when a remote window update causes the window value to overflow.
In sshd(8), add getpid to sandbox (bz#2419).
Get jumbo frames working in oce(4).
Allow to re-plug USB3 devices on the root hub without going through a suspend/resume cycle (or rebooting) with Intel ICH7 xHCI.
In ps(1), remove the calculation that includes the process lifetime and just use the p_pctcpu value as %cpu time.
In cwm(1), show an empty "ssh to" menu if the known_hosts file is missing.
In syslogd(8), add the possibility to store all syslog messages received from a specific host into a single log file.
Never cache an RTF_GATEWAY route as next hop for a gateway route. This prevents rtentry loops when rtrt_gwroute points to rt leading to an infamous "rtentry leak" panic.
Enable vexpress(4) on armv7.
Implement membar_* for armv7 with the dmb instruction.
On amd64, fix trap setup for double faults.
On amd64, force the return to userspace from execve to go through iretq to get all registers.
In drm(4), read the lower 16-bits of the GCFGC "double word". This potentially fixes issues with some modes on machines with the 915GM chipset.
Enable octdwctwo and add umass on octeon.
Update to FreeType 2.6.
On amd64 and i386, split AST handling from trap() into ast().
Build Xserver(1) with large got on mips.
Fix a memory leak in qe(4).
In dhcpd(8), do not send routers (option 3) or static routes (option 33) when classless static routes (option 121, 249) are sent, per RFC 3442.
In mandoc(1), ignore blank characters at the beginning of a conditional block, that is, after "\{".
In acpimadt(4), completely skip entries for disabled LAPICs so they don't overwrite legitimate enabled ones.
In drm(4), introduce the Linux completion API and use it.
In cwm(1), replace screen region info gathering with XRandR equivalent of Xinerama queries.
In ssh, fix "\"-escaping bug that caused forward path parsing to skip two characters and skip past the end of the string.
In binutils 2.17, avoid an assertion failure in elf32_arm_size_dynamic_sections().
Implement the missing gus_{malloc,free,mappage,...} to support cards that have no ad1848 chip and don't attach the ad1848 driver.
In de(4), ensure the setup block is DMA reachable.
In pkg_add(1), use machine_architecture (arch -s) when assembling PKG_PATHs using %m or %a. This is relevant on archs like powerpc.
On octeon, reenable memory above 256mb now that uvm_pmr_get1page() has been fixed.
In bridge(4), properly deliver broadcast-like packets to the network stack.
Fix some weird bridge(4) configurations involving pseudo-drivers stacked on top of interfaces in a bridge.
On macppc, use a single event counter for IPIs like other archs do.
Reimplement the audio driver in a simpler way, removing unused/unusable functionality.
In npppd(8):
Reset the LCP option state for dialin-proxy only if re-negotiation is enabled.
Fix a use-after-free.
In chmod(1), compress(1), du(1), grep(1) and ls(1), put fts_close() where missing.
Allow uvideo_mmap_queue() to fail gracefully when the mmap queue is full.
In libpciaccess, attempt to establish a write combining mapping instead of relying on mttrs. Setting the mttrs fails on the ThinkPad X1 rev. 3, making the xorg-video-vesa driver painfully slow.
On macppc, do not quiesce the firmware on Quad G5 to let it manage the fans. This also unbreak "bsd -cd" on such machines.
Stop garbage collecting mbufs from the ARP, IPv4 and IPv6 queues when an interface is destroyed or removed.
In drm(4), introduce Linux work queue APIs and use them.
In npppd(8), terminate all PPP sessions properly.
Reenable the pool gc task. The problems it tickled by working outside the biglock on archs with mutex and clock interaction have been fixed.
Apply normal handling to atfd+path args to chflagsat(2).
Revert r1.38 of src/usr.bin/ssh/uidswap.c (don't call setgroups if we have zero groups).
In sed(1), treat multiple "!" characters preceding a function as a single negation, per POSIX.
On alpha, properly remember curproc in copy(9). This fixes a bug where it sleeps and resumes on a different processor.
In httpd(8), add support for Lua patterns(7).
In nm(1):
Correct a read after bound.
Ensure that e_shentsize (sections header's size in bytes) is large enough to fill at least one Elf_Shdr.
Ensure that freed variables in elf_symloadx() are reinitialised when an error is detected.
On amd64, make sure that the page tables are created after esym and after end. This avoids a crash with small non-generic kernels that write to the page tables.
In nm(1), before accessing data, check if the section header table is present and check the consistency of the section header table size.
In npppd(8), properly handle zero-length 1701/udp and GRE packets.
In ssh, don't count successful partial authentication as failures in monitor. This may have caused the monitor to refuse multiple authentications that would otherwise have successfully completed.
On amd64 and i386, make it possible to create write combining mappings through /dev/mem.
In pf(4), increment rule counters only after successful state insertion.
In ssh, don't call setgroups if we have zero groups; there's no guarantee that it won't try to deref the pointer.
In httpd(8), URL-encode $SERVER_NAME and $REMOTE_USER before using them in the Location header.
Make xhci(4)'s root hub report the same status bits as physical USB3 hubs.
Apparently some BIOSes not supporting xHCI natively switch USB ports back to EHCI at suspend, so route the ports back to xHCI at resume.
In an(4), don't use uninitialized data as a return value.
Don't leak memory if wsfont_rotate() fails.
In httpd(8), allow to specify characters like "?" in the Location URI.
In bgpd(8), fix a race between sending notifications to the SE and getting a new peer_up event in the RDE.
In ipmi(4), fix a memory leak on failure.
Fix a bug that causes uvm_pmr_get1page() to fail for allocations that specify an address constraint even when free pages that meet the constraint are still available.
In libssl, provide EC_curve_nid2nist() and EC_curve_nist2nid().
In Xserver(1), don't listen to "tcp" by default and add the -listen option.
In xinput(1), fix a crash when enabling/disabling without a device argument.
Remove obsolete MDC-2DES from libcrypto.
In bgpd(8), when we terminate the session, show the number of (currently) known prefixes and the max-prefix limit and show ">" as soon as we go above the limit since there may be more that we haven't/won't process.
Remove isp(4) now that the ql* family have replaced it.
In LibreSSL:
Change DTLS client cert request code to match TLS. DTLS currently doesn't check whether a client cert is expected.
Disable ENGINE_load_dynamic (dynamic engine support).
In cmpci(4), set the closest available format for unsupported sample formats instead of returning EINVAL.
Fix tap-to-click with ubcmtp(4).
In tmux(1), change break-pane to take target and source panes (-t and -s) in line with other commands.
On vax, make kernel text read-only and unreadable from userland.
Add four new sensors to upd(4).
On mips64, let alloc_contiguous_pages() round the allocation size to a page boundary, not to a u-area boundary.
On sgi, clear the PIC 'write request' memory at initialization time. There is apparently a risk of spurious parity errors if we don't.
Store a unique ID, an interface index, rather than a pointer to the receiving interface in the packet header of every mbuf. This will simplify garbage collection of mbufs and limit problems with dangling ifp pointers.
In syslogd(8), implement -F to stay in the foreground.
Bring back r1.78 and r1.79 of src/sys/dev/usb/uhub.c. They were thought to introduce a regression, but it turned out to be a hardware failure.
Pass the "-nolisten tcp" option to Xserver(1) so that it doesn't listen on port 6000 by default.
In trunk(4), fix a double free in the destroy path.
In tmux(1), add the window_activity format.
Make the wifi LED work with iwm(4).
In LibreSSL, make CBS_get_any_asn1_element() more compliant with DER encoding.
In ssh, return failure on RSA signature error.
On sparc, build __moddi3, __muldi3 and __qdivrem from libkern, and built no-pie, instead of getting them from libgcc.a, built pie. This repairs boot blocks operation.
In tmux(1), add a format for client PID (client_pid) and server PID (pid).
Implement IQ calibration support for rtwn(4).
Add plrtc(4), a driver for the ARM PrimeCell PL031 RTC.
Parse _CST objects and use the C-states they describe when they're sane.
In rtwn(4), busy-wait a short while after sending a command to rtwn(4) firmware. This fixes selection of initial TX rate.
In glob(3), initialize the glob_t before the first failure check.
In binutils 2.17, add more encodings of options for the armv7 barrier instructions and allow non "sy"/0xf options for dmb. This omits the *ld options available in armv8 running in a32 mode.
In LibreSSL, reject long-form tags in CBS_peek_asn1_tag. Currently, CBS only handles short-form tags.
In pfctl(8):
Allow rule ID filter to be specified for "-s states" output.
Respect the rule ID parameter (-R) specified along with "-s states" to filter out states that are not associated with a given rule from the output.
In pppd(8), use memmove() for potentially overlapping regions.
Fix rtwn(4) wifi LED support.
5.6 and 5.7 SECURITY FIX: several defects from OpenSSL (CVE-2015-1788, CVE-2015-1789, CVE-2015-1792). For more information, see the OpenSSL advisory.
A source code patch exists for 5.6 and 5.7.
5.6 and 5.7 SECURITY FIX: multiple reliability issues in smtpd.
A source code patch exists for 5.6 and 5.7.
In libiberty, prevent an integer overflow leading to a heap-buffer overflow (CVE-2012-3509).
In LibreSSL:
Avoid an infinite loop that can be triggered by parsing an ASN.1 ECParameters structure that has a specially malformed binary polynomial field (CVE-2015-1788).
Avoid a potential out-of-bounds read in X509_cmp_time(), due to missing length checks (CVE-2015-1789).
Avoid an infinite loop that can occur when verifying a message with an unknown hash function OID (CVE-2015-1792). (However, this code is not enabled/built in LibreSSL.)
In the NFS code, avoid double-free in error path by cribbing the HASBUF flag logic from the rest of the kernel that deals with filename lookups.
In autri(4):
Use the first 4 channels of the board. The previous channel setting caused DMA on the wrong memory location during recording.
Don't claim big-endian, signed 8-bit or unsigned 16-bit samples are supported. This fixes sound on big endian machines.
In snmpd(8), export the new pf "no-route" error counter.
Plug an fd leak in httpd(8).
In relayd(8), introduce a state on the ctl_relay_event struct. This makes it possible to better track the connection state of a session and stops doing double opens in certain situations using http relays.
In pms(4), don't match Elantech v4 devices with firmware versions 0xX7XXXX or with firmware versions higher than 0xX8XXXX.
Add initial support for the ARM Versatile Express boards as emulated by qemu with virtio memory ranges.
Ensure polled bulk, control and interrupt transfers actually poll. This fixes panics on shutdown with various usb sticks.
In tmux(1), add the -E flag to bypass update-environment when attaching or switching clients.
Remove HBG support from the DCF77 drivers.
On armv7, add initial exynos4 bits.
Introduce unhandled_af() for cases where code conditionally does something based on an address family and later assumes one of the paths was taken. This reduces the amount of noise with static analysers and acts as a sanity check.
Allow ehci to be built on platforms that lack a pci bus.
On amd64 and i386, enable use of mwait in non-MP boxes and report # of C-substates up to C7, truncating trailing zeros.
Make the qemu cortex a15 useable without trustzone.
Allow the rtsol keyword in hostname.if(5) with net.inet6.ip6.forwarding=1.
Enable rtwn(4) on RAMDISK_CD kernels for upgrades.
Put the link-layer address back into the gateway field of RTF_LOCAL routes. This fixes the "arpresolve: unresolved and rt_expire == 0" issue.
In tmux(1), handle the RGB colour escape sequence like xterm(1) does.
On alpha, do not unconditionally clear pcb_onfault after a uvm_fault. This should fix getentropy issues on MP systems.
In tmux(1), fix an uninitialized variable.
In iked(8), fix coupling and decoupling operations.
In pf(4), improve error handling and recovery during state insertion. This also fixes a few bugs.
Fix races on powerpwc:
Replace the per-entry locks by a global HASH lock. This guarantees the atomicity of pte_inser{32,64}() when a pted has to be removed first.
Protect VP lookups to guarantee that a pted won't be freed or reused by a CPU while another CPU is manipulating it.
In tmux(1), if a window or session target is prefixed with an =, then only an exact name or index match is accepted.
In tmux(1), make "new -d" work without unsetting $TMUX.
Add the new rtwn(4) for RTL8188CE wifi cards.
Check for a resolv.conf update the first time the resolver is used after pid has changed.
Add support for em(4) on the Teak 3020, a system based on the Intel Tolopai (EP80579).
Prevent a kernel panic on macppc caused by the kernel perfpolicy code.
In tmux(1):
Add support for a single "marked pane".
Make unsetting a global option restore it to the default.
In from(1), treat a missing mail spool the same as a zero-length mail spool unless the -f option was specified.
In pf(4), avoid division by 0 and using a 0 upper bound for arc4random_uniform(3).
Fix audio interrupts on U4 systems.
In arp(8) and ndp(8), don't assume that the sockaddr_dl will be in the gateway sa. This fixes a regression introduced with the support of multiple connected routes.
Rework the ppp handling in the tty layer so it has its own private pool to allocate packet memory out of. This fixes a long standing issue in ppp on a tty/serial line where it allocates mbufs at IPL_SOFTTTY, which is above the IPL_NET the mbuf layer protects itself at.
Fix a memory leak in sensorsd(8).
Add a new HT-PCI bridge driver and the necessary glue to openpic(4) to get interrupts working on U4 machines. With this OpenBSD can run on PowerMac11,2 (Quad G5).
Make sparc go PIE (not "static PIE" yet).
On sparc, override PIE range constants with a variable which is decided at runtime, in order to only enable PIE on sun4m which has a large enough address space.
In the lazy binding routine, make sure we actually allocate the stack we need, instead of corrupting the caller's stack by mistake. This fixes segfaults in __powerpc_read_tcb() reported on earlier G3 systems.
Enable secureplt by default on alpha.
Allow gcc(1) to produce more precise relocation information on alpha. This will be necessary to enable secureplt by default.
Switch m88k ports to binutils 2.17.
In relayd(8), fix a memory leak in an error path.
In mandoc(1), implement the roff(7) "r" conditional.
Plug a memory leak in relayd(8).
Introduce native atomic operations for i386.
Acquire/release the i2c bus before/after reading the temperature register. This prevents concurrent access to the smu(4) microcontroller on Apple G5 machines, which would result in errors reading the RTC.
On armv7, set the usb otg port on the cubox to host mode and attach ehci to it.
In file(1), support - to read from stdin.
Set the sdmmc(4) emmc highspeed flag if the capability register claims it is supported.
In tmux(1):
Expand formats again inside #().
Don't use special strings if #() commands fail, just remove the format (as if the command produced nothing).
Switch vax to binutils 2.17.
Make ld.so(1) on alpha cope with binaries built with secureplt.
In file(1), if reading into a buffer, correct the stored file size at EOF.
In the asr, fix a possible off-by-one when reading /etc/hosts if it doesn't end with a newline.
In file(1), silently fall back to /etc/magic if ~/.magic can't be opened.
Initial addition of "Patrol Read" support in bio(4), bioctl(8) and mfi(4).
In ntpd(8), detect crashes from constraint sub-processes, instead of ignoring them.
When the machdep.allowaperture sysctl is set to 3, allow concurrent access.
Save the cpuid(6) eax bits in the cpu_info and report the SENSOR and ARAT bits from it.
Switch alpha, arm, sh and sparc to binutils 2.17.
In httpd(8), relayd(8), smtpd(8) and snmpd(8), do not try to unlink the control socket in an unprivileged child process on shutdown.
In ssh(1), increase the allowed length of the known host file name in the log message to be consistent with other cases (bz#1993).
Make ssh-keygen(1) default to ed25519 keys when compiled without OpenSSL (bz#2388).
Remove 1k bit groups from ssh and moduli(5).
In ssh(1), reorder client proposal to prefer diffie-hellman-group-exchange-sha1 over diffie-hellman-group14-sha1.
In ssh:
Cap DH-GEX group size at 4kbits for Cisco implementations (bz#2209).
Support PKCS#11 devices with external PIN entry devices (bz#2240).
Add a stronger (4k bit) fallback group that sshd can use when the moduli file is missing or broken, sourced from RFC3526 (bz#2302).
In audioctl(1), expose the number of bytes processed by the sound card instead of the number of bytes processed minus the xruns.
Don't create ICMP states on reply packets unless sloppy state tracking is used.
Allow for multiple RTF_CLONING routes with the same priority.
Normalize route destination before checking for MPATH conflicts.
Do not create ARP entries for RTF_BROADCAST routes.
Include the firmware for usb devices on the armv7 ramdisk.
Make vlans inherit their parents hardmtu as well as mtu.
Build all the firmware for usb devices on armv7.
Build wsconsctl(8) and wsconscfg(8) on armv7.
Really fix the panic in the PF_KEYv2 code by reverting src/sys/net/pfkeyv2_convert.c to r1.52.
In ipsecctl(8), bump up the default Diffie-Hellman group to modp3072.
Fix a panic in the PF_KEYv2 code.
In pms(4), match newer Elantech v4 touchpads.
Port the ELF m88k work to binutils 2.17. It is good enough to build a booting kernel, and hopefully userland as well.
In ugen(4), prevent a use after free in by closing all open endpoints upon detach. This fixes a panic.
In sshd(8), add the missing -c option to getopt().
Always establish all the necessary interrupts at pckbc attach time, and get rid of the "intr_establish" pckbc callback.
Update to xf86-video-ast 1.0.1, xf86-video-savage 2.3.8, xf86-video-siliconmotion 1.7.8, xf86-video-tdfx 1.4.6, xf86-video-trident 1.3.7 and dejavu-ttf 2.35.
Build wsudl(4) on armv7.
Add udl(4) and uvideo(4) to armv7 GENERIC.
Update to xf86-video-cirrus 1.5.3, xf86-video-i740 1.3.5, xf86-video-mach64 6.9.5, xf86-video-mga 1.6.4, xf86-video-neomagic 1.2.9 and randrproto 1.4.1.
In sftp(1), fix a memory leak in an error path.
In ldomctl(8), fix a memory leak in an error path.
Introduce ipsec-id bundles and use them for ipsecflowinfo. This fixes rekeying for l2tp/ipsec against multiple windows clients and saves memory.
In dump(8), canonicalize all devices to DUIDs in order to make -w and -W output consistent.
Don't use an uninitialised softc pointer in midi(4).
In iwm(4), reserve two DMA segments for sending commands to the firmware. This hopefully fixes a hardware error.
In ssh(1), reorder EscapeChar option parsing to avoid a single-byte out-of-bounds read (bz#2396).
Add a knob to sshd_config(5) to relax GSSAPI host credential check for multihomed hosts (bz#928).
Update Diffie-Hellman groups in ssh and moduli(5).
Establish interrupts for both keyboard and mouse slots at isa pckbc attach time, rather than lazily from pckbc when slots are discovered.
Switch amd64, hppa, mips64, mips64le and powerpc to binutils 2.17.
In ssh-keygen(1), support -lF hostname to find search known_hosts and print key hashes.
Correctly state the link state to INVALID when creating a carp interface.
Fix an uninitialized variable in ix(4).
In sshd_config(5):
Support arguments to AuthorizedKeysCommand.
Add AuthorizedPrincipalsCommand that allows getting authorized_principals from a subprocess rather than a file.
Remove hotplug(4) support from ntpd(8).
In httpd(8), correctly print the filesize in the Content-Length header for files larger than 2 GB on 32-bit architectures.
Fix installing sets from CD-ROM if more than one CD-ROM drive is present.
In chroot(8), when a user is specified via the -u flag, use setusercontext() to setup (most of) the execution environment.
Add the -c flag to id(1) to display the user's login class.
In icmp(4), do not leak a rtentry if it is unusable.
In bge(4), increase a maximum firmware handshake timeout to 10 seconds.
In tmux(1), prevent missing cursors with emacs-in-tmux-in-tmux.
Use the same va entry point on all armv7 socs.
Make armv7 startup PIC.
Make TAPE=- mean stdout in tar(1).
On amd64, do lazy update/reset of the FS.base and %[def]s segment registers.
Avoid a kernel crash in the NFS code while running netstat or pstat -f.
Make the compiler emit visibility information for (undefined) references with non-default visibility.
In dhclient(8) and dhcpd(8), accept hostnames starting with 0-9.
Fix two use-after-free cases in relayd(8).
Change spamd(8) to use divert-to instead of rdr-to.
In dhclient(8), stop rejecting leases with a subnet that overlaps a subnet already present.
In ntpd(8), scale the error margin with the number of resolved NTP peers. This way, a very small number of outliers in an NTP pool cannot immediately trigger new connections to the contraint servers.
Enable ntpd(8) by default at install time.
Export the rdomain to userland through struct if_data.
In cu(1), add the -d flag and the dc capability to open devices non-blocking. This is useful for the few drivers that do not support cua* so tty* must be used.
Reenable the page zeroing thread on MP m88k kernels.
On aviion and luna88k, make sure the lock is not taken for clock interrupts.
Add the -D option to nm(1) to display the dynamic symbol table.
In ntpd(8), if the constraint resolves to multiple IP addresses, try each of them one by one.
In axe(4), read ethernet address from EEPROM on AX88772B.
Add an F_ISATTY option to fcntl(), so that isatty() can use this rather than the bloated ioctl() interface.
In aucat(1), prevent periodic glitches occurring under certain circumstances.
In audioctl(1), display simply "play" when play mode is set.
Make it possible to use the same network on multiple interfaces at the same time.
Give carp(4) interfaces their own low priority.
Introduce if_output(), a function to do the last steps before enqueuing a packet on the sending queue of an interface.
Remove the "Use DUIDs rather than device names in fstab?" question from the installer and use DUIDs unconditionally.
In smtpd(8), don't log credentials upon AUTH LOGIN authentication failures.
In ssh-agent(1):
Use a salted hash of the lock passphrase instead of plain text and do constant-time comparisons of it.
Add a 0.1s incrementing delay for each failed unlock attempt up to 10s.
In upd(4), make the "Battery Present" sensor a dependency of all the battery-related sensors only if it is present.
Update to font-util 1.3.1.
Extend autoinstall(8) to allow for hostname-mode.conf response files and to put response files in a subdir of the webserver's document root.
On armv7, rework the imxenet hardware address setup.
In smtpd(8), avoid multiple "From " and "Return-Path" headers.
Translate the fec parameters from the novena dtb to set a different clock skew to the same micrel phy used on sabre lite. This change resolves the stability problems with imxenet on novena.
In tmux(1), to replace c0-*, add a high watermark to the pty event, and also backoff when any of the ttys the pane is going to write to has buffered enough data.
Revert r1.3 of src/gnu/usr.bin/binutils-2.17/bfd/elflink.c. It introduces bogus failures when inter-library dependencies are present.
In em(4), make sure the rx ring lwm is set to at least 4. As far as we know, all hardware variants need at least 4 descriptors on the rx ring to be able to receive packets.
In tmux(1):
Add bell-action "other".
Add a session_alerts format and use this in the default set-titles-string.
In hifn(4), fix a potential use-after-free and a memory leak.
In urtwn(4):
Match additional devices (RTL8188CU_3, DWA123D1, DWA125D1).
Fix efuse reading (which fixes a potential error in MAC address read from efuse).
Fix an uninitialized variable access in npppd(8).
imxiic is known to be broken, so don't try attaching it on utilite.
On armv7, raise VM_PHYSSEG_MAX to two and load an additional physical memory segment if u-boot reports it. This is needed for the utilite where u-boot reports two 1GB segments of physical memory.
In em(4), support reading from an OTP iNVM.
Fix a potential use-after-free in pf(4).
In bioctl(8), use explicit_bzero(3) on private data.
In tmux(1), remove the c0-* options which never really worked satisfactorily.
In upd(4), refresh sensor values asynchronously.
Remove all audio format conversion code from the kernel as we already do better conversions in user mode.
In nvram(4/amd64) and lpt(4), convert from uiomovei() to uiomove() to prevent short tranfers.
When checking flags that will be passed to open(), test the O_ACCMODE portion separately to avoid false negatives.
Set POLLHUP even if no valid events were specified as per POSIX.
In urtwn(4):
Repair firmware reset on RTL8188CUS devices (and perhaps others).
Fix 11b performance for RTL8188EU devices.
Update to kbproto 1.0.7, libFS 1.0.7, libXaw 1.0.13, libXrender 0.9.9, libXt 1.1.5, libfontenc 1.1.3, libpciaccess 0.13.4, libxkbfile 1.0.9, setxkbmap 1.3.1, smproxy 1.0.6, twm 1.0.9, x11perf 1.6.0, xcmsdb 1.0.5, xcompmgr 1.1.7, xdpyinfo 1.3.2, xdriinfo 1.0.5, xedit 1.2.2, xev 1.2.2, xgamma 1.0.6, xgc 1.0.5, xhost 1.0.7, xkbevd 1.1.4, xkbprint 1.0.4, xlsatoms 1.1.2, xlsfonts 1.0.5, xmag 1.0.6, xman 1.1.4, xmodmap 1.0.9, xvinfo 1.1.3 and xorg-docs 1.7.1.
Adjust the physical memory limit on armv7 in order to prevent a panic on the Novena.
In col(1), recognize SUSv2-style escape-digit sequences in the input stream.
Various improvements to the GPT code.
In wsdisplay(4), when changing screen saver parameters, check the flags of the currently displayed screen in order to decide whether the screen saver needs to be retriggered, rather than the flags of the device we are issuing the ioctl on. Also, ensure the screen burner gets reenabled when switching from X11 to a virtual text console, and disabled when switching back to X.
In wsconsctl(8), add a flag for variables to prevent reading their value after modifying them and use this flag for display.focus. Also disallow -= and += syntax for display.focus.
In col(1), fix various integer overflows and underflows, and logic errors.
Switch i386 and sparc64 to binutils 2.17.
Avoid NULL function pointer dereference during boot on sabresd.
Add initial board-specific parts of Novena support to armv7.
In ssh:
Don't choke on new-format private keys encrypted with an AEAD cipher (bz#2366).
Fix a post-auth crash with permitopen=none (bz#2355).
In tmux(1), update the environment when switching sessions as well as attaching.
In man(1), let the -m option add to the default manpath rather than override it.
Include the timestamp TCP option in keep alive packets.
In tmux(1), add the window_linked format.
In top(1), display thread IDs instead of the name of the process's owner when -H is used.
In tmux(1), turn cursor off during redraw.
In sshd(8), blacklist DH-GEX for specific PuTTY versions rather than all PuTTY versions.
Bring back the MI atomic API for powerpc.
Fix a memory leak in ld.so(1).
In asr, skip loopback addresses, not loopback interfaces, per RFC 3493.
In httpd(8), implement If-Modified-Since.
In sshd(8), don't offer DH-GEX to WinSCP.
Flag user-specified routes with an AF_LINK gateway as RTF_LLINFO.
Add the disklabel(8) template file based autopartitioning feature to the installer.
Add SwissSign CA root certificates to /etc/ssl/cert.pem.
In aucat(1), fix a clipping bug in float-to-fixed-point conversion.
Add support for RTL8188EU chips to urtwn(4).
Fix a crash on HP bc2500 blades with MP kernels when writing to the DSDT.
Use ether_input() as default input packet handler and do the necessary m_adj(9) to keep bridge(4) working while other pseudo-drivers are converted to if_input().
In compress(1), cp(1) and mv(1):
Preserve times to nanosecond precision instead of just microsecond.
Prefer to set attributes by fd for regular files, and don't follow symlinks for others.
Add byte-range support to httpd(8).
Make sure no kernel data is leaked in malloced memory in the padding of struct dirent when reading a directory over NFS.
In dump(8), eliminate the -U flag and make usage of DUID in /etc/dumpdates the default.
In ping(8), allow a TTL of 0.
Fix some problems with relayd(8) configuration reload.
In dhclient(8) and dhcpd(8), correct switch between current and previous line buffers when encountering a carriage return in the input.
Rework hppa mutexes: always record which cpu owns the lock and improve the mutex diagnostics/assertions.
Drop pf_rules and ipsec_rules from rc.conf(5).
In ping6(8), change the lower bound of -h from -1 to 0.
In mandoc(1):
Fix misformatting of man(7) manuals and potentially of mdoc(7) manuals.
Fix an assertion failure.
Reenable page zeroing thread on SMP mips kernels.
Do not grab the kernel lock for clock interrupts on mips64, octeon and sgi.
In ssh(1), improve error messages on TCP connection resets (bz#2257).
In sshd(8), prevent authorized_keys options picked up on public key tests without a corresponding private key authentication being applied to other authentication methods.
Pass fflag to VOP_POLL so vfs fifo functions can get at the file flags to check FREAD/FWRITE if needed.
Avoid a NULL dereference in fd_getfile_mode().
5.6 and 5.7 SECURITY FIX: a remote user can crash httpd(8).
A source code patch exists for 5.6 and 5.7.
5.6 and 5.7 SECURITY FIX: malformed binaries could trigger kernel panics or view kernel memory
A source code patch exists for 5.6 and 5.7.
5.6 and 5.7 SECURITY FIX: multiple issues in cpio(1)/pax(1)/tar(1).
A source code patch exists for 5.6 and 5.7.
Don't add a separate .got.plt section as it would result in a partially writable GOT. ld.so(1) will properly write-protect the single .got.
Prevent a use after free in tun(4).
In ix(4), set the correct media type for 1000baseLX SFPs.
In grep(1), warn when the user specifies -R but no files, like GNU grep.
Allow use of 1Gb 1000baseLX SFPs in 82599 ix(4) SFP+ port.
Optimise sensor I/O in upd(4).
Introduce fd_getfile_mode() and use it where fd_getfile() is directly followed by a mode check.
Fix two assertion failures in mandoc(1).
Add the tmux and tmux-256color entries to termcap(5) and terminfo. This can be used inside tmux for correct italics support.
In tmux(1), if default-terminal is set to "screen" or "screen-*", follow historic screen(1) behaviour and send smso (standout) instead of sitm (italics) for SGR 3.
Fix a use after free and a NULL pointer access in mandoc(1).
Support passing a template file for the auto-allocation to disklabel(8).
Fix an fd leak in relayd(8).
In sshd_config(5), allow ListenAddress, Port and AddressFamily in any order (bz#68).
Avoid a NULL dereference in CBS_get_any_asn1_element().
In libtls, reject a dNSName of " " for the subjectAltName extension, per RFC 5280.
Explicitly include .codepatch and .codepatchend in .rodata such that the binutils 2.17 linker doesn't make them disappear.
Protect the per-process itimerval structs with a mutex.
On hppa, don't grab the kernel lock for clock interrupts. The way we use mutexes these days is incompatible with that practice and leads to deadlocks.
In sf(4), fix a memory leak in an error path.
In tmux(1), add select-layout -o to undo the last layout change.
In file(1), fix a memory leak in an error path.
In the installer, rework sshd enable root login questions in light of sshd PermitRootLogin default change. The new default is not to ask to enable root logins when a non-root user has been added.
Make sshd(8) default to PermitRootLogin=no.
Do not call nd6_purge() before purging the IPv6 addresses of a detached interface. This fixes a use after free introduced in r1.98 of src/sys/netinet6/in6.c.
In file(1):
Add simple privilege separation.
Use a systrace(4) sandbox with a short whitelist of allowed syscalls for the file(1) child process.
In upd(4), parse the HID descriptor multiple times to find sensors. This avoid lookups in the hot path for sensors that depend on the value of others.
In tmux(1), if the requested pane is already active, do not unzoom the window (or do anything else). This prevents mouse clicking when zoomed causing unzoom.
Correctly write the 64bits of the HID 1, 4 and 5 registers on powerpc.
Allow "sshd -f none" to skip reading the config file, much like "ssh -F none" does.
In file(1), don't support -s on FIFOs.
Let bgpd(8) check the length of the control socket path to make sure it fits -- just like bgpctl(8) does.
Fix a typo in sndiod(8): the buffer size should be 7680 rather than 7860.
Get dwc2 working on octeon:
Transplant the clock setup code from octhci.
Add a bus space tag to deal with dwc2 using little endian addressing.
ump up the rx fifo size, necessary for umass/sd to work.
Support checksum offloading for IPv4 TX on vio(4).
In bgpctl(8), for every policy we write out, flush the output so we don't get a partially written line.
On i386, disable PAE when switching to the hibernate resume pagetables. This makes (un)hibernate work with the new PAE pmap.
On i386, enable NX support in the resume path. This makes suspend/resume work with the PAE pmap.
On i386, only enable PAE if the CPU we're running on has NX support.
Bump i386 MAXDSIZ to 3 GB.
Make the Belkin Components F5U109 Serial work at 115200 baud in umct(4).
Require a PT_LOAD segment's p_filesz to be no larger than its p_memsz.
In the IRR parser of bgpctl(8), ignore case when reading the tokens.
We are now following the ABI and always clear cld on function entry, so remove the extra CLD instructions from when that wasn't true.
In file(1), only print MIME warnings when warnings are enabled.
Repair boot device detection when booting off the second SCSI controller on AV530.
Update to perl 5.20.2.
In file(1), fail if a \ appears at EOL of a magic(5) file rather than continuing off the end of the buffer.
In LibreSSL, don't ignore the reference count in X509_STORE_free.
In tmux(1), explicitly cancel mouse "button" mode. This happens implicitly with some of the other things we send with xterm, but not with urxvt.
In m4(1) and make(1), add a check for overflow while doubling.
In LibreSSL, check for invalid leading zeros in CBS_get_asn1_uint64.
In bgpd(8), allow rules that match directly on the peer AS. Also adjust the IRR ruleset output to include the declared peer AS instead of hoping they listed their neighbor IP address.
In httpd(8), prepend files or directories containing ":" with "./" in directory indexes as per RFC 3986.
In bgpctl(8), handle an IRR record of "export ... action X" the same way we handle "import ... action X".
Add a quirk to azalia(4) for the Cirrus Logic CS4208 which is needed for MacBookAir6,1.
In tmux(1):
Set up the signal handler earlier so that we don't get zombies.
Allow choice options (multiple states) to be toggled between states 0 and 1.
Set the working directory for run-shell and if-shell.
Enable PAE mode for those CPUs that support it. This allows us to use the NX bit for userland and kernel W^X. Unlike the previous c.2008 PAE experiment, this does not provide > 4GB phys ram on i386 -- PAE is solely being used for NX capability this time. If you need > 4GB phys, use amd64.
Make sure we keep the whole recursive mapping of the PDP instead of just the mapping for the first page when tearing things down.
Remove tip(1): it has been superseded by cu(1).
In file(1):
If ~/.magic exists but can't be used, fail rather than silently falling back to /etc/magic.
Do not attempt to use ~/.magic if running as root (or issetugid()).
Add a new implementation of file(1). This is a simplified, modernised version with a nearly complete magic(5) parser but omits some of the complex builtin tests (notably ELF) and has a reduced set of options.
Revert r1.7 of src/sys/arch/powerpc/include/atomic.h (implement the MI atomic API for PowerPC). This code triggers an off by one in device_unref().
Enable the NX bit and use it in the PAE pmap code. PAE is still disabled while we're chasing at least one remaining bug.
Fix a segfault in user(8).
In ssh-agent(1), add the -D option to leave ssh-agent in foreground without enabling debug mode (bz#2381).
Use "softintr_pic0" instead of "softintr_fakepic" when faking a struct device so there is enough space in the buffer for a NUL and the unit is included in the string.
Fix a memory leak in ssh-askpass(1).
In xlock(1), don't read past the end of an array.
Fix a crash in httpd(8) and relayd(8): we cannot log errors with server_close() before allocating clt_log evbuffer.
Fix a 13 year old typo that should be responsible for the unhappiness of UVM on PowerPC architectures.
Replace the use of struct ifqueue in pipex with mbuf_queues.
In sshd(8), check for and reject missing arguments for VersionAddendum and ForceCommand (bz#2281)
Implement the MI atomic API for PowerPC to avoid using gcc builtins that include extra sync operations.
Unknown certificate extensions are non-fatal in ssh, so don't fatal when they are encountered (bz#2387).
In tmux(1):
Fix moving windows to nonexistent indexes when renumber-windows is off.
Do not die on USR1 if any of the socket parent directories are missing.
Always format real layout even when zoomed.
Look up indexes as number before name. This makes more sense if windows are named starting with numbers.
Remove an extra lcr3 that snuck into pmap_switch, responsible for various reaper panics.
In rtadvd(8), don't let rltime exceed 9000 seconds, per RFC 4861.
Avoid a use after free in mandoc(1).
In tmux(1):
Pass mouse events through to commands for if-shell.
Pass mouse events triggering a drag on to the application inside the pane.
Bind mouse dragging so that it is passed through to applications if they want it.
Revert r1.182 of src/sys/kern/subr_pool.c (try and place at least 8 items on a page if we're able to use large page allocators) again. Incoherent architectures aren't having much fun with it.
In ntpd(8), fix a memory leak if tls_read() fails.
Fix a memory leak in relayd(8).
Rework sgi mutexes to use the owner pointer as the lock (similar to r1.14 of src/sys/arch/alpha/alpha/mutex.c).
In tmux(1), add support for multiple key tables to commands to be bound to sequences of keys.
In the installer, fix asking for list of http servers via "?". This should fix scanning for wireless networks too.
In mandoc(1), avoid out-of-bounds read access. This sometimes prevented proper warnings about text nodes preceding the first section header.
In tmux(1), make jump-to-backward/jump-to-forward repeatable with jump-reverse/jump-again.
Remove a typo introduced in r1.185 of src/sys/net/route.c. Because of this typo, a local route was always created.
Do not treat loopback interfaces as p2p interfaces and create only one route to ::1.
Always call rt_ifa_dellocal(9) when removing an IPv6 address.
In ping6(8), add a mac to the timestamp payload and calculate it with siphash (r1.119 and r1.121 from src/sbin/ping/ping.c).
In ping(8), fold the icmp seq number into the mac.
In tmux(1):
Support setting the default window and pane background colours.
Rewrite of tmux mouse support which was a mess.
Honour renumber-windows when unlinking a window.
5.5, 5.6 and 5.7 SECURITY FIX: logic error in smtpd(8) handling of SNI.
A source patch is available for 5.5, 5.6 and 5.7.
Fix incorrect logic in smtpd(8) that could lead to unexpected client disconnect, invalid certificate in SNI negotiation or server crash.
Add support for x2apic mode. This is currently only enabled on hypervisors.
In mandoc(1), if an explicit line break request (.br or .sp) occurs within an .HP block, the next line doesn't hang, but is simply indented.
If apropos(1) finds no match, print "nothing appropriate" to stderr similar to what the old apropos did.
Update to sqlite3 3.8.9.
In ping(8):
Add a mac to the timestamp payload and calculate it with siphash.
By default fill the ping payload with a chacha stream instead of an unvarying payload. By aggressively varying the payload we hope to generate more opportunities for dodgy network equipment to show errors.
In xhci(4), do not truncate possible remaining transfer length.
Remove emulation of OSS audio ioctls from Linux emulation.
Implement binary code patching on i386.
Enable the REG_READ ioctl.
Don't lock the file for "vi -R" or "view".
Work around what appear to be CPUID lies about the monitor-line size. This makes the mwait-based idle loop actually work.
Convert many atoi() calls to strtonum() in userland, adding range checks and failure handling along the way.
Remove kdriver/wscons code from Xserver(1).
In systat(1) avoid calling freeifaddrs() uninitialised pointer in an error path.
In httpd(8), strictly accept CRLF for newlines.
In install(1), use futimens() to preserve timestamps with subsec precision.
In pf(4), do not include padding of Ethernet packets in reassembled fragmented packets.
In ssh, don't try to cleanup NULL KEX proposals in kex_prop_free().
Change alpha mutexes so they record which cpu owns the lock rather than just if the lock is held or not.
Remove the unsupported SADB_X_IDENTTYPE_CONNECTION, unused ipsp_parse_headers, and stubs and support code for NIC-enabled IPsec.
Fix a crash in the bgpctl(8) "network bulk" command.
In ualea(4), crank the timeout and decrease the buffer size to not end up dropping all the entropy provided by the device. Also make sure we match the right endpoint.
Tweaks in utimensat/futimens handling:
Always update ctime, even when both atime and mtime are UTIME_OMIT (at least for ufs, tmpfs, and ext2fs).
Correctly handle a timestamp of -1.
Don't call record_login() in monitor when UseLogin is enabled (bz#378).
Add some missing options to sshd -T and fix the output of VersionAddendum HostCertificate (bz#2346).
In mandoc(1), restore the page headers and page footers in the HTML output.
Remove unfinished and unused support for socket-attached ipsec-policies.
In pkg_add(1), expand the %a, %c, %m and %v sequences in PKG_PATH.
Add ualea(4) to support the Araneus Alea II TRNG.
Plug a memory leak in sshd(8).
In tmux(1), fix some issues in bright colour handling.
Make tls_close(3) more robust.
In tmux(1), fix setting old-style window -fg/-bg/-attr options that aren't global.
In tun(4), fix a typo introduced in the niq_enqueue() conversion. This should fix a panic reported by many.
Import libepoxy 1.2, a library for handling gl/glx/egl function pointer management. This is needed by glamor egl in the xserver which is in turn needed to get acceleration with some hardware on xf86-video-ati.
Update to xf86-video-ati 7.5.0.
Make ipsp_address thread safe.
Remove support for storing credentials and auth information in the kernel. This code is largely unfinished and is not used for anything.
In uchcom(4), make sure we close the interrupt pipe when the device is detached.
Initialize RX/TX on re(4) slightly later. It appears that newer chips don't set up DMA correctly until more configuration has been done -- enabling RX too soon causes DMA to bad places.
Perform IPsec bypass check on a socket before performing TDB lookups.
In sed(1), correct a multiplication idiom during xreallocarray() and avoid an integer overflow.
In ssh, deprecate the ancient, pre-RFC4419 and undocumented SSH2_MSG_KEX_DH_GEX_REQUEST_OLD message.
Prevent use after free in mg(1).
Let nl_langinfo(CODESET) return "US-ASCII" as the name of the character codeset for the POSIX/C default locale. This is the preferred IANA name and also used by FreeBSD.
Update to xf86-video-intel 2.99.916. This fixes a display bug. Newer X.Org (2.99.917 or master) versions cause corruption on older machines (X40, i965), probably caused by a bug in our kernel. This is under investigation by kettenis@.
Bring PAE code back to life on i386. More specifically, bring the PAE pmap on i386 closer to the current non-PAE pmap. This allows us to take a big next step toward better i386 W^X in the kernel (similar to what we did a few months ago on amd64). Unlike the original PAE pmap, this diff will not be supporting more than 4 GB physical memory on i386 -- this effort is specifically geared toward providing W^X (via NX) only. There still seems to be a bug removing certain pmap entries when PAE is enabled, so PAE mode is left disabled for the moment.
Switch example NSD config to splitting master and slave zones into different subdirectories and create these in mtree.
Disable the pool garbage collector. There are reports of strange lockups on various multiprocessor architectures and this is the only interesting diff in the window.
In softraid(4), directly handle ioctls issued to a SCSI device associated with a softraid volume, ignoring any device name specified in the bio(4) ioctl struct. Amongst other things, this makes bioctl -d now work with DUIDs.
In softraid(4), re-enable the RAID 5 discipline and add support for restarting rebuilds on it.
Remove OPENSSL_issetugid() from LibreSSL. By default on systems lacking true issetugid(), OPENSSL_issetugid() returns 0, falsely indicating safety. This means OPENSSL_issetugid() fails to make any sort of promise about safety, in fact it is just the opposite.
Update to xf86-input-synaptics 1.8.2.
Remove all getenv() calls in LibreSSL, especially those wrapped by issetugid(). getenv()'s wrapped by issetugid() are safe, but issetugid() is difficult to implement on many operating systems.
In httpd(8), always check the return value of proc_composev_imsg() and handle failures appropriately. Otherwise imsg construction can silently fail, resulting in non-obvious problems.
Let vi(1) use resizeterm(3) instead of reinitializing curses on window resizes, which was leaking massive amounts of memory.
In tmux(1), add a -x flag to copy-selection, append-selection and start-named-buffer to prevent it exiting copy mode after copying.
Replace the use of ifqueues for most input queues serviced by netisr with niqueues.
In ehci(4), implement full-speed isochronous transfers support with opportunistic micro-frames scheduling. More work is required to properly budget and schedule micro-frames, most of it at the HUB level. But this lets people use USB1.1 uaudio(4) devices on ehci(4)-only systems.
Add support for CRC-enabled elantech v3 touchpads to pms(4).
In ssh(1), don't send hostkey advertisments (hostkeys-00@openssh.com) to current versions of Tera Term as they can't handle them. Newer versions should be OK.
In vlan(4), don't inherit the parent interface's hardmtu as the vlan interface's mtu when it gets set up. Instead, allow the vlan interface's mtu to be raised to the parent's hardmtu in SIOCSIFMTU handling.
In zmore(1) and zless(1), accept options starting with "+".
In whois(1), improve the lookup of gTLDs.
Make the sparc64 pmap (more) mpsafe by protecting both the pmap itself and the pv lists with a mutex.
Plug a memory leak in pf(4).
Fix a regression on re(4) chips that have 7k jumbo support.
Move vmap back to kernel_map/uvm_km_valloc as it's allowed to fail. This should fix the Dell 2950 when it gets stuck during boot.
In tsec(4), prevent the watchdog from firing when no cable is plugged in but the interface is brought up.
In iwn(4), don't leak the chip's hardware address during scans when a randomized address is set by the user.
In tmux(1), when replacing, don't free the old paste until after the new one's name has been copied. This fixes a use-after-free in window-copy.c.
Introduce a garbage collector for (very) idle pool pages.
Remove the obsolete timezone(3) function.
Make pthread_atfork(3) track the DSO that called it like atexit(3) does, unregistering callbacks if the DSO is unloaded. Move the callback handling from libpthread to libc, though libpthread still overrides the inner call to handle locking and thread-library reinitialization.
In mandoc(1), do not mistreat empty arguments to font alternating macros as vertical spacing requests.
Remove DES support from crypt(3).
Add support for an efi-app-x86_64 target to binutils. This is needed for UEFI bootloader work.
In mandoc(1), use the default width for .RS without arguments. This reduces groff-mandoc differences in base and Xenocara by about 4%.
Update to xcb-util 0.4.0, xcb-util-image 0.4.0, xcb-util-keysyms 0.4.0, libXxf86vm 1.1.4, libXvMC 1.0.9, libXdmcp 1.1.2 and libX11 1.6.3.
In pkg_info(1), check that the info of distant packages is signed.
In pkg_add(1), mark installed locations as "trusted" so that pkg_info does not check sigs on them.
In realloc(3), when expanding a region, actually use the free page cache instead of simply zapping it. This can save many syscalls in a program that repeatedly grows and shrinks a buffer.
Work-in-progress support for non-accelerated X11 on some sti(4) frame buffers; based upon the old HP ngle X11 driver. Currently limited to CRX (720/735/750), Timber (710, old 715), Artist (712, 715) and EG (B-series). However, the colormap isn't set up correctly on Timber and EG yet.
Various improvements to sort(1):
Do not permute command line arguments, but still support the obsolescent "-o outfile" after input files syntax.
The -b flag should only apply when key fields are specified. If -b follows -k it has no effect.
For the -g flag, treat non-floating point keys as 0, similar to -n. This makes "sort -gu" and "sort -nu" behave similarly and passes our sort regress tests.
Update to sqlite3 3.8.8.3.
Give man(7) section and subsection headers hanging indentation. This reduces groff-mandoc differences in base by about 2.5%.
Better implementation of rounding rules in mandoc(1).
Show the remote labels in the ldpctl(8) "show lib" command even if they are not installed in the FIB.
Remove lo protection in ldpd(8). There's no need to protect the 127/8 network since it is filtered before being sent to lde.
Show the full LIB in the ldpctl(8) "show lib" command.
Add support for commit ids to "opencvs status".
Fix the modified timestamp in the output of "opencvs status".
In mandoc(1), don't allow breaking the output line after hyphens following escape sequences. Improves tic(1), sxpm(1) and a few Perl manuals.
Use config_suspend() instead of dereferencing ca_activate directly to support drivers that do not need any specific suspend/resume magic and do not have an activate function. This is needed at least by kauaiata(4).
In mandoc(1), fix a quirk with respect to an empty .HP.
In sti(4), fix an unsigned vs signed comparison causing an infinite loop for the WSDISPLAYIO_PUTCMAP ioctl.
In sort(1):
If -S has been supplied multiple times, only take last one into account.
If -c (or -C) has been specified, only perform that action and ignore -o among other arguments.
Allow only one input file with the -c and -C flags.
In apropos(1), man(1) and mandoc(1), don't hardcode /usr/bin/ as the path to more(1).
In sort(1), prevent an integer overflow when parsing the -S argument as percentage. Also make sure that the parsed memory amount won't be larger than SIZE_MAX to properly support 32-bit systems.
Change gcc and ld semantics to make static PIE the default when invoking "cc -static".
Many improvements to sort(1), including:
Use strtonum(3) to parse the argument to --batch-size.
Use mkstemp(3) to generate a new temporary file name.
Use reallocarray(3) where appropriate.
Prevent a tiny signal race by blocking signals when inserting into the tmp_files list.
Check for overflow when handling buffer size suffixes.
Run most of the vnet(4) interrupt handler without holding the kernel lock.
In httpd(8), zero the tls cert/key length variables when inheriting a server configuration for multiple listen statements in a server block. Otherwise httpd(8) will crash when a listen statement with tls is followed by a listen statement without tls.
Prevent ssh(1) from warning about SSH1 keys present when compiled without SSH1 support. Also identify SSH1 keys when scanning, even when compiled without SSH1 support.
Fix an fd leak in ssh(1).
Let sort(1) ignore $TMPDIR if setuid or setgid.
Don't make the -m and -c options of sort(1) mutually exclusive.
Let the vlan(4) mtu be limited by the parent's hard mtu, not the current mtu. This makes it possible to have networks on the "native" (untagged) vlan on an interface at 1500, while setting a child vlan interface's mtu to jumbos.
In sort(1):
Call atexit() to clean up temporary files on error.
Use mkstemp() to create the temporary file when the output file equals one of the input files.
Preserve the original file mode on the temporary file.
Check for write access on the original file before creating the temporary one.
In ssh-keygen(1), if a user tries to add a comment to a non-RSA1 key and has entered their passphrase, explicitly clear it before exit.
Tell the firmware to shut down the fan management thread on the last generation of G5s. Without this mpi@'s PowerMac11,2 hang when smu(4) attaches.
Move the default font path from /usr/local/lib/X11/fonts to /usr/local/share/fonts to match XDG_DATA_DIR (where Desktop tools will look for by default).
Fix the repeating keys/delay problem that occurs on newer ThinkPads when touching the trackpad/trackstick while typing during the installer in a less invasive way.
Update to xkeyboard-config 2.14.
Some work on macppc G5 interrupts.
Allow syslogd(8) to read configuration files with arbitrary line lengths. Also ensure the configuration file has been read in full in order to prevent syslogd(8) from running with incomplete configuration.
Update to xcb-util-cursor 0.1.2.
Fix an uninitialised memory read in ssh(1) when parsing a config file consisting of a single nul byte.
In mandoc(1), handle special punctuation modes for -Tpdf.
Restore user-loaded vga fonts upon switching from X11 to VT and upon resume.
Let esp(4) correctly match SUNW,fas in the boot path.
In tcpdump(8), remove an extra line when printing AH and RIP packets.
Let vnet(4) reject packets that are too large.
Revert r1.29 of src/usr.bin/telnet/sys_bsd.c (don't clear ICRNL when editing mode is off, so that character local echo mode don't echo ^M locally) as this causes problems sending CR to some Cisco equipment.
Make sure that pkg_add(1) checks specialfiles.
Initial support for the SABRE SD board.
Fix a memory leak in cwm(1).
Match rtsx(4) on the RTS5249 found on the Dell XPS 13 and treat it as an RTS5229.
In ntpd(8), avoid overflow on 32-bit time_t systems when converting timeval to NTP time.
For ancient pre-v8 sparc, expand kva.
Move man.conf(5) from /etc/ to /etc/examples.
Add the "output" directive to man.conf(5).
Let security(8) handle lines in mount(8) output that end with "on" (which can happen for NFS mounts).
Let security(8) handle incomplete lines in /etc/passwd that end before the home directory field.
Add the "manpath" directive to man.conf(5) to override the default search path.
In pkg_add(1), backout -DSHORTENED semantics by default for now.
Add initial support for RFC 7427 signatures to iked(8).
Allow input/printing/conversion of terabyte sizes in fdisk(8).
Fix configuring MPLS routes on mpe(4).
Let httpd(8) translate CGI environment variables in accordance with RFCs 7230 and 3875.
Ban all-zero curve25519 keys in ssh, as recommended by the latest CFRG curves draft.
Update to libdrm 2.4.60.
Determine if the trackstick buttons are wired to the trackpad and need to be re-routed to the trackstick. Without this change the buttons on 2015 Thinkpads get picked up as extended buttons that show up as scroll up/down. Remove the X1 Carbon 2015 (LEN0048) and X250 (LEN0046) from the top button area/soft buttons quirks list. Also avoid using the quirk list entirely if the capability bit is set.
Save/restore AVX registers and other XSAVE-managed state information when entering/leaving a signal handler like we already do the the FPU and SSE state. This should make it possible to use AVX instructions in signal handlers.
Ignore v1 errors on ssh-add -D; only try v2 keys on -l/-L (unless compiled with SSH1 support).
With a per interface IPv6 stateless adress auto configuration flag it is possible to allow IPv6 forwarding and SLAAC at the same time. This is needed for RFC 7084.
In ksh(1), bind the Delete key (ESC[3~) to delete-char-forward.
Fix a memory leak in ssh(1).
Work around broken device-tree in PowerMac7,2 and PowerMac7,3 (K2 systems) and get the correct offsets from the "i2s" node.
Remove lmc(4), san(4) and lmccontrol(8).
Use chacha20-poly1305@openssh.com as the default cipher in ssh.
Disable SSH protocol 1 in ssh.
Fix a memory leak in relayd(8).
Don't let rcmdsh(3) fail if it is passed a non resolvable hostname. Instead, silently ignore the fact and instead let the underlying ssh (or $RSH) command handle it.
Fix memory leaks in tempnam(3) error paths.
Fix NFS boot on macppc.
In ping6(8), bump the size of the time types on the wire to 64 bit (port of r1.116 of src/sbin/ping/ping.c).
In ping(8) and ping6(8), obfuscate the monotonic clock values put on the wire by offsetting them with a random value.
Don't let ssh-keygen -A try (and fail) to generate ssh v.1 keys when compiled without SSH1 support RSA/DSA/ECDSA keys when compiled without OpenSSL (bz#2369).
Make setting 11a rates and scanning on iwm(4) conditional on the 5GHz support bit in the nvm.
Make be(4) work on sun4c.
Add sysconf() extensions PHYS_PAGES, AVPHYS_PAGES, NPROCESSORS_CONF and NPROCESSORS_ONLN to getconf(1).
On amd64, add support for saving/restoring FPU state using the XSAVE/XRSTOR. Limit support to the X87, SSE and AVX state. This gives us (almost) full AVX support.
On sparc, abort attach of iommu requiring boards on non-iommu systems.
Don't let ldpd(8) try to send address withdraws to neighbors that are unreachable after an address removal in the system.
Let ldpd(8) remove attached adjacencies whenever an interface is disabled for whatever reason. This will speed up the convergence process.
Don't let ldpd(8) assign labels for BGP routes. This would be very resource consuming in some scenarios and unnecessary.
In vnet(4), considerably improve the reliability of re-establishing network connections between domains after some sort of hickup.
Let man(1) fall back to /usr/share/man:/usr/X11R6/man:/usr/local/man as default search path if no path is given via -m, -M, $MANPATH and /etc/man.conf.
Fix a memory leak in libtls with repeated use of tls_connect().
In sort(1), use the hw.usermem sysctl to determine the amount user (non-kernel) memory instead of sysconf(_SC_PHYS_PAGES) (which also counts pages wired by the kernel). Don't try to use a memory buffer larger than the datasize hard resource limit.
Work around buggy AML trying to access PCI config space using PCI function number FFFF.
In renice(8), when mixing historic BSD syntax (where the priority is absolute) with the -n flag (where the priority, according to POSIX, is an increment), the increment specified via -n will only affect the entries that follow it.
Support jumbo frames on re(4).
Rather than disabling checksum offload in re(4) for all packets, let it advertise checksum offload to the stack for small (normal-sized) packets and do the checksum itself in software for large packets.
Reintroduce r1.173 of src/sys/kern/subr_pool.c (try and place at least 8 items on a page if we're able to use large page allocators). This was backed out because of fallout on landisk which has since been fixed.
Unbreak WEP/WPA on AR5211 ath(4) devices by setting hardware WEP keytable entry types to NULL, as done for AR5212 devices. ath(4) uses software crypto.
Re-apply r1.115 of src/sys/dev/pci/if_ix.c (when setting up advanced TX descriptor, use m_getptr to locate the IP or IPv6 header instead of assuming contiguousness of the target buffer across Ethernet and IP/IPv6 headers) that got accidentally reverted.
Fix a memory leak in an error path in LibreSSL (from OpenSSL commit 5e5d53d341fd9a9b9cc0a58eb3690832ca7a511f).
Fix a small memory leak in sort(1).
5.6 and 5.7 SECURITY FIX: several crash causing defects in OpenSSL (CVE-2015-0209, CVE-2015-0286, CVE-2015-0287, CVE-2015-0288 and CVE-2015-0289).
A source code patch is available for 5.6 and 5.7.
5.5 SECURITY FIX: two possible crash causing defects in OpenSSL (CVE-2015-0286 and CVE-2015-0292).
A source code patch is available for 5.5.
Fix CVE-2015-0209, CVE-2015-0286, CVE-2015-0287 and CVE-2015-0289 in LibreSSL.
Deal with half-configured control pipes in dwc2, using the same workaround as in ehci(4) and ohci(4).
Use struct timespec internally in pax(1). This gives nanosecond precision to the -rw option and a basis for support of mtime and atime values in pax-format extended header records.
In route(8), instead of embedding interface names in a sockaddr, use their indexes when adding route entries with the -link option. This prevent the ARP layer to take the name of your interface for an Ethernet address.
Rework the virtual memory layout on SRMMU systems (sun4d/sun4m) to use a much lower VM_MIN_KERNEL_ADDRESS, since these systems are not crippled by the Sun-4 MMU hole and have the real 4GB of address space. Kernels running on Sun-4 MMU are not affected and will still be restricted to the existing 128MB of kernel space, with 1GB - 128MB of user space.
Make init(8) static PIE.
Revert r1.52 of src/sys/arch/sparc/dev/zs.c. This reduces the number of spurious zs interrupts seen on sun4c, albeit not completely.
Speed up large directory reading with opendir(3).
Fix mpii(4) on i386.
Reenable the pa1.1 fallback code for sha256 on hppa.
"Handle" wccp2 packets if net.inet.gre.wccp is set to 2 by truncating skipping the wccp 2 header.
5.5, 5.6 and 5.7 SECURITY FIX: buffer overflows in libXfont (CVE-2015-1802, CVE-2015-1803 and CVE-2015-1804).
A source code patch is available for 5.5, 5.6 and 5.7.
Update to libXfont 1.5.1 which contains fixes for CVE-2015-1802, CVE-2015-1803 and CVE-2015-1804.
Fix swap auto-allocation in disklabel(8) for machines with very little memory.
Replace sort(1) with the implementation from FreeBSD.
In the installer, don't ask about xdm if the answer to the X question was "no" (restores previous behaviour that got lost in r1.780 of src/distrib/miniroot/install.sub).
Prevent a race in ehci(4) resulting in an infinite loop printing "ehci_idone" messages.
Fix erratic behaviour of dig(1) and nslookup(1) when no (valid) nameserver is configured in resolv.conf.
Explicitly handle SIGPIPE in mandoc(1). This prevents a "Broken pipe" message from csh(1).
Repair a missing state insert in pf(4).
Try a third approach for handling pms and pckbd interrupt storms, when there is no pms driver in the kernel.
Update to sqlite3 3.8.7.4.
Avoid a NULL pointer dereference in LibreSSL. A NULL pointer could be dereferenced when X509_REQ_set_pubkey() calls X509_PUBKEY_set() with pktmp. According to OpenSSL, this is the fix for CVE-2015-0288.
Prevent a use-after-free in httpd(8).
Allow the xdm(1) greeter to set the background color of the input fields. The "inpColor" resource is used for that.
In mandoc(1), avoid off-by-one read access to the termacts array, which could sometimes result in missing line breaks before subsection headers.
In the installer, eliminate the question "Which cd?" and just show the available cd's in the "Location of sets?" prompt.
Allow for multiple concurrent devopen() calls, and fill the .readdir member of fs_ops. This makes the "ls" command finally work in the macppc bootloader.
In last(1), use ctime_r to avoid a re-entrancy signal race.
Check for the size of the supposed destination address when constructing the Ethernet frame. This prevents an overflow.
The RTL8411 is supported by rtsx(4).
Rewrite the sh(1) manual page and confine it to document features supported by POSIX-compliant shells.
In ospfd(8), when removing interfaces in the RDE, also remove all the RDE neighbors that are part of that interface. This prevents use-after-free situations.
Make wi(4) on PCMCIA work on luna88k.
In makewhatis(8), fix hardlink detection on platforms having padding in struct inodev, typically 64-bit platforms.
Use the shorter ofwbootfd (without softraid support) on the miniroot. This fixes booting of cdNN.iso and installNN.iso on the Blade 150.
Make "boot -c" support work on a variety of newer machines. This is not expected to harm older machines.
Handle the way some BIOSes initialize newer-style nubbins/touchpads into strange (advanced) modes, which can muddle up the pckbc pipe. This is experienced as 10-second typing pauses and strange repeat behaviour on the RAMDISK (and is caused by "lightly brushing" the touchpad).
Automatic parent interface selection no longer works in ifconfig(8) (see r1.245 of src/sys/netinet/ip_carp.c); carpdev is a required argument now.
Escape ! characters for tab completion in ksh(1). This is necessary if using "set -o csh-history".
In pax(1)/tar(1), try to recognize a few well-known compression formats, and report them to the user.
Remove setgid kmem support from systat(1). As a result, the netstat view of systat is slightly different.
In ping(8), bump the size of the time types on the wire to 64 bit.
Remove tcopy(1).
Remove setgid kmem support from eeprom(8). As a result, root privileges are generally needed to run this.
Remove setgid kmem support from pstat(8). As a result, root privileges are needed to use the -d and -v options.
In man(1), when interpreting the -O argument as a macro name fails, fall back to showing Nd rather than not showing anything.
The 3160 should work with iwm(4).
Make ping(8), ping6(8), traceroute(8) and traceroute6(8) resistant to local wall clock changes which can skew the intervals reported or make them go negative.
Add back r1.206 of src/usr.bin/ssh/packet.c that fixed some leaks in error paths and was reverted by mistake.
Set verbosity to 1 (the default is 0) in nsd.conf(5) so that incoming notifies and zone xfers are logged.
Improve locking in amd64 pmap using mutexes.
Disable the database file by default in nsd.conf(5). It is believed to be a saner default for the common use case and there is a problem with missing records on shutdown.
Fix a regression in man(1) where the first manual shown is not properly displayed in the pager if that manual is compressed.
In vi(1), display "Search wrapped" even when searching from the end of the file.
In wdc(4), do not attempt to read the status register unless WDCF_IRQ_WAIT is not set; this used to be the case but got broken in r1.113. This fixes the Acard ATP865-R.
In worm(6), make the worm grow faster on larger terminals. This is more fun than starting with an enormous pile of worm at the start.
Don't do IPv6 SLAAC for prefixes with a preferred lifetime of zero, per RFC 4941.
In mandoc(1):
Fix vertical spacing at the beginning of tables: man(7) always prints a blank line; mdoc(7) doesn't.
Don't mistreat negative .sp arguments in mdoc(7) as large positive ones. Instead, use the same logic as for man(7).
Flush the line preceding a table before clearing the right margin, so that that line isn't output with unlimited width.
Make httpd(8) and relayd(8) TLSv1.2-only by default.
Make -DSHORTENED the default in pkg_add(1).
Move i386 pvlists to pool backed, and improve the locking using mutexes.
Various fixes for cpio(1)/pax(1)/tar(1):
Prevent an archive from escaping the current directory by itself.
For tar without -P, if a path in the archive has any ".." components, then strip everything up to and including the last of them (if it ends in ".." then it becomes ".").
For directories whose times or mode will be fixed up in the clean-up pass, record their dev+ino and then use open(O_DIRECTORY)+fstat() to verify that we're updating the correct directory before using futimens() and fchmod().
Correct buffer overflow in handling of pax extension headers, caught by the memcpy() overlap check.
--------
Changes made between OpenBSD 5.6 and 5.7
Update unbound(8) to 1.5.0.
In mandoc(1), make .Ao and .Aq renders as "<>" after .An, and as "\(la\(ra" elsewhere, just like groff.
Fixed for mandoc(1) db for NAME_FIRST before its first use, NAME_FILE duplication and correct NAME_FILE mask for .so links.
Delete KERN_VNODE sysctl(3).
Add support for exporting relayd(8) statistics via AgentX/snmpd(8).
Add support for AgentX subagents in snmpd(8).
Fix ssl memory leak with pkey in client key exchange.
Bugfix for grdc(6) to run for the specified amount of seconds, not for a fixed amount of iterations. Makes a difference on slow terminals.
Make mandoc(1) let escape sequences terminate high-level macro names, and when doing so, they are ignored.
Make binutils recognize sahf/lahf for amd64 code, backported from 2.17.
For newer re(4) chipsets, add support for stopping the operation within re_stop().
Let mandoc(1) support the ".if v" conditional operater for groff compatibility.
Sync ssh(1) AES code to the one shipped with OpenSSL/LibreSSL.
Make binutils recognize dcbzl for PPC code, backported from 2.17.
Disable the page zeroing thread on MP mips64 kernels.
Added support for sigwinch resizing in grdc(6).
Make mandoc(1) ignore invalid directories in man.conf and MANPATH, but complain about invalid directories given on the command line.
Avoid iteration over end of string in patch(1).
On ppc platforms, make pmap_zero_page MP-safe by using the directmap.
Enable GOST cipher in libcrypto.
For cas(4), use pa_device to ensure each MAC address of a multi port board is unique.
When running mandoc(1) in man(1) mode, set match order to file name over .Dt name over first .Nm entries over other NAME .Nm enties over SYNOPSIS .Nm entries. Re-run "makewhatis" to effectuate this change.
Fix NULL pointer dereference in ssh(1) key loading.
Activate support in pkg-config(1) for "package != version" requests.
Imported perl 5.20.1.
Add Cammelia cipher to libcrypto.
Make /var/tmp a symbolic link to /tmp. Move /tmp to the same 7-day expiration that /var/tmp had.
Added new function to libc, crypt_newhash(3).
Add quirks for "Realtek ALC885" found on MacMini3.1, unmutes the internal speaker, line input and hp output.
Reduce dhclient(8) risk by putting config file reading after forking the privilege separated child process but before getting hardware link.
Sync kernel AES code to the one shipped with OpenSSL/LibreSSL.
Make usbdevs(8) show super speed status in verbose output mode.
In ssh(1), fix KRL generation when multiple CAs are in use.
Make mandoc(1) correctly handle whitespace-only lines in regard to vbl and vis variables.
Two fixes to make Qemu and VMWare xhci(4) implementations work, always unmask the slow context for the Set Address command and use the right spl when wubmitting a transfer.
Allow cas(4) to retrieve the MAC address from the rom for NS Saturn based boards.
Reworked the sigwait() handling to fix ptrace() in some circumstances.
Add cas(4) devices to i386 and amd64 GENERIC kernels.
Change librthread to not restart syscalls on SIGTHR.
Fix in librthread to allow check for cancellation when a handled (but not waited for) signal occurs.
Use newly imported siphash algorithm for in_pcb hashing.
In dhclient(8), make -q and -d mutually exclusive.
Removed 'tcl' command from vi(1).
On ifconfig(8), move trunk(4) code outside #ifdef SMALL to allow trunk operation on RAMDISK kernels.
Implement atomic_* ops for the arm platform.
In mandoc(1), remove harmful byte swapping on big endian architectures.
Fix reversed logic when selecting log level in npppd(8).
Fixed use after free in npppd(8) when pool addresses change.
Add -b to splitw in tmux(1) like in joinw.
In the performance adjustment code, take a few more ticks before throttling down to handle situation where it is cpu intense but intermittenly idle.
In tmux(1), don't let force-width or force-height be less tha PANE_MINIMUM.
Store autoinstaller logfile in /mnt/var/log to be available after reboot.
Updated time zone data to tzdata2014j.
Do not hold the kernel lock when calling hardclock() and statclock().
When exploring the usb buses, do not probe the ports which status hasn't changed. Saves a lot of I/O when attaching/detaching devices.
Tweaked DHCPACK to DHCPINFORM log entries to more informative.
Speedup in mandoc(1) in man(1) mode without -a, stop searching after the first manual tree that contained at least one match.
Stop athn(4) from attaching to AR9300 devices due to unresolveed bugs.
For httpd(8), allow the log directory be configurable in the config file, rather than having it fixed as /logs in the chroot.
In xhci(4), do not reset the base address of the control endpoints ring when the second Set Address command is issued.
Make pf(4) ask for ICMPv6 checksum recalculation in pf_route6 since the addresses may have been tweaked.
bgpd(8) now outputs 32bit AS numbers in ASPLAIN format by default instead of AS_DOT+.
Socket closing fixes in the client rpc(3) code.
Implemented -h in mandoc(1) for preformatted (cat) pages.
Fix for ix(4) SFP+ module detection when booting without the modules plugged in.
Added support for USB 1.x devices below external hubs on xhci(4).
Make sure httpd(8) does't try to open log files when using syslog.
Changed the xhci(4) attach logic to set the address of a device. Fixes issues seen on root hubs with some Low/Full speed devices.
Plug an rtentry leak in route code.
Fix pf(4) state linking used to implement transparent relays for connectionless protocols.
Added GOST crypto algorithms to libcrypto. Not enabled yet.
Make tmux(1) expand formats in copy-pipe command.
When a usb(4) pipe is closed, only clear the memory of the corresponding endpoint context. Fixes a panic.
Stopped tmux(1) extending the line to full width on insert/delete character (leaves extra spaces when reflowing); only mark a line wrapped when the cursor actually goes off the end (not on newlines).
If resuming from sleep (zzz/ZZZ) and the lid is still closed, go back to sleep. Prevents accidental lid flex from waking the machine up.
Libtool moved to the comp set.
Enabled xhci(4) on i386 and amd64, for USB 3.0 support.
Fixed problems with iked(8) EAP state transition. Allows Win7 to establish the a tunnel again.
Fixed a race (and panic) in xhci(4) when submitting a command by using the appropriate spl(9) protection.
Removed the SSLv2 option from relayd(8); made "no sslv3" work as intended.
Added bcd(6) -l option to create "modern" 80 column cards.
Made malloc(9) calculate correct size before doing the free checks, to fix recent panics.
Enabled TLS extensions in ssl(8).
Fixed mac address selection with unnumbered carpdevs when using carp(4).
When tmux(1) copy mode is used for output, wrap the text.
Removed old curses support from vi(1).
Added V for tmux(1) "select line" with vi(1) keys.
In smtpd(8), stopped prepending the user ID in the local enqueuing "Received" line.
Implemented workaround for em(4) i218 watchdog timeouts that are triggered by heavy traffic.
Fixed sd(4) cards with rev C BeagleBone Blacks.
Added rgephy(4) for the RTL8211E phy in the LeMaker Banana Pi and Banana Pro.
Added atphy(4) to armv7, for the Atheros AR8031 phys in the AM335x starter kit.
Introduced SipHash (https://131002.net/siphash/), useful when adding protection against hash bucket flooding attacks.
Allow the five man(7) font macros to concatenate their line arguments. Removes bogus
when font macros are used in -Thtml "no-fill" mode.
Stopped dhclient(8) leaking static leases when the "lease {}" parsing fails or when a static lease supersedes an earlier one.
Fixed kernel stack overflow in carp(4) by preventing carp_send_ad_all() from re-entrant calls.
Stopped changing the gateway of local route(4) for p2p interfaces. Prevents a panic.
Updated to xterm(1) version 312.
Use the correct default MaxPacketSize for Full Speed usb(4) devices and make them work with xhci(4).
In passwd(1), removed support for all password cyphers except blowfish(3).
Removed ephemeral RSA key handling from ssl(8).
Add support for automatic DH ephemeral keys in ssl(8), so DH keys can be generated based on the server key length; use automatic DH ephemeral parameters instead of fixed 512 bit.
Removed ssl(8) support for ephemeral/temporary RSA private keys.
Renamed libressl to libtls, to avoid confusion.
Major bugsquashing with respect to -offset and -width in mdoc(7).
Do not enable interrupts before attaching usb(4). Fixes panic when an Express Card has usb(4) devices.
Support utf-8 and iso-8859-1 input by integrating preconv(1) utility into mandoc(1).
In mandoc(1) -Tascii mode, only print "<?>" for unicode escapes of unknown representation (not for character escapes with unknown names).
Tightened mandoc(1) unicode escape name parsing.
Fixed pipex(4) to return multicast packets to the caller so that npppd(8) can handle them.
Fixed pipex(4) to initialise DF bit in IP header for L2TP message, so packets larger than minimum MTU aren't dropped.
5.4, 5.5, 5.6 and -current SECURITY FIX: Fixed incorrect expansion of netmask for dynamic interfaces by pfctl(8). Stops potential elevation of access permissions for IPv6 traffic..
Removed execute permission from most pages in the kernel pmap(9) on powerpc.
Stopped supporting wsmoused(8) and X(7) in parallel. Code is racy and known to break mice upon resume.
Fixed regression in term.c r1.89: repaired handling of zero-width spaces (\&) in mandoc(1) utf-8 output.
Allow the current lease to expire without causing dhclient(8) to seg fault when it tries to get a new one.
Fixed possible infinite recursion in perl(1) Data::Dumper (CVE-2014-4330).
Improved mandoc(1) -Tascii output for unicode escape sequences: for the first 512 code points, provide ASCII approximations; provide approximations for some sequences above codepoint 512 via mandoc_char(7) character table.
When using the local enqueuer and the internal SMTP session fails, made smtpd(8) copy the original message to ~/dead.letter so it's not lost.
On hppa, fixed "read section header string table failed(0)" errors when attempting to boot lif.fs.
Fixed smtpd(8) so newaliases and makemap can parse multi-line aliases entries.
Stopped mandoc(1) attempting to parse empty equations. Fixes a null pointer dereference.
In mandoc(1), report arguments to .EQ if they have caused an error.
Don't attempt to suspend/resume a partially attached drm(4) driver. Fixes crash upon resume with ATI FireMV 2400 card.
Stopped the page zeroing thread launching on m88k multiprocessor systems. Avoids a deadlock between reaper and zerothread.
Added pane_input_off format to tmux(1).
Retired networks(5) support from amd(8) and getent(1).
Extended features in autoinstall(8).
No longer limit physmem to 2GB on hppa.
Removed networks(5) support from netstat(1).
Avoid an ssl(8) null pointer dereference that could be triggered by SSL3_RT_HANDSHAKE replays.
Allow reliable IPv6 communication between carp(4) master and backup across a shared IPv6 subnet.
URL-decode the httpd(8) request path.
Only redraw the tmux(1) pane when it has actually changed.
Reworked httpd(8) error messages: do not send details of 40x errors, to avoid possibility of javascript injection attacks.
Made tftp(1) cope with sending or receiving files beyond 65536 blocks in length.
Fixed du(1) regression, always report the size of files listed.
5.6 SECURITY FIX: disabled SSLv3 by default.
A source code patch is available for 5.6.
In getent(1), error out when hosts enumeration is requested.
Made mandoc(1) correctly parse spacing around in-line equations.
Removed the "interface" option from relayd(8) "transparent forward" directive.
Fixed memory leak in ssl(8) d2i_SSL_SESSION.
Backported fix for binutils bug 11867: ".quad" directive not assembled correctly.
Use sha512 instead of md5 for tcp(4) initial sequence number.
In ssl(8) s_client, no longer call shutdown on a non-existent socket descriptor.
In the random number generator, use sha512 to hash the entropy (instead of md5).
5.4, 5.5 and 5.6 RELIABILITY FIX: Stopped assuming elf(5) ep_taddr and ep_daddr are page-aligned, to fix a panic.
A source code patch is available for 5.4, 5.5 and 5.6.
Update to xf86-video-mga 1.6.3
Update to xf86-video-savage 2.3.7.
More gracefully handle firmware loading errors in ulpt(4). Avoids potential kernel crash.
5.4 and 5.5 RELIABILITY FIX: Fixed two remotely triggerable memory leaks in ssl(8).
A source code patch is available for 5.4 and 5.5.
Better POSIX compliance for realpath(3).
Made sure the pmap(9) direct map isn't executable on amd64. Mitigates some ret2dir attacks.
Correctly encode half line feed in the output stream for col(1) -f.
Added the -d flag (limit display depth) to du(1).
Made the mg(1) kill-paragraph and forward-paragraph commands stop once they can go no further.
Fixed resume from hibernate on AMD processors.
Fixed col(1) segfault triggered by an input line containing two consecutive backspace characters beyond column MAX_SHRT.
Implemented in-line equations in mandoc(1), needed by Xenocara manuals.
Allow empty headers in smtpd(8).
Disabled SSLv3 by default in ssl(8), relayd(8) and smtpd(8).
Stopped smtpd(8) relaying a header that will be rewritten by the destination MX.
Prevented sessions from sending a huge number of continuations to a single header and starving smtpd(8).
Made rcctl(8) properly access all rc.d(8) scripts and ignore anything irrelevant in /etc/rc.d.
Fixed memory leak in smtpd(8) error path.
Even if a table has zero columns, do not segfault in the mandoc(1) formatter.
Stricter syntax checking of unicode character names by mandoc(1); properly scale string length measurements for postscript and pdf output.
Improved error handling in the eqn(7) parser; do not parse quoted strings for tokens. Fixes glFrustum(3).
Fixed bug in mg(1) backward-paragraph when pressing "M-{".
Stopped iked(8) segfaulting when connecting from Strongswan on Android
Major upgrade to eqn(7) terminal output.
Removed possibility of multiplicative integer overflow in relayd(8) and snmpd(8).
Moved CPU throttling into the kernel, enabled with sysctl(8) hw.setperf=-1.
Added rcctl(8) "default" command.
Allow pkg_sign(1) signing to proceed when interrupted.
In rcctl(8), prevented "-e" in daemon_flags being fed as an argument to the built-in echo.
Partial eqn(7) rewrite, to fix operator precedence.
Let rcs(1) handle -l and -u combinations.
Parse and render "from" and "to" clauses in eqn(7), and render matrices.
More readable eqn(7) -Ttree output; initial bits of MathML rendering for eqn(7) -Thtml.
Properly initialise secondary CPUs on 64 bit macppc machines.
Allow kernel to be built without ddb(4).
Added ddb(4) support for DWARF line number decoding, so "trace" includes file and line numbers.
No more modstat(8), modload(8) or lkm(4).
Tweaked ssh_config(5) reparsing with host canonicalisation; added -G option to ssh(1); don't ignore ssh_config(5) "Port" options (bz#2267 and bz#2286).
Made sndiod(8) check parameters returned by audio drivers, and report driver bugs rather than crashing.
Made workq/taskq runner threads yield when they've hogged the CPU.
Now that the cleaner yields the CPU, stopped vfs(9) checking to see if we are hogging the CPU.
Restricted smtpd(8) address lookups to configured address families.
Fixed hardware lockup on intel(4) with i845g.
In vi(1), bumped max columns to 768 to accommodate bigger screens.
Removed support for AOE (ata over ethernet).
Fixed DDOS in head(1) by using the correct exit code on failure.
Removed gzsig(1).
Switched mandoc(1) HTML output to polyglot HTML5; have only one single -Thtml mode.
If a tbl(7) layout contains unknown font modifiers, don't fail table, fallback to default font.
Removed sdio(8).
Made amd64 pmap(9) more efficient on multi-processor machines.
When chmod(1) is called, do not silently ignore syntax errors in options, instead error out properly.
When ssl(8) is verifying an IP address is in a certificate common Name, do not perform wildcard matching.
If ssl(8) has to match against a wildcard in a cert, verify that it contains at least a domain label.
Amended previous commit in ftp(1) fetch.c to un break ELS cert validation when using a proxy.
Check object allocation for success before using it in ssl(8) v3_cpols.c.
In ssl(8), fixed memory leaks in the error path of v2i_AUTHORITY_KEYID() and set_dist_point_name().
Switched syslogd(8) from using poll(2) to libevent.
Updated xterm(1) to version 311.
Stopped xhci(4) Intel Series 7 controllers reporting illegal context state transition when detaching devices.
In ftp(1), only pass the remote host name (not any ":portnumber" suffix) to ressl_connect_socket().
Forced smtpd(8) to strip any empty BCC header in the DATA part of the SMTP transaction.
Cleaned up the reporting socket code in syslogd(8).
Introduced a thread for zeroing uvm(9) pages without holding the kernel lock, to reduce latency.
In syslog_r(3), strip trailing newlines from syslog messages, to avoid empty lines when printing.
Allow ssl(8) to disable hostname and certificate verification separately.
Enabled automatic handling of ephemeral EC keys by ssl(8).
Allowed many code paths in myx(4) to run without the kernel lock.
Now that pool(9) are mpsafe, made the mbuf(9) allocators on top of pools mpsafe too.
Fixed a crash when there is text after a failed %Z conversion in strptime(3).
When no domain is specified in MAIL FROM or RCPT TO, smtpd(8) now assumes local user.
Fixed httpd(8) endless event loop that could eat all CPU time.
Added local subnet route (RFC 3442) support to dhclient(8).
Enlarged columns for 4-byte ASN display with bgpctl(8) "show summary" output.
Fixed route(4) so arp(8) will no longer report an incomplete entry for lo0.
Made tmux(1) take account of window-status-separator when checking window position.
Update status when a tmux(1) pane is selected with a mouse.
Always call waitpid(2) on SIGCHLD when client_attached is set in tmux(1). Avoids potential zombie.
Fixed some incorrect format specifiers in a debug printf(9) in apm(8).
Fixed loopback related breakage introduced by the conversion of in_ouraddr() to use the route(4) table.
Map out-of-range facility values to LOG_USER to avoid array over-read in syslogd(8).
No longer define default_bits in openssl.cnf. Allows the compiled-in default to take priority.
Switched openssl(1) "req" command to using SHA256 (hashes) and AES256 (on-disk keys) by default.
5.6 RELIABILITY FIX: Fixed some run(4) devices working in 5.5 but not in 5.6-release.
More optimisations of luna frame buffer. Makes 4bpp wscons(4) putchar ~8% faster on luna88k.
Unhooked sliplogin(8), sl(4), slstats(8) and slattach(8).
Check speed of a new device does not exceed parent's speed prior to calling usbd_new_device().
5.4, 5.5 and 5.6 SECURITY FIX: Stopped nginx (in base) reusing cached ssl(8) sessions in unrelated contexts (CVE-2014-3616).
A source code patch is available for 5.4, 5.5 and 5.6.
Added support for "physical devices" to mfii(4).
In ssl(8), cleaned up EC cipher handling in ssl3_choose_cipher().
Prevented dmesg(8) spam from some windows-only keys (found on very new thinkpads).
Do not use the global list of IPv4 addresses in icmp_reflect(), use the route(4) table.
Increased text segment size on arm to 32MB.
When setting env(1) in an at(1) atrun script, use the "export foo=bar" form. Allows shell to catch variable names that are not valid shell identifiers.
Fixed r1.12 of ssl(8) x509_att.c which had a NULL pointer dereference in the error path.
Added option that allows any enabled ssl(8) protocols to be explicitly configured.
Use raster operation (ROP) function on luna frame buffer. 4bpp wscons(4) putchar now ~20% faster.
vds(4/sparc64) now supports block devices.
Reversion fixed in smtpd(8), which had broken table_passwd.
In ssl(8) check_cert(), reset ctx->current_crl to NULL before freeing it.
In ssl(8) X509_NAME_get_text_by_OBJ(), made sure we do not pass a negative size to memcpy(3).
In wdc(4) when doing ioctl(2), fixed leak by ensuring scsi(4) xfer free is done before ata xfer free.
Properly serialise closing vnode on sparc64. Fixes occasional panic during reboot or when restarting ldomd(8).
Updated to: xtrans 1.3.5; libXext 1.3.3, libXi 1.7.4, inputproto 2.3.1 and xrandr 1.4.3.
Provided a ressl config function that explicitly clears keys.
New API function SSL_CTX_use_certificate_chain(). Allows reading PEM-encoded certificate chain from memory instead of a file.
Remove a limitation that ignored IPv6 link-local addresses (eg fe80::2%carp0) on carp(4).
Reverted r1.142 of netstart.
In ssl(8) X509v3_add_ext() error path, do not free memory that was not allocated.
In ssl(8) X509_TRUST_add(), check X509_TRUST_get0() return value before dereferencing it; fixed memory leak.
In pool_destroy(9), enter and leave mutex(9) as necessary to satisfy assertions.
Updated to: xf86-video-vmware 13.0.2, fontsproto 2.1.3, libXfont 1.5.0 and xserver 1.16.1.
Disabled WRITE events when closing file descriptor of the I/O bufferevent. Fixes potential event flood in httpd(8).
In ssl(8), check that the specified curve is one of the client preferences.
In ssl(8) X509_STORE_get1_certs() and X509_STORE_get1_crls(), check the result of allocations.
Fixed memory leaks in ssl(8) X509_issuer_and_serial_hash() and X509_STORE_new().
Use correct format specifiers in various loongson machine dependent code.
Push sdhc(4) ricoh controllers into "old slow mode" at resume time.
Reverted part of r1.98 if_run.c which caused a regression on older run(4) devices.
Reworked piglet and pig memory allocation for more robust hibernation.
Now that sysctl(8) mp setperf is fixed, activated aggressive apmd(8) throttling again.
Fixed the calculation of the number of items to prime the pool(9) with in pool_setlowat(9).
Restored r1.249 of sys/dev/acpi/acpi.c. Upon resume, CPU now runs at speed requested by apm(8).
Support using pane id as part of session or window specifier and window id as part of session in tmux(1).
Support ! for last pane in tmux(1).
Fixed the build when DRMDEBUG is defined.
Enabled MSI support in msk(4).
Release the acpi(4) lock when calling wsdisplay_suspend() and wsdisplay_resume(). For better resume.
Fixed high capacity (> 2GB) eMMC support in sdmmc(4).
Hide unused, duplicate and/or misleading fields from audioctl(1).
In ssl(8), check the result from final_finish_mac() against finish_mac_length in ssl3_send_finished().
In ssl(8), don't record a match with the "finish MAC" if "SSL finished" has a zero-byte payload.
Implemented atomic_{cas,swap}_{uint,ulong,ptr} and atomic_{add,sub}_{int,long}_nv on hppa.
On macppc, enabled power saving modes for IBM PowerPC 970 CPUs.
Reworked pool(9) code to make it mpsafe (can be called without the kernel biglock being held).
Made packages(7) rsync-friendly. Reduces bandwidth usage by mirrors.
Fixed an invalid escape sequence in cu(1).
Allow agp(4) to map a single page without sleeping. Fixes intel(4) drm(4) panic on i386.
Added CHACHA20 to ssl(8) as a cipher symmetric encryption alias.
Moved rc.conf(8) from the etc to the base set (any local changes will be overwritten at next upgrade).
5.5 and 5.6 SECURITY FIX: ssl(8) session reuse vulnerability (CVE-2014-3616).
Introduce config_suspend_all(9), to invoke config_suspend(9) in appropriate order. Fixes problems with unflushed disk caches on machines where mpath(4) takes control of some of your disks.
Stopped sd(4) spinning back up while attempting to spin down some drives.
Increased number of blowfish(3) rounds to 8 by default (when not specified in login.conf(5)).
Updated to xkeyboard-config(7) version 2.12.
Changed screen terminfo(5) entry to have kbs=\177. Fixes problems with "le" editor.
If there are more than 8 CPUs, top(1) now defaults to combined CPU stats.
Disabled taking the mutex(9) to read pool(9) stats. Eliminates code paths that try to mtx_enter(9) twice.
Unlinked sendmail from the build.
Support ppb(4) bridges subtractive decoding. Fixes issues with pcmcia(4) behind a ATI SB400 PCI bridge.
Marked the mpi(4) and mpii(4) interrupt handlers mpsafe.
In httpd(8) and relayd(8), made the HTTP version mandatory and abort if it is missing in the request.
Made dd(1) error out when negative values are given for sizes on the command line.
In man.cgi(8), support backslash-escaping of white space in the query expression, similar to apropos(1).
Made the new isp(4) drivers match at a higher priority than old drivers.
In sysmerge(8) PKG mode, cope with non-default PREFIX (e.g. /var/www/...).
Provided a sparc64 version of sqrtl(3) for quad-precision floating point.
Remove cached 802.11 nodes in IEEE80211_STA_CACHE state. Stops them showing with ifconfig(8) scan.
On i386/amd64, stopped attempts to synchronise P-state transitions between CPUs. Fixes hangs and suspend/resume when running apmd(8/amd64).
Inspired by mdoclint(1), made mandoc(1) warn about botched .Xr ordering and punctuation below SEE ALSO; warn about commas in function arguments.
Implemented membar(9) API for i386.
Install files that moved from etc to base during "make build" to unbreak updating from src.
Let httpd(8) handle variations of the "Host" header (eg www.example.com:80, [2001:db8::1], [2001:db8::1]:80).
If a manpath directory does not exist, mandoc(1) will now silently skip it.
Fixed scans with various iwn(4) devices.
If pkg_add(1) not running as root, dismiss user id and groups, replace with root/bin. For FAKE_AS_ROOT=No.
Made the cleaner, syncer, pagedaemon and aiodone daemons all yield() if CPU is marked SHOULDYIELD.
Marked the mfi(4) interrupt handler mpsafe; give up biglock in the scsi(4) cmd submission paths.
Fixed interrupt storm on 2009 Mac minis with WOL enabled on nfe(4) interfaces.
Stopped uvm(9) sleeping on allocation of hash table entries. Fixes crashes with tmpfs.
Stopped pflog(4) counting bad packets multiple times.
Added window_last_flag and window_zoomed_flag to tmux(1).
5.6 and -current RELIABILITY FIX: Prevent addition of redundant IPv6 autoconf (SLAAC) addresses.
Fix a syslogd(8) regression when specifying all 20 additional log paths.
Implemented membar API for amd64.
Deleted procfs (always suffered from race conditions and is now unused).
5.4 RELIABILITY FIX: Added a one second receive timeout. Avoids stall of receive queue in vio(4).
5.4 and 5.5 RELIABILITY FIX: Removed race condition. Stops occasional network hangs in in vio(4).
Updated to mesa version 10.2.7.
Removed SSL_kDHr, SSL_kDHd and SSL_aDH from ssl(8). No supported ciphersuites use them.
Use shell substitution instead of dirname in sysmerge(8); fixed installing pkg @sample when target directory is missing; fixed output when a file fails to install.
5.6 RELIABILITY FIX: Stopped incorrect RX ring computation, which led to panics under load with bge(4), em(4) and ix(4).
A source code patch is available for 5.6.
Let roff(7) accept .ll in the prologue; parse and ignore the .pl (page length) request.
Upgraded inodesc.id_entryno in fsck_ffs(8) to u_int64_t, to handle larger file sizes with FFS2; fixed check for allocated fragments marked free in the bitmap.
Fixed FastCGI-based WebDAV and CalDAV (calendar) servers with httpd(8).
httpd(8) server name specification changed to name+address+port. Allows using same server name for multiple servers with different addresses.
Removed /etc/{hosts,myname} from etc.tgz; made the installer create the /etc/hosts template.
In perl(1), updated libnet to version 1.27.
Reworked how pool(9) with large pages (>PAGE_SIZE) are implemented.
Added *.gz support to apropos(1) -a, man(1), and mandoc(1).
In ssh(1), tightened permissions on pty(4) when the "tty" group does not exist.
Be coherent in the way arp(8) and ndp(8) display local entries, use "l" flag to distinguish them; skip broadcast entries (are not real arp(4) entries).
Make sure broadcast entries won't be freed by the arp(4) timer so we can use them for address lookups.
Treat broadcast entries like local ones and give them the highest route(4) priority.
Sync amd64 and i386 GENERIC.MP with other arches by enabling MP_LOCKDEBUG option.
If crypt(3) fails, smtpd(8) will now return an authentication error.
Implemented traditional -h option for man(1): show the SYNOPSIS only.
Initial httpd(8) support for persistent FastCGI connections via chunked Transfer-Encoding.
Added Jumbo support for BCM5714/5780/5717/5719/5720/57765/57766 bge(4) chipsets.
Fixed makewhatis(8) bug so apropos(1) and man(1) can find Xenocara manuals via .so links.
In man(1) mode, change to the right directory before starting the parser. Finds more Xenocara manuals.
Wake up any waiting clients with the tmux(1) "wait-for" command when the server exits.
smtpd(8) queue_api.c code will now close the file descriptor if fdopen(3) fails.
Prevented a null dereference of the urtw(4) configuration descriptor.
Improved option usage output for ssl(8); converted ssl(8) ecparam to new option/usage handling.
Applied fix from upstream perl(1) to harden the close() function (RT 37700).
Replaced the "least recently used" bufcache in vfs_cache(9) with one based on 2Q, for scan resistance.
On amd64, added implementations of atomic_{inc,dec,add,sub}_{int,long}(9) and atomic_{add,sub}_{int,long}_nv(9).
Correctly made accept4(2) a cancellation point as per pthread_testcancel(3).
Backported @file support from binutils-2.17.
Added uuid(3) support routines to libc.
Made sysmerge(8) completely silent by default when no file is modified.
In sysmerge(8) pkg mode, warn if the directory we want to copy an @sample into doesn't exist or is not an @sample.
In sparc64 ld.so(1), made the handling of PLT entries above the 32k mark thread-safe.
When a service is not available, made rcctl(8) return ENOENT.
Introduced a man(1) -l option as an alias for mandoc(1) -a.
Converted the openssl(1) "version" command to new option/usage handling.
On lii(4), set the MRU to a full size frame instead of basing it on the MTU.
Let the MRU always be what the oce(4) chip can do, not what the MTU implies.
Fixed 2 macppc panics.
Allow new devices to get an address for xhci(4) when XHCI_DEBUG is defined.
Fixed checking sync for old synaptics touchpad (ver 5.9) in pckbc(4).
Allow multiple relayd(8) instances to be configured to forward traffic to the same host.
Major sysmerge(8) cleanup now that both etc and xetc sets are part of base (-S -s and -x options gone).
Moved the xetc set into xbase (like etc was moved into base).
Added openssl(8) option handling for input/output formats, ordered flags, and for argument processing.
Added mdoc(7) support for .St -susv1 and .St -susv4.
Made diff(1) -uw produce valid output even when one file doesn't end with a newline.
Implemented table-driven ssl(8) option parsing. Allows an application to specify valid options and where to store them.
Ported openssl(1) rand application to the new option parsing and usage.
Nuked sysctl(8) net.inet6.icmp6.rediraccept and allow redirects on interfaces with autoconf enabled.
In newsyslog.conf(5), added httpd(8) default log files to the rotation.
Added ssl(8) API function ressl_config_set_ecdhcurve to set or disable a non-standard ECDH curve.
Added support for Curve25519 to iked(8).
Write all data before closing the httpd(8) server socket if the output buffer is not empty.
Added missing capability to handle new $2b version of blowfish(3) password encryption for usermod(8) and friends.
Added an implementation of man(1) into the /usr/bin/mandoc binary; unify command line options for mandoc(1), man(1), apropos(1), and whatis(1).
Create etc set during "make build", now embedded it in base set.
Removed nginx from the base system in favour of OpenBSD's homegrown httpd(8).
Moved openssl(1) from /usr/sbin/openssl to /usr/bin/openssl.
Unlinked xfs(1) from the build.
Added the ability to restrict syslogd(8) to an ip(4) or ip6(4) protocol family.
Added iked(8) support for DH groups 27-30 using the Brainpool curves as in ssl(8).
httpd(8) now supports both mime.types flavours (nginx- or apache-style).
Added generic system-wide /usr/share/misc/mime.types file, usable by httpd.conf(5).
Moved sending of router solicitations to the kernel. Makes rtsol(8) and rtsold(8) unnecessary.
Don't allow pasting into input-disabled tmux(1) panes.
Implemented _NET_WM_STATE_STICKY in cwm(1). Allows client to "stick" to all desktops or groups.
When using a proxy, made ftp(1) validate the cert hostname against the target hostname, not the proxy hostname.
Delete secret or secret-derived data in many base utilities with explicit_bzero(3).
Implementation of bold italic font support for postscript and pdf output in mandoc(1).
Start all rcctl(8) error messages with "rcctl: " so it is clear where they come from.
In debug mode, only print the flags relevant to the rc.d(8) we are calling instead of all flags; make it clear when we are using the default flags when none are set.
Make it possible for rcctl(8) to pass '-d' and '-f' to the rc.d(8) script.
Removed non-standard GOST cipher suites (which are not compiled in currently) from ssl(8).
pfctl(8) now makes sure rules have been defined when you specify queues in a rule.
Switched ndp(8) to display MAC addresses in 00:00:00:00:00:00 format.
Get arp(8) to print leading zeros in MAC addresses again.
Disabled use of bind in base (base uses nsd(8)/unbound(8) instead).
Ensure cwm(1) client that wants to be in nogroup stays in nogroup (thus stays in view), even when (re)reading NET_WM_DESKTOP.
Made syslogd(8) check host/port length when parsing syslog.conf(5). Avoids nasty error message "syslogd: priv_getaddrinfo: overflow attempt in hostname".
Set the default nfsd(8) flags to "-tun 4" when launched from rc.d(8).
Fixed memory leak in isakmpd(8) ike_phase_1.c.
Fixed acpi(4) sensor status for docking/undocking laptops, to allow sensorsd(8) to correctly detects state changes.
Bugfix to make whatis(1) case-insensitive again.
Added Last-Modified: HTTP header to httpd(8).
Allow syslogd(8) to send and receive udp(4) syslog packets on the IPv6 socket.
Unbroke sysmerge(8) when "SRCDIR=."
Limited the mandoc(1) CGI process execution time, to make REDoS attacks less effective.
Stopped mandoc(1) suppressing white space after .Fl if the next node is a text node on the same input line.
Made rcctl(8) "status" output match rc.conf(8) format.
Changed the output of arp(8) to match what ndp(8) does; include the expire timer.
After nfe(4) allocates an mbuf and cluster, properly init the length fields.
Implemented rxrinfo ioctl in ix(4) for cluster usage statistics.
Call audio_{pint,rint}() call-backs with the mutex held.
When doing "whole disk" installs on macppc, blank the first 1 meg of the disk. Allows successful creation of boot partition.
Unlinked the crypto(4) pseudo device (disabled by default for about 4 years).
Made sure eap(4) releases CPU mutexes upon receiving an EINVAL message.
On i386/amd64, backported support for the "rdtscp" instruction from binutils-2.17.
Removed the custom jumbo allocator from nfe(4) which was never enabled.
When sshd(8) is dumping the server configuration, made it print correct KEX, MAC and cipher defaults.
Introduced rcctl(8), a simple utility for maintaining rc.conf.local(8).
When a local route(4) entry is added for an ifa having a broadcast address, made it identifiable (by a flag) and persistent.
Ensure state changes are properly serialised in pms(4). makes enabling/disabling touchpads more reliable.
Missing stack var initialisation fixed in ld.so(1).
Added -4 and -6 flags to tcpbench(1), to specify ipv4 or ipv6 respectively.
Fixed _exit codes in syslogd(8) privsep.c, which were the wrong way around.
Fixed read access to uninitialised memory in mandoc(1).
Removed malloc(3) lock across some mmap(2) syscall(9). Speeds up multithreaded programs.
Added fancy printing of ktrace(1)'s ops argument to kdump(1).
Made kdump(1) display symbolically the mode argument of mkdir(1), mkfifo(1), mknod(2) and umask(2).
/etc/netstart now executed using sh(1) instead of sourcing it.
Repaired operation of sysctl(8) kern.arandom.
Removed support for public key operations from ubsec(4) and safe(4).
lofn(4) and nofn(4) removed as obsolete, due to reliance on the crypto(4) interface.
Switched to using O_CLOEXEC wherever we open a file and then call fcntl(F_SETFD, FD_CLOEXEC) on it. Reduces system calls and improves thread-safety for libraries.
More fixes in the attach failure path for ze(4/vax).
Added bounce matching for [] and {} to mg(1).
Synced relayd(8) and httpd(8) with RFC 7230-7235 phrases and IANA registered status codes.
In oce(4), implemented rxrinfo ioctl for cluster usage statistics.
systat(1) now only show active pools by default, pressing "A" shows all pools.
Updated drm(4) to libdrm 2.4.56.
Began cleanup of scaling units in roff(7).
Some X(7) resource files moved to /usr/X11R6/share/X11/app-defaults.
With a non-existent httpd(8) root, removed root prefix from PATH_INFO (useful for virtual FastCGI scripts inside a chroot(8)).
Made sure tftpd(8) always calls freeaddrinfo(3) after getaddrinfo(3).
In httpd(8), provided a failsafe version of the path_info() function.
Correctly set the rtable ID of the packet header when sending pppoe(4) Active Discovery Terminate packets.
Brought pflow(4) IPFIX sequence numbers in line with the RFC.
Sync pf.conf(5) behaviour with the man page regarding parent anchors for "once" rules.
On mips64, stopped uvm_map(9) from receiving addresses outside userland bounds.
Fixed tmux(1) copy mode problems: in vi mode, include the last character if you moved the cursor up or left; in emacs mode include the last character if you moved the cursor left.
Added tmux(1) flags to selectp, to enable and disable input to a pane.
In ksh(1), separately set FD_CLOEXEC if the new fd was >= FDBASE. Affects scripts that directly use 9 of the first 10 file descriptors.
When dhclient(8) is parsing 32 bit values, verify that we received 4 bytes.
Validate len field in dhcpd(8) for proper length, not just "not zero."
Brought back r1.131 of sys/kern/subr_pool.c: take the pools mutex when copying stats out of it in the sysctl(8) path.
Put back the checks about RTF_LOCAL routes now that userland tools are aware of them.
Stopped arp(4) and ndp(8) from trying to delete RTF_LOCAL entries.
Fixed unchecked memory allocation (and potential leak upon error) in ssl(8) ssl3_get_cert_verify().
Provided ssl3_get_cipher_by_id() function that allows ssl(8) ciphers to be looked up by their ID.
Always write core file of a non-suid process into pwd(1), even if sysctl(8) kern.nosuidcoredump is 2 or 3.
Fixed race in relayd(8) that caused non-persistent PUT connections with a short body to hang.
Removed disabled (weakened export and non-ephemeral DH) cipher suites from the ssl(8) cipher list.
If pkg_create(1) is run as non-root, restore correct group/owner to root/bin, and remove write permissions without explicit modes.
Fixed kqueue read/write filters for msdosfs and fuse(4) filesystems.
Fixed the length check for reinjected icmp(4) packets. Stops divert(4) discarding valid packets shorter than 20 bytes.
Fixed readelf(1) "--debug-dump=frames-interp" output.
5.4 and 5.5 SECURITY FIXES: Backported security fixes from openssl 1.0.1i
A source code patch is available for 5.4 and 5.5.
Initial sysmerge(8) support for handling configuration files from packages.
Now that uhub(4) can deal with them, added support for non-root hubs.
Made uhub(4) correctly recognise Super Speed devices.
Allow httpd.conf(5) to include the "types" section anywhere in the configuration file.
Removed tmux(1) support for the continuously reporting "any" mouse mode (never worked properly, rarely used).
Backport from binutils-2.17 the correct i386/amd64 register->int assignments for CFI.
Allow httpd(8) to use a fastcgi target as the default index (eg index.php).
Fixed relayd(8) when using DNS over udp(4) so it continues to work after the first request.
radeon(4) fixes: only apply hdmi "bpc pll" flags when encoder mode is hdmi; fixed dithering on some panels; fixed lane/clock setup for dp 1.2 capable devices.
Brought mandoc(1) handling of defective prologues closer to groff.
Simplified man(7) validation in mandoc(1).
Fixed mandoc(1) floating point handling. Fixes the indentation of the readline(3) manual.
Allow httpd(8) to serve emtpy (0 bytes) files.
Improved mandoc(1) handling of next-line scope when it is broken by end of file.
Partial mandoc(1) implementation of .Bd -centred; various improvements related to .Ex and .Rv.
Made sure asynchronous commands do not race with synchronous ones in xhci(4).
Improved xhci(4) logic to determine the maximum endpoint service interface time payload.
Made xhci(4) always report stalls, as umass(4) relies on this information.
Added support for using "-" as shorthand for stdin/stdout in tradcpp(1).
--------
Changes made between OpenBSD 5.5 and 5.6
Fixed ssl(8) to avoid allocating and then leaking a fresh fragment structure when a zero-length fragment is received (CVE-2014-3507).
Fixed ssl(8): made sure the output buffer is always NUL terminated if buf_len was initially greater than zero; reject OIDs that are too long, too short, or not in proper base-127 (CVE-2014-3508).
Corrected ssl(8) test (reversed during merge of fix for CVE-2014-3509).
Fixed ssl(8) DTLS handshake message size checks (CVE-2014-3506).
Stopped httpd(8) trying to output FCGI_STDERR into error.log if there is no data.
Try to parse "Status: $code" in the first response from the httpd(8) fcgi daemon, use that code as HTTP response code (fallback to 200). Possible fix for redirects in cvsweb.
Fixed ssl(8) TLS downgrade (CVE-2014-3511).
Fixed DTLS anonymous EC(DH) denial of service in ssl(8) (CVE-2014-3510).
Made httpd(8) correctly report "internal server error" if the very first fcgi STDOUT record has length 0.
Changed httpd.conf(5) grammar to remove a shift/reduce conflict. "listen on $ip port 443 ssl" turns into "listen on $ip ssl port 443".
Added support for NOTE_EOF (for kqueue(2) EVFILT_READ filters) on NFS files.
Limit the body size in client requests (eg. POST data) to 1M by default in httpd.conf(5); added a configuration option to change the limit.
Prevented X(7) server crash on zaurus (and possibly other architectures) where there is no pci(4).
Provided httpd.conf(5) configuration options that allow the SSL certificate, key and ciphers to be specified for each server.
Clear the httpd(8) public key when it is no longer needed.
Configured the default ssl(8) ciphers as HIGH:!aNULL in httpd(8).
Restored previous ssl(8) behaviour that allows a PEM block to be fed through the base64 decoder.
Corrected some dma cleanup error paths in qe(4/vax).
POST support added to httpd(8).
Added CONTENT_TYPE environment variables (without the HTTP_prefix) to httpd(8), for use with cgi scripts .
Fixed bug in server_write that broke httpd(8) keep-alive support.
httpd(8) now adjusts read/write watermarks according to the TCP send buffer. Fixes sending of large files.
Load the httpd(8) ssl(8) public/private keys in the parent process, then provide them to the privsep process via imsg. Allows keys to be moved out of chroot(8).
Added ssl(8) support for loading the public/private key from memory, rather than directly from file.
If a driver (eg umct(4)) opens an interrupt pipe without callback function, made sure the correct transfer is aborted.
Added httpd.conf(5) options for max requests per connection and timeout limit.
Brought back httpd.conf(5) TCP/IP configuration options.
Limited the number of Keep-Alive requests per httpd(8) connection to 100.
Improved httpd(8) logging to allow per-server/location log files; log files can now be owned by root.
Added httpd.conf(5) option to specify the chroot(8) directory.
Enabled httpd(8) in rc.d(8) for wider testing.
Temporarily moved default location of the httpd(8) SSL/TLS server key and certificate from /var/www/ to /var/www/conf/.
Added "HTTPS = on" CGI variable to httpd(8).
Redirect httpd(8) to https:// if SSL/TLS is enabled.
Added TLS/SSL support to httpd(8), based on the recent ssl(8) commits.
Changed httpd.conf(5) grammar from "log [style]" to "log style [style]".
Provided an ssl(8) function that returns a server connection context.
Provided an ssl(8) utility function for loading a private/public keypair.
httpd(8) will now print error message if the log files cannot be opened.
Improved ressl_{read,write} handling of non-blocking reads/writes in ssl(8)
Added initial httpd(8) support for log files in /var/www/logs/.
Implemented httpd(8) PATH_INFO and added DOCUMENT_ROOT.
httpd(8) now also writes log messages (eg 404 Not Found) on error.
Extended httpd(8) to dynamically pass HTTP request headers as protocol-specific HTTP_* CGI meta-variables.
Add ral(4) to GENERIC and RAMDISK on macppc.
Fixed sys/dev/usb/ehci.c r1.162 to stop returning initialised memory on error in ehci_alloc_sqtd().
Fixed sys/dev/ic/bwi.c r1.106. Prevents packet loss.
Split httpd(8) fastcgi socket path and document root options; added the SCRIPT_FILENAME CGI param with a prepended root. Fixes php-fpm that expects SCRIPT_FILENAME.
Added missing httpd(8) log call for fastcgi requests.
Added another httpd.conf(5) log mode "connection" for a relayd(8)-style log entry after each connection.
httpd(8) now prefers getnameinfo() with NI_NUMERICHOST over inet_ntop (to include IPv6 scope ID).
httpd.conf(5) locations now inherit access log settings from the server.
Made sure httpd(8) reads fcgi padding data if any is received.
Made httpd(8) properly read from the fcgi bufferevent until it is empty.
Allow httpd(8) to specify a fastcgi TCP socket on localhost.
Fixed scandir(3)-based directory auto index on NFS in httpd(8).
Use the log buffer to defer httpd(8) logging until the connection is closed or the request completed.
Added common and combined access logging to httpd(8).
Rewrote httpd(8) fcgi_add_param and hand over a lot more http headers etc. to the cgi script.
Correctly parse fastcgi records if httpd(8) doesn't get the whole record in one bufferevent_read().
Allow softraid(4) rebuilds to work correctly when the volume metadata has a different data offset to that currently in use.
Unbroke aac(4), by re-adding uvm_extern.h for ptoa().
httpd(8) now only writes the HTTP header for the first fastcgi chunk.
httpd(8) fastcgi improvements: submit QUERY_STRING, if it exists; use a proper function to create an HTTP header; use server_file_error() to detect EOF and fastcgi stream errors; disable keep-alive/persist until there is a reliable way to get the content length.
Use exact on-disk inode size with ext2 filesystems.
Properly evaluate rc.d(8) values only after running _rc_quirks(), because these can modify flags.
In rc.d(8) debug mode, properly sort and drop duplicate entries to make output less confusing.
Allow httpd.conf(5) to specify a non-default fastcgi socket.
Renamed httpd(8) "docroot" variable to "path" (as it will be used for either files or the fastcgi socket).
Added httpd.conf(5) configuration variable "fastcgi" to enable it per server or location.
Initial fastcgi implementation for httpd(8).
Made sysmerge(8) properly warn when an example changes and the corresponding file is found under /etc.
Add tradcpp(1) version 0.4, a standalone traditional whitespace-preserving cpp(1).
Added httpd.conf(5) "location" keyword, to specify path-specific configuration in servers; made it work with name-based virtual servers.
Reserve an extra file descriptor per httpd(8) connection, instead of per request. Fixes fd accounting with persistent connections.
Added extended directory index options "[no] index" and "[no] auto index" to httpd.conf(5).
Reverted checks about RTF_LOCAL route(4) (userland tools are not yet ready for this).
Last (known) msgbuf_write(3) vs EOF fix incorporated into smtpd(8).
Fixed I/O ktrace(1) of sendsyslog(2).
Pass a default media to the le(4/sparc) child. Allows SPARCbook system default to AUI without requiring a manual media change.
Removed buggy ssl(8) SRP code (never enabled in OpenBSD).
5.4, 5.5 and -current RELIABILITY FIX: Fixed possible memory exhaustion in dhclient(8) and dhcpd(8), occurring on DHCP options with 0 length.
A source code patch is available for 5.4 and 5.5.
Merged dhcpd(8) packet.c r1.7 into dhclient(8) and dhcrelay(8), to remove DoS attack vector.
Match any relevant driver (not just whitelist) for X(7) "aperture needed" detection.
Fixed ssl(8) so RSA, DH, and ECDH temporary key callbacks are correctly passed the number of keybits for the key.
Made pkg_add(1) log libraries in a proper way.
Stopped mandoc(1) assuming in -Tutf8 output mode that a non-breaking space character has width 0.
Fixed hangs during suspend when stopping secondary cpu.
Reverted "adjust -C algorithm" from apmd(8/amd64), which broke suspend/resume on some machines.
Fixed (very hard to reach) DoS attack vector against dhcpd(8).
Differentiate httpd(8) servers by address and port, not just by address.
Use a URL in the Location header of httpd(8) 3xx responses.
Append mandatory Date header to each httpd(8) response.
In httpd(8), canonicalise the request path once without the docroot; prepend the docroot only only when it's needed.
Prevent ssh-agent(1) keys remaining in memory after they have been expired or deleted.
Stopped httpd(8) leaking the docroot in the error message if the default index file is missing.
Fixed httpd(8) address matching of multiple server blocks with non-virtual hosts.
Added support to httpd(8) for "virtual hosts" (aka. server blocks).
Added "root" configuration option to httpd.conf(5).
Sped up boot sequence by deferring scan of xt keyboard code set by pckbd(4).
Made man.cgi(8) sort result pages first by section number, then by name.
Provide eeprom(8) on the sparc installation media.
Build machinery added to build eeprom(8) for the installation media on relevant arches.
Unbreak route(4) flush: skip local (RTF_LOCAL) routes when flushing.
Reverted ssp-strong from gcc(1) on arm, which exposed too many bugs in ports(7).
Plugged httpd(8) memleak, to free the HTTP descriptor containing all the headers etc. of a connection.
Provided a dropdown entry "All Architectures" to man.cgi(8) and made it the default.
When httpd(8) is canonicalising the path, fail on truncation.
Made httpd(8) redirect with 301 if a directory name was requested without the trailing slash.
First attempt at having httpd(8) verify request path and access permissions.
In getaddrinfo_async(3) and similar, made queries fail when the hostname param is an empty string.
In ssl(8) level_add_node(), do not free objects on cleanup which are still being referenced by other objects.
Made sure ssl(3) PEM_def_callback() correctly handles negative buffer sizes.
Removed lynx from the base system (available in packages(7) instead).
Mandoc(1) security fix: after decoding numeric or one-character escape sequences, HTML-encode resulting character.
Correctly shutdown the servers when the httpd(8) process is terminating. Prevents a crash on exit.
On octeon, correctly drain and destroy the bufq upon detach.
Adjusted apmd(8) -C algorithm to be more aggressive in scaling up cpu speed.
Reverted recent "memory poison" commit until after release (triggering too many use-after-free bugs).
man.cgi(8) security fixes, to prevent XSS attacks.
In ssl(8) DES_random_key(), force the generated key to the correct parity; use it to generate DES keys in the EVP_CTRL_RAND_KEY method handlers.
Enable httpd(8) in the builds for more testing (not finished but can serve static files).
Added initial httpd.conf(5) example for httpd(8).
Added the X(7) "aperture needed" test to vgafb(4), to match vga@pci.
Corrected the initialiser for tunnconf_default_pptp in npppd(8).
Reduced amount of messages from key_load_private_pem during ssh(1) hostbased auth.
Made mandoc(1) preserve manpath and arch in .Xr links.
Reverted tmux(1) up/down wheel emulation.
Stopped the installer setting (obsolete) sysctl(8) net.inet6.ip6.accept_rtadv and net.inet6.icmp6.rediraccept.
Made man.cgi(8) match RFC 2616, so the "Location: response-header" field is an absolute URI.
Dropped explicit tmux(1) support for F13-F20; match the xterm(1) terminfo(5) entry.
Stopped kprintf in gcc(1) accepting the <number>$ flags (as printf(9) doesn't support them).
When amd64/i386/loongson hibernate, look up correct device when using softraid(4).
Updated to pixman 0.32.6
Support hibernating to softraid(4) crypto volumes on amd64/i386/loongson.
Fix tcpdump(8) display of logical link control data in IEEE802 frames.
acpi(4) now ignores region marked as "Preserve" if all bits will be modified. Fixes hang on some Sony and Asus laptops.
Always allocate bwi(4) ring descriptors below the 1GB boundary. Fixes "intr fatal TX/RX" errors.
On bwi(4), make bwi_dma_mbuf_create() use the correct loop counter in error case.
Load bwi(4) firmware once, not every time the interface is brought up. Fixes a panic.
Fixed array overflow in telnet(1) command line handling
When spamd(8) is started by rc.d(8): no longer start in background mode; return from rc_start() if spamd(8) failed to start; execute spamd-setup(8) without explicitly waiting for spamd(8).
Fixed auto-upgradable file detection by sysmerge(8).
Aligned telnet(1) with the manpage by making the "-a" use getlogin(2); ignore value if it returns a nonexistent user.
Flensed the telnet(1) code base of support for ancient protocols and systems.
On loongson, fixed Lemote reboot issue and usb(4) problems on Gdium models.
mandoc(1) security fixes: validate name of file before opening; only allow relative filenames starting with "man" or "cat" and not containing "/.." or "../"; validate the manpath up front, report a Bad Request if it is not listed in manpath.conf; in case of configuration errors, only report "Internal Server Error".
Fixed strtonum(3) range, to unbreak "-pass fd:0" in ssl(8).
Cleaned up portable arc4random(3) fork detection code; let it take advantage of systems with healthy getentropy(2).
Stopped man.cgi(8) using the HTTP_HOST CGI variable (made HTTP redirect Location: relative). Reduces attack surface.
Removed dev/log AF_UNIX sockets from various chroot(2) spaces, since syslog(3) messages are now sent via sendsyslog(2).
Fixed pkg_add(1) sorted output.
When mandoc(1) MAN_DIR or manpath.conf do not exist or are empty, exit(3) in a controlled way.
Fixed privilege separation in npppd(8).
In bnx(4), implemented EFBIG handling for heavily fragmented packets on the tx path.
In dump(8), allow files-to-dump to be a duid.
On sgi, optimised use of external L2 cache handling on the few Indy/Indigo2 systems which have it.
Unbroke rc.d(8) script for smapd(8) after the rc_do->_rc_do and rc_wait->_rc_wait renaming.
Zero out the random buffer for sysctl(3) and the entropy buffer.
Made sure the biglock is held on i386 when running interrupt handlers (which rely on it).
Reflect stdio-forward ("ssh -W host:port ...") failures in ssh(1) exit status (bz#2255).
In x509_vfy.c, free sktmp when it's no longer needed. Fixes many memory leaks in ssl(3).
Added mpbios(4) to RAMDISK_CD on i386/amd64, so bsd.mp is selected when installing to Soekris net6501.
Implemented file descriptor accounting in httpd(8) for single-pass HTTP connections, persistent connections with multiple requests, and body-less HEAD requests.
Added sshd(8) support for unix domain socket forwarding.
Updated to xf86-video-neomagic 1.2.8.
Enable ext2fs support on RAMDISK_CD.
Converted ftp(1) to libressl.
Removed securelevel(7) variable from rc(8).
powerdown=YES removed from reboot(8).
Updated to xterm(1) version 309.
Fixed timeouts in relayd(8) when one connection is spliced and one non-spliced.
Added configuration handling for certificate and key files to libressl.
KASSERTMSG(9): new function for a kernel assertion with message.
Fixed sched_stop_secondary_cpus() to properly drain run queues from CPUs.
Display zero page hit and miss counters in vmstat(8) -s.
Show an error if cmd_find_session can't find the current tmux(1) session.
Made tmux(1) close a connection when it receives an EOF.
If a client is killed while suspended with ^Z, tmux(1) will no longer try to resume it.
Removed all crypt choices other than bcrypt from adduser(8).
When using NAT or redirects, recalculate the checksum of reassembled IPv6 fragments before the packet is refragmented.
Fixed path MTU discovery with ping6(8) through pf(4) using nat or rdr.
Introduced the PS_NOBROADCASTKILL flag that excludes processes from receiving kill(1) -1 broadcast signals.
KERNEL_ASSERT_LOCKED(9) function added, working towards removal of the kernel lock.
Initial support to read GPT partition tables in the kernel on i386/amd64 (requires option GPT).
Ensured httpd(8) finishes writing the output before closing the connection.
Fixed tight renew loop regression in dhclient(8).
httpd(8) will now close the connection after the response is completed (no Keepalive yet).
Added httpd(8) support for media types (compatible with nginx(8) mime.types file).
Added ext4 read support.
Brought man.cgi default mode closer to what man(1) does.
Close connection/remove event handler when ypldap(8) msgbuf_write() hits an EOF.
Introduced mount(8) -N option and a "net" mount option, and matching fsck(8) -N flag.
Updated glxinfo(1) and glxgears(1) to version in mesa demos 8.2.0.
Better httpd(8) error messages.
Added httpd(8), a simple web server (preliminary version).
dmesg(8) now indicates if aperture driver is required by X(7). Used by installer for sysctl(8) machdep.allowaperture setting.
Fixed usb(4) connect freeze on octeon, by clearing the host port interrupt.
Resize inpcb hashtable automatically.
Removed udfu(4).
Updated to xf86-video-modesetting 0.9.0.
On octeon, fixed root hub descriptors by matching ehci(4)'s descriptors.
In sysmerge(8), use sha256(1) for compared files.
Rework zyd(4)'s register read/write methods to eliminate race conditions.
Fixed netstart(8) after autoconf6 change so "rtsol" lines in hostname.if(5) work again.
Always create a local route(4) for every configured IPv4 address on the machine; made sure the local route(4) is removed during an address change (stops pppoe(4) corrupting the routing tree); do not add a local route if the specified address is 0.0.0.0 (prevents tree corruption).
Use imsg(3) between the privileged and the non-privileged npppd(8) processes.
Fixed whatis(1), to correctly match words instead of any substrings; provide an internal mode for man.cgi(8).
Removed qli(4) (never enabled and was unfinished).
Made rc.conf(8) a parsed configuration file; stop sourcing it as a shell script.
Updated to libICE 1.0.9 and libXft 2.3.2.
Add a function to drop all clean pages on the uvm(9) page daemon queues; call it when we hibernate.
Moved macppc abtn(4) driver from workq to taskq.
Only detach the usb(4) device that has been disconnected, to fix a regression.
Implemented checksum offload for divert(4).
Allowed acpitz(4) to accept a temperature reading of 0 degC (fixes some machines with "failed to read _TMP" errors).
Stopped acpitz(4) reporting bogus temperature values (temperatures > 4,000 degC) and therefore shutting down the machine.
Initial version of libressl; provide LIBRESSL_VERSION_NUMBER to detect versions distinct from OPENSSL_XXX.
Limit relayd(8) HTTP header length to 8K (based on the default of 4-8K common in web servers).
In boot(9), purged curproc-overriding hacks.
bluetooth(4) support removed (code did not work properly anyway).
Better m4(1) error handling in mkstemp/unlink/fdopen logic.
Started reducing the attack surface of lynx(1) (gopher, news, and dired left enabled for now).
Enabled interrupt routines on octeon.
Added relayd.conf(5) options for disallowing client-initiated renegotiations and to prefer the server's cipher list.
Added relayd(8) support for EDH to provide perfect forward secrecy for older ssl(8) clients.
Stopped DHCPINFORM in dhcpd(8) looking up the lease database, filling the yiaddr field, or including lease time parameters.
Introduced IFXF_AUTOCONF6 interface and removed net.inet6.ip6.accept_rtadv from sysctl(8).
Allow IFXF_AUTOCONF6 to be set and cleared via ifconfig(8).
On rtsold(8), turned AFXF_AUTOCONF6 on.
Placed the first examples into the new /etc/examples directory.
Documentation update for libcrypto and ssl(8).
Prevent infinite loop during ssl(8) configuration file parsing (PR #2985).
In ssl3_get_cert_verify(), accommodate ssl(8) RSA keys larger than 4096-bit (PR #319).
Fixed copy for CCM, GCM and XTS (ssl(8) PR #3272).
Added machine independent reboot(9) function.
Removed redundant check and wrong fix from fsck_msdos(8): fat.c checks already take care of cluster chains.
In ssl(8) asn1_get_length(), tolerate leading zeroes in BER encoding (PR #2746).
In ssl(8) EVP_PBE_alg_add don't use the underlying NID for the cipher, as it may have a non-standard key size (PR #3206).
By popular demand, added back hamc-sha1 to sshd(8) protocols (still used by many clients).
Fixed ssl(8) OID encoding for single components (PR #2556).
More ssl(8) memory leaks and unchecked allocations fixed (PR #3403).
Made sure BN_sqr never returns negative numbers (ssl(8) PR #3400).
Let ssl(8) accept CCS again after "finished" has been sent by the client. Avoids failed renegotiations (PR #3400).
In ssl(8) dtls1_clear_queues(), free buffered_add_data.q correctly (PR #3286).
Fixed version number processing in ssl(8) cms_sd_set_version() (PR #3249).
Removed rdist(1).
Avoid panic on alpha when using network card with a small number of tx descriptors per packet, a lot of memory, and a heavily fragmented packets.
When looking for the issuer of a ssl(8) X.509 certificate, only return an expired certificate if no valid certificates have been found (PR #3359).
In ssl(8) ssl3_get_client_key_exchange() parsing a GOST session key, invoke the regular ASN.1 parser (PR #3335).
Removed RFC4620 Node Information Query support from the kernel.
Made ssl(8) CMS_decrypt_set1_pkey() return an error if no recipient type matches, instead of returning a random key (PR #3348).
Fixed missing initialisation in ssl(8) (PR#3289 and #3345).
Simplified relayd(8) code that handles the HTTP headers. Fixes some issues (e.g. handling of multiple "Set-Cookie" headers).
Don't hold the kernel lock while halting a processor.
New CPU_BUSY_CYCLE() function, so the CPU can reduce power consumption in busy loops.
Synchronised zaurus's boot(9) with all others by having it call if_downall().
Added -u option to dhcpd(8). Binds UDP port to answer DHCPINFORM from clients on non-ethernet interfaces (eg. tun(4) or pppx(4)).
Converted bus_dmamem_map(9) to km_alloc(9), to fail (not sleep) if the allocator cannot obtain a lock when BUS_DMA_NOWAIT is specified.
Updated to Xserver(1) version 1.15.2.
Corrected readlink termination in csh(1).
Using -U command-line option, allow ftp(1) to change its user agent for HTTP(S) URL requests.
Flush the buffercache to 16MB on hibernate and restore its previous max size (kern.bufcachepercent) on resume. Better hibernate performance.
Set cold to 1 before executing the DVACT_POWERDOWN handlers when halting or rebooting a machine. Avoids panic on macppc with uhci(4) cardbus.
Fixed panic seen when unplugging a cardbus ehci(4), ohci(4) or uhci(4).
Taught fsck_msdos(8) that uninitialised values (-1) in FSInfo are valid.
newfs_msdos(8) fixes: always put boot signature at end of 512 byte sector, even on disks with larger sector sizes; do not point at a cluster that is in use; avoid out of boundary access when checking invalid long filenames; validate number of FATs; validate critical file system info.
Improved smtpd(8) scheduler: can now return envelopes of different types in a single run (interlaced to avoid batch effects); send envelopes at a rate that the queue can sustain; limit the number of envelopes in a holdq (excess returned to pending queue).
Return RSN (WPA) information to userland during ifconfig(8) wireless scan; show whether a wireless network uses WEP or WPA.
m4(1) will now annotate regexp error messages with the source string.
Stop using a shutdown hook for softraid(4) and explicitly shutdown the disciplines right after vfs_shutdown().
Added bus and root hub routines to octeon, to prevent panic at attach.
Made usbdevs(8) correctly report devices connected to xhci(4).
Fixed missing allocation checks and potential NULL pointer dereference in the error path in ssl(8) PEM_X509_INFO_read_bio().
vic(4) now records the size of the rx rings so we can wrap around them correctly. Fixed a panic.
Added internal buffering for dump(8). Ensures all requested data is actually read from the device when they have non-512 byte sectors.
Removed bogus preprocessor statements (trying to pick the largest integer type for BF_LONG, MD[45]_LONG and SHA_LONG) from ssl(8).
Removed compression from ssl(8).
Simplified the way divert(4) sends packets to userspace.
When relayd(8) is copying structures via imsg, ensured contents do not contain bogus pointer values.
Merged in mesa 10.2.3.
In ssl(8) ocsp_lib.c, reset host, port and path to null after freeing so the caller doesn't accidentally free them again.
Removed mkstr(1) and xstr(1).
Replace relayd(8) protocol directives for HTTP with a new generic filtering language (grammar inspired by pf(4)).
Fixed resume time page table issue on amd64 if the piglet was located above 1GB physical (caused by using an incorrect page size mask).
Cleaned up and simplified ssl(8) SSL_CIPHER_description by always using asprintf(3).
Added daemon_timeout variable to rc.d(8) and rc.subr(8) (sets maximum time to wait for actions to return).
Fixed crash in ssh-add(1) while loading more than one key.
Fixed classless-{ms-,}static-routes in dhcpd(8) to comply RFC 3442.
Added "no-dsn" listener option smtpd.conf(5), which disables DSN extension.
Suspend kernel's stack smash guard to avoid panicking during unpack.
Fixed i386/amd64 hibernate issue where kernel lock acquisition was started but not completed.
Removed ssl(8) "export" cipher handling.
ncheck_ffs(8) now accepts duid for the filesystem argument.
smtpd(8) config parser improvements: fail if the same option is specified multiple times on a listener; prompt for queue encryption key after (not during) smtpd.conf(5) parsing; added ip addresses to localnames table.
bpf(4) code simplification.
Set sysctl(8) default of net.inet6.icmp6.nodeinfo to 0, disabling responses to RFC4620 IPv6 Node Information Queries.
Fixed boot(8) -d on amd64 and i386.
Updated to lynx(1) version 2.8.8rel2, keeping local changes.
Downgraded more ssh(1) error() to debug(). Suppresses spurious errors with hostbased authentication enabled.
More useful sftp(1) error message when GLOB_NOSPACE occurs (bz#2254).
While filling the rx ring, stopped bnx(4) and msk(4) being too smart in avoiding overuse of file descriptors.
Marked the weakened ssl(8) 40-bit export ciphers as invalid.
smtpd(8) now sends correct imsg when enabling profiling at runtime.
Removed asa(1).
Fixed a double free bug in parsing npppd.conf(5).
Stopped npppd(8) accessing freed memory when it is exiting.
Define SMALL_REGISTER_BANK in ssl(8) on arm and vax. Generates faster code (vax 30% faster).
Various smtpd(8) queue improvements.
Made sure to clear the WAIT flag when cancelling the smtpd(8) MTA connector timeout.
Pulled the rx ring accounting out of the mbuf(9) layer. Simplifies the allocation paths.
On em(4), bus_dmamap_sync the rx ring once per em_rxeof call, rather than for every rx descriptor.
Stopped em(4) stalling the entire tx path when it encounters a heavily fragmented packet.
Cleaned up mandoc(1) ERROR messages related to document structure and macros.
Run getuid(2), getgid(2), getresuid(2), setreuid(2) and setuid(2) without the kernel lock.
Stopped pckbc(1) printing warnings for mouse interrupts when running bsd.rd.
In pkg_add(1), restored the progress meter for large files.
Stopped mandoc(1) unnecessarily deleting any content from .Rs blocks.
Implemented .dei and .ami in roff(7).
smtpd(8) now allows enabling profiling at runtime.
If acpi(4) finds a bogus interrupt, don't panic but print a message, to workaround dodgy BIOS.
Marked getentropy(2) with NOLOCK (it doesn't need the kernel lock).
After mandoc(1) skips an escape sequence with incomplete arguments, stop it discarding the rest of the string.
Fixed expansion of escape sequences with incomplete arguments by roff(7).
Fixed handling of escape sequences taking numeric arguments by mandoc(1).
Avoid radeon(4) segfault on device open when accel is not working.
Fixed ssh(1) remote-forward cancel regression.
ftp(1) fixes: URL-decode user and password info before base64 encoding it for the Authorization header; eliminated COOKIE_MAX_LEN constant; renamed the "user:pass" variable from "cookie" to "credentials"; empty password is no longer an error; fixed leak of username/password memory.
Cleaned up -offset and -width in mandoc(1): bugfix so last one wins; do not ignore ".Bl -width" without argument.
smtpd(8) will now always attempt to use tls for relaying to the primary server when acting as a backup mx.
tcpdump(8) now always prints the OSPF router id.
Changed kvm_getprocs(3) (sysctl(3) and kvm(3) backends) to report thread's "most active" scheduler state.
Fixed mandoc(1) formatting of empty .Bl -inset item heads; show the list type in the error message.
Added a sshd_config(5) PermitUserRC option to control whether ~/.ssh/rc is executed (bz#2160).
Allow explicit ::1 and 127.0.0.1 forwarding bind addresses when GatewayPorts=no. Allows client to choose address family (bz#2222).
When ssh(1) is rekeying, skip file/DNS lookups if it is the same as the key sent during initial key exchange (bz#2154).
radeon(4) now gets clocks from Open Firmware on macppc and sparc64.
bge(4) can now cope with heavily fragmented packets when the DMA map lacks space.
Stopped uvm(9) releasing the kernel lock between issuing a wakeup and clearing the PG_BUSY and PG_WANTED flags.
Made ssh(1) "too many authentication failures" message format similar to other authentication messages (bz#2199).
Reverted to r1.129 of sys/kern/subr_pool.c, as pool_init() is called before rwlocks can be used on some archs.
ssh_config(5) LocalCommand and ControlPath variables now expand to unique identifers (bz#2220).
When hashing or removing hosts using ssh-keygen(1), no longer choke on @revoked markers or remove @cert-authority markers (bz#2241).
Standardised ssh(1) on NI_MAXHOST for gethostname(3) string lengths. Fixes bz#2239.
Use EVP_Digest() for one-shot hash instead of creating, updating, finalising and destroying a context in ssh(1) (bz#2231).
Made stdout line-buffered; saves partial output getting lost when ssh-add(1) fatal()s part-way through (bz#2234).
Only cleanup agent socket in the main ssh-agent(1) process, not in any subprocesses (bz#2236).
Made ed25519 key titles fit properly in the ssh(1) randomart border (bz#2247).
Be more careful when recreating single-precision (float) argument to service precise exceptions on m88k.
Improved mandoc(1) messages about empty macros (reporting the macro names involved).
Fixed fpu_compare() on m88k, so gcc(1) correctly compare numbers to infinity.
Hold kernel lock when invoking process_domem() on alpha and m88k. Fixes ptrace(2) operation on MP kernels.
Added support for adjusting the receive filter to allow for promiscuous mode/multicast traffic by imx(4/armv7).
Revised change made in pk7_doit.c r1.20 in ssl(8). Fixes detached signature processing.
Made sure tmux(1) session sockets are not cleared in the daily(8) tmp cleanup.
Fixed the column numbers associated with in_line_argn() macros in mandoc(1).
kdump(1) now properly processes minherit(2) flags.
Improved "skipping paragraph macro" messages in mandoc(1).
Fixed regression in ssh(1) protocol 1 to avoid fatal(); more useful status codes.
Implemented obsolete mdoc(7) macros .En .Es .Fr and .Ot for backward compatibility.
Clean up the warnings related to mandoc(1) document structure.
Allow link-local address to be configured by "ifconfig up" if the inet6(4) address was configured beforehand.
Fixed panic seen when trying to remove a route(4) with a 0.0.0.0 destination.
Turned pkg_add(1) out-of-order extraction back on; activated out-of-order archives based on history.
scsi(8) io can now run through the midlayer without the kernel biglock.
Fixed roff(7) control flow keywords \{ and \} when they immediately follow a request or macro name.
pfctl(8) af-to rules no longer need to specify the address family after "pass".
Suppressed spurious ssh(1) error message when loading key with a passphrase.
Attach HFSC only after it's been initialised. Fixes the "integer divide fault trap" bug.
Major cleanup in roff(7) .de parsing routine, to correctly handle names terminated by escape sequences.
Fixed loading of private keys by ssh(1).
Move to a smaller rbytes buffer and skip a random part in malloc(3), to introduce noise in the arc4random(3) calling pattern.
Fixed remote forwarding in sshd(8) with same listen port but different listen address.
Avoid buffer overflow when there are too many boot arguments, and on reaching maximum line length.
Do not redirect STDERR of security(8) to /dev/null, so errors in the security(8) script are seen.
Fully remove relevant carp(4) addresses when IFXF_NOINET6 is set or when the rdomain is changed.
Workaround compatibility problems between Intel ahci(4) and Intel SSDs, by retrying device detection.
pfctl(8) now disallows translation rules containing addresses of { inet(4) inet6(4) } when the rule doesn't specify one.
When the nsd(8) daemon is launched via rc.d(8), use a correct exit code (per rc.subr(8)).
Improved messages with roff(7) ".so": show the filename argument that was passed; on failure, report the file/line number.
If an ssl(8) chacha operation does not consume all of the generated key stream, save it for subsequent writes.
Made TCP_NODELAY work in ssl(8).
Removed the noaccesstime synonym for noatime in mount(8).
When scp(1) is copying local to remote and it fails during read, don't send uninitialised heap to the remote end.
Don't fatal() ssh(1) when hostname canonicalisation fails with a ProxyCommand in use.
New ssh(1) key API: refactored key-related functions to be more library-like (existing API now a set of wrappers).
Fixed bug in ssh(1) KRL generation: multiple consecutive revoked certificate serial number ranges could be serialised to an invalid format.
Made gcc(1) version 4 emit warning when it is ignoring alignment constraints.
Fixed possible crash on encountering invalid msdosfs filesystems.
Disabled IPv6 on interfaces by default (a link-local address is no longer assigned by default).
Use bus_space(9) on acpi(4) SystemMemory, to correctly access memory mapped registers.
Made "ifconfig(8) <if> inet6 eui64" reset the NOINET6 flag (unconditionally), to ensure link-local address is assigned.
Allow tmux(1) keys and send-keys to send to invisible panes.
Fixed tmux(1) so it counts mouse clicks correctly.
Stopped building procfs on i386.
In ssl(8) BIO_get_port(), only accept valid port numbers.
Made sure uvm(9) kmthread never loops without making progress.
kill(2) an untraced process (instead of looping) if the kernel generates a deadly trap signal and it is ignored.
Specify the correct strength bits for 3DES cipher suites in ssl(8).
Protect explicit_bzero(3) from a link-time optimisation.
In ssl(3), wrap getenv(3) OPENSSL_ALLOW_PROXY_CERTS in an issetugid(2) check. Stops setuid(2) applications from being fooled.
Prefix error messages from mandoc(1) with "mandoc: ", so users know where messages came from.
Made "S" and "E" mean the start and end to capture-pane in tmux(1).
Fixed incorrect bounds check in amd64 assembly version of ssl(8) bn_mul_mont().
Made tcpdump(8) -v display any bad checksums contained in the header and what the checksum should be.
More tweaking of makewhatis(8) set_basedir(): do not error out when getcwd(3) fails; fixed the man-root-dir indicator in say().
In arc4random(3), hard fail with SIGKILL if getentropy(2) returns -1.
Converted CRYPTO_memcmp to timingsafe_memcmp in ssl(8).
Improved error checking in ssl(3) by_dir.c: set error code on error; check malloc(3) return; added missing unlock.
Fixed memory leak in md5(1) digest_file() on ferror(3).
Implemented the membar(9) API for powerpc.
Copy newline when at EOL when tmux(1) is in vi(1) mode.
Made tmux(1) reset the mouse buttons when the mouse wheel is used.
Some terminals send spurious releases for mouse wheel in SGR mouse mode, tmux(1) now suppresses these.
Fixed black screen on lenovo ideapad yoga 2 pro using when using intel(4).
Restored previous arc4random(3) behaviour, where fork(2) children would mix in some randomness from the parent process.
Stopped makewhatis(8) displaying "unable to open mandoc.db" error messages when updating/deleting individual files.
Ensured fsck_msdos(8) will always keep length of cluster chain up to date. Avoids out of boundary accesses.
Fixed off by one in msdosfs pm_inusemap().
Fixed the use of 16384-bit RSA keys by ssh(1).
Changed SSL_COMP_add_compression_method() in ssl(8), so error cases actually return "error" rather than "success".
Disallow __sysctl() in the sshd(8) systrace(1) sandbox (as there is now a dedicated getentropy(2) system call for arc4random(3)).
Implemented the membar(9) API for hppa.
Added configuration bit in vio(4) flags, to workaround qemu < 2.0 bug that prevented VLANs from working.
Be more aggressive flushing L2 cache entries on mips64 RM7000 systems.
Set uart based on the io clock rate on octeon II (CN6xxx), as the rate differs from the cpu clock.
Use MAP_INHERIT_ZERO in arc4random(3), to zero out the RNG state if the process forks.
Enabled pci(4) power management on lemote.
Reverted "Always create a local route for every configured IPv4 address" (caused regressions).
Allow the autoinstaller to fetch sets from multiple locations.
Fixed vnode leak in systrace(4).
In ssl(8) aes_gcm_cleanup(), clean the entire context (no longer leaving AES key untouched).
Fixed hang with virtio event_idx feature, to cure occasional network freeze in vio(4).
Updated to xcb-util-renderutil 0.3.9.
Avoid infinite loop in fsck_msdos(8) if cluster chain is a cyclic list.
Fixed memory leaks in fsck_msdos(8) bootblock handling.
Fixed fsck_msdos(8) regression in r1.16 of boot.c: write fsinfo, not block into FSInfo region.
Fixed fsck_msdos(8) regression in r1.20 of fat.c by properly incrementing a pointer.
Added more bounded attributes to the buffer and md5/sha headers in ssl(8).
Removed wait(2) support for "union wait" (deprecated since 4.3BSD) and WSTOPPED (means something else now in POSIX).
Stopped ze(4/vax) rx ring pointer stalling when running "all multicast" or bpf(4) in promiscuous mode.
Switched dump(8) "blockswritten" to int64_t, so it won't wrap at 2TB.
Correctly calculate the key block length in t1_enc.c and s3_enc.c when using ssl(8) "export" ciphers.
Added ChaCha20-Poly1305 based ciphersuites to ssl(8).
ssl(8) can now change cipher state with an EVP_AEAD, encrypt/decrypt TLS using the EVP_AEAD.
Added getentropy(2) system call.
Indicate in the sysctl(1) LIVELOCKS column if there is a pending (deferred) mbuf(9) update.
Fixed tcp-mss-adjust in pipex(4) and npppd(8).
Removed support for the "opaque PRF input" extension from ssl(8) (draft expired 7 years ago and never became an RFC).
Added timingsafe_memcmp() to memcmp(3).
Added MAP_INHERIT_ZERO support to minherit(2). Provides child process with fresh, zero-initialised anonymous memory.
Fixed ptrace(2) hanging hppa and mips64 MP systems, by grab the kernel lock before cleaning up single-step breakpoints.
Updated to nginx(8) version 1.6.0 (including syslog support backported from the 1.7 branch).
Disable the "switch to insertion sort" optimisation in qsort(3). Avoids quadratic behaviour for certain inputs.
Changed pkg_add(1) to display the full url (if possible) for unsigned packages.
Fixed memory leak in ssl(8) d1_lib.c.
Restored the original behaviour of RTM_ADD and RTM_DELETE by always generating one message per locally configured ip(4) address.
Always create a local route(4) for every configured IPv4 address on the machine.
Flag any local route(4) as such and make them use the highest possible priority.
Created (currently unused) system taskq ("systqmp") which runs without the kernel lock (see task_add(9)).
Raised the low water mark in em(4) so the internal buffers can hold at least two jumbo frames.
On i386/amd64 hibernate, don't map phys pages < 64KB in the resume page table. Matches recent kernel change.
Fixed off by one in fsck_msdos(8) when writing the FAT for FAT12 filesystems.
In ssl(8), check return value of EVP_MD_CTX_copy_ex(). Avoids potential null pointer dereference.
In mtree(8), added ed25519 ssh host keys to /etc/mtree/special.
Lowered nc(1) buffers back to 16k for now, to avoid bufferbloat.
Increased nc(1) buffer size to 64k, and actually use the buffer.
Abandoned the ssl(8) "auto-ENGINE" /dev/crypto interface.
In ssl(3) tls1_cert_verify_mac(), avoid a possible NULL function call on ctx.final().
Implemented slowcgi(8) -u (user to drop privs to) and -p (path to chroot(8) to). Allows slowcgi(8) to run non-chrooted.
Cleaned up slowcgi(8) socket creation.
Multiple fixes for ssl(8) ssl3_digest_cached_records().
Ensured ssl(8) ssl3_final_finish_mac() returns failure if either the MD5 or SHA1 handshake MAC calculation fails.
Changed installboot(8) file copying process, to make it less likely that the PBR will change upon update.
Fixed possible out of boundary access by fsck_msdos(8) if the filesystem is full or corrupt.
Updated to xf86-video-modesetting 0.8.1 and xf86-video-geode 2.11.15.
Further cleanup of context handling in ssl(3) tls1_change_cipher_state().
In run(4), fixed TXWI and RXWI offset calculations so RT5592 devices function.
When relying on the local enqueuer, let smtpd(8) cope with long To/Cc lines. Avoids broken headers and confusing some MUAs.
Fixed inverted test in ssh(1) so PKCS#11 keys that are explicitly listed are preferred.
Reset properly when tmux(1) c0-change-trigger is increased from zero, so panes don't get stuck.
5.4 and 5.5 and -current SECURITY FIXES in ssl(8) for: buffer overflow with crafted DTLS fragments (CVE-2014-0195); DTLS infinite recursion flaw with "Hello Request" (CVE-2014-0221); SSL/TLS MITM vulnerability (CVE-2014-0224); anonymous ECDH denial of service (CVE-2014-3470).
A source code patch is available for 5.4 and 5.5.
Reduced amount of traceroute(8) code running as root; only error out if the creation of a needed socket failed.
Moved ld.so(1) to a (slightly stripped) version of libc malloc(3).
5.4 and 5.5 and -current SECURITY FIX: improper close-on-exec flag handling by sendmail(8) (CVE-2014-3956).
A source code patch is available for 5.4 and 5.5.
Added support for COLUMNS env variable to ps(1).
Included work-around in mandoc(1), as makewhatis(8) expects its current dir to not be /.
vflush(9) now works for fuse(4).
Do not skip or add a byte for the report ID when usbhid(3) is manipulating data.
Made uaudio(4) properly compare endpoint addresses by ignoring the direction bit.
Accept -C as an alias for -c in tr(1).
Made zyd(4) compile with ZYD_DEBUG.
Fix zyd(4) frame length adjustment in the RX path.
In libm math code, made sure STRICT_ASSIGN handles double as well.
Stripped openssl(1) functions called when "-rand" is specified (underlying code long gone).
Removed easy access to the unsafe intel RDRAND instruction from ssl(8).
When checking for unicast and broadcast addresses, do one lookup instead of two.
Fixed uninitialised variable, which caused sndiod(8) crashes when handling errors.
In ssl(3) tls1_setup_key_block(), use the correct IV length for GCM mode. Fixes key block length calculation.
Removed real mode vga(4) repost option.
Change the actual default for returned asn1 strings to utf8 in the ssl(3) code.
Reverted previous diff setting cold to 1 on shutdown (broken with softraid(4) disks).
Added dump(8) -S option, to only estimate backup size and number of tapes required.
Avoid panics on macppc with an uhci(4) cardbus when halting/rebooting.
Fixed segfault seen on Xorg(1) startup when using the nv(4) or savage(4) drivers.
Converted many malloc(3) to reallocarray(3). Avoids 53 potential integer overflows in ssl(8).
In envy(4), use the same convention for mixer control names as in azalia(4).
Added an enc_flags field to ssl3_enc_method. Helps identify ssl(3) protocol version requirements.
Made fsck(8) use the same values in checking as newfs(8) does in creating a fs(5).
Fixed two more cases where ssl_replace_hash() return value was not checked by ssl(8).
To give perl(1) a random seed, call arc4random(3) rather than read /dev/arandom. Makes it work in chroot(8) environments.
Enabled writing per-commit commitid tokens to rcs(1) ",v" files.
When less(1) is invoked as more(1), made behaviour for "-i" match "less -I" (per POSIX).
When suspending/resuming, avoid hangs by detaching/attaching usb(4) devices (avoids uhub(4) interrupt races).
On mg(1) delete-window, display the correct line number when revisiting the buffer.
Added -L option to pwd(1) (required by POSIX).
Fixed mount(8) -ur for msdosfs: allow sync after more than one rw -> ro cycle; sync data (not only metadata).
Fixed instance of the Y2038 problem in ssl(8).
Refactored radix code. Solves issues with failed deletes of down routes.
Enable strong stack protector by default for architectures running gcc(1) version 3.
Allow tmux(1) to handle the top bit of xterm(1)-style modifier keys.
Added some formats for tmux(1) pane bounds.
Prevented userland from altering the local and broadcast flags in route(4).
Reserved the highest route(4) priority for kernel-managed routes.
Fixed memory leak and un-cleaned EVP_CIPHER_CTX upon error in ssl(3) tls_decrypt_ticket().
Removed /usr/src from mtree(8) to avoid useless warning from daily security(8) mail.
Implemented improved ssl(8) EVP AEAD API.
Made sure utpms(4) only matches mouse interface, so ukbd(4) works on more Powerbooks.
Fixed ssl(8) resource descriptor leaks (CID: 966576 & 966577).
Allow tty(4) to handle threaded processes correctly with kerninfo status requests (a.k.a. ^T).
Fixed azalia(4) format mistakes when AZALIA_DEBUG is defined.
Pass DVACT_QUIESCE to usb(4) to stop "new" uhub(4) device reattaching at every resume.
Fixed off-by-one in index validation before accessing arrays in ssl(8) ssl_cipher_get_evp().
In ssl(3), enabled three brainpool elliptic curves for TLS (per RFC 7027).
Made fsck_ext2fs(8) and fsck_ffs(8) output verbiage more consistent.
Added support for newer run(4) hardware.
Made fsck_ext2fs(8) initialise newent.e2d_type to EXT2_FT_UNKNOWN (a.k.a. 0).
Reverted pax(1) ar_io.c r1.45 to stop showing archives written with a non-standard blocksize as truncated reads.
Stopped tcpdump(8) "weird flag" warning for DNS NOTIFY messages which should have "AA" set.
Permit less(1) searches to work past/across NUL bytes.
Made the pax(1) signal handler safe.
Expose bif_capacity in acpibat(4), to report the design capacity of the battery.
Clean up after the snmpd(8) traphandler children, to avoid leaving zombie processes.
Marked ssl(8) malloc(3) wrapper functions as deprecated.
Fixed smtpd(8) crash when running the pki lookup code.
On sgi, converted the PS/2 keyboard layouts to sgi serial keyboard layouts.
Let sgi keyboard(7) work in polling mode; fixed "international" ("GERlessthan") key.
Made qle(4) less likely to get stuck looping when the firmware behaves inconsistently.
Fixed file size reported by lpq(1) -l by giving stat(2) privileges on the spool file.
Fixed fdisk(8) -u on sparc64.
Fixed ipsec(4) route addition, broken since the removal of the link-layer addresses from the per-ifp list.
Made xhci(4) handle the stall condition like the bable condition.
pax(1) now exits with non-zero status if a read is truncated.
Added support for -o XXX or -oXXX options, and -o max_read=XXX to fuse(4).
When sending icmp(4) messages, assign the queue ID to the correct packet header.
Fixed eui64 address generation, broken upon removal of the link-layer address from the per-ifp list.
No more (obsolete) 5- and 6-byte or surrogate pair code point encodings in ssl(8) UTF8_{getc,putc}.
Upon HTTPS ftp(1) redirects, don't reinitialise ssl(8), and reuse SSL_CTX.
Plugged memory leak in rcs(1).
More consistency in fuse(4) error handling.
Made fuse(4) use realpath for more reliable mount(8) operations.
On armv7, loongson and socppc use autoconf(9) to track usb(4) host controller's children.
Stopped dhclient(8) trying to update file when none has been specified by -L flag.
Added H_SAVE_FP operation to editline(3), to save history to an open file pointer.
Fixed uhci(4). Unbreaks the build when DIAGNOSTIC is not defined.
Updated run(4) firmware to version 0.33.
Made mkuboot(8) correctly handle files smaller than an elf(5) header.
In ssl(3) ssl3_send_certificate_request(), properly adjust for payload size.
Upon error, made sure ssl(3) ssl3_setup_buffers() frees pqueue before returning.
Fixed tail packet check in pms(4) elantech v3 touchpad code.
Stopped dhclient(8) adding a lease to the leases TAILQ more than once. Avoids infinite loop.
Updated to libXfont 1.4.8.
Check ssl(3) bio_err initialisation succeeds before using it.
Updated to fontconfig 2.11.1.
Updated to xf86-input-synaptics 1.8.0.
Fixed kernel build when ehci(4) uses EHCI_DEBUG.
Switched ssl(8) RSA key generation default to 2048 bits (matching ssh(1)).
Made qla(4) less likely to get stuck looping when the firmware behaves inconsistently.
Change interrupt handler's return value to 0 when nothing is processed on pcexmem(4/luna88k).
When pfctl(8) is parsing a numerical value for the TOS bits, ensure it is in a valid range.
Fixed mountd(8): when a host in a netgroup is unresolvable, don't ignore entire netgroup.
Sped up signify(1) -C.
Made df(1) do calculations of available space the same way as ffs_statfs() does.
Improved logging messages and style for snmpd(8).
Don't put a link-layer address on the per-ifp lists or RB-Tree. Improves address lookups.
Fixed memory leaks in ssl(3) asn1 upon failure.
Replaced ssl(3) ASN1_GENERALIZEDTIME_adj(), ASN1_UTCTIME_adj() and ASN1_TIME_to_generalizedtime() with wrappers.
Added a ChaCha20-Poly1305 AEAD EVP implementation to ssl(3) libcrypto.
Added an AEAD EVP interface to ssl(3) libcrypto, along with AES-GCM AEAD implementations.
Made signify(1) -C mode work again.
rtadvd(8) now ignores route info messages on the listening side.
Stopped flushing streams on abort(3), which was unsafe.
Removed arch-specific lo(4) MTU and set to 32768 everywhere.
Made signify(1) recode base64 hashes if necessary; spell out base64 in error messages.
Better use of realloc(3), to speed up signify(1) checksum verification.
Added poly1305 to ssl(3), utilising Andrew Moon's public domain implementation.
tmux(1) no longer allows multiple buffers with the same name.
5.4, 5.5 and -current SECURITY FIX: integer, memory and buffer overflows in libXfont (CVE-2014-0209; CVE-2014-0210 and CVE-2014-0211).
Fixed regression in r1.285 of sys/net/if.c (TAILQ corruption where rdomain was not switched).
In iked(8), pass SA initiator (not the exchange initiator) to sa_address().
The resolver now skips incomplete entries in /etc/hosts and /etc/networks (rather than crash).
Pass multi-argument tmux(1) commands directly to execvp(3). Helps avoid quoting problems.
Added a copy mode key binding to copy to a named tmux(1) buffer.
Added tmux(1) support for named buffers.
Fixed multiple bugs in ncheck_ffs(8) handling of indirect blocks.
Updated drm(4) to libdrm 2.4.54.
Fixed ntpd(8) format strings involving time_t arguments. Fixes ntpd(8) -d on sparc.
Moved GTT management for Sandy Bridge into inteldrm(4).
Removed AES_bi_ige_encrypt() from ssl(3).
Removed md5crypt from crypt(3).
Moved the ohash functions into libutil.
Stopped dhclient(8) exiting when sent RTM_NEWADDR or RTM_DELADDR routing messages lacking appropriate address info.
Altered usbhidctl(1) and usbhidaction(1) parsers to keep in sync with the kernel HID parser.
Fixed possible smtpd(8) double free when tls is required but not advertised by the server.
Updated the HID parser to properly parse modern input device descriptors.
Added router alert option (RAO) in IGMP packets (per RFC2236), needed by some L3 switches.
More intelligent parsing of WEP keys by ifconfig(8).
Make sure uhub(4) root hub is re-attached before interrupts get enabled. Unbreaks resume.
Stop ignoring "lease" statements in dhclient.conf(5).
Reworked/restored dhclient(8) recorded lease handling.
Fixed the installer's configuration of a static IPv6 default gateway.
Various format string fixes on mips64 and octeon.
Fixed recently-occurring ssl(8) breakage in smtpd(8).
On i386/amd64, disable speedstep instead of panicking if high and low speeds are the same.
Allow nginx(8) to chroot(8) to a directory other than /var/www.
Many string format fixes on sparc64.
Losing TCP connection no longer results in an unrecoverable stop in iscsid(8).
Stopped cribbage(6) ignoring words which followed two or more blank characters.
Print interface name with queues in systat(1) q.
Updated to: xterm(1) version 304; libXi 1.7.2 and xf86-input-synaptics 1.7.5.
Fixed fsck_ffs(8) -b to work with the superblock locations on 4096-byte sector disks.
Use the highest possible priority for any route(4) to local addresses.
Stopped cribbage(6) choking on one-letter card names which followed three-letter card names.
Fixed potential uvm(9) integer overflows.
Made relayd(8) fail when encountering unsupported combinations.
Only attach pcexmem(4/luna88k) and pcexio(4/luna88k) on luna88k2 (not luna88k).
Brought back restricted sockets to snmpd(8), inadvertently removed in recent update.
Made zmore(1) call more(1) and zless(1) call less(1).
Repaired the termination condition of a write(2) loop in vipw(8).
In ssl(8) ec_asn1.c, don't free memory unless we allocated it (RT#3338).
Improved code to clear all bignums from bn_lib.c in ssl(8).
In ssl(8) BN_clear_free(), don't cleanse the data if the static data flag is set.
Render roff(7) escape sequences in man page descriptions prior to insertion into mandoc.db(5).
Fixed two memory leaks in makewhatis(8) -n.
Fixed segfault in makewhatis(8) -Q if the next .SH after .SH NAME does not have any arguments.
Backed out the previous ICMP simplifying diff from dhcpd(8), which caused livelocks.
Try postponed requests first, so iked(8) does in-order processing.
Made iked(8) authentication work with X.509 certificates not containing a subject-altname.
Removed the undocumented and ineffective ln(1) -F option.
Removed sysctl(8) {nd6_,}useloopback options.
Fixed recently broken ext2fs atime and mtime.
Introduced gcc(1) -fstack-shuffle, which randomises local stack variables.
Make sure ssl(8) PKCS7_get_octet_string() return values are checked for NULL (PR#3339).
Enabled brswphy(4/octeon).
Allow iked(8) to initiate a create-child-SA and process requests for the peer simultaneously.
Explicitly zero ibufs before releasing memory. Ensures iked(8) crypto parameters are cleaned.
Fixed memory leaks in the relayd(8) and smtpd(8) ssl(8) code.
Re-queue pfkey events while iked(8) is busy initiating child-SAs.
In iked(8), initiate ike SA rekeying ("ikesalifetime" keyword).
Fixed iked(8) memleak when SA lookup fails while forwarding encrypted ip6(4) packets.
Plugged two ucom(4) xfer leaks and a buffer leak.
Encrypt some iked(8) notify payloads.
Initial iked(8) support for PFS.
Cleanse old ssl(8) memory when expanding a bignum; clear all bignums when freed.
Updated xkeyboard-config to version 2.11.
Workaround overoptimistic fdisk(8) alignment expectation on dos_partition fields.
Enhanced reading of saved ascii labels when using disklabel(8) -R.
Stopped iked(8) leaking on pid mismatch.
Validate the attribute length in iked(8).
Removed SRP and Kerberos support from ssl(8).
On sparc, enabled ssl(8) assembler code for DES.
On vax, enabled the ssl(8) assembler code for BN.
In relayd(8) and smtpd(8), fixed SSL/TLS and a possible fatalx() on machines without a default RSA engine.
Added sysctl(8) kern.nosuidcoredump=3, to dump core(5) into the /var/crash/progname/ directory.
Enabled ssl(8) assembler code for AES, DES, GCM, SHA1, SHA256 and SHA512 on sparc64.
Enabled ssl(8) assembler code for AES, BN, GCM128, SHA1, SHA256 and SHA512 on arm.
Updated to: xauth(1) version 1.0.9; xbacklight(1) version 1.2.1; xrandr(1) version 1.4.2 and xinput(1) version 1.6.1.
Updated to libFS 1.0.6.
Unbroke ssh(1) compression.
Switched to generating bcrypt(3) 2b hashes by default.
Added checks for invalid base64 encoded data in ssl(8) padding. Fixes a crash (RT#2608).
Provide extended-precision math constants (required by POSIX).
Stopped citrus UTF-8 parser rejecting 0xFFFE and 0xFFFF (they do not render strings invalid).
drm(4) i915 fixes: workaround inverted brightness for Acer Aspire 5336; fixed gen4 composite s-video tv-out.
Updated Xserver(1) to version 1.15.1.
On hppa, fixed ssl(8) assembler version of SHA512 to output correct results.
Make acpiprt(4) correctly handle interrupts with non-standard polarity.
In acpi(4), made acpi_mutex_acquire/release actually grab the global lock when called.
Fixed occasional disklabel(8) crashes when altering mount points.
Reverted __bounded code in ssh(1).
Oh hppa, use assembly code for AES, BN (Montgomery), SHA1, SHA256 and SHA512 in ssl(8).
Stopped ssl(8) perl(1) scripts outputting SOM-specific directives.
Removed unreferenced OPENSSL_instrument_bus and OPENSSL_instrument_bus2 routines from ssl(8).
Extended fread(3) and fwrite(3) to check for integer overflows.
Moved smtpd(8) RSA key handling from "lka" to a new dedicated "ca" process.
5.4 and 5.5 RELIABILITY FIX: Stop attacker's ability to trigger an ssl(8) alert, which could cause a null pointer dereference.
A source code patch is available for 5.4 and 5.5.
Fixed gcc(1) on i386, to detect overflows and properly align arrays > 16 bytes.
Added ChaCha cypher to ssl(8), and provided it with an EVP implementation.
Added Brainpool and ANSSI FRP256v1 elliptic curves to ssl(8) (RT#2239).
Corrected isakmpd(8) test when passing data to a keynote.
Improved malloc(3)'s ability to pick a free chunk at random.
uvm(9) now correctly flush discarded pages even if the number of hash buckets doesn't change.
When openssl(1) isn't available, ssh(1) now uses local fallback implementation of AES for UMAC.
Preserve the intended chronological order of leases in dhclient.leases(5) files.
Fixed growfs(8) on 4K-sector disks.
First pass at removing win64 support from the assembly-generating perl(1) scripts in ssl(8).
Stopped smtpd(8) trying to create folders that already exist when using maildir.
Improved imsg handling with many concurrent connections in smtpd(8).
New buffer API, to eventually make ssh(1) usable as a standalone library.
Improved enforcing of proper alignment of stack variables on sparc.
smtpd(8) RSA private key privsep will now only load keys after forking the separated process.
Stopped sftp(1) attempting to append a nul quote character to filenames (bz#2238).
Implemented RSA privilege separation for smtpd(8). Prevents possible private key leakage.
Made compiling ssh(8) and sshd(8) against ssl(8) optional.
When smtpd(8) fails to relay via TLS (and smtpd.conf(5) doesn't require security), try plain; also downgrade if a TLS error happens during the session.
Constrain bytes read/written to positive values in ssl(8) s3_pkt.c code.
Re-added local aesctr implementation to ssh(1).
Moved traceroute6(8) to the attic, fully merged into traceroute(8).
Removed large memory leak from usb(4).
Deleted SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS from nginx(8) to keep attack mitigations enabled.
Stopped ssh(1) sending success/failure replies when channels have sent a close already (bz#1818).
Removed less(1) support for the obsolete (non-POSIX) "more -d" prompt.
Made sure the iked(8) state machine only advances if the AUTH payload has been verified.
Use explicit_bzero(3) instead of memset(3) to clear out sensitive smtpd(8) data.
Implemented AI_ADDRCONFIG in getaddrinfo(3), as per RFC 3493.
Removed more WIN32, WIN64 and MINGW32 tentacles from ssl(8).
Use the correct algorithm mask in ssl(8) t1_enc.c.
In ssl(8), stopped SSL_OP_ALL disabling attack mitigations against CBC modes.
Let nm(1) -w correctly return 0 for valid archives.
Stopped ping(8) and ping6(8) sleeping after poll(2) returns an error.
Added fuse(4) support for 255 character file names.
m4(1) now checks for integer overflows in custom allocs.
Added support to snmpd(8) for exporting ARP table via "ipNetToMediaTable" OID.
Fixed a loop so that waiting for wds(4/i386) hardware actually happens.
Improved error handling when using dbopen(3) in mandoc(1).
Fixed library search order in libtool(1).
Updated to xproto 7.0.26.
On i386, installboot(8) no longer overwrites disklabel and nearby blocks on 4k-sector disk drives.
Stopped bluetooth(4) HID device grabbing the console.
Re-added "_ppp" user and "_ppp" group, to be solely used by npppd(8) going forward.
Stopped ssl(8) using random stack memory as addresses of strings.
Removed support for building openssl(1) on 16-bit Windows.
Filter excess data from autoinstall output, to avoid filling the ramdisk.
Made more(1) POSIX compliant with respect to the -e option.
Merged less(1) version 458, including local changes.
Reduced the verbosity of makewhatis(8) -t.
Do not re-probe pms(4) unnecessarily. Fixes 12 seconds Xorg(1) delay on some laptops.
Stopped iked(8) and mpii(4) accessing pointers prior to a null check.
Allow snmpd.conf(5) to set user-defined actions on receipt of snmp traps.
Removed kinit(1).
Fixed sudo(8) when checking command line environment variables against the blacklist (CVE 2014-0106).
Fixed copied text in the snmpd(8) error string.
Stopped ssl(8) do_ssl3_write() being called recursively; don't release buffer meant for use.
Audited malloc(3)/calloc(3)/realloc(3) usage in mandoc(1) to be safe from overflows.
Fixes in ssl(8) kssl.c to prevent double frees and removed a use-after-free.
Fixed leak in ssl(8) BIO_accept which could have caused the caller to crash.
Audited strlcpy(3)/strlcat(3) usage in mandoc(1).
Removed "Z" option from malloc.conf(5); by default always junk small chunks now.
In unbound(8), use arc4random(9) as PRNG backend, instead of the libcrypto RAND.
disklabel(8) now fills all required fields after clearing. Avoids consistency check failures.
Improved malloc(3) hash functions that compute the same on big-endian and little-endian archs.
Removed OPENSSL_indirect_call() from ssl(8) for reduced attack surface.
Fixed a missing splbio(9) in sys/ufs/ffs/ffs_softdep.c which caused crashes.
Remove useless RX checksum offloading support from gem(4) and hme(4).
Removed Apache from base (replaced by nginx(8)).
On bge(4) when VLAN_HWTAGGING is disabled, stopped tagging the packet twice.
Prepend ether_vlan_header rather than regular ethernet header for more efficient vlan tagging.
Kerberos disabled and removed from base, possibly to be moved to ports(7) later.
Support the CA key for ssl(8) inspection in the relayd(8) CA process.
Avoid a loop during autoinstall when the path in the responsefile does not exist.
Made iscsictl(8) print bytes read and written in human-readable form.
Allow the installer to configure dhcp for an interface without an active network connection.
Bind iscsid(8) to localAddr if it is specified.
Print the target and initiator name in iscsictl(8) show command.
Verify permissions are correct on the ssh(1) id_ed25519 file.
Fixed msdosfs to cope with 64-bit time_t. Set unrepresentable dates to 1/1/1980.
Made dhclient(8) delete discarded offered leases from the correct TAILQ. Avoids infinite loop.
Implemented sftp(1) upload resume support.
Reverted r1.101 of traceroute(8), which broke source port selection.
Added mallocarray(3) function (like calloc(3) but without the cleared-memory guarantee).
Backed out parts of sys/nfs/nfs_serv.c r1.47, which computed wrong block sizes.
Added pkg_add(1) support for reading/writing long paths and linkpaths as extended headers.
Allow iscsid(8) to send data immediately for write commands, for 20% performance boost.
Stopped disklabel(8) leaking mountpoint info. Fixes mysterious crashes.
5.5 RELIABILITY FIX: Disable the ssh(1) curve25519-sha256@libssh.org KEX method when the other party's connection will fail.
Prevent lpd(8) from looking into hosts.equiv(5). Access control is now done only using hosts.lpd.
Introduced basic stats for the iscsid(8) vscsi(4) layer; added iscsictl(8) controls.
In mandoc(1) debug messages, truncate strings of excessive lengths.
dhclient(8) -L now preserves the fd being monitored after new leases, lease renewals and cable unplugs.
Fixed unchecked snprintf(3) in mandoc(1) page header printing.
In mandoc(1), made sure static buffers for snprintf(3) are large enough.
Removed more unused ssl(8) tools and docs.
Moved iscsid(8) session params initialisation to session start, so config parameters stick.
iscsid(8) now does proper LoginOperational negotiation.
Added relayd(8) check for strlcpy(3) overflow when expanding HTTP input value.
snmpd(8) and relayd(8) will now fail if strlcpy(3) overflows the socket path.
When installing OpenBSD, ensure that the hostname information is in the dhclient(8) lease db.
Reimplemented arrays in relayd(8) used to set up process-to-process imsg communication.
Use calloc(3) instead of malloc(3) + memset(3) across ssl(8), to avoid integer overflows.
Rearranged qle(4) update processing loop to attach and detach targets last; handle fabric port login errors better.
Fixed leak in the snmpd(8) and relayd(8) agentx error paths.
Added support for SSHFP DNS records for ED25519 key types to ssh(1).
In ssl(8) ts_rsp_verify.c, reset imprint to NULL to avoid double free.
Added a canonical 6.6+ curve25519 fake version to ssh(1), to be recommended with openssh-6.7.
Use get/put_u32 to load values and unbreak ssh(1) on strict-alignment architectures.
Removed checksum offloading from sk(4), faulty on this hardware.
Added strlcpy(3) check. Stops smtpd(8) fatal at startup if truncation occurred with filters enabled.
Added missing strlcpy(3) check when parsing the "backup hostname" section in smtpd.conf(5).
Removed "disable pmtud" and "increased window size" options from sysctl.conf(5) to discourage their use.
Removed rsh(1). Deprecated in favor of ssh(1).
Fixed display of destination IP when host is an IP address in traceroute(8).
Added checks to strlcpy(3) when smtpd(8) is copying envelope "destination" buffer to the mda delivery buffer.
If user+tag@ exceeds SMTPD_MAXPATHLEN smtpd(8) now fails instead of creating a ".truncated" tag dir.
Removed obsolete altq bandwidth shaping from pf(4).
Allow makewhatis(8) to properly handle symlinks .
Disable the ssh(1) curve25519-sha256@libssh.org KEX method when the other party's connection will fail.
In makewhatis(8) update mode, when opening the database fails, just rebuild it from scratch.
Removed RAND_seed(3) calls in iked(8), ikectl(8), relayd(8) and snmpd(8).
For wscons(4) WSDISPLAY_COMPAT_USL protocol, send the synchronizing signals to the process, not just the thread.
Updated unifdef(1) to version 2.10.
Raised nginx(8) file limits, but lower number of connections (leaving files to spare for other programs).
Removed bdes(1), so as to not encourage its use.
Removed dead KAME code that dealt with IPv4-mapped IPv6 addresses; added check for IPv4-mapped IPv6 destination addresses for non-connected sockets.
Use arc4random_buf(3) instead of harmful RAND_xxx in kerberos(8).
Sync traceroute6(8) to traceroute(8): don't print source IP if "-s" is not given.
In relayd(8), fixed ssl(8) client-only mode when no RSA private key is needed.
Neuter the -legacy_renegotiation option to the openssl(1) "openssl s_{client,server}"; added support for "-starttls lmtp" to openssl s_client.
When parsing a new cert into memory occupied by a previously verified cert, ssl(8) will no longer bypass verification checks.
Introduced privsep for relayd(8) private keys.
Use asprintf(3) for generating path. Eliminates many unsafe uses of strlcpy(3) and strlcat(3) in ssl(8).
If nfs rpc requests on a stream socket are already being processed, don't panic, just return.
Cleanup of relayd(8) code tracking of socketpair between different privsep processes.
Have each thread keeps its own reference to the process's ucreds. Avoids possible use-after-free.
Allow printf(1) to handle passing zero as a fieldwidth or precision variable.
Switched to the new makewhatis(8)/apropos(1)/whatis(1) (described in apropos(1)).
Added support for smtpd(8) mailaddr lookup in the table_db.
Reworked qle(4) command polling loop to handle multiple responses in one interrupt, like qla(4).
Fully kill ssl(8) FIPS API.
Added some UTF-8 utility functions to tmux(1), to stop splitting UTF-8 characters improperly.
Ensure parent thread is blocked until any others are detached before letting it exit. Avoids panic.
Only scroll by one line at a time in tmux(1) choose mode (as lists are generally short).
Fixed dhclient(8) DHCPDISCOVERY and DHCPDECLINE (as INADDR_ANY != INADDR_BROADCAST).
Changed ssl(8) library to use intrinsic memory allocation functions instead of OPENSSL_foo wrappers.
Set tmux(1) PATH explicitly, either from the client or session environment.
Don't limit the tmux(1) DCS buffer to 256 bytes, expand it as needed.
No longer allow ssl(8) to feed RSA private key information to the random subsystem as entropy.
openssl(1) PR#3309: when looking for an extension, properly search all extensions.
Removed the monitor-content option from tmux(1).
Fixed ssl(8) to call the correct decrypt function in aes_cbc_cipher().
Execute the active path checks when mpath(4) asks for it (rather than on attach).
Skip leading zero bytes in ssh(1) buffer_put_bignum2_from_string() function.
Add ufs2 support in libsa/ufs2.c. One step closer being able to boot from ffs2 filesystems.
Cleaned up dangerous strncpy(3) use in ssl(8).
Added missing parens so that rshd(8) errorhost gets properly initialised.
Gave mlinks and keys tables a sqlite3(1) pageid index. Speeds basic apropos(1) searches by 30%.
Make dhclient(8) -q even quieter.
Removed programs from ssl(8) code which don't work with current openssl(1) releases.
Fixed ssl(8) bugs listed at http://www.viva64.com/en/b/0250/.
ssl(8) now ignores setting which allowed the connection to negotiate insecurely.
Zero-pad ssl(8) "usec" format to handle values less than 100,000 correctly.
Killed bogus "send an SSLv3/TLS hello in SSLv2 format" code from the ssl(8) client.
Stubbed some functions in ssl(8) mem_dbg.c, to avoid all possibility of using them.
Always return 1 in the ssl(8) arc4random(9) backend. Unbreaks lynx(1) and git.
Added generic driver for "NEC PC-9801 extension board slot" on luna88k.
Made directory ordering in our libtool stable.
Closed memory leaks in snmpctl(8) client code.
Removed md2, seed and jpake cyphers from ssl(8).
Removed approx 30 unused makefiles and more vestiges of ssl2 support from ssl(8).
In ssh(8) EC_POINT_invert(), check the correct function pointer before attempting to invoke it (openssl(1) RT #2569).
RotIBM stream cipher (ebcdic), FIPS mode support and GOST engine removed from ssl(8).
Replaced ssl(8) PRNG with arc4random_buf(), keeping existing RAND interfaces unchanged.
Added -s (two-byte signed decimal display) to od(1), as mandated by POSIX.
ssl(8) fixes: corrected cases where code occurred directly after goto/break/return; removed pentium specific benchmark code; removed more vms and windows specific code.
Unbroke xcb-util-cursor.
Made smtpd(8) reply with correct imsg when using non-system authentication.
Stopped mandoc(1) crashing when processing macros in .Sh header lines, or having .Sm off or .Bk -words open.
Stopped leaking socketpair file descriptors if tmux(1) fork(2) fails.
Fixed potential race in UFS where an allocated inode could fail to get added.
Removed o_dir.c from openssl(1) now that OPENSSL_DIR_XXX has been removed from the build.
Removed nonstandard and unsafe DES support from ed(1).
Switched pkg_mklocatedb(1) to using common SetList code, renaming -x into -X.
Updated xcb-utils to 0.3.9.
Allow slowcgi(8) QUERY_STRING to be longer than 127 bytes.
Update libxcb to version 1.10.
Made OPENSSL_NO_HEARTBLEED the default and only option in ssl(8) code.
Adapted snmpctl(8), relayd(8) and snmpd(8) to use AgentX protocol to send traps.
Confirm passwords when signify(1) is generating keys.
Fixed SQL_STEP failures for man(7) pages lacking descriptions.
Better makewhatis(8) error reporting in case of SQL errors: mention dir and file.
Major ssl(8) cleanup to remove: MacOS, Netware, OS/2, VMS and Windows build machinery and shared libraries; openssl(1) engines and code that were not properly licensed; vms support; various horrible socket syscall wrappers; insecure use of time as a random seed in the TLS engine.
In qla(4) debug output, print loop ids as decimals and port ids as 24bit hex.
Update to xtrans 1.3.4.
Updated to xextproto 7.3.0.
Added presentproto 1.0.
Bring back r1.16 of protector.c in gcc(1) version 2.95. Fixes code generation of usr.sbin/dhcpd/memory.c!new_address_range() on vax.
5.3, 5.4, 5.5 and -current SECURITY FIX: Fixed openssl(1) read buffer to stop an attacker injecting data from one connection into another.
A source code patch is available for 5.3, 5.4 and 5.5.
Made sure cu(1) -l overrides HOST.
Avoid sshd(8) crash at exit, by checking that pmonitor!=NULL before dereferencing (bz#2225).
Fixed more(1) to use basic regular expressions (unlike less(1)).
Clamp offsets to the available memory space. Fixes tmux(1) crash.
Further apropos(1) speed optimisation, with mmap(3) MAP_ANON SQLITE_CONFIG_PAGECACHE.
Updated to libdrm 2.4.53
Disabled Segglemann's RFC520 heartbeat from ssl(8).
Don't release the ssl(8) read buffer if we're not done reading from it; disabled buf freelists.
Added validation routines to iked(8): overall header structure is checked for sanity before copying the header; avoid overflow by passing down the number of remaining bytes.
Notify userland when an arp(4) entry is removed.
Fixed fd leaks in mg(1) error paths.
Retired rtinit() and switched to using rt_ifa_add(9) and rt_ifa_del(9) to manage connected routes to prefixes/hosts.
Revived fix for perl(1) RT bug 116441 (null dereference affecting mod_perl).
Split manual names out of the common "keys" table into their own "names" table. Reduces standard apropos(1) search times 70% for the full /usr/share/man database.
Moved descriptions from mandoc.db(5) keys table to mpages table: reduces typical apropos(1) search times by about 40%; reduces database size.
In less(1) "more" mode, made command specified by -p option apply to every edited file, as per POSIX.
Reverted r1.93 of mg(1) file.c, which broke permission checks.
5.5 SECURITY FIX: Make ftp(1) client check the server hostname, to avoid false validation when connecting to an https website.
A source code patch is available for 5.5.
Updated to xf86-video-ati 7.3.0.
Made smtpd(8) display correct imsg when profiling is on and if the type was changed.
Zapped the smtpd(8) mfa process. Content filtering will be done at session level.
Removed CA certificates from ssl(8) which are not listed in Mozilla's certdata.txt.
Use root CAs in ssl(8) used by TeleSec (Deutsche Telekom AG): Baltimore CyberTrust Root, Deutsche Telekom Root CA, T-TeleSec GlobalRoot Class 2 and T-TeleSec GlobalRoot Class 3.
If TLS validation is on, make ftp(1) fetch TLS certificate and check the server hostname against the subjectAltName and/or CommonName.
Build libgcc without SSP. Unbreaks landisk bootblocks.
Updated to xorg-macros 1.19.0.
Ensure that we free buffers written out by the page daemon rather than caching them.
Fixed error in bcrypt_pbkdf(3) stride calculations.
Added error detection mechanism to detect when sudo(8) configuration is incorrect for building ports.
Zero-fill smtpd(8) mta static buffer before use in DSN code.
Added term_flushln() flag to control indentation of continuation lines in TERMP_NOBREAK mode. Reduces groff-mandoc differences in base by more than 15%.
Added rgephy(4) for axe(4) and axen(4) on hppa and zaurus.
Fully implemented roff(7) \B (validate numerical expression) and partially implemented \w (measure text width) escape sequence.
5.3, 5.4, 5.5 and -current SECURITY FIX: Fixed openssl(1) CVE-2014-0160 "heartbleed" vulnerability.
A source code patch is available for 5.3, 5.4 and 5.5.
Added MSI support for xhci(4).
Enable upd(4) on archs where uhidev(4) is present.
Do not attach when no upd(4) sensors can be allocated; made device querying smarter.
Added roff(7) support for indirect references to user-defined strings.
Made iscsid(8) listen to the control socket, so the connect() call from iscsictl(8) will not fail.
In udp_output(), use the correct source address in case of an unbound socket.
Accept arbitrary argument delimiters for various roff(7) escape sequences.
Increased MSGBUFSIZE on macppc.
Exit on error or HUP when poll()ing the keyboard. Otherwise, top(1) may spin when its tty goes away.
Added implementation of roff(7) numerical expressions.
Retired kernel support for SO_DONTROUTE, this time without breaking localhost connections.
Updated termtypes.master to upstream terminfo-20140329.src.
When qla(4) is iterating through fabric ports, start at our own port ID, to simplify tracking.
Added axen(4) wherever axe(4) is found.
qla(4) ISP2322 chips need a different firmware image to other 2300s, don't load firmware for them.
Removed (expensive) temporary connect in udp_output(). Also fixes possible memory leak.
Added missing addressing modes for the fucomip instruction on i386. Unbreaks webkit port.
Fixed smtpd(8) when writing multi-line "To" and "Cc" headers.
Implemented the roff(7) .rr (remove register) request.
Fixed uvm(9) logic error (and prevented theoretical infinite loop) in uvm_pmr_rootupdate().
mandoc(1) bugfix: make sure all variables are properly initialised when rendering .ll (line length) requests.
Added the -t ktrace(1) option to ltrace(1). Allows triggering library function call trace and other kernel events trace simultaneously.
Fixed smtpd(8) header parsing issue in enqueuer, which was stripping the "From:" header in some cases.
Made makewhatis(8) warn about missing mlinks when the -p (picky) option is given, and not overridden by: -Q, -d, -u, or -t.
Merged the mda, mta and smtp smtpd(8) processes into a single unprivileged process.
Start the smtpd(8) purge task after events are set, so we don't miss a SIGCHLD.
Reworked qla(4) command polling loop so it can handle multiple responses in a single interrupt. Allows talking to Hitachi disk arrays.
Fixed pppx kernel panic when using npppd(8) with multiple pppx devices.
When the -n or -t flag is given to makewhatis(8), write names and descriptions to stdout (format similar to apropos(1)).
Instead of silently doing nothing, made makewhatis(8) warn and return non-zero when the manpath is empty.
Added a uvm_yield function to uvm(9) and use it to prevent the reaper from hogging the cpu.
Reworked wait/kernel lock heuristics to give interrupts on other CPUs to a chance to run, for reduced latency.
When mg(1) discovers a directory is non-existent, offer a "y" option to make the directory.
Renamed the makewhatis(8) -W option to -p. Matches flag introduced in OpenBSD 2.7.
Proper validation and computation of bsize now occurs in the disklabel(8) expert mode.
Renamed -v option of mandocdb(8) to -D, to avoid a clash with the -v option of makewhatis(8).
Reduced the tmux(4) mouse wheel scroll size to 3; allow shift to reduce it to 1; allow meta and ctrl to multiply by 3; support wheel in "choose" mode.
Fixed npppctl(8) calculation of response message size.
Added the "#" character as a comment character in the mg(1) startup file.
Support UTF-8 with tmux(4) choose-buffer; made buffer_sample bigger to let it trim at window right edge.
Enabled hds(4) on hppa.
Enabled mpath(4) on macppc.
When using VerifyHostKeyDNS with a DNSSEC resolver, down-convert any certificate keys to plain keys and attempt SSHFP resolution. Prevents server from forcing a new-hostkey dialog.
Include fingerprint of key not found by ssh-keysign(8); use arc4random_buf() instead of loop+arc4random().
In four byte UTF-8 sequences, make sure tmux(1) only uses three bits of the first byte.
Stopped tmux(1) crashing when a zero-length argument is passed to setb.
Made tmux(1) message-limit a server option.
Stopped tmux(1) segfaulting when the parent of the layout cell is NULL.
Added setb -a to tmux(1) append; added a copy mode append command.
Made session_attached a count; added session_many_attached flag to tmux(1).
Added start-of-list, end-of-list, top-line and bottom-line in tmux(1) choice mode.
Stopped tmux(1) writing into the buffer if there are no arguments.
Changed secondary device attributes response to "\033[>84;0;0c" which is unique for tmux(1).
Made bus_dmamap_load(9) and bus_dmamap_unload(9) mpsafe on alpha.
Restored behaviour of ls(1) -f implying -a (lost in commit made in 1989). Conforms to IEEE 1003.1-2008 ("POSIX.1").
On loongson, mips and octeon, stopped whole L1 cache being flushed unnecessarily.
Again allow more than one level of directories to be created via mg(1) make-directory.
Force detach of all usb(4) devices by disconnecting root hubs before suspending machine. Avoids races.
libtool(1) now properly add -rpath to the linker when linking libraries. Matches GNU libtool.
Increased Xtranssock.c send buffer for UNIX sockets. Makes Firefox usable again when viewing large images.
If HOST or the host argument starts with a "/", cu(1) will now treat it as a device name.
Fixed REMOTE on cu(1) to work like tip(1); added support for HOST.
Added SNI support to ftp(1).
Allow roff(7) to support relative arguments to .ll (increase or decrease line length).
Repaired boot.net operation on (at least) sparc SS5 PROM v2.21
Implement the roff(7) .ll (line length) request.
5.5 RELIABILITY FIX: Memory corruption occurring during icmp(4) reflection handling (ICMP reflection is disabled by default).
A source code patch is available for 5.5.
Recognise so-called "EFI-like" interface provided by newer PMON firmware on Loongson 2Gq and Loongson 3A.
Bugfix and security update to nginx(8) version 1.4.7 (note: CVE-2014-0133 does not affect OpenBSD).
Speed-up overlapping copy operations in gio(4/sgi) by attempting to perform them in larger chunks whenever possible.
Removed pflowproto 9 (unfixable post-2038). Better option is pflowproto 10.
Allow leading and trailing vertical lines in tbl(7), format them in the same way as groff; do not require whitespace before vertical lines in layout specifications.
Properly initialise malloc(3)ed memory in mandoc(1), to fix crashes when using apropos(1).
Made sure the command TRB is reset if a command is submitted when the usb(4) hardware is already gone.
Reverted "retire kernel support for SO_DONTROUTE" diff, which caused problems in localhost connections.
On loongson, made sure the HIBERNATE pages get reserved regardless of the memory layout.
Program the colormap correctly on grtwo(4/sgi); added a simple screen burner accessop.
When enforcing TOS (Traffic Class), made pf(4) preserve the ECN bits (as with IPv4 packets).
Adjusted (commented-out) nginx.conf(5) sample blocks for PHP and SSL configurations.
Made mg(1) C-t (transpose two chars) behave like emacs.
Ended experimental machine-independent login.conf(5) template support.
Made cu(1) handle REMOTE in the environment as either a separate remote(5) file or a host.
Added cu(1) support for retrieving the line and speed from the /etc/remote "dv" and "br" capabilities like tip(1).
Fixed handling of the kill(1) "-1" option from a thread other than the original thread.
Permit generating of NAMI and CSW records inside ktrace(2).
Ignore the -b option if cksum(1) is called as-is (e.g. "cksum -b /bsd"), to match man page.
Removed file2c(1). hexdump(1) works as well for most use cases.
usb(4) root hubs can now happily be detached and reattached.
When smtpd(8) is locally enqueuing messages without specifying a domain, update headers to show the local domain.
Strengthened ssh(1): removed weaker pre-SHA2 hashes, broken cipher (arcfour), and the broken mode (CBC) from the default configuration.
skey(1) bugfixes: default algorithm switched back to md5; do not let skey_set_algorithm() cause a segfault if an unsupported algorithm is specified.
Added acpithinkpad(4) support for aux button strip on newer thinkpads missing regular F1-F12 keys.
dd(1) now supports g for gigabytes.
Reworked the way sysmerge(8) fetches and verifies sets, to simplify the process.
Merged perl(1) version 5.18.2 (including local patches).
Stopped calling smtpd(8) purge_task every 10 secs (only needed once at startup).
Removed "-r" option from ping(8), traceroute6(8) and traceroute(8).
Enabled SQLITE_ENABLE_FTS3_PARENTHESIS in sqlite3(1).
Removed the MD4 functions (highly susceptible to collision attacks).
Skip leading escape sequences in mandoc(1) man_deroff(), for better indexing.
Gave powerpc PIE.
Initialise additional BATs (IBAT4-IBAT7 and DBAT4-IBAT7) on socppc. Stops memory corruption on devices with rb600.
Fix uhidev_detach() when detaching a device which did not claim all reported IDs.
Reverted audio key handling.
Make sure sysmerge(8) adds missing users/groups before running the target; otherwise mtree(8) can fail.
Let mg(1) users input a tag to find, even if no default tag is defined.
Disabled smtpd(8) imsg buffers profiling code, to stop processes waking up each second.
npppd(8) tunnels can now have multiple listen addresses.
Reimplemented control part of npppd(8) with imsg; added "monitor" command for npppctl(8) to monitor PPP session start/stop events.
Fixed npppd(8) bug which caused segfaults when npppd.conf(5) had "username-suffix" and "strip-atmark-realm" as yes.
Made npppd(8) keep listening on 1723/tcp when accept() is failed.
Removed tape as a method for fetching install sets.
Attempt to workaround the R4000 end-of-page errata on sgi and mips64, triggered by TLB misses when the code flow crosses a page boundary.
Disabled MS-CHAPv1 (RFC 2433) support in pppd(8).
Fixed sysmerge(8) regression when not using a full path to sets; make it use ftp(1) -D.
Installed /var/unbound/db directory for DNSSEC root key; added (commented-out) options for DNSSEC to unbound.conf(5).
Removed insecure MD4 checksum algorithm from cksum(1).
Removed ftp method for obtaining installation sets when running the installer.
Enabled upd(4) on amd64, sparc64 and macppc archs for testing.
Sync timestamp changes for inodes of special files to disk as late as possible to avoid useless disk i/o.
Include support in pstat(8) -v to display the IN_LAZYMOD flag.
On sgi machines, fixed clipping bounds in "fill" and "blt" graphics operations; added colormap support.
Removed timeout logic from the polling loop in qlw(4). Stops devices timing out before attaching.
Retired the rarely used hp300, mvme68k and mvme88k ports.
Allow makewhatis(8) to check mandoc.db(5) databases are up to date even when you don't have write permissions.
Notify userland (via the routing socket) when ARP resolution completes.
Put the AF_ROUTE socket that arp(8) operates on into the appropriate rdomain. Stops "arp -V 1 -d 10.0.0.1" hanging forever.
Made bgpctl(8) correctly parse attribute length form imsg.
Exit from traceroute6(8) if there is at least one unreachable and sum of unreachables and timeouts are >= number of probes.
Unbroke sndiod(8) monitoring mode, which was shifted in time by 1 block.
Userland ppp(9) removed.
In apropos(1) output, sort names and avoid multiple section numbers.
In slowcgi(8), use SCRIPT_FILENAME (can be an absolute filesystem path). Fallback to SCRIPT_NAME if this is not present.
Reimplemented htpasswd(1) from scratch.
Don't use volume keys when in raw-mode. Stops simultaneous volume changes by X(7) and ukbd(4).
Enable qlw(4) at sbus(4) on sparc64.
Enabled unbound(8) in base.
Updated to xcb-proto version 1.10.
Updated to libdrm 2.4.52.
Removed the unused userland agp(4) interface.
Reverted to the freetype2.pc we had before to bring back local changes.
More informative smtpd(8) log message on unknown SNI.
Provide an MI api for byteswapping loads and stores, especially beneficial for sparc64 and powerpc.
Updated to freetype-2.5.3. Fixes vulnerability in the CFF driver (CVE-2014-2240).
Enabled qla(4) and qle(4) in ramdisks (except on sgi).
smtpd(8) now prints the correct user name if SMTPD_QUEUE_USER is missing.
Use ticket locks (not spinlocks) on i386/amd64/sparc64. Provides fairer access to the kernel lock.
Added a few more instruction patterns to binutils that are needed by gcc(1) version 4.8.
In mandoc(1) -Tutf8 mode, count hyphens against the output line length even when they are breakable.
Stopped the smtpd(8) enqueue utility adding a User-Agent header to emails.
Block userland from entering drm(4) code during suspend/resume. Fixes inteldrm(4) bugs.
Unhooked httpd(8) from build: use of nginx(8) is encouraged now.
No more spray(8) in base.
Fixed buffer overflows in icmp(4) redirect handling (introduced in rev 1.106).
Switched over from sendmail(8) to smtpd(8) by default.
Fixed iked(8) config-address w/o pool.
Unbroke nc(1) "-6 -l" and apply correct fix for previous commit.
Removed rmail(8).
Made ssh(1) scan for ed25519 keys by default.
For isakmpd(8) CA generation, set the correct certificate extensions so more SSL implementations will trust this as a CA cert. Matches ssl(8).
Bugfix update to nginx(8) version 1.4.6.
When pf(4) is translating packets from one address family to another, pass the TOS/Traffic Class field of the original packet.
When pf(4) is setting packet description, also retrieve the Traffic Class field of IPv6 packets.
Fixed the cnmac(4/octeon) mediastatus when the interface is not configured.
Optimisation of opendir(3), rewinddir(3) and related functions. 2000x speedup of seekdir(3) in some tests.
Fixed acpi(4) on amd64, to avoid reboot and stack corruption problems when resuming.
Reworked per-cpu cache information, to avoid using hardcoding data based on processor type on mips, octeon, and sgi.
In re(4), fixed operation and made reception of packets work on the 8168G controllers.
Made mandoc(1) user-defined macros wrapping ".TP" work correctly; preserve line breaks contained in user-defined macros called in ".nf" mode.
Enable DMA bursting and tagged queueing in qlw(4); enable qlw(4) on alpha/amd64/i386/macppc/sgi/sparc64; only attempt to load firmware if we actually have some.
Initial xhci(4) implementation: USB 3.0 umass(4) devices get reasonable read/write speed.
Improved roff(7)'s .if/.ie condition handling.
Fixed env(1) diagnostic messages to stderr, so failure of env(1) and failure of the specified utility can be distinguished.
Allow signify(1) to read input messages on a pipe.
Added usbd_get_hub_descriptor(), to clean up uhub(4) and deal with hub device descriptors in high speed devices.
With md5(1) -C, exit with exit status of 1 if any of the files specified do not exist.
mandoc(1) bugfixes related to the closing of conditional blocks: handle more than one '\}' on macro lines; do not treat '\}' as a macro invocation after a dot at the beginning of a line; do not complain about characters following '\}'.
Makes the "cleartoggle" function in HC drivers optional (upcoming xhci(4) driver doesn't use it).
Allow signify(1) to accept a password on stdin, as long as it is not a tty(4).
On qlw(4), set the correct clock rate for ISP1020/1020A.
When running sysmerge(8), always print the key signify(1) is using.
Fix the return values of getpwnam_r(3), getpwuid_r(3), getgrnam_r(3), and getgrgid_r(3) to agree with POSIX.
Altered qlw(4) so it can compile on sparc64 too.
In -Tutf8 mode, make mandoc_char(7) named accent character escape sequences render as non-combining accents (lets mandoc behave like groff); made \' and \` equivalent to \(aa and \(ga, respectively.
Introduced qlw(4), a new driver for QLogic ISP SCSI HBAs (currently only supports the pci(4) variants).
Raised the delay before initialising sdmmc(4). Lets the reader on X220 work reliably.
Fixed: sndiod(8) read/write position tracking; incorrect delta propagated after xruns in play-only and rec-only modes; crashes seen after a few days of continuous playback.
Fixed incorrect position reporting with sndiod(8) when using tiny block sizes on busy machines.
Made sndiod(8) check that the socket is writable before attempting to write data packets.
On armv7, removed TIMEZONE and DST options from GENERIC-* kernels; added option USBVERBOSE to all kernels.
--------
Changes made between OpenBSD 5.4 and 5.5
Made ssh(1) ignore environmental variables with embedded '=' or '\0' characters.
Added -C checksum mode to signify(1), to make using sha256 files safer and easier.
If a smtpd(8) peer advertises DSN and we don't want to use it, don't send trailing spaces (not all MTAs can cope).
fdisk(8) -l option added, to force LBA mode.
Fixed miniroot so it can get sets from a msdos partition.
Allow pfctl(8) to use a "*" wildcard on the command line for anchors that were not initially specified with a "*".
Stopped smtpd(8) missing F_BACKUP when dumping envelope (could break backup MX).
Fixes backported from openssl-1.0.1f (CVE-2013-4353, CVE-2013-6449 and CVE-2013-6450).
Made it possible to run X(7) with machdep.allowaperture=0 on hardware supported by radeondrm(4) on macppc too.
Use a larger read buffer, to speed up ftp(1).
Made ssh(1) cache OIDs of supported GSSAPI mechanisms before privsep sandboxing (bz#2107).
Stopped ssh(1) assuming that a socks4 username is \0 terminated.
Avoid early hostname lookups by ssh(1) unless canonicalisation is enabled (bz#2205).
Fix armv7 install script to allow it to work on both sd(4) and eMMC.
Support for ed25519 keys added to xdm(1) and xinit(1).
Made azalia(4) wait until the RIRB DMA engine is ready, so audio device integrated in the Vortex86EX SoC will work.
Abort/close all interrupt pipes when detaching HID devices (drivers attaching to uhidev(4) do not always do this).
radeon(4) workaround for broken BIOS that don't assign an address to the ROM BAR.
Revert r1.348 in sys/dev/pci/if_bge.c, to disable IPv6 TCP checksum offload for now.
Bring back ehci(4) code suspending root hub's ports before reseting the controller (saves power when suspended).
Fixed off by one leading to invalid host stats tree in smtpd(8).
Added "-p <path>" switch to fw_update(1), to specifying the location of firmware packages.
Allow ssh_config(5) to cope with configurations that always refer to canonical hostnames.
Made fw_update(1) print out the path to the firmware packages when in verbose mode.
Give drm(4) a console locator, to make sure /dev/drm0 always matches the primary display.
On mips64, increased _STACKALIGNBYTES, so long doubles on the stack are correctly aligned.
Fixed crash in tmux(1) caused by uninitialised lastwp member of layout_cell.
Basic i210/i211 support added to em(4).
tmux(1) fixed for "-fg/-bg/-style" with 256 colour terminals.
rc(8) now ignores blank characters at the end of ${pkg_scripts}, and will not execute /etc/rc.d/ in that case.
/etc/random.seed support added to alpha, mvme88k and vax.
Improved installer logic to find a filesystem to store the prefetched sets.
Made pax(1) map negative mtimes to zero instead of skipping the affected files.
Many fixes to drm(4) for i915.
Check to see if an i386/amd64 CPU supports tsc, avoid illegal instruction trap when it does not.
Stopped dhclient(8) creating default dhcp-client-identifier if an empty string has been configured as the value.
Fixed tmux(1) memory leaks with paste_replace.
Made it possible to build an i386 kernel with binutils-2.17 again.
Allow mouse down and mouse wheel for any pane with tmux(1) mouse-select-pane (not just in copy mode).
Fixed "p->p_wchan == NULL" panics seen with usb ethernet adapters.
Call control_init() before daemon() so that iscsid(8) and iscsictl(8) reloads work.
Stopped tmux(1) crashing when given an invalid colour.
Added iked(8) "config address" syntax, to list a range of addresses to use in a specified flow.
Basic iked(8) OCSP support. enable with 'set ocsp "http://10.0.0.10:8888/"'.
New smtpctl(8) "show status" command, to show if mta/mda/smtp are currently running or paused.
Stopped smtpd(8) looking up pki based on hostname if one was specified for the listener.
Fixed bcrypt(3) to avoid wraparound at 256 characters ("b" revision designation denotes fixed version).
Added initial em(4) support for i354 MAC and M88E1543 PHY.
Unbroke ld.so(1) with ssp-strong/all on sparc64 and powerpc.
Avoid spurious "getsockname failed: Bad file descriptor" errors in ssh(1) -W (bz#2200).
Preliminary nep(4) driver for the Sun Neptune 10/100/1000/10G Ethernet chip.
In radeon(4) drm code, fixed surface sync in fence on cayman (v2).
Allow X(7) to run with machdep.allowaperture=0 on inteldrm(4) and radeondrm(4).
Implemented the roff(7) ".as" request (append to user-defined string).
Let roff(7) handle some read-only number registers (e.g. .H and .V).
Re-added audio devices to the zaurus.
Updated to xterm(1) version 301.
Updated to xf86-video-intel 2.99.910 (aka 3.0RC10).
When terminfo(5) has colors#256, tmux(1) will now use setaf and setab for the 256 colour set.
Made C-j the same as C-m with tmux(1) mode keys.
In qle(4), added firmware for isp25xx; added isp25xx support.
Removed isp24xx-related code. Broken, and superceded by qle(4).
Fixed strptime(3) logic bug, as tm_yday can only be inferred if both tm_mday and tm_mon are set.
On i386/amd64, allow "disabling" of pagefaults, needed for some inteldrm(4) "fast" path code.
Fixed drm(4) bug which only copied out 32 bits of a 64-bit value.
Octeon now partially supports the D-Link DSR-500.
When sending neighbour advertisements, use the carp(4) mac address as target lladdr.
Allow larger totals to be displayed by iostat(8).
Show in dmesg(8) when an attached sd(4) is readonly, makes it clearer why write operations fail.
Introduced the qle(4) driver for QLogic ISP24xx fibre channel HBAs.
Made iked(8) set the msg_responded flag on the original message.
New dd(1) operands "status=noxfer" and "status=none", to suppress status lines printed to stderr.
Support for Intel Centrino Wireless-N 2200/105/135 added to iwn(4).
Stopped systat(1)'s pftop leaking memory at every queue refresh.
Build isp2xxx firmware into separate object files, to only include one when both isp(4) and qla(4) are enabled.
On sgi, block all interrupts that can grab the kernel lock.
Intel Centrino Wireless-N 2230 support added to iwn(4).
Fixed tmux(1) xterm-keys change where some keys (e.g. \033OA) were wrongly treated as partial matches.
Run the serving and privileged ntpd(8) processes at high priority, to lower latency.
Fixed MAC address format to let ospf work on myx(4) even without PROMISC enabled on a network interface.
Fixed drm(4) ttm: to handle in-memory region copies; ttm_bo_move_memcpy; memory type compatibility checks.
arc4random_uniform(3) returns a value strictly less than its argument; fixed arithmetic so that PID_MAX can be reached when the kernel is forking.
Many drm(4) on radeon(4) fixes, including: dac handling improvements; endian bugs; LCD record parsing; handling of variable sized arrays for router objects; panel scaling with eDP and LVDS bridges.
Added support in binutils for i386 XSAVE family of instructions: xgetbv, xsetbv, xsave, xrstor, and xsaveopt.
Fixed pmap(9) on vax when processes are using more than 512KB of stack.
Fixed failure of dhclient(8) to write resolv.conf(5) when -L is used; made add_address() and add_route() also wait until imsg is in pipe.
Stopped pkg_add(1) taking crypto sigs into account for "always-update" comparisons (the sig will always differ).
Stopped malformed IMSG_HUP messages causing the privileged dhclient(8) process to exit.
Fixed memory leak introduced in r1.96 of sys/dev/usb/usb_subr.c.
Fixed system hang issue when using radeon(4) KMS with older cards; fixed drm(4) card_posted check for newer asics; fixed endian issues with DP (v3) handling.
Rectified lock order reversal problem to stop panics seen in multi-threaded programs when using gdb(1).
When running sysmerge(8), only create DBDIR if it does not exist.
Made bus_dmamap_load(9) and bus_dmamap_unload(9) "mpsafe" on hppa.
Create dhclient(8) lease files and dhcpd(8) lease files with permissions 0640, rather than 0000 and 0664 respectively.
Be less verbose for pkg_delete(1) -X.
Stop disabling/enabling interrupts in the interrupt handler for "chip type D" (Marvell 9580).
Copy the correct number of channels in sndiod(8) join/expand.
Use the proper integer width when sndiod(8) calls AMSG_ISSET().
Macppc G5 systems with >2GB RAM now report correct amount of memory (kernel still only uses the lower 2GB).
Changed pkg_add(1) default to requiring signed packages.
Limit the number of currently opened pkg_add(1) packages, to limit memory usage.
Fixed booting of socppc n1200 with a usb disk plugged in.
Allow 64-bit page table entries on mips64 and sgi, making physical memory beyond 16GB addressable by pmap(9).
Stopped attempting to initialise the time from an uninitialised variable on socppc.
In the installer, make sure a free bpf(4) exists before dhclient(8) is run.
Fixed remote printing by lpd(8) which was broken in r1.50 of printjob.c.
Made carp(4) send IPv6 neighbour advertisements with the "router" flag when acting as router. Stops clients losing default routes during carp(4) failover.
Updated to sendmail(1) version 8.14.8.
Made dhclient(8) create "-L" leases files with the same 0000 permissions as regular leases.IF files.
Log when dhclient(8) fails to fchmod(2) or fchown(2) the file written in priv_write_file().
Fixed inet6_opt_init(3) to only check extlen when extbuff is not NULL (as per RFC 3542).
Fixed regression in ssh(1) for UsePrivilegedPort=yes.
Only set the cwm(1) urgency flag if the client is not active.
Fixed a MP race in the alpha's fpu context saving code.
Stopped tcpdump(8) segfaulting on IPv6 NFS traffic.
Made pax(1) cope with a stripped down format list (e.g. when compiled with -DNOCPIO).
Fixed spurious SIGSEGVs in inteldrm(4) with xf86-video-intel version 2.99.909.
Fixed myx(4) race, which prevented the driver from transmitting packets.
Always reset the signature when fdisk(8) is writing an MBR to disk, to ensure MBR is readable by disklabel(8).
kvm(3) crash dump parsing fixes: correct paddr in process info and pids in file info.
Made syslogd(8) ignore ENETUNREACH, so remote logging is not stuck after a "network unreachable" error.
Added smtpd(8) support for DSN and Enhanced Status Code.
Allow the smtpd(8) admin to pause relaying to a specific domain.
Socketmap table backend added to smtpd(8).
In smtpd(8), extend the allowed charset for email address; escape potentially dangerous ones.
Fixed smtpd(8) dump function which occurred with some flag combinations.
Reverted broken part of sys/dev/pci/if_bge.c r1.329 (link state handling for the BCM5700 B2).
Delayed lowercasing of hostname until right before hostname canonicalisation, to unbreak case-sensitive matching of ssh_config(5).
Fixed dpb issue with E=x11/qt3.
Fix ssh(1) memory leak in ECDSA_SIG_new().
Stopped ucom(4) trying to cleanup if it is being detached when returning from tsleep(9). Fixes a panic.
Fixed a null dereference introduced when uftdi(4) was converted to use usbd_is_dying().
On alpha, make sure sched_init_cpu() on the secondary processors is invoked with the kernel lock held.
Stopped pkg_add(1) mixing up the list of manpages to be deleted with those to be added.
Store a compact form of manpages when running pkg_add(1).
Updated to xf86-video-intel 2.99.909.
Properly clean up after sysmerge(8) is run.
Build bsd.mp on the alpha platform.
Allow use of "*************" as password in the installer response file for accounts with password logins disabled but login (e.g. with ssh-keys) still possible.
Simplified how "kept" packages are handled by pkg_add(1).
Rearrange interrupt register processing for 2200s. Makes onboard FC controllers in Sun systems work better.
Converted memset(3) of potentially-private ssh(1) and sshd(8) data to explicit_bzero().
Improved cut(1) POSIX compliance: continue to process the remaining file operands even after not finding an input file.
On alpha, manage a per-cpu pmap(9) free entries queue, in addition to the in-use queue to avoid corrupting memory; simplified try_lock(), to avoid one forward branch in the common case.
Take bwidth into account for the cwm(1) menu's position and size.
Fixed pkg_add(1) kept packages bug (they have to be completed somewhere).
When pkg_add(1) is stopped by ^C^C, try to exit only when the database is in a safe state.
drm(4) i915 now invalidates TLBs for the rings after a reset.
On amd64, removed some of the excessive cache and TLB flushing going on during hibernate unpack.
Allow the cwm(1) config parser continue parsing even after encountering an error.
Replaced most usages of bzero(3) with explicit_bzero in ssh(1) and lib/libutil/bcrypt_pbkdf.c and pkcs5_pbkdf2.c.
Fixed partial matches in tmux(4) with xterm-keys on.
Add \033[18t window operations to tmux(1).
Set IFCAP_VLAN_MTU on tl(4) to allow for VLAN sized frames.
If a scsi(4) device doesn't have device ids or serial numbers, try using node_wwn to generate a devid.
Fixed VCPU reset sequence bug on bge(4) BCM5906.
Simplified adjtime(2) by keeping track of the adjustment in a 64-bit integer. Stops ntpd(8) losing sync.
Stopped umodem(4) matching control interfaces if data interface is missing or already claimed. Fixes Ericsson F3507g.
Made sure partial installs of a package are handled properly by pkg_add(1).
Added an MI api for atomic ops (e.g atomic_add_int(9)) in the kernel.
Added a -d flag to fw_update(1), to remove the specified firmware packages.
Added fuse(4) support for IO_APPEND.
Check command name/path for truncation and provide user feedback during cwm(1) config parse .
Fixed ftp(1) progress meter, broken after the introduction of the '-D' flag
Allow replacing separate foo-{fg,bg,attr} tmux(1) options with a single foo-style option (e.g. "set -g status-style fg=yellow,bg=red,blink").
Remember the last active tmux(1) pane in the top-bottom or left-right cell so that it can be restored when using selectp -L/-R/etc.
Enable IPv6 TCP checksum offload for bge(4).
Check cwm(1) "ignore windowname" for truncation and provide user feedback during config parse.
Error out on an unacceptable worm(6) length argument; start with the cursor on the worm's head.
nginx.conf default changed to stop sending nginx(8) version number in error pages and "Server" header.
cwm(1) now follows the EWMH spec: if the cardinal returned is 0xFFFFFFFF (-1) then the window should appear on all desktops.
Added CoreChip RD9700 support to udav(4).
Dropped FETCH_CMD from sysmerge(8), now always use ftp(1).
Fixes/workarounds for bge(4) BCM5719/BCM5720/BCM57765/BCM57766 chipsets; added support for the new BCM5762 ASIC (BCM5725/BCM5727/BCM57767); added all of the newer PCI ids.
Replaced ssl(3) HMAC and MD5 with implementations based on native sshd(8) ssh_digest_*.
Removed the no-op flags -L and -V from compress(1); removed -g flag from gzip(1) (non-standard, only makes sense in compress(1)).
Enhance sysmerge(8) errors output and display what is going on.
Enabled IPv6 checksum offload in jmw(4).
Attempt to make user changes of keyboard layout configs more "sticky" on wsmux(4).
Work in progress code added for SMP on the alpha architecture.
Installer fixes to: extend logic for finding a location to place prefetched sets; complain loudly on errors and give users a chance to react; improve detection of ftp(1) fails while fetching sets; be more cautious while removing temporary directories.
tcpdump(8) now correctly shows that checksums of zero are invalid when listening to UDP over IPv6 traffic.
Stopped ufs_setattr() assuming atime/mtime/ctime flag bits needing to be updated weren't already set.
Stopped pkg_add(1) allowing file permissions to be adjusted without an explicit @mode annotation.
Changed the default pf.conf(5) block policy to "block return".
Reverted counter size changes in netinet, as it broke netstat(1).
Added a special case to ssh(1) for the DH group size for 3des-cbc, which has an effective strength much lower than the key size.
Corrected parsing of dhclient.conf(5) statements "fixed-address" and "next-server".
Ditched kernel high and low water marks for vfs(9) pages and replaced with a single target, to minimise use of biglock.
Disable lapic when halting CPUs on i386, for improved suspend.
Implemented the traceroute6(8) "-c", "-D" and "-S" flags (from traceroute(8)).
Improved formatting of broken blocks in mandoc(1) -Tman.
When a disklabel(5) is read from a MBR partitioned disk, preserve any changes the user makes with disklabel(8) "-b".
Made iked(8) re-lookup the policy as soon as we have the ID of the peer (destid).
Enabled format-string checks for log_*() in iked(8).
Made sure iked(8) sa_lookup() can actually find the SAs.
Stopped iked(8) leaking prv RSA key for each signature.
Avoid wdc(4) panics where free_xfer is called after scsi_done calls xfer_put.
In bgpd(8), corrected the matching for filter rules of "prefixlen = XX".
Fixed VRAM size calculation for VRAM >= 4GB, and many other fixes for radeon(4).
Fixed a use-after-free when GPU acceleration disabled; many more drm(4) fixes.
Killed (inaccurate) hardware checksummed packet counters and use software counters instead; switched netstat(1) to use them.
Allow the special bgpd(8) case of making a route valid before setting the blackhole flag on it.
Support multi-stream archives in pkg_sign(1), storing packing-list as a separate stream for efficiency.
Made cwm(1) supply a more useful title for windows launched via the ssh(1) command menu ("[ssh] <hostname>").
Switched radeon(4) drm to MSI on the cards that support it.
Added -D shorttitle support to ftp(1).
Added initial softraid(4) support for rebuilding a RAID5 volume.
Fixed resume on some radeon(4) rs4xx(v2) boards.
Support paste key in tmux(1) copy mode input (for search etc); clamp length to screen width.
Properly release X(7) resources during cwm(1) teardown.
Streamlined cwm(1) event loop/restart/quit handling.
Implemented the "\:" (optional line break) escape sequence in mandoc(1).
Do not permit periods in tmux(1) session names.
Only exit tmux(1) copy mode at the bottom if no selection is in progress.
bus_dmamap_load(9) and bus_dmamap_unload(9) made mpsafe on sparc64.
sysmerge(8) cleans up work directory better; improved handling and comparisons of symlinks; simplified signature handling.
Removed genmask support from route(8).
Fixed problems installing from atapiscsi(4) cdrom devices.
Added CoreChip RD9700 support to udav(4).
Fixed a bug where stale bgpd(8) routes were not properly flushed on sessions announcing the graceful restart capability.
Made sure the disklabel(5) is written to the correct spot on devices with non-512-byte sectors.
Improved isakmpd(8) randomisation.
Introduced fine grained locking to myx(4) (only from the interrupt side).
Fixed a double free caused by a relayd.conf(5) config with two "listen on" statements in a relay.
Allow pflow(4) to determine the src IP address based on the route table if flowsrc is not set.
Added a virtio(4) random driver.
Enabled mpsafe interrupts on pyro(4/sparc64).
Do not clean the multicast records of an interface when it is destroyed (as pcb multicast options might keep a pointer to them).
Disabled lapic when halting amd64 CPUs. Fixes suspend on some machines.
Enabled signature checking by default to sysmerge(8), with new option -S to skip.
Allow dhclient.conf(5) to specify "fixed-address", "next-serve", "filename" and "server-name".
When creating the effective lease, dhclient.conf(5) can now override anything in an offer or saved lease.
Fixed softraid(4) RAID5 write functionality: changed parity calculation algorithm to avoid volume scrubs; allow writes to function correctly even when a chunk is lost.
Allow pf(4) to match "any" interface (excluding loopback).
Added sdmmc(4) support to i386/amd64 install media.
Fixed lpd(8) race condition during symlink check.
Added ubcmtp driver for Broadcom multitouch trackpads (on some MacBooks) enabling multi-finger gestures with synaptics(4).
Convert the softraid(4) work unit workqs to taskqs.
Added strong stack protector mode for propolice in gcc(1) version 3.
Support added to pfctl(8) for "!received-on <interface>".
Allow the Alix APU to reboot by changing the acpi(4) checks.
Added newqueue support to systat(1) for the queue view.
Allow vio(4) to recover after running out of mbuf(9)s.
Allow userland to pass RTF_MPATH flag. Unbreaks multipath routes.
Set initial pf(4) ruleset to explicitly allow dhcp / bootp and dhcpv6. Lease renewals blocked without this change.
Introduced fine grained locking around the lists of packet handlers myx(4) maintains.
Reworked parsing of numbers by dhclient(8) to improve the error messages.
Introduced qla(4), a new driver for Qlogic fibre channel HBAs (only ISP23xx so far).
Count dropped icmp(4) errors when the rate limit is exceeded. netstat(1) will report this now.
When installboot(8) is copying files, do it in 512 byte blocks to appease install media.
Merged mesa 9.2.5.
Reworked installboot(8) to use a single directory with a single makefile.
Call random_start() immediately after cpu_startup.
Support a second -v on mandocdb(8), to show keys while they are being added.
Unlink an associated pf(4) divert state when a socket connection gets destroyed.
Made mos(4) pass received broadcast frames explicitly if not in promiscuous mode. Fixes a problem with initiating connections.
Stopped xterm(1) "-hold" from chewing CPU cycles.
Remove the RAID 4 discipline from softraid(4). RAID 5 should be used instead.
Updated the radeon(4) drm headers based on libdrm 2.4.51; updated libdrm to 2.4.51.
Added installboot(8) "-r", to allows the mount point of the root filesystem to be specified.
Stopped dhclient(8) following symlinks for -l and -L arguments.
Made dhclient(8) parse_X return -1 when it encounters a parsing error. Enables recognition of zero length value vs parsing error.
Fixed off-by-one on specially crafted /etc/shells file.
Optimisations to mandocdb: db build time goes down by 10% (now 1.9x of makewhatis(8)); db size goes down by 4% (now 11x of makewhatis(8)); db build time with -Q goes down by 15% (now at 0.28x of makewhatis(8)); db size with -Q goes down by 3% (now 3.35x of makewhatis(8)).
Avoid size_t overflows while dhclient(8) is reading /etc/resolv.conf.tail, and in file(1) apprentice_map.
Added support for mknod(8) in fuse(4); removed an infinite loop in fuse_device_cleanup().
Incorrect cast to size_t removed from sftp(1), which broke resume of large downloads.
Added more luna88k-specific initialisation in xf86-video-wsfb.
Re-open the default pipe with updated values when attaching a new ohci(4) or ehci(4) device, so the device will be recognised.
Added support for the DS1337 TOD octrtc(4/octeon) clocks.
Added md5(1) -C option (to only do checksum comparison for specified files).
Initialise _res.nsaddr_list in res_init(), fixing some programs which depend on bind resolver internals.
Reset the top(1) cursor position each time there is a resize event.
Added new option "-fstack-protector-strong" for gcc(1) version 4.
Added the "next" keyword as an alias for "+ 1" for relative times with at(1); support "months" and "years" relative time units (all per POSIX).
When parsing dhclient.conf(5) or dhclient.leases(5) and encountering a "}" or a ";", always continue reading rest of file.
Enabled gcc(1) -Wbounded by default.
New signify(1) options: -m message and -x signature.
Reverted to pkg_add(1) PackageRepository.pm r1.97, as there is a memory leak when using internal GZip.
Updated to freetype 2.5.2.
Added -DNOCPIO option to pax(1), for use by distrib/special
Let tcpdump(8) detect bad ICMP/ICMPv6 checksums with the -v flag.
While the hibernated image is being unpacked, acpi(4) now demotes APs to real mode, place them in HLT loop. Fixes some spurious reboots on resume.
Added MSI support to jme(4).
Corrected sigpending(2) argument handling, to stop it writing to the wrong memory on hppa and hppa64.
When md5(1) is using a checklist, print MISSING for non-existent files.
Fixed ping6(8) bug where binary built with stack-protector-strong would fail to set the routing table id.
Made ddb(4) "show mbuf" print all mbuf(9) fields in a consistent way.
Don't let ssh(1) or sshd(8) connect to clients/servers that suffer from SSH_BUG_DERIVEKEY. These are too vulnerable to KEX attacks.
Option "-e" for embedded signatures added to signify(1).
Allow tmux(1) "attach-session -t" to accept a window and pane to select them on attach; made "switch-client -t" accept a window and pane.
tmux(1) changes: check for truncation when copying path; don't use a temporary buffer in screen_set_title; include strerror in output when connecting to server fails.
Fixed the radeon(4) burner method, ensuring cookie is a pointer to rasops_info. Fixes hangs on shutdown.
When sftp(1) is formating the time, show dates in the future with the year; fixed incorrect date calculations.
Updated pax(1) -v format to match ls(1) -l: display the year for dates in the future; eliminate bogus handling of LC_TIME environment variable.
Per POSIX, times in the future are now reported by ls(1) with the year.
Added support for -h hashfile to cksum(1), md5(1), sha1(1) and sha256(1).
Updated to libXfont 1.4.7 (includes fix for CVE-2013-6462).
5.3 and 5.4 SECURITY FIX: CVE-2013-6462: unlimited "sscanf" can overflow the Xserver(1) libXfont stack buffer.
A source code patch is available for 5.3 and 5.4.
Restrict what characters can be in a pkg_add(1) signer, to make certain it's not possible to go ../ from /etc/signify.
Propagate an rdomain number to the icmp6(4) nd6_lookup independently from the ifp pointer. Prevents a crash.
Follow-up fixes for IFID collision handling in IPv6CP; properly change the link-local address.
Made pkg_add(1) verify all checksums, including special files (e.g. prevents people from tampering with DESC).
Sped up mandocdb(8) -Q by another 3% (now at 39.5% of makewhatis(8)).
Delay checking vnode(9) locking of the target vnodes in tmpfs_rename() until we've confirmed they're on the same filesystem as the source.
Allow pkg_add(1) processing of package lists in parallel, a large speedup when re-gzipping a signed package.
Enable memory beyond 1.5GB on sgi octane, to test if kernel panics seen on some MP systems have been fixed.
More speedups for mandocdb(8) -Q mode, found with gprof(1).
Fixed sparc64 kernel profiling.
On sgi, let 2048-byte sector media use a volume header using fake 512-byte sectors, yet still allow reading the native label from it.
Fixed mandocdb(8) -d and -u (broken by recent optimisations).
Make sure in6_ifdetach() removes the ff01::1 route for the detaching interface, too.
make(1) "target: prereq" solving now done after parsing, not during command execution.
Added option -Q (quick) to mandoc(1), for accelerated generation of reduced-size databases.
On i386/amd64, don't use the first 64KB memory for anything (including tramps and uvm). Avoids possible corruption by buggy BIOS SMM code.
Hooked installboot(8) into the build.
No longer have "unreachable manuals", removed the code from mandoc(1).
/dev/random added to the install media, providing additional usable entropy for bsd.rd and first boot.
Fixed vgafb(4) on macppc to bring back textmode cursor.
Updated to x11proto 7.0.25 and xauth 1.0.8.
When rebooting from single user mode, stopped init(8) raising securelevel(7) at rc.shutdown(8).
Ensure we close the socket to the whois(1) server before returning, to avoid a loop.
Made pf(4) queues properly disappear when interfaces are destroyed.
Updated to: xf86-input-elographics 1.4.1, xf86-input-joystick 1.6.2, xf86-input-vmmouse 13.0.0, libpciacces 0.13.2 and glproto 1.4.17.
Calculate proper cwm(1) menu width/height on the first Expose event.
Allowed cwm(1) to accept _NET_WM_DESKTOP and _NET_CURRENT_DESKTOP ClientMessage.
Don't allow cwm(1) to resize to 0x0 during mouse resize.
Added primary support for luna88k 4bpp/8bpp frame buffer, with colour support on the luna wscons(4).
Updated to xterm(1) to version 300.
Temporarily disabled ahci(4) MSI for Samsung XP941.
Tweaked azalia(4) to enable beep and CD controls on ALC282, ALC221 and ALC269.
Fixed mkuboot(8) "make bsd.umg"; allow it to handle PT_LOAD, fail on any others.
Fixed deadlocks when sndiod(8) device slot uses the SIO_SYNC mode.
Fixed ztsscale(8/zaurus) after struct wscons_event size change.
Don't consider ld.so(1) to be successfully built unless a test program using it works.
Experimental feature to let apropos(1) show different keys than .Nd.
Added signify(1), a tool to sign and verify signatures.
First steps to replacing the Berkeley-DB based mandocdb with an sqlite3(1) version.
ssh(1) and sshd(8) now refuse keys from clients/servers using obsolete RSA+MD5 signature scheme.
Reverted rgephy(4) to pre r1.25 behaviour: fetch link and media status when attached to re(4).
Enabled azalia(4) snooping on Lynx Point-LP HD Audio. Fixes Acer Aspire E1 572G audio.
Support .St -p1003.1-2013, "IEEE Std 1003.1-2008/Cor 1-2013" in mdoc(7).
Corrected initialisation of the Bt458 in the luna 8bpp frame buffer.
Stopped mandoc(1) triggering end-of-sentence spacing (near period) at partial implicit macros.
When showing ssh(1) hostkeys, show ed25519 keys as well.
Stopped ssh(1) refusing to load ed25519 certificates.
Allow deletion of ed25519 keys from the ssh(1) agent.
Allow ssh(1) ed25519 keys to appear as certificate authorities.
Call PHY_RESET upon attaching eephy(4) to trigger PHY initialisation (to match behaviour before r1.52).
i386 now uses PIE.
Update to Xserver(1) version 1.14.5 (mac68k and mvmeppc are no longer supported).
Added installboot support for vax, hp300, hppa64, sparc64 and landisk.
arc4random(3) accessible by init(8), leading to random pids for anything besides 0 and 1.
Create a seed file for the bootloader in /etc/random.seed, for random data very early in the boot process.
Free(bbp) in newfs_ext2fs(8) error paths (coverity CID 274748).
"/stand" directory removed (has not been used in decades).
Provide a bootstrap implementation for use with architectures like hppa, landisk and vax.
Initial version of a unified installboot(8). For now only for i386/hppa/amd64.
rc(8) will now report absence of pkg_scripts.
Properly remap mandoc(1) \B, \H, \h, \L, and \l to ESCAPE_IGNORE.
Parse and ignore the roff(7) escape sequences \d (move half line down) and \u (move half line up).
Implemented .Fo/.Fa/.Fc indentation and break handling for mandoc(1) -Tman.
Probe for a keyboard on all iockbc(4/sgi) ports, attach to the first one found.
Fixed pkg_add(1) autoloading of quirks; avoid loading the old quirks file; always report if quirks should be there if it can't be loaded.
In the SYNOPSIS, implemented hanging indentation for .Fo and avoid mandoc(1) outputting line breaks inside .Fa arguments.
Added mdoc(7) support for .St -xsh4.2, the System Interfaces part of the original Single UNIX Specification.
Final circleq to tailq fix for netstat(1), tcpbench(1) and systat(1).
Stopped mandoc(1) breaking output lines in .Fn function arguments in SYNOPSIS mode.
Rearranged/corrected bpf(4) timeout conditionals. Fixes negative timeout panics.
Implemented SYNOPSIS .Fn indentation for mandoc(1) -Tman.
Stopped mandoc(1) outputting line breaks after block macros spanning more than one input line when encountering a ".Bk".
Added ftp(1) support for SSL/TLS server certificate validation (enabled by default); allow setting preferred ciphers.
Fixed mg(1) bugs: dotline off by one when adding newline at EOF; align and sync dotlines when displaying the same buffer in two windows.
Allow pkg_add(1) to cope with the change in ftp(1) warning messages.
The xbase set requires the comp set. When installing, include comp automatically if xbase is selected.
Fixed IPv6 functionality in tftp-proxy(8); implemented "-a" option to make it work on a NAT gateway; generate pass rules instead of erroring out when no address for the current AF was specified.
Revert previous acpi(4) commit, which made resume hang on some GENERIC.MP systems.
Made ld.so(1) pass its cleanup handler, stopped it calling atexit(4) directly on i386, sparc64, alpha, powerpc, amd64 and hppa.
In mandoc(1), implemented hanging indentation for .Fn in SYNOPSIS mode.
radeon(4) now tries to keep the framebuffer console layout set up by the firmware on sparc64.
On alpha, set the primary CPU's PAL revision correctly, to properly spin up secondary processors.
Implemented mandoc(1) end-of-sentence spacing at the end of man(7) macro lines.
Fixed dhclient(8) "string constant too long" errors when reading back a lease with filename or servername attributes containing escaped characters.
Save and restore acpihpet(4) configuration on suspend/resume.
Fixed locking in the drm(4) i915 page fault handler.
Allow kdump(1) to recognise itimer and ktrace facility names to {get,set}itimer() and ktrace().
Add support for truncate in fuse(4).
Added vioscsi(4) driver, work-in-progress but functional enough to work with both Google Compute Engine and RHEVM.
Made mg(1) set the correct line number after successfully searching with re-search-{backward,forward}.
Fixed ksh(1) crash when trying to access ${12345678901234567890}.
When ftp(1) is writing a file, break out when we get a write(2) error, not just an EPIPE.
Switched netstat(1), systat(1) and tcpbench(1) from CIRCLEQ to TAILQ and purged last renants of CIRCLEQ in the base.
Reliability fix for ssl(8) SHA384 SSL/TLS ciphers, to avoid application crash on strict alignment architectures.
5.3 and 5.4 RELIABILITY FIX: avoid application crash while using ssl(8) SHA384 SSL/TLS ciphers.
A source code patch is available for 5.3 and 5.4.
Initialise each cpu's mttr properly (for PAT) at boot and after suspend/resume on i386/amd64.
Made mg(1) "dired-unmark-backward" behave the same as emacs.
Plugged memory leak in tftp-proxy(8).
Recognise octeon2 cpus, like those found in the lanner mr326.
Stopped ssh-agent(1) from crashing (NULL deref) when deleting PKCS#11 keys from an agent that has a mix of normal and PKCS#11 keys (bz#2186).
Fixed multiple remote forwardings with dynamically assigned listen ports, so ssh(1) client can discriminate between them (bz#2147).
Avoid potential integer overflow in ssh(1) client_alive_interval timeout (bz#2170).
Made ssh-add(1) skip requesting smartcard PIN when removing keys from agent (bz#2187).
Provide a random stackgap on pthread frames.
Removed artificial limit on the ksh(1) max array index.
Reverted the other part of bpf.c's r1.84. May finally fix "timeout_add: to_ticks (-1) < 0".
Changed install password prompts; added autoinstall(8) question for root ssh(1) pubkey; make pubkey prompts appear in log.
Correctly read strings containing non-printable characters in dhclient(8) lease file; allow embedded NUL characters rather than skipping them.
Cleanup in ksh(1) code for ctypes, and re-auditing of this area.
Added tcgetsid(3) function, as it is now in POSIX base.
Back-port code from binutils 2.16, so weak undefined references work on alpha.
Run spamd-setup from within /etc/rc.d/spamd; made the rc.d(8) script take $spamd_black into consideration.
Bugfix by switching generic drm(4) modesetting code to give negative errno return values.
Made acpi(4) restore sysctl(8) hw.setperf upon resume like we do for apm(4) on i386.
Implemented cwm(1) support for _NET_WM_STATE_FULLSCREEN hint, with keybinding changes: CM-f "fullscreen", CM-m "maximize".
Changed subject of install/upgrade log to better match periodic maintenance emails.
Allow double quotes to be quoted (by doubling them) in mdoc(7), to match roff(7) and man(7).
Prevented drm(4) causing a kernel panic if an unsupported frame buffer configuration is requested.
Made ssh-add(1) also add .ssh/id_ed25519, to match the manual page.
Removed popa3d(8) from base (no plaintext-password-only daemons allowed anymore).
Fixed ubt(4) compilation after last commit to sys/dev/usb/ubt.c; fixed bthub compilation.
Overhauled intel(4) i915 pread/pwrite code, to fix cache coherency issues and reduce screen artifacts.
Avoid timeouts of ULONG_MAX milliseconds. Stops the Xserver(1) from crashing with "select returned EINVAL" messages.
In dhclient(8), update timestamps in "effective" lease prior to printing the lease.
Enabled tmpfs so it gets tested some more.
Instead of using the work area, use the Xinerama area for cwm(1) snap calculations.
Initial version of autoinstall(8) manpage, for unattended installs/upgrades.
Save-set when cwm(1) is re-exec'ing so as to not lose State on our hidden clients.
Added cwmrc(5) support for XUrgency and matching _NET_WM_STATE_DEMANDS_ATTENTION ewmh hint, with configurable urgencyborder.
Rewritten receive filter handling and ioctl bits in aue(4).
Have df(1) in the daily(8) output show used/free inode levels.
Make sure cwm(1) really takes the work area gap into account with snap calculations.
Track the last event timestamp and pass it on for cwm(1) WM_TAKE_FOCUS ClientMessage. Solves focus order issue.
Fixed static linking of libpthread.
Better bus error diagnostics on sgi (only affects IP28).
Revert change to sha256 in sys/dev/rnd.c, so ramdisk will build again.
Use u_int32_t to store the magic number sent by sppp(4). Fixes a bug on big-endian LP64 archs.
Use a correct pexp to unbreak identd(8) stop/reload (old pexp in /var/run/rc.d/identd has to be manually removed).
Revert to return EPERM for sem_init(3) pshared until it works properly.
Support XA_WM_HINTS in cwm(1) PropertyNotify events.
In sys/dev/rnd.c, replace use of md5(1) with sha256(1).
Prevent gcc(1) from inlining the unsafe functions (and hiding warnings for) sprintf(3), vsprintf(3), stpcpy(3), strcat(3) and strcpy(3).
Redraw cwm(1) client border when unhiding.
Dropped the f0, f1, f2 gettytab(5) capabilities ("modern" replacement is the set of i#, o#, c#, l# to poke magic numbers into termios(4)).
Added infrastructure to create un-biglocked task queues.
Stopped fuse(4) attempt to free a non-heap object.
At resume, do not move flushing characters in from the com(4) chip, as there shouldn't be any.
Remove MD intagp(4) code that is unused now that inteldrm(4) manages the GTT all by itself.
Re-factor processing of classless static routes option (121) in dhclient(8); added more data validation.
Fixed crash on urndis(4) detach.
Stopped iked(8) dropping messages if we are usually the initiator and the peer initiates rekeying first.
Allow uvm(9) aobj to shrink and grow, for mount_tmpfs(8) support.
In sgi architecture, fixed boot block installation on IP28.
Fix cwm(1) client group shortcut in menu lists when clients aren't assigned to a group, to fix a crash.
Updated to Xserver(1) version 1.14.4.
Enabled rum(4) for armv7.
Fixed pcn(4), to allow bringing interface out of all-multicast mode once a range of multicast addresses has been found.
Corrected the sudo(8) check for whether a user may change the login class.
Enabled fast path for relocations and enabled cpu relocations on intel(4) i915.
If the ring was full, make jme(4) put the packet back on the queue so it can be transmitted.
Fixed jme(4) error handling for DMA.
Made intel(4) clflush() flush the correct cache line on i386/amd64. Fixes gnome screen corruption and hangs.
Stopped intel(4) i915 from panicking if an object is truncated while still mapped.
Fixed smtpctl(8) resume route.
ssh(1) now supports ed25519 hostkeys and user identities (see http://ed25519.cr.yp.to/software.html).
New ssh(1) private key format, with bcrypt as the default KDF.
Fixed memory leak in sftp(1) error path in do_readdir().
Warn when smtpd(8) fails to parse a field.
When a relay fails, let the smtpd(8) scheduler update all envelopes in the holdq as if they tempfailed.
Libcompat (for compatability with 4.3BSD) is purged.
Corrected spin timeout detection in __mp_lock debug code.
Fixed ssh(1) AuthorizedKeysCommand inside a Match block (bz#2161).
When dhclient(8) receives a /32 IP address assignment, mimic ISC DHCP by adding a direct route(8) for the default gateway.
Fixed the installer's parsing of nwids containing blanks.
Protect calls to bio_getitall with the sc_lock, so mfi(4) doesn't panic.
Don't leak local_fd on sftp(1) error (bz#2171).
Allow sgi IP27 to be able to boot off cdrom via the "Install System Software" menu.
Fixed iwi(4) to cope with fatal firmware errors: reset chip, reload firmware and bring the interface back up.
Fixed an out-of-bounds-memcpy in iked(8) pfkey_process().
smtpd(8) scheduler_ramqueue is now in O(log n).
Stopped fuse(4) appending a NUL character to buf in readlink(2); more checks for malloc(3) return values.
Allow fuse(4) to free the representation of the vnode(9) in userspace.
Unmount the fuse(4) filesystem if communication ends with the fuse device.
Added missing fuse(4) checks that the communication channel with libfuse is still open before sending fusebufs.
Stopped smtpd(8) sending all delivery notifications to the queue in one go.
Warn when smtpd(8) fails to enqueue an internal bounce.
Fixed dc(4) so it can bring the interface out of all multicast mode once a range of multicast addresses; fixed multicast range checking.
When cwm(1) receives a NotionNotify event, don't redraw the top menu selection.
Always highlight the first menu item in the cwm(1) menu.
Prepend the group shortcut in the cwm(1) client search menu; prepend shortcut in unhide menu.
Stopped ntfs subsystem trying to put an off_t into an int, which resulted in a 2GB limit.
Avoid truncating ntfs 64-bit attribute values to 32-bits. Otherwise an attribute's data length value wraps at 4GB.
If not hidden during an UnmapNotify event, cwm(1) will now un-manage the client.
Corrected ssh(1) bzero of chacha20+poly1305 key context (bz#2177).
Made ssh(1) key_to_blob() return a NULL blob on failure (part of bz#2175).
Fixed use-after-free in ssh(1) ssh-pkcs11-helper.c (bz#2175).
Switched mvme68k to the MI zs(4/mvme68k) driver.
More robust parsing of the DHCP lease file for autoinstall.
Updated to pixman 0.32.4.
Fixed intel(4) write-read race with multiple rings.
Brightness quirk for Acer Aspire 4736Z added to intel(4)
Prevent "bogus xmit rate %d setup" panics in wireless IBSS mode.
Made ifconfig(8) scan show the nwid, channel, and bssid for IBSS networks (not just access points).
Allow the autoinstaller to pass a public ssh(1) key for inclusion in the user's .ssh/authorized_keys.
Fixed nsd(8) bug#534: IXFR query loop over UDP for zones that are unchanged, to stop query flood from the slave.
Use arc4random(3) instead of srand(3) and rand(3) in kerberos(8).
Restore radeon(4) frame buffer upon last close; makes sure we we have a usable console after exiting X(7).
Do not send the smtpd(8) holdq release message if no envelope was held for a relay.
Do not hard-code smtpd(8) scheduler batch size; reduced default limit to avoid hammering effects.
Reverted sys/net/bpf.c back to r1.85, as panics are still being reported.
For pthread_main_np(3), use a new flag, THREAD_ORIGINAL, to indicate the original thread for this process. Fixes some ConsoleKit failures.
Made the installer's ask_which bail out on a missing response in the autoinstall case rather than looping endlessly.
Re-enabled radeon(4) RADEON_INFO_VA_START and RADEON_INFO_IB_VM_MAX_SIZE.
Mark replaced iked(8) flows as "not loaded".
Don't let iked(8) leak duplicate flows.
iked(8) now drops duplicate requests, to avoid corrupt child-SA tables.
Made iked(8) discard & free duplicate IKESAs; made sure new SAs are not created that cannot be inserted in the SA tree.
Include hexdump in iked(8) debug output only for -vvv.
Support raw pubkey authentication w/o X.509 certificates in iked(8).
When wpi(4) has a fatal firmware error, reset the chip, reload the firmware and bring the interface up again.
Limit the number of envelopes to recall in the smtpd(8) hoststat cache.
Removed some double frees in fuse(4).
Fixed smtpd(8) loading of passphrase-protected keys.
Allow subdomain matching in smtpd(8) mailaddr table(5).
Changed the way multicast(4) addresses are linked to an interface.
Now the auto installer supports both install and upgrade, use "non-interactive mode" instead of installation.
Fixed a more(1) read loop, subtly broken on big-endian machines for some time.
Like "gap", made cwm(1) "snapdist" per-screen.
Let cwm(1) deal with clients that don't have WM_NORMAL_HINTS.
Removed cwmrc(5) option to bind a key by keycode with brackets, which never worked. Users should be using keysym names not keycodes.
Made timeout_add(9) return whether the timeout(9) was scheduled in this call (by returning 1), or a previous call (by returning 0).
Grow nfsd(8) request cache for the server side from 64 to 2048 entries. Avoids "file already exists" errors.
Fixed a possible double-free/NULL dereference in vi(1) msg_print.
Updated nsd(8) to version 4.0.0; use nsd-control to signal; generate keys for nsd-control if they don't exist.
Copy some entries from Apache's httpd(8) mime.types file to the one used by nginx(8).
Only set the IFF_ALLMULTI flag if there is at least one real multicast(4) address.
Added some logic to the autoinstaller, to select an interface for the initial dhcp request.
Allow autoinstall/upgrade even when not netbooted.
Reworked install.sub _autorespond(): better line parsing; treat empty/missing/multiple answers as an error and exit; ensure $RESPONSEFILE exists.
Vax can now compress/decompress .xz files.
Many utilities adjusted to use u_char for buffers in "yylex for ctype" calls.
Stopped netstat(1) -Ar leaking kernel pointers to unprivileged users.
Disable %n in printf(9), to avoid making any format-string vulnerabilities exploitable.
Reworked pmap(9) on vax to allow the kernel to use much less memory for page tables.
Increase NMBCLUSTERS in vax (using kernel memory saved by recent pmap(9) changes).
In uvm(9), replaced the swapdev CIRCLEQ with a TAILQ; replaced list traversals with LIST_FOREACH.
I2C driver for am335x added to armv7 (not enabled yet).
Prevent some race conditions in make(1) by just chdir()'ing into the right objdir.
Merged mesa 9.2.3.
In install.sub, use a flag file to recognise a successful autoinstaller run; provide the autoinstaller logfile as mail to root.
With tmux(1) -k, only kill the window after using it to work out -c path.
Made tmux(1) handle empty current directory more gracefully.
kdump(1) now understands USB, VIDIOC and generic DRM ioctl(2).
Taught fsck_ext2fs(8) about MAXPARTITIONS, to let it operate on partitions "i" through "p".
Guard against a compiler optimising away a comparison against NULL-1 in fsck_ext2fs(8) and fsck_ffs(8).
Made isakmpd(8) keep the flow until last ipsec(4) SA is deleted, if the flow is shared by multiple SAs via NAT-T.
Fixed memory leaks in fuse(4).
Initial support in em(4) for integrated Lynx Point ethernet with external i217 and i218 PHYs.
Bring back check of driver freeing uninitialised structures to urndis(4).
Security update to nginx(8) version 1.4.4, which fixes CVE-2013-4547 (see http://mailman.nginx.org/pipermail/nginx-announce/2013/000125.html).
5.3 and 5.4 SECURITY FIX FOR nginx(8) CVE-2013-4547. A source code patch is available for 5.3 and 5.4.
Updated to libdrm 2.4.47 for drm(4).
Changed /dev/drm* permissions to 0600.
Correctly set verify flag on the smtpd(8) listener.
Fail if smtpd(8)'s lka can't load the certificate file.
Added newer ssh(1) protocol 2 transport cipher "chacha20-poly1305@openssh.com",
Removed disksort from the kernel, now that all the direct users have been removed.
rthread shared semaphore fixes: sem_init(3) shared semaphores now work; in sem_open(3), initialise the spinlock if we created the semaphore.
Added gpio(4/armv7) support for omap3/4 and am335x; added omgpio(4) manpage.
Reworked smtpd(8) mda and scheduler to limit the number of pending deliveries to the same user.
Delay closure of sshd(8) in/out fds until after "Bad protocol version identification..." message, as get_remote_ipaddr/get_remote_port require them open.
Added the autoinstall configuration to the list of files stirring the random(4) pool at install.
Moved the GTT management into the intel(4) drm driver.
Backed out intel(4) DRM_IOCTL_I915_GEM_WAIT commit (which left X(7) unusable on resume on some machines).
In install.sub, try to fetch a host-specific responsefile, fallback to a generic one otherwise.
Allow "*" in the user part of mail addresses in smtpd.conf(5).
Impose a limit on the number of inflight envelopes on smtpd(8).
Enabled MSI on the remaining re(4) chipsets.
While autoinstalling, decide whether to install or upgrade from DHCP attribute "filename".
Give /dev/drm0 to the user logged on the console and/or xdm(1), to allow running of OpenGL applications.
Bugfix for pf(4) so a "prio" value of a match rule is not overridden by a later pass rule.
Fixed xf86-video-nv shadow framebuffer implementation for nv(4).
When smtpd(8) is looking up an MX, parse the address if the domain is a "[ipaddr]" string.
Converted trunk(4) to use a detachhook.
Added ugl(4), a driver for Genesys Logic GL620USB-A USB host-to-host link cable. Derived from upl(4).
Unhooked radeonold from the build.
Merged in libdrm 2.4.47 for radeon(4).
Removed unused /dev/X0 entries.
On luna88k, map the bitmap planes of the frame buffer used by the driver. 10% speedup under X(7).
On luna88k, allow ddb(4) to be entered from the keyboard, when there is a glass console and ddb.console=1, with ctrl-alt/zenmen-esc.
Enabled 802.11a support in wpi(4) such as Intel PRO/Wireless 3945ABG rev 0x02.
Reverted r1.858 of sys/net/pf.c, as it caused panics.
Added ugl(4), a driver for Genesys Logic GL620USB-A USB host-to-host link cable. Driver is derived from upl(4).
Bring back stack scanning/dropping of IPv6 type 0 routing headers, but only engage this code when pf(4) is disabled.
Don't fail when an em(4) has no MAC address, and move on to the logic that addresses this.
Fixed setups with ipsec(4) and ifbound, so all local IPSec packets (tunnel->tunnel) match state in pf(4).
Kill the activate routine in ucom(4) and adapt the parent process to no longer call it.
HID cleanups in uhid(4), uhidev(4), ukbd(4), ums(4) and utpms(4), including cleanup match/attach multi-casting.
Made athn(4) tick calculation work as intended. Should fix excessive timeouts and "Michael mic" errors.
Cope with the EAGAIN API change for msgbuf_write(3) in various daemons.
Improvements for sppp(4) address assignment and related issues in IPv6CP; deal with IFID collisions instead of ignoring them; use arc4random(3) during IFID generation; assign destination address to /128 point-to-point links.
Fixed isakmpd(8) parameter types for X.509 routines.
Be more specific in ksh(1) ulimit error messages.
Fixed ^C handling in miniroot.
Setup pfkey timer before use in iked(8). Ignore messages meant for other daemons, like isakmpd(8) does.
Fixed automatic retry in msgbuf_write(3) on EAGAIN (which resulted in spinning).
Ignore empty lines and empty answers in install.conf.
Fixed usbd_dopoll() to take the device as argument (polling is done per controller not per interface).
bgpd.conf(5) knob added, to set priority of routes bgpd(8) inserts into the kernel routing table.
Disabled smtpd(8) forward(5) lookup if sticky bit is set on homedir.
Fixed case-folding issue with smtpd(8) pki names (they are case-insensitive). Check that a pki entry exists when used in a listen or relay rule.
Don't set the TENTATIVE flag on an IPv6 address that is marked as NODAD (otherwise address is rendered unusable).
Ensure that install.conf is non-empty and is re-fetched on every restart of the autoinstaller.
Improved on cwm(1) fix in r1.35 of event.c. If UnmapNotify event is synthetic, set the state to Withdrawn or Iconic ("hidden").
Implemented sd(4) card detection in armv7. Fixes "sdmmc0: can't enable card" on beaglebone black when there is no card.
Fixed bootloader random hangs while counting down on LUNA-88K2; applied same logic to luna88k/dev/timekeeper.c.
5.3 and 5.4 RELIABILITY FIX: fixed vnode(9) locking so an unprivileged cannot hang the system.
A source code patch is available for 5.3 and 5.4.
bpf(4) bpf.c r1.84 returns, this time without panic(9).
Disabled kerberos(8) support in cvs(1) (only used by the strongly-discouraged pserver).
Set "to" address to INADDR_BROADCAST (not "from" address) when dhclient(8) is trying to send broadcast request to server.
Updated to xf86-input-keyboard 1.8.0.
Reverted recent bpf(4) changes to stop "panic: timeout_add: to_ticks (-1)".
Follow RFC 2131: when dhclient(8) is renewing a lease begin by using unicast, fall back to broadcast.
Put back the border draw call in cwm(1) client_resize (needed for redrawing maximised clients).
Cleaned up the activate routines from the uoaklux(4), uoakrh(4) and uoakv(4) drivers.
Re-enabled hardware acceleration on intel(4) Haswells.
Fixed calculations using ticks in bpf(4), athn(4), and radeon(4) to cope with the tick value wrapping.
Bugfixes to drm(4) i915 code to avoid possible Haswell system hangs and GPU locks.
In drm(4) i915, fixed context sizes on HSW (Haswell graphics).
When the mandoc(1) parser is closing an explicit block that is not open, also close below-subsection implicit scopes.
In the mandoc(1) formatter, make sure indentation is reset when leaving a scope, not only when entering the next one.
Fixed mandoc(1) blank lines rendering right after .SH and .SS.
Added mandoc_char(7) support for Unicode characters alternative syntax \C'uXXXX'.
Many font packages updated.
Added fcu(4/macppc) to RAMDISK ,to avoid playing a fan symphony when installing/upgrading some PowerMac G5s.
Stopped growfs(8) assuming the disk sector size is 512-bytes and using p_size as the full partition size.
Corrected the netstat(1) printout of socket buffer counts.
Abort autoinstaller if no sets are found in install_files(), or in case of an invalid answer to a yes/no question.
In azalia(4), enabled snooping on Intel 8 Series HD Audio, and now recognise Realtek ALC221.
Merged in mesa version 9.2.2.
Support tmux(1) case insensitive searching in the same manner as emacs (any uppercase means case sensitive).
Make quota(1) work with DUIDs.
5.3 and 5.4 RELIABILITY FIX: avoid crash occurring on pflow(4) interface destruction.
A source code patch is available for 5.3 and 5.4.
Correctly redraw the top two lines in tmux(1) copy mode when they are selected.
Made sure vlan(4) detach hooks are executed in reverse order they were added.
5.3 and 5.4 SECURITY FIX: fixed memory corruption vulnerability in the post-authentication sshd(8) process with aes128-gcm@openssh.com or aes256-gcm@openssh.com keys.
A source code patch is available for 5.3 and 5.4.
Fixed regression in r1.101 of sys/dev/usb/uhci.c to avoid dereferencing an uninitialised variable when a uhci(4) transfer times out.
Made ssh(1) output the effective values of Ciphers, MACs and KexAlgorithms when the default has not been overridden.
Do not leak the detach hook when the parent interface of a vlan(4) is destroyed/removed.
Stopped autoconf(9) processing transfers when a uhci(4) controller is deactivated.
Backport remainder of the use_loginclass fix from sudo(8) version 1.7.9.
Search the userland buffer of dirent structures before falling back to getdents(2), for considerable speedup.
Fixed ssh(1) rekeying for AES-GCM modes.
Added support for the RTS5229 card reader to rtsx(4).
Added support for "Power Resources" for Dx states to acpi(4), so usb(4) is detected after resume on thinkpads.
Fixed assertion that could lead to orphaned messages left in the smtpd(8) queue after all envelopes are gone.
Format changes and expanded options in smtpd.conf(5).
Stopped mpii(4) running out of command slots when large numbers of devices are detached.
Fixed ifconfig(8) with IPv6 tunnel addresses (broken by recent vxlan(4) commit).
Removed iop(4).
Use DL_SETPSIZE() on i386 to set partition size. Fixes tree breakage.
Make sure seekdir(3) works even when dirp->dd_buf still contains some pending entries.
Fixed softraid(4) levels 0, 4, 5, and 6 to use all available space with partitions larger than 2TB.
Temporary cwm(1) keyboard focus fix for clients that neither populate wmhints nor wmprotocols (e.g. rdesktop).
Enabled locking of fields using the acpi(4) global lock when required.
Let fuse_opt_insert_arg() take an empty string as argument, to unbreak ntfs-3g.
Reserve the last page of the uvm(9) primary swap space, in case we need to place a hibernate signature there.
Hooked up nginx.conf(5) to the build.
The radeon(4) code that sets the DPMS mode may sleep, so do not run from a timeout, hand it off to a taskq.
Fixed ssh(1) rekeying for KEX_C25519_SHA256.
Enabled TX checksum offload in jme(4).
Removed unnecessary spinlock that slowed down pthread_getspecific(3).
Use curve25519 for default sshd(8) key exchange (curve25519-sha256@libssh.org).
Let ssh(1) support pkcs#11 tokens that only provide X.509 certificates instead of raw pubkeys (fixes bz#1908).
Replaced rc4 with ChaCha20 in crypto(9).
Made sure login_yubikey(8) does not log passwords, even if they are wrong.
Bring back spnego support into kerberos(8) gssapi as it used to be before the update to 1.5.2.
Push the pf(4) queues every 1/HZ using timeout(9); use a timeout for each HFSC-enabled interface.
Removed ray(4) from i386/amd64.
Hooked up sunxi bits for miniroot and ramdisk (tested on pcduino).
Use m_copydata() instead of mtod(), so routing messages compatibility code will work on strict alignment architectures.
Added missing bitfields to fuse(4) that are needed by gnome virtual filesystem.
Fixed mkuboot(8) endianess for big endian architecture.
Made sure we send pflow(4) packets via the correct rdomain.
Re-added cwm(1) support for WM_TAKE_FOCUS. Solves keyboard input focus loss for java apps.
Enabled fuse(4).
Update UK dialling codes from ofcom information, and added 970 (Palestine), to share/misc/inter.phone.
Better defaults for the wsdisplay(4) screen burner settings: all unblank actions enabled (burning still disabled by default).
Removed a.out(5) support from compat_linux(8).
Installed fuse(4) headers in "make includes", to unbreak ports(7) builds.
Converted the route expire timestamp in kernel and routing message to 64 bit.
Switched the crypto(9) work queue to the task_add(9) api.
Re-enable compat_linux(8) on i386, now it is working with post-32bit-time.
Added a header for various hardware implementation dependent register (HID) definitions to macppc.
Make sure bioctl(8) -v output is properly aligned with the normal output.
Added smtpctl(8) "show relays" and "show hosts" commands.
Enabled native builds of the luna88k boot block and install it into /usr/mdec; copy boot blocks into /boot on the root disk in md_installboot().
Fixed some jagged diagonal lines when using ws(4).
Treat another OMRON UPS, BY35S, as ugen(4). Allows sysutils/nut to work on this device.
Allow kernels to compile without INET6.
Unbreak glxsb(4/i386) by properly allocating its key schedule.
Fixed potential file descriptor overlap by making sure that file descriptors zero to two are always open when starting slowcgi(8).
Added missing "heloname" field for smtpd(8) relayhost; differentiate relays with different helotable/heloname.
Emit an extra "config" convenience target that allows one to rerun config(8) without changing directories.
Use "/etc/mail/mailname" instead of "/etc/mailname" in smtpd(8).
Report smtpd(8) mta sessions errors on the route (not the MX). If a route has too many such errors, disable it for a while.
sshd_config(5) PermitTTY options to disallow TTY allocation, mirroring the no-pty authorized_keys option (bz#2070).
Moved most of the uses of workqs in drm(4) to the new taskq api. Fixes hangs on radeon(4).
Let vmwpvs(4) get hotplug events from the hypervisor, so you can add and remove disks at runtime.
Introduced tasks and taskqs (e.g. task_add(9)). Ongoing replacement of workq_add_task(9) and posse.
Unlock the vnode(9) while calling a device's d_close routine, to ensure the device close routine doesn't block indefinitely.
First steps of a native luna88k bootloader, able to boot elf(5) kernels with symbols from disk or network.
On armv7, enabled blocksize > 512.
Allow smtpd(8) to accept credentials formated as "<user> <passwd>", and empty alias files.
Report the ssl certificate verification status in the smtpd(8) mail header; log ssl certificate validation errors; fixed several ssl-related leaks.
Use the correct value for the Interframe Gap Time 0 bit in the usb(4) transmit configuration register.
Revamped armv7 ramdisk and miniroot creation process; installer can recognise the SoC and makes decision based on it.
Added -A (-ax) support to ps(1)
Removed fddi(4) support and the three flavours of the driver, fpa(4), fea(4) and fta(4).
Make prcm(4/armv7) aware of the GPIO modules on armv7 machines.
Made smtpd(8) handle the case where the filter string is quoted.
Fixed a potential race when several smtpd(8) relays share a single domain (resulted in temporary delays/failures).
Make sure that the kernel symbols area isn't marked as free space on armv7.
bzero(3) some smtpd(8) structures before using them, to be safe.
Improved elf(5) handling, so mkuboot(8) will create valid images running on 64-bit systems.
Support added for unattended OpenBSD installations, using DHCP and a response file.
Added support for AUTH LOGIN in smtpd(8) mta.
Fixed smtpd(8) parsing of inet6(4) addresses when prefixed with "IPv6:"
Allow smtpd(8) mta to "hold" envelopes in the scheduler when it has too many tasks for a given relay.
Fixed the timer on sunxi A20 boards.
Abort early if another smtpd(8) instance is running.
Fixed makefile, to make sure we build the manual pages of all architectures on macppc.
Enabled gpioctl(8) for armv7, and added associated devices on armv7/sunxi.
Fixed traceroute6(8), nc(1) and telnet(1) when the -V flag is not given.
For sunxi boards where u-boot doesn't set MAC address (e.g. pcduino), generate address based on the Security ID (SID).
Updated xkeyboard-config(7) to version 2.10.1.
Fixed ssh(1) crash caused by previous commit which occurs when using ProxyCommand.
Fixed/re-enable re(4) RX checksum offload for 8168C/8168CP. Flag was accidently removed with rev 1.140 of sys/dev/ic/re.c.
Let smtpd(8) local enqueuer cope with the output of a long running program; use sendmail(8)-like exit status.
Allocate smtpd(8) key storage dynamically, instead of using a fixed size buffer.
Made sure cwm(1) client_delete does not try to destroy clients that are already gone (and generate spurious errors).
Don't let smtpd(8) ignore "remove" requests for an envelope which is inflight.
Improve reporting in smtpctl(8): when sending a request to the scheduler, wait for the success/failure report; report the total number of affected envelopes for schedule, pause, resume and remove envelope operations.
Stopped falsely assuming that the icmp(4) checksum field is always in the first mbuf(9) of an mbuf chain.
X11 clients added to the aviion architecture.
Fixed off-by-one when mpii(4) is calculating the length of an sgl segment.
Fixed regression that made the pandaboard panic when it tried to enable PRCM_MMC0 on the omap4.
Added support for xbox 360 controller as a uhid(4).
Added support for the hardware random number generator on octeons, octrng(4).
Understand node contexts when smtpd(8) is building the expansion tree (e.g. same delivery for different users, or as a different destination address).
Fixed USERINFO and CREDENTIALS lookups in the (experimental) smtpd(8) sqlite backend.
Plugged smtpd(8) memory leaks on update.
nm(1) output on archives on mips now displays correctly.
Fixed sendmail(1) to cope with filesystems with large f_bavail values.
Do not rely on u-boot to enable mmc clocks on armv7.
Do not fatal() smtpd(8) immediately on write error. Fixes bug where the server would stop if smtpctl(8) exited early.
Don't try to resolve hostnames when a ssh(1) ProxyCommand is set unless the user has forced canonicalisation.
Disallow empty Match statements in sshd_config(5), and add "Match all", which matches everything.
Periodically print progress and, if possible, expected time to completion when screening moduli(5) for DH groups.
Include local address and port in sshd(8) "Connection from ..." message (only shown at loglevel>=verbose).
Enabled TX checksum offload in bnx(4) and bg(4).
Allow traceroute6(8) to operate across a nat64 gateway.
Made slowcgi(8) loop around waitpid to catch all exited children, as there is no guarantee of one signal per child.
Added support for displaying the cache write policy of RAID volumes to bioctl(8); make mfi(4) pass up the necessary information.
Added key to tmux(1), to swap to other end of selection (bound to o with vi keys)
Overwrite icmp(4) type-specific nextptr field only when pf(4) changed it, to fix icmp(4) to icmp6(4) translation regression.
In pthread_kill(3)/pthread_cancel(3), make sure the thread ID won't be reused until the kill(2) is complete.
Allow uppercase "K/M/G" specification in "machine memory" boot(8) command on i386/amd64.
Relative-specified ssh-keygen(1) certificate expiry time should be relative to current time and not the validity start time.
Hostname may have %h sequences, these should be expanded prior to ssh(1) Match evaluation.
Made roff(7) parse and ignore .hw (hyphenation points in words).
Save "next-server" (a.k.a. siaddr) info into the dhclient.leases(5) file.
Added SMC_CAPS_SINGLE_ONLY capability to sdmmc(4), to force the sdmmc stack to only issue single blocks transfers.
Resolved an issue where icmp(4) traffic with pf(4) nat-to failed due to incorrect checksums.
Added support for allwinner-based devices (A1x/A20) such as the cubieboard to armv7.
Removed arc4random_stir() and arc4random_addrandom(), which should not be called directly.
Unbreak mg(1) make-directory by stripping trailing "/".
Stopped slowcgi(8) leak fds in the fork(2) error path.
Added support for sdhc(4) to detect GPIO pins on the i.MX6 wandboard.
Added a pmtu delay sysctl(8) BUTTON for netinet6.
Enabled vxlan(4).
Made dhcpd(8) use provided netmask in "subnet" statements, allowing later comparisons with interface addresses to work properly.
Added load_font and list_font accessops to all rasops(9) wsdisplay(4) drivers, e.g. tga(4) and gpx(4/vax).
Fixed pf(4) icmpid bug (only affected icmp(4) echos via nat, when the nat doesn't change the address).
Allow a user to switch telnet(1) to rdomain zero.
Made nc(1) set the requested rdomain on the socket instead of only on the IPv4 part; allow switching to rdomain zero.
Added rdomain support to IPv6 configuration tools ndp(8), rtsold(8), ping6(8) and traceroute6(8).
With disklabel(8) -A, take 10% for swap, setting a maximum based on physmem.
Introduced the "display.font" parameter, which requests the wsdisplay(4) driver to change the display font.
Enabled support for vmware paravirtual SCSI via vmwpvs(4) on i386/amd64.
Built-in kernel fonts will now appear in the list of font usable by wsdisplay(4), vga(4), rasops(9) and wsfontload(8).
Eliminate global limit on the number of fonts able to be loaded by wsdisplay(4).
In hibernate for i386/amd64, temporarily reverted "Realmode park" mode.
Do not run any command from the client which starts the tmux(1) server until after the configuration file completes loading.
Let wsfontload(8) report i/o errors on stdin as occurring on "stdin" not "(null)".
Added i386/amd64 boot(9) support for keydisk-based softraid crypto volumes.
If a font is not a file, wsfontload(8) now computes the numbers of characters it contains from its size, instead of assuming 256; default to 12x22 glyph instead of 8x16 if the display is a raster frame buffer.
Updated to xf86-video-dummy 0.3.7 and xf86-video-vesa 2.3.3.
WSDISPLAYIO_GTYPE ioctl support added to radeon(4) and intel(4) KMS drivers.
Fixed resume time stream corruption seen on x230 with large (16GB) unhibernation.
Allow hibernate to work on Ivy Bridge and later CPUs.
Don't turn on ModifyOtherKeys by default, as when tmux(1) is killed and it's left stuck on.
slowcgi(8) now properly reserves file descriptors for incoming connections.
Fixed some spurious failure-to-hibernate errors.
Removed the noct(4) driver.
In the ssh_config(5) "Match" section, renamed the "command" sub-clause to "exec".
Parse the argument the -r option with atoll(3) to support dates past 2038
Reverted r1.138 of pp/cwm/client.c (WM_TAKE_FOCUS) for now.
ip6_input() adjusted to remove double scanning for routing header type 0 in the IPv6 stack, as pf(4) handles this anyway.
No longer make cwm(1) redraw unnecessarily on every unhide, resize, and mouse move/resize "Expose" event.
Improved address and linkstate hooks, added additional detach hook to track changes on the parent multicast interface in vxlan(4).
Support the hibernate key (Fn-F12) on thinkpads.
Enabled TX checksum offload on em(4).
In crontab(5), added a random sleep of up to half an hour to distribute the server load from spamd-setup(8).
Merged bgpd.conf(5) prefix and prefixlen filter components into one filter, so rules are grouped by prefixes last.
slowcgi(8) now keeps better track of fds, to only close those still open. Avoids closing random fds from other connections.
Fix receipt of OID varbinds when snmpd(8) is sending traps.
When we attach a network interface, do not reuse the last index. Avoids some race conditions.
Simplified pipex(4) checksum handling.
Stop pre-computing the pseudo header checksum and incrementally updating it in the tcp(4) and udp(4) stacks.
Fixed some 512-byte block vs disk sector confusion on hppa and sgi.
For cwm(1) clients that support WM_TAKE_FOCUS in their WM_PROTOCOLS property, send a ClientMessage event.
Don't silence stderr from pkg_add(1) when running fw_update(1) in verbose mode.
UTF-8 support for wsdisplay(4) emulation modes, so vt100 and sun emulation recognise xterm-compatible escape sequences ESC % G and ESC % @.
When rasops(9) can't find a proper glyph for a requested character, use a question mark instead of a space.
Bugfix update to nginx(8) version 1.4.3.
Disable global page mappings before we start to unpack on i386/amd64 using acpi(4), for more robust hibernate.
Use openlog(3) in slowcgi(8) to log to syslog(3).
Made slowcgi(8) set FD_CLOEXEC; fixed some pointer calculations.
Adjusted the disklabel(8) editor to allow more space for swap on large disks (e.g. useful for hibernation).
Allow hibernate to run the radeon(4) suspend code before mountroot.
Prepared the route(8) command for printing 64 bit route expire time; fixed conversion between relative and absolute expire time.
Include remote port in ssh(1) bad banner message (bz#2162).
pf.conf(5) cannot have queue definitions inside anchors, don't let pfctl(8) attempt to load them, error out if we run into one.
Updated snmpd(8) to use the proc.c privsep style from iked(8) and relayd(8).
Remove support for a.out(5) and ecoff on all platforms (we only do elf(5) now).
"fsync@" protocol extension for sftp-server(8). Client support for calling fsync(2) for faster transfers (bz#1798).
snmpd(8) -r option removed.
Support added for oaic in the aviion boot blocks.
Moved creation of "restricted" communication sockets into snmpd.conf(5); added ability to specify an alternate "control" socket location; allow for the creation of multiple "restricted" sockets.
Prefer acpi(4) over apm(4/i386) on i386.
Implemented ssh(1) client-side hostname canonicalisation. Avoids need for host certificates to list unqualified alongside fully-qualified names.
Stopped ldpd(8) binding a label for the default route.
avoid ldpd(8) segfaults by passing the ldpd_conf structure as an argument.
The disklabel(8) variables aflag and dflag are boolean, so use logical instead of binary operators for comparison.
Improved ldpd(8) parsing of LDP messages; proper notification messages on error conditions.
ldpd(8) now ignores messages that have Unknown flag set.
Added support for ERL ethernet on octeon (which can now be booted over NFS).
Driver added for the oaic(4/aviion) AIC-6250 SCSI controller found on aviion models 100, 200, 300, 400 and 4300.
Fixed tmux(1) detach -a, by skipping clients where the session is NULL.
Added a "Match" keyword to ssh_config(5) that allows matching on hostname, user or result of arbitrary commands.
Made logging of ssh(1) session starts a more useful format.
Check for invalid values in the routing message, to stop root crashing kernel from userland.
Fixed hangs seen when unplugging a USB keyboard which was attached to an uhci(4).
Added 7.5kbit Diffie-Hellman groups to moduli(5).
Count number of lines in moduli input file and pass to the testing ssh-keygen(1) process, to provide completion time estimate.
Made roff(7) parse/ignore the .fam (font family) request. Fixes irunner(1) and uim-xim(1) ports.
Use crunchgen(8) DIST_LIB/DIST_OBJS hooks to make it possible to link crunched binaries against libraries compiled with smaller objects.
Fixed regression introduced when macppc pci(4) started parsing device tree to enumerate devices, so ht(4/macppc) controllers work.
Added libefi to mandoc(1), and simplified some names.
Set the default vxlan(4) MTU to full 1500 bytes.
Imported vxlan(4), the virtual extensible local area network tunnel interface.
Standalone hfsc implementation added to pf(4), for the new bandwidth shaping subsystem (altq stays during migration phase).
Let systat(1) adapt to recent queueing changes.
Add initial RTL8106E and RTL8168G/8111G support to re(4).
Fixed hang-on-close problem seen with ssh(1) and xterm(1) when a closed pty(4) is poll(2)'ed.
Changed pf(4) to prevent non-data packets from being dropped.
Stopped tmux(1) leaking file descriptors in the rare MSG_VERSION case.
Updated to freetype 2.5.0.1.
Added support for am335x edma3 controller to armv7.
When tmux(1) is respawning, pass -1 for cwd now (not NULL).
Show session name in tmux(1) detached message.
Alter how tmux(1) handles the working directory: -c flag to new, neww, splitw allows the working directory to be overridden; -c flag to attach let's the session working directory be changed; default-path option has been removed.
Make tilde expansion in tmux(1) command strings work even if it isn't terminated by /.
Instead of fixed size buffers for some tmux(1) messages, send only the string length; similarly for MSG_COMMAND - allow full imsg limit (not arbitrary 2048).
When mouse button is pressed within a tmux(1) pane, no longer resize the pane if edge of the border is later hit.
Support tmux(1) -c for new-session.
Upon mouse click, stopped tmux(1) selecting panes which aren't visible.
Restored missing tmux(1) key binding for %.
Ensure the tmux(1) check on the permissions of TMUX_TMPDIR is performed on directories only (not files).
Clear tmux(1) WINLINK_ALERTFLAGS properly, otherwise sessions may still see flags for winlinks which have been cleared.
When tmux(1) choose-tree expands/collapses items, ensure the item is visible at the bottom of the screen.
Made tmux(1) assign mouse x/y coords before checking them. Fixes off-by-one when the statusbar is at the top of the screen.
Allow tmux(1) to accept multiple parameters to SM/RM/DECSET/DECRST.
Only include actual trailing spaces (not unused cells) with tmux(1) capturep -J.
Allow tmux(1) nested format expansion.
Allow the file descriptor received from the tmux(1) client to be -1.
Extended tmux(1) to handle input mouse positions greater than 33.
Make tmux(1) recalculate_sizes() handle an empty window with no active pane. This can happen when a window is in two sessions.
Stopped tmux(1) leaking formats if they are added multiple times, and leaking grouped sessions on destroy.
Fixed potential tmux(1) crash when a command in a command client can't be parsed.
Stopped tmux(1) adding client formats when they are NULL.
Fixed sshd(8) re-exec fallback, by ensuring that startup_pipe is correctly updated (bz#2139).
Added ability to whitelist and/or blacklist sftp protocol requests by name to sftp-server(8).
Changed "physical address" to "tunnel:" in ifconfig(8)'s tunnel address output.
Merged binutils 2.15 einfo() buffering change to binutils-2.17.
Enabled oosiop(4) synch negotiation.
Various fixes to make kiic(4/macppc) work on some G5s.
Fixed Powerbooks regression, where one of the two kiic(4/macppc) would timeout when trying to configure the audio chip.
Made syslogd(8) trim leading white space from the message before trying to extract the program name.
Include the "state of health" field in the mfi(4) "bbu ok" (battery capacity) sensor value.
Stopped pf(4) leaking ruleitems from match rules when hitting a per-rule max state limit.
Allow bgpctl(8) to bulk add/delete routes with the same attributes. Really useful for distributing IP lists.
Fixed dixfonts from upstream for CVE-2013-4396 (use after free in Xserver handling of ImageText requests).
When available, use monitor/mwait to idle on i386/amd64.
Early stages of a working disk bootloader for OpenBSD/aviion. Currently limited to oosiop(4) controllers
Increased the size of the Diffie-Hellman groups requested for a each ssh(1) symmetric key. New values taken from NIST 800-57, upper limit from RFC4419.
Added vmwpvs(4), a driver for VMware Paravirtual SCSI in vmware guests.
Use CLOCK_UPTIME, so that vmstat(8) uptime averages/rates are over the actual time-running-not-suspended.
Fixed a segfault in ndp(8) -A to properly free the buffer when not in repeat mode.
Show number of sectors, not the number of 512-byte blocks, when newfs(8) is saying "n sectors of m bytes".
Allow snmpctl(8) to specify the "oid" option multiple times (e.g. "snmpctl walk 127.0.0.1 oid system oid ifName").
Added axen(4) device driver, for ASIX AX88178a and AX88179 Ethernet interfaces.
getdirentries(2) is dead; long live getdents(2).
Fixed mandoc(1) to allow breaking the line at hyphens in macro arguments (e.g. .Nd and most of the .%? citation macros).
Stopped mandoc(1) throwing a fatal error and dying if there is anything inside a .Bl block body before the first .It.
Added quirk to azalia(4) for ALC260 (found on Acer Extensa 6700).
Added CLOCK_UPTIME, a clock which measures time-running-not-suspended, used in clock_gettime(2) and other places.
Backed out POLLHUP change until a problem with xterm(1) hanging on close is fixed.
Support for the i.MX6-based Wandboard Quad added to the armv7 architecture.
Disabled interrupts in the re(4) interrupt handler. Fixes the occasional watchdog timeout when using MSI.
Removed Adaptec 2940 SCSI controllers from i386 RAMDISK kernels to make other things fit.
Use monitor/mwait to idle amd64 CPUs when available.
Change the default for the "default-path" option to ~ in tmux(1).
Updated to mesa 9.2.1.
In tmux(1), use open(".")/fchdir(2) to save and restore current directory rather than getcwd(3)/chdir(2).
Fix boot device matching in the presence of mpath(4) on hppa/hppa64.
poll(2) on a closed tty(4) now returns POLLIN|POLLHUP in revents when events is set to POLLIN, and POLLHUP when events is set to POLLOUT.
Added ntpctl(8), which allows us to query the locally running ntpd(8) process.
Fix tuner ioctl TVTUNER_SETFREQ in bktr(4) (broken after rev 1.30).
In mandoc(1), support roff(7) simple numerical conditions.
Support mandoc(1) setting and printing out arbitrary roff(7) number registers, preserving support for the ".nr nS" SYNOPSIS state register.
Fixed drm(4) incoherence with fence updates on Sandybridge and higher CPUs.
Kernel adjusted to print many daddr_t variables with %lld, and u_int64_t variables with %llu in many places.
Made it possible to correctly set up and label a vnd image with a boot area on aviion.
Emulate 64-bit drm(4) atomic operations on 32-bit architectures by using a mutex.
Replaced rc4 with ChaCha20 in arc4random(3).
Added initial SNMP client utility to snmpctl(8). For example, "snmpctl snmp walk 127.0.0.1".
In ld(1), make stderr buffered in einfo(), to speed up display of error messages on slower platforms.
Use PATH_MAX, NAME_MAX and LOGIN_NAME_MAX (not MAXPATHNAMELEN, MAXNAMLEN or MAXLOGNAME) in the C library.
Stopped drm(4)'s drmclose unreferencing objects while a mutex is locked.
Ensure the OpenBSD area of the disk does not enclose the boot area on the aviion architecture; added installboot(8/aviion).
On aviion, test whether the WHOAMI register exists before using it.
Two new libX11 locale(1) added: km_KH.UTF-8 and sr_CS.UTF-8.
Enabled mpath, rdac, and sym in GENERIC kernels to find bugs.
Ensure stack is 1:1 mapped before attempting to give control back to the PROM at halt/reboot time, so aviion can reboot.
Updated to: xserver 1.14.3; makedepend 1.0.5; xman 1.1.3; libX11 1.6.2; libXaw 1.0.12; libXmu 1.1.2; libXpm 3.5.11; libXrandr 1.4.2 and libXv 1.0.10.
poll(2) on a socket now sets POLLHUP on EOF, so socketpair(2) matches pipe(2) behaviour when the other end is closed.
Refined gio(4/sgi) frame buffer probe, to correctly detect a newport frame buffer on Indy if a HPC SCSI board is attached.
Correctly probe for the Ethernet chip on hpc(4/sgi) v1.5 expansion boards. Gets rid of "sq not configured" in dmesg(8).
In boot(9), do not iterate over alldevs if it is empty (e.g. halting from ddb(4) with ddb entered early with boot -d).
With even number of offsets, choose middle offset with lowest delay. Resolves uncertainty in the ntpd(8) REFID assignment.
Stopped the message that uthum(4)'s calibration offset is incorrect, when the offset is less than 1 degree C.
Stopped wd(4) incrementing the address the next i/o will start at by an incorrect amount.
IPv6 atomic fragments must not go into the pf(4) reassembly queue, but be processed immediately.
Use the cpuid vendor string (not model string) when enabling VIA specific amd64 code so the code works with Eden X2 processors.
Take into account that the iked(8) ike message header might no longer point to the same memory after buffer manipulations.
Make sure drm(4) vblank_time_lock blocks interrupts; made most atomic operations really atomic; removed all 64-bit atomic operations on 32-bit architectures. Potentially fixes some races/panics.
Sync most machine independent LANCE code (le(4/vax)); added ILACC (79900) support.
Stop traffic for a given usb(4) endpoint when a transfer reports an I/O error. Fixes ehci(4) looping with "ehci_idone:" messages.
Try to release the console if pckbc(4) fails to send the initial command byte, giving USB keyboards a better chance of attaching.
On hp300: Removed SLOWSCSI; increased scsi(4) target selection timeout. Booting kernel from disk now much faster.
Keep sudo(8) default env_keep to minimum required for pkg_add(1); env_keep for building src and ports moved to "wsrc" group.
Report each m88k cmmu on its own line in dmesg(8); fixed multiprocessor writeback logic.
Fixed luna88k installer, to add bsd.mp to the default sets if > 1 processor.
Stopped merging the per-thread and per-process flags when reporting them via sysctl(8) KERN_PROC.
Updated to: util-macros 1.17.1 and videoproto 2.3.2.
Merge unbound 1.4.21 and ldns 1.6.16.
Fixed tmpfs' uio_offset, to stop it skipping one entry for each block.
Fix an ino_t inconsistency to unbreak the build of fuse(4)'s libfuse.
Made aviion understand ELF files well enough to netboot kernels on AV530.
Switch to machine independent dart(4) driver on aviion.
Set top(1) a higher MAX_COLS, more reasonable for modern widescreen displays.
Fixed occasional SIGSEGV in privsep'd binaries (eg syslogd(8) and pflogd(8)) on sparc/sparc64 running on sun4/4c/4e.
Added support for root on NFSv3.
Configure pms(4) absolute mode for elantech v2. Synaptics driver now attaches to elantech v2 touchpads. Print the firmware version at attach time for reference in future bug reports.
Fixed panic in pipex(4) seen if pipex deleted a session via idle-timer when npppd(8) was frozen, causing use-after-free.
Don't assume the length of npppd(8) chap challenges.
Added length check for Proxy LCP and Authentication AVPs in npppd(8); also in 5.2, 5.3 and 5.4 stable branches.
Do no try to clear the uhidev(4) endpoint (as it if has stalled) if the USB transfer reported an I/O error.
Made ssh(1) BindAddress work with UsePrivilegedPort=yes (bz#1211).
Tell the client when their preferred ssh(1) listen address has been overridden by the server's GatewayPorts (bz#1297).
Store the initial file offset so the progress meter doesn't freak out when resuming sftp(1) transfers (bz#2137).
Get ethernet working on the edgerouter lite; added atphy(4) to RAMDISK and GENERIC.
Increased default number of ugen(4) device files: two are too few for modern standards.
Removed gssapi config parts from ssh_config(5).
Fixed mandoc(1) horizontal spacing for input lines beginning like ".Oc Ns".
Fixed mandoc(1) horizontal spacing where "Ns" macro follows a block-closing macro and the corresponding block-opening macro is not on the same line.
Reverted ksh(1), so commands executed via `foo` or $( bar ) inherit "set -e" status (as POSIX requires).
Updated to: twm(1) version 1.0.8; xclipboard(1) version 1.1.3; xclock(1) version 1.0.7; xinit(1) version 1.3.3; xkill(1) version 1.0.4; xlsclients(1) version 1.1.3; xmodmap(1) version 1.0.8; xrdb(1) version 1.1.0 and libSM version 1.2.2.
Bar pflow(4) if flowsrc is not set.
Fixed sign of returned error code for drm(4) i915.
Prevent hardclock(9) trying to schedule a softclock interrupt before its cookie has been allocated (this caused panics on macppc).
Added SM_PATH to the default env_keep in sudoers(5).
Added basic support for eMMC memory and enable it on the BeagleBone Black.
Revert previous sys/net/if.c diff to always increment the if(4) interface index (tun_switch() depends on this feature).
Avoid leaking mbufs in cpsw(4/armv7) failure paths.
Fixed ssh(1) connection crash when sending break (~B) on a ControlPersist'd session.
Switched to using arc4random in sqlite3(1).
Allow for 0-length "octet strings" in SNMP traps, so snmpd(8) conforms with ITU X.690 (ASN.1 definition document).
Correctly NUL-terminate the systat(1) cpu view array. Fixes a segfault on powerpc and probably others.
Fixed user(8) bug where owner/mode is not set on the user's homedir if the specified skeldir does not exist.
Added support for SM_PATH environment variable. sysmerge(8) can search this path for etcXX.tgz and/or xetcXX.tgz.
Disabled intel(4) blit acceleration on haswell (for now).
Allow BOOTP lease times and the options dhcp-lease-time, dhcp-rebinding-time, and dhcp-renewal-time to be controlled via dhclient.conf(5).
Added relayd.conf(5) support for ECDHE (Elliptic Curve Diffie-Hellman) to enable TLS/SSL Perfect Forward Secrecy (PFS).
Import nl(1) from NetBSD, with local changes (inc. "-" syntax for stdin, multibyte delimiter support from FreeBSD, code simplifications).
Fixed some omissions and flag errors for radeon(4) pci match tables, removed the duplicate table for i915.
Monochrome Xserver(1) now available on luna88k.
Fixed scsi(4) mpath "next path" selection. If the current path is NULL the machine will no longer panic.
Enabled vmx(4) on i386 and amd64.
Added a new systat(1) screen "cpu" listing the usage of each CPU core; new -B command line flag, similar to -b.
Changed default relayd(8) and ldapd(8) ciphers to HIGH:!aNULL.
Plugged a snmpd(8) memory leak when walking the pfTblAddrTable in PF-MIB.
Sync PF-MIB and snmpd(8) with the pf(4) table byte/packet counters for "match" rules.
Support added to arm for FreeScale's i.MX6 SoC.
Taught id(1) about the whoami(1) and groups(1) run modes (removes shell wrappers).
When slowcgi(8) is dumping FastCGI protocol headers during debug, also dump the "request begin" and "request end" protocol entries.
Made slowcgi(8) use the correct buffer size for memory allocation and reads.
Added ugold(4), a driver for PCsensor's USB gold TEMPer temperature measurement device.
Merged mesa version 9.2.0 into xenocara.
Set relayd(8) "toread" to 0 if we don't expect a body. Fixes handling of HTTP requests with a body (e.g. POST).
Add a proper suspend ksh(1) builtin that saves/restores the tty and pgrp as needed instead of using an alias (login shells may be suspended if they are not running in an orphan process group).
The beagle architecture has been replaced by the more generic armv7.
time_t and other random fixes from upstream merged into base nsd(8).
Added libtxc_dxtn 1.0.1, a DXTn/S3 texture compression library.
When a partition is changing to UNUSED, save kernel-set values on all partitions, not just open ones and keep the new partition type. Allows changing the RAW_PART partition (a.k.a. "c") to UNUSED.
Rewritten ARMv7 cpu cache discovery code (to remove false assumptions); fixed log2(3) on arm.
After resume, make the pms(4) driver wait longer when /dev/wsmouse is opened. Allows mouse to work after resume on x130e.
Updated to nsd(8) version 3.2.16.
Only free the per-protocol descriptor if a pms(4) touchpad cannot be correctly identified during attach.
Removed unnecessary calls to arc4random_stir(3) in ssh-keygen(1) and sshd(8). Increases available entropy.
Use arc4random(9) as the preferred random number source in fontconfig.
Properly pass daemon_flags to amd(8).
Update line buffer allocation on radeon(4). Fixes blank screen problems on dce4.1, dce5 and dce6 asics (see https://bugs.freedesktop.org/show_bug.cgi?id=64850).
Updated GLU to version 9.0.0. GLU was previously part of Mesa but is now separate.
Made sftp(1) "^w" delete the previous word, instead of the entire line. Matches ksh(1) behaviour.
Lock the audio mutex before invoking the audio(4) call-back. Fixes panics on zaurus.
Turn on mass storage interface for mfii(4).
If a slowcgi(8) script dies due to receipt of signal, pass that back to the HTTP frontend as the "application return status".
Use PCIe capability version 2 when displaying link speeds with pcidump(8).
Fixed handling of getdents() against UDF filesystems.
Use arc4random_buf(3) in iceauth(1).
Added iwn(4) support for advanced btcoex.
Allow setlocale(3) (LC_MESSAGES, ...); to succeed. Stops some ports (e.g. gnome) from freaking out.
Quieten ssh-keygen(1) batch processing; exit with non-zero if asked to find a non-existent hostname in the known_hosts file.
When we attach an inet(4) interface, avoid races by not reusing the last index.
Enabled RS400/RS480/RS690 in radeon(4).
Non-integrated radeon(4) >= r600 parts will now try to enable PCIe 2.0/3.0 speeds if the PCIe root port advertises those speeds.
Made mpath(4) path driver "match routes" return 8, so they will definitely be higher than the real device drivers.
Assume roundrobin path scheduler type within a group of mpath(4) paths now (sym(4) devices work around this by putting every path in its own group).
When pmap(9) flushes page from all caches, writeback on all CPUs. Fixes spurious m88k segmentation faults.
Updated xterm(1) to version 296 (with sixel graphics disabled for now), DejaVu Fonts to 2.34 and libX11 to 1.6.1.
Simplified xvctl(1), a utility to get or set Xv(3) extension values.
Replaced rand(3)/random(3) calls with secure arc4random(9) in npppd(8)'s radius authentication, make(1) and route6d(8).
Implemented handling of group failover in mpath(4).
New slowcgi(8) option to specify an alternate FastCGI socket on which to listen.
Introduced the idea of groups of paths to mpath(4). Only paths on the first group in the list will handle io now.
Adjust startup sequence so mpath(4) attaches before other hardware.
Make ommmc interrupts show up in vmstat(8) -i, systat(1), etc on beagle.
Updated to pixman 0.30.2.
Allocate and deallocate memory for encryption contexts within cryptosoft. Removes the need for zerokey functions.
Make disklabel(8) partitions from "i" to "p" functional on luna88k.
Initialise loongson pcimap earlier, to make sure its value is not tested before initialisation (only affects 2e systems).
Fixed usage of fork(2) in programs linked against libpthread on m88k 88100 processors, where the parent thread would spin.
Updated to Xserver(1) version 1.14.2.
Replaced random(3) with arc4random(9) in libevent.
Fixed minor discrepancies with ix(4) link state handling.
Stopped oce(4) and ix(4) calling if_link_state_change if link state is not changed.
Fix memory initialisation for octeons that have less than 256MB.
Stir PRNG after sshd(8) runs post-accept fork. The child gets a different PRNG state anyway via rexec and explicit privsep reseeds, but it's good to be sure.
Do not let netstart(8) create a route to alias addresses via 127.0.0.1 (the stack is able to tell if the address is local or not).
Correct format string mismatches in various code turned up by gcc(1) -Wformat=2.
Added acpi(4) indicator sensor to acpibtnX, to reflect lid status when available. Useful for people not using machdep.lidsuspend.
With wsdisplay(4), use the console locator to make sure wsdisplay0 is always the glass console on i386/amd64.
Use int64_t in the spamdb(8) greylist db file, with backwards compatibility for records with 32-bit times.
Fixed build of ix(4) without vlan.
Added urtwn(4) to the sgi kernels where it makes sense.
Added nc(1) -F flag to enabled fd-pass mode: establish connection and pass connected socket to stdout.
Remove uscanner(4). Disabled in GENERIC long ago (when libusb became the preferred solution for USB scanners).
Enabled mpii(4) on sparc64.
Added ssh_config(5) ProxyUseFDPass option, to establish a connection and then pass file descriptor back to ssh(1).
Make pf(4) "match quick" abort ruleset evaluation with the current block/pass state, rather than continuing on.
Fixed kernel profiling on powerpc architectures (broken since the buffers were made per-cpu).
Fixed prototypes of do_load_half() and do_load_byte() on m88k to stop obscure bugs in awk(1) and elsewhere.
Disable appleagp(4). It doesn't really work yet, and hurts certain iBook G3 models (PowerMac4,3).
Fixed xf86-video-ati shadowfb on big-endian machines.
Updated to: xload 1.1.2, xprop 1.2.2, xset 1.2.3, libXfont 1.4.6 and xwd 1.0.6.
Stop dhclient(8) creating a route to the bound address via 127.0.0.1, as the stack should be able to correctly short-circuit packet routing to local addresses without this.
Make the vgafb(4) console correctly restore when exiting X(7).
Stopped macppc pretending to support non-console devices, because vgafb(4) only matches the framebuffer device setup by the firmware.
Use %lld and cast to long long when passwd(1) is printing time_t values, and atoll(3) when parsing them.
For ikectl(8), snmpctl(8) and rdate(8) use %lld and cast to long long when printing time_t values.
Enabled radeondrm(4) on macppc.
Use mapiodev to do the initial mapping of vgafb(4). Allows radeondrm(4) to bus_space_map(9) it without panicking.
Updated to xf86-video-ati 7.2.0. Fixes endianess problem with kms.
Avoid integer overflow in sector calculation reading UDF DVDs, which broke reads past 2GB.
On luna88k, check number of planes (1, 4, or 8bpp) in framebuffer by ourselves (PROM gives false values). Lets monochrome X(7) server work correctly with a 4bpp framebuffer.
Enabled radeondrm(4) on sparc64.
Align stack yp(8) buffers to 64-bit boundaries now, for they might contain a struct passwd(5).
Blast uhts(4), as the code was merged into ums(4) last week.
Stop defining SIOC{S,G}ETVLAN as SIOC{S,G}IFGENERIC. Lets vlan(4) handle pppoe(4)-specific ioctls and vice versa without smashing the stack of the caller.
Make sure "drm.h" gets generated on all architectures that support pci(4), making alpha and loongson compile again.
Set bgpd.conf(5) to filter the IPv6 Discard-Only prefix, because it should not be globally routable (see RFC6666).
Rewrite the internals of the bgpd(8) RDE reload logic. First step to make reload non-blocking. Speeds up the reload time, should also fix a few edge cases on reloads.
Enforce that the ls_id and the adv_rtr field in a type 1 router LSA are the same. This will drop updates trying to attack the ospfd(8) LSDB.
Only skip dhclient(8) address deleting/adding and route deleting/adding on identical lease when we are in state S_RENEWING. Makes sure we end up with an IP address on the interface.
Don't depend on a list of archs to determine endianess, unbreaks X(7) gallium build on sparc64.
Let fw_update(1) handle firmware for radeondrm(4).
Allow the user to specify which firmware to install with fw_update(1), or to install all of them using the -a switch.
Updated iceauth to 1.0.6 and xfwp to 1.0.3.
Let the Xserver(1) handle more /dev/drmN devices.
Improved pci(4)'s VGA arbiter support now the kernel can give us information about the resources required by a particular device.
Moved ray(4) to the attic.
When handling puts from a client, tftpd(8) will now close the file once downloaded, instead of waiting until after we clean up the client .
Remove bogus refcounting of usb(4) pipes, to avoid memory leaks and potentially aborting a pipe when requests are still pending.
Made the tree compile again on architectures without drm(4).
Switch time_t, ino_t, clock_t, and struct kevent's ident and data members to 64bit types; build perl(1) with -DBIG_TIME.
Add the tcp(4) socket option TCP_NOPUSH to delay sending the stream. Useful to aggregate data in the kernel from multiple sources, avoids sending small packets.
ps(1) flags are split between thread and process but it is useful for ddb(4) to show both. Show both in ps overview, list them explicitly for the specific thread.
Match macppc framebuffer device against its OpenFirmware node, to enable sharing of console detection logic with sparc64 in radeondrm(4).
Build mesa radeon(4) drivers on sparc64; switch to gallium drivers for r300 and r600.
Enabled xf86-video-ati kernel modesetting support.
Added TTM and radeon(4) DRM code. Includes kernel modesetting, framebuffer console and support for newer hardware.
Fixes for as(1) on mvme88k: provide 88110 syntactic sugar for the control register names; correctly handle -m options; allow the register prefix to correctly be recognised in front of the condition codes.
Cancel timeouts on pflow(4) interface destruction.
Plugged file descriptor and memory leak in fuse(4)'s fuse_open() error path.
Fixed a potential race on luna88k, where a secondary cpu incorrectly resets variables on the primary cpu.
Merged uhts(1) into ums(1).
Added rc.d(8) scripts for ipropd-master and ipropd-slave.
Added urtwn(4) for upgrades to macppc ramdisk.
Enabled ctrl-left-arrow and ctrl-right-arrow to move forward/back a word in ssh(1); matching ksh(1)'s recent change.
Do getopt parsing for all sftp(1) commands, to ensure consistent behaviour.
Implemented the roff(7) font-escape sequence \f(BI "bold+italic".
Made it possible for graphics drivers to opt-out of VGA arbitration.
Neither the flow control diff nor the RX checksum offload diff is responsible for gem(4) hangs, so put them back.
Bugfix update to nginx(8) version 1.4.2.
Build libdrm_radeon on sparc64.
Create drm(4) device nodes on sparc64 and create additional entries on amd64/i386/macppc for running with multiple cards.
Fixed sftp(1) regression: symlinking a file would incorrectly canonicalise the target path (bz#2129).
Disabled libexec/identd and enable usr.sbin/identd(8).
After a panic(9), do not fill up the dmesg(8) with splassert messages. They scroll away the important information.
Another major overhaul of the inteldrm(4) GEM code.
Make sure states learnt via pfsync(4) from a peer with the same ruleset checksum get properly assigned to rules.
Stopped gcc(1) warning on missing newline at EOF. Matches the behaviour of gcc >= 4.3 and clang.
Moved check in mktemp(1) for template length, so error message is also shown in the -t case instead of EINVAL.
Make user(8) write UIDs/GIDs as unsigned in the passwd file and error messages. Matches what pw_scan(3) expects.
Switched vax to gcc(1) version 3.3.6; removed gcc(1) version 2.95 from the tree.
Fixed mandoc(1) bug by reverting r1.10 of term.c: after a leading blank on an output line, don't generate a premature line break.
Updated ix(4) to the Intel/FreeBSD current version. Brings support for the flow control and additional (untested) bits for 1G fibre versions.
Enabled MSI on re(4) RT810xE.
Unbreak PMTU-discovery for ipsec(4) AES-GCM.
Don't flush the cache on page inflate for hibernate on amd64 for faster resume on some machines.
Fixed corner cases in the implementation of pow(3) to make it compatible with C99.
Implement if_nametoindex(3) and if_indextoname(3) for pfctl(8). 20x speedup factor with some complex rulesets.
Create more inodes on the sparc64 installation ramdisk. Prevents problems during install/upgrade when files or nodes need to be added.
Added ral(4) support for the Ralink RT3060, which uses the RT3572 MAC/BBP.
Remove the sysmerge(8) glue from the installer (it has never been used and is being replaced).
--------
Changes made between OpenBSD 5.3 and 5.4
Let the X(7) server build on hp300 again.
Stopped awk(1) sporadically exiting early (blaming a spurious "}" in the first few lines of input) on m88k 88100-based systems.
Let mkuboot(8) recognise native ELF binaries, only output the program headers area when found. Saves the need for "objcopy -O binary"; makes beagle install/upgrade processes easier until it gets a native bootloader.
Revert wrong chunk introduced in zs.c r1.50, causing zs(4/sparc) console keyboards not to attach as console. Fixes non-wsmux kernels such as bsd.rd.
Make sure ftpd(8) tmpline[] is always NULL terminated, to avoid possible read-beyond-end in get_line().
Backout gem(4) flow control support (r1.97 of gem.c) and RX TCP/UDP checksum offload support (r1.98) to stop hangs on Sun ERI.
sftp(1) extended to allow support for resuming partial downloads.
Daemonise backgrounded ssh(1) (ControlPersist'ed) multiplexing master, so it is fully detached from its controlling terminal.
Do not reset the pf(4) fragment timeout each time a fragment arrives; drop all fragments if the packet cannot be reassembled within 60 seconds.
We now have IDEA and MDC2 in crypto(3), so no longer disable them in openssl(1).
Fixed sockaddr overflow with IPv6 in smtpd(8).
When installing a new system, stop adding static entries to /etc/hosts for dynamic ip addresses.
Fixed umount(8) -a in cases where there are multiple file systems specified for the same mount point.
Updated to: xconsole 1.0.6, xrandr 1.4.1, xhost 1.0.6, mkfontscale 1.1.1, xfd 1.1.2 and xfontsel 1.0.5.
Added cu(1) support for XMODEM-CRC, and fix transfer initiation.
Sum consecutive dx and dy motion events in xf86-input-ws before sending them up to X(7). Reduces staircase effects on diagonal freehand drawings.
Updated smtpd(8) ldap and sqlite table backends and provide them as external backends.
Call ssh-agent(1) cleanup_handler on SIGINT when in debug mode, so sockets are cleaned up on manual exit (bz#2120).
More useful ssh-keygen(1) and ssh(1) error message on missing current user in /etc/passwd.
When smtpd(8) is accepting a message, log one line per recipient with the number of generated envelopes for each.
smtpd(8) MTA improvements: better transient error handling logic (failing destinations automatically disabled for a while); more informative error report when all routes fail for a message; implemented smtpctl(8) "show hoststats" command to get the latest stat message per MX domain; implemented smtpctl(8) "show routes" command to show the state the currently known routes to remote MXs; implemented smtpctl(8) "resume route" command to re-enable a route that has been disabled; do not hardcode limits.
smtpd(8) queue improvements: cleanup the internal queue backend API; implement a queue_proc backend; enabled support for queue encryption; added an envelope cache; better logging and error reporting.
Allow smtpd.conf(5) to specify an address family on a listener.
smtpd(8) scheduler improvements: implemented suspend/resume scheduling for individual envelopes or message, with the associated smtpctl(8) commands; allow the mta to request immediate scheduling of an envelope; on temporary failures a penalty can be given to further delay the next try.
New implementation for smtpctl(8) and its command line parser.
Implemented tls "perfect forward secrecy" with ECDHE in smtpd(8).
Allow "!" in the smtpd(8) email addresses supported charset.
Introduced expand-string modifiers to smtpd.conf(5).
Extended ssh-agent(1) support to allows encrypted hostkeys, or hostkeys on smartcards on sshd(8) (bz #1974).
Reverted r1.191 and r1.193 of sysctl.c, and properly fixed sysctl(8)'s access to ext2 filesystems.
Corrected sysctl(8) being off-by-one in naming of nodes below vfs.mounts.
In ssh(1) man page, be more exact with respect to permissions for ~/.ssh/config (bz#2078).
Implemented identd(8) -H, which hides existing and non-existent users (as well as implying -h).
Fixed bgpd(8) counting the number of prefixes wrongly (tripling max-prefix).
Disabled httpd(8) SSL compression, in order to mitigate CRIME attacks.
Enabled ECDHE support in httpd(8) via a SSLECDHCurve option.
Define httpd(8) HonorCipherOrder as a FLAG so that it works correctly as a boolean on/off flag.
Make sure the ioctl(2) has been processed by sppp(4) before printing any ifconfig(8) phase error. Prevents ifconfig(8) from printing "sppp: phase..." messages for long-name vlan(4) interfaces.
Correctly initialise pms(4) width value to 0 instead of passing garbage to wsmouse_input() when no finger is reported.
Restore ifb(4/sparc64) textmode acceleration on Expert3D{,-Lite} and XVR-1200. Broken since r1.17 of ifb.c.
When ucom(4) is detached, free its pipes, close attached tty before freeing its descriptor. Fixes panic introduced in r1.59 of ucom.c.
Added monochrome Xserver(1) support for luna88k.
Added some missing asm functions to vax.
To prevent lock ordering problems with the sparc64 kernel lock, block all interrupts that can grab the kernel lock.
Fixed possible memory/file descriptor leak in ldd(1) error path.
When using man.conf(5) _default search path with _subdir, first sort by manual section (1, 8, 6...), then by manual tree (share, X11R6, local), only for ties prefer cat over man.
Make tmux(1) next-word-end work properly with vi(1) keys.
Set TCP nodelay for ssh(1) connections started with -N (bz#2124).
ssh-keygen(1) do_print_resource_record() can't be called with NULL filename, don't attempt asking for one if it has not been specified (bz#2127).
Avoid confusing ssh(1) error message in some broken resolver cases (bz#2122).
Introduced httpd(8) HonorCipherOrder to use the server's order of preference of ciphers.
sk(4) now works on macppc, should work on sparc64 too.
bgpd(8) SE now always messages the RDE when a peer comes up or when a reload happens, so the RDE should end up with correct values.
Backed out the virtual file system cache flipper temporarily.
Added basic support for digitisers with pens in uhts(4).
Added support for mouse based group {,r}cycle to cwmrc(5).
Replaced a few (x)malloc with (x)calloc to prevent potential integer overflows in cwm(1).
Updated drm(4)'s libdrm to 2.4.46.
Old make(1) option "-P" removed, it has not been doing anything for years.
Use the write-only rasops(9) code to speed up the console framebuffer on macppc.
Create more com(4) entries by default since puc(4)s are now guaranteed to show up at com4 or higher on x86.
Advertise utpms(4) as being a WSMOUSE_TYPE_USB so ws(4) can use the touchpad directly. Makes some touchpads usable if the bluetooth HID mouse is not detected or ums(4) is disabled.
Vax elf(5) toolchain added, using "%" as the register prefix.
Taught mopd(8) and mopa.out about ELF files. Allows forthcoming vax elf(5) boot blocks to be converted to working mop binaries.
Avoid truncation when calculating clock gain/loss on sparc and sparc64.
When the tmux(1) session option renumber-window is used, make sure the winlink lists stay in sync with one another.
Act like vi(1) when tmux(1) is moving words; clarify error messages when setting options.
Implemented tmux(1) s, S, C mode switch commands for when in vi(1) mode.
Made pfctl(8) collect and display "match" counters for pf(4) tables; fixed pf(4) table displays to fit within 80 chars.
Added support for fuse_teardown(3). This function is needed by zipfs.
Correctly abort and free the pipe when detaching the umodem(4) device.
Brought the cpsw(4/beagle) driver to a working state.
Added support for the gcc(1) binary integer constants extension.
Pass ioctl(2) calls to parent uhidev(4) device first, to be able to get the HID descriptor with usbhidctl(1) -r, among others.
Disabled intel(4) i915 fast scrolling code, use write-only rasops(9) code instead on older chips. Avoids random page table errors.
Make ksh(1) $(< /nonexistent) have the same behaviour as $(cat /nonexistent) with respect to errors.
Tweaked regexp so that RUSAGE_CHILDREN will be matched and displayed by kdump(1).
Stop man(1) adding an "-s" switch if user had specified more(1) as (MAN)PAGER.
Reverted previous xf86-video-ati commit, loading the dri driver caused Xorg(1) to crash with r700 (PCI HD4350).
When an I/O error occurs on a softraid(4) chunk, only take it offline if the discipline supports redundancy.
Switched bgplgsh(8) to use use the libedit readline compatibility headers.
Linked sqlite3(1) against libedit; added an empty history.h header for compatibility with GNU readline.
Added a luna88k-specific function to initialise the instruction cmmu SAPR register.
Build xf86-video-ati with support for kernel mode setting. UMS will still be used if KMS is not available.
Added basic EXA acceleration for the xf86-video-cirrus alpine chipset.
Fixed NULL pixmaps with xf86-video-sis server.
Added support for write-only framebuffers to rasops(9). Can be a considerable performance win.
Enabled msi and tagged status for bge(4) 5717+. Fixes poor transmit performance in the beginning of a TCP connection.
Rewritten sis(4) media / link state handling.
Adjust interrupts on amd64 after recent audio interrupt changes. Should improve latency of audio interrupts a tiny bit.
ukbd(4) will now flash LED only if safe. Stops some logitech mice disconnecting right after being attached.
Use vt05 as default for xdm(1) on macppc now that virtual consoles are supported.
Removed the setgid(2) on kmem(4/i386) for the time being, so procmap(1) works again for regular users.
Repaired bge(4) flow control (broken in r1.329), make sure that ifconfig(8) won't alter our negotiated flow control settings.
Bring ohci(4) and uhci(4) in sync with ehci(4) by ensuring that a transfer is submitted when a zero-length bulk or interrupt transfer is requested.
When we remove work from the nfsd(8) queue, wake up anything waiting for room to queue IO right away.
Restart the vinvalbuf(9) if we have to wait for a busy buffer to complete.
Reverted r1.20 of sys/net/if_pppx.c, to make sure the newly created address is added to the global list, until the issue with carp(4) is addressed.
Added a tmux(1) server option to control focus events. Defaults to off.
Made tmux(1) always push a focus event when the application turns it on.
Mark tmux(1) control commands specially so the client can identify them.
Reverted sys/netinet/in.c r1.78 for now, it breaks ipv4 on carp.
Updated to libXv 1.0.9.
Enable native encoding on on mavb(4/sgi) (24-bit lsb-aligned). Allows encoding conversions to be handled in userland.
Default to stdin/stdout if no input files are given to indent(1).
For ssh(1) hostbased authentication, print the client host and user on the auth success/failure line (bz#2064).
Improved mandoc(1) handling of the roff(7) "\t" escape sequence.
Updated to libdrm 2.4.45.
Added ut/nut flags to indent(1) to enable/disable tabs.
When cwm(1) selfont is configured, make sure we continue and configure the rest of the screen.
Disabled nginx(8) SPDY until we have a better understanding about code and protocol within OpenBSD.
Initialise disklabel(8) duid memory before shifting stuff into elements of it.
Make sure the target directory gets created by lex(1) in the includes target; add a trailing / as well to avoid problems.
Stopped dhclient(8) from printing some stings twice (eg "1.2.3.4, not 1.2.3.4, deleted from ...").
Before pulling TCP options from the mbuf onto the stack, do an additional length check in pf(4) so overflow cannot happen.
Updated kerberos(8) to heimdal 1.5.2.
Handle time_t values as long long's when scp(1) and rcp(1) are formatting them, or parsing them from remote servers.
Allow mouse button4 and button5 in cwmrc(5).
Improved locale(1) output formatting.
Move mg(1) cursor upwards past multiple lines with no characters, instead of stopping when first line with no characters is found.
Run any pending traps before calling the EXIT or ERR traps when ksh(1) -e is set. Fixes bug where signal trap would not be run if (eg) ^C was pressed and -e was set.
Hooked up locale(1) to the build.
Updated the beagle ramdisk to support usb.
Reworked beagle's ehci(4) driver, enabling the clocks. Only pandaboard supported for now.
Updated to: libXrender 0.9.8 and libXvMC 1.0.8
Disabled broken EXA operations in xf86-video-mga; default to EXA acceleration.
Added support for fuse_version(3) and fuse_get_context(3). Needed by ntfs-3g port.
Updated nginx(8) internal pcre library to 8.33.
Corrected interrupt moderation setting for ix(4) 82598.
Fixed loading the driver without XAA and initialisation of shadowfb with modern X servers in xf86-video-trident, xf86-video-i740 and xf86-video-neomagic.
Added support for protected-subnet config types to iked(8).
5.3 RELIABILITY FIX: Two flaws in vio(4) may cause a kernel panic, and may cause IPv6 neighbour discovery to fail.
A source code patch is available for 5.3.
Updated to sendmail-8.14.7.
5.3 RELIABILITY FIX: inability to oack would cause tftpd(8) to segfault
A source code patch is available for 5.3.
Stopped tmux(1) emitting annoying beeps if a machine was shutdown while tmux is running and you then focus in/out of an xterm.
High memory page flipping for the buffer cache. Allows use of large buffer caches on amd64 with > 4 GB of memory.
Activated the sitaracm driver (beaglebone only).
Optimised memcpy(9) on amd64, alpha, i386, vax, sh, sparc, hppa and hppa64 by always doing forward copy; made memcpy(9) use the forward copy branch of memmove(9); implemented bcopy(9) by swapping its arguments and dropping into memmove(9).
POSIX specifies that for an AND/OR list, only the last command's exit status matters for "set -e". Revert ksh(1) to follow this.
On mach64, only disable xf86-video-mach64 RenderAccel, not the full EXA acceleration. This is enough to fix screen corruption.
Made cwm(1) check for, and honour, CWStackMode and CWSibling change requests during a ConfigureRequest event.
Unbreak the xf86-video-sunffb driver.
Fixes for integer overflows in XF86DRIOpenConnection() and XF86DRIGetClientDriverName() (CVE-2013-1993).
Reverted ssh(1) revision 1.203 of readconf.c while crashes are investigated.
Fixed dhclient(8) populating egress group.
Updated to sqlite3(1) and its shell to version 3.7.17.
Some archs are missing memmove(3), added it to i386, sparc and sparc64.
Backout dhclient(8) static/classless route handling and default route refactoring, which broke "egress" group populating.
Fix libc parsing of ambiguous options so the whole loop is processed.
Add new sysctl(8) for pipex packet input/output queue length and counters.
Added proper mmap(2) support for drm(4)/inteldrm(4). Eventual speedups (through not accessing all graphics memory via the GTT).
Disabled EXA acceleration in the xf86-video-mach64 driver, which is currently broken.
Updated to: pixman 0.30.0; freetype 2.4.12; Xserver 1.14.1.
Add ssh(1) "ABANDONED" channel state; use for mux sessions that are disconnected via the ~. escape sequence (bz#1917).
Disable a broken optimisation in try_combine(); gcc(1) PR #34628. Fixes bogus code generation on macppc.
Added the remaining support code for 4th gen intel(4) Core/Haswell graphics.
Prevent idle thread from being stolen on startup.
Fixed re_format(7) so [[:>:]] anchors the character preceding it to end of word, not the character following it.
Initial port of the cpsw(4/beagle) driver, to support ethernet on the beaglebone.
Fixed ssh(1) memory leaks (bz#1967 and bz#1967).
Fixed a crypto(9) bug that caused time-based rekeys to happen too frequently.
When running sshd(8) -D, close stderr unless we have explicitly requesting logging to stderr (bz#1976).
The kernel will now keep a record of recently exit(3)'ed pids, so they don't get recycled too quickly.
Support added for the presto(4/sparc) SS10/SS20 NVSIMM as block devices.
Added dhclient(8) support for static routes option (33) and classless static routes option (121).
Prevent failures when sftp(1) is linked against a libedit built with wide character support (bz#1990).
Disable parity on the alpha pci(4) bus to avoid data parity errors. To help Alphabooks, as well as early Multia.
Use MAXPATHLEN for ssh(1) buffer size, instead of fixed value.
Implemented pf(4) divert-to and divert-reply for IPv6 raw sockets.
Prevent panic on alpha if "ifconfig(8) up" is run on an unplugged de(4) interface.
Added login_yubikey(8) handling for keyboard layouts which break modhex (eg dvorak); added keymap table.
Do not feed UTF-8 input into mandoc(1) or nroff(1), because that results in corrupt output.
Fix dhclient(8) "\" escape handling in read_string().
Updated to libX11 1.6.0.
Introduced the ldpctl(8) "show discovery" command.
Sped up the ldpd(8) session establishment process.
Do not allow ldpd(8) TCP connection to associate with any neighbour/adjacency before an "Initialization" message is received.
Added support for macppc virtual consoles, based on previous work done for inteldrm(4).
Implemented ldpd(8) support for adjacencies and targeted "hellos"; allow more complex topologies with targeted sessions.
Properly implement the exponential backoff timer on ldpd(8) session initialisation, to match section 2.5.3 of RFC 5036.
Notify the lde process when an ldpd(8) neighbour is deleted (discovery timeout).
5.2 and 5.3 RELIABILITY FIX: With HTTP keepalive, relayd(8) only filtered the first request and switched to pass-through mode for subsequent requests from the client. Make sure to stay in HTTP header mode.
Stopped npppd(8) doing pipex(4) ioctl if no tunnel interface is configured.
Don't add newly created thread to the process's thread list until it's fully built, so that it can't get a signal from realitexpire().
Only produce UTF-8 output when using perl(1) if the user's locale asks for it.
Fixed potential vmx(4) panic if an mbuf was replaced but new one not returned by vmxnet3_load_mbuf().
Add bcrypt_pbkdf(3), a password based key derivation function (using a bcrypt(3) variant better suited for use as a pluggable hash).
Reworked logic for matching macppc boot device, to allow for root on any drive attached to the first controller.
Fixed ksh(1): "for var in; do ..." shouldn't be interpreted as "for var; do ...". Brings ksh(1) more in line with POSIX.
Backported unique commitid support to cvs(1) (with a new random id generator).
Fixed bug in ldpd(8) so the fib-update directive accepts "no" as an option.
pf(4) divert-reply states where the initial SYN does not get an answer, can now be handled more correctly.
Advertise the ldpd(8) implicit-null label for routes attached to loopback interfaces to guarantee PHP.
Implement ldpd(8) support for multiple addresses per interface.
Fixed a pf(4) regression introduced with pf.c 1.827, allowing us to create icmp(4) states again.
Stop a ucom(4) panic when trying to open a non-connected serial; more checks to avoid races when the driver is being detached.
Added userland fuse(3) library.
Fixes possible timeout on ssl(8) sessions if there is data pending in the smtpd(8) ssl buffer.
Added ":" to the ksh(1) list of special characters.
Added locale(1) utility, to check the current locale configuration and provides a list of locales supported by the system.
Perform more aggressive compile-time optimisations in ethernet code path. Significant performance improvements on busy firewalls.
Added dired-revert, to refresh the mg(1) dired buffer.
-I option added to confirm pkill(1) process-by-process.
Fixed "anchor quick" with pf(4) nested anchors (previously quick flag was lost as soon as we stepped into a child anchor).
Force ssh(1) MAC output to be 64-bit aligned, so umac won't see unaligned accesses on strict-alignment architectures (bz#2101).
Updated to xterm 293.
Updated to xf86-input-synaptics 1.7.1.
Let mandoc(1) .Do .Dq .Ql .So .Sq generate the correct roff(7) character escape sequences such that output modes like -Tutf8 have a chance to select nice glyphs.
Fixed a bug where the calibration loop could show wrong CPU frequencies on i386/amd64.
Fixed relayd(8) so it filters all HTTP keepalives, not just the first.
Fixed wcstof(3), wcstod(3), wcstold(3) C99 compliance to: handle "inf", "infinity", "nan", and "nan(whatever)"; reject bare minus and plus signs; handle multi-byte characters; and set *endptr = nptr for all failure cases.
Exclude mac address for the HMAC calculation if lladdr is the real one, so that we can use the real MAC address for carp(4).
Make tmux(1) escape "Ss", because groff(1) thinks it has found a macro.
Moved bgplg(8) and slowcgi(8) sockets to /var/www/run.
Made ssh(1) parent_alive_interval time_t (to avoid signed/unsigned comparison).
Fixed kadmin(8) race.
Added the "quit-window" dired command to mg(1).
Rename the mg(1) dired-* commands to be like the emacs equivalents.
Correct wrongly exchanged labels in trek(6) "computer warpcost" output.
While lock is held, block all interrupts that can grab the kernel lock on amd64. Prevents lock ordering problems.
Fixed an xinstall race condition, where multiple install -d's trying to create overlapping paths in parallel could error out.
Fixed acpi(4) panic on Lanner FW-8758.
Partially back out new librthread ticket locks code, until heavier CPU usage issues are resolved.
Stop printing acpi(4) wakeup devices in dmesg(8) after the 16th wakeup device, to workaround vmware reporting hundreds of wakeup devices.
Update sftp(1) progress meter when data is acked, not when it's sent (bz#2108).
Fix catopen(3) for UTF-8 locales and update the implementation to POSIX-2008. catopen(3) now chooses a catalog which matches the locale's encoding, if available.
Librthread now features a new spinlock (that is really a ticket lock).
Stopped mtree(8) generating arbitrary directories in /usr/share/locale.
Changed the naming scheme used for directories in /usr/share/locale to eliminate redundant copies of LC_CTYPE files.
Restart the ldpd(8) keepalive timer whenever a LDP PDU is sent.
Updated to xf86-video-sunffb 1.2.2.
Don't try to send a Shutdown message if ldpd(8) connection is already closed or a read error occurred; as per RFC 5036, send a "Shutdown" message if an unexpected message is received during the initialisation process; check if the whole LSR ID of received messages is correct; ignore messages from the process whose associated neighbour is not in the operational state.
Dropped support for per-interface ldpd(8) labelspaces.
Don't allow enabling ldpd(8) on loopback and carp(4) interfaces. LDP should be allowed only on physical or tunnel interfaces.
Removed mg(1) "lint" mode.
Correctly initialise the number of cores/cpus on an octeon board, so bsd.mp boots up on the ERL.
Pass the routing domain to IPv6 pr_ctlinput() like in IPv4 for icmp6(4).
Updated to nginx(8) version 1.4.1; enable the SPDY module by default.
Fixed race between exit(3) and fork1(9) with threaded processes.
Make hostaliases work for gethostbyname(3) and getaddrinfo(3) when looking into /etc/hosts.
Made mg(1) "kill-paragraph" behave like emacs.
Use a standard locale name in mandoc(1), "UTF-8" is an ugly non-standard alias that doesn't work on OpenBSD.
Updated to libXrandr 1.4.1 and libXv 1.0.8.
Hooked up slowcgi(8) to the tree.
Use clock_gettime(2) CLOCK_MONOTONIC for ssh(1) timers so keepalives/rekeying will work properly over clock steps.
Introduced ltrace(1). Works with ld.so to inject utrace(2) record for each plt call. Minimal filtering capabilities are provided.
Added utrace(2), a system call allowing for userland to send its own ktrace(2) records.
Adjusted mg(1) M-} (forward-paragraph) to behave like emacs.
Return ROFF_TBL as soon as we open a mandoc(1) data cell, as it may never get properly closed but instead be interrupted by .TE.
Don't set the Message ID for ldpd(8) "hello" messages, to match Cisco IOS.
Always advertise the Router-ID as the transport address in ldpd(8) "hello" messages, as per RFC 5036, section 2.5.2.
Added support for advertising route information (RFC 4191) to rtadvd(8) and icmp6(4).
Fixed regression with BGP MPLS VPNs that got broken by recent reload related bgpd(8) commits.
Fixed the build for a kernel without wd(4) and pciide(4) in its config(8).
Updated to: libX11 1.5.99.902 (aka 1.6rc2); xfs 1.1.3; xinit 1.3.2 and libXext 1.3.2.
Added getprogname(3) and setprogname(3), useful for some ports(7).
Added the vmx(4) driver for vmware's VMXNET3 ethernet controller.
Correct the range checks in ifconfig(8) properly for vhid, advbase and advskew.
Stopped ping6(8) truncating trailing zeros from the round-trip times.
Added tmux(1) host_short format.
Updated to: appres 1.0.4; xrefresh 1.0.5; xwininfo 1.1.3; xdpyinfo 1.3.1 and bitmap 1.0.7.
nginx(8) now also listens on IPv6 by default.
Rename tpms(4), the driver for Apple USB touchpads, to utpms(4) because it is also used on some intel-based mac laptops.
Added elantech v4 (clickpad) support to pms(4).
Inform the mg(1) user about beginning / end of buffer in "previous-line" and "next-line".
Make the system bell toggle-able via mg(1) "audible-bell", and if switched off, make available an alternative "visible-bell".
Enabled Realtek 8211C(L) GbE phy with axe(4).
Updated to: libFS 1.0.5; libxcb 1.9.1; libXau 1.0.8; libXcursor 1.1.14; libXfixes 5.0.1; libXi 1.6.3rc1; libXinerama 1.1.3; libXres 1.0.7; libXt 1.1.4; libXtst 1.2.2; libXxf86dga 1.1.4; libXxf86vm 1.1.3; libdmx 1.1.3 and libfontenc 1.1.2.
Accommodate bge(4) E5/C600 and 5719/5720 PCI-E maximum payload size handling. Fixes RX path on 5719.
Switched ldpd(8) to use a non-blocking connection so other LDP sessions and ldpctl(8) remain responsive.
Stopped tmux(1) mangling top-bit-set characters when they passed to window_pane_key.
Fixed use after free in case the vio(4) mbuf needs defragmentation, to fix a panic.
When removing "dump (all|updates)" from bgpd.conf(5) and reloading, tell the session engine to actually stop logging.
Export the original (aka untranslated) address in pflow(4), and also in the "af-to" case.
Support relayd(8) SSL inspection, the ability to transparently filter in SSL/TLS connections (eg. HTTPS) by using a local CA that is accepted by the clients.
Fixed bug in amd64 hibernate code (introduced when we moved the kernel to load at 16MB physical address).
Change HTTP/1.x in the generated relayd(8) error messages, to HTTP/1.0. Required by Safari; makes it RFC-compliant.
setsockopt(2) to see ifstated(8) messages for interfaces in all routing domains again, instead of just the primary one.
Tied mkuboot utility into the build.
Fixed ls(1) column padding of inode numbers and block counts >2^32, as well as display of directory block totals >2^32.
Fixed bug when starting ldpd(8) with a configured interface in the down state so it is not promoted to ACTIVE.
Fixed pci_min_powerstate() to return the current power state (not D3) if ACPI is not compiled in.
Stop ldpd(8) trying to send hello messages if the interface is down.
Simplified ldpd(8) hello holdtime calculation and stop the timeout timer if the holdtime is "infinite".
Improve ldpd(8) sanity checks on received UDP messages: "PDU Length" now checked against what RFC 5036, section 3.1 specifies.
ldpd(8) no longer uses a carp address as ldp router id because it is not unique.
Do not allow SIOCSIFADDR on AF_INET6 sockets. Avoids possible local denial of service.
5.2 and 5.3 RELIABILITY FIX: Do not allow SIOCSIFADDR on AF_INET6 sockets. Avoids possible local denial of service.
A source code patch is available for 5.2 and 5.3.
Build fixed for sis (SiS and XGI video) driver under xserver 1.14.
Make mkuboot install into the path so we can use it during builds.
Updated inputproto to 2.3.
Send correct ttl on outgoing bgpd(8) packets, so peer sessions can come up correctly if both sides use ttl-security.
Removed make(1) cmtime again, but with a proper test for nodes without children.
mandoc(1) now rejects non-printable characters found in the input stream, even when preceded by a backslash.
pkg-config(1) error message for empty files now display the full path, in case the file exists in multiple locations.
Make the mg(1) dired commands dired-flag-file-deleted, dired-backup-unflag and dired-unflag behave more like emacs when the cursor stays on the first character of the file name.
Disabled bge(4) PHY auto-polling mode on anything newer than BCM5705. Fixes uplink negotiation on BCM5719.
In mandoc(1) SYNOPSIS mode, fixed .Ek (it doesn't end a keep).
Allow pkg_add(1) installpath to use +=.
mg(1) dired mode commands "dired-copy-file", "dired-rename-file", "dired-create-directory" will now refresh the dired buffer.
Reset be(4/sparc), brgphy(4), dcphy(4), mlphy(4), rgephy(4) and urlphy(4) autonegotiation timer when PHY gets the link, so that if we restart the timer the mii_ticks value will be sane.
Correctly display rightmost tile when current resolution is not a multiple of the tile size in gbe(4/sgi) emulation (text) mode.
Added dired commands and dired-create-directory to function maps in mg(1).
Autodetect ipv6 addresses for route(8).
Added ":B" to the list of options actually handled in PkgCheck.pm by pkg_add(1).
Minimal support for MVME224 and MVME236 memory boards on mvme88k architecture; fixed MVME181 memory detection code.
When recreating a tun(4) interface, set the IFF_RUNNING flag after the IFF_LINK0 flag has been added.
Sync smtpd(8) with OpenSMTPD 5.3.2.
Since audio code is mp safe, establish isa(4) and pci(4) audio interrupts with the IPL_MPSAFE flag, so interrupt handlers don't need to wait for global kernel_lock.
Merge upstream fixes for several X(7) library vulnerabilities (integer overflows/buffer overflows/memory corruption).
Change ttys(5) console speed to 115200 on octeon.
Revert pms(4) Active PS/2 support for now, until solution found for pckbc(4) and gsckbc(4/hppa) chipsets that stopped working.
Simplified cwm(1) grabbing keys per screen (during init) and during a MappingNotify.
Put slowcgi(8) (a FastCGI to CGI wrapper) in, to work on it in-tree. Not hooked up to the build yet.
Properly implement acpi(4) access to IndexField() field units.
Allow auto-scaling encrypt(1) bcrypt rounds based on CPU power.
Set correct route priority in bgpd(8) send_rt6msg. Fixes v6 routes being added to the kernel as RTP_DEFAULT.
Shuffle mg(1) shell-command-on-region around to give shell-command.
Check validity of cwmrc(5) mousebind buttons during the parse phase, not when client needs to grab (when it's too late); load the default config if this is invalid.
Don't use BUS_DMA_WAITOK in the bge(4) bge_init path, since it might be called from a timeout(9).
make(1) changes: use arc4random_uniform(3) to randomise queue; display debug timestamp with -ns; use clock_gettime(2) directly.
Modified luna88k comkbd(4/sparc64) RAWKEY_XXX values, to input the right characters on Japanese keyboards.
Synced libedit with upstream to fix: buffer growing, memory allocation for wide chars, and to handle return of mbstowcs(3).
Fixed pty(4) descriptor leak occurring if fork(2) fails.
Added driver for the am335x timers, to be used by the beaglebone.
Fixed missing softraid(4) work unit state initialisations.
Eliminate the need to change the cwm(1) menu window on every Xft(3) font draw; added support for _NET_WM_STATE_MAXIMIZED_{HORZ,VERT}, _NET_ACTIVE_WINDOW ClientMessage and _NET_WM_STATE ClientMessage.
Make sure bgpd(8) addr.aid is actually available when first accessed.
Remove "abort_task" from usb(4) task queue before recycling the containing structure, to avoid ehci(4), ohci(4) or uhci(4) panic.
Switched cwm(1) border colours to Xft(3). If colour name allocation fails, revert back to default.
Support .Bl -offset in mandoc(1) -mdoc -Tman.
If pid<0, kill(2) no longer fails with EPERM unless none of the target processes could be signalled.
Switched mvme68k to the machine independent wdsc(4/sgi) driver.
Added more messages for when apmd(8) is entering suspend.
Make mg(1) cursor position when moving backwards by paragraph behave the same as emacs (move it to line above paragraph).
Fixed duplicate TouchBegin selection with virtual devices. Fixes gtk+3 applications crashing with "BadImplementation" error.
Don't try to start an ssh-agent(1) via xinit(1) or xsession if $SSH_AGENT_PID is already set.
Standardise logging of supplemental information during ssh(1) userauth, pushing all logging onto a single line.
Fixed failure to recognise ssh(1) cert-authority keys if a key of a different type appeared in authorized_keys before it.
/dev/ttyc is no longer special on sparc/sparc64 now that sun serial mice are handled by wsmouse(4); update ttys(5) and fbtab(5) accordingly.
Build and install libgcov on gcc(1) version 4 platforms. Makes gcc -fprofile-arcs work again.
On arm, make sure we executed an instruction before continuing to the next. Replaced calls to drain the write buffer with the correct ones for armv7.
Fixed the "right-of-cursor background color is inverted when we do delete-after-cursor" bug on luna88k wscons(4) console.
Preliminary support added for mvme88k MVME180 and MVME181 boards.
nginx(8) security fix for CVE-2013-2028 (see http://mailman.nginx.org/pipermail/nginx-announce/2013/000112.html).
Stopped binutils rejecting "++" and "--" in expressions, as some versions of gcc(1) emit these.
Don't leak usb(4) information to userland in the case where the actual transfer length is smaller than the requested one and the USBD_SHORT_XFER_OK flag is set.
5.3 RELIABILITY FIX: Do not attempt to delete the undeletable RNF_ROOT route(4). This fix stops a kernel panic.
A source code patch is available for 5.3. Matches the fix in -current.
wsmoused(8) support added to drm(4) Intel i915 driver.
nginx(8) security fix for CVE-2013-2070 (see http://thread.gmane.org/gmane.comp.security.oss.general/10173).
Implemented wsmoused(8) support based on the new multiple screen support in rasops(9).
If a directory exists when trying to create a new one, mg(1) will now warn the user.
Update "cur_time" after poll(2) returns on dhcpd(8), as poll(2) might have slept for an arbitrary amount of time.
Implemented mechanism to establish interrupt handlers that don't grab the kernel lock upon entry on i386/amd64.
Run audio interrupts without grabbing the kernel lock on sparc64.
Added the ability to ignore specific unrecognised ssh_config(5) options; bz#866.
Add an optional second argument to ssh(1) RekeyLimit and sshd_config(5) to allow rekeying based on elapsed time in addition to amount of traffic.
If an /etc/apm/* program fails, apmd(8) will now log the failure and error message.
Allow m88k and mvme88k to correctly printf(3) or panic(9) early on unrecognised systems.
Updated nginx(8) to 1.2.9; several bugfixes, security fix for CVE-2013-2070.
Don't let tmux(1) cursor position overflow when reflowing.
Introduced a global interrupt-aware mutex protecting data structures (including sound-card registers) from concurrent access by syscall(9) and interrupt code-paths.
Added support for intel(4) E7221 integrated graphics.
Pass the correct pointer to pool_put(9) if pf_state_key_attach fails.
Removed "swapin" and "swapout" from uvm(9) statistics (as we haven't swapped out of uvm(9) for a few years); don't display swapin/swapout uvmexp fields in systat(1), vmstat(8) or rpc.rstatd(8).
make(1) now keeps track of age of the youngest child process. Helps with out-of-date messages in -dm mode.
Stopped the line buffer being potentially accessed out of bounds when ^W (WERASE) is used in vi(1) insert mode.
pkg_add(1) PackingElement.pm samples should never alias specialfiles, so error out right away.
Added sparc64 support for running interrupt handlers without taking the kernel lock (via bus_intr_establish(9) interface). Used only by schizo(4/sparc64) for now.
Added an implementation of memmem(3).
Make sure the global IPv4 address list and the per-interface list remain in sync even when SIOCAIFADDR or SIOCSIFADDR ioctl(2) have not been issued.
Where we have a KMS driver (currently inteldrm(4) only) wsdisplay(4) now switches from X back to console screen upon entering ddb(4) .
In wsdisplay(4), make sure it really is the console before attempting to switch screens.
Handle big (a.k.a. >2TB) disks by adding logic to handle the 12 and 16 byte scsi read/write commands on sparc64.
Removed use after free the in case where the vio(4) mbuf needs defragmentation. Fixes a panic.
Make easier to stop taking the kernel lock when running "mp safe" interrupt handlers on i386/amd64/sparc64.
S-Records boot loader added to mvme88k. Allows kernel to be loaded from network, using either the on-board interface (on MVME187 and MVME197) or any MVME376; added MVME376 support to netboot.
Fixed sndiod(8) check for whether a midi port is referenced (which sometimes caused the port to be closed prematurely); use order specified by -q to order the exposed midi ports.
Swapped cwm(1) x/y calculations in kbd move/resize, to match those in the respective mouse functions.
Set trunk(4)'s MTU to that of the first trunkport. Allows trunk to work with jumbo/baby-jumbo frames.
Fixed dhclient(8) subnet check: check our rdomain against the rdomains of the other interfaces, not against our own.
Bail if device_lookup doesn't find anything, to bring vscsi(4) in line with other drivers.
Sync state key pointers with pf_state_key_attach values. Stops pfsync(4) inserting garbage addresses into packets when there is a state key collision.
Added support for future time_t and ino_t size enlargements to compat_linux(8).
Fixed memleak in ssh(1) cert_free(), which wasn't actually freeing the struct; bz#2096
Fixed ssh(1) bzero(ptr_to_struct, sizeof(ptr_to_struct)); bz#2100.
Do not panic when running the MP kernel on a single-processor mips64 systems.
Allow gdb(1) on m88k to fetch symbols from shared libraries when debugging dynamically linked binaries.
Added driver for the OMAP identification registers/fuses, so we can adjust the timer frequency per PandaBoard version.
Ported arm dma sync code (from NetBSD). Makes it easier to flush the secondary cache, as we always have the physical address.
Backported fix for gcc(1) PR target/31152 on arm: match the correct operand for optimised LT0 test; removed optimisation for GT.
Reset uthum(4) device on detach (required for planed usb device claiming).
Correctly compute packet size when including DNS search lists in rtadvd(8); fixed a comparison when building a packet with DNS search lists.
Fixed an uninitialised variable access in intel_ddi_prepare_link_retrain() in intel(4) i915 code (patched from upstream).
Fixed some leaks in mfi(4) error paths.
Re-commit uthum_activate() removal in uthum(4), now that uhidev(4) can handle it.
When a fork(2)'d child process (whose parent set SA_NOCLDWAIT or ignored SIGCHLD) is exiting, unconditionally wake parent instead of doing this only for the last child.
Prevent a chunked HTTP connection stalling relayd(8); use a 64 bit variable to allow (theoretical) large chunks.
Don't limit tmux(1) width and height to 222 in standard mouse mode.
When deactivating usb(4) child devices do not panic if their driver does not implement an *activate() function.
Fixed a double free in an ami(4) error path.
Warn and load defaults when negative values are specified for borderwidth, moveamount, snapdist or gap in cwm(1).
Show list of mismatched "for" loops when a fatal error occurs in make(1).
Workaround faulty cycles-per-second readings on i386 and amd64; fallback to rdtsc if cpuspeed reported as 0.
Fixed sndiod(8) channel mappings being wrong when the client has not specified the channels.
Record the time a lease is bound to an interface so the correct dhclient(8) process survives a netstart(8).
Initialise client rate to fix sndiod(8) crashes when the client doesn't set the rate.
Provide smtpd(8) with a way to encrypt envelopes and messages using aes-256-gcm before they hit the queue. Not activated yet.
Make sure we allocate outside the Legacy Address Range on intel(4) i915. Gets rid of the "no ifp" warning on the x41.
Fixed use after free in the error paths of kerberos(8), ldconfig(8) and ldpd(8).
Use a blacklist detecting non-regex patterns so more are covered by the fast grep(1) code.
Use open(2)/fstat(2) instead of stat(2)/open(2) for checking proper permissions of "local" .exrc or .nexrc files in vi(1).
Switched the malloc(3) and pool freelists to using xor simpleq. Adds a tiny bit more protection from list manipulation.
Export ingress/egress interface index in pflow(4). Needed for some netflow collector and tests.
Fixed mem leak in swapmount.
Fixed resetting MB_CUR_MAX when switching locales away from a UTF-8 locale.
Updated xf86-input-keyboard to 1.7.0 and xf86-input-mouse to 1.9.0.
Start dbus-launch in a consistent way in xinitrc and Xsession.
Only redraw the name/size box when the client resizes, not every time there's movement; improves cwm(1) resize syncs.
Always attach the mfi(4) battery sensor if the adapter lets us query it, so newly replaced batteries show up immediately.
Added secure monitor call function for arm/beagle, so a secondary cache controller driver can talk to its controller properly.
Disabled PandaBoard's L2 Cache early on bootup (it re-enables later once it is ready).
Fixed a case on arm where we might be cache flushing unmapped pages.
5.3 RELIABILITY FIX: for flaw in vr(4) driver where it did not recover from some error conditions. A source code patch is available.
Provide a sensor for the battery backup unit (bbu) on the mfi(4) boards that support it.
Added a cortex bus which represents the ARM MPCore Complex (attaches to ARM Cortex A9 and A15 SoCs).
On intel(4) i915, clear the correct pixels when scrolling backwards.
Use ARMv7 access permission bits on the beagle architecture.
Handle newer fibre adapters the same way as em(4) 82575/82576. Required to make 82580 (i340) and i350 based adapters work.
Made ypldap(8) ignore SIGPIPE so it doesn't fail if an ldap connection breaks.
Removed most of the pre-rc.d(8) backward compatibility (see http://www.openbsd.org/faq/current.html#20130429).
Updated ulpt(4), as it now depends on firmload (since its rev 1.41 that adds support for uploading HP LaserJet firmwares).
Implemented identd(8) -h, used to hide usernames/uids (as in libexec/identd).
Preliminary modifications for Xorg 1bpp server for luna88k, including enabling wsmux(4) on GENERIC kernel.
Reverted fix for binutils linker errors (breaks the xenocara build on macppc; fixed in binutils 2.17 anyway).
Updated libX11 to 1.6RC.
Updated xproto to 7.0.24
Improved dealing of ARMv7 faults. Added ARMv7 fault descriptions.
Use strptime(3) for parse_date() and date writing logic for dhclient(8) (to match dhcpd(8)).
time_t 64bit fixes for relayd(8) and relayctl(8).
Convert softraid(4) RAID 4/5/6 to new work unit completion routines.
Fixed binutils linker errors when using llvm/clang (see http://lists.gnu.org/archive/html/bug-binutils/2004-07/msg00000.html).
Added the ability to change ARM frequency and added match functions on beagle.
Added GPIO support for the pandaboard.
Added a terminator to the device list, to avoid unexpected behaviour when a device isn't found by beagle.
Correctly enable ARM's Generic Interrupt Controller on beagle.
Fixed range for assigned ports managed by the IANA (see RFC 1700) in pf.conf(5).
Added tstohz(9) as the timespec analog to tvtohz(9).
When a ucom(4) is removed, walk the knotes in ttyfree(). Fixes crash when unplugging a ucom(4) which cu(1) is running.
When attaching disks, feed the disklabel(8) checksum to the random(4) pool as unique-esque-but-not-secret data.
Use the manufacturer-supplied bios serial/uuid as a source of uniqueness to seed the random(4) pool on i386/amd64.
Disabled sendmail(1) ident queries since ident(1) does not run by default anymore.
Increase ip_ttl on packets from 16 to 128, so people living many hops from their dhcp(8) server can still get leases.
Support src/libexec/identd's -e option in src/usr.sbin/identd(8).
Speed up ffs disk access a little and fsck_ffs(8) substantially (see: www.mckusick.com/publications/faster_fsck.pdf)
Reworked tee(1) to simplify, check errors against -1, remove casts, etc.
Removed TIMESTAMP abstraction layer in make(1); adapt to time_t being 32 bits OR 64 bits.
Convert softraid(4) RAID 4/5/6 to new ccb handling.
Removed rarely-used identd(8) option for specifying which port you want to run on.
Added identd(8) support for returning uids instead of usernames via -n, like libexec identd.
Added identd(8) -N to let users put .noident in their homedir, to return HIDDEN-USER instead of their username.
When using choose-tree -u, start with the current tmux(1) window highlighted.
Get tmux(1) session of -t window rather than client's window.
When dhcpd(8) is sync'ing, look for lease by hwaddr and then ipaddr. Fixes loops while sync'ing.
Call recalculate_sizes() after killing a tmux(1) window, in case it is in a grouped session.
Do not die when identd(8) parent process has a backlog of requests for the child process.
Handle large time_t correctly in ray(4) debug code.
Check for underflow before using ffs2 blockcount, as it is unsigned.
Corrected tv_sec handling in scsi(4) mass storage debug code.
Avoid truncating a pfctl(8) time_t division into days.
Use arc4random_uniform(3) in mrouted(8).
Don't let tmux(1) server_client_check_focus use a dead bufferevent.
Let rtsold(8) handle exceedingly long uptimes; reset IPv6 timers upon reaching 2038.
gio(4/sgi) now allows smaller-than-32-bit accesses to the ID register (on boards with 32-bit ID register) for better device detection.
Unify the zs(4/macppc) tty driver across macppc, sgi, solbourne, sparc and sparc64 architectures.
Convert softraid(4) RAID1 to the new work unit completion functions and generic interrupt handler.
Unbreak edquota(8) by fixing the temporary file name template.
Made umount(8) via DUID possible.
When mount(8) is run in verbose mode, display f_mntfromspec if it differs from f_mntfromname.
Disabled inetd(8) by default.
On getty(8), use poll/nanosleep instead of select with a fixed size fd_set.
Reverted rev 1.45 of usr.sbin/procmap/procmap.c.
Stopped using unsafe random(3) in npppd(8), use arc4random(9) instead.
Made i2c bit-banging code work with slow slave device (eg SDVO chips and DDC eeproms) found on some inteldrm(4) hardware.
Cranked C_MAXFILE static limit of files to serve in rbootd(8). Existing limit of 10 is too small for some networks.
Disabled time service (RFC 868) by default in inetd(8).
Enabled active PS/2 multiplexing if available. Supported for i386 and amd64 except SMALL_KERNEL.
Fixed npppd(8)'s PPPoE server, which was broken since last configuration rework.
Added -o option to getopt string and usage in rdate(8).
Use time_t instead of long for binutils archive timestamps, and print them as a long long.
Disabled cpu migration code when on single processor systems.
Log (at LOG_INFO) which interfaces dhcpd(8) listens to, and their addresses.
Made rdate(8) -n the default; added -o flag for the old RFC 868 time protocol (which uses a 32-bit value for its wire protocol).
For datagrams, inetd(8) now assumes other protocols should fail.
ksh(1) now handles long long time_t.
Added ksh(1) support for printing long long (%lld).
find(1) now handles large numbers. Fixes time_t beyond 2038, constrains the range of i_num correctly, and now handles files > 4GB in size on 32-bit machines.
Matched vacation(1) behaviour to current sendmail-based vacation.
Make sure the fs blocksize doesn't get too big when using disklabel(8).
Made rtsold(8), rpc.lockd(8) and rtadvd(8) print tv_sec properly.
Added the ability to query supported ciphers, MACs, key type and KEX algorithms to ssh(1).
Fatal() ssh(1) when ChrootDirectory specified without root privileges (reintroduced without previous connection-killing bug).
Fixed some ssh(1) memory leaks; bz#2088.
Improved netstat(1) time_t handling and printing.
Made ssh(1) "sftp -q" behave as documented and hush everything but errors.
Accelerated scrolling backwards for intel(4) i915.
Made ar(1) and ranlib(1) handle greater time_t, so that .a files will work after 2038.
Added intel(4) i915 support for 16bpp mode to code that interfaces with the rasops(9) code.
Print "UTC" at the end of dates in the dhcpd(8) leases file.
Replaced hand-rolled date printing/parsing code in dhcpd(8) with strftime(3)/strptime(3).
Resolver now checks return value of strdup(3) and take into account that asr_use_resolver() can return NULL; fixed mem leak in error path.
Don't set the frequency of the statclock if we don't have one on amd64 and i386. Prevents strange hangs during reboot.
Don't permanently avoid BRKSIZ gap for mmap(2). Allows some platforms, notably i386, to fully utilise their address space.
Check memory pool we are about to init isn't already on the list, in order to detect double init and double destroy mistakes.
Unbreak and cleanup nfsd(8) diskless swap automount.
Adapted cron(8) and at(1) for future large time_t and tv_sec types.
Variety of fixes to correct large time_t code in file(1).
Long long and %lld for time_t output added to tmux(1).
Add new ioctl command USB_DEVICE_GET_DDESC to usb(4) to retrieve the device descriptor.
Reverted usr.bin/ssh/session.c rev 1.262 (it fails because the uid is already set there).
Handle large time_t for kdump(1), sysctl(8), rtsold(8), csh(1), time(1) and mtree(8).
Added secondary cache flushes to armv7's pmap(9).
Correctly allocate a buffer for a uhci(4) transfer; do not pre-allocate TDs to put them in the free list.
Pass state correctly so pkg_add(1) can do error messages.
Fixed some AVPs of SCCRP to comply RFC 2661 in npppd(8): firmware revision and vendor name AVP are not mandatory; hostname AVP must have 1 octet at least.
Fixed panic when pipex(4) session is terminated by idle timer.
Stopped existing authentication being removed when the npppd.conf(5) configuration is reloaded.
Fixed npppd(8) configuration options "max-session", "user-max-session", "strip-nt-domain" and "strip-atmark-realm".
Fixed npppd(8)'s pppoed, broken since the last configuration parser change.
Use the dd(1) and ed(1) that are on the install media, instead of the one post-install.
Removed CTL_USER hierarchy from sysctl(3) and sysctl(8) (use sysconf(3) or confstr(3) instead).
Implemented fdatasync(2) as a wrapper around fsync(2).
Added SHA-224 to cksum(1). SHA-224 is to SHA-256 as SHA-384 is to SHA-512, and was in a later revision of FIPS-180.
Backed out rev 1.17 of lib/libc/rpc/svc_tcp.c and its conversion to poll (to avoid endless loop).
Reverted pckbc(4) sys/dev/pckbc/pms.c r1.37, now that we stop after the first matching protocol.
Moved pckbc(4) IntelliMouse protocol definition after Elantech ones (some touchpads support both, we want to pick the latter).
Stopped pckbc(4) probing for all supported protocols. It confused some touchpads and made it harder to pick the right protocol if a device answers to more than one magic sequence.
Added escape codes for F21 to F24 to wscons(4).
Support added for F13-F24 keys found on IBM 122-key pckbc(4) keyboards.
Unbreak tape boot blocks on mvme68k (broken since the switch to the MI libsa loadfile code).
To speed scrolling, framebuffer acceleration now uses the registers to determine first visible pixel; works even while X is running, and safely scroll when printing panic messages or if we've entered ddb(4).
Added new option to xenocara to automatically build the Gallium3D software rasteriser as part of the libGL.
Make sure drm(4) turns hsync/vsync back on at crt enable (v2) for intel i915 chipsets.
Perform a warm reset instead of putting hardware into full sleep mode to avoid system hangs upon "ifconfig down up" with some AR5212 hardware.
Fix cnmac(4/octeon) log messages displayed to the user.
Remove some Korean characters from the tmux(1) utf8 zero-width list that shouldn't be there.
Copy the tmux(1) client into the new cmdq in source-file so commands that work on it (such as new-session) can work.
Enable the fallback method of getting the crt EDID on drm(4) if normal gmbus access fails for the intel i915 chipsets.
Unbreak dhcpd(8) lease synchronisation by making the sync header contain the correct packet length even when padding is present.
Call setlocale(LC_TIME) at tmux(1) startup.
In the resolver, avoid a mem leak and reinit of context for each resolver call for single threaded programs.
Send an SGR0 after turning on modifyOtherKeys, to fix tmux(1) Terminal.app which treats \033[>4;1m and \033[4;1m (bold+underline).
Copy out a blank string if no wmesg, so userland can rely on reading sysctl(3) p_wmesg[0] and not find junk leftover from before.
Quieten disconnect notifications on the ssh(1) server from error() back to logit() if it is a normal client closure; bz#2057.
Fixed bug introduced in last commit, which led to pax(1) checking the typeflag after already overwriting it.
Correctly handle data memory protection ID traps on hppa.
compat_linux(8) fixes: assert that refcount is larger than 0 when doing futex_put; prevent multiple futex pool initialisations.
Set EV_WRITE for jobs so tmux(1) run/if-shell jobs don't hang.
Fixed tmux(1) bug where end guard in control mode was not printed after session destroyed.
Get the standard path for which(1) and whereis(1) from _PATH_STDPATH instead of sysctl({CTL_USER,USER_CS_PATH}).
Added a magic number to the head of the signature block to prevent accidental unhibernates and endless unhibernate/reboot cycles.
newvers.sh uses "basename" for directory name to stamp the kernel version ID with. Permit paths with spaces in the name.
Added extended header support for ustar in pax(1). Currently only path and linkpath are handled.
Retry ftp(1) when SSL_read fails with SSL_ERROR_WANT_READ. Fixes the case where a https server attempts renegotiation.
Show what was parsed in resolver debug output.
Resolver will not fail anymore if the user buffer is too short to hold the packet: fill it to the given size, return the packet length.
Plugged cmw(1) memleak: always need to menuq_clear even when a selection is made.
Recalculate IP/protocol checksums of packets (re)injected via divert(4) sockets.
Add new ioctl's USB_DEVICE_GET_CDESC and USB_DEVICE_GET_FDESC to usb(4).
Allow octeon to find it's root device, based on the flags passed by U-Boot. Temporary fix until there are proper bootblocks.
Made the resolver comply with RFC2553. Fixes hostname resolution for OpenVPN 2.3.1.
Make the netinet6 SO_BINDANY socket option also work for raw IPv6 sockets.
Check BGE_SGDIG_STS when the bge(4) chip is NOT a 5717 A0.
Added an -E option to ssh(1) and sshd(8) to append debugging logs to a specified file instead of stderr or syslog.
Turn a npppd(8) error into a warning to be able to start l2tp tunnels even if gre(4) is not allowed.
Removed the rthreads sysctl(8), as they are always enabled.
The new resolver will now not fail on EINTR.
Extend com(4) to enable com3 on both i386 and amd64 (com4 config is added, but disabled).
Cleanup ssh(1) mux-created channels that are in SSH_CHANNEL_OPENING state too (in addition to ones already in OPEN); bz#2079.
Use the existing _PATH_SSH_USER_RC define to construct the other ssh(1) pathnames; bz#2077.
Added gcc(1) support for "d" floating-point suffix, as defined by draft N1312 of TR 24732.
Do not allow the listen(2) syscall for an already connected socket, as this would create a weird set of states in TCP.
Fixed ufs bug where clear_remove() and clear_inodedeps() would not iterate over the entire pagedep and inodedep hash tables.
Snapshots for the octeon platform are available now.
Show only available actions in rc.d(8) script usage messages. Also, clean up the display of actions list.
Make the resolver properly follow the CNAME chain in reverse lookups.
Use MSG_NOSIGNAL when writing DNS queries over TCP sockets to ensure resolver doesn't trigger SIGPIPE.
Honour PATH search order for cwm(1)'s exec.
Other window managers grab the Xserver(1) during the whole client setup process, so make cwm(1) match. Avoids race conditions.
Make it possible for ldomctl(8/sparc64) to explicitly specify the number of vcpus and the amount of memory for the primary domain. Also prevents people mistakenly creating two domains named "primary".
Fixed drm(4) EDID detailed timing vsync parsing and frame rate.
Backout drm(4) commit, which introduced a bogus check that could lead to an infinite loop in some eDP setups.
Reverted rev 1.21, to fix a race condition where multiple mkdir(1) -p's trying to create overlapping paths in parallel could error out.
Re-implemented tcp_read() in the resolver, so it can get the packet length in multiple reads.
Have tht(4) set IFF_ALLMULTI when in promisc mode.
Set the nxe(4) IFF_ALLMULTI flag as appropriate.
Removed Evergreen IDs incorrectly added to radeon(4) radeondrm in the past.
Changed smtpd(8) log format to fix a warning.
A large number of subsystems and utilities adjusted to use large time_t.
acpithinkpad(4) now ignores power change event from the newer thinkpads groups.
Allow raw IPv6 sockets for ipsec(4) protocols, to match IPv4.
If more than one lookup line is found in resolv.conf(5), the latest one takes precedence.
The resolver will now properly check for domain name truncation at various places and fail if that happens.
Build mips kernels with -G 0 so it will link.
Updated ldomctl(8/sparc64) for some UltraSPARC T2 firmware which need "rngs" and "rng" nodes in the Hypervisor machine description.
Avoid sdiff(1) memory leak while parsing diff's output.
Enable the use of getaddrinfo() in libxcb, to allow X11 clients to talk to a remote server over IPv6 again.
Added octeon as a supported hardware platform.
Fix so the hp300 boot blocks compile again.
Validate the softraid(4) crypto I/O request when it is first received, rather than waiting until disk I/O is performed.
Make setrlimit(2) return EINVAL if rlim_cur > rlim_max, per POSIX.
Added a default .cvsrc for cvs(1) to /etc/skel.
Implement nameserver retry/backoff as in the old resolver(3).
getaddrinfo(3) is now thread-safe.
Use i2c bit-banging on the SDVO port for intel(4) i915, rather than using buggy GMBUS. Makes more digital video ports (DVI, HDMI) work.
Unbreak the build on amd64 by making sure that inteldrm pulls in the generic i2c bit-banging code.
Put back a space that got lost in fstat(1) state output.
Do not transfer diverted packets into ipsec(4) processing, let them reach the socket the user has specified in pf.conf(5).
Revert alpha and ppc to the binutils 2.15 state, to let a binutils 2.17 toolchain produce working binaries.
Allow "0" as service name for raw sockets in getaddrinfo(3).
Stopped async_resolver(3) assuming a local nameserver if resolv.conf(5) doesn't exist, and just use /etc/hosts.
Unbreak drm(4) EDID fetching over displayport.
Two fixes to drm(4) intel_sdvo_write_cmd(): allocate a large enough buffer to store messages; make sure we return true if we successfully transferred the command. Makes it possible to talk to the SDVO chip on the other end.
In getent(1), use getaddrinfo() to display multiple addresses including IPv6.
Prevent some undesirable interactions between using the brightness keys and wsconsctl(8) on the Dell XPS M1330.
Restrict protocol numbers for raw sockets to the range from 0 to 255.
Have smtpd(8) temporarily refuse new messages if file system holding the queue has less than 10% of disk space or inodes left.
Fixed a ftp(1) memory leak during HTTP header parsing.
Revert to the old method of intel(4) execbuffer pinning for i915.
Provide a default softraid(4) discipline interrupt handling function and migrate all of the disciplines that now have the same interrupt code.
Added function to read the MPCore base address on arm. Allows dynamically determining where e.g. the interrupt controller is.
Correctly show the scope for IPv6 addresses in getnameinfo(3).
Stopped the resolver failing in gethostbyname_async() when there are multiple addresses in a DNS packet.
Prevent race conditions in smtpd(8) db file handling.
Allow snmpd(8) to be put into read-only mode so that all "set" requests will be rejected.
Fixed some missing sd_sync check/wakeup after scsi_io_put() calls in softraid(4).
Fixed building urtwn(4) on the RAMDISK media.
Prevent panic during rtsx(4) attachment if a card is inserted while booting and the interrupt handler triggered before sdmmc(4) is attached.
Let mii_attach() know where the bnx(4) PHY is located (instead of scanning for it) since we know where it will be anyway.
Switch to the new resolver implementation.
Enable fmemopen(3), open_memstream(3) and open_wmemstream(3).
If tmux(1) -s to swap-pane is not given, use the current pane.
Make tmux(1) copy-mode -u still scroll up if already in copy mode, handy for people who bind it with -n.
Let the new resolver accept and use any protocol specified by the caller.
expr(1), csh(1) and ksh(1) will no longer die with SIGFPE on INT_MIN / -1 or % -1. Instead, INT_MIN / -1 == INT_MIN and % -1 == 0.
Enable pax(1) support for write_opt=nodir for ustar archives. For tar archive readers that rely on appended "/".
Added an open_wmemstream(3) implementation and fixed various issues for fmemopen(3) and open_memstream(3).
Rewritten work unit handling code in the softraid(4) RAID 1/4/5/6 interrupt handlers. Ensures that work units are always removed from the pending queue and that colliders are started, even in the event of an I/O failure.
Move the tmux(1) cursor back into the last column on CUU/CUD, to match xterm(1) behaviour.
Make sure the new resolver only uses the search domains for DNS lookups, as the previous resolver did.
Short-circuit screen switching on intel(4) i915 if we're switching to the screen that's currently active.
Stop pci(4) rePOSTing devices supported by inteldrm(4), as the driver now properly restores the graphics mode.
Added AES-XTS support to aesni crypto(4) driver on amd64. Allows softraid(4) to benefit from the AES-NI instructions on newer Intel CPUs.
Only accept partial keys if the timer has not expired. Fixes infinite tmux(1) loop when escape is pressed the wrong number of times.
During upgrade network setup, print friendlier error message if dhclient(8) is required but missing.
Avoid null dereference affecting mod_perl, perl(1) RT bug 116441.
Imported perl(1) 5.16.3 from CPAN.
Added basic support for multiple screens to rasops(9), use this to provide proper virtual terminals to intel(4) i915.
Fixed libkvm build on m68k.
tmux(1) will try to establish client for run-shell and if-shell if no -t.
Reverted the tmux(1) command-prefix change, which broke sequences of commands.
Reseed the random(4) pool with the dmesg(8) when more devices are attached.
Sync ospf6d(8) with ospfd(8): allow two minutes until neighbour adjacencies are formed; for point-to-point interfaces, send lsupdates to the interface address (since there is no DR and multicast messages to the DR will be ignored); improve snapshot handling.
Create a new context when copying instead of using the (possibly nonexistent) input context. Fixes tmux(1) crash.
Display the window's column number in the mg(1) mode line, not the column number of the active window.
Write escaped tmux(1) output in control mode rather than hex.
Allow tmux(1) to handle empty pending output (and not fail), and add \n.
When only two panes are in a tmux(1) window, only draw half the separating line as active.
Don't let tmux(1) display-message crash if no client.
tmux(1) will now only send end guard if begin was sent.
Process "^[" as meta when a partial key is found by tmux(1).
Record when the buffer was saved in the mg(1) undo history.
Handle "no client" better in tmux(1) display-message.
Don't zoom windows with one tmux(1) pane.
Correct line numbers for mg(1) undo-list.
Added home and end (as modified by xterm) in tmux(1) keypad mode.
Don't add prefix to tmux(1) %output pane id.
Fixed tmux(1) if-shell and run-shell if there are no sessions.
Added time and a command count to tmux(1) control mode guards.
Fixed handling of short (< 4 character) checksums and a bug with parsing old-style custom tmux(1) layouts.
Do not redraw tmux(1) panes if invisible.
Add tmux(1) wait-for -L and -U for lock and unlock.
Added tmux(1) wait-for command which blocks a client on a named channel until it is woken up again (with wait-for -S).
Allow lastgc to be NULL in grid_string_cells so tmux(1) find-window doesn't crash.
Preserve trailing spaces with tmux(1) capture-pane -J.
Add tmux(1) -q flag to silence errors to capture-pane and show-options.
Add -a to tmux(1) capture-pane, to capture alternate screen.
Updated drm(4) libdrm to 2.4.42.
Do not let pstat(8) or fstat(1) leak kernel pointers, unless operating as root.
Added tmux(1) -A flag to new-session, to make it behave like attach-session if the session exists.
Added resize-pane -Z to temporarily zoom/unzoom the active tmux(1) pane.
Added a -o option to set-option, to prevent tmux(1) setting an option already set.
Add a tmux(1) command queue to standardise and simplify commands that call other commands.
Allow tmux(1) to handle focus events from the terminal.
Expand format variables in the tmux(1) run-shell and if-shell shell commands.
Added option command-prefix which is automatically prepended to any tmux(1) command (apart from a naked default-shell).
Added support for focus notifications when tmux(1) pane changes.
Reverted revision 1.138 of bsd.own.mk and switch amd64, i386, arm, sh and sparc64 back to binutils 2.15.
Fixed bug in ld(1) --gc-sections to stop it stripping out .note sections. Unbreaks building chromium with binutils-2.17.
dhclient(8) will now ignore client-identifier option sent by the server and instead record the local client-identifier used to obtain the lease, or construct one. Stops confusing servers when renewing a previous lease from a different MAC.
Stop dhcpd(8) including the client-identifier option in OFFER or ACK messages, as per RFC 2131 4.3.1.
Add tmux(1) -C and -J to capture pane to escape control sequences and to join wrapped line.
Clear last attributes after reset in tmux(1) string_cells.
Fixed tmux(1) so capture-pane/save-buffer can work in control clients.
Add tmux(1) copy-pipe mode command to copy selection and also pipe to a command.
Add -e flag to tmux(1) capture-pane to include embedded ANSI SGR escape sequences.
Allow ospf6ctl(8) and ospf6d(8) use of an alternative control socket, ported from ospfd(8).
Added resize-pane -x and -y to specify an absolute tmux(1) pane size.
tmux(1) can now correctly handle UTF8 mouse option being toggled.
In terminals with XT, tmux(1) activates/handles modifyOtherKeys=1 with the escape sequence, pass them through if xterm-keys is on.
Reinstate ospfd(8) code to announce routes to backup carp interfaces, so that a specific route is maintained during failover.
Stopped sysmerge(8) outputting a warning when the target of the link does not yet exist on the system.
Backported fix to permit "xrandr(1) --output LVDS1 --mode 1280x800 --panning 1380x1024 --scale 1.8x1.8" to behave properly.
Fixed tmux(1) non-prefixed bindings.
Include the \033 in the tmux(1) key tree and adjust key matching for this change.
Support tmux(1) capture-pane -p, to send to stdout.
Detect on-die temp sensor for Atom E6xx on amd64.
Add tmux(1) -c to refresh-client, to set client size in control mode.
tmux(1) will no longer crash when calling choose-tree with a command that changes the mode.
Add tmux(1) user options, prefixed with @. May be set to any arbitrary string.
Add tmux(1) -v to set; and "setw" to show only option value.
Allow formats in tmux(1) status options.
Show alias in tmux(1) lscm output.
Allow choose commands to be used outside tmux(1), so long as at least one client is attached.
Fixed detection of the MAC address on cnmac(4/octeon) by reading it from the correct address.
Use boot_info->config_flags to determine if the host has PCI capabilities. Fixes a hang on the EdgeRouter Lite.
Enable drm(4) opregion code. Makes the brightness keys on x230 work.
Correctly issue WSKBDIO_GETDEFAULTKEYREPEAT ioctl when wsconsctl(8) is getting the default repeat settings.
5.2 RELIABILITY FIX: Allow tftpd(8) to OACK and stop a segfault occurring.
A source code patch is available.
Switched amd64, arm, i386, sh and sparc64 to binutils 2.17.
Previous commit to i386/amd64 acpi_machdep.c broke suspend, now fixed by using the IPI that halts the CPU to save state.
As non-root, whenever netstat(1) is about to print out a kernel pointer, print 0x0 instead.
Only root can look at the kernel address space with procmap(1) now.
Don't shutdown nc(1)'s network socket when stdin closes. Matches both GNU and Hobbit's netcats; -N reverts to old behaviour.
Do not allow netstat(1) to expose a kernel address.
Fixed return value of i2c_algo_dp_aux_exec, so getting the Extended Display Identification Data on displayport now works.
When non-root asks sysctl(3) for kinfo proc or file requests, do not fill in any kernel addresses information.
Do not touch the jumbo replenish threshold register on bge(4) chips that do not have jumbo support.
Added a ruby20 FLAVOR to ruby-module(5).
Don't advertise brightness control if it isn't supported by intel(4) i915 hardware.
Added an OpenBSD-specific implementation of xf86-video-intel backlight control that uses the appropriate wscons(4) ioctls.
Fixed race condition in socket splicing timeout which caused a uvm fault in sounsplice().
Fix sudo(8) use_loginclass, backport from upstream.
Updated to xf86-video-intel 2.20.19.
Stop probing once touchpad detected. Stops pms(4) driver "not in sync yet" messages after attaching to elantech v2 hardware.
Update intel(4) and the device-independent drm(4) code. Includes support for kernel modesetting and enables use of the rings on gen6+ Intel hardware.
Updated sqlite(1) to 3.7.15.2.
Provide a way for *drm(4) to prevent VGA text console wsdisplay(4) instance from attaching after it has control of the VGA hardware.
Backout radeon(4) xf86-video-ati workaround for broken accelerated solid pictures with XAA on big endian architectures, and apply the correct fix (working at depth 16 and 24).
Limit the identd(8) client to 256 bytes of input. If they send too much, just close the connection.
Timeout based on the whole identd(8) session, not after every read/write. Stops clients from consuming fds on the server.
Handle EMFILE/ENFILE from accept by disabling handling of events on the identd(8) listeners for a second.
New identd(8) daemon, to replace the libexec one often run from inetd(8). An event driven non-blocking implemention.
Added an interface to rebind agp(4) DMA mappings. For KMS to reload bindings after suspend/resume.
Set glxpcib(4/loongson) "Power Immediate" bit upon attaching, so Fuloong can auto restart upon power failure.
Updated nginx(8) to 1.2.7.
Correct the clock speeds used to calculate int moderation values provided by the SK_IM_USECS() macro on msk(4) and sk(4).
Added workaround for HW bug in bge(4) BCM5717/BCM5718/BCM5719-A0/BCM5720-A0 chipsets: don't include interface input drop counter in input errors.
Apply the "AcceptPerfectMatch" workaround for sis(4) DP83815 chipsets to the 15D revision as well.
Fixed size of unicast rx filter table on vio(4), to stop unicast address overwriting part of the multicast rx filter table.
Updated fonts-conf(5).
5.2 and 5.3 RELIABILITY FIX: Stop bgpd(8) replacing an active during session startup.
A source code patch is available for 5.2 and 5.3.
Allow tftpd(8) option ACK to negotiate 2 byte transfers with extra options.
Fixed double free which occurred if a tftpd(8) option ACK failed.
Don't unconditionally try to attach octcf(4) to a CF bus on octeon. Stops endless faults on the EdgeRouter Lite.
Removed the unused sequencer(4) driver.
Re-enabled build of Xserver(1) on hp300.
Enable vge(4) flow control support.
Fixed mii(4) flow control support; workaround for the IP1001 PHY where downshift support was not functioning properly.
Install npppd.conf(5) with permissions of 0640, as there could be the radius config in this file.
Disabled pie for lkm(4).
Removed faithd(8) and faith(4).
Make sure dhclient(8) doesn't delete IPv6 routes.
Allow octeon to reboot by poking the right address for a soft cpu reset.
In aucat(1) debug mode, log successful connections.
Stopped sndiod(8) and aucat(1) displaying warnings if accept() returns ECONNABORTED or EWOULDBLOCK, as we do in other daemons.
Fake "SMBIOS detection" for quirky Soekris boxes, to make it easier to attach device drivers.
Require that the mktemp(1) template include at least 6 trailing Xs to match POSIX mkstemp/mkdtemp. Improved error messages.
Fixed kernel profiling on MP systems by using per-CPU buffers and teaching kgmon(8) to deal with them.
Allow snmpd(8) report new PF "translation" counter.
Add pf(4) "translation" counter, use this (not "memory") when address translation fails due to no free ports in the configured range.
Turn identd(8) off by default.
Allow systrace(1), identd(8), uucpd(8), iked(8), nfsd(8), talk(1), tcpbench(1), bgpd(8), dvmrpd(8), ftp-proxy(8), inetd(8), iscsid(8), ldpd(8), ospf6d(8), ospfd(8), ppp(8), relayd(8), ripd(8), sasyncd(8), smtpd(8), snmpd(8) and syslogd(8) to handle ECONNABORTED errors from accept(2).
When binding a lease, check for and clear out any "zombie" routes left behind by a dead dhclient(8).
As per RFC 2131, stop dhcpd(8) ACK'ing any REQUEST containing a server-identifier option that specifies a different dhcp server.
Removed the -I option from ndp(8).
Do not start npppd(8) if a pptp tunnel is configured but the gre(4) protocol is not enabled.
Flush writes to BGE_MI_COMM to avoid "APE lock request failed!" errors with HP 331T (5719) and 332T (5720) bge(4) cards.
Changed relayd(8) to use the monotonic clock instead of gettimeofday() and call fatal() on error-that-should-not-happen.
Removed obsolete sudo(8) code that used to change the mode of sudoers from the old (pre-1.6) default.
Reserve a file descriptor on accept() for subsequent connect() call by ftp-proxy(8), as done in relayd(8).
Put tip(1) back, but without the hardlink to cu(1) for now.
Make it possible to override already attached wsdisplay(4) console later in the boot process. Needed for upcoming KMS changes.
Workaround for some PowerBooks without an adb(4/macppc) bus, to prevent their PMU from shutting down the machine.
Prevent gzsig(1) going into an endless loop on input error.
Prevent gzsig(1) race condition by using already opened file descriptors. Properly presume owner/mode of gzip(1) file.
Add new cu(1), a libevent-based implementation of the old tip(1)/cu(1) with a few new things (eg basic xmodem support). Disable tip(1).
Always use the internal PHY on Apple variants. This unbreaks gem(4) on some PowerMac G5.
Disabled re(4) IP checksum offloading for Realtek 8168 (broken if the packet has IP options).
Updated to: xterm(1) 291, bdftopcf(1) 1.0.4, beforelight(1) 1.0.5, ico(1) 1.0.4, xcalc(1) 1.0.5, xfsinfo(1) 1.0.4, xkbutils 1.0.4, xsetroot(1) 1.1.1, xstdcmap(1) 1.0.3, xvidtune(1) 1.0.3, xvinfo(1) 1.1.2, xsm(1) 1.0.3, libXrandr 1.4.0, and xrandr(1) 1.4.0.
Enable TCP socket splicing for HTTP persistent connection and chunked transfer encoding. Speeds up relayd(8).
Updated to fontconfig 2.10.91 + a few local fixes: replaced ugly bitmapped Lucida fonts with Luxi or DejaVu TrueType fonts; moved the target of fontconfig recipes to the "pattern" from the "font" to add the default values properly.
Rewrite the ste(4) receive filter handling code and cleanup the ioctl bits.
First steps towards alphabook1 support.
Allow ssh(1) "-f none ..."
Implement a bgpctl(8) nei foo destroy that will remove the specified cloned neighbour.
Better bgpd(8) templates support: on config reload adjust the cloned neighbours so that they get the config changes as well; clean up sessions that are 1h idle but in state active (instead of down); allow bgpctl(8) to destroy cloned neighbours.
Added submethod support to sshd_config(5) AuthenticationMethods.
Fixed return value of wcrtomb(3) in single-byte locales if the "s" argument is NULL.
Allow a "+" in the cron(8) MAILTO email address.
Per POSIX, if getconf(1) confstr() returns zero without setting errno ("no defined value") then print "undefined\n".
Correct the delay when programming the sis(4) short cable fix to 100us, not 100ms.
Fixed and simplified determining whether we're using an rl(4) 8129 or 8139 chipset. Allows D-Link DFE-520TX to work.
Fixed ssh(1) public key and hostbased authentication when the client has specified a style (e.g. "root:skey").
Fatal() ssh(1) session when ChrootDirectory is specified while running without root privileges.
Account for the size of the allocation when defending the uvm(9) pagedaemon reserve.
Sync yyerror() in ospfd(8), ospf6d(8), snmpd(8), dvmrpd(8), ifstated(8), ldpd(8), ripd(8), smtpd(8) and ypldap(8) with version in bgpd(8), so that it logs to syslog when daemonised.
Patch for CVE-2013-1667 in perl(1): DoS in rehashing code (see http://code.activestate.com/lists/perl5-porters/191311/).
When dumping ospfd(8) config, just print "passive" for passive interfaces rather than showing the "hello" timers and keys.
Fixed a bad comparison when calculating the size of the hibernate code's signature block.
Updated: rgb to 1.0.5, xev(1) to 1.2.1, and sessreg(1) to 1.0.8.
Reset ssh(1) pubkey order on partial success.
Let whois(1) -P do a query against https://www.peeringdb.com/.
softraid(4) disciplines are now shutdown in reverse attach order, making manually stacked volumes more practical.
Reorder pci(4) code such that wsdisplay(4) attaches after drm(4). Preparation for framebuffer console support on amd64/i386.
When deleting an IPv6 interface address, also remove the prefix and the cloning route.
Added HG20F9 usb ethernet to axe(4).
Check ldomctl(8/sparc64) parser's return value and exit if parsing failed. Report syntax error with duplicated domain name.
Use vlog() to log relayd(8) parser errors so they will show up in logs if they occur when reloading.
When user(8) is locking/unlocking an account, never touch passwords that are "*" or 13*. Also make sure to never end up with an empty password.
Fixed format string issue when printing an error out on bge(4) with APE and more than 4 pci(4) functions.
Fixed ksh(1) quoting in word part of ${var+word} (and similar) when entire thing is quoted or in a here-doc.
Disabled duplicate address detection on carp(4) interfaces, as the peer may have the same addresses.
Make sure that IPv6 source address selection only chooses a carp(4) address if the interface is in master state.
Fixed the combination of "j" format flag and the XPG "<num>$" modifier in vfprintf(3).
Unbreak softraid(4) compilation with debug enabled.
Fixed pf(4) so when a pf.conf(5) containing "set tos" is followed by a scrub option, the tos will not be changed to 0x00.
Properly conditionalise adding wscons(4) to the list of consoles on amd64 NWSDISPLAY.
Always compare aliases(5) at the end of the sysmerge(8). Prevents newaliases(8) from failing due to smtpd.conf(5) syntax change.
When passwd(1) is using an external password quality check program, don't run (potentially contradictory) internal pattern checks.
Bring getconf(1) substantially up to spec with POSIX 1003.1-2008: 155 new names; support for the -v option. Added support for non-standard -L and -l options for listing the known names.
--------
Changes made between OpenBSD 5.2 and 5.3
dhclient(8) now tries 10 times to obtain the routing table via sysctl(3), if it can't be done abandons attempt to clean up the routing and arp(4) tables and carries on.
Fixed xterm(1) segfault which happened when using the mouse wheel over the scrollbar.
Avoid alignment errors when dhclient(8) processing routing messages, by reading the messages into dynamically allocated memory.
Added ldomctl(8/sparc64) workaround for some firmware revisions which provided an incorrect factory-default configuration.
Fixed sndiod(8) crashes occurring when the client sample frequency is much larger than the device sample frequency.
Don't try to purge one-time rules from the main pf.conf(5) ruleset.
Always reserve space addresses, to fix memory corruption when doing ipsecctl(8) -ssa with md5sig.
Fixed trunk(4) panic which occurred when previous interface had modified the mbuf(9) chain.
Use dma memory for viomb(4) bl_pages, to fix a "Non dma-reachable buffer..." panic on amd64.
When no acceptable dhclient(8) offers are received within the allowed timeframe, look for a lease in dhclient.leases.IF. If none are available, wait "retry" seconds before restarting DISCOVER; also daemonise the process, giving back the command prompt.
Support ssh(1) ProxyCommand=- (stdin/out already point to the proxy); Allow IdentityFile=none.
Don't complain if ssh(1) IdentityFiles specified in system-wide configs are missing.
Bring back bge(4) 5718/5719/5720 support again; fixes for ip checksum handling.
Fixed a potential smtpd(8) crash when connecting to a misbehaving smtp server.
Use imsg_flush() to ensure a quicker exit of any previous copy of dhclient(8).
Cancel any outstanding protocol timeouts when a dhclient(8) link goes away.
Reverted revision 1.195 of ahci_pci.c, which caused Intel SATA controllers in compat mode to not see any hard disks on boot.
When opening an ldomd(8/sparc64) device node fails, show its path in the error message.
Set wireless interface priority and interfaces to the wlan group for cnw(4) and ray(4) (pre 802.11b wireless drivers).
install(1) will now report unlink() errors unless ENOENT.
Stop dhclient(8) deleting permanent arp(4) cache entries when clearing the arp(4) cache.
Reworked dhclient(8) log messages: only one message logged at termination or restart; removed duplicate cleanup attempts.
Updated nsd(8) to version 3.2.15.
Keep track of which ssh(1) IndentityFile options were manually supplied and which were defaults, don't warn if the latter are missing.
Suppress some pointless dhclient(8) debugging messages.
Fix line counting when using mg(1) forward-paragraph and backward-paragraph.
Disabled smtpd.conf(5) queue compression temporarily, as we lack the smtpctl(8) bits.
Allow dhclient(8) lease renewals to work in a non-default routing domain, and show problematic table id in error messages.
Only use local hostname in Received lines if smtpd(8) listener has not overridden it, otherwise use the listener hostname.
Bugfix udp(4) socket splicing when a packet gets diverted, spliced and routed to loopback.
Do not let user(8) try to (un)lock system users; people wanting to do so should use vipw(8).
Revert rthread/ld.so(1) diff: not working on sparc/sparc64 or vax.
Fixed make(1) var module failing while expanding a line ending with a $. Seen when MALLOC_OPTIONS=S.
Terminate the smtpd(8) session instead of fatal()'ing if getsockname(2) fails.
Cleanup mg(1) undo history in revert-buffer.
Unbreak dhclient(8) DISCOVER, by initialising xid from correct field.
Allocate dma memory below 2^28 limit, allowing ice1712-based envy(4) cards to work on amd64.
Fixed the relayd(8) "toread" check in the lateconnect case, which allows Content-Length: 0 in HTTP GET request when a request filter is used. Broken by previous commit.
Do not loop forever if pckbc(4) keyboard send a BAT (Basic Assurance Test) fault code. Handle this code like "Resend" or "BAT success" instead.
Make sure dhclient(8) asks for a default route in the correct routing domain. Fixes some periodic failures.
Don't leak dhclient(8) routing socket file descriptor if getting the default route fails.
Warn more loudly if an ssh(1) IdentityFile provided by the user cannot be read (bz #1981).
Disable nginx(8) pcre symbol visibility on vax in order to unbreak the build.
When an interface generates an RTM_IFINFO message, check LLADDR. If it has changed, simulate a SIGHUP to restart.
Obey RFC 2131: when the broadcast flag is set, send dhcpd(8) reply back via udp broadcast and link-local broadcast. Fixes some switches which use the broadcast flag.
Correct ssh(1) error message that had a typo and was logging the wrong thing.
Don't rely on the dhclient(8) packet buffer (client->packet) being preserved between attempts to send DISCOVER or REQUEST packets.
Repair the legacy xf86-video-intel i810 driver.
Cherry pick bugfixes for http://www.openssl.org/news/secadv_20130205.txt from the openssl(1) repository.
Allow use of "=" instead of "=>" when declaring a smtpd.conf(5) mapping.
Replaced smtpd.conf(5) "users" keyword with "userbase" when providing alternate userbase.
smtpctl(8) trace expand, enables tracing of aliases expansion.
Repaired gdb(1) single-stepping on m88k.
Make librthread compatible with an ld.so(1) that does TCB allocation.
Added a "block" rule prior to the state creating "pass" rule in the default pf.conf(5).
Fixed npppd(8) to stop it calling ioctl with the invalid argument (bug introduced by the config parser change commit).
Return EINVAL instead of panicking when a zero length MPPE is passed by ioctl to pipex(4).
Make sure pipex(4) MPPE key is not zero length.
Restore previous dhclient(8) behaviour of not cleaning up in response to SIGTERM, so routes to NFS servers are not lost.
Reflect the -f option in last(1) output.
Re-enable the stack protector code on m88k machines.
Make top(1) display the correct percentage of CPU usage for threaded processes when threads are not displayed.
Record "Received disconnect" messages at ERROR (not INFO) priority, as they return a non-zero ssh(1) exit status (bz#2057).
ssh-keygen(1) now appends (not overwrites) moduli(5) file when screening candidates. Allows resumption of an interrupted screen (bz#1957).
Switched the m68k ports to gcc(1) version 3.
Updated nginx(8)'s internal pcre to 8.32.
Don't wait for memory from pool while holding uvm(9) vm_map_lock, as this can cause a deadlock.
Updated luit(1) to 1.1.1. Fixes the luit(1) tty handling after the introduction of the UNIX98 PTY functions.
syslogd(8) -h now includes RFC3164-style hostnames when forwarding.
Don't discard dhclient(8) option list if it contains duplicate option names, just ignore the duplicates.
Added some pieces for identifying and supporting some of the newer bge(4) chipsets.
On reboot(8), ignore sysctl failure for CPU_LIDSUSPEND when errno is EOPNOTSUPP.
Permit frames up to 1758 bytes (MTU 1740) and raise hardmtu to allow the user to set them on vr(4) VT6105M, VT6105 and RhineII-2.
Allow configuring an MTU of up to 1518 on sis(4). Tested on DP83815.
Put index and root directives where the the nginx(8) "Pitfalls" list says to put them.
Fix for perl(1) CVE-2012-6329.
Make smtpd(8) retain the MX address order as sent by the lka for MXs with the same preference.
Fix memory leak in npppd(8) privsep.c to free the memory which was allocated by getcap(3).
Fixed NULL dereference when sftp(1) is built without libedit, and control characters are entered as a command.
Bring back reserve enforcement and page daemon wakeup into uvm(9) uvm_pglistalloc, to stop potentially running out of memory.
Make sure the uvm(9) page daemon considers BUFPAGES_INACT when deciding to do work, just as is done when waking it up.
Added pppx(4) interfaces to the "pppx" interface group.
sshd_config(5) MaxStartups is now "10:30:100" to start random early drops at 10 to 100 connections. Makes it harder to DoS.
Rework http content/chunk handling in relayd(8). Allows handling an optional chunk trailer properly (a prerequisite for splicing persistent http connections).
Unbreak smtpctl(8) table update.
Install 50x.html for nginx(8), which is part of a default configuration.
Disable ld(1) "PIE-by-default" if -static (or an alias) is passed on the command line, to produce a fully static binary.
netstat(1) -vP now also shows the new struct sockbuf field sb_flagsintr.
Make pflow(4) use flowStartSeconds/flowEndSeconds for netflow v10, so it can see what time a flow started/ended.
smtpd(8) fixes: handle getaddrinfo() error as LKA_TEMPFAIL; handle getsockname() error in smtp_connected(); accept "/" as part of user-part and expand to ":" (like qmail); fix wrong check in mda leading to bogus Return-Path header; fix aliases parsing when there's a white space between key and separator.
Automatically reflow wrapped lines when a tmux(1) pane is resized.
Don't let tmux(1) set certain string formats if the string is NULL.
Make sure new config file is valid before SIGHUP'ing sshd(8), which would otherwise just kill it.
Pad "join BSS" command with padding the size of the entire buffer, to make rsu(4) firmware happy.
Stop as(1) from optimising away R_X86_64_GOTPCREL relocations.
Use RTM_GET in dhclient(8) to obtain the current default route. Much less work for the routing system.
Removed product/vendor table and let the urndis(4) driver attach based on class, etc. Print what type of device it is.
hp300 and mvme68k libtool(1) has switched to elf(5).
elf(5) toolchain for m68k, following the SysV/m68k ABI.
dhclient(8) will now add identifying comment to generated resolv.conf(5) so it is easy to see which interface generated it.
Fixed dhclient(8) crash when checking whether resolv.conf(5) should be written.
Do not leak lease in dhclient(8) error path.
dhclient(8) will now handle a non-existent resolv.conf.tail(5) without issuing an error message and handle an empty resolv.conf.tail(5) without exiting. No longer leak an fd if fstat() on resolv.conf.tail(5) fails. Made fstat() failure on successfully opened resolv.conf.tail(5) a fatal error.
Fixed memleak in libutil imsg_read() when hitting the file descriptor reserve check.
Resolved some issues with xf86-video-intel screen corruption seen with dpms on ivy bridge.
If a sndiod(8) device doesn't respond within 2 seconds, close it and drop all connections. Necessary on some MP machine/audio driver combinations.
Rewritten the msk(4) receive filter handling code and cleaned up ioctl.
m88k libtool(1) has switched to elf(5) and has shared libs.
Write out resolv.conf(5) only if the default route is under the control of the process binding the dhclient(8) lease. Re-check the default route when a routing message arrives that might mean default route has changed, and write out resolv.conf(5) if appropriate. Reduces the chances that the name servers in resolv.conf(5) are unreachable.
Don't tweak the smtpd(8) socket sndbuf, now that envelopes are passed in compressed form. Reduces default envelope message size.
Fixed port numbers for login_radius(8) servers, which were not configured correctly in npppd(8).
Deleting the ip address of a tun(4) interface by npppd(8) now works correctly.
Backed out bge(4) 5718/5719/5720 support, as it breaks 5704C.
makedev(8) will now create /dev/pppx by default, for pppx(4).
Added support for POSIX.1-2008 functions dprintf(3) and vdprintf(3).
Rewritten the url(4) receive filter handling code and cleaned up the ioctl bits.
Fixed udav(4) bug: when going in and out of promiscuous mode the driver was not disabling all multicast mode.
bge(4) support for 5718 family of chips, including the 5719 and 5720.
Make ulpt(4) upload firmware into HP LaserJet printers which require the firmware.
Large reduction in memory footprint when smtpd(8) is relaying lots of messages.
Log sender address as "<>" when smtpd(8) delivering bounces.
Allow lookups from backends in smtpd(8) "accept for [...] virtual" context.
Openldap client now accepts connections to a ssl-enabled ldapd(8) server.
Introduced smtpctl(8) "trace lookup" to trace lookup process; improved logging of the transfer process.
Added TX interrupt mitigation for vr(4) chips, including 6105Ms found in pcengines alix and soekris 5501s.
Bumped MAXTSIZ to 128 MB in vmparam.h on i386 and amd64, to cope with large binaries.
Added a pkg_mklocatedb(1) -u option to make it possible to update an existing database.
Correct the PBA size used for em(4) PCH adapters to 26KB.
Calculate resolv.conf(5) contents once when dhclient(8) is binding a lease, and reuse as required.
Restore dhclient(8) "no domain-name, no domain-name-servers means don't touch resolv.conf" behaviour.
smtpd(8) updates: preliminary ldap and sqlite support; all lookups now done through tables; improved handling of temporary errors; improved scheduler and mta logic; improved queue; improved memory usage under high load; SSL certs/keys isolated to lookup process to avoid facing network; fully virtual setups possible now; and runtime tracing of processes through smtpctl(8) trace; smtpd.conf(5) simplified. FLUSH YOUR QUEUE.
Don't allow stopping/restarting mountd(8) via rc.d(8) framework, it should be done manually to avoid RPC daemon issues.
Removed ACSS from ssl(8) and ssh(1).
dhclient(8) now reads resolv.conf.tail(5) once on startup and save contents for subsequent resolv.conf(5) building.
Skip ssh(1) serial lookup when certificate's serial number is zero.
Changed byte-order swapping to 16 bits to match "event type" size. mpii(4) works on sparc64 with this.
Try to post everything except the flags field in the first myx(4) TX descriptor.
Fixed ssh(1) handling of (unused) KRL signatures; skip string in correct buffer.
Always validate the user of a received SNMPv3 request in snmpd(8) if the configured user has a certain security level.
ARMv7 doesn't support the atomic SWP instruction anymore so using the atomic load and store instructions instead.
Added instruction fault register functions, which will be needed for further ARMv7 support.
m88k ld.so(1) now copes if shared library is loaded at a different address than what it was compiled for. Fixes spurious crashes.
Change interface and span interface lists so bridge(4) behaviour does not suddenly change anymore when adding a vlan(4) interface.
relayd(8) now only sends a single CRLF terminator between Chunked Transfer Encoding chunks. Fixes (e.g.) Chrome and curl that implement the specification strictly.
Make pf(4) TCP sequence number tracking less strict by one octet for FIN packets. Previously a packet with the FIN bit set and containing data that fits exactly into the announced window was blocked.
Properly handle wcsftime(3) "%%" and "%N" where N is not a supported escape. Consistent with strftime(3) behaviour.
Stopped the radeon(4) driver from trying to restore text mode on PALM and newer chip generations, as it won't succeed.
Fixed backslash escaping during filename tab-completion in ksh(1).
Added viomb(4) to amd64 generic kernel.
Avoid chance of divide by zero in _dl_findhint() if the administrator reruns ldconfig(8) with bogus paths.
Much faster pkg_add(1) -E: if the "raw" contents file doesn't contain the last part of the filename, then don't parse plist.
Relax the restriction on sending frames to trunk(4) members to allow bpf(4) writes.
Converted softraid concat, crypto, and RAID0 to new workunit completion functions.
Ensure we remove workunit from the pending queue and restart deferred workunits for softraid(4) RAID0, even in error conditions.
Converted softraid(4) RAID1 to new ccb functions.
Added dhclient(8) "-L" to specify file storing offer/leases. Allows access to dhcp option information that was formerly passed to dhclient-script.
Constrained the amount of kernel memory used by NTFS.
Added global lock enter and leave routines to acpi(4).
Reset I/O counters when releasing softraid(4) ccbs.
Update the ARM CPU ID information as the IDs aren't vendor/product specific, they are specific to the ARM CPUs themselves.
dhclient(8) will now try harder to clear out default routes on the interface being configured.
Support sshd_config(5) Key Revocation Lists (KRLs), a compact way to represent lists of revoked keys and certificates.
Don't re-calculate vr(4) vlan tag repeatedly through the descriptor loop.
Don't try to access vr(4) m_head after it may be freed (unlikely for VT6105M, but possible).
Ensure the tty(4) hiwat is less than the size of the ring buffer, ensuring a bit of space for kernel ^T handling and such.
New pmap(9) for pandaboards.
Do not allow tmux(1) cursor colours to be set beginning with ? as that will report the colour.
Allow the kernel to directly transfer UDP data from one socket to another.
Allow two minutes until ospfd(8) neighbour adjacencies are formed; transmit correct state to RDE; do not send IMSG_LS_UPD if we have no links; and improved snapshot handling.
For ospfd(8) point-to-point interfaces, send lsupdates to the interface address (see RFC 2328, 13.3(5)).
In ospfd(8), check for state != NBR_STA_XCHNG even if the RDE has processed all received DDs (dd_pending == 0), in case the peer still sends more DD messages.
Imported xf86-video-modesetting 0.6.0 for KMS testing.
Display some more flags and subtypes in tcpdump(8), especially flags used in power saving mode.
Converted softraid(4) concat and RAID 0 to the new ccb functions.
Fixup printing of bgpd(8) rdomain configs to add network statements and only print the description if it is set.
Allow amd64 to hibernate with up to 64GB physical memory.
Force three newest generations of Intel SATA chipsets into ahci(4) mode. Makes the DVD drive and other devices on MacBook Pro with bootcamp more reliable.
Fixed a.out(5) coredumps by using RB_FOREACH_SAFE in uvm(9).
Revert unconditionally registering the cpu throttling code on all loongson 2F systems, as the gdium does not have a separate scheduling clock yet.
Do not register the mips64 internal cpu timer-based timecounter if we support cpu throttling.
Properly distinguish /boot(8) and biosboot(8) in i386 and amd64 informational and error messages.
Unbreak the negation toggle code when re-loading pf(4) tables, so negating existing entries on re-load will work.
Add terminfo(5) entries for rxvt-unicode and rxvt-unicode-256color.
Added cpu throttling support to the loongson 2F systems.
Added a new capability flag to identify softraid(4) disciplines where read failures are not necessarily terminal (i.e. we have redundancy).
Don't tell the dhclient(8) privileged process to discard active_addr if there is a pending address addition. Fixes "routehandler: interface address added" messages and premature exiting.
Added hardware VLAN tag/untag support for vr(4) VT6105M chips.
Keep a count of packets added to vr(4) TX queue and only poke the chip if we've added a packet.
Added a stat clock for the lemote loongson machines, to show more accurate cpu usage statistics.
Restrict sysctl(8) KERN_PROC_ARGS lookup of KERN_PROC_NENV and KERN_PROC_ENV to process owner and root.
Implement tmux(1) ECH (erase character, CSI X).
Per group support for authpf(8) rules files added to /etc/authpf/groups.
If timing between keys is less than 1 millisecond, tmux(1) will assume the text is being pasted. "assume-paste-time" option changes the value.
Allow as(1) to correctly assemble PIC code on m88k.
Switch memory filesystem to bufq. This gives us queue limits and uses FIFO queueing (rather than the current LIFO queueing).
Process compat_linux(8) futex requeuing even when the thread times out or is signalled.
Fixed netinet6 to stop flushing prefixes of autoconfigured IPv6 addresses with "ndp(8) -P" causing an uvm fault.
Make the mount_msdos(8) FAT setattr handling more consistent about unsupported attributes, making it more user-friendly.
Allow multiple coredumps to be saved at the same time.
Map the myx(4) registers prefetchable so things that can do write combining will attempt to.
Avoid extra bus_space barriers in the myx(4) interrupt handler.
Stopped using separate interrupt handlers for the tht(4) ports. Ensures second port does not get starved.
Accept both types of etherip rev 3, but continue sending old format. First step of transitioning (over two releases) to new ietf specification.
Updated to: editres(1) 1.0.6; showfont(1) 1.0.4; viewres(1) 1.0.4; xconsole(1) 1.0.5; xedit(1) 1.2.1; xgc(1) 1.0.4; xmessage(1) 1.0.4 and xmag(1) 1.0.5.
On loongson, added a driver for the mfgpt1 clock found on lemote and use as system clock; replaced system clock provided by the cpu with a mfgpt to allow cpu throttling; changed the frequency value of hz from 100 to 128.
Updated nginx(8) to 1.2.6.
Track, reject and blackhole ospf6d(8) routes and allow them to be redistributed even though they point to the loopback.
Free the directory block buffer at the completion of a readdir, significantly reducing NTFS kernel memory usage.
When posting descriptors to the myx(4) chips rings, do multiple writes before calling the bus_space barrier.
Let dhclient(8)'s lease validate option data and discard bad options before checking if any required options are missing.
More informative dhclient(8) "options" error message.
Ignore dhclient(8) options that do not validate, rather than summarily rejecting offered lease. Treat all options whose names start with "option-" as unknown.
Reverted cwm(1) group.c r1.68, which allows an empty group to be sticky.
Enabled flow control support with bnx(4) 5708S/5709S adapters.
Added support for reporting flow control status for mii(4) 5708S/5709S fibre phy.
Check results of strdup(3) in dhclient(8) domainname and nameservers options.
Reverted vfs(9) setting a high water mark, it will likely cause problems in low memory situations where we can't get a struct buf.
Added viomb(4) driver for virtio balloon device. Allows host to request some memory back from the openbsd guest in case of a shortage.
Improved error message for integrity failure in ssh(1) AES-GCM modes.
Allow a hp300 kernel whose name contains uppercase letters to be bootable.
Honour libtool(1) -Wc and -Xcompiler in link mode as GNU does.
Set the initial cwm(1) group to "1".
Don't log "unknown subcode" for subcode 0 when the bgpd() hold timer expires, this is a normal condition.
Don't hardcode the bge(4) phy address at 1, as the 5718 family can have phys as 1, 2, 8, or 9.
When checking the mii(4) phy check the oui as well as some model numbers overlap (e.g. bge(4) and bnx(4)).
Enable more libdrm functions in drm(4) and check DRIVER_MODESET flag in kernel to determine if modesetting is supported.
Correctly initialise ssh-keygen(1) fingerprint type for fingerprinting PKCS#11 keys.
Support AES-GCM as defined in RFC 5647 (but with simpler KEX handling) in sshd(8).
Added cwm(1) per-group vert/horiz tiling support with new bind commands "vtile" and "htile."
Taught as(1) how to handle mips symbolic register names.
Unbreak xinerama support and fixed menu/client placement for cwm(1) panning setups.
Reverted the daily(8) SMART check using atactl(8) for disks with SMART enabled.
Fixed sparc optimisation bug in dump(8).
Don't propagate XF86XK_Audio{Lower,Raise}Volume keys from pckbd(4) or wscons(4) to userspace. Stops volume from being adjusted twice (by X apps and again by the kernel).
Make dhclient(8) buffer for lease longer to accomodate strings listing all possible option names.
Replaced hand formatting of dates in dhclient(8) with strftime(3).
Changed dhclient(8) to write leases as strings, to write out complete leases at a time.
Enabled MSI for rtsx(4).
Updated libXcomposite to 0.4.4; libXdamage to 1.4.4; and xf86-video-mach64 to 6.9.4.
Check UDP length field for short as well as long values in dhcpd(8) and dhclient(8). Fixes dhcpd(8) crash when a UDP packet arrives saying it has 0 length.
Switched m88k ports to ELF.
Stopped rtsx(4) and sdhc(4) drivers attaching to the same device, which then failed to work reliably.
Allow for the units(1) prefix to be given without a need to quote it.
Updated xterm(1) to 287; freetype to 2.4.11.
Allow fingerprinting of keys hosted in PKCS#11 tokens: ssh-keygen(1) -lD ...
Changed sysmerge(8) parameter order and allow arbitrary filenames in url pattern.
Extended sysmerge(8) error handling and quoting of user supplied input.
Correct error handling in mount_ntfs(8) that previously left the ntnode locked and neglected to decrement the use count.
Ensure mount_ntfs(8) directory link count is always 1. Makes find(1) behave predictably.
Allow specification of an alternate start directory for sftp-server(8).
Pass the screen workarea, as opposed to viewarea, allowing cwm(1) client snapping to honour gap.
Sync hostname.if(5) parsing with netstart(8) in install.sub; also ipv6 "prefix" parsing fix.
Only check dhclient(8) "-l" parameter for regular-fileness, not the built-in default path. Stops erroring out for no reason and fixes (U)pdate.
Fixed tty(4) bug that could result in up to 100 lost bytes when it hist the TTYHOG limit and blocks.
ssh(1) channel_setup_local_fwd_listener() fixed to return 0 on failure, not -ve (fixes bz#2055).
Added an implementation of fmemopen(3) and open_memstream(3) (to be polished in-tree).
After toggling a cwm(1) group hidden, don't set it as active (in sticky or non-stick mode), regardless of existing clients assigned to that group.
Plugged a memleak when unbinding a duplicate key for cwm(1) kbfunc_cmdexec.
Made number of cwm(1) groups no longer off-by-one.
Fixed gap value when formatting 1.44MB 3"1/2 floppy disks on sparc and sparc64.
m88k ELF toolchain added to binutils.
Rewrote mandoc(1) indentation handling for nested lists.
Do not mail out diffs of the moduli(5) file.
Allow native ELF binaries (none yet) to run on m68k.
Don't compute checksums if pkg_add(1) is already erroring out.
Added HD4550 to the list of radeon(4) cards.
Fixed pf(4) for nat with sticky address and ip address change.
Reset the pf(4) round-robin pool counter in case its current value has been removed (e.g. with ifconfig em0 1.2.3.4 -alias)
Keep mount_mfs(8) from potentially consuming the entire buffer cache if it falls behind.
Constrain the filename passed to dhclient(8) -l to a regular file.
Make HUP to either of the dhclient(8) processes cause a restart that will have it re-read dhclient.conf(5) and get a new lease.
Fixed grep(1) exit status when there is an error reading a file.
Make mg(1) respect locale for ctype purposes (e.g. to display ISO Latin 1 characters).
Avoid spinning in the vfs cleaner when there are insufficient clean pages, but no buffers on the dirty queue to clean.
Updated sendmail(8) to 8.14.6.
Added GENERIC.MP to luna88k.
Replaced one grep with awk patterns and simplified another using -q in sysmerge(8).
Fix kernel compilation with POOL_DEBUG but not DDB enabled.
Register cleanup handler passed by ld.so with atexit(3), and fix stack alignment on i386 and sparc.
Simplified sysmerge(8) by using shell patterns.
Added tmux(1) ^ and $ special command targets to select lowest and highest numbered windows.
Add -T option to tmux(1) select-window to toggle to last window if already current.
Added a -u flag to tmux(1) choose-tree to start uncollapsed.
Removed an unnecessary tmux(1) window-choose redraw.
Register sparc64 cleanup handler passed by ld.so with atexit(3).
Explicitly align i386 stack on a 16-byte boundary such that constructors can use SSE instructions.
Simplify setting sysmerge(8) FETCH_CMD.
Make the per-user login_yubikey(8) counter file r/w by group auth.
Added support for U3 bridges present in macppc G5 machines.
Attach all known macppc U3 AGP bridges.
acx(4) now supports power-saving in hostap mode.
Return EEXIST to "add" and "addspan" when a port is already a bridge(4) member. Makes reconfiguration with netstart(8) silent again.
Fixed bug in random offset from rev 1.143 of malloc(3); random range was expanded, but not by enough.
When dhclient(8) is binding to a new lease, wait for the RTM_NEWADDR message in S_BOUND state. Prevents confusion when another DHCPACK arrives.
Fixed sasyncd(8): the valid port interval is 1 to 65535, not 1 to 65534.
Rather than calling microtime in bpf(4) bpf_catchpacket each time it's called on a packet, take a timeval indicating when the packet was captured.
bpf(4) allocates packet buffers in the ioctl path; let it sleep waiting for memory to become available.
Use openpty() rather than hand-rolled vi(1) pty opening code.
Correctly update the current ix(4) flow control mode; report it in the media status callback.
max_frame_size now set after ether_ifattach updates ix(4) if_mtu.
Readjust sndiod(8) midi flow control after consuming input data.
Added gcc(1) stack smashing protector for Alpha and MIPS (enabled by default). Reorganised soft frame pointer so that locals are below it and grow downwards.
Update to xf86-video-vmware 2.1 RC1 (aka 2.0.99.901).
Removed an output probe method in xf86-video-intel i830PreInit(). With xserver 1.13 this causes a fatal error at run time.
Sync the "legacy" xf86-video-intel i810 driver (used only on true i810 and i815 chipsets) to X.Org.
Temporarily bring back the scsi(8) shutdown hook, but only use it to flush the disk cache.
Adjusted sysmerge(8) arithmetic tests.
Don't attempt to delete address that has already been deleted; narrows race window, makes rapid-fire starting of dhclient(8) more reliable.
Stopped an incorrect flag to be set in npppd(8) _this->keylenbits.
Stopped relayd(8) complaining if the child processes exits cleanly.
Let the privileged dhclient(8) process clean up itself. Continuous rapid repeated invocations now more reliable.
Put a default known_hosts into cwm(1) conf; simplified config file setup; other code cleanups.
Create and use cwm(1) menuq_clear() helper.
Made cwm(1) screen font an Xft(3) font.
Daemonize dhclient(8) later in process. Fixes problem where dhclient(8) exits before interface gets an address and a second dhclient(8) has to run.
Allow gethostbyname(3) to accept a numeric IP string. No lookup is done in this case.
Unbreak bootblocks on Alpha by fixing the primary load address.
ix(4) ixgbe_raise_i2c_clk changes: allows for larger timeouts for greater reliability.
Sync ix(4) advanced transmitter descriptor setup code with upstream; use TXSM instead of IXSM for IP checksum calculation.
Decrement the number of clusters on the ix(4) ring in case of an error.
Implemented SFP+ module hot-plug support for ix(4) 82599.
Fixed link autonegotiation bug on ix(4) 10GbaseT controllers; improved link information reporting.
cwm(1) menu drawing rewrite, moving to Xft(3) and solving assorted font/colour drawing issues.
Updated to xf86-video-geode to 2.11.14.
Added the Validity vendor and some products (including vostro 3360) to usbdevs.
Prevent a potential dhclient(8) segfault.
Plugged two iked(8) memory leaks.
Don't print an error if the iked(8) process exited normally.
Added support for IT8772F to it(4).
Added U3 HyperTransport found in PowerMac7,3 to pcidevs.
Use correct string in ssh(1) error messages.
Changed tmux(1) load_cfg to fix a crash.
Fixed a regression introduced to attach drm(4) on macppc.
Correctly attach vgafb(4) on iMac G3 graphics cards which have a "misc" pci(4) subclass.
Limit the xf86-video-intel backlight values to the maximum so xbacklight(1) will work on recent thinkpads.
Properly handle the case where a process has disappeared in between pkill(1) grep'ing and printing it.
Use OpenSSL's EVP_aes_{128,192,256}_ctr() API and remove hand-rolled ssh(1) counter mode code.
Reset ssh(1) incoming_packet buffer for each new packet in EtM-case.
Don't print zero length matches in grep(1) -o mode.
Added ssh(1) encrypt-then-mac (EtM) modes to openssh; these modes are more secure and used by default.
Drain log messages after receiving ssh(1) keystate from the unpriv child, to stop it from blocking while sending.
Add a daily(8) SMART check using atactl(8) against disks that support and have SMART enabled.
Use proper EOL offset for grep(1) -o matching.
Bring back a small copy optimisation in crypt(3) aes-gcm handling.
Fix potential for use-after-free of bufs in Fast File System softdep.
Backoff buffer cache on any uvm(9) page daemon wakeup to avoid repeatedly waking page daemon unnecessarily.
Limit nfsd(8) up to only 1/4 of available buffer mapping kva when busying up buffers in an nfsiod. Makes sparc installs work over nfsv2.
Fixed gcc(1) "c-bounded" when arrays are declared without the size expression.
Fixed gcc(1) unaligned memory loads on Alpha.
Adjusted oce(4) mbuf chain data pointer so that ip header is word aligned.
Correct macobio functions to fix kernel panic on PowerMac G5 (present since r1.22 of i2s.c).
Implemented crypto(3) support for Extended Sequence Numbers for the aesni driver.
Schedule a timeout if receive ring refill fails on bnx(4). Avoids some stalls when using ipsec(4).
Added cdce(4/alpha).
Recognise 7448 and 970MP processors on macppc.
New "-i" option to dhclient(8), to ignore any values provided for specified options from leases.
Implemented ldomctl(8/sparc64) and ldomd(8/sparc64) panic command.
Added /dev/vdsp[0-7] to sparc64.
Added ldomd(8) to control the availability of virtual disks to guest domains.
Re-enabled pkg-config(1) --max-version.
Handle resetting 256-colours properly when tmux(1) is parsing #[default], #[fg=default] and #[bg=default] styles.
Include a path separator after an ikectl(8) SSLDIR.
Added support for PowerPC 970 CPUs present in early PowerMac G5 from 2003 (7,2 and 7,3).
Fixed mbuf leak with devices sending BPDUs to bridge(4) members not configured with STP.
Conform crypto(3) to RFC 4106 when combined authentication/encryption mode is in use.
Enable the radeon(4) r100 dri module on macppc.
Supply correct AAD length to the final round of crypto(3) hashing for Extended Sequence Number support.
Added support for agp(4) bridges that do not support remapping for processor accesses. Required for having drm(4) on macppc using agp(4).
Make sure we try to unbind agp(4) memory regions if the aperture base address is 0.
Simplify tmux(1) command string parsing.
Implement bus_space_mmap(9) on macppc and i386.
Set port = NULL for new connections. Fixes sndiod(8) crashes.
Fixed ix(4) to correctly account rx errors.
If no domain-name or domain-name-servers provided in the dhclient(8) lease (or if they are ignore'd in dhclient.conf(5)) and there is no resolv.conf.tail, then do not remove any existing resolv.conf(5).
Attach the 2nd core of SPARC64-VI and SPARC64-VII CPUs.
Stopped cu(1) sending EOF "character" down serial line at high speed if it loses its input terminal.
Added ifconfig(8) group support back (ramdisk version was broken).
Enable agp(4) in macppc generic kernel.
Bring back mg(1) column numbers and make them configurable. Off by default to not kill slow serial lines.
Add support for Uninorth agp(4) bridges found in most (if not all) G3 & G4 macppc machines.
Make macppc bus_dmamem_mmap(9) understand the BUS_DMA_NOCACHE flag, required for agp(4).
Fix ex(1) hang when exiting shell in script mode.
Added emulation of POSIX pty APIs posix_openpt(3), ptsname(3), grantpt(3) and unlockpt(3) using /dev/ptm.
Close sparc64 vdsp disk images if the client disconnects.
New CA root certificates from GlobalSign, VeriSign, AddTrust, Comodo, UserTrust Network/UTN and Starfield.
Fix XAA support in xf86-video-mga.
For netstart(8), use the compact version of the check for ifconfig(8)'able interfaces from install.sub.
Added sshd_config(5) AllowTcpForwarding "local" and "remote" keywords to enable just local or remote TCP forwarding.
ssh-add(1) -d will now delete the corresponding certificate too; the -k option will delete key only.
Fixed sshd(8) logging of authentication when privsep is enabled by adding explicit "Partial" state; report which submethod is used for keyboard-interactive.
Make ssh_config(5) IdentitiesOnly apply to keys obtained from a PKCS11Provider. Allows control of which keys are offered from tokens using IdentityFile.
Fixed case where buffers returned on vinvalbuf(9) path and we do not get woken when waiting for kva.
Fixed vfs(9) kva reserve to ensure that kva reserve is checked for.
Implement hardware flow control and enable it by default on vcc(4/sparc64).
Don't wake the vfs(9) cleaner and throw away pages unnecessarily when growing the buffer cache .
Added check to xf86-video-intel so server can fail with useful error message instead of segfaulting later.
dhclient(8) will now catch SIGHUP, SIGINT, SIGTERM, SIGUSR1, SIGUS2 and remove routes and the interface address before exiting.
netstart(8) will try harder to identify invalid interface names and emit an error message.
Make sure gcc(1) no longer incorrectly optimises away "*volatile_ptr = *volatile_ptr;" constructs on platforms which can perform memory to memory transfers in a single instruction (i.e. m68k and vax).
Switch m88k ports to gcc(1) version 3.
Add ldomctl(8/sparc64) support for older firmware on UltraSPARC T1 machines.
Parse sndiod(8) "-m mode1,mode2,.. " strings strictly.
Make dhclient(8) privileged process daemonize, not attach to a controlling terminal.
Make it possible to share ldomctl(8/sparc64) cores between domains.
Make the bgpd(8) error messages more user friendly.
If a particular bgpd(8) capability is bad, log the fact and ignore it, rather than return an error. Allows bringing up a session that have (e.g.) unexpected AFI,SAFI pairs in them.
Add RX TCP/UDP checksum offload support to gem(4).
Additional CA root certificates added from GeoTrust/Equifax, GoDaddy, StartCom, and Thawte.
Drain sndiod(8) midi port output buffer before closing it ensuring the last few bytes are not lost.
Drop clients using sndiod(8) midi ports when port is closed (eg. umidi disconnected); try to reopen it whenever a new client connects.
When sndiod(8) audio device is closed, mark it as closed before dropping connections. Stops clients attempting to reopen the device.
Process incoming sndiod(8) midi data on the fly, not by using an input fifo.
Don't exit sndiod(8) if midi control port is destroyed (it never is).
Removed retired ssl(8) Thawte/Verisign certificates and intermediate GoDaddy certificate.
Made cloned devices line up with the rest of the fstat(1) output.
In locale/ctype/en_US.UTF-8.src, corrected width of some characters in the Hebrew range (0590?05FF).
Fixed speakers on Apple MacBook Air 2010, they require gpio azalia(4) unmuting.
Support large MTUs on vio(4); added support for chaining several rx buffers when receiving large packets.
Added rtsx(4), a new driver for the Realtek RTS5209 card reader.
Remove setting an initial (assumed) baudrate upon driver attach for many network interface cards.
5.2 stability fix for interoperability problem with some newer Junipers: make sure that bgpd(8) ignores the "must be zero" flags correctly and ensure that they are always reset to zero when sending updates out.
A source code patch is available.
Prevent iked(8) VPN traffic leakages in dual-stack hosts/networks by forcibly blocking IPv6 traffic.
Fixed wrong argument being passed to snmpd(8) control_dispatch_imsg().
Made ix(4) compile again with IX_DEBUG defined.
Minor update to sqlite3(1) 3.7.14.1.
Specific last match for autogroup in cwmrc(5).
Changed scandir(3) "select" argument to match POSIX.
Fixed radeon(4) EXA issue, introduced in xf86-video-ati 6.14.5 with accelerated solid pictures support.
Support the 47 and 1047 SM and RM sequences (alternate tmux(1) screen without cursor).
Added mg(1) "make-directory" (not bound to any shortcut).
Allow dhclient(8) "request", "require" and "ignore" as requests to create empty lists of options. Enables the removal of built-in lists or the removal of global lists inside an "interface" declaration.
Correctly aggregate together errors from nested tmux(1) config files with source-file.
Overriding a previous dhclient(8) ignore list will no longer leave incorrect ACTION flags lying around.
Allow tmux(1) cmd-run-shell to accept -t option to specify the pane to display the output.
When scrolling in copy mode with the mouse, scroll tmux(1) screen rather than moving cursor.
Update to drm(4) libdrm 2.4.31 and add the (non-yet-linked) libkms.
Don't toss away an existing dhclient(8) request/require list unless new list is successfully parsed.
Add tmux(1) window-status-last-* options.
Fix tmux(1) session choice so that preferring unattached sessions works.
ppp(8) panics if M_ZEROIZE gets set on readonly mbufs - use M_PROTO1 and M_LINK0 instead.
em(4) pch2/82579 fixes: modify em_oem_bits_config_pchlan for pch2; sync pch2 use of gating/un-gating hardware phy config; add 82579 phy workarounds; enable Energy Efficient Ethernet on 82579.
Make ldomctl(8/sparc64) work on UltraSPARC T2. Enough functionality to create a configuration for a t5120 running System Firmware 7.1.x.
Make it a dhclient(8) syntax error to attempt to store an option in a list more than once.
ldomctl(8/sparc64) will now properly remove virtual device ports if we remove the associated channels.
Do not require, request, or ignore dhclient(8) DHO_PAD ("pad") and DHO_END ("option-end").
Recognise a wrong network configuration that causes mvme88k tftpboot to stall, inform user what to do.
Clean up parsing of dhclient(8) option lists: syntactically incorrect request statements in dhclient.conf(5) are ignored; pass size of buffer being filled instead of assuming 256; always zero the passed in buffer; check for out of bounds index prior to using it.
Don't assign the "host" MAC address to sparc64 virtual switch ports or print address for those ports.
Better ldomctl(8/sparc64) error reporting.
Don't segfault if no dhclient(8) subnet-mask is provided, or is marked "ignore" in dhclient.conf(5); always zero out stack masks rather than using stack garbage when no subnet-mask is provided.
make(1) fixes: be more strict in recognising .if keyword() constructs; don't ignore unknown keywords; uniform white space handling; don't output a "." at the end of directory; complement "need an operator" fatal error message with the actual line content.
Make login_yubikey(8) hex and modhex decoding case insensitive, to avoid shift/caps lock issues.
Handle up to 256 different interrupt vectors on cbus(4/sparc64). This is enough for 128 channels.
Updated to: nsd(8) 3.2.14; pixman 0.28.0; xf86-video-r128 6.9.1; xf86-video-mga 1.6.2.
Display hardmtu value when "ifconfig(8) hwfeatures" is used.
Add SIOCGIFHARDMTU to allow gre(4) to retrieve the driver's maximum supported MTU.
Always pass an array of struct pf_src_node pointers to the pf(4) pf_map_addr. Avoids stack corruption.
Use the libutil imsg framework rather than a hand-rolled local version for dhclient(8).
Send ack on smtpd(8) "update map".
Replace aucat(1) server by a new sndiod(8) daemon that is simpler, smaller and faster.
Make the aucat(1) client wait for the first flow control message rather than assuming it can send a full initial data buffer.
Update to libxcb 1.9.0.
Sparc64 attempting to eject a CD-ROM makes the SCSI midlayer generate a READ_TOC command. Silently fail that command instead of spamming the console.
Fixed relayd(8) strtonum(), as it can only handle a maximum of LLONG_MAX.
Try to negotiate version 1.1 of the vDisk protocol to get vdsk(4/sparc64) media type and fake a CD-ROM drive.
Plugged a cu(1) file descriptor leak.
Added ldomctl(8/sparc64) and ldomd(8/sparc64) to the build.
Delete oce(4) rx refill timeouts when bringing an interface down.
D-Link DUB-E100 rev C1 now recognised by axe(4).
Made the mips and powerpc gcc(1) optimiser bug workarounds permanent (i.e. applied them to all platforms).
Allow "smtpctl(8) show queue" to run in "online" mode if the smtpd(8) server is running.
Do not crash on stray .Ta macros mandoc(1) finds outside column lists.
Fixed gcc(1) passing of struct by value on m68k. Lets gcc(1) version 3 reliably bootstrap itself now.
Added atomic 32-bit cas operations to amd64 and i386. Needed for future acpi(4) global locking routines.
Added tmux(1) halfpage commands to mode command string table.
Use a utility function to show errors in tmux(1) config file.
If uvm_km_kmemalloc_pla() fails when just creating a thread (and not a process), then don't decrement the total and per-user counts of processes.
In mandoc(1) -Tman mode, support automatic word "keeps" in the SYNOPSIS (like -Tascii mode); don't escape the blank characters terminating man(7) macros.
Make mandoc(1) generated man(7) code more portable by using .PD instead of .sp -1v.
Don't output "$action not supported" when running rc.d(8) script from /etc/rc(8). Prevents warning at shutdown time when the script has rc_stop=NO.
Small i386 memcpy optimisations to avoid unnecessary locks.
Ensure that the base provided to strtol(3) is between 2 and 36 inclusive, or the special value of 0.
Don't map a buffer (and potentially sleep) when invalidating it in vinvalbuf. Fixes a problem where we could sleep for kva, leading to invalid pointers on the next pass through the loop.
Simplify vio(4) vio_iff(), set own MAC in unicast MAC filter (needed by virtualbox).
Don't send iwn(4) with "advanced" bluetooth coexistence the configure coexistence command. Avoids firmware crash.
Added initial iwn(4) support for Intel Centrino Wireless-N 1030.
Warn about unknown volume/arch in mandoc(1) Dt macro arguments.
Third implementation of m88k gcc(1) varags (upstream version still wrong).
Fixed mandoc(1) for .Ap and .In trailing delimiters. Fixes the end of sentence spacing in open(2).
Improve mandoc(1) formatting of badly nested font blocks.
Run dhclient(8) discover_interface() before forking, so both processes will know the interface information.
Added missing "break;" so that IFT_ETHER dhclient(8) routes are deleted as intended.
Fixed mandoc(1) crash triggered by .Bl -tag .It Xo .El .Sh.
Print macppc UniNorth/U3 revision number (taken from openfirmware) to show which AGP chipset is present.
If max-prefix/restart are used in bgpctl(8), display the values in "bgpctl sh nei" output.
No longer try to transmit packets if the vr(4) interface is not running.
If dhclient(8) "-d" is specified, don't redirect privileged child's stdin/stdout/stderr to /dev/null.
Updated nginx(8) to 1.2.5.
cwm(1) tab-complete bug fixed: once exec_path is completed, allow for subsequent completion.
Fixed dhclient(8) so "ignore subnet-mask;" will work.
Allocate an oce(4) mailbox payload dma memory upfront, instead of per request.
Added axe(4) support for the lenovo usb 2.0 ethernet adapter.
Avoid segfault in the unlikely event that a NULL device is passed to tcpdump(8) priv_pcap_live().
Allow the full range of unsigned serial numbers for ssh-keygen(1).
Fixed username passed to ssh(1) helper program; prepare stdio fds before closefrom().
Adjust Makefile.cross to allow cross-gcc to build using different compiler version than the target.
Do an oce(4) OACTIVE/if_start dance only once per tx interrupt.
Enabled hardware tx checksum offloading for oce(4).
npppd(8) can now handle file descriptor exhaustion in the accept() case.
Correct the first argument of agpmmap(), making possible to mmap the agp(4) aperture.
Make sure smtpd(8) does not miss the last envelope.
Allow bgpd.conf(5) filtering based on NEXTHOP attribute (eg "allow from any nexthop neighbor").
smtpd(8) improvements: log more events, with each messages prefixed with a token to identify its class; implement "smtpctl(8) monitor" to display updates of selected internal counters; when reloading the on-disk queue at startup no longer commits a message if no envelope was submitted for that message.
fmt_scaled(3) now sets errno to EINVAL (not ERANGE) if it hits an invalid multiplier, to match man page.
Fixed a potential ldapd(8) memory leak.
Once a rdist(1) C_RECVDIR command is sent, send matching C_END command later, even if opendir() fails or nodescend option is set.
Fix various rdist(1) and rdistd(1) format string issues. Stop assuming time_t is long or smaller. Enable warnings.
Fix pid matching on kernel crashdumps.
Added support for the Intel Centrino Advanced-N 6235 to iwn(4).
Stopped mg(1) updating character offset on the line all the time (astoundingly hostile to slow terminals).
Fix dhclient.conf(5) "default" directive (broken in code refactoring).
dhclient(8) supersede/append/prepend actions works again even if the dhcp(8) server doesn't send any data for the affected option (broken when the supersede/append/prepend/ignore logic was re-factored).
Try to load the gallium3d "swrastg" driver if available, before falling back to the default mesa "swrast" one for software rendering.
Rewrote axe(4) and smsc(4) receive filter handling code; cleaned up the ioctl.
prevent athn(4) calling athn_detach unnecessarily if shared code was not initialised.
Enhanced sysmerge(8) error_rm_wrkdir() to print an error message if one is passed as an argument.
Read CPU frequency from the fixed-function performance counter of on x86 chips with constant time stamp counters. Lets sysctl(8) hw.cpuspeed and hw.setperf reflect correct values.
Per POSIX, fix raise(3) and abort(3) to send the signal to the current thread.
Don't sync oce(4) dma memory for the whole ring when updating a single entry.
Ported most gcc(1) version 2.95 m88k fixes to the gcc(1) version 3 codebase.
Improved oce(4) flow control code.
No longer disable VLAN promiscuous mode, so oce(4) can receive ethernet packets with VLAN tags.
libtool(1) now properly filters symbols on elf(5) systems; runs nm(1) on every object and static library we might need, so we don't lose anything; allows for the result to be empty.
Fixed libtool(1) get_symbollist: output completely empty file if no symbol; and more debug info.
oce(4) driver now matches hardware, to support mtu values from 256 up to 9000.
When halting the oce(4) rx engine, avoid firmware DMA'ing into the freed cluster.
Fixed kernel builds without bpf(4).
Close dhclient(8) routing socket fd leak when deleting old address.
Fix arp(8) so "route -Tx exec arp -an" uses the process rdomain, but still allow command line overrides.
Don't depend on IFCAP_CSUM flags when configuring ix(4) rx checksumming; corrected an incorrect usage of IXGBE_RXCSUM_PCSD.
Plugged cwm(1) leak when using "unmap" for kbd/mouse bindings.
Fix vfs(9) and uvm(9) to allow the cleaner and syncer to run even when under intense memory or kernel virtual address pressure; correct cleaner and sleep/wakeup cases when memory and kva are low.
Enable %tick access for userland on sparc64 sun4u systems.
Tab completion support for cwm(1) menus.
make(1) no longer kills trailing spaces (not shared by other makes, or any standard).
oce(4) no longer depends on IFCAP_CSUM flags set when reading rx checksumming results from the hardware.
Fixed dc(1) fractional number exponentiation (including for negative exponents).
Always setup lo0 with 127.0.0.1/8 when configuring the network, whether installing or upgrading.
Added pci(4) recognition of video and host bridge found on new Atom motherboard.
For dc(1) exponention, only warn if the fractional part of the exponent is non-zero; avoid div by zero.
Removed smtpd(8) mta_session "is_reading" hack and simplified the read/write logic.
Workaround for pkg_add(1): don't tie python files for now, so timestamps don't trigger recompile.
Make pkg_add(1) force pkglocatedb-- when auto-installing.
Fixed a bug where the return value of if_exists() was not checked correctly if the interface disappears while pflogd(8) is running.
Ensure that pflogd(8) if_exists() always closes its socket before returning.
5.2 stability fix for relayd(8) check icmp.
Use myx(4) SIMPLEQ-based packet descriptor managing code for oce(4).
Call in[6]_proto_cksum_out() unconditionally, to fix checksum issues seen on ramdisk kernels.
Fixed memory leak in error paths for synaptics(4) and alps.
Backport a powerpc --relax fix present in binutils 2.17. Allows mozilla trunk to finally link again.
Switched sparc to timecounters.
Show last tmux(1) client activity time in the default choose-client list.
Typedef'd pthread_key_t to an int instead of a volatile int. Allows webkit with --enable-debug to build.
Run chown(8)/chgrp(1) only if the preceding mknod(8) call worked.
Properly clear the dhclient(8) UP flag when forcing interface down/up, rather than setting all flags to zero.
Make ldomd(8) consume ACKs when doing large sends.
ldomctl(8) support for listing/selecting configurations store on the SP.
Call service start function if a particular ldomd(8) domain service has been successfully registered.
Include declaration of sparcDriverName() to fix segfault on sunffb graphics.
Switch mvme68k to timecounters.
Remove default of AuthorizedCommandUser from sshd_config(5). Administrators are now expected to explicitly specify a user.
Stop dhclient(8) and resolv.conf(5) passing interface names around needlessly when creating/flushing routes.
Fixes for resolv.conf(5) handling: Don't leak a file descriptor if there are no contents for resolv.conf(5), and delete this file if it is zero-length; allow for only resolv.conf.tail to go into resolv.conf.
Fixed potential mg(1) memory leak, found by llvm.
Don't leak a mg(1) file descriptor when testing for permissions; make sure directory is executable, otherwise we can't list it.
Introduce better and simpler oce(4) producer/consumer queue iterator implementation.
Remove 13 years old compiler bug workaround in m68k pwd_mkdb(8) code.
Avoid some misaligned accesses. Lets dhclient(8) work again on sparc64.
Added smtpd(8) "kick counter" to detect and disconnect clients that hog the session.
New malloc(3) option "U" to "free unmap": guards/unmaps freed allocations without disabling chunk randomisation. Offers better defence against "heap feng shui" style attacks.
Unstick bgpctl(8) reload after reloading a bgpd.conf(5) that contains errors.
Stop dhclient(8) adding a "nameserver" line to resolv.conf(5) if the nameserver in question is the empty string.
Consistency and robustness improvements in smtpd(8) mda.
Make smtpd(8) counters more informative in the scheduler: number of envelopes added or cancelled; properly report envelope counts, as well as the outcome of deliveries.
Watch the non-privileged end of the pipe to the privileged dhclient(8) child process. So when the child dies, the parent exits immediately.
Include tcp/udp.h unconditionally to unbreak rd(4).
Don't let aucat(1) insert twice recorded wav files (-o) on the list of recorded files.
Fixed aucat(1) crashes when wav_close() is called on uninitialised wav structure.
Use dedicated messages for flow control (instead of clock tick) and enable flow control for aucat(1) MIDI.
Switched alpha to per-process astpending.
Repaired __tfork_thread(3) operation for alpha.
When possible, have vcc(4/spar64) send multiple characters per packet; stop sending when the transmit queue is full; set a timeout to avoid stalling.
Stopped acpitz(4) showing Kelvin units; fixed Celsius measures (no longer off by a factor of 10).
Forcibly delete all existing ipv4 addresses from an interface as dhclient(8) binds new lease to that interface. Fixes unexpectedly persistent addresses and failures of dhclient(8) when switching an interface repeatedly between different networks.
Enable softraid boot support for i386 cdboot(8) and pxeboot(8).
Make i386 cdboot(8) and pxeboot(8) work correctly when it is larger than 64KB in size.
Enable softraid boot support for i386 boot(8).
Add support for Intel's Supervisor Mode Access Prevention (SMAP) feature to i386 and amd64.
Some fixes for the vio(4) receive filter handling.
New sshd_config(5) option AuthorizedKeysCommand to support fetching authorized_keys from a command in addition to (or instead of) from the filesystem.
Removed dhclient-script(8) and dhclient.conf(5) "script" directive. Do all interface and route configuration via ioctl's and routing sockets.
Prevent underflows in pfsync(4) and pflow(4) by using signed variables.
Use monotonic time_uptime for pfsync(4) and pflow(4) expiration values as time_second can be skewed at runtime.
Bump the default number of descriptors in ix(4).
On UltraSPARC T1/T2, block the current strand while spinning so other strands can do some useful work.
On cwm(1) reload, look for ignore and bwidth changes; ensure existing maximised windows don't inherit new bwidth.
Attach the synaptics(4) driver to elantech touchpads during auto-configuration.
Make amd64 cdboot(8) and pxeboot(8) work correctly when they are larger than 64KB in size.
Enable softraid boot support in amd64 cdboot(8) and pxeboot(8).
Added support for Elantech touchpads to pms(4), so X synaptics(4) driver can configure these touchpads properly.
Teach wsconsctl(8) about the elantech mouse type.
Limit the number of smtpd(8) messages/recipients that can be enqueued on a single SMTP connection.
Changed dhclient.conf(5) directive 'ignore' to take a list of option names rather than list of option declarations. e.g. "ignore routers;" instead of "ignore routers 1.2.3.4;"
Made it possible to use ldomctl(8) to reconfigure when ldomd(8) is running.
Fix ldomd(8) var-config response messages. Makes OpenBoot stop complaining about not being able to update LDOM variables.
Use ldomd(8) to provide the var-config domain service to all the currently configured guest domains.
Give ldomd(8) its own copy of the domain services support code and modify it to handle multiple channels.
All softraid(4) boot(8) support is now enabled by default, including support for booting from crypto volumes. Can be completely enabled or disabled at compile time.
Made sndio(7) midi code use non-blocking i/o like the other audio code.
Check that sndio(7) polled fd number is smaller than SIO_MAXNFDS, and crank maximums.
For sparc64 devices that attach to cbus(4/sparc64), disable interrupts up-front and explicitly enabling them later than the other way around.
Fixed potential mg(1) memory and fd leak.
Fix for perl(1) CVE-2012-5195.
Work-in-progress code for ldomd(8), a daemon running in a sun4v control domain that provides some essential services to guest domains.
Don't abort ldomctl(8) when we try to reset the logical domain channel.
Fixed previous revision, which would prevent grtwo(4/sgi) boards from being recognised.
Properly clear hppa trap frame in setregs() to avoid leaking registers across exec.
Disabled rc.d(8) reload, since SIGHUP kills smtpd(8).
Handle the case where smtpd(8) writev() fails with EAGAIN.
Made oce(4) oce_mbox_{dispatch,wait} more readable and use less bitfields.
Simplify/unify writes to the oce(4) rx and tx doorbell registers.
Use an external chunk of DMA for oce_set_promisc, so the commands sent to oce(4) fit in memory.
Added syslog support to nginx(8) in base.
Added ability to active pane in tmux(1) list-windows and find-window formats.
Fixed tmux(1) BELL_NONE which had become broken; also don't redraw unnecessarily.
Fixed bad size in tmux(1) memcpy.
Allow the smtpd(8) mda to deal itself with session limits, to makes the server handle envelope bursts more efficiently.
Use correct file for mg(1) revert-buffer; do not ignore abort.
Fixed fringe make(1) case where argument length is around 140.
Treat cwm(1) menu width the same as the height is treated when deciding its max size and location.
Stop drawing when cwm(1) menu doesn't fit inside the screen.
Added a new iked(8) option -t to optionally enforce NAT-T with UDP encapsulation on port 4500.
Fix NAT-T support in iked(8) , both on the initiator and the responder side.
Add jme(4) flow control support.
Provide mii(4) flow control status.
Add (r)evert prompt to mg(1) "File changed on disk; really edit the buffer" prompt.
Check for dirty buffer on mg(1) buffer change.
Add flow control support to gem(4).
Fix the oce(4) multicast filter full size check.
Bugfix for userland program attempting to do a semop(2). Kernel returns ENOSPC rather than panics.
Repaired maestro(4) pci powerstate handling and resumes.
Add the IP_DIVERTFL socket option on divert(4) sockets to control which packets (as in direction) of the traffic will be diverted through the divert socket.
Add domain services support code to ldomctl(8) and use it to fetch the PRI (Physical Resource Inventory) from the service processor.
Implement vr(4) transmit DMA segments.
Fix hardware kill switch detection for the ar9300 chip family.
Fixed a potential double free in mg(1)
Make xf86-video-intel hdmi modesetting code handle multiple display pipes.
Simplify xl(4) for multicast ranges.
Convert ethernet driver code which predates pci_set_powerstate() to using it instead.
Numerous make(1) error message fixes.
Switched luna88k to timecounters.
Disallow pf.conf(5) tables and address pools for rdr-to, nat-to and route-to with any other scheduling algorithms than round-robin or least-states. Stops pfctl(8) accepting invalid address pools.
Cleaned up more of the pckbc(4) driver soft-state when suspending.
Enable sparc64 vldc(4) and vldcp(4).
Renamed hvctl(4) to vldcp(4), since this driver now handles other services as well.
Make the ath(4) iv show up properly for big endian bpf(4) consumers.
Add support for multiple channels on sparc64 hvctl.
Add domain utilisation to status display to ldomctl(8).
Change amd64 PCI memory extent to cover the whole 64-bit memory space; fixed erroneous extent allocation panic on IBM x3100.
smtpd(8) MAX_RULEBUFFER_LEN was too small, bumped.
-r switch and -d depth option added to mput command of ftp(1) client.
Added support for recursive ftp(1) upload.
In ldomctl(8), specify domains by name instead of by number, provide status of all domains if none specified.
Implement "smtpctl stop" in smtpctl(8).
In sd(4), do a flush of the disk before hibernate to clear the buffer cache.
Limit the number of per-user mda (external program) deliveries that smtpd(8) can be running at the same time, to cope with long-running filters in .forward file.
Limit number of envelopes sent by the smtpd(8) queue to the mda, to avoid file descriptor exhaustion.
Beginning of ldomctl tool, to control sun4v logical domains. Currently can start and stop domains.
smtpd(8) will now enforce different permissions on different files in ssl_load_file().
Avoid some unnecessary aliases expansion in smtpd(8).
Move xl(4) WOL activation to DVACT_POWERDOWN (instead of doing it twice).
Stop xl(4) putting itself into D3 mode when going to WOL; allow pci(4) subsystem to do that based on BIOS information if it needs to.
When smtpd(8) makemap is executed in sendmail mode, check if ".db" is part of the filename and imply it otherwise so "makemap hash /etc/mail/aliases < aliases" works.
smtpd(8) alias expansion and ruleset matching code now checks for failure to distinguish between "no match" and "internal error" (e.g. missing or broken db file)
Added I-O DATA RSA-PCI2 support to pci(4).
Implement mg(1) "revert-buffer", which reverts the current buffer to on-disk copy.
Fixed make(1) infinite loops on regexps that match the empty word, instead advance by one char and repeat.
Extend smtpd(8) "retry" field to 16 bits. Former size too small for quadratic retry formula.
Fixed "disable lidsuspend on shutdown" in init(8).
Replaced "from all" and "for all" with "from any" and "for any", and "all" with "any" in smtpd.conf(5).
Fixed make(1) cond parser to be able to handle .if 5 < 7 directly.
Initialise the protected mode IDT after zeroing .bss to fix pxeboot(8/i386).
smtpctl(8) can display envelopes and messages using their id. Allows easier queue inspection.
Mark if smtpd(8) alias node has been expanded from an alias map, as local deliveries expanded from alias map are run as user _smtpd.
smptd(8) will now show the port number for a relay if specified.
Revert dhclient(8) r1.155. Routing breaks if dhclient-script(8) flushes the interface's routes when the interface is down.
Fix the relayd(8) hash http filter action to initialize the hash key correctly.
Clear ieee80211 powersave flag and purge queued packets when a node leaves the AP. Fixes issues with power saving.
Allow smtpd(8) listen statement to impose tls on its clients.
smtpd(8) will reject ssl key/certs/CA/DH files if their ownership/permissions are not correct.
make(1) engine change: prevent jobs from stomping on each other's files. Fixes races in make -j4 build in src.
Add nscan as a disk queuing algorithm, make it the default with n = 128. Better performance for long sequential writes.
Limit writes in flight to disk from buffer cache (via bufq) to a high water mark.
Teach amd64 boot(8) how to access a softraid crypto volume. Allows for full disk encryption. Currently disabled by default.
Enabled Supervisor Mode Execution Protection (SMEP) for i386 and amd64, found in recent Intel chips.
Fixed X(7) xserver re-opening mouse after VT-switch.
Revamped suspend/hibernate -> resume. If suspend sequence fails, now possible to recover along the resume code path.
Provide a mechanism for kernel to pass data through to the discipline during softraid(4) volume assembly.
If amd64 booted from a bootable softraid(4) volume, always select the srX device unless the "a" partition of the disk is FFS.
Force MIT-MAGIC-COOKIE auth for all displays, like we do for :0.
Updated nginx(8) to 1.2.4.
Reduced the difference between i386 and amd64 versions of the speedstep code.
smtpd(8) will now skip RR if type is not MX. Use hostname if the list of MX is empty after the loop.
Align hppa stack on a 64-byte boundary, so gcc(1) can properly align stack variables.
Provide a sendmail(8)-like interface to makemap so that some tools that assume sendmail(8) do not break.
Bump max number of connections to a route from 5 to 10 in smtpd(8).
Updated xkeyboard-config to 2.7.
Stop gcc(1) from wrapping system headers with an implicit extern "C". Unbreaks the webkit port.
Add basic support for ivy bridge to xf86(4)-video-intel; allows multiple display pipes to work.
Point interface directly to its bridgeport configuration, instead of to the bridge(4) itself, to improve performance.
Default map source to S_PLAIN, this allows us to simplify smtpd.conf(5).
Delay the smtpd(8) call to log_debug() for displaying the backends used until the "real" debug mode is set.
Added umac128 variant to ssh(1).
change smtpd(8) to from=<...>, to=<...> instead of to=<...> for logging.
Use information provided by acpi(4) to attach secondary pci(4) host bridges.
Stopped smtpd(8) backup MX trying to connect to itself and bounce in the loop detection code.
Use a buffer large enough to fit a smtpd(8) mailaddr user-part, to avoid a fatal error.
Disallow smtpd(8) root deliveries for "deliver to filename" and "deliver to mda" rules. Users should create a root alias instead.
Stop smtpd(8) trying to cope with iobuf_init() failure, make it fatal() instead.
Only show relayd(8) "inflight" debugging message if compiled with DEBUG > 1.
Inherit and pass the relayd(8) relay table flags correctly.
Support more than one relayd(8) relay backup table.
Attach uath(4) to D-Link WUA-2340.
make(1) changes: put back some job control that's necessary when we don't run a shell; improved debugging and -p output to sort variables, targets, rules, output stuff in a nicer format mimicing input; better error message when no command is found, explain where the target comes from; sort final error list by file; show system files in errors as <bsd.prog.mk>; reincorporate random delay; and optimise siginfo output by not regenerating the whole string each time.
Allow tmux(1) session tree (C-b s) to expand and collapse sessions with left/right/space keys.
Fixed ssh(1) -z option, broken in revision 1.215.
Add some random PEN (private enterprise numbers) to snmpd(8).
Support 0.0.0.0 and 255.255.255.255 IPv4 addresses in snmpd(8). Fixes aborting address traversal / SNMP walk when an "any"/0.0.0.0 address was configured on an interface.
When outputting to stdout and compress(1) would grow the file, exit normally instead of with a value of 2. Also avoids unlinking the file "stdout" in the current directory in this case.
Added decision to the smtpd(8) rule so that we can properly perform a "reject from" or "accept from" match.
Fixed baud rate setting on uslcom(4) CP1201/2/3 devices; add support for hardware flow control.
Fix address family for ipv6 bpf(4) packet capture in pipex(4).
Add support for the Adaptec 39320LPE controller.
When merging messages from an update, and message already exists in the main queue, don't count it twice.
Use a smaller buffer size when not attached to a high speed/usb2 controller. Fixes smsc(4) with usb1 controllers.
Fixed a tmux(1) file descriptor leak.
Fixed smtpd(8) memory leak in case of fdopen() failure.
Don't report link status unless ale(4) interface is up. Status is only valid when the interface is up.
Add support for VLAN sized frames to se(4).
Added D-Link DGE-530T support to re(4).
Log final user and method used for local deliveries in smtpd(8).
Correct iked(8) DPADD to not list libssl, which it does not use.
Fixed aucat(1) master volume slider stuttering in MIDI programs.
Stop the space char completing a file name in mg(1). Mimics more recent versions of emacs.
Add minimal support for gen7/ivybridge in inteldrm. Manages memory; no attempt to setup the rings.
Add tmux(1) notification for input from a pane.
Fix tmux(1) search forward so it can match strings on the last line, SF bug 3571114.
pf(4) now enforces a more sane 'frags' limit.
Added tmux(1) control_write_buffer.
Better tmux(1) test for when recovering current working directory.
Use ACS characters for tmux(1) choose-tree arrows.
Allow route(8) -T 3 add to create a table even if the table does not exist yet. The only way to create alternate routing tables.
Enable bgpd(8) graceful restart by default. Disabled per neighbour with "announce restart no".
Unlink imake and cf from build. This now is in ports.
On i386, make sure we send MSIs to the primary CPU like we do on amd64.
Fix for VU#624931 CVE-2012-2978 to to 5.1-stable: nsd(8) denial of service vulnerability from non-standard DNS packet.
smtpd(8) now logs envelope status in a uniform way, automagically adding a rcpt=<user@domain> field if "dest" differs from the original "rcpt".
Fixed sftp(1) handling of filenames containing escaped globbing characters, and escape "#" and "*". Also, fixed improper handling of absolute paths when pwd(1) is part of the completed path.
relayd(8) file descriptor accounting for relays: reserve fds for unopened connections to backend servers.
Major overhaul of the way make(1) handle jobs.
Added sensor types to sensor framework: pressure (10^-3 Pa); distance (10^-6 m); acceleration (10^-6 m/s^2).
Fixed ospf6d(8) kroute code to read the scope of the route correctly.
pfsync(4) now restores carp(4) demotions, so it won't leave the machine in a demoted state.
Don't filter spanning tree BPDUs. Either process, or forward them (avoids bridging loops).
Added driver for Toradex OAK usb sensors: uoaklux(4): LUX USB illuminance sensor; uoakrh(4) USB temperature and relative humidity sensor; uoakv(4) USB +/- 10V 8channel ADC interface.
Enable npppd(8) and npppctl(8) in default build. Add npppd(8) to rc(8) and install sample configs to /etc/.
Allow ntpd.conf(5) to assign a stratum to a sensor with the syntax "stratum <level>".
Be consistent between installer and useradd(8), and put newly created users into their own primary group. Does not change existing installations that already have a usermgmt.conf(5).
Lower pf.conf(5) frags limit. Avoids running out of mbuf clusters when dealing with lots of IP fragments.
Set up i386/amd64 pci(4) bus number resource accounting for the main PCI bus hierarchy.
Add resource tracking for pci(4) bus numbers. Stops attaching the same bus twice.
Add i386/amd64 support for the rdrand instruction found in recent Intel processors.
When a socket(2) is spliced, it may not wakeup the userland for reading. Avoids race condition.
Added drivers for virtio(4) network (vio(4)) and block devices (vioblk(4), the disks attach as scsi disks).
Fix relayd(8) ICMP checks by setting the socklen correctly before calling recvfrom().
Several tweaks to make mpi(4) work for vmware emulated sas adapters, and improved error reporting.
Once resolv.conf.saved has been copied back as resolv.conf(5), delete so it isn't copied again the next time a dhclient(8) goes away.
Support the Lenovo ThinkVision LT1421 (portable displaylink monitor) with udl(4).
Added udl(4) support for 1366x768 widescreen displays.
Wait until all pci(4) transfers have finished before giving up DMA buffer mappings.
New configuration syntax for npppd(8). npppd.conf based on parse.y; npppd-users based on getcap(3).
Add bounds check on sftp(1) tab-completion.
Print the weight in the bgpctl(8) "show rib" detail output.
Don't accept dhclient() leases that offer a subnet that is already configured on an interface.
Add 2 new knobs to usermod(8): "-U" to unlock an account; "-Z" to lock an account.
When a link is lost, call dhclient-script(8) with reason "FAIL". Removes 'dead' routes.
Added IPV6_RECVDSTPORT socket option. Enables ip6(4) to get original (= before divert) destination port of a UDP packet.
Fix relayd(8) statistics.
Fix format expansion in smtpd.conf(5) to be less confusing.
Fixed a smtpd(8) bug where local sessions were not accounted for.
Simplify fw_update(1) detection of release/stable vs. snapshot kernel.
Recognise executables tagged with ELFOSABI_OPENBSD as native executables. Fixes Go language port.
Add initial SNMPv3 support to snmpd(8). Configuration is described in snmpd.conf(5).
clear old ssh(1) keys on re-keying.
Improved xf86-video-intel hack to restore text mode on ironlake/sandy bridge.
Ensure we have at least two smtpd(8) descriptors per-client accepted, to avoid fatal when client sends DATA, and we don't have a descriptor for it.
Allow smtpd(8) queueing to work properly when IPv6 disabled.
Encode ipsecctl(8) transform parameters in the transform name, too. Unbreaks setups that allow multiple transforms for a connection.
m88k does not have the m68k long double type, so don't build long double libm routines.
Don't read the sndiod(8) xrun counter before the offset in the audio ring. Stops potential timing error.
When printing smtpd(8) ioev, do not segfault if there is no associated iobuf. Also give info about the cipher if there is an ssl(8) context.
Check limits before allocating the smtpd(8) session.
Tell make(1) that "!" is a shell reserved word, this lets "test: ! pgrep process" work, without trying to look for a '!' command.
Stop xinstall unlinking destination if we can't open the source file. Avoids race condition and fixes a problem with databases/ruby-ldap.
Fix malloc(3) precedence bug (& has lower precedence than !=).
Simplify the way we call the rc.d(8) script in "restart".
Added mii(4) code to support recent chips which have phys in locations other than phy address 1.
Define empty CDIAGFLAGS for programs that use Werror. Makes "make build" build with WARNINGS=Yes on amd64.
Fixed a sasyncd(8) race condition which would cause segfault.
Better bgpd(8) graceful restart support. Implements only the "Restarting Client" bits of the RFC. Off by default ("announce restart yes" to enable it).
Prevent detection of bogus libraries by ldconfig(8).
Cherry-pick upstream's commit to convert the openchrome driver for compatibility with xserver 1.13.
Simplify smtpd(8) scheduler by making it a quadratic delaying (delay derived from the retry count).
Initialise smtpd(8) fd correctly. Fixes many problems.
Support uftdi(4) FTDI FT2232H.
Removed "OLF method" used for transition from a.out to elf(5), and compat layers.
Fixed some smtpd(8) scheduling loop issues and handle envelope scheduling/expiration better.
Add checks before deciding vmt(4) vmt_probe has succeeded. Prevents doomed attempts to attach on qemu, while allowing it to still work on vmware.
sh architecture moves to PIE.
Cleanup vfs(9) mount string handling.
Added missing pppoe(8) IPv6 congestion indicator code, and drop the unencrypted packets when the MPPE is required.
Fake a sigwinch after each job, so if the terminal changes size, ksh(1) will notice and update.
Allow cwm(1) clients to be resized from a max state.
Set use_collect2 on m88k. IMPORTANT: recompile/reinstall libc, libobjc, libpthread and libstdc++ immediately after installing the new gcc.
Updates to: xf86-video-wsfb 0.4.1; xf86-video-wsudl 0.2.2; xf86-video-wildcatfb 0.0.2; and xf86-video-dummy 0.3.6.
Reverse the order that ctors and dtors are run. Fixes gcc(1) C++'s init_priority attribute.
Switch hp300 and landisk to timecounters.
Wrap all the agp(4) glue with "if __OS_HAS_AGP" in such form that it is true if the agp(4) driver is present.
Update to: xf86-video-s3 0.6.5; xf86-video-s3virge to 1.10.6; xf86-video-sis 0.10.7; xf86-video-tdfx 1.4.5; xf86-video-trident 1.3.6; xf86-video-mga 1.6.1; xf86-video-r128 6.8.4; xf86-video-savage 2.3.6; xf86-video-vesa 2.3.2; xf86-video-siliconmotion 1.7.7.
Plug a race where we're trying to kill a traced process while it is already exiting.
Bump amd64 CPU feature strings to 12 chars, since some names are now 8 characters long.
Call pci_min_powerstate() to determine the lowest possible powerstate instead of hardcoding it to D3.
Fixup a mpii(4) memory access fault on an invalid reply.
Make mg(1) C-r not screw up the line counter if the pattern ends up not matching.
Create IPv6 privacy addresses even if static IPv6 addresses are present. Restores ability to use privacy addresses for outgoing connections and static addresses for incoming connections (broken by r1.62).
Make ssh(1) muxmaster run with -N shut down gracefully when a client sends it "-O stop".
Print '^Z' instead of a raw ^Z when the sequence is not supported by ssh(1).
Removed compat_aout support for i386.
Make all dos file names 11 byte array. Fixes "panic: smashed stack in msdosfs_rename.c".
Make the ssh(1) escape command help (~?) context sensitive, so only commands that will work in current session are shown.
shorter display for minor pkg_add(1) updatesets, "foo-0.0->foo-1.0" becomes "foo-0.0->1.0".
Add ssh(1) ~v and ~V escape sequences to raise and lower the logging level respectively.
ksh(1) sh -c should not munge argv[]. Fixes ps(1) -ww output.
rm(1) will now overwrite with random stream (a repeating chunk of random data isn't random at all).
COMPAT_O48 turned off in GENERIC kernel.
Implement basic (blocking) YP support for getaddrinfo_async(). YP is now supported on all relevant resolver functions.
Handle empty list properly in tmux(1) choose-list.
tmux(1) can't tell what a terminal has done with a DCS string, so reset cursor and attributes afterwards.
When running fw_update(1), don't let pkg_add(1) turn interactive, and waive the @ask-update questions.
rtadvd(8) config code no longer truncates a pointer to int, before checking the low bits.
rm(1) now only does one random overwrite, as this is deemed sufficient.
crypt(3) now uses arc4random_buf(3) to fill buffers.
Added support for -fPIC to sparc.
Fixed log_err() calls in sasyncd(8).
Fixed the smtpd(8) example filter to match current API.
Resolve unchecked malloc(3)s in scsi(8).
Teach as(1) about rdrand on i386/amd64.
Use the correct index when adding item in tmux(1) choose-tree.
When choosing a pane found by tmux(1) find-window, switch to that pane rather than just the window.
Added cmd-choose-list to tmux(1), to allow arbitrary options to be selected.
Send notifications to control tmux(1) clients. Also don't redraw client when suspended.
Start with stdin disabled, so tmux(1) doesn't eat anything (eg pasting commands).
Unbreak compilation of umidi(4) when no DIAGNOSTICS are defined.
Make profiling work on hppa.
Take hppa to PIE as well.
Be nice to the sndiod(8) server and align data packets to audio block boundary.
Enable PIE on alpha.
Always update ifi->linkstat in dhclient(8) dispatch() loop.
Remove support for smtpd(8) encrypted queue, to be reintroduced later.
gcc(1) fixed to stop segfaults on landisk when building mysql; PR #28467.
Show more precisely what the problem is when using pkg_add(1).
Make rc.d(8) "-f" only affect the "start" action.
Compile ld.so(1) with debug info. Helps ld.so(1) hacking and easier to debug code that uses dlopen(3).
Allow "filename too long" error message to be seen; error now stops mg(1) exiting when C-x C-c is called.
Enable PIE on amd64, mips64(el) and sparc64.
Switch gcc(1) to use __guard_local instead of __guard. Allows GCC to emit -fstack-protector code that doesn't need GOT indirection for accessing __guard.
Wake on LAN support added to nfe(4).
Reset an mg(1) errno, so we can save a new file in a directory where permissions are ok.
On SPARC64 VI/VII CPUs, sleep while spinning (may let another thread do some useful work).
Stop ipsecctl(8) issuing a spurious "force" when "group none" is specified.
When reloading envelopes from disk, skip ones already known to the smtpd(8) scheduler.
Correctly free the smtpd(8) mta task if all rcpt where rejected; fix refcounting; add some stat counters.
Moved pmdb(1) to the attic.
Fixed pf(4) sloppy state tracking missing half the connection in asymmetric setups and ignoring state match in icmp(4) direction checks.
Use (rate / 15) as block size in aucat(1) off-line mode, to ensure the block size stays below SHORT_MAX.
Stop odd things happening in mg(1) cursor and line counter if you open an already open buffer via C-x C-f.
Allows user to decide what to do with buffers experiencing write errors during C-x C-c (exiting mg(1)).
Remove libexec/tftp-proxy now we have usr.sbin/tftp-proxy(8).
Code added to eventually support Multi-Threaded Processing on Fujitsu SPARC64-VI and SPARC64-VII CPUs.
Fixed random SIGSEGVs during single-stepping on hppa.
Test exit status of compiler by pulling it out the pipeline, so mkdep(1) can fail if the compiler does.
Build libdrm_radeon on macppc too, required for upcoming drm(4) support. Also, build r200 and r300 dri drivers on macppc.
Our gcc(1) _mcount doesn't use profile counters. Partially fixes profiling on hppa (things link now).
Make update-moduli append the 6kbit and 8kbit params so that we can trivially regen the <=4k bit ones.
Update to openssh-6.1.
Do not add SLAAC or privacy addresses when a static address in the same prefix already exists.
Add support for PIE-by-default in both ld(1) and gcc(1).
Update to nsd(8) 3.2.13.
Don't enable nginx(8) "sendfile", which does not work on OpenBSD.
Make mg(1) more like emacs when opening new buffer: if parent dir is read-only, make buffer read-only; if parent doesn't exist; print message and create buffer as readable.
Don't force order of cp(1) file and dir creation, was an optimisation with no measurable effect.
Always sysmerge(8) compare master.passwd(5) and group(5) regardless of their sums, to ensure no system user(s)/group(s) are missing.
Instead of tmux(1) requiring a prompt to enter all numbers >10, go back to 0-9a-z, add A-Z and enter the prompt when M-0 to M-9 are pressed (like copy mode).
Fixed dhclient(8) startup causing initial DHCPDISCOVER/DHCPREQUEST packets to be sent multiple times.
Hook up nginx(8) to rc(8).
Bugfix rewrite of the smtpd(8) disk-queue traversal code, and log bogus files found.
Use the same compression algorithm, gzip, for smtpd(8) message file and envelopes. Allows inspecting compressed queue with gzcat.
Allow compression of messages and envelopes in the queue. To use, add "queue compress" in smtpd.conf(5).
smtpd(8) lka must not start servicing requests until it receives full config from parent. Disable imsg from other processes until then. Fixes some races.
Pause smtpd(8) accepting clients while below fd reserve limit (or if we fail).
Better detection of the st16650v1 (with broken fifo). Avoids false positives (eg MPC8347 DUART on socppc).
Sparc64 v445 has touchy sleep mode registers, so skip the wakeup code if we are a serial console.
Add support for power saving in athn(4) Host AP mode.
smtpd(8) live profiling of events: "-T profiling" will log_trace(); "-T profstat" will push info to stats API with type STAT_TIMESPEC under key profiling.imsg.*.
Log pause/resume from the administrator to smtpd(8) maillog.
Make make(1) wrong variable specs (unterminated) parse errors; add info to be able to pinpoint parse errors at runtime; let job runners abort when a parse error happens while expanding a variable during execution; fix an infinite loop when compiling without FEATURE_RECVARS.
Log forced removal and expiration of envelopes to smtpd(8) maillog.
When an smtp session fails and IMSG_QUEUE_REMOVE_MESSAGE is sent to the queue, also notify the smtpd(8) scheduler so it can rollback the current update.
Added smtpd(8) stat counter for the number of envelopes inflight.
In smtpd(8) envelope ascii dump/load: remove loading of evpid; don't dump the msgid; ignore msgid at load.
Update to unbound 1.4.18 (not yet linked to the build).
Enhance -v mode of smtpd(8) "sendmail" binary.
Support for Andrew File System and NNPFS removed from the kernel.
Fixed smtpd(8) multiple recipient support.
Added smtpd(8) -N for sendmail compat DSN support; unlimited for now.
Fix race in ral(4) rt2661 Tx interrupt processing which can cause Tx processing to get stuck with OACTIVE set, requiring "ifconfig ral0 down up" to un-wedge.
To protect assumptions inside systrace(1), don't let systrace file descriptors be shared between processes.
Build the kernel with -fno-pie.
Open a remote file/device with the same dump(8) flags we use when opening a local one.
Add ignore keyword to dhclient(8) conf file, allowing one to ignore unwanted info from the server without specifying a supersede value.
netstat(1) -h flag added, to print human numbers in conjunction with -w -b
Allow smtpd(8) to work as a backup MX, relaying only to MXs with higher priority in the DNS record.
smtpd(8) will try to connect to next host if an IO error occurs before the mta is ready to send a mail.
Reverse name and meaning of the IFXF_INET6_PRIVACY interface flag (now called IFXF_INET6_NOPRIVACY). IPv6 privacy addresses are on by default without resetting the flag during ifconfig(8) down/up.
Fix define of endianness macro used in drm code. Makes radeondrm(4) usable on big-endian archs.
Update to nginx(8) 1.2.3, and merge in pcre-8.31.
Fix up tmux(1) window reference counting, don't crash if rename timer fires when window is dead but still referenced.
Added -q "silent" option to pkill(1), similar to grep(1).
Added support for .openbsd.randomdata sections and PT_OPENBSD_RANDOMIZE segments to kernel, ld(1), and ld.so(1).
Bump smtpd(8) MAX_LINE_SIZE and SMTP_LINE_MAX. Fixes some crashes and "line too long" errors.
Stop sending more bytes than necessary with smtpd(8) IMSG_STAT_*.
Chroot smtpd(8) scheduler in /var/empty instead of /var/spool/smtpd.
Added mfii(4) support for chaining a list off a request frame if it runs out of space for entries.
Stop unsetting sysmerge(8) NEED_NEWALIASES too soon, so warnings aren't missed.
Skip putting a com(4) port in sleep mode when used as serial console. Allows sparc64 v445 to work flawlessly.
Fixed smtpd(8) smtpctl schedule-all and schedule-id <msgid>.
Avoid crash when removing non-existing smtpd(8) envelope.
Add warnings on smtpd(8) io errors to help diagnosis.
Introduce smtpd(8) stat_backend, an API for pluggable statistic backends. Statistics: are no longer static structures in shared memory; are only set (smtpd never uses them in its logic); each is a key/value where key can be any (dynamic) string.
Fixed loongson kernel panic when attempting to select glxpcib timecounter as the current timecounter.
Disallow empty smtpd(8) domain/address sent after HELO/EHLO command.
Major update of the smtpd(8) mta internals.
Limit the number of smtpd(8) bounce sessions running at the same time. Avoids DoS'ing the server when lots of bounces are enqueued at startup.
Improve error reporting in getnameinfo_async() and getaddrinfo_async().
Let xenocara build and release proceed through the exact same steps, avoiding nasty surprises.
Fix ftp(1) http resume without out auth (broken on the last commit).
Update dhclient(8) global cur_time after exiting poll() and before calling the state engine, to properly account for time passed.
Update to xf86-video-mach64 6.9.3.
Generalise ebus(4/sparc64) code to allow for arbitrary wirings. Makes serial console on the v445 work.
Properly initialise the IOMMU control and status register for pyro(4/sparc64). Fixes DMA problems spotted on the v445.
Update to glproto 1.4.16.
Fixed typos in DPRINTF() so ehci(4) and uhci(4) error messages refer to correct interface.
Add a default CDIAGFLAGS to bsd.own.mk, so programs may enable warnings by making "make WARNINGS=Yes" without having to add CDIAGFLAGS to its makefile.
Update to pixman 0.26.2.
Fix possible ieee80211(9) panic while switching from STA mode into hostap/ibss modes.
Fix mips64 and powerpc's ld.so syscall implementations. Prevents gcc(1) from optimising away memory loads and stores that otherwise appear unused in a function.
Update to libGL 7.11.2.
Update to myx(4) firmware 1.4.55, via freebsd revision 236212.
Added mfi(4) support for "physical devices" on skinny controllers (these let you specify disks that should be accessed directly rather than be part of logical volumes).
Send ssh(1) client banner immediately, rather than waiting for the server to move first for SSH protocol 2 connections. Based on bz#1999.
Print details of which host lines were deleted when using ssh-keygen(1) "-R host".
Force a clean shutdown of ssh(1) ControlMaster client sessions when the ~. escape sequence is used. "~." should now work in mux clients even if the server is no longer responding.
Updates to: xf86-video-cirrus 1.5.1; xf86-video-i740 1.3.4; xf86-video-neomagic 1.2.7; xf86-video-nv 2.1.20; xf86-input-keyboard to 1.6.2; and xf86-input-mouse 1.8.1.
Rework mfi(4) so it will do all the completions on a ccb, including calling the done handler. Makes it consistently complete scsi(4) io with all proper error checking.
Scrub mfi(4) ccbs when we're about to use them, not when put back on the free list. Old state no longer messes up new commands.
Fixed dma sync for the command frame in mfi(4) mfi_done; consolidate other dma syncs.
Switch off inetd(8) tftp-proxy(8) and enable the standalone one instead.
Change gcc(1) to link shared objects with -lpthread and -lc as appropriate (it is no longer necessary to patch software to use -pthread instead of -lpthread).
On a.out architectures __cerror() is called _cerror(). Fix accordingly so vax can build again.
Enable IPv6 autoconfprivacy by default.
Add support for basic ftp(1) HTTP authentication as per RFC 2617 and 3986. Allows "ftp http[s]://user:pass@host/file" idiom.
In Xserver(1), allow opening tty[E-J]0. Removed ttyD[1-7], since those devices will never get used by X.
Expose the max number of logical volumes mfi(4) supports as the width of its scsibus. Potentially more openings for busy volumes.
Boldify tmux(1) windows with alerts in choose-* list.
Fixed bad argument passed to route(8) errx().
Optimise rc.d(8) checks for /etc/exports.
Introduce mfii(4), a driver for the generation of megaraid sas boards.
Unset _rcflags and _rcuser so that they don't get inherited by rc.d(8) scripts.
Set the rc.d(8) daemon_class as readonly as it should be.
Make sure azalia(4) snooping is enabled on Intel 7 Series HD Audio.
Fixed bug in m88k siglongjmp(), which would not restore a signal mask of zero.
Mask the bgpd(8) reserved bits and the ext len bit in the attribute flags field. Fixes session failures and ensures updates sent out are correct when the wrong data is received from other systems.
Fixed Xserver(1) privilege separation regression, where parent pid was initialised too late.
mandoc(1) .Sq will now use curly right quotes in HTML output to match its curly left quotes; properly reinitialise the styles attribute string buffer for each column, so attributes don't accumulate.
ld(1) will now correctly handle -rpath-link, instead of eating its argument and handling it as -r.
Fix ahci(4) state tracking for the error ccb, to stop "ccb->ccb_xa.state == ATA_S_ONCHIP" assertion failures when talking to dying disks.
Make sure smtpd(8) generated id is never 0.
Update to xf86-input-elographics 1.4.0; xf86-video-apm 1.2.5; xf86-video-chips 1.2.5; xf86-video-rendition 4.2.5; xf86-video-tseng 1.2.5; xf86-video-voodoo 1.2.5; xf86-video-ark 0.7.5; xf86-video-glint 1.2.8; xf86-video-i128 1.3.6.
Instead of numbering tmux(1) "choose mode" items 0-9a-z and then nothing, number them all and if there are more than 10 use a prompt when 0-9 is pressed.
Producer/consumer values used by the mfi(4) device should be little endian. Byteswap where appropriate.
oce(4) improvements: properly account for cluster chains the driver builds upon receiving a jumbo frame; set a timeout in case the oce(4) chip goes out to lunch; respect the mtu value that ifconfig sets; schedule a rx refill if the ring is empty; try to make sense of the firmware statistics by counting rx and tx errors; and no longer compile rss functions in unless OCE_RSS is specified.
Allow smtpd(8) failure reports for different recipients of the same message to be grouped into a single bounce message.
Add BCM5717/19/20C PHYs to mii(4).
Improve the smtpd(8) message flows to isolate operations on the queue backend within the queue process.
Update to xf86-video-ati 6.14.6.
Improved smtpd(8) scheduler backend API.
Make all ehci(4), ohci(4) and uhci(4) *_device_*_start() functions wait for an interrupt when the bus is in polling mode. Stops some ending at ddb> after running "halt -p".
Native build system for gl-docs. Removes last dependency in xenocara on imake(1).
Fixed bug in smtpd(8) evpid parsing on 32bit archs.
In Xserver(1)'s non-privilege separation mode, avoid accidentally sending a SIGUSR1 signal to init(8).
Store the data used to generate an icmp(4) error message on a stack instead of allocating a new mbuf.
Multibyte input to cwm(1) menu code now possible.
Added support for ix(4) 10Gb ethernet cards based on the Intel X540 chipset.
Update to xserver 1.12.3.
If dbus is installed, xdm(1) and xinit(1) will now start the daemon as part of the X session.
Switched to automake 1.12/autoconf 2.69.
Add a new rc.d(8) rc_usercheck variable (default to YES). When set to no, root privilege is needed to run rc_check. This means /etc/rc.d/foobar check can now be run as a regular user.
sysmerge(8) now also logs the file(s) we manually merged/installed.
Added driver for oce(4) Emulex OneConnect 10Gb Ethernet, for cards based on ServerEngines BladeEngine 2 and 3, and Emulex Lancer (XE201).
Reset the smtpd(8) session if no RCPT was accepted for the batch.
Fixed bogus smtpd(8) permfail when no MX is defined on a valid domain.
In smtpd(8) format string expansion, lowercase() all. Fixes issue where a %u format could lead to a delivery failure (ie: GILLES@openbsd.org should be expanded to gilles (not GILLES) for local deliveries).
Disable mandoc(1) hyphenation and, for nroff, disable justification. Consistent with how mdoc behaves (and produces more readable manuals).
Quote the '-' before the mandoc(1) flags, to prevent nroff from putting a line break between the '-' and the flag character.
Use "\\ " not "\\~" in mandoc(1) as the non-breaking space (historic nroff doesn't support the latter).
Implement .PD for mandoc(1) -Tascii. Reduces mandoc/groff differences in base by 25%.
Fix initialisation of audioctl(1) "oldval" field, bug introduced in r1.20.
Load os passive fingerprints when testing the pfctl(8) ruleset.
--------
Changes made between OpenBSD 5.1 and 5.2
Accommodate newer i386/amd64 CPUs with physical address size greater than 36 bit. Fixes major performance hit seen on newer servers where an incorrectly programmed memory region length affects PCI device mappings.
Make dhclient(8) interface_status() assume that a link is up when IFM_AVALID is not set. Allows drivers to get dhcp leases even when they cannot tell what the link state is.
Fix for VU#624931 CVE-2012-2978: nsd(8) denial of service vulnerability from non-standard DNS packet from any host on the internet.
Make the smtpd(8) scheduler less verbose by default.
Further simplify cwm(1) Xinerama init, and re-init on XRR events.
On gio, correctly recognise boards with a 8-bit only ID register, which are not frame buffers.
The 8254 timer does not interrupt on Indy; no longer try it. R4000 and R4400 based Indy may experience the lost clock interrupt processor errata again, until better fix is found.
Drop .sp and .br right after .SH and .SS.; and drop empty .IP so they do not cause additional vertical spacing with mandoc(1).
Let a trailing .Ns macro take effect, even on an input line containing a partial implicit macro. Fixes some mandoc(1) horizontal spacing.
Print messages about ifconfig(8) ieee80211 nodes purged from the node cache if hostap/ibss modes are compiled in and the interface is in debug mode.
Fix handling of mandoc(1) paragraph macros inside lists: when they are trailing the last item, move them outside the list; when they are trailing any other none-compact item, drop them.
mandoc(1) will now never use "\*(Ba" and just use "|". Stops breaking of enclosing font changes.
Put p_prof_ticks and p_prof_addr back in a "copy-on-fork" area, to correct process accounting.
Add recognition of the Huawei Mobile E303 to umsm(4).
Use ipsec(4) flowinfo on pipex to select the ipsec(4) tunnel for sending L2TP packets.
In flush-left mode mandoc(1), when an output line is broken at the position of a literal tab, the tab now indents the following line.
Added IP_IPSECFLOWINFO option to sendmsg(2) and recvmsg(2), so npppd(4) can use this to select the ipsec(4) tunnel for L2TP packets. Fixes Windows (always binding to 1701) and Android clients (negotiating wildcard flows).
Fixed two possible node leaks in ieee80211_input().
Make sure we have a swap partition before trying to read or write hibernate info to it.
mandoc(1) -Tman .sp fixes: keep height argument on the same line (it got printed to the output); for .El .sp, avoid the .sp -1v .PP .sp output sequence.
mandoc(1) -mdoc parser improvements related to vertical spacing: remove .br before paragraph type blocks; treat .Lp as a paragraph like .Pp (so remove .Pp, .Lp, .br before it); do not treat .sp as a paragraph (don't remove anything before it); after .Sh, .Ss, .Pp, and .Lp, remove .Pp, .Lp, .sp, .br, and blank lines; after .sp and .br, remove .br.
Unify cwm(1) max routines, to match client placement and some menu ones when calculating screen dimensions.
Don't panic in hibernate resume if no swap partition exists on the root disk.
Add cu(1) command ~D to drop the DTR line for a second (similar to using ~# for a BREAK). This makes some microcontroller boards reset.
Fixed mandoc(1) vertical spacing for blank lines after .PP, and for .sp after .PP; adjust -Tman SYNOPSIS .Nm indentation using .HP; do not pass font escapes and such through print_word(), to correctly count characters.
In mandoc(1) -Tman .Bl -compact, skip blank line only before first item of first list in a section, not before every item of the first list.
Label node allocation failures as such in netstat(1) -W output.
Changed ipsec.conf(5) configuration format fed to the isakmpd FIFO to be able to specify extended options (eg SA Lifetime).
Added sysctl.conf(5) file for beagleboard architecture (required by the cross compiler).
Refined bgpd(8) knexthop calculations. Fixes massive memory consumption crashes when used with ospfd(8).
Support additional MODP DH groups in the isakmpd.policy(5) Phase 1 and Phase 2, to match ipsecctl(8).
Stopped npppd(4) using wrong Attribute Value Pairs as a "calling number".
tcpdump(8) now recognises additional Internet Key Exchange DH groups.
mandoc(1) changes: in -man -Tascii, support .sp with negative argument; in -mdoc -Tman, improve the framework to control vertical spacing. Use both to support .Bl -compact.
Add a notify queue to tmux(1) and a way to turn them on and off, to prevent notify while running some commands.
Import swrastg, the Gallium3D software rasterizer. Uses the softpipe driver by default, can also use the llvmpipe driver that use LLVM for code generation if available. Not yet linked to the build.
Avoid using the same wscons(4) wchan name twice.
Disable acpivideo(4) on ASUS laptops, as some models panic whenever an event is received.
Fix wireless scanning on slow systems with high RX rate and interface in debug mode. Allows association points to recover from ifconfig(8) "ral0 debug down up" in noisy RF environments. Also fixed some association failures.
Allow route(8) destination/prefixlen syntax for ipv6 routes.
After connect() returns EINPROGRESS the connection can still fail, relayd(8) will now check with getsockopt if the socket is still open.
Use S_ISFIFO and S_ISSOCK instead of lseek() to determine whether a fd is a socket, pipe or named pipe.
Fix .Nm validation crash in mandoc(1).
Be more careful when accessing a possibly cached route, since it may already be gone. Fixes panic seen when unplugging a USB interface in use.
Added -B option to ktrace(1) to reduce ld.so(1) chatter.
Better handling of long comments in ssh_config(5).
Fix installer script issue where ksh would not properly separate arguments correctly in "$@" if IFS is an empty string.
Enabled hibernate on i386. Currently only working on pciide(4) and wd(4) disks.
Improved i386 gdb to display stack traces of kernel core dumps correctly.
Fix crash in mandoc(1) on .Fn with one argument and .Bl without a width. Now can build all 3776 base manuals.
Added support in smtpd(8) for maildir tagging/folders.
Added support for NetMos NM9820 cardbus serial cards.
Added JMC251/JMC261 chips which include card readers to the list of supported jme(4) devices.
Make smtpd(8) not respect RFC5322 and refuse strange characters in the local part of an email address.
Implemented res_mkquery(3) in the libc async resolver.
When cp(1) copies a file using sparse mode, truncate the file based on current seek offset instead of the reported original length.
USB HID parser now supports multiple report IDs. Added hid_get_report_id(3) to get an id of a descriptor.
New event-driven tftp-proxy(8) replaces the old one run out of inetd(8).
Disabled SSLv2 in the OpenSSL code base.
Better fdisk(8) bounds checks and less unuseful help texts.
In bgpd(8), limit the setsockopt(2) while loops to prevent them from running away if the call fails when a peer bounces at the wrong time.
Fix libtool(1) handling of ldconfig library directory searches.
Make tmux(1) command exec functions return an enum rather than -1/0/1 values and add new value to mean "leave client running but don't attach". Fixes problems with using some commands in a command sequence.
Make sure processes don't get scheduled on CPUs which have been taken out of the scheduler.
Fix packet length issue in pf(4) address translation for icmp error packets.
Reduce the number of unnecessary IPIs sent on amd64 smp machines by calling need_resched() only if the priority is lower than the current running process.
Make smtpd(8) accept address literals for the recipient domain.
Better regexps in the sendmail(8) and nfsd(8) rc.d startup scripts.
Various mandoc(1) fixes and improvements.
Renamed "life" option to "lifetime" in ipsec.conf(5) to match iked.conf(5).
Disable the ability to lidsuspend if shutdown is in progress already.
Make pkill(1) -l print the proper processes when the -v flag is used.
Removed all digests from package checksums except SHA-256.
The in-development version of cu(1) now has builtin support for Xmodem transfers.
Simplify the smtpd(8) scheduler. It is now possible to handle SIGTERM/SIGINT.
In pf.conf(5), implicit address family is now allowed for af-to rules. If the address family can be determined by the "from" or "to" parameters, it is no longer necessary to specify "inet" or "inet6".
Better handling of the servname in the libc async resolver for getaddrinfo_async.
Initial version of a new cu(1) added to the source tree. Not linked to builds yet.
Fix in tftpd(8) when receiving an ACK for the previous block.
Fixed mg(1) bug related to tilde expansions.
Make sshd_config(5) default to UsePrivilegeSeparation sandbox for new installations.
Updated nsd(8) to 3.2.11.
In mandoc(1), fix -Tman font handling for ".Ad .Ar .Cd .Cm .Dv .Em .Er .Ev .Fa .Fl .Fn .Fo .Ft .Ic .In .Lk .Li .Ms .Mt .Nm .Pa .Sx .Sy .Tn .Va .Vt"
Teach kdump(1) how to print fd_sets used by select(2).
Fixed rounding errors in fdisk(8) to better handle NTFS partitions.
After resume on i386 and amd64, re-initialize the MTRR registers on the AP processors too.
Add support in pf(4) for the 'weight' keyword in the least-states load balancing case.
Moved the pf(4) prio and tos options to "match set {}" block instead of set-tos.
Moved smtpd(8) to the new asynch resolver.
Fix handling of the message read buf in bgpd(8), now EOR record handling is lots faster.
Make the installer able to show more information about disks when asked which disk to install on.
Make relayd(8) able to handle transactions larger than 2GB in size.
Implement -Tman .No and .Mt in mandoc(1).
Make sure we do not reinitialize ci_randseed on the primary CPU.
First step of simplifying the smtpd(8) fsqueue. Reduced the buckets from 0xfff to 0xff for performance reasons.
mandoc(1) fixes: .Lk for -Tascii (implemented it for -Tman); fixed vertical spacing for -Tman SYNOPSIS .Fn .Fo .Ft .In .Nm .Va .Vt.
To more reliably detect altered system files, security(8) switched from MD5 to SHA-256, using mtree(8).
Added mtree(8) support for the "sha256digest" keyword to create/compare SHA-256 digests of files.
Pass @ (array) information along to auto-make simpler accessors in libtool(1); first use of permuted options.
Incoming smtpd(8) messages are now always stored in /incoming, whatever the queue_backend is; check return value of generated paths before calling rmtree().
Disallow manual security associations that use AES-CTR, AES-GCM, or AES-GMAC (all unsafe with static keys) in ipsec.conf(5). Also, forbidden by RFCs 3686, 4106, and 4543.
pfctl(8) and tcpdump(8) tweaked to make -P flag work with -ss (print port names and states).
Implemented res_querydomain(), required by sendmail(8).
Implemented -Tman .An in mandoc(1); reset -[no]split mode at .Sh AUTHORS in -Tascii.
Added tmux(1) choose-tree command to show windows and sessions in the same list.
Switched diff(1) binary file detection. Stops some character encodings being wrongly treated as binary.
smtpd(8) supports relay URLs (users need to update smtpd.conf(5) if using "relay via" rules).
smtpd(8) replaced starttls:// schema with tls://.
Added mandoc(1) flags to insert a .sp or .br request before the next output, for better SYNOPSIS spacing.
Better error messages from mount(8).
Make hibernate_free() safe to be called even if the hibernate areas allocation failed.
Implemented -Tman .Va; fix -Tman .Vt for the non-SYNOPSIS case in mandoc(1).
radeon(4) 6.14.4 code reviewed, to fix accumulated CVS merge errors.
Increase maximum number of npppd tun(4) interfaces to 8.
Implemented mandoc(1) -Tman .Vt.
Don't hold the fd-table lock across vn_open(), as opening a FIFO may block. Avoids possible race.
Added support to rtadvd(8) and rtadvd.conf(5) for advertising dns servers and search paths in router advertisements (RFC 6106).
Start using our options parser for main libtool(1) options; put link related stuff into their own module; shortdie for cases where it is known libtool(1) is not at fault.
Handle O_ACCMODE bits correctly, so O_RDONLY is displayed by kdump(1) even when other flag bits are set.
Basic implementation of -Tman .Fo and .Fa added to mandoc(1) (some blank lines still missing from output).
Specialised/simplified libtool(1) option handler.
Add noifprefix, an option to send an RA with no prefix information, to rtadvd(8).
Remove the hardcoded limit of 16 on the number of pflog(4) interfaces.
Clear flags across all tmux(1) sessions.
Fixed cwm(1) atom for retrieving WM_STATE between re-exec's, and for setting WM_STATE.
Fix two races in socket(2) splicing.
Removed incorrect check in pfctl(8) preventing set-tos for IPv6.
mandoc(1) now supports the .cc request.
libtool(1) changes: added LT::OSConfig for config values, and walk the object to print the config (instead of printing the values manually); made $mode into an actual object; added a dump method (simplifying the --config call).
Added the Chicony x200 camera to usbdevs.
Fixed a mandoc(1) assert() raised by "RS" when following "TP" without a tag.
Allow httpd(8) to build even if sslv2 is disabled.
Updated to freetype-2.4.10.
Updated nginx(8) to 1.2.2; start using /var/www/cache instead of /var/www/tmp.
mandoc(1) basic support for "-Tman .In" and "-Tman .Ft and .Fn"; implemented "-Tman .Bd" -offset and -compact, "-Tman .Sm", "-Tman .Bk"; after .Lb in library section, break the line in the final output.
Check for valid partition when fdisk(8) "select"ing a partition.
Replaced atoi(3) with strtonum(3) in fdisk(8) code, and made related error messages consistent.
Allow nc(1) UDP server to receive datagrams from multiple socket pairs with -k flag.
Restored pf(4) DIOCKILLSTATE semantics. Should fix "authpf(8) doesn't remove NAT states" issue.
mandoc(1) "-mdoc -Tman" fixes: right after .Ns, avoid breaking the line in man code; after .Fl without arguments, do not insert a blank into man code; before each .Nm in .Sh SYNOPSIS, insert a .br into man code; skip .Pp arguments, don't copy them to man code.
Fixed an ehci(4) abort loop problem when aborting a transfer.
Fixed file descriptor leak in authpf(8).
Unbreak Mesa GLX1.3 constructors with software dri. Makes clutter/cogl works with software acceleration.
Don't enable Mesa INTEL_swap_event unconditionally. Unbreaks clutter/cogl and other toolkits.
Report incoming connections when -l is specified with -v in nc(1).
Restore default argument to use "/tftpboot" in rc.d(8) script. Makes tftpd(8) work out of the box.
Support for gaming-style USB keyboards (that use a variable for each separate key in the HID report).
cwm(1) querying for Xinerama now done per display, not per screen.
pkg_add(1) sets -i on automatically for ttys; uses -i/-I to force interactive/non interactive mode.
ssh(1) setting of tty_flag moved to after config parsing, so RequestTTY options are correctly picked up (bz#1995).
Fixed ssh(1) memory leak of passed-in environment variables and connection context when new session message is malformed (bz#2003).
Added ssh-keygen(1) options to specify starting line number and number of lines to process when screening moduli candidates. Allows processing of different parts of a candidate moduli file in parallel.
Correct the jumbo setup code within brgphy(4) so it is not disabled on the physical layer interface.
Set the prefetch threshold for ix(4). Provides some performance improvement.
ix(4) now forces a cleanup if number of tx descriptors is below threshold.
Added flow control to bnx(4). Tested on 5706, 5708, 5709, 5716 chipsets.
NVIDIA GeForce 320M (found on the 2010 version of the Apple Mac mini) added to pcidevs.
Decode ipsecctl(8) sa flags to enable realtime observation of changes with monitor mode.
Don't output ipsecctl(8) "esn" string in rule section (can't use the keyword to create a esn-enabled rule anyway).
when rekeying ike sa, copy more info from the old one; fixes last known iked(8) inter-op problem with windows 7.
Adjust the bgpd(8) route decision code to cover checks needed due to route reflection.
Fixed cwm(1) atom (WM_PROTOCOLS) style handing; closing a window will no longer close entire application if the client supports CLIENT_PROTO_DELETE.
libtool(1) changes: cleanup options handling; simplify LT::Trace syntax; implement --tag checks; added libtool comp support, as per libtool2 (implicit modes still as per libtool1); prevent shell code in nm execution.
Set 10_100_ONLY flag for bge(4) BCM57791/BCM57795 chipsets.
Re-implement atom handing for more consistent separation of cwm(1) and Extended Window Manager Hints.
sigpending(2) fixed to work on the sh architecture.
Improved iked(8) key derivation function when rekeying IKE SA, as specified in s2.18 of RFC5996.
Simplified cvs(1) rcsnum parsing by using a fixed array, avoiding realloc(3).
Lookup smtpd(8) queue and scheduler backends by name, rather than enum. Added command-line option to specify the backend to use.
Only check state flags when processing an iked(8) response (an unnecessary check otherwise).
iked(8) will now augment every sa_free call with a debugging log message.
Hibernate i/o implementation for ahci(4). Works with ATI SBx00 controller (not yet with jmicron or intel).
iked(8) no longer closes IKE SA immediately when rekeying; closes on timeout if no SA delete received.
Use a randomising counter to generate unique ids, so smtpd(8) does not usleep(3) in the wrong places.
Set ssh(1) interactive ToS flag for forwarded X(7) X11 sessions.
Increased sparc's default and maximum text, data and stack size limits (required to build X at -O2, and by many ports).
Fix the use of ALPS touchpads with recent (>1.6) xf86-input-synaptics drivers.
Do not define XDC_DIAG if option SMALL_KERNEL; allows sparc floppies to fit again.
Added support for the Winbond W83627UHG chip to lm(4).
Further limits.h fixes, for POSIX and XPG standards compliance.
Enable use of AES-{192,256}-CTR, and explicitly of AES-128-CTR, for ipsec(4) ESP.
Fixed a race during the load of ssh(1) sandbox systrace(1) policies.
Updated xf86-input-synaptics to 1.6.2.
Strip trailing \r from irrfilter RSPL route lines (the \r breaks bgpctl(8) parsing).
pfsync(4) now demotes by 32 on the first bulk update (prevents failovers w/o having a full state table).
Fixed a panic on resume with ahci(4) AHCI_DEBUG enabled.
ipsecctl(8) can now print esn flag when dumping SAs with esn enabled.
Added support (using software crypto(9)) for the Extended (64-bit) Sequence Number defined in RFCs 4302 and 4303.
Added many intel 7 series id's to pcidevs, for devices found in the thinkpad x230.
Restrict sgi ip30 physical memory usage to 1.5GB, to stop memory regions being overwritten.
On sgi, correctly register ip30 contiguous memory regions (e.g. some > 1GB DIMMs).
Prevent bioctl(8) salt_len overflows.
To prevent a race condition, pfsync(4) no longer does demotion adjustments on "link up" event then undemotes when bulk update finishes or times out.
Fixed AMD chipset ahci(4) attach functions for Hudson-2 and SB700 product families.
Removed ssh(1) hmac-sha2-256-96 and hmac-sha2-512-96 MACs (bz#2023). They will not be in the RFC.
Changed sparc64 "fp" boot device path's parameter probing to not use the scsibus(4) field, to future-proof for dual-port fibre-channel adapters.
Prevent an endless iked(8) loop; also stop re-enqueuing the same item on the list multiple times.
Tweaked iostat(8) column spacing to allow for larger numbers.
Use MAP_FIXED for malloc(3) mquery(2) to avoid scanning for free space if hint isn't available.
Created new (namespace clean) machine/_float.h; sys/limits.h now defines values it needs itself.
Use nl_langinfo(RADIXCHAR) instead of localeconv()->decimal_point in printf(3), no longer call it unless we have a floating point value to print.
dhclient(8) will now reject the lease if no length field is present.
Check dhclient(8) "required length" field for an option is present before trying to use it.
Delete (all) trailing NUL's when parsing dhclient(8) NVT ASCII options. Fixes appending info to such options via dhclient.conf(5); conforms to RFC 2132.
Improved iked(8) ikev2_msg_retransmit_timeout.
Close iked(8) SA when IKE_SA_INIT or IKE_AUTH exchanges fail; don't cache response to IKE_SA_INIT.
Added mquery(2) to allowed syscalls for ssh(1) "UsePrivilegeSeparation sandbox" (needed by malloc(3)).
Compare iked(8) exchange types when looking up a message; proceed with response only when the appropriate request is found.
compat_linux(8) no longer ignores SOCK_CLOEXEC and SOCK_NONBLOCK.
Use /var/www/tmp/ for the nginx(8) temp directories, even if not chrooted.
Improved POSIX compliance for arpa/inet.h and netinet/in.h.
Workaround for libtool(1) race condition with make -j4.
Support added for external L2 cache controller on Indy/Indigo2 R4600SC and Indy R5000SC processor modules.
Get mips64 L2 line size from configuration register instead of hardcoding smallest possible size; and on kernels with 16KB pages, SyncDCachePage on physical (not virtual) addresses where possible.
Change arc4random(3) arc4random_uniform() calculations to simplify code and make slightly faster.
Replace mips64 R5000 and R10000 family assembly cache routines with C equivalents (rm cache_r*.d in kernel compile directories after updating).
adb(4/macppc) improvements brought back that were lost in reversion: fixed backspace key under X11; use the command key (58) as modifier in console for all European keyboards; don't use small enter key (52) as modifier in console for the fr, sg, and sv_nodead layouts; don't redefine keys that are inherited from the default layout (de, uk).
Improved config(8) error messages when removing/recreating symlinks in the build dir.
Added support for AF_INET6 to inet_net_pton(3) and inet_net_ntop(3).
Updated sqlite3(1) to 3.7.13.
realloc(3) zapcacheregion fixed to clear out entire requested memory area; uses mquery(2) to check potential memory region is large enough, prior to allocating.
Simplified macppc console attachment logic.
Unbreak the nv(4) driver on macppc after update to Xserver(1) 1.12.
Add dumping of struct __tfork done by the revised __tfork syscall to kdump(1).
__tfork_thread(3) __tfork now sets stack address of the new thread in the kernel, so it can't get a signal while still running on parent thread's stack.
ssh(1) strlcpy(3) truncation check corrected.
Cancel timeouts in dhclient(8) state_reboot() to stop sending (corrupted) discover packets after binding.
Fixed the smtpd(8) runner spinning on message loop.
Now that many daemons can cope with file descriptor starvation, raised default limits in login.conf(5).
RIP mac68k support. Machines too slow to support present day crypto(3).
Fixed some hibernate issues on i386 machines with > 3.5GB phys mem
gcc(1) fixed to check _POSIX_PRIORITY_SCHEDULING and_POSIX_THREAD_PRIORITY_SCHEDULING are supported (not just defined), to conform with POSIX 2001.
With hppa MP rthread setups, don't remove the X permission from the GOT entry momentarily, because another thread might attempt lazy resolve.
malloc(3) switched to using two nibbles of random, to span the the entire cache; and on free(3), reuses offset instead of always starting at zero.
Copy compat_linux(8) set_tls_base flag when forking. Fixes segfault when processes with this flag active tried to access the TLS area.
urndis(4) now uses interface descriptor after the control interface as the data interface; supports multiple interface descriptors.
kdump(1) can now handle PT_GET_THREAD_*.
Initialise ssh(1) accept() backoff timer to avoid EINVAL from select(2) when rekeying.
In sshd_config(5), extend Match to allow AcceptEnv and {Allow,Deny}{Users,Groups}.
Moved libtool(1) to base.
Changes to compat_linux(8): pool_get() flags changed from WAITOK to NOWAIT to avoid a potential lost-wakeup; linux_futex.c now sleeps on the actual data address (not on the stack address of the pointer to the data); implemented linux_sys_tgkill and added extra argument validation.
Added more pathconf(2) variables from POSIX.
Don't unload sub-modules with Xserver(1) 1.12
Support larger-than-page-alignment requests in posix_memalign(3).
Corrected uvideo(4) parsing of video format.
Added "control mode" that lets tmux(1) commands be sent and output received on stdout(4).
When using mg(1) M->, place cursor near bottom of window like emacs, instead of middle of page.
Do not crash when the current tmux(1) session has no window.
Fixed mg(1) spin that occurred when splitting window after directory opened via command line and by other windows.
Add -a flag for tmux(1) detach-client, will kill-session for all but the specified session.
Checking that the opened file is the expected one fixes a potential symlink race when using the -P flag in rm(1).
In the smtpd(8) code a "struct scheduler_info" abstraction is introduced and used as a value carrier instead of "struct envelope".
IP30.MP kernels will store the CURCPU pointer in a slower way but which works in memory areas above 2 GB (physical); the mips64 port no longer restricts continuous-page allocations to memory in the low 4 GB.
On the octeon port the TLB size is now dynamically calculated.
In tcpbench(1) an integer division by zero is fixed.
The ldapd(8) now proactively protects itself against, and thus handles, filedescriptor exhaustion.
Regression test for the DF_1_NOOPEN flag enters the tree.
The mg(1) editor will gracefully open filenames longer than LOGIN_NAME_MAX which are prefixed with a tilde (and don't refer to an account).
ld.so(1) henceforth honours the DF_1_NOOPEN flag (dlopen(3) not allowed, to be set via "-Wl,-znodlopen" linker flags).
snmpd(8) learns the D-DISKIO-MIB.
The new mg(1) option "backup-to-home-directory" will save backup copies in "~/.mg.d" instead of CWD; the new "leave-tmpdir-backups" option can modify this behaviour further.
Output of "pkg_info(1) -S" changes since signatures now separate pkgnames with "@", libraries with nothing.
nginx(8) is updated to version 1.2.1.
In ld.so(1), some logical reorganization and cleanup occurs.
Xenocara xf86-input-synaptics is updated to version 1.6.1.
A fix of the puc(4) driver prevents integer overflows and thus ensures that a ports' bus_space_subregion(9) doesn't excess the mapped area.
"ButtonMapping" support is added to the Xenocara driver ws(4), which also gets a major overhauling.
In Xenocara libXaw is updated to version 1.0.11, libX11 to 1.5.0, libXft to 2.3.1, libXi to 1.6.1, xinput to 1.6.0 and xf86-video-openchrome to 0.2.906.
The PkgConfig.pm module now belongs to pkg-config(1) instead of pkg_add(1).
FFS and sd(4) fixed to no longer mount readonly filesystems readwrite. Fixes crashes seen when using some USB devices with RW/RO switches.
The OpenBSD::MkTemp(3p) module will now die instead of returning an empty list upon error.
The athn(4) driver improves programming of the Serializer/Deserializer. While AR9380 chips will still not work, the kernel shouldn't crash anymore when one is seen.
On amd64 and i386 serial consoles become accessable even if the BIOS doesn't report the presence of any serial ports (makes add-on card additions possible).
The Xenocara Xserver is updated to version 1.12.2 and xkeyboard-config to 2.6.
Support for RFC 6608 BGP Finite State Machine Error subcode error strings is added to bgpd(8).
The emacs editing mode of ksh(1) is fixed.
In Xenocara, xf86-input-vmmouse is updated to version 12.9.0.
mg(1) no longer looses track of where the correct place for its cursor is.
In pkg_add(1) the new pkg_create magic is activated ("note that, in most cases, PFRAG.shared are probably no longer needed...").
compat_linux(8) adds support for gettid(2).
top(1) is extended so that a command line like "$ top -U -username -U username" will behave the same as interactive mode.
In Xenocara, xterm(1) is updated to version 279, xf86-video-ati to 6.14.4; the radeonold driver is fixed to work with xserver 1.12.
Added cscope support to mg(1) (see README for differences to emacs behaviour); also the line number counter is fixed when scrolling up in tiny windows.
Support for the mbsnrtowcs(3) and wcsnrtombs(3) character conversion functions is added to libc.
A fix for CVE-2012-1667, that primarily affects recursive servers, is backported from ISC BIND.
The new randomized UVM allocator will truly randomize addresses again.
rthread fix: EVFILT_SIGNAL and EVFILT_PROC events track the process they're attached not a (possibly temporary) thread.
The new optional hypen in the "[-]u user" command of top(1) allows hiding of individual users' processes.
hppa64 gets a real mutex implementation; unneccesary alignment restrictions on the atomic lock removed.
The ahci(4) driver henceforth just fails the command if error recovery fails (doing recursive recovery caused panics).
mg(1) theo mode will ensure that only one window is open.
tcpcib(4/amd64) / tcpcib(4/i386) gain support for the HPET timer.
bsd.port.arch.mk(5) learns to distinguish in between big and little endian machines via BE_ARCHS and LE_ARCHS (to be tested against NOT_FOR_ARCHS and ONLY_FOR_ARCHS).
On amd64 and i386, MBR code serial port output is fixed and register globbering prevented.
Xenocara libGL builds with "XENOCARA_BUILD_DRI=No" are fixed.
In iked(8) an incorrect conversion of the EC point to the binary representation when rounding up bignums is fixed.
The sqlite3(1) shell and library are updated to version 3.7.12.1.
On amd64 and i386 the new "machine comaddr" can be used to configure the I/O port used to access the serial console.
Due to bug-compatibility issues mandoc(1) no longer allows redefinition of macros before the first ".Dd" (mdoc(7)) or ".TH" (man(7)) request has been seen; it fixes handling of implicit/explicit block issues, like empty paragraphs.
imsg_read(3) will fail with EAGAIN if it's clear that recvmsg(2) will fail due to shortage of file descriptors; API changed so retriable errors will be retried automatically.
mandoc(1) gains some more GNU manual compatibility for some ports' pleasure.
In Xenocara xf86-video-glint is updated to version 1.2.7; also, if building against Xserver 1.12, video drivers that have not yet been updated to the video ABI changes are conditionalized away.
Priviledge separation becomes available for the OpenBSD Xserver 1.12.
In the kernel, DDB diagnostic code that reported timeout adjustments on resume was removed to reduce verbosity.
New smtpd(8) command line option "-P", which can be used to start subsystems in a paused state.
The mg(1) editor will now beep as either buffer end is reached during scrolling.
The mlock(2) and munlock(2) systemcalls no longer cause hard failures when the effective region is of zero length.
In login.conf(5) the new option "krb5-noverify" causes failures to verify credentials against a local key to not result in fatal errors.
The stdlib.h header file availability macro tests are updated to be more POSIX conformant: The ecvt(3), fcvt(3), gcvt(3), mktemp(3), ttyslot(3) and valloc(3) functions are no longer part of POSIX, whereas posix_memalign(3), mkstemp(3) and mkdtemp(3) are; also, setstate(3) has lost a "const" modifier.
In ssh(1) memory leaks in case of MUX socket creation failures (bz#2002) are fixed.
Now quotacheck(8) works with duid based fstab(5), too.
mg(1) fixes cursor jumps when scrolling upwards.
mandoc(1) fixes the handling of blank lines in ".if" conditionals.
The sysconf(3) _SC_* and _CS_* variables have been moved from sys/unistd.h to unistd.h.
The kernels VFS buffer pressure logic is improved, which fixes reproducable hangs seen during heavy I/O on feeble machines.
Computation of the IOC3 device mask is fixed on MENET boards for ioc(4/sgi).
tmux(1) now exclusively uses log files for logging purposes and no longer falls back to STDERR as a default.
The iked(8) daemon simplifies it's internal message passing, fixes an issue with changing the peer address of security associations, and continues timer overhauling.
In "-d" mode rc.subr(8) will print an error message before exiting if a daemon is not active.
In relayd(8) an issue is fixed that caused per-table timeouts to be overwritten by global timeouts.
The mount(8) utility will work again for NFS remote paths.
The smtpd(8) steps toward supporting relay options as URLs of the form "[schema://]host[:port]" (see undeadly.org SMTPD article).
The gbe(4/sgi) driver will disable Sync-on-Green if it finds the string "nosog" in the ARCBios environment variable OSLoadOptions.
iked(8) overhauls its internal timer framework.
mg(1) no longer creates an initial buffer if we update already open files to default modes.
snmpd(8) now panics right away if some of the necessary sockets can't be created.
To unbreak dhcp on the Indigo (IP20) and E++ GIO installer, sq(4/sgi) will always report the interface "up".
mandoc(1) now produces cleaner output with the ROFF "\z" (output next character, don't advance cursor) escape sequence; and no longer makes distinction between numeric/non-numeric escape sequences. Makes recursive parsing of roff(7) escapes actually work.
tmux(1) uses the set "default-shell" not _PATH_BSHELL to spawn commands.
Network code now allows attributes to be passed with prefixes (eg MRT dumps with prefixes for bgpctl(8)).
Replaced Loongson2F assembly cache routines with C code (remove cache_loongson2.d in your kernel build directories).
Proper support for the so-called "fast mode" of the Indigo2 ECC memory controller on sgi.
Add tcpcib(4) to support the Intel Atom E600 watchdog.
Teach rain(6) to calculate terminal delays like worms(6), avoids network saturation if run over ssh.
Fix mandoc(1) vertical spacing around tbl(7) instances in man(7).
mandoc(1) horizontal span width corrected for: centred/right flushed text, boxes, and when more columns follow the span.
mandoc(1) no longer handles vertical lines as additional tbl(7) columns. Simplifies layout parsing.
Plugged some snmpd(8) memory leaks.
The sgi port can now run multiuser on IP28 systems.
Better support for split input/output setups in zs(4/sgi).
mg(1) stops earlier when paging down a buffer (C-v), so page does not circle back to top. Emulates emacs.
Support for the POWER Indigo2 R10000 systems (IP28) added to sgi port.
Simplify tmux(1) logging and just fprintf(stderr, ...) for early errors.
Allow mg(1) searching (C-s or C-r) to wrap around ends of a buffer.
Prepare mg(1) buffers before startup file parsed so multiple files can be opened via startup file. Find-file, insert-file, etc in startup file will now work as expected.
compat_linux(8) KERN_FILE_BYPID and KERN_FILE_BYUID modes of KERN_FILE2 sysctl() now per-process not per-thread. Removes duplication in fstat(1) output.
Imported a number of core functions from libpcap-1.2.0 while preserving local changes.
Support -Ios='OpenBSD 5.1' to override uname(3) as source of the default value for the mdoc(7) .Os macro, to fix man.cgi on the OpenBSD website.
If _MIN > _MAX consider a acpi(4) WordBus resource to be invalid. Fixes panic on IBM x3550-M4.
Don't increment the next expected message id when sending an iked(8) response. Fixes eap negotiation.
On resume, run forward the monotonic and realtime clocks instead of jumping just the realtime clock, triggering and adjusting timeouts to reflect that.
Fixed build of sqlite3(1) lemon parser generator on non-C99 compilers.
If compat_linux(8) LINUX_CLONE_SETTLS isn't set, clone()d child inherits the Thread Control Block value from the parent instead of having it zeroed.
smtpd(8) inet6(4) support fixup so "inet_net_pton: Address family not supported" log messages banished.
Add compat_linux(8) emulation support for fstatfs64.
Made the aucat(1) "default" string a valid device name, to simplify ports where user passes the device string.
Fixed duplicate aucat(1) mixer knob device names.
Fixed aucat(1) channel mapping, which caused crashes if all played/recorded channels didn't exist.
Fixup of from/to specification in /etc/iked.conf(5).
Removed hardcoded values for esp, and automatically decide which proposals to include if protocol is not specified. Allows iked(8) to successfully negotiate ah.
Add support for statfs64 and NTFS, AFS, and UDF filesystem types to compat_linux(8).
Increase the number of io and memory extent regions for amd64 to 16, to match i386.
Changed how mg(1) handles files beginning with a '~'. Brings behaviour more into line with emacs.
Support for RFC6594 SSHFP DNS records for ECDSA key types added to ssh(1).
bgpd(8) will now flush the right networks (the dynamic ones, not the static ones).
Synced log strings with the possible values of IMSG_CTL_RESULT in bgpd(8).
Fix a bgpd(8) warning message to print correct information for unknown peers.
Strip trailing slashes from directory in diff(1) splice() before appending the file portion.
Switched all of the various tmux(1) choose- and list- commands over to the format infrastructure.
Fix to sqlite3(1) lemon parser generator: checks the whole file for changes.
Import sqlite3(1) 3.7.12.
ftell(3) will return EOVERFLOW if the file offset is greater than LONG_MAX.
When idling intel(4) i915 drm(4), flush pending operations and unlock all. Fixes kernel panic and X restarts on Sandy Bridge.
Handle tmux(1) stdin/stdout/stderr file descriptors in client, not server. Bumps protocol version: new clients and old servers are incompatible.
Fixed binutils-2.17 configure script, so it will build on amd64.
Fixed put usage in tftp(1).
xbridge(4/sgi) can now use the generic bus DMA routines.
Bugs in the suspend/resume of intel(4) drm(4) driver eliminated; code reordered to allow easier diff against Linux.
The ftp(1) usage string will henceforth (a) match the manual and (b) no longer cause linewraps.
The NetBSD GIO@PCI bus driver for fast Ethernet expansion boards is ported to OpenBSD (Only the bridge yet, drivers need to be adapted).
pkg_mklocatedb(1) no longer fails if files from the *etc sets are missing, warns instead to run sysmerge(8).
RFC 2461 Router Solicitation flushing will remove all IPv6 routes on a specified gateway, not only CONNECTED ones; clear routes when RA with RouterLifetime of 0 is sent; and use correct priorities when installing routes acquired via redirects.
The tmux(1) configuration syntax now lets a backslash escape itself at the EOL.
On mips64 the virtual aliasing mask computation is corrected.
less(1) will exit if it can't write to the terminal.
pstat(8) shows internal file-descriptor status bits: "d" and "m" are related to garbage collection and "l" means that the descriptor is in a transition state.
security(8) will now also check permissions of ".ssh/id_ecdsa".
Intel I350 PCI Express Ethernet adapters become supported by em(4).
sudo(8) addresses CVE 2012-2337 by adding a missing break between AF_INET and AF_INET6 in addr_matches_if_netmask().
pcidump(8) recognizes 8.0 GT/s link speeds of PCI Express 3.0.
The IPv6 stack tests that the target link local address is included with a neighbour advertisment sent to a multicast address, as mandated by RFC 4861.
unbound(8) now handles out-of-filedescriptor situations by temporarily pausing further accept(2)s.
cwm(1) better integrated into the freedesktop.org Window Manager Specification Project.
In Xenocara, xf86-video-openchrome is updated to version 0.2.905.
The puc(4) driver starts supporting serial consoles.
patch(1) no longer outputs a confusing error message upon failure which occurs with -C.
usb(4) controller units are used as a bus numbers (rather than the host adapter) to fix possible conflict with identical bus numbers (i.e., ehci0 and uhci0).
The package tools have been reworked to test "LIB*VERSION" definitions more exactly.
The OpenBSD specific nginx(8) chroot(2) code is updated to find aliases (eg for user directories).
In Xenocara xlsfonts is updated to version 1.0.4, xmodmap to 1.0.7, xkbcomp to 1.2.4, font-util to 1.3.0; the xf86-video-mach64 reaches version 6.9.1.
Large update of pathconf(2) and sysconf(3) variable reporting occurs.
In Xenocara the xf86-video-i128 driver is updated to version 1.3.5 and xf86-video-mga to 1.5.0. Updated applications: fslsfonts reaches 1.0.4, fstobdf 1.0.5 and xinput is updated to version 1.5.4.
The bnx(4) driver takes care not to print an unset interrupt name.
To prevent lockup situations with full send queues when further interrupts fail to appear, the em(4) driver's start routine is triggered after the link status has been updated.
Bugfix for snmpd(8) PF status report MIB, which previously did not zero out all unused fields in the structure.
Update to: xf86-video-apm 1.2.4, xf86-video-i740 1.3.3, xf86-video-s3virge 1.10.5, xf86-video-s3 0.6.4, xf86-video-siliconmotion 1.7.6, and xf86-input-vmmouse 12.8.0
Simplified InstallManPageAliasesBase rule for xenocara to avoid race condition that prevented release from being "make -j clean".
Backport to nginx(8): when EMFILE/ENFILE returned from accept(), moderate/disable accept events. Logging level for this changed to "crit".
Remove sizes entry from smtpctl(8) so it doesn't appear in "smtpctl show".
Use errx(3) rather than err(3) for unknown message error.
Update to nginx(8)-1.2.0 in base.
Use -t for tmux(1) move-window with -r rather than dying.
Support "Match LocalAddress" and "Match LocalPort" to sshd_config(5); adjusted tests to match.
smtpd(8) allows checking a partial key in a key set (eg comparing address to netmask).
Fixed twin-channel ahc(4) device support. Only affects ahc at eisa(4) since no ahc at pci(4) are twin-channel.
Changed smtpd.conf(5) syntax for makemap(8) virtual domains configuration: "accept for virtual vmap [...]" becomes "accept for virtual map vmap [...]" to keep syntax consistent with to-be-implemented relay rules through maps.
smtpd.conf(5) map declarations extended to allow the following to work: map "foobar" source plain "/etc/mail/foobar".
Print the impact(4/sgi) frame buffer name obtained from ARCS, to match other gio(4/sgi) frame buffer drivers.
Reworked zs(4/sgi) for Indigo, as CTR/DCD/DTR/RTS wiring is inverted on these machines.
smtpd(8) will log_warn() admin if a map that's needed by an envelope is no longer in config file.
"Secret" renamed "credentials" in some smtpd(8) logs.
Don't fatal smtpd(8) if credentials map is gone, instead make the auth fail with a lookup failure. Mail kept in queue until admin fixes smtpd.conf(5), removes mail, or lets it expire.
pf(4) now ignores/preserves the lower 2 bits of the tos-header (used for Explicit Congestion Notification).
Fixed tcpdump(8) for etherip packets.
Applied upstream patches to fix freetype-2.4.9 regression that caused ghostscript "Font Renderer Plugin" errors.
Enable PCI snoop on the azalia(4) AMD Hudson 2.
On sgi, correctly recognise gio(4) Impact boards so they can work as a console device.
Improved sgi console detection logic to match graphics console address, and point to wsdisplay correctly.
On mips64 IP32 kernels on R5000, R10000 and R12000 O2, added extra cache flushing made necessary by the new uvm_map().
Conditionally provide types/prototypes for strptime(3), clock_gettime(2) and asctime_r(3) to make time.h more standards compliant.
Allow mg(1) throwaway buffers to be saved via "C-c s".
Only set a process's start time when starting the main thread; remove unnecessary scheduler locks.
Flags set to indicate re(4) 8401E/8402/8105E/8105E_SPIN1 do not support jumbo frames.
re(4) 8168D chipset now has PHY wake PM flag set to ensure the PHY is woken upon attachment.
Fix a relayd(8) desynchronisation on host change during a running check. Closes PR system/6627.
Backout revision 1.134 in sys/net/route.c, which introduced a use-after-free for routing entries.
Bugfix for iked(8) that prevented initialising if NAT-T not disabled and local address not specified.
Bug fixed in mg(1) writeout() where stats of the wrong file were passed to buffer being written.
Fixed relayd(8) "label string" in http protocol.
Additional Intel E5 pci(4) devices recognised, as found on Supermicro X9DRT-HIBFF.
Refuse to load elf(5) objects that contain a PT_TLS program header. Avoids memory corruption.
Fixed a null pointer dereference on terminating the npppd process.
npppd now ignores NAK of authentication option on LCP (Link Control Protocol) when it was not requested.
Fixed double free bug in npppd Password Authentication Protocol with radius authentication.
npppd now ignores the Link Control Protocol's ACCM option, as it is required by proxied LCP.
Fixed and re-enabled smtpd(8) connect notification to the mfa. Filtering now occurs before setting up ssl(8) connections.
pkg_mklocatedb(1) added an extra check to avoid possibly being out-of-synch.
Fixed double-free in tcpbench(1) when -n is used with -b.
New header sys/_time.h, included from time.h for userland and sys/time.h for kernel access to clock_gettime(2).
Added support for Intel 6 Series KT puc(4) (Serial-over-LAN, part of Intel AMT).
pkg_add(1) fixed when install location is not the default /usr/local.
Fixed printing of wildcard anchors in pfctl(8).
iked(8) synced to RFC 5996: Payload Type "Encrypted" (E) changed to "Encrypted and Authenticated" (SK).
In the kernel, a new copyaddrout() function encapsulates the copying out of socket addresses to userspace.
In Xenocara, xf86-video-vesa is updated to version 2.3.1, xf86-video-ark to 0.7.4, xf86-video-cirrus to 1.4.0, xf86-video-neomagic to 1.2.6, xf86-video-savage to 2.3.4, xf86-video-sis to 0.10.4, xf86-video-tdfx to 1.4.4, xf86-video-trident to 1.3.5 and xf86-video-vmware to 12.0.2.
After a dependency update IP30 kernels can be build with -j2.
Reverse video support is added to sti(4).
The pipe(2) systemcall locks the file descriptor table after pipe buffers and structures have been created, not beforehand.
On amd64, the "int $0x80" systemcall interrupt is garbage collected in favour of the syscall instruction.
For the tmux(1) command unbind-key the -a and -t combination will now work; plus further code-cleanup.
pipex_ip6_input() of the kernels PPPAC IP extension is fixed and now calls IF_DROP() with the correct queue.
On the hppa platform multithreaded debugging becomes available in gdb(1).
The systems thread library henceforth supports a spinlock type (see pthread_spin_init(3)).
tcpdump(8) corrects display of the ipsec(4) ESP/AH sequence number.
In Xenocara, inputproto is updated to version 2.2.
On sgi, the RAMDISK_IP22 kernel configuration works again after device dependencies have been fixed.
To avoid accessing a possibly non-existent interface in -n mode, pfctl(8) simply assumes a MTU of 1500.
IPv6 support is added to tftp(1).
kvm(3) is updated to reflect the kernel's changed file reference-counting via the FREF()/FRELE() mechanism.
The execve(2) system call corrects its error path when there's a race to single thread the process.
ypldap(8) boosts its performance by demanding multiple results at a time instead of singly from servers which support this mode of operation.
ifmedia(4) support is added to sq(4/sgi).
The grtwo(4/sgi) driver tweaks reading of board version information (stored as 8- not 32-bit locations).
An -s option is added to ftp(1) and can be used to specify the source IP address of the connection.
In ypldap(8) the new option groupdn specifies a separate base DN for group searches (see ypldap.conf(5)).
The relayd(8) treats HTTP_METHOD_TRACE requests with a Content-Length header as malformed requests (errcode 400); and the message-body is forwarded for GET, HEAD and OPTIONS requests.
The emacs keybinding option of ksh(1) no longer imposes limits on the size and the content of bindings.
Added -r flag to tmux(1) move-window to renumber windows, and renumber-windows option to do this automatically.
zs(4/sgi) will now recognize 85230 chips, and use their FIFOs to reduce TX interrupts.
Added device flags to zs(4/sgi) to override carrier line wiring issues.
pkg_mklocatedb(1) src/xsrc handling repaired.
Use int not u_char so as to correctly record tmux(1) colours.
Align label_t to an 8 byte boundary on sparc. Makes ddb(4) usable again.
relayd(8) fixed so message-body will be forwarded for HTTP DELETE method payloads.
pkg_add(1) switched to OpenBSD::MkTemp. Safer, more accurate and less dependencies.
bgpd.conf(5) now filters 100.64.0.0/10, reserved by RFC 6598 for Shared Address Space.
pmap(9) code fixed to allow sparc64 to build with DEBUG.
Removed unnecessary cache flushes. 1+% speed increase on sgi IP27 and loongson kernels.
Add a tmux(1) buffer with all input from last ground state, to be used for control mode.
Before writing to disk, fdisk(8) warns the user if their new MBR contains more than one OpenBSD partition.
Kernel crypto(3) code now uses explicit_bzero() for clearing key material.
SGI GIO bus device code can now identify ID-less framebuffers correctly.
Optimised mips64 R5k/RM7k cache routines.
For interprocess communication control, fix socket size calculation. Fixes: sendmsg() delivery of fd sets, failing to wait, and potential file leakage.
OpenBSD snapshots now support the IP20, IP22 and IP24 SGI systems. See: undeadly.org
Added -a flag to tmux(1) kill-window, and window-status-separator option.
ftp(1) can now handle HTTP Content-Length headers that have trailing whitespace.
No longer leak mbufs when bind() on a PF_UNIX socket fails.
sqlite3(1) 3.7.11 library and shell enabled in default builds.
A code cleanup is seen in the pciide(4) driver that also fixes incorrect assumptions for VIA VT6410 and VT6415 controllers.
Directories which occur in pkg_locate results will now be printed with an appended slash so as to make it easier to identify them as such. (Introduces package OpenBSD::PackingElement::DirBase.)
Added (yet unused dummy) struct proc* arguments to the FRELE() and FILE_SET_MATURE() kernel macros in anticipation of upcoming changes.
In tmux(1) handling of partial input keys is tweaked by also taking the state of the input timer (configurable by escape-time) into account.
The tty(4) driver learns that its initial column is 0.
The crypto(3) library fix for "CVE-2012-2110: libcrypto ASN.1 parsing heap overflow" is backported from -current to the OPENBSD_5_0 and OPENBSD_5_1 patch branch.
All occurrences of gcc series 3 are removed from the gcc(1) manpage.
The smtpd(8) alias-handling fix is overhauled and will now also materialize aliases for virtual domains.
On the sgi port sporadic userland misbehaviour (read: SIGSGEV) is fixed on RM7000 O2 systems after further progress on the cache handling.
The installation process will no longer ask "Do you want to do any manual network configuration?" - you have to escape to the shell.
make(1) is tweaked to fix the make -j2 problem by introducing a new SuffLinkParent() algorithm.
Progress in kvm(3) lets fstat -p and fstat -u work on kernel crash dumps again.
nsd-zonec(8) will no longer be verbose by default after an unwanted slipped-in patch hunk is removed again.
On sparc bioctl(8), bioctl(4) and ch(4) are removed from RAMDISK due to size constraints.
impact(4/sgi) performance optimization became possible by using a 4:8:4 colormap.
The alloca(3) of libc goes to the attic - in the future we rely on the compiler to give it to us.
In the bioctl(8) program a missing data initialization is fixed.
The spamd(8) daemon introduces short-period sleeps to handle out-of-file-descriptor situations.
On mips64 the ddb(4) command machine tlb gains the capability to print the address space ID (ASID).
The kernels vmmap handling is further optimized.
On powerpc multi-threaded debugging becomes available in gdb(1).
Update of intro(4/sgi) to reflect recent work.
If you are building IP27 or IP30 kernels, be sure to rm impact.d before building a new kernel.
Support added for all Indigo 2 graphics options.
The audit to replace occurrences of plain unsigned to named integer types continues.
The sgi port adds support for the GR2 family of framebuffers (for at least console devices), properly parsing grtwo(4/sgi) to prevent matching it as an unknown gio(4/sgi) device.
The new sysctl(3) flag KERN_PROC_SHOW_THREADS is mandatory to include threads in, e.g., kvm(3) interface output.
From now on SGI Indigo serial keyboard and mouse (not PS/2) devices will be supported.
On sparc64 multi-threaded debugging becomes available in gdb(1).
The amd64 %fs register is no longer cached, since userland changes can globber it's value.
On IP22 and IP24 sgi machines the powerbutton becomes functional via the new panel device which is enabled by default.
The sh platform can now be compiled with stack protection.
Improved error message for inconsistent operators in make(1).
On the sgi platform the HW_CPUSPEED sysctl(3) becomes functional.
No longer print warnings or try to stop data transfer to midi(4) UART ports when the transfer is already complete.
Drivers for the Indy and Indigo 2 PS/2 keyboard ports and the newport(4/sgi) (NG1, XL, XGE) framebuffer is added to the sgi port.
Framebuffer and console machinery improvements on the sgi platform.
OpenGL related defines have been moved from gbe(4/sgi) and xbow(4/sgi) to a shared OpenGL-specific header file.
The runtime linker ld(1) no longer mmaps 0 byte .BSS sections.
If missing, pkg_add(1) now installs pkglocatedb (after user confirmation), and uses it to search the file system.
On sgi: EISAVERBOSE option is added to the configuration of IP22 kernels; controller-dependent functions are encapsulated in platform-dependent ones; bus_space(9) related imc(4/sgi) prototypes are moved to a public header; and the hpc(4/sgi) child device attachment is overhauled.
top(1) no longer complains about display size after a resize.
smtpd(8) alias bugfix, associate real names with aliases so filters/filenames from /etc/mail/aliases will work correctly.
yacc(1) now uses NULL instead of 0, and calls of memcpy(3) instead of unrolling code inline.
mandoc(1) will no longer bail out if the -width argument is missing.
In mandoc(1) the -width and -offset macro arguments will no longer swallow the next option.
Code simplified for parsing of results in apropos(1).
Mandocdb, the upcoming whatis(1), can now handle multiline NAME sections in man(7).
ifconfig(8), relayd(8) and sasyncd(8) memory leaks fixed.
nginx(8) updated to version 1.0.15.
Fix to a possible kernel deadlock when sending SIGKILL to an orphaned process.
Sqlite 3.7.11 library and shell is imported into base, but not yet hooked to the build.
kvm_getprocs(3) becomes thread-aware. kvm_getfile2(3) gains "a fighting chance to work correctly on crash dumps".
New mutex type PTHREAD_MUTEX_STRICT_NP added to rthreads and becomes the temporary default.
In sasyncd(8), the CDIAGFLAGS infrastructure is added to the make procedure; also using two -c options will now show usage information instead of causing a silent exit.
bpf(4), bpf_mtap_af() will now perform htonl(3) to reorder big/little endian addresses internally.
An asynchronous DNS resolver is imported into the C library, not enabled by default yet.
Memory leak fixed in interprocess communication code sys/kern/uipc_usrreq.c.
xterm(1) updated to version 278, freetype library to version 2.4.9 (see CVE-2012-1126 to CVE-2012-1144, and SA48320).
The libf2c library is removed from OpenBSD base (moved to ports in 2010).
tcpbench(1) now closes accept(2) file descriptors more cleanly after a kill(1), and when no socket connections are present.
pthread_kill(3) signal sent by PT_KILL is now directed to the thread that made us stop.
mbuf(9) data now copied into a temp buffer before being copied to a new cluster. Stops data from becoming scrambled.
No longer clamp file descriptors to buffer size for interprocess communiction, as this can lead to losing them.
Fixed namespace pollution of machine/signal.h to fix build of groff(1) on landisk.
Added support for gdb(1) live debugging of threaded code (enabled on i386 and amd64).
Begin making ptrace(2) usable for debugging multi-threaded programs.
locate(1) will no longer try to mmap a 0-length file.
Provide _atomic_lock() and __cerror() for hppa64. Makes hppa64 build again.
perl(1) now uses base mkstemp(3) and mkdtemp(3) directly.
Allow unlocking an unlocked mutex. All other behaviors undefined by POSIX will result in abort().
spamd(8) no longer assumes that file descriptors it receives are not recycled.
Fix waiting problem at boot on AMD Hudson's ahci(4).
Clean-up release(8) dependency tree, so that release is "MI parallel-make clean" (MD parts not yet).
Use a shared stripping function for nginx(8) chroot(8). Make sure the path starts with the chroot(8) prefix before using.
Use accept_pause() and accept_unpause() calls to manage open file descriptors in ldpd(8).
bgpd(8) aspath_neighbor() now returns the local AS number for empty AS paths.
New m4(1) "expression" and "include" features added to -g flag (GNU-m4 compatibility mode).
Add per thread accounting to ps(1), top(1), sysctl(3), sysctl(8), pkill(1) and kvm_getprocs(3). ps(1) and top(1) now display per-thread times with -H.
Bugfix in hibernation code to correctly unlock the free pageqs, not the in-use pageqs.
Fixed kernel panic when the "main" thread exits but threading code expects it to still exist.
Provide TID and ignore PID in bfd (Binary File Descriptor library). This is more useful for gdb(1).
Removed the rfork(2) system call.
uvm(9) will now properly keep track of the maxrss of the faulting process.
Portable C Compiler moved from base to ports(7).
The fpu control symbol on sh (__fpscr_values) became local in gcc(1)4. Bugs fixed by making it global again.
Backout gcc(1) revision 112331 "optimized integer divide for SH4", so we can use the existing sh libkern functions.
New system call: getdtablecount(2) returns the number of file descriptors the process currently has open.
Bugfix in file descriptor management code to stop dup() calling fd_used() twice.
Documentation for getdelim() and getline() added to stdio(3) manpage.
VersionAddendum option to allow appending some text to the ssh(1) banner.
In the aucat(1) "reply" code path: lock the socket; check if socket was destroyed. Fixes rare crashes.
Flush the log and abort() aucat(1) if we try to destroy a NULL aproc (audio processing unit).
Mark outermost __tfork(2) frame such that backtraces in thread terminate at __tfork_thread().
Added .CHEAP/.EXPENSIVE to explicitly tell make(1) when to avoid parallel make recursion.
Added to mg(1): C-x h to mark whole buffer, and M-| to pipe current region to external command.
Fixed suser calls in san(4), pflow(4), pfsync(4), pppoe(4) and carp(4), which previously passed incorrect p_acflag argument.
Add maxrss keyword to ps(1).
When mg(1) is writing a file via C-x C-w, confirm overwrite of existing files, to match emacs.
In sendmsg(2), permit at most 10% of maxfiles to be in-flight during CMSG_DATA SCM_RIGHTS fd transfers.
Now that sshd(8) defaults to offering ECDSA keys, ssh-keyscan(1) also looks for them by default (bz#1971).
Support "none" as an argument for ssh(1) AuthorizedPrincipalsFile to indicate no file should be read.
ssh(1) and sshd(8) will no longer spin in accept() when out of fds (EMFILE/ENFILE).
Added -H to kdump(1), to print PID/TID pairs.
Speed up uvm(9) vmmap allocations: reduces O(n log n) allocations to O(log n).
Add librthread pthreads(3) barrier support (eg see pthread_barrier_init(3)).
Fixed xinstall to cope with 0-sized mmap now returning EINVAL.
Minimal gdb(1) threads support for i386.
Do rate limiting of accept() when under pressure in relayd(8), ldapd(8) and iscsid(8).
Turn tmux(1) automatic-rename off properly if turned off by renaming a window.
Stopped accepting new tmux(1) clients for 1 second on EMFILE/ENFILE.
kdump(1) will now refuse to operate on trace data without the start record, and will only print PID, unless -H flag is specified.
No longer pick the network number as ifconfig(8) alias on entries with no alias defined.
KERN_NPROCS and KERN_MAXPROC sysctl(8)s and RLIMIT_NPROC getrlimit(2) now count processes instead of threads. New sysctl(8)s KERN_NTHREADS and KERN_MAXTHREAD count/limit threads.
Posix rules that a 0-byte mmap must return EINVAL. uvm(9) now does this.
vfs(9) locks now track the process's pid and not the thread's id.
Handle file descriptor exhaustion in the accept() case for ospf6d(8), ospfd(8), ripd(8) and dvmrpd(8).
Updated libpciaccess to 0.13.1.
More errata bandaid for the R4000SC in the mips64 and sgi tlb handlers.
wdsc(4/sgi) now rejects commands the 33C93 chip does not support. Raised timeouts when it sends stop commands (eg to sd(4) devices).
Make ef(4) cope with strict alignment platforms, and unbreak the RX logic.
Minimal threads support added for mips64.
On the sgi platform R4600 CPU (IP22/IP24) support is now by default enabled in the GENERIC-IP22 kernel configuration (the secondary cache is not supported yet).
Fix of DMA for ethernet operations of the sq(4/sgi) driver of Indigo2 and R5000SC machines.
Minimal threads support for gdb(1) is enabled on the powerpc platform.
The lint(1) program is removed from OpenBSD base.
In Xenocara xtrans is updated to version 1.2.7, libXaw to 1.0.10, xf86-input-joystick to 1.6.1 and xf86-video-r128 to 6.8.2.
Updates to Xenocara: xcmiscproto to 1.2.2, xextproto to 7.2.1, scrnsaverproto to 1.2.2, recordproto to 1.14.2, fontsproto to 2.1.2, bigreqsproto to 1.1.2 and kbproto to 1.0.6. All extended with docbook.am automake files.
tmux(1) will now honour it's automatic-rename option.
urtwn(4) can now recogize BELKIN F7D2102.
snmpd(8) introduces a short-period sleep event(3) to handle out-of-file-descriptor situations.
tcpbench(1) introduces a short-period sleep event(3) to handle out-of-file-descriptor situations.
The Route Distinguishers of bgpd(8) will no longer be used to control distribution; also see bgpd.conf(5).
No longer try FAT detection if we have found an OpenBSD MBR partition, no longer try to read one from a "bare" one. Recognize FAT even if no valid 0x55AA signature has been found. Don't allow the writing of a disklabel on "bare" FAT media.
In the kernels network stack the rtable setsockopt(2) code is brought in line with the setrtable(2) implementation.
In Xenocara setxkbmap(1) is updated to version 1.3.0, xauth(1) to 1.0.7, xfontsel(1) to 1.0.4, xgamma(1) to 1.0.5, xhost(1) to 1.0.5, xload(1) to 1.1.1, xlogo(1) to 1.0.4, xlsatoms(1) to 1.1.1, xmodmap(1) to 1.0.6, xpr(1) to 1.0.4, xwud(1) to 1.0.4 and xkbevd(1) to 1.1.3.
Minimal threads support for gdb(1) is added to the sparc64 platform.
Additional datatype overflow checks are added to getusershell(3).
Work is being done to enable threads support for gdb(1).
The serial console is repaired on Octane and O2 systems (sgi port). More low-level kernel tweaking on sgi, including lots of cache coherency work.
The raidctl(8) utility and the raid(4) RAIDframe driver are removed from the system and go to the attic. OpenBSD has it's own softraid(4).
Cross compilation of nginx(8) is disabled, as it doesn't work.
For reliability of the systrace(1) utility a minor argument-offset fix is backported from -current to the OPENBSD_5_1 patch branch.
The getrusage(2) systemcall fixes the report of total time again.
On the sgi platform low-level kernel tweaking results in compatibility improvements with IRIX timekeeping.
The iked(8) and ftp-proxy(8) daemons introduce short-period sleep event(3)s to handle out-of-file-descriptor situations.
The MS-DOS FAT filesystem implementation gains a significant write speedup for large files (up to twice as fast).
In Xenocara's libpciaccess, memory handling of struct pci_io_handle is simplified. This fixes vgaHWSaveFonts() in the 1.12 xserver on OpenBSD (other sub-systems relaying on pci_io could be affected, too).
In ospfd(8) the two LSA types LSA_TYPE_AREA_OPAQ and LSA_TYPE_AS_OPAQ will no longer trigger a fatal program exit when found during SPF calculation.
The kernel ensures that on amd64 identifycpu() is called once only, which fixes occasional hangs on resume.
The old socket credential approach using struct sockcred and SCM_CREDS is outdated and removed from the tree.
Several privilege-separated daemons (ftpd(8), pflogd(8), syslogd(8), tcpdump(8) and the X server) will bail out earlier if some file-descriptor passing recvmsg(2) fails.
The ps(1) program gains the tid formatting keyword. In conjunction with the -H option, thread ID is now included.
Small fixes of the path-handling of the OpenBSD-specific chroot(2) codebase of nginx(8) are seen. In the nginx build, compiler optimization flags will now be inherited from the build.
fdisk(8) is now capable of handling pathological geometry cases like SCSI attached floppies which have a "geometry" of 1/1/2888.
More IATA airport codes added to share/misc/airport.
sndiod(8) will first check if limits allow creation of a new device and then bail out if allocating memory for it fails, not vice versa.
In the PIPEX (PPPAC IP Extension) code of the network stack a bug was fixed that caused LCP keepalive failures on some clients.
The fxp(4) driver will reload the firmware after suspend/resume, but skip firmware updates entirely for FXP_REV_82550_C with server extensions since this version can't handle such efforts.
On the sgi platform the eisa0 attachment is now by default enabled in the GENERIC-IP22 and RAMDISK-IP22 kernel configuration files.
On the sgi platform the DMA-reachable address space is extended, now limited only when hpc(4/sgi) devices are present.
A long-standing bug in the kernels assumption on USB keyboard layouts is fixed.
Progress in integrating unbound(8) into base is seen, like calling setusercontext(3) before chroot(2)ing.
Kernel compilation with pf but without the pfsync pseudo-device is again possible.
Optimization for icmp6(4): rejections of redirections will occur faster since the is-multicast check is performed before other expensive checks.
The sgi platform gains an EISA bus attachment glue for Indigo 2 systems.
In sasyncd(8) the code flow in the error path is significantly simplified. Fixes possible memory leaks.
The zoneinfo database is updated to tzdata2012c (no code updates).
In gcc(1), correct the effects of the -fident and -fno-ident options, which were inverted.
In chrooted operation mode, nginx(8) fixes its root path by stripping the PREFIX.
Simplified tmux(1) mouse input function.
Updated libexpat to 2.1.0, and use arc4random(3) instead of rand/srand in generate_hash_secret_salt().
Increased delay between zs(4/sgi) chip register accesses. Fixes the console freeze during install seen on IP22 and IP24.
Manpage for accept(2) now reminds people to consider EMFILE/ENFILE behaviour when we are nearing file(9) descriptor exhaustion.
Added tmux(1) layout history. Can be stepped through with select-layout -u and -U commands (bound to 'u' and 'U' by default).
Initial support for an st(4) audio attachment to tape drives. Currently limited to reel drives (eg QIC-150).
Updated xf86-input-mouse to 1.7.2 and xf86-input-synaptics to 1.5.2.
Updated termtypes.master to terminfo.src from ncurses-5.9-20120331.
Added tmux(1) pane_current_path format.
Only exit mouse mode on scroll wheel when actually reaching the end of the tmux(1) history.
In tmux(1) find-window, only find each window once no matter how many panes there are.
With nc(1), error out if accept() fails.
Make fsck_msdos(8) work with non-512-byte sector devices; added many tests and error messages; ignore invalid signatures; and now always use character device to read disks.
Expand the panic in kern_malloc.c to show the malloc type and size.
Increased smtpd(8) timeout to 5 minutes when connecting to remote mail server, required by RFC 5321.
In bgplg(8), print the AS number by using the -A option to traceroute6(8); increase display width for long IPv6 addresses.
Properly store the result of the pmtu-route lookup. Fixes PMTU-discovery for TCP over ipsec(4).
If the MIDI UART is not ready for output, don't spin at IPL_CLOCK, make midi(4) driver retry later.
Add sshd_config(5) PermitOpen none option (bz #1949).
Clarified in the tsort(1) manual that there must be an even number of node names, not pairs.
Allow ELF kernels to be booted on ELF-unaware PROM on SGI architectures.
aucat(1) no longer spins when accept() fails due to file descriptor limit being reached.
In acpi(4), prevent hibernation attempts on machines with unsupported disk controllers.
On mips architectures, default gcc(1) to -mfix-r4000 -mfix-r4400 when building in big endian mode.
Work in progress support for the SGI Indigo, Indigo 2 and Indy systems (IP20, IP22, IP24) in 64-bit mode.
Use process pid not thread pid in networking code, so userland can compare value against getpid().
Rewritten yelp section in port-modules(5).
Close an opendir() in mg(1), and make sure delete key deletes the character to the right of the cursor.
Bugfix to correctly fill kinfo_file2 structure's f_wbytes member with the written (not read) byte count.
Make the msk(4) PHY on EC Ultra/8056 ethernet adaptor work correctly.
Fixed documentation that the sysctl(8) is net.inet.ip.encdebug, not net.ipsec.encap.encdebug.
In ssh(1) PROTOCOL.certkeys, explain certificate extensions/crit split rationale.
Update to xcb-proto 1.7, libxcb 1.8.1, xproto 7.0.23, and libX11 1.5rc1.
Introduce selected to bgpctl(8) as show rib attribute to only show selected routes.
Do not try smtpd(8) STARTTLS if server does not advertise support for it. Check we are not using AUTH over a clear channel.
With Intel SpeedStep, only attempt to calculate i386/amd64 bus_clock if we can't get tables from acpi(4).
Make i386 bus_clock calculations happen later in the boot process. Brings i386 SpeedStep code closer to amd64.
Implemented AMD workaround for 10h & 12h CPUs cpu(4/amd64) errata 721 "Processor May Incorrectly Update Stack Pointer".
Run amd64 identifycpu() on its own cpu.
Added a function in bgpctl(8) to extract an address. Allow the dump attr of struct mrt_parser to be NULL.
Simplified conditionals in acpi_sleep_state().
Added hibernate request support (ZZZ binary). Documented ZZZ, tweaked FILES and HISTORY in apm(8).
Increased size of message queues in sparc64/dev/hvctl.c to handle the default "MTU" of 4096 bytes. Make writes block if message queues are full.
Added DLT_PPP_SERIAL and DLT_C_HDLC to bpf(4). Helps porting apps that assume they are on all systems.
Document how to use gre(4) keepalives with pf(4) enabled.
Added support for the Polaris2 USB dock, which is an udl(4).
Adjust the default "ignore" list for cvs(1); don't ignore "core", ignore "*.core", ignore ".git".
Fixed cz(4) so it can compile (is not enabled by default).
Fix an integer math error in hibernation code; add hooks for a HIBERNATE enabling option in GENERIC.
kevent(2) now releases the file reference on the kqueue, so that closing the descriptor doesn't result in a deadlock (reported in NetBSD PR 46248). Fixes some threaded ports.
In string.h, some prototype conditionals are adjusted to match POSIX: strsignal(3) is in POSIX-2008; strerror_r(3) is in the base of POSIX-2001, without an XSI qualifier.
Mips64 cache handling routines were moved out of cpu.h to cache.h. Common CACHE_ prefixes introduced; integer types used to represent addresses changed from vaddr_t to uint64_t.
On mips64 a regression caused by the recently changed behaviour of calculating CpuCacheAliasMask is fixed.
The smtpd(8) MTA no longer panics if a connection fails, but instead continues trying with the next relay.
The scandir(3) manual documents the argument change to struct dirent** from void*, and clarifies HISTORY.
In ipsecctl(8) two memory leaks are fixed.
More USB devices based upon Ralink RT3070 chipset are now recognized and run(4).
relayd(8) can now use a separate SSL certificate for each port (/etc/ssl/host:port.crt, /etc/ssl/private/host:port.key), also see relayd.conf(5).
urndis(4) now supports the ZTE HSUSB device.
In iked(8) six memory leaks are fixed.
getrusage(2) totals, itimers, and profile settings now return information per-process rather than per-rthread.
sym(4) now recognizes NetBSD iSCSI.
In aucat(1), a MIDI-controlled master volume knob is introduced that may be used to adjust the mix of all playback streams.
usbhidaction(1) now ignores SIGCHLD as it doesn't care what happened to the forked processes.
In the thread library some (unimplemented) non-portable functions and their manual pages are removed.
A code cleanup in make(1) introduces a Location structure to combine filename and line number information.
The tmux(1) show-environment command can now accept an argument to show just one variable.
To reflect __tfork_thread moving from rthread to libc, and other changes to libc, bump the former to 15.0 and the latter to 63.0.
The DIR type is now opaque.
scandir(3) and alphasort(3) will take struct dirent** arguments instead of void*, as per POSIX. For __POSIX_VISIBLE < 200809 code, the old prototypes are still provided (if __BSD_VISIBLE).
Libc's dirfd(3) is no longer available as a preprocessor macro.
getdelim(3) and getline(3) are added to libc.
execvpe(3) and the posix_spawn(3) family are added to libc.
The manpage of pthread_testcancel(3) is updated to reflect the current list of functions which are cancellation points. closefrom(2) is now a cancellation point.
Calls to vrele(9) in NFS are protected against being called with a NULL argument.
A bug is fixed in the random(3) implementation: in the past, if srandom(3) had been seeded with 0, random(3) would have always returned 0.
A self-sufficient directory descriptor structure is introduced to ld.so(1)
The sparc64 port introduces the HVIOCREAD and HVIOCWRITE ioctl(2)s for hypervisor memory access.
A series of updates for tmux(1): the options c0-change-trigger and c0-change-interval can be used to control the newly implemented output rate limiting (boosts responsivity under very fast output, like running yes(1)); adds -C, -N and -T flags to find-window to find in content, name, or title.
New OIDs for snmpd(8): hrSystemUptime, hrSystemDate, hrSystemProcesses and hrSystemMaxProcesses.
Problems fixed which may have been observed with rthreads in conjunction with the dynamic link interface.
In smtpd(8), no newly created bounce message is inserted into the scheduler if it is already present therein.
The sgi port will now only restrict the page size to 4096 bytes on R5000 and RM7000 processor families, but otherwise default to 16384. Subsequent tweaks in the VM code of the kernel.
On the sgi port it becomes possible to boot over the network (bootp).
Only change the default boot device to a bootable softraid(4) volume, if we are able to handle the given discipline. boot(8/amd64) currently restricted to RAID 1; not available on other architectures.
More search paths for pkg-config(1): /usr/local/share/pkgconfig and /usr/X11R6/share/pkgconfig will also be searched by default.
kdump(1) tracing and dumping of "pointer to struct" syscall arguments is added for structs timespec, timeval, sigaction, and rlimit.
i386 and amd64 can now identify Xeon MP 7400, Atom Z6xx, Atom [DN]2xxx, Xeon 6500/7500, Xeon E7, and Core i3/i5/i7 3rd Generation when querying the bus clock. Avoids "unknown models" messages (real information still read through acpi(4)).
Clarification the nwkey text in ifconfig(8).
Update to libXt 1.1.3 (fixes some broken bold fonts).
Add a wrap-search option to turn off wrapping of searches in tmux(1) copy mode.
Some terminals (eg mintty) have cursor styles 5 and 6, now allow them to be set in tmux(1).
Bugfix to call recalculate_sizes() when changing tmux(1) window with the mouse.
Add tmux(1) -q option to set-option for turning off info message.
Add vldc(4) and hvctl(4), allows sparc64 control domain to talk to the sun4v hypervisor.
Do not clear to end of line if the line is full. Fixes missing last character in rightmost tmux(1) pane.
Use the tmux(1) region lower rather than the pane size to work out where the bottom line is.
Redirect libevent logging to tmux(1)'s log.
Bugfix to tmux(1) so after wrapping a line in a pane, the cursor will move to the next line.
Some updates to rc.conf(8) manpage to reflect reality.
No longer leak ypldap(8) ypldap_addr structures when doing dns lookups.
Display L3 cache information on amd64 architecture for AMD CPUs.
Take cd9660 support off the "obviously a floppy" i386 and amd64 install media, to make more space.
Improve ipsec(4)/ENC interaction to avoid unnecessarily dropping some packets.
Add AMD Hudson-2 chipset to azalia(4).
Let nviic(4) match the NVIDIA MCP89 chipset.
Direct IPv6 packets with ethernet encapsulation into the appropriate input routine, so two IPv4 networks can bridge over an IPv6 link with gif(4).
When using xterm(1) with tmux(1), parse terminfo when starting up to work out the xterm(1) version.
Use the correct dir for php in the default nginx(8) config.
Accept empty/nonexistant ldap attributes when we want a ypldap(8) list, allowing empty groups to show up.
Fix regression in ssh(1) so root is always excluded from the test for /etc/nologin.
Fix leak in ypldap(8) ue_netid_line when freeing the old user tree.
Store context before moving the cursor when wrapping, to fix tmux(1) bug causing drawing over the status line.
Fix booting on the Thecus N1200.
Close a race in uipc_socket.c that could corrupt a socket(2) sockbuf. Bugfix for "receive 1" panic.
Remove inline version of m_copym2 in ubsec(4). Workaround to stop ubsec(4) gets stuck after receiving a packet of a particular length.
Update to util-macros 1.17.
Remove the NO_HELP conditional directives, as mg(1) will not compile if they are defined.
Repair function in bc(1) when used with different scales.
Correctly move back smtpd(8) envelope from offload tree to msg tree. Fixes crash seen on mailservers under load.
Fix some rotation issues in the intel(4) driver.
Fix check for xf86Modes.h. Fixes radeonold(4) driver build issues caused by caching of the (previously wrong) result.
Don't call wdcintr() for pciide(4) channels that aren't properly initialized or don't have any drives on them. Fixes a panic seen on sparc64 machines with Acer Labs chipset.
Added manpages for __thrsigdivert(2), __thrsleep(2), and __thrwakeup(2).
Rough regression tests of the bc(1) math library added.
Teach pgrep(1) and pkill(1) to only match processes, not threads.
Update to makedepend(1) 1.0.4 and imake(1) 1.0.5.
Allow radeonold(4) to build on macppc and sparc64.
Add -P/-F flags to tmux(1) break-pane.
In tmux(1) a cursor positioning bug is fixed.
mfi(4) documents support for Dell PERC H310.
The PCI database gains knowledge of HP Smart Array P220i/P222/P420/P420i/P421/P721m/P822.
Xenocara's bsd.xorg.mk switched from Python 2.6 to 2.7.
The acpi(4) aml_evalexpr() function is fixed to use 64 bit unsigned integers, and a check is made the _REG method is available before calling.
Xenocara libXcursor is updated to 1.1.13, libXdmcp to 1.1.1, libXext to 1.3.1, libXft to 2.3.0, libXinerama to 1.1.2, libXmu to 1.1.1, libXpm to 3.5.10, libXrender to 0.9.7, libXt to 1.1.2, libXtst to 1.2.1, libXv to 1.0.7, libXvMC to 1.0.7, libXxf86dga to 1.1.3, libXxf86vm to 1.1.2, libdmx to 1.1.2, libxkbfile to 1.0.8, and glproto to 1.4.15.
TCP initial window increased to 14600 bytes as in http://tools.ietf.org/html/draft-ietf-tcpm-initcwnd-02; sysctl(3) net.inet.tcp.rfc3390 now defaults to 2 to reflect that.
In Xenocara, update bitmap to 1.0.6, libXres to 1.0.6, util-macros to 1.16.12, libXScrnSaver to 1.2.2 and libXau to 1.0.7.
In /etc/rc (see rc(8)) ypbind(8) is now started after ypldap(8), because it needs to talk to ypserv(8) (which in turn is ypldap(8)).
PS_EXITING flag introduced to better differentiate between the process and the main thread exiting.
Signal dispatching has (at least temporarily) been changed to give sigwait(3) priority over ptrace(2).
ypldap(8) won't stumble over nonexistent users when creating groups, but simply leave that one out and continue with the next user entry.
In Xenocara, update libpciaccess to 0.13.
When creating PF rules the relayd(8) daemon takes care to set onrdomain and prio to ensure proper functioning.
A new, simplified vmmap (memory allocator) added to the kernel.
tmux(1) server start now serialized via lockfile. Bugfix for window name not reflecting what is currently happening.
dc(1) calculator length(0.000) will now behave exactly as GNU dc(1).
bc(1) now initializes the editline(3) library even in -c mode.
On the landisk platform the pixman library had to be disabled, because it triggers an internal gcc(1) error.
In smtpd(8) the fsqueue will no longer panic for a missing queue directory (ENOENT), but simply continue with the next entry. And more reliability improvements take place.
Support for AMD Hudson-2 is added to piixpm(4).
An example in queue(3) manpages is fixed to compile without warnings.
The xtsscale Xenocara program uses __progname from crt0.o instead of argv[0] for messages.
nginx(8) is updated to 1.0.13.
For glxpcib(4/i386) support for an I2C-bus SMB controller found on a AMD CS5536 companion device is added.
Check added to network stack to see if a route is still valid when getting the cached route entry of a pcb (protocol control block), and that correct routing table is used.
Add the _POSIX_MONOTONIC_CLOCK symbol and the _SC_MONOTONIC_CLOCK sysconf(3) variable.
tftp-proxy(8) now fills in default values for rtableid/onrdomain/prio when creating PF rules.
Disable the use of unsafe builtin gcc(1) functions (strcat, strcpy, stpcpy) making them easier to spot in the object files. Add stpcpy(3) to the list of unsafe functions.
Clarification of :*: in passwd(5) manpage.
The detection of the RFC 6396 encoding of the MP_REACH_NLRI attribute is improved for bgpctl(8).
In pms(4) support for a special ALPS protocol (using interleaved PS/2 packets) is added, as is used on touchpads for Dell laptops E6xxx and E5500, possibly others.
rc.d(8) bits are added for the new standalone tftpd(8) daemon.
An old but still current paper on encrypting virtual memory is now available on the papers website.
In Xenocara the xf86-video-ati driver is updated to version 6.14.3.
New threads now inherit their TCB (thread control block) address from their parent thread.
The tmux(1) commands new-window and split-window now support the option -F to specify a format when printing the window location with the -P flag.
The tmux(1) commands send-keys and bind-key now accept hex values for the key argument.
Add A and I keys for tmux(1) vi-like status line editing.
In preparation for getline and getdelim additions to libc, getline() occurrences are renamed to get_line().
Document sem_timedwait() in sem_wait(3).
Fix the logic deciding whether to return PCI_COMMAND_MASTER_ENABLE in the Loongson emulated pci functions #2 and #3.
Don't print the device name twice in yds(4) attach error messages.
Added many regression tests for rthreads.
The tmux(1) command paste-buffer now offers a -p option to enable "bracketed paste" mode.
The tmux(1) wlmouse offset is now corrected to be part of the client, not the server.
Add tmux(1) move-pane command (like join-pane but allows the same window). Also -b flag to join-pane and move-pane to place the pane to the left or above.
Fix handling of "offend" (OFFset from the END of the arg list) arguments in systrace(1).
Add printf attribute to a couple of tmux(1) functions.
Update nsd(8) to version 3.2.10.
Don't include ou=People in the ypldap.conf(5) basedn, as ypldap(8) has netid support, and groups are usually stored outside of People.
Added the new standalone tftpd(8) to base, a persistent event driven tftp daemon.
Sync gcc3 and gcc4 knowledge of the kernel printf capabilities with reality.
Use UE_GET_ADDR to get endpoint address (remove direction bit) in uaudio(4). Fixes devices using sych endpoints.
zaudio(4/zaurus) is play only, so return ENXIO on any attempt to open the device for recording. Fixes full-duplex apps (including sndiod) unable to fall back to play-only mode.
Support the ASIX AX88772B axe(4) USB ethernet controller.
Allow ssh-keygen(1) conversion of RSA1 keys to public PEM and PKCS8.
Let malloc(3) test for the retrieved page address not being NULL. This turns free((void*)1) into an bogus pointer error instead of a segfault.
Support the Roland UM-ONE umidi(4) device.
Update to pixman 0.22.4, xev(1) 1.2.0, xwd(1) 1.0.5, and xwininfo(1) 1.1.2.
Luna88k multi-processor support, step 3. GENERIC.MP configuration file based on mvme88k.
Add mos(4) support for the MosChip MCS7832, a low pin count version of the MCS7830.
Updated the list of supported four digit models in intro(4/hppa).
Mention in se(4) some additional phys (physical layer interfaces) that may be able to attach.
Copy p_tcb (user-space thread-control-block address) on fork, for non-__HAVE_MD_TCB archs.
Added sys/dev/pci/pcidevs codes for Realtek RTL8192CE, Nvidia nForce 780a SLI and nForce 200 chipsets.
Always try to reclaim jme(4) transmitted frames to prevent watchdog timeouts when there is no link present.
Add checks to rthreads when trying to unlock an uninitialized mutex to make sure it returns EPERM.
The mandoc(1) program now replaces bogus characters with ? instead of just dropping them.
In man(7), support the .OP macro (for compatibility only).
On the mips64 and sh platforms the per-thread errno should be fixed.
The ix(4) interrupt routine uses a shorter path to reenable interrupts and gains other tweaks which result in a doubled performance on 82599.
In the gus(4/i386) driver MIDI registers will only be used if they are actually available. This fixes an issue which caused the driver to be disabled on 1999-08-22, but the happy-end can finally be seen in i386 GENERIC.
For the elroy(4/hppa) driver an integer truncation error is fixed which caused systems to freeze hard.
The process tracing facilities will work again on processors without floating-point registers/state. (Had been broken by the large extension of the 20th.)
In tmux(1) the show-options and window-show-options commands can now be used to show just a single specified option.
Minor tweaks and cleanups in the amd64 code of the kernel have been observed.
pthread_yield(3) is renamed to sched_yield(3).
Manual pages are created for the pthread_condattr_t type.
The tmux(1) display-message command is extended by a -F option which can be used to specify a format string to control output formatting.
New functions are added to the thread library: pthread_mutex_timedlock(3), pthread_condattr_getclock(3) and pthread_condattr_setclock(3); also, PTHREAD_MUTEX_NORMAL mutexes learn about self-deadlocks.
snmpd(8) gains the MIB module for gathering information from OpenBSD's packet filter.
In chroot(2) mode nginx(8) first chdir(2)s to the PREFIX directory before it starts to create it's temporary directories.
The pthread_suspend_np(3) and pthread_resume_np(3) function are no longer functional and become ENOTSUP stubs.
A lot of work is being done for making process tracing work with rthreads.
In Xenocara, update xf86-video-geode 2.11.13 and xf86-video-dummy to 0.3.5.
kdump(1) fixes an integer flip which could have happened for a kernel trace record with ktr_len of SIZE_MAX and would have caused a zero byte data allocation. It also learns more system calls and refactors output routines as well as the output produced by the latter.
A lot of work is being done on regression tests for threads.
Bugfix in tcpdump(8) to correctly check BGP prefix lengths in withdrawn routes.
Fix return value documentation errors in usbhid(3).
Allow for more vars in ksh(1) hash table, improve hash function, increase hash table size sooner.
Initialize the scope, policy, and inherit members in pthread_attr_init() so that their pthread_attr_get* don't return bogus values.
Update nginx in base to 1.0.12 and sync its pcre(3) with the version in ports.
Update to mkfontdir(1) 1.0.7, mkfontscale(1) 1.1.0, oclock(1) 1.0.3, xclipboard(1) 1.1.2, xclock(1) 1.0.6, xcmsdb(1) 1.0.4, xcompmgr(1) 1.1.6, xfd(1) to 1.1.1 and util-macros to 1.16.1.
Add DIAGNOSTICS to bsd.port.mk(5), for easy grepping through logs, and no longer label "warning messages" as "errors".
pkill(1) will now exit usage() with STATUS_BADUSAGE rather than STATUS_ERROR, in agreement with the man page.
Set __isthreaded in pthread_create(3), i.e. even if a forked child creates a new thread. Fixes an rthread bug to properly represents whether a process is multi-threaded or not.
Do an explicit "sync" instruction before returning from cache routines on mips64 (nop on R5k/RM52xx, but required on RM7k).
Add kevent(2) support for msdosfs to make applications monitoring fs mounts happy.
Enable rthreads by default (threads now in kernel not userspace), and add additional pthreads regression tests.
Hold struct filedesc's fd_lock in more places. Fixes hangs in rthreaded processes calling fork(2).
No longer attempt to enable MSI on 82571/82572 em(4) Gigabit ethernet controllers (to workaround "Byte Enables 2 and 3 Are Not Set" hardware bug).
pkg_create(1) now warns when @option no-default-conflict has been set without explicit @conflict.
--------
Changes made between OpenBSD 5.0 and 5.1
In the ahc(4) driver a bus_space_barrier(9) is used beforehand a plain bus_space_read_1(9) to force a barrier, as the latter alone turned out to be insufficient.
The wscons(4)-specific configuration of Xserver(1) uses the "macintosh" xkb model on adb(4/macppc) keyboards.
daily(8) gets another update and will ignore commented out (#) lines in fstab(5) during /altroot handling.
traceroute6(8) learns the -A option, which can be used to look up the AS number for each hop address. (Uses the DNS service described at http://www.team-cymru.org/Services/ip-to-asn.html.)
The kernel ensures that DUIDs are only interpreted on disks.
A major rewrite of the pf(4) manpage example shows a usage-case of DIOCGETLIMIT (instead of DIOCNATLOOK).
The new -T option to pkill(1)/pgrep(1) can be used to restrict matches to processes associated with the specified routing tables.
OpenSSH 6.0 leaves -beta state.
aucat(1) cranks the default buffers size to 160ms (7680 frames at 48kHz) to avoid the audio stuttering that some users have observed during high load.
The POOL_DEBUG kernel option (not in options(4)) is turned off for the release: Note that POOL_DEBUG is not the same as it was in 4.9 or earlier. In either case you can turn it on again using sysctl(8) kern.pool_debug=1.
Atmel AT91 CDC ACM becomes known to umodem(4).
quotacheck(8) gets far more flexible as it now uses realpath(3) and opendev(3) to utilize fstab(5) and command line arguments.
The automatic daily(8) /altroot backup will now also work with a duid-based fstab(5).
In jme(4) it was possible to simplify jme_newbuf() as M_DONTWAIT "failures" during driver initialization would indicate a more general problem anyway.
A recent extension of the kqueue code of event(3) fires read events when kqueue returns EBADF and several other things, particularly EPIPE on a file descriptor. The EBADF cause however is reverted again due to problems with Google Chrome.
The Xserver(1) build is disabled on the hp300 and mac68k ports: Building the Xserver with gcc 2.95 is getting hopeless and there is not enough manpower at the moment to switch these platforms to a more recent compiler.
OpenBSD 5.1 leaves -beta status!
The nc(1) manpage gets an extended CAVEAT section.
In Xenocara the update of xf86-video-ati to 6.14.3 is reverted after regressions have been seen.
The tsearch(3) function is patched to match the corrected POSIX standard behaviour (which clarifies the return value of tdelete(3)).
tmux(1) gains a fix which avoids accessing a NULL pointer.
pkg_add(1) gains a fix which avoids accessing an undefined package list.
Improve pf(4) ICMPv6 direction check.
Do not insert an empty ENTRY into the man(1) manpath list; was causing out-of-bounds array access.
Fix ipcs(1) handling of message queues when in crash dump mode: update to match changed kernel structures.
Fix SysV message queue identifiers (e.g. msgget(2)).
If the readdir(3) internal consistency check fails, set errno so that it doesn't just look like end-of-directory.
Close races in iha(4), sili(4) and ahci(4) where timer is started on a command and then a splbio() timeout is called before the command is started.
Add #ifdefs so kernel can compile without INET6. Note: af translation is only possible with both INET and INET6.
Disable the polling timeout when computer suspends.
Only use mime/line-split if the smtpd(8) input message actually contains a very long line.
Add netflow v9/ipfix support to pflow(4).
Bound check ksh(1) table expansion.
Add -l flag to tmux(1) send-keys to send input literally (without translating key names).
Fix tmux(1) client_width and client_height (were reversed), and don't change pane when changing window with mouse on status line.
When updating an smtpd(8) envelope status, update is now sent to the queue and the envelope discarded from the MTA batch. Status of all pending envelopes now set before MTA_DONE is reached.
Add instance identifiers to snmpd(8) variable bindings. NetSNMP, relayd(8) and HPOV will now understand it.
Improve synopsis markup of login utilities and add missing flag descriptions in: login_krb5(8), login_passwd(8), login_radius(8), login_skey(8), login_tis(8), login_token(8) and login_yubikey(8).
Bugfix in smtpd(8) buffer code.
Document login_yubikey(8) options.
Document "Gen2" adapters based on Lanai-Z8ES chipset are supported by myx(4).
Add product ID's to sys/dev/usb/usbdevs and uhid/uaudio quirks to recognize iPad and the iPad 2.
Document (in share/snmp/OPENBSD-BASE-MIB.txt) relayd(8)'s use of the openBSD.3 OID; move the CARP MIB to openBSD.6 to avoid a conflict with relayd(8).
Remove mcpu options from armish kernels.
Add the OPENBSD-CARP-MIB to snmpd(8).
Added defined ways to set the various tmux(1) default-path possibilities; provide -c flags to neww and splitw to override default-path settings.
Kill calendar(1) descendants on child timeout.
Removed 2 obsolete drivers (xf86-video-radeonhd and xf86-input-citron) now unlinked from builds.
Update to Xserver(1) 1.11.4.
Explicitely disable DRI on SandyBridge and newer chipsets. Prevents X from crashing.
Add test suite for IPv6 neighbor discovery protocol. Can be used to test both pf neighbor discovery states and the IPv6 stack.
If a kernel sensor doesn't have a description, snmpd(8) will now come up with something useful rather than an empty field.
Document af-to (aka nat64) in pf.conf(5).
Don't print double spaces in tmux(1) list output.
smtpd(8) no longer encodes headers, as it breaks the resulting message.
Document the handling of partial distfiles collections in mirroring-ports(7).
systat(1) now defaults to only show all non-listening sockets, to match manpage and netstat(1). Add a to toggle the above, and r to reset all toggles to default. Document a/n/r/t/u toggles.
Prevent softraid(4) from being used with devices that do not have a sector size of 512 bytes - any other size is not currently supported.
Add missing header needed by smptd(8) PRI format string.
Handle a wider range of kqueue(2) error return values for an event. Prevents libevent exiting the event loop when getting EPIPE.
Give each tmux(1) window a unique ID prefixed with @. Add pane ID to each pane in layout description (while still accepting the old form).
The Radeon HD 6320 becomes known to the system (and drm(4)).
tcpbench(1) uses integer instead of floating-point for printing PPS in UDP mode.
bioctl(8) documents it only supports devices with 512-byte sectors.
A cleanup of vgafb(4) is started to "make it more like vga(4)".
ath(4) gets some more tweaks which should avoid panics when switching in hostap mode from 11a to 11b.
bsd.port.mk(5) documents PKGFILES.
nsd(8) is updated to 3.2.9.
The akbd(4) and ukbd(4) drivers improve support for Apple ISO keyboards. Also more Apple USB keyboard ids become known to the system in general.
smtpd(8) fixes an issue with concurrent access to temporary envelope files. It completely exchanges it's I/O infrastructure with an I/O buffer abstraction layer to have a better separation between I/O and protocol logic. It also turns away from moving to-be-deleted message directories to a purge/ directory, but instead removes them right away.
tmux(1) frees event(3)s before closing the associated file descriptors. It adds an option to move the status line to the top (status-position). It enforces the history-limit option when clearing the screen.
The softraid(4) driver fixes a faulty ioctl dispatch as it intercepts ioctls meant for the bio layer.
pf(4) enhances as it tries to lookup the icmp state based on a correct packet descriptor; it also improves icmp virtual id generation for ND and MLD packets so that two consecutive host addresses won't generate the same value which is used as a port number in state entries.
In tcpdump(8) names rather than numbers are printed for the old draft nat-t attributes, cisco use these at least as recently as ASAs running 8.4(1). And since some decodes are likely to have unprintable characters it no longer uses fprintf(3) to print 'em.
ath(4) gets some tweaks which should avoid panics when switching in hostap mode from 11a to 11b.
A sppp(4)-specific "fast queue" used for tcp ports 21, 23 and 513 is removed. You should use the proper queues via pf(4) instead.
luna88k multiprocessor support enters round 2.
smtpd(8) introduces a new scheduler_backend API - it is now possible to write custom schedulers; the builtin scheduler_ramqueue adds a verbose log_debug handler which can be used to display the entire ramqueue. Other "annoying" debug logs are removed from the code. And finally smtpd(8) adds some more MIME 1.0 support, including fully compliant quoted-printable encoding, and properly breaks long lines.
When setting groups via user(8)s -S option, make sure all provided groups exist. It is now also possible to remove a user from all secondary groups by using an empty argument for -S.
The kernel forces usb(4) to re-explore the bus after resume, which might help a few laptops to resume their usb devices better.
pflog(4)s pflog_bpfcopy() is fixed which avoids that tcpdump -i pflog0 prints uninitialized kernel memory for short packets.
To help people who track -current the perl(1)-based makewhatis(8) learns to deal with nonexistent databases.
The stderr of fw_update(1) is redirected to /dev/null instead of being closed.
Hook login_yubikey(8) to the build and mention it in login.conf(5).
pf(4)s IPv6 code evolves further. In addition pf_normalize_ip() and pf_normalize_ip6() change their prototype and add additional checks to make the code more robust.
tcpbench(1) learns the new -t option, which can be used to force program exit after a specified amount of seconds.
axe(4) also supports Level One USB-0301.
In smtpd(8) a data file stream is explicitly rewinded before its reuse to fix a possible issue in case the former use was aborted. It also implements some minor tweaks.
In pf(4)s pfr_pool_get() the interrelation in between an access index and a counter is fixed, and thus the flow of code.
aucat(1) makes the default rate 48kHz and the default block size 10ms. These settings ensure video players and programs using MTC are smooth by default.
A memory leak which would occur in an error path is fixed in tmux(1).
For iwn(4) a calibration timeout is dropped when the interface is stopped, which should redress problems in suspend/resume situations.
In Xenocara a bunch of work is done on the Radeon driver: version 6.12.2 is renamed to radeonold; As this is the last known working version in "zaphod" mode (one X screen per head in multi-head configs), this makes it possible to update the "real" radeon driver in and as xf86-video-ati without breaking existing zaphod setups; xf86-video-ati is updated to 6.14.3; The xf86-video-radeonhd is deprecated and removed from the tree since all radeon cards are supported by xf86-video-ati.
In ssh(1) more messages types are forbidden during rekeying, since at that time only key exchange messages are allowed. It also fixes a memory leak in key_load_file() and drops the unused packet_read_poll() function.
In the kernel some cleanup is applied to ieee80211(9).
An EXAMPLES section is new in divert(4).
When the kernel signal handling code checks to which thread a signal can be delivered to, add threads as possible targets which don't explicitly block the signal in question. (Search is terminated if thread which sigwait(3)s for the signal is seen.)
A short cut for atomic IPv6 fragments is added to the network stack. Those will be processed immediately and not go through the fragment queue. See draft-gont-6man-ipv6-atomic-fragments-00.txt.
In Xenocara xkeyboard-config is updated to 2.5.
smtpctl(8) no longer touches directories, which prevents a running smtpd(8) from losing it's incoming/ directory each time smtpctl(8) is called.
In the network stack the RFC 5722 implementation cumulates in a happy end, i.e., in case of overlapping fragments the entire datagram will be discarded.
The ingress filter of pipex and npppd(8) becomes configurable and disabled by default. After this change npppd.conf(5) must contain ppp.ingress_filter: true if it is needed. Also handling of 'rx connect speed' AVP is added to avoid the bug of xl2tpd (which sends this as a mandatory AVP contrary to RFC 2661).
Bring in documentation corrections and improvements to the in-tree versions of makewhatis(8), apropos(1) and whatis(1) that were committed to the new suite of tools (currently disabled).
Repair hp300 support for 68030 chips, broken in revision 1.67 of sys/arch/hp300/hp300/locore.s.
Credit Keith Sklower and 2BSD for the first implementation of fopen(3) read-write access (source: 2bsd directory of the CSRG archive CDs).
Convert softraid(4) to new bio(4) status interface, allowing bioctl(8) to provide useful feedback, rather than reporting an ioctl failure/writing to dmesg. For now, continue to print most feedback to the console.
If no bioctl(8) controller name is provided, use the program name as a prefix. Also, exit with "unknown error" if a bio(4) error is reported but no status message has been provided.
Prevent softraid(4) crypto from walking an uninitialised list if we fail to read the key disk.
Ensure that the softraid(4) sc_lock is held before the status functions are called, and disable the disk attach hook on detach.
Show pane size in top right of tmux(1) display panes mode.
Clarify PCMCIA malo(4) devices don't support WPA.
Implement missing bits of node inactivity accounting in hostap mode, and hold ieee80211_node(9) interrupts blocked while comparing a cached node's refcount to zero and freeing the wireless node. Fixes a race condition.
Improved error messages when disklabel(8) can't be read prior to mounting root.
Only start the relayd(8) child processes after all of them reported to have loaded the config. Solves a race at startup where processes can send status messages about hosts that other processes don't know about yet (and have relayd abort with "desynchronized" or "invalid host id").
Drop the ability to have a list of keys in the tmux(1) prefix in favour of two separate options, prefix and prefix2.
Add strings to allow the aixterm bright colours to be used when configuring tmux(1) colours.
Only hide flags on the current window when the tmux(1) session is attached, and add a -R flag to send-keys to reset the terminal.
Fix rc.subr(8) pexp for sendmail(8); it can be "sendmail: rejecting" as well as accepting.
Add space movement keys for tmux(1) vi mode in the status line, and an option to disable the window rename escape sequence.
Teach bioctl(8) about the new status interface for bio(4). So far only applicable to messages specific to softraid(4) CRYPTO.
Remove global carp demote option from relayd.conf(5).
Bump the glob(3) stat limit to 2048, and count failed stats against the limit.
Workaround for CVE-2012-0064, where password-locked X(7) screen savers can be bypassed with Ctrl Alt *.
disklabel(8) no longer allows the built in editor to create ffs partitions with invalid fsize and bsize values, but will now allow enlarging partitions.
Force class alignment to a multiple of sizeof(XID): fixes a SIGBUS crash in XListInputDevices(3) on sparc64.
Teach pppoe(4) about RFC 4638. This allows negotiating increased MTU with compatible equipment provided that the physical interface and other layer 2 devices involved support/configured to use jumbo frames.
Ensure that ssh(1) $DISPLAY contains only valid characters before using it to extract xauth data, so that it can't be used to play local shell metacharacter games.
Initial inport of login_yubikey(8) for login over web interface, to be further worked on in-tree.
Free cached wireless hostap nodes which never associated (e.g. nodes only scanning for networks). Fixes unnecessary disconnection of associated stations.
Add support for C99 %ls, %lc, and %l[ format directives to scanf(3). Based on code from FreeBSD.
Add new filters callbacks for network events (CONNECT/CLOSE) and commands (QUIT/RSET) to smtpd(8).
Replace npppdctl(8) with new npppctl(8) written from scratch. Includes: changed npppd control; support IPv6 as tunnel source address; deleted support changing the configuration of npppd_ctl on running (to avoid the need to run with privileges). Note: npppdctl(8) related files should be removed.
Fix a ppp(4) problem that causes LCP keepalive timeout. In case the ack number of a packet that is passed to the userland has not incremented, pipex passed the packet mistakenly with invalid ack number, causing npppd to drop these packets.
Remove assembly version of strlen(3) from i386 and amd64 (often up to 3 times slower than the C code). Idea from DragonflyBSD.
Check the softraid(4) metadata level against the assembly level before proceeding with any assembly. This avoids a panic when attempting to assemble a RAID 1 (or other) volume as a RAID 0 volume.
Allow pkill(1) to use the -l "long" option to display which processes have been signalled, like pgrep(1).
Change the fmt(1) exit value on errors to be more 4.4BSD like. Use the sum of errors only up to a maximum of 127 (though programme execution continues).
Reimplement rthread mutexes, condvars, and rwlocks to eliminate bugs, particularly the "consume the signal you just sent" hang, and putting the wait queues in userspace.
During ip6(4) source address selection, give address scope higher priority than the autoconfprivacy bit, as per RFC3484. Prevents privacy addresses from being erroneously used as source address if the destination address is in a different scope. Privacy addresses are still preferred over other source addresses from the same scope.
Avoid ffs fragsize < sector-size when adding a partition via disklabel(8) editor. Use logic from calculating fragsize for an auto-allocated partition.
Fix a memory leak in ssh(1) pkcs11_rsa_private_encrypt(). Also, buffer_clear() between send_msg() and recv_msg().
Use nsdc(8) in the rc.d(8) script to reliably stop nsd(8).
As per POSIX, make strptime(3) compute tm_yday, tm_wday, tm_mon and tm_mday even if not explicitly set.
Fix a pf(4) bug where pf_walk_option6() used the outer header in the pd2 case.
Ensure that all disk attach callbacks have completed before attempting to locate the root via DUID.
Do carp(4) demotion adjustments on syncdev link state change. Now pfsync(4) will request a bulk update to get new states from the master.
Backout the activation of the new apropos(1)/whatis(1)/makewhatis(8) for fixing. The mandocdb utility is not released with OpenBSD 5.1.
Update the mfi(4) supported adapters list.
Document the \-C output format generated by VIS_ALL in vis(3).
Fix description for tcp.opening timeout in pf.conf(5).
In pflog(4) normalization and reassembly of bad packets to be logged is fixed.
Manuals: the HISTORY section of the following functions has been updated, because they predate 2BSD: fopen(3), getc(3) and access(2).
Manuals: the HISTORY section of the following tools has been corrected, as is now clear that all of 'em were already present in 2BSD: csh(1), ctags(1), finger(1), from(1), lock(1), printenv(1), script(1), tput(1), w(1), whoami(1).
tmux(1) now correctly calculates the last position even if multicolumn UTF-8 characters are involved.
Build warnings for smtpd(8) are fixed as some type-masked uses of time_t are modified to use the typedef directly.
makewhatis(8) improves as it automatically creates a missing .Nm search key for the file name, and doesn't skip manuals for section mismatches which can occur for e.g. files which are linked into more than one section, such as encrypt(1) = makekey(8).
Updates in pciide(4) so as to handle new SiS chips (which share the same PCI product id for different revisions with different bugs in the host bridge and thus need special treatment to be covered right.)
A perlpod(1) documentation of the OpenBSD::md5(3p) perl(1) module is now available.
In dhclient(8) the BPF interface code sets the routing table to the actually used rdomain.
newsyslog(8) will forward adjust the month if in a "M"onth when the specified day has already passed (so that mktime(3) will produce the correct next trigger time).
The manual of fmt(1) is extended by an EXIT STATUS section, with it's HISTORY being corrected, too.
The file copyright and the HISTORY of the sysexits(3) manual is now correct.
The unlikelihood of message id clashes has been removed from smtpd(8) as it is ensured that newly generated message ids don't clash ids which yet exist in the queue for incoming mails, and ditto for messages moved to corrupt/. In addition precondition checks are introduced at init time to ensure that generated path names will always result in creatable paths, so to avoid the possibility of this kind of error during the further lifetime of the daemon.
The HUAWEI K4510 mobile modem is henceforth supported by umsm(4).
boot(8/amd64) is version bumped to 3.18 to indicate support for recent softraid changes.
The internal changes on smtpd(8) proceed as per-envelope delivery states are converted to message states themselves (OK, TEMPFAIL, PERMFAIL). More code simplifications around here.
unistd.h defines _SELECT_DEFINED_ instead of _SELECT_DECLARED to propagate the declaration of the select(2) systemcall.
The IPv6 network stack implementation of RFC 5722 is adjusted: According to RFC 5722 we drop all IPv6 fragments that belong to a packet with overlaps.
Several uses of m_copyback(9) with M_NOWAIT set will no longer ignore the possible ENOBUFS failure.
In the kernel VLAN-tagging is repaired for ix(4).
smtpd(8) gets an atomic envelope dumper so as to avoid inconsistent states if the program stops in the middle of an envelope dump. The mbox backend is now used for mbox delivery, which eliminates the need of creating a shell process to handle that. As the project moves on there were changes to scheduling and RAM queue cache handling, more code reorganization in respect to the new envelope API and general cleanup of outdated functionality.
The mfi(4) driver now supports skinny chip variants; tested with LSI Logic MegaRAID SAS 9240-4i.
OpenBSD is cranked to version 5.1-beta!
smtpd(8): improve DNS error reporting during hostname lookups, resulting in most of the latter being correctly reported as temporary failures; hostnames may now also be specified as IP addresses in the configuration file. Handling of purging changed completely - the daemon periodically clears the purge/ directory via a privilege-separated child; at startup the fsqueue backend moves incoming/ into purge/ to discard aborted sessions. Furthermore code reorganization continues as a new envelope(_ascii) API abstraction is introduced.
installboot(8/sparc64) is teached about softraid volumes. This makes root on softraid(4) possible, although the kernel still needs to be loaded from a non-softraid partition.
In the kernel, if the DUID of the boot disk has not been provided, attempt to locate it via the boot device. This will allow root on softraid to work on most architectures.
boot(8/amd64) is teached how to access softraid(4) volumes, which allows a kernel to be loaded from a softraid RAID 1 volume. Furthermore it is sufficient to only boot from a disk that is a member of a bootable softraid volume, as this case will be detected and the boot will automatically be redirected to sr[0-9]a:/bsd.
Some boot related structures from softraid(4) are made accessible from userland.
The unused SLIST_FOREACH_PREVPTR(3) is dropped from OpenBSDs queue(3).
In Xenocara, ugly bitmapped fonts are replaced by Luxi or DejaVu TrueType fonts.
In the kernel more cleanup is performed in dev/wsfont.
The kernels network stack flushs the cached IPv6 forward route every 500 ms. This prevents wrong checks for local addresses and wrong packet forwarding in environments with only one communication partner and changing addresses or routes. Conformation to RFC 5722 is implemented.
On the cutting edge of development the mandoc(1) project replaces the traditional makewhatis(8) with its own incarnation of that functionality, mandocdb.
If a sub-device is created via aucat(1)s -s option it is first checked wether a hardware device to be used has been created (-f) before attaching the sub-device to the fallback default.
mandocdb stops -W from complaining about MLINKs, and henceforth only warns if a files seems to be inaccessible by its main title.
More devices are supported by puc(4): MosChip MCS9865.
On the hp300 platform /etc/ttys entries are added for apci(4/hp300) and dca(4/hp300) serial lines.
The ld.so(1) linker will no longer (try to) mmap(2) 0 byte areas.
The configuration script for perl(1) gets a more efficient method of building the symlink tree, which also works around an apparent namei or buffer cache bug on arm.
The major version bump of libkvm (kvm(3) - 12.0 on the 6th) makes it into the distribution lists.
During these days the kernel is inspected in respect to handcrafted list traversals plus, and multiple such occurrences are replaced with macros from queue(3).
Document new ${DISTDIR}/history semantics in mirroring-ports(7).
PIE executables on mips64 can now be debugged with gdb(1).
Make sure we only read cpuid 0x80000001 features on amd64 if pnfeatset reports it (as is already done on i386).
Fix ssh(1) memory leak in ssh_ecdsa_verify().
Switch wscons(4) to the xf86-input-ws input driver for mouse by default.
Make xman(1) work again.
Preliminary multi-processor support for luna88k (work-in-progress, not stable yet).
Make allocated memory zeroed on luna88k arch, to fix panic at attaching fb when using the serial console.
Added Intel Xeon E3-1200 to sys/dev/pci/pcidevs.
Bugfix double-free in ssh(1) "new session" handler.
Improve mandocdb handling of relative paths, letting invocations like mandocdb -d mytree mytree/*/foo*.* reindex certain files in a local tree.
Provide a bioctl(8) -O option that changes the state of a chunk to offline.
Add rtable id and thread id to struct kinfo_proc (and fix process id) and add an rtableid keyword to ps(1).
Added regression tests for IPv6 fragment reassembly.
Make mandoc show all build warnings when WARNINGS=yes.
On macppc, attach ath(4) to cardbus and add it to bsd.rd.
Fixed usr.sbin/npppd/HOWTO_PIPEX_NPPPD.txt documentation to specify mkdir needs -m flag.
Let makewhatis(8) build the whatis.db quietly.
Update xf86-input-keyboard to 1.6.1.
Enable the new apropos(1), whatis(1), and makewhatis(8), and call the new tools from pkg_create(1) and pkg_add(1).
Import upstream source of openssl(1) 1.0.0f.
Build the mandocdb database in temporary files in the same directory and rename(2) them into place when they are ready so apropos(1) can keep functioning, and files will remain if build fails.
Improved examples in apropos(1).
Update usage and history of whatis(1); mention the manwhere(1) predecessor in 1BSD.
Bugfixes for man(1): get a pointer to the next element before freeing the previous one; do not access free'd pointers.
New Vertex wireless device VW110L added to sys/dev/usb/usbdevs.
Suspend/resume support for vr(4).
Teach as(1) about the cmpxchg16b instruction on amd64.
Clarify that find(1) -execdir only supports the first form of -exec with ; suffix, not the new form with {} + suffix.
Update to nginx-1.0.11.
Fixed ssh(1) memleak on error path.
Added SiS 1183 SATA and 1182 SATA to sys/dev/pci/pcidevs.
mdoc(7) bugfix so heads of .It macros in -diag lists are not parsed (even though .It macros in general are parsed). Testsuite updated for this.
Support .St -isoC-2011 to refer to ISO C11 in mdoc(7).
Add support for find ... -exec foo {} \+ in find(1), and make markup more consistant so two -exec items are listed without vertical whitespace seperating them.
Enable arcofi(4) on hppa (tested on 705).
Do not advertize arcofi(4) as full-duplex. Although the Siemens chip itself is, the FIFO engine is not.
Use the correct multiplier for older SUNIX 406x 8-serial cards to bugfix on puc(4).
Add SiS 1184 RAID and 1185 AHCI, as found on the SiS 966 chipset to sys/dev/pci/pcidevs.
Document that disklabel(8) -s and the associated bootxx variable are deprecated.
On sparc64 installboot(8/sparc64) is reworked to be more like installboot(8)s of other architectures. Because it now uses opendev(3) internally it is possible to use "short forms" of device names on the command line (e.g. sd0a instead of /dev/rsd0c).
The Xenocara wsdisplay(4) framebuffer driver wsfb(4) is updated to version 0.4.0.
The binary file descriptor library of binutils 2.17 learns to properly recognize threads in OpenBSD core dumps.
The binary file descriptor library of binutils 2.15 learns to properly recognize threads in OpenBSD core dumps.
softraid(4) is extended with a concatenating discipline (also see bioctl(8)).
user(8) no longer does the portability dance and removes #ifdefs which conditionalize BSD extensions.
On sgi the rsu(4) driver is added to the GENERIC kernel configuration. (Since it requires firmware it cannot be added to RAMDISK.)
On hp300 color support is added for tvrx(4/hp300); one may also want to read intro(4/hp300) and dio(4/hp300).
At the deepest level of hppa the encoding of DIAG instructions is fixed, so that cache SID hashing will now correctly be disabled on PCXS, PCXT and PCXT processors.
In user(8) a format string is fixed to reflect the actual size of the argument.
cwm(1) no longer moves the same client multiple times to the same group, thus no longer incrementing a counter for hidden clients if the group is hidden.
ps(1) suppresses the header line if there would be nothing to display.
A temporary fix is applied to the network stack to escape hardware-checksumming if an interface is in a bridge; this fixes a problem where checksumming would not be computed if you have a bridge with at least one interface with hardware checksumming and another without.
tcpdump(8) also prints PPP-Max-Payload headers (for RFC 4638 PPPoe).
A FreeBSD telnetd(8) overflow advisory also affects our telnet(1) client: in encryption mode, ensure the given key length doesn't excess the maximum allowed key length to prevent an out-of-bounds memory access.
The ntpd(8) configuration file parser fixes a rdomain issue.
softraid(4) cleans up its metadata initialization process.
The rc.d(8) script of sndiod(1) no longer supports the reload action, as this was a no-op.
In the kernel it is ensured that no all-zero DUIDs are generated (they are considered to be non-existent). In addition a new DK_LABELVALID flag is introduced to mark validated disklabels, and thus to avoid using invalid disklabels in the future.
colrm(1), expand(1), fold(1), head(1), last(1), mkstr(1), tset(1) and vi(1) were all already part of 1BSD, as is now properly documented in their corresponding manual pages.
mandocdb will now accept multiple lines in NAME, and will not trim the description to 70 characters in the database (it'll do so during output). It also improves compatibility with 3p by interpreting \-\- as a Nm-Nd separator.
librthread actively removes SIGTHR from user sigset_t, because it uses this signal internally for thread cancellation purposes. This required implementations of wrappers for some more signal functions.
The pthread_kill(3) of librthread will correctly return the errno on failure, instead of -1.
smtpd(8) no longer uses a separate queue for bounce messages; the bounce/ path is no longer used.
tmux(1) is extended to support a larger history, minimizes redundant log messages and does some code reordering for more local and less global variables. Support is added for the ESC[s and ESC[u save/restore cursor-position key sequences. And finally $HOME (or ~) may now be used as default-path in tmux.conf.
The user(8) program will no longer append a redundant entry for the user to its primary group, thus mirroring adduser(8) behaviour.
More CPU features as reported by CPUID become known on the amd64 platform.
softraid(4) implements generic set-chunk-state and set-volume-state functions which cover the no redundancy/no rebuild case, and uses these for the AOE, CRYPTO and RAID 0 disciplines.
mandocdb becomes more clever in indexing cross-architecture manuals.
Now that mandoc(1) took over makewhatis(8), extend the whatis(1) manpage to cover extended features.
Allow suppression of the rounding of disklabel(8) partition locations to bsize boundaries. Also mention that such rounding is being done, so as to not surprise the user. Fixes problems reproducing a "pre-4K fix" disklabel.
fdisk(8) will now return relevant errno string when erroring out.
Accept "makewhatis" as an alias for "mandocdb".
Implement binary compatibility of the mandocdb databases across architectures. For example, it is now possible to create databases on sparc64 and use them on i386 and vice versa.
Implement mandocdb test mode (mandocdb -t), required for pkg_create(1). Always do all consistency checks; when any one fails, decide whether to print a message, or skip the file, or both, or none. Other cleanups: bail out on conflicting options; do not crash with -a if there are plain files in the root dir.
Force arcofi(4) TX gain to minus infinity when the user asks to only keep the input source enabled. Document the supported encodings and mixer items in the manual page, and the fact that all output sources share the same volume (GX gain) setting.
Support leading, trailing and double colons in apropos(1) MANPATH to prepend, append or insert the man.conf(5) default path; compatible with GNU manpath(1).
Default arcofi(4) to a much smaller input gain on the MIC line (improves recording quality), and switch to a better gain table.
Fix tmux(1) so that when mouse-select-pane and mouse-select-window are both enabled, clicking on the status line does not change the current pane.
Document that userdel(8) -p requires an argument.
Switch the Ricoh RU823 SD/MMC in SD2.0 mode (where it changes itself into a Ricoh RU822 sdhc(4) controller). Also switch the base clock to 50MHz as some SD/MMC cards don't work with the default 200MHz clock.
Work-in-progress driver for the arcofi(4) "Audio1" device on the HP 9000/425e (hp300), and the HP9000/705 and 9000/710 (hppa). 8-bit mono (8KHz) and 16 bit modes. Tested on 425e only so far, and playback only. Configured in, but disabled, on hppa kernels until there are positive test reports.
Add provisional support for Sandybridge. 2D, suspend/resume, and native display resolutions working, no 3D acceleration or video yet.
Disable temporarily CA support in smtpd(8), it prevents some remote hosts from establishing a ssl session. Will be investigated and reenabled soon.
Compute mandatory UDP checksum for ipsec(4) IPv6 packets.
No longer attempt to run pf_translate on pf(4) fragments. Also don't do af translation if pf_translate didn't succeed.
rc.conf(8) adapted to recent rc scripts change.
For rc.d(8), move mandatory flags for ftpd(8), identd(8) and popa3d(8) from daemon_flags to daemon.
Update to libXi 1.4.5.
Respect mount(2) MNT_FORCE flag in ntfs_unmount and proceed even if a system vnode is being held. Prevents crashes with forced unmounts. Silence ntfs_reclaim so that kernel won't spit out vprint's angrily.
Make mandocdb/apropos(1) work on strict alignment architectures. Note: binary database format still machine-dependent.
Improve icmp(4) direction check in pf(4) to deal correctly with af-to states. No longer exclude icmp(4) echo replies from the test.
Fix to pfctl(8) to unbreak rule optimizer.
smtpd(8) now returns an informative error string if the envelope is invalid; takes envelope id as a parameter and make sure it matches; no longer expects the errorline to start with an SMTP response code; and makes sure that all string fields are actual strings (to prevent overflows).
Added recognition of TI XIO2221 FireWire to pcidevs.
Added ID for Broadcom BCM57765 to mii(4).
Fix checksum of UDP/TCP packets following RFC 3948. Required for ipsec(4) NAT-T transport mode.
Make sure apropos(1) "any" really covers all search keys.
Make mandocdb format simpler/smaller by storing the file type as a single character, and storing paths relative to the directory containing the database.
Xenocara updates the xserver to 1.11.3.
Components of smtpd(8) generalize error message building in even more places by leaving that task up to the utility function envelope_set_errormsg().
A verbosity message is fixed in tcpbench(1) which sofar logged the amount of requested, instead of the number of actually connected clients.
In Xenocara libXi is updated to 1.4.4.
top(1) learns the new -H option to show process threads; it replaces the -T option which was used for that purpose before: using -H is consistent with OpenBSDs ps(1) and with top(1) of other operating systems.
A series of fixes to gain a working clang(1) are applied to includes files. Then again, a series of fixes due to a running clang(1) are applied to include files.
g++(1) (see gcc(1)) 2.95.3 removes the permanent_obstack memory usage optimization from duplicate_decls(), because this code is just bogus and may cause SIGSEGV in the wild. A larger diff to remove permanent_obstack completely (as has been done by the gcc folks in the 3.x series) is being worked on.
In smtpd(8), a buffer size check is sanitized and proper SMTP dot-escaping ensured.
The pcre library included with nginx(8) updated to 8.21.
ftpd(8) learns a new -W option which can be used to suppress keeping track of wtmp(5) login records.
In smtpd(8) the queue_fsqueue and auth backends are brought into line with the new backend API.
The compat_linux layer adds support for (a subset of) prctl(2).
The ktrace(9) rthread handling is improved. The flags and the vnode are moved into struct process; KTRFAC_ACTIVE becomes P_INKTR. In sys_ktrace() the user credentials are now used for all writes to the vnode, if one is used.
A delivery backend API is introduced in smtpd(8). Each delivery method now resides in its own backend, which slims down smtpd.c. The user and map backends are updated and tidied in equal spirit. And finally the SSL code makes use of a certificate authority file if specified and available.
On the luna88k port an auto-boot failure is fixed by using the real name for a string comparison (instead of the already checked device prefix).
The rc.d(8) script for nsd(8) no longer supports the reload action. Reloading DNS configuration should be performed through nsdc(8) and not with a rc script.
Fixup of pfctl(8) af-to regression that occured with match rules.
smtpd(8) will now display process name rather than function name in debug messages.
Allow isakmpd(8) to use a FQDN as a ID payload type. Some client (eg Windows XP) uses the FQDN type in NAT-T with transport mode.
Implement -C (alternative config file) for apropos(1) and mandocdb.
Utility function added to smtpd(8) for parsing and validating SMTP response lines.
Suspend other rthreads before dumping core or running exec(3); make them exit when exec succeeds.
smtpd(8) will now fetch the ssl cert earlier on if needed and skip mta_pickup() when handling the incoming forward.
ps(1) now understands -o cwd using the new KERN_PROC_CWD sysctl.
apropos(1) bugfixes: (1) Always show architecture-independent manuals, even when an architecture is specified on the command line. (2) Do not leak memory when a manual is skipped because it's the wrong section or architecture.
mandocdb now avoids leaking index records by only allocating a record for a file when needed.
Improved re-initialization of dhclient(8) parsing state so nothing accidentally carries over when a new file (i.e. leases after config) is parsed. May help with mysterious "Corrupt lease file" messages.
Fix mandocdb selection of arch-specific manuals: (1) Correctly compare cat vs. man paths. (2) Compare arch (and section) names case-insensitively.
Minor changes to leases file handling in dhclient(8) and dhcpd(8).
Set grep and tar programs in etc/config.site to force configure to find the system ones.
make(1) now uses clock_gettime() to get a high precision timestamp, instead of converting gettimeofday()'s output.
Remove -M from aucat(1), and -l from aucat and sndiod.
Change the way the working directory for new processes is discovered by tmux(1). If default-path isn't empty, it is used.
Add a new sndiod audio/midi daemon (name changed from aucat, and enabled by default) and hide aucat(1) server-specific options.
Always schedule another rx ring refill callout in case we fail to do it at the spot. Prevents rx ring lockups under high load on ix(4).
Improve mandocdb parsing of preformatted manuals: If the first section is empty, reuse the file name as the description; strip backspace encoding from the description; make the loops more readable using string(3) functions; put fclose() at the end, as line isn't valid afterwards.
In default mode, use realpath(3) on the "dir" arguments and put canonicalized absolute pathnames into the mandocdb database.
Sync to terminfo.src from ncurses(3)-20111203, this adds specific entries for OpenBSD i386.
Cleanup of the kernel routing code documentation code in route(4) and route(9).
Add timeout to fill rx-ring in case of mbuf shortage while in vr(4) vr_intr(); fixes hanging interfaces similar to in myx(4).
smtpd(8) now checks properly for NULL ->ifa_addr.
Now that arch-defines have been reworked, document the simpler arch-constants in bsd.port.arch.mk(5) and port-modules(5).
Instead of just counting the free index slots, mandocdb will now reclaim them.
Add Nuvoton NCT6776F to lm(4).
Make sure esa(4) only returns 1 from the interrupt handler if the interrupt was for us. Fixes problems when the interrupt is shared.
Avoid kernel crash by removing double clfree() on endpoint closing for ugen(4) devices.
Implement search support for 24 additional macros, extract more information from Fn, and lift section restrictions from An Cd Er Ev Fn Fo In Pa St Va Vt in mandocdb.
"Removing scratch and junk files" section of daily(8) now sends files to /dev/null.
Add support for Nuvoton NCT6776F fan, voltage and temperature sensors.
New fnmatch(3) implementation which is not recursive. Originally released in Apache APR-1.4.5.
Split the ruby module description off port-modules(5) to ruby-module(5).
mg(1) will now use absolute filenames while pushing and popping off the stack.
mg(1)s new tag handling fixes a segmentation fault by always using absolute pathnames instead of accessing relative to cwd.
Implemented cancellation points in librthread for the basic systemcalls.
On i386 a safety panic has been eliminated by not checking for HyperTransport buses if in PCI mode 2.
In copy mode tmux(1) supports "jump to" like vi via t and T keys. Likewise x and X will delete in edit mode.
ukbd(4) adds support for Apple fn keys.
usermod(8)s new -S option can be used to set secondary groups for users, whereas -G has been redefined to append to that list instead.
mandoc(1) removes an OpenBSD-specific tweak regarding .Xr spacing and gains compatibility with bsd.lv mandoc and groff-1.21.
The kernels virtual memory range management fixes a weird vm_page access in uvm_pmr_freepages(). This should also result in proper wakeup of uvm_pmalloc sleepers.
The pms(4) driver corrects its understanding of some ALPS mice in respect to the third (z-) axis.
port-modules(5) is revised and extended.
mandocdb changes the database format again to be endian-neutral.
In Xenocara, xdm(1) restores support for ecdsa ssh keys, which has been lost during the update to version 1.1.11.
pfctl(8) fixes issues with garbage content of fields which are not always initialized by zeroing out the entire data carrier.
The compat_linux layer gains support for MSG_NOSIGNAL.
usb(4)s wi(4) code ensures splx() is called before exiting wi_usb_tx_lock_try().
trm(4) ensures to splx() before return from trm_StartWaitingSRB().
pkg_delete(1) adds the -X option, which negates given packages (removes them instead of adding them).
aucat(1) unbreaks -aoff with MALLOC_OPTIONS=J by initializing the device reference counter.
aucat(1) no longer adds a .wav header to .syx files.
man(7) uses a default volume name when no explicit one is given, which results in nicer page headers for many manuals like, e.g., cvs(1), lynx(1) and many from the curses(3) set. To not break compatibility a corresponding patch for GNU troff has been written and was accepted upstream by Werner Lemberg as rev. 1.65 of http://cvs.savannah.gnu.org/viewvc/groff/tmac/an-old.tmac?root=groff.
pgt(4) ensures to splx() before return from pgt_media_status().
Some Apple products (iPods and iPhones) become known to the USB-subsystem and will at least attach as ugen(4) (so that e.g. gphoto2 should now be able to retrieve data).
pfsync(4) ensures pf_route() is only entered when undeferring a PF_ROUTETO case.
tmux(1) adds home and end keys for the command prompt.
In tmux(1) M-f and M-b work the same at the command prompt as in copy mode.
disklabel(8) fixes issues with the b and k size suffixes by casting the sector size to a signed 64-bit integer before applying the negate.
In order to support jumbo frames in pfsync(4) the new MAXMCLBYTES macro is introduced in mbuf(9) (and already used in m_pullup() and m_pulldown()).
mbuf(9)s m_pullup() function changes the order of some conditional tests in order to avoid execution of cases which would later turn out to be useless; it also fixes the calculation of available space for external storage.
ucom(4)s ucomopen() gets some error code-flow fixes to prevent release of critical structures, and removes a superfluous call to ttyopen().
Xenocara updates the intel(4) driver to a more recent version. (This is a prerequisite for Sandybridge support, but that is disabled for now.)
vic(4)s interrupt handler will no longer report the interrupt as being consumed to let devices which share the interrupt have their interrupt handler run.
After updating pfsync(4) to use a single 64-bit integer instead of an array of two 32-bit integers for state id housekeeping, systat(1) considers the creatorid as well as the state id and thus mirrors the id comparison code found in the kernel.
Fixes in the network stack for auto-negotiation on ICH8.
In Xenocara ws(4) gains support for wheel emulation (emulating button press/release events when the mouse is moved while a specific button is pressed).
In Xenocara the ATI Radeon driver should work better on PowerBook5,[7-9] after a faulty model string comparison has been fixed.
ld.so(1) internally adds support for some dynamic DT_FLAGS_1 flags: DF_1_NODELETE and DF_1_INITFIRST, as well as DF_1_NOW and DF_1_GLOBAL.
myx(4) fixes error code-flow in myx_buf_fill() in order to avoid either mbuf leaks or a NULL pointer dereference.
mg(1) changes behaviour of M-q (fill-paragraph) to allow double-space after /[.?!]\)?/.
mg(1) gains some ctags(1) support.
The mandoc(1) project implements whatis(1) as a special apropos(1) mode. This is intended to replace src/usr.bin/whatis at a later time, but can already be tested (ensure argv[0] starts with the string whatis).
mandocdb gets first rudimentary handling of formatted manuals ("cat pages").
The libedit library (editline(3)) fixes a segmentation fault when trying to lookup a command when there are no registered bindings.
In the hppa64 libkern several fixups are applied to assembler optimizations of memory operations, including the correction of memcpy()s return value. Only proper PA-RISC 2.0 mnemonics remain.
Two revisions that have been lost during update are backed out in ix(4): 1.31 (reyk@: fix the IP checksum offloading logic) and 1.46 (claudio@: low latency interrupt moderation for 82599).
pfsync(4) eliminates some race conditions by protecting more operations against interrupts in pfsync_clone_destroy().
ifconfig(8) looses it's vlanprio option as the SIOCSETVLANPRIO and SIOCGETVLANPRIO ioctls are removed. The priority scheme is now tied to vlan(4)s IEEE 802.1p priority tagging.
The ever evolving mandoc(1) system resyncs a whole bunch of work with and from bsd.lv; besides lots of internal code reorganization this adds proper handling of the MANPATH environment variable.
urtwn(4) adds support for the Netgear WNA1000M WLAN adapter.
The network stack now applies route-to to deferred packets; without this option the first packet of a connection doesn't observe the route-to option.
The compat_linux layer implements chown(2).
The packet filter machinery (pf(4), pflog(4), pfsync(4), pflow(4)) turns over to use the system uptime for state creation time values, since date(1) and ntpd(8) can skew the time value which was used before.
ports(7) documents the homepage-links target.
bsd.port.mk(5) gets another extension and covers the targets show-size and show-fake-size, as well as all-lib-depends, fetch-makefile and print-package-args, amongst others related to dependency solving, and adds some more odds and ends.
Kernel builds without the INET6 option were broken for a while due to missing #ifdef's, but that is fixed again.
More work on the package system results in changes to pkg_info(1) and pkg_delete(1).
The alpha port turns over to gcc(1) v4.
gcc(1) v4 gains some last modifications to enable the alpha port to switch to it.
The IPv6 network stack gains rdomain support.
In Xenocara the libGL for Radeon r200 is fixed by adding the missing link to libdrm_radeon.
smtpctl(8)/mailq(8), which share the same main(), fix a segmentation fault when being invoked as mailq(8).
pfctl(8) prints ports as numbers by default, the new -P option will print names (as from /etc/services) instead.
Hibernation gets more robust by properly accounting the MP trampoline page in the range count.
The network stack fixes a SMP deadlock by disabling interrupts in pool_reclaim_all().
LibC removes all references to the long-dead sigstack(2).
The bsd.port.mk(5) manual has been updated.
The miniroot install.sub script works around the fact that MAKEDEV does not report any failures, which avoids the always failing efforts to mount filesystems on non-existent devices.
The roff(7) manual corrects several factual errors in its HISTORY section. Kristaps Dzonsons reconstructed what really happened by talking to the people involved, including Brian W. Kernighan and James Clarke, to name a few. See http://manpages.bsd.lv/history.html for the complete picture.
smtpd(8) drops usage of it's enqueue/ queue in favour of incoming/.
New documentation is available: pkgpath(7).
The ktrace(2) systemcall fixes a bug which could expose the content of sizeof(register_t) bytes of kernel memory to userland.
As aucat(1) development proceeds code which manages mmc/mtc and volume control has been moved from struct aproc to struct dev.
pkg_info(1)s -r option reuses internal error codes (as from -e) if available, which allows constructs like pkg_info -e 'gettext->=0.20' -r 'gettext->=0.10.38' gettext-0.18.1p0.
The aviion, luna88k and mvme88k ports fix early boot crashes by making sure that %cr17 points to a dummy CPU information structure before the real processor is known.
On the macppc port it is again possible to boot the kernel from a HFS partition.
On the alpha port ld.so(1) is now compiled with the -mbuild-constants flag, to avoid loading larger integer constants from the relocated data segment. This fixes the ld.so(1) build with gcc4.
carp(4) selects routing tables according to the rdomain. Due to that it is possible to connect to the carp address when the carpdev interface also has an IP address in a non-default rdomain.
umsm(4) adds support for ZTE MF190.
Update to freetype 2.4.8. This update fixes CVE-2011-3439.
apropos(1) adds support for parenthesized subexpressions.
xidle(1) now correctly acts upon receiving SIGUSR1, SIGINT and SIGTERM.
The kernel adds run length encoding (RLE) for hibernate - don't compress or write pages that are free.
The libedit library (editline(3)) now correctly calculates the size for a wchar_t argv, which fixes a memory corruption.
The mandoc(1) test suite has been completely overhauled.
apropos(1) understands the standard options -M and -m after the addition of minimal _whatdb support for mandocdb and apropos(1).
RELIABILITY FIX: named(8) gets patches from BIND upstream to mitigate CVE-2011-4313.
A source code patch is available.
[Applied to stable]
The revision of HISTORY sections of the manpages of all syscalls that exist since Version 1 AT&T UNIX has been completed.
mandoc(1) will no longer reformat ISO 8601-style dates, but use them "as-is".
umsm(4) adds support for Huawei EM770W.
Xenocara updates xterm to 276 and freetype to 2.4.6.
The kernel makes the userret() function machine-independent.
apropos(1) starts supporting multiple search terms, and logical operations -a and -o to combine them.
sftp(1) fixes a minor memory leak which occurred when autocompleting a command did not give any results.
The pfsync(4) packet filter fixes some spontaneous CARP failovers which occurred when using the flag setting ioctl by only requesting bulk updates when going up, not when already running.
pkg_add(1) will use cache directories if they are offered by the ports tree, which boils down to a massive performance improvement.
smtpd(8) improves handling of offline messages. It is ensured that they are only unlinked after they have been correctly enqueued. Instead of aborting forked worker processes if an error occurs while handling an offline message, simply log and leave the failed message untouched.
tmux(1) gains capabilities to do word-movement and -editing.
In tmux(1) the word-separators option now belongs to a session, not to windows.
smtpd(8) extends it's beta filter handling and introduces filter status states, like STATUS_WAITING.
The smtpd(8) internal Qwalk API has been reworked and is now fully modularized.
In less(1) the LESSHISTFILE is from now on by default disabled.
The beagle port re-adds support for the omdog watchdog timer.
In Xenocara, update xdm(1) to 1.1.11 plus a few patches.
nginx(8) is updated to 1.0.10. This version fixes a bug in the resolver which caused segmentation faults in worker processes on receipt of large DNS packets.
aucat(1) adds a "device number" component in sndio(7) device names, allowing a single aucat instance to handle all audio and MIDI services. Note this changes the service names (a backward compatibility hook keeps old names working if only one aucat server is running).
Xenocara fixes regressions, which could be seen in media key handling under Gnome, by merging in the patch from http://patchwork.freedesktop.org/patch/7707.
mandocdb turns over to only archive those files and directories that man(1) will be able to retrieve; the new -a option can be used to gain the old behaviour.
smtpd(8) ensures that the offline directory has the right owner and permissions before it starts to enqueue offline mail.
A small RE fix is applied to pkg_add(1) which solves issues some ports had with pkg_subst / SUBST_CMD.
mandoc(1) page footers gain compatibility with groff(1).
installboot(8/i386) and installboot(8/amd64) use chunk numbers instead of possibly empty disk/partition names in some log messages.
softraid(4) updates the DUID for new chunks, and zeroes the boot DUID list before populating it in installboot to ensure no offline chunks are listed therein.
softraid(4) rebuild initialization code has been reworked and deducts the metadata of a new chunk from the volume metadata, and it's coerced size from an online chunk, instead of using a random chunk as a source for these.
mandoc(1) learns to configure the left margin from the command line with the new "indent" argument.
In the ongoing effort to create a complete mandoc based manual system apropos(1) looses the -e (use REs instead), -r (more on that later), -s (no more sorting for a while) and -I options, and switches over to the traditional -s (choose section) and -S (choose arch; replaces -a) options.
dhcpd(8) protects itself against faulty interpretation of memory in case truncated packets have been received (a potential problem deduced from CVE-2011-2748 and CVE-2011-2749).
Update nginx(8) to 1.0.9, and it's included pcre library to 8.20.
The currency exchange rates are always up to date.
fdisk(8) disallows partitions of length 0. It also rereads the MBR after it has been written out, so that the in-memory copy really reflects what is on the disk.
The hppa64 port turns over to use binutils 2.17.
Allow cross-compilation to arm on 64-bit architectures.
umsm(4) adds support for HUAWEI Mobile E173s.
The arm disassembler learns more v6 and v7 instructions.
Root filesystems on SD/MMC cards should work more reliable after progress has been made on the sdmmc(4) driver.
The beagle port adds support for the gumstix overo board.
The cdce(4) driver adds support for the UISUBCLASS_MOBILE_DIRECT_LINE_MODEL interface subclass, and thus at least for Dell 5530/5540 and Sony Ericsson F3705g.
The ws(4) driver ignores the Raw option for mice (always false).
librthread gets the necessary bits for a per-thread errno on powerpc.
The powerpc port schedules %r2 as the userland thread register.
The network stack fixes a faulty timeout calculation which caused states to linger more than necessary.
beagle GENERIC configures bsd as swap generic.
miniroot will no longer ask wether non-free firmware should be obtained, but automatically do so.
The print output order of the pfctl(8) skip steps will show rdomains after the direction.
The NCR 53c9x SCSI controller driver actively limits it's command-set to commands of at most 12 byte (the SCSI-2 standard), as some 53c9x adapters fail when attempting to send 16-byte SCSI-3 commands.
The arm platform looses support for the big endian byte order.
librthread gets the necessary bits for a per-thread errno on hppa.
The hppa port allows reading of the %cr26 and %cr27 control registers from userland on PCXS processors. %cr27 is scheduled to act as the userland thread register.
ipsecctl(8) adds an -i option which may be used to specify alternative paths to an isakmpd(8) communication FIFO.
The ws(4) driver gets more scroll-event mappings.
Entirely drop support for procfs on arm, since it is not needed there.
On sparc, drop default support for the process-filesystem (procfs was by default enabled for Solaris compatibility).
Teach bgplg(8) to use the new -A option of traceroute(8).
The new -A option for traceroute(8) displays the AS number for each hop address.
Xenocara removes code which requires an ABI_XINPUT_VERSION smaller than 12.
The ddb(4) examine command will print the correct address even if multiple modifiers have been specified.
Unless acting upon a character device vnode reads and writes will avoid wrapping the file offset past the max.
smtpd(8) enqueues offline messages at startup, which simplifies the code flow.
The regular expression compiler replaces some (compiled-out) assertions with persistent checks for failed reallocations; this closes a vulnerability against extremely large expressions which aim in using this flaw.
In Xenocara, update libpciaccess to 0.12.1.
smtpd(8) no longer includes the status when dumping the envelope.
Except for character devices negative offset arguments will result in EINVAL errors for the pread(2), pwrite(2), preadv(2) and pwritev(2) systemcalls.
On arm a fix was applied to correctly identify the cache modes WB1 and WT.
M4 gains some more GNU M4 compatibility.
The librthread library adds support for sched_get_priority_min(3) and sched_get_priority_max(3).
In Xenocara, update xf86-input-mouse to 1.7.1.
On arm kernels which lack StrongArm support an incorrect logic was fixed that could cause page table flushes to be missed.
mandoc(1) will log and actively ignore .TP commands if their HEAD is "broken" by another block command.
The pread(2), pwrite(2), preadv(2) and pwritev(2) systemcalls will also fail with ESPIPE if the file is a TTY.
The beagle port gets initial support for the Cortex A9 interrupt controller and introduces code to use the global timer as a clock source.
tmux(1) adds new options which change the status line colors and options differently in command mode.
The network stack selects the correct protocol when importing an icmp<->icmp6 state.
mandoc(1) improves visual output compatibility with groff -- if the .TH command sets no data then the page footer will no longer fill in the date field.
Fix the spacing of .Eo in mandoc(1).
In X the Shift+Backspace key sequence will produce a backspace again.
Updated OpenSSL to 1.0.0e.
On i386, cover AMD/extended flags CPUID information.
Enable UDMA capabilities for the PCI IDE controller of the HT-1000.
Remove the imstt driver from Xenocara after it has been unused for 5 years.
Remove more #ifdef's in libstc++ which exclude OpenBSD from the world of wide characters.
smtpctl(8) no longer needs libevent after a rework of the local enqueuer code.
Add perl security fix for CVE-2011-2939.
ifconfig(8) will display interface hardware features via the hwfeatures parameter.
Remove code related to the HP MMU -- all supported system favor PMAP_DIRECT.
Rework disklabel handling on vax MSCP to correctly support label spoofing. This adds true support for the DIOCGPDINFO ioctl.
In Xenocara, update sessreg(1) to 1.0.7, xdpyinfo(1) to 1.3.0 and xinit(1) to 1.3.1.
Upon destruction of an interface the network stack will correctly cancel bulk-update failure-timeouts.
Restrict netstat(1) output to the sockets of the specified or current routing domain.
Alter save/restore on PCI-Express bridges during the suspend/resume cycle to fix high interrupt load from ppb(4) on resume.
Allow setting big MTU values on the pfsync(4) interface (but not larger than the syncdev MTU).
Always install addr2line(1), objcopy(1), and readelf(1), even on architectures with !ELF_TOOLCHAIN && !USING_NEW_BINUTILS (like vax, m68k).
Use three times the advskew as the carp(4) master down timeout in the advbase 0 case.
Add a sample mixerctl.conf(5). More complex examples to come as aucat(1) work progresses.
Enable interrupts while processing off level interrupts in openpic(4/macppc).
Ignore devices with irq 0 on mpcpci bus as no devices in the openfirmware tree use it.
Fix uvideo(4) bogus frame selection check in uvideo_vs_negotiation().
Use existing _ppp instead of _npppd as a user/group id for npppd (see usr.sbin/npppd/HOWTO_PIPEX_NPPPD.txt).
New device added to ufdti(4).
Add screen*:XT to terminal-overrides for tmux-in-tmux(1).
Use PRI{x,d}64 in format strings instead of %llx, %lld or %qd to print smtpd(8) {u_,}int64_t or time_t.
On reset, restore correct ahci(4) command register value. Gets port multipliers working on some ATI devices.
Allow shmctl(2) segments to be used even after they were marked for deletion with the IPC_RMID flag. Permitted as an extension beyond the standards.
Don't offer/negotiate smtpd(8) SSLv2 or try to negotiate an RFC 4507-style session ticket, since some (broken and non-compliant) servers choke on TLS extension negotiation.
Fix smtpd(8) smtpctl pause/resume to correct ramqueue scheduling. Rename IMSG and pause/resume parameters.
Apply a fix to rum(4), via FreeBSD.
Intel EG20T serial added to sys/dev/pci/pucdata.c.
Use a new encoding for the entries in the sys/dev/pci/pucdata.c table. Halves the size of the .o file.
Sync luna88k disklabel(8) handling code with sparc, except for the SunOS vs UniOS differences for the legacy part (first eight partitions), which are preserved.
Document some limits of ifconfig(8) "group-name".
Rewrite the sender user/domain as specified in the smtpd(8) manpage when matching a "relay... as" rule.
Introduce a pluggable interrupt controller infrastructure for beagle, to allow pandaboard to share the port.
Document that aucat(1) -aoff is not the default for the default device.
Handle mandoc(1) infinite recursion the same way as groff: When string expansion exceeds the recursion limit, drop the whole input line, instead of leaving just the string unexpanded.
Handle mandoc(1) \N numbered character escapes the same way as groff: If \N is followed by a digit, ignore \N and the digit. If \N is followed by a non-digit, the next non-digit ends the character number; the two delimiters need not match.
Add POSIX references for fchdir(2), fchmod(2), fchmodat(2), fchown(2), lchown(2) and execve(2). State that fchmod(2) can return EPERM as required by POSIX 2008.
Update POSIX references for chdir(2) and chmod(2) from 1988 to 2008.
Declare all sparc control register bitfield structs with uint16_t instead of u_int. Stops bus errors.
Lower carp(4) demote count on interface detach, fixes a bug introduced by rev 1.175.
Fix unaligned pci config space access in intel agp(4).
ssh(1) bz#1859: send tty break to pty master instead of (probably already closed) slave side.
ssh(1) bz#1943: unbreak stdio forwarding when ControlPersist is in user.
When copying, tmux(1) will now repeat the count indicate buffer to replace it if used.
smtpd(8) MTA leak plugged, and smtpctl schedule diabled (use 'smtpctl schedule-id <id>' - introduce 'smtpctl schedule-all').
Introduce operation to move a message from schedule queue to corrupt queue upon smtpd(8) envelope loading failure.
Import of Mesa 7.10.3.
Support for \e[3J to clear tmux(1) history. Alias NPage/PPage as PageDown/PgDn/PageUp/PgUp.
smtpd(8) fsqueue now uses load/dump functions to convert to and from a human readable format.
tmux(1) will now attempt to resolve relative paths by first using client working directory (if any), then default-path or session working directory.
tmux(1) fixes: plugged memory leak; added client formats; LC_ALL and LC_CTYPE now ignored if they are empty and unset; initial session now uses size of command client even if detached.
Implement missing enclosures (Ao Do Qo Qq So Bro Brq) and enclosure-like in-line macros (Ad Cd Dv Er Ev Li Ms Tn) to mandoc(1). .No macro now works without explicit implementation.
Sync the uath(4) WEP text with other WPA texts.
Comment out ISP_{T,}DEBUG[0-3] traces if option SMALL_KERNEL; allows alpha floppyB to fit again.
Reduce the number of audio* nodes from 3 to 1 on vax, as none of the audio-capable vax can receive another audio device as expansion (until TURBOchannel with DMA on VS4k/90 is added).
Added another Sunix id to puc(4) for their 50xx series cards.
Correctly set smtpd(8) relay when expanding envelopes.
Added smtpd(8) -T command line option, to toggle logging of specific debugging info in verbose mode, to use for imsg traces.
Beagleboard/pandaboard now fetch u-boot parameters out of the register input. Devices now detect device_id from u-boot and decide to enable/disable themselves in the device match routine.
Document that: PSEUDO_FLAVORS and FLAVORS should be defined prior to using bsd.port.mk(5) and that CHOWN/CHMOD are dead.
Correct pflog(4) packet interpretation for nat64.
Strengthen some pflog(4) checks to prevent operations on mbuf chains of insufficient length; prevents some crashes.
Make uname(1) -p return the cpu architecture name on all hardware platforms.
Copy the DUID back and forth between the in-core label and the Motorola VID block for mvme68k machines.
No longer bzero in-core disklabel but rather the UniOS disklabel; fixes vnd(4) operation on luna88k.
Fixup added to pf(4) for icmp6 id's when translating.
Add support for Stollmann Active USB ISDN Terminal Adapter.
Add Alcatel One Touch X210/X220 (another rebadged TCT Mobile modem) to umsm(4).
Add more paths to cursorpath, themes can now be installed under /usr/local/share/icons and /usr/local/share/pixmaps.
Implement mandoc(1) missing text production macros (Bsx Bx Dx Fx Nx Ox Ux Bt Ud). Some macros work without explicit implementation (At Db Os St).
For NAT-T with transport mode, use ISAKMP's SA addresses for the flow instead of ID payload. Fixes some L2TP/ipsec(4) from NAT'd clients issues.
Document em(4) support for 82583V.
em(4) reworked to prevent garbage output when changing snoop related registers on pch2.
aucat(1) now keeps the device closed by default (when not used).
Delay daemon fork() in wsmoused(8) until after initialisation has completed. Fixes rc race that caused X11 to fail to open /dev/wsmouse.
systrace(1) intercept_get_string() internal buffer now allows strings up to ARG_MAX long, so that ic_trargv can execute reliably.
Fix CVE-2011-4028 in xserver/os/utils.c: file disclosure vulnerability. Symbolic links no longer followed when opening an existing lock file, thus avoid revealing if it points to an existing file.
Support K and M as well as k and m for sizes in dd(1).
Add an else clause for tmux(1) if-shell.
Huawei Mobile E173 now supported by umsm(4).
ssh(1) will now skip attempting to create ~/.ssh when option -F is passed.
New "ssh-add(1) -k" option to load plain keys (skipping certificates).
Remove explict search for \0 in ssh(1) packet strings, this is now done implicitly.
Remove midicat, as aucat(1) -M can now be used instead. Thru boxes MIDI port names have "aucat" prefix instead of "midithru". Old device names will still work some time for backward compatibility.
Fix the synchronization of some alps touchpads and blacklist some devices that are not working with current driver.
Use __tfork, __get_tcb(2), and __set_tcb(2) to have a real TCB (thread control block) and per-thread errno.
Use m_pullup() to get the carp header in the v6 input path. Fixes occasional checksum mismatches.
Sync mandoc(1) to groff(1), and add tier I and II NetBSD architectures. Stops misformating manuals coming from other operating systems.
Add wscanf(3) and wcsftime(3) (libc major bumped). Based on scanf(3), with wide character support changes based on FreeBSD.
Provide battery charge/discharge rate in proper units.
Add optional checkpoints for moduli screening in ssh-keygen(1).
Note a kqueue(2) restriction that is enforced as of OpenBSD 5.0.
Document in fork1(9) new FORK_TFORK bit and that stack argument is used by compat_linux(8).
Update xkeyboard-config(7) to 2.4.1.
Add stubs and manpage for __get_tcb(2) and __set_tcb(2).
Reset TCB addresses when exiting in sys/kern/kern_exec.c, to provide a clean setup for the new image.
Reads aligned to the PCI config space in sys/dev/pci/agp_via.c and agpreg.h.
"TLS-lite": add kernel support for a per-thread userspace pointer, for pointing to the thread-control-block.
Respect the ToS setting in tcp syn+ack for IPv4 (still need to fix for IPv6).
Variables set/unset in etc/rc.d/rc.subr that were missed before.
Improve performance (throughput and loss rate) for PPTP, pppd(8) or L2TP(/IPsec) on unstable latency networks (eg mobile).
Introduce NAT64 to pf(4), a generic IP version translator using "af-to" in pfctl(8), systat(1), and tcpdump(8).
Fixed use after free in smtpd(8) SSL code.
Enforce alignment on i386/amd64 when doing reads and writes to PCI config space to space to uncover bugs.
Start ldapd(8) earlier in rc.d(8) so that ypldap(8) can properly run.
Added known good version of ldstub to kernel (for GCC asm constraints).
Increase stack offset for rthread from (BIAS+128) to (BIAD+CC64FSZ). This fixes _rthread_start compiled without optimization.
Convert rfork_thread() from int$80 to syscall; tune asm to avoid stack and use smaller instructions; pass threxit() a NULL pointer.
Localize _new_pexp unconditionally in etc/rc.d/rc.subr, so rc_read_runfile() cannot pick it up from a polluted environment.
Remove all MD diagnostics in cpu_switchto(), and move them to MI code if they apply.
Fixed strings allocated with xmalloc to be freed with xfree (not free) in xenocara/app/cwm/group.c.
Simplified and improved aucat(1) options and increased log verbosity.
Add a flag for nginx (-u) to disable chroot. Same config file can now be used whether chroot/non-chrooted setup.
Updated Perl digest module to 1.17 (security fix).
Document that virtual maps require a domain key in smtpd(8); parsing fixed in :include: aliases.
Put sd(4) SCSI drives in standby mode when we're powering down the machine.
Allow "bus_space_tag_t" in xbridge(4/sgi) to return based on the byteswap setting of the device we are trying to attach.
Introduce pci_probe_device_hook function, so pci host drivers can alter the pci_attach_args passed to a device when attaching.
Put in code for wcstfime to be linked in and activated alongside wscanf.
Open Group Corrigendum U033/8 applied so strftime(3) returns "52" instead of "53" for certain days.
Added tlphy everywhere tl is enabled (RAMDISK_CD and RAMDISKDISK, i386 and Alpha).
Regression test for pthreads wait*() hang issue when SIGCHLD is ignored (a la Python).
Added support for WCH CH352 serial via PCI.
Show messages sent between processes in debug mode for smtpd(8).
Sync to mandoc(1) version 1.12.0.
Rework secondary processor (cmmu) initialization and improve cache management for aavion, m88k, and mvme88k architectures.
Test etc/rc.d/rc.subr to make sure ${pexp} is not an empty string (which would send a SIGTERM to init(8)).
Allow pkg_add to proceed whether we choose to syslog before or after we parse the command line options.
Add a missing newline when you merge login.conf(5) if login.conf.db doesn't exist.
Fix the backspace key under X11 and make the "option" key behaves like in console. The "command" key is now the alt modifier.
Make it possible to restart/stop a daemon using rc.d(8) after having changed its _flags in rc.conf(8).
Fix libc/locale format so day of month uses %e (single digits preceded by a blank instead of a 0) and not %d (per POSIX).
Document the HISTORY of options and the fate of whereis(1).
Correct history and formatting of apropos(1), whatis(1) and whereis(1): (already part of 2BSD, author Bill Joy).
Man page for units(1) updated to explain units' output more clearly.
Return less(1) to the old behaviour for "more", so pressing F ^C will not leave you at a prompt at the end of the file.
Fixed Nginx ngx_http_core_module.c to specify root as /var/www/htdocs, not /var/www/html.
Removed paragraph in Xenocara README about building using shadow link tree (not supported anymore).
Update to terminfo.src from ncurses-5.9-20111001.
Make mmap(2) with len=0 fail signalling EINVAL, to conform with POSIX.
Bugfix merged from X.Org git: fixes Xenocara build for m68k architectures.
Rename some variables and functions in altq(9) code that were causing namespace violations.
Domainname is now set before rc.conf is run to accommidate recent ypbind(8) changes.
If pthreads(3) SA_RESTART is set, make threads waiting on PS_FDW_WAIT uninterruptible (connect(2) being the exception).
Make sdtemp(4) detect the ts3000b3 and stts2002 temperature sensors, stop some false-positive detections of cat34ts02.
Added support for uftdi(4): RT Systems interface cable (rebranded FTDI) for Yaesu ham radios.
Allow ypbind(8) to start like other daemons (using ypbind_flags) while preserving its historical startup behaviour.
apropos(1) replacement imported; it and mandocdb linked to the mandoc(1) binary; mandocdb manual installed.
ccd(4) deprecated and moved to the (source code) attic.
Fixed missing #else in indexed array in sys/arch/mvme88k/mvme88k/conf.c.
Added questions to quiz(6).
Allow bigger prefixes in units(1); add many other units, symbols, and prefixes (eg becquerel, curie, gray, eV, bohrradius).
Removed binaries which are no longer necesssary for building a release.
Better newline error messages for bc(1).
Make struct chunk_info a variable sized struct, wasting less space for bitmap metadata in malloc(3).
Allows correct registration of kqueue(2) notifications on /dev/tty to avoid potential local DoS.
Bugfix for ypserv rc.d(8) script.
Update version information in lib/libxcb/src/config.h for libxcb.
Fix the "nginx -s reopen" file reopening failure bug which occured because Nginx is in chroot.
Make aucat(1) restart connect(2) if it returns EINTR (socket connection broken before signal delivered).
Workaround dead sensor problem by deactivating the i2c alias when ISA interface is available.
Added /usr/local/sbin to the default path in login.conf(5).
Move inqbufs off the stack to dma_alloc/dma_free in sys/dev/ic/ami.c.
Finalise support for 82580 based devices (eg Intel I340-T4 and HP NC365T); simplify multi port handling.
Clarified comments in sio_open(3).
Clarify comment in /etc/master.passwd that user "nobody" is not just for NFS (used by locate(1) as well).
Reconfigure default sys/arch/amd64/conf/RAMDISK to support ehci(4), also to disable sk(4) and vge(4).
Fix bz#1683 to silence sftp(1) error spam for "ls */foo" in directory with files.
Change -w flag in nc(1) to apply to the connection as well.
Add support for ALPS touchpads and fix the "slow touchpad" problem.
Add a 'flag' locator to gpioiic(4); define a first flag value to swap the SDA and SCL pins assigment during attach.
Fix a segmentation fault in smtpd(8) triggering if clients sent a large number of DATA lines in one write.
Clarify smtpd.conf(5), that network sources are to be specified in CIDR notation.
Update to nginx-1.0.8 (many bugfixes).
Fix regression tests for mdoclint to look in man* subdirs (not cat*).
Change ps(1) man page to list the fields in the default display to reflect the order of display output.
Updated port-modules(5) to reflect changes to the Gnome module.
Update the SI prefixes section of units.lib, the standard units library; added SEE ALSO references to units(1).
Tidy warnings and better error handling for config(8) -e.
Fixed sign in lib/libc/stdio/mktemp.c.
Add formats for panes (tty, pid, start cmd/cwd) in tmux(1).
Fix an X server crash when starting GLX 1.3 apps.
Signal handling regression tests for pthread_join(3) and pthread_mutex_lock(3).
Remove the exchange rate entries now pegged to the euro ("Maltalira" and "Slovakkoruna").
tcpbench(1): -l flag lists the kernel variables available for monitoring.
Added cyprus pounds, maltese lira, slovakian koruna, and slovenian tolar to units(1).
Fix inverted test that caused logspam in sshd(8).
Set user PATH from login.conf instead of hard-coded default in xdm(1).
ISO 4217 updates for the currencies in the units(1) federal reserve section.
Alphabetically sort the list of currency aliases in units(1). Now sorted by base unit rather than alias name.
Change ni_dirfd's position in struct nameidata in sys/sys/namei.h. Eliminates some alignment padding.
sshd(8) no longer attempts privsep cleanup when not using privsep.
mdoc(7) now implements .Ap .Bd .Bo .Bq .D1 .Ic .Lp .Oo .Pf .Po .Ss .Sx .Sy .br .sp and .Bl -bullet; adds more info to the .TH line escape dots; adds newline character at EOF; and no longer misinterprets ROOT block as .Ap.
Remove assembly defines for various struct disklabel field offsets in sys/sys/disklabel.h (nothing depends on them anymore).
Make Vax get size of struct disklabel with a genassym script, instead of relying upon sys/disklabel.h.
Avoid a potential NULL dereference if nports == 0 in sys/dev/usb/uhub.c.
Add -S option to tmux(1), allows alternate path to the server socket.
Support symbols in .tbss and .tdata nm(1) ELF sections.
Update awk(1) to Aug 10, 2011 version.
Make sure "references" is not optimized away in lib/libpthread/uthread/uthread_init.c (required for the static version of pthread).
Disable FIFO on M series "com to ebus" on Sparc64 by telling the driver its a 16550 (stops the MI com code from probing it as a 16550a).
Stop groff complaining when mdoc(7) .Bl appears unescaped on a macro line.
Make bus_addr_t and bus_size_t u_long types; this makes the declaration of these types consistent accross all supported platforms.
Make struct label_t large enough for the kernel setjmp() purposes for Sparc and Sparc64.
Enable previous gcc(1) find_barrier() pessimization for non-PIC code also.
Do not write to the MCESR register on microVAX II and SOC processors, as this register is not implemented on those models.
On Vax, only handle a machine check as caused by badaddr() if the local "memtest" variable != 0, instead of abusing "cold".
Notify ifmedia layer of link loss on SGEC interfaces, so that "ifconfig ze0(4/vax)" reports the correct state instead of always pretending it is up.
Replace the mdoc(7) .Fl examples by others exhibiting the same features, but avoiding use of .Nm (as it is an unusual style).
Use, as far as possible, the same notation in newsyslog(8) for date strings as other manual pages.
Retain alphabetical order for the -Toutput list, and use a better looking width specifier in mandoc(1).
tmux(1) will now reject $SHELL if it is not a full path.
Pass on RC_DEBUG and RC_FORCE flags in the rc.d(8) on restart (rather than exporting them and expose the script to a potentially polluted environment).
sysctl(3) KERN_BUFCACHEPERCENT defaults to 20%, old value was 10%.
Ask for SUBDIRs with FULLPATH set in pkg_add(1).
Improved ssh(1) AuthorizedPrincipalsFile debug log message to include file and line number.
Restore correct display of the 'V' flag on the parent in vfork() in ps(1).
Add -H option to ps(1) to show rthreads, hiding them by default.
Repaired rc.d(8) "restart" debug and force modes ("restart" calls "stop" then "start"); appended "_" to those variable names to clarify they are internal.
Update to xf86-input-synaptics 1.5.0 and freetype 2.4.6.
perl(1) no longer attempts to use LC_COLLATE or LC_NUMERIC which we don't yet support.
Created a new "bounce" file for ports infrastructure. Use bsd.own.mk's guard against multiple includes.
ports(7) now tells people to use dpb(1) for bulk builds.
Gnome.port.mk port-modules(5) tweaks: MODGNOME_DESKTOP_FILE is not unconditonally set, expanded FAKE_FLAGS line.
Make sure siop_xfer is a multiple of 128 bytes in sys/dev/ic/siopvar.h as intended; makes hppa64 much happier.
Added a test for recursive pthread_mutex_trylock().
XHCI -> xHCI and some additional devices added to sys/dev/pci/pcidevs.
Let makefile.cross detect word-size mismatches between host and target, previous behaviour resulted in the cross compiler generating incorrect code and aborting.
Unbreak ssh(1) remote port forwarding with dynamic allocated listen ports by send the actual listen port in the open message (instead of 0) and updating the matching permit-open entry.
Add wildcard support to sshd(8) PermitOpen, allowing things like "PermitOpen localhost:*", from bz #1857.
Import of nginx 1.0.6 with a bundled libpcre. A possible replacement for Apache httpd(8) to be included in base.
Now, always install all manuals on all architectures. No exceptions even for binutils. No more share/man in src/distrib/sets/lists/*/md.*.
Improved kernel malloc type checking in sys/kern/kern_malloc.c.
Fix order of arguments passed to malloc(9) - type first then flags in sys/scsi/scsiconf.c.
Let tcpdump(8) use the same format for printing IPv6 fragments as for IPv4. Now both use id:len@off+more.
Added missing ia64 bits to gnu/usr.bin/cc/libgcc/Makefile.
Make use of the filename argument to open_error() in yacc(1).
Mask value no longer erased when setting/clearing system mask. Added diagnostic for interrupt handler IPL levels in sys/arch/hppa64/hppa64/intr.c.
Purged the rcsid in adduser(8).
Removed the rcsid in compress(1) and gzip(1). -V and -L options are now silent.
Stop using the latin1 character set in the "C" locale (non-standard behaviour which looks garbled in UTF-8). Non-locale-aware tools should only print ASCII. To use an extended character set you now must set LC_CTYPE.
Fix to ssh(1) bz#1935 and sftp(1) implicit sorts while globbing.
Added regression tests with many kinds of overlapping and invalid data for pf(4) fragment reassembly.
Move the prototype for disk_readlabel from sys/kern/subr_disk.c to sys/sys/disk.h so hibernate can access it.
Added note in gcc-local(1) man page that -ftree-vrp removed from -O2 as it is known to be broken in 4.2.1.
Check the protocol header length for tcp, udp, icmp, icmp6 in pf_setup_pdesc() in pf(4).
Use new relayd(8) idle timeout for socket splicing so userland can measure session timeouts properly; splice with http if relayd does not check headers.
Repair interrupted reads in less(1) and use volatile sig_atomic_t, not int, for the sigs variable.
Fix to stop named(8) logging messages when it shouldn't. Bug reported to ISC (RT #24053) and now included in current bind releases.
Disable st* in sys/arch/i386/conf/RAMDISK to shrink ramdisk size.
Use the synaptics driver with ALPS touchpads.
Add rdomain support to ntpd(8).
Allow bgpctl(8) to parse and/or filter MRT table dumps (all 3 formats) and display them like the show rib/show rib detail output.
Rename pmap_procwr() to pmap_proc_iflush() to get the intended behaviour in pmap(9).
Fix Beagleboard range check in intc_intr_establish() in sys/arch/beagle/dev/intc.c.
When breaking an overflowing line, mandoc(1) now ignores pending whitespace (vbl), so next line is not misaligned or too long.
Fix nexthop_modify() to reset the flags when called so later set nexthop <IP> is applied in bgpd(8).
Add /usr/local/share/terminfo to search path so ports can install custom terminfo files. Minor ncurses(3) bump to allow packages to depend on the right version.
Cleanup page calculation for final memory chunk ordering list for hibernate resume in sys/kern/subr_hibernate.c.
Perform most of the remaining refactoring of hibernate code into MI/MD parts. This also introduces a chunk placement routine.
Groff compatibility in mandoc(1) for the rendering of foreign manuals: support .Lb -libdwarf and update .Lb -libelf.
Rewrite of the mandoc(1) horizontal spacing of tables, to work both with and without frames and rulers.
Added a MACRO OVERVIEW section to man(7).
Remove all remains of arm26 code/support for ARM2, ARM2AS, ARM3, ARM6, ARM7, ARM7TDMI and StrongARM processor families.
No longer check for SPX on KA410 (VS2000), since the only colour option for this machine is GPX.
Use errx(3) instead of fprintf(3) and exit(3) in midiplay(1).
When restarting a system call go back four instructions, not three, since this has to match libc/arch/hppa64/SYS.h.
When compiling PIC code; limit instructions between two set of pc-relative loaded data in find_barrier(); avoids "pcrel too far" as(1) errors.
Remove the "portmap" variable, it's unused now (use portmap_flags) in etc/rc.conf.
Avoid pf_setup_pdesc() panics in pf(4) by using "switch(af)" for af dependent code.
Disabled 3D ring commands on sandybridge so VT switches (and therefore suspend) will no longer hang.
On x220 resume, skip restoring the modeset registers on sandybrige, rely on the (upcoming) xf86-video-intel driver instead. Fixes hang.
mandoc(1) .TP no longer assumes that a head argument with a matching input line number is a same-line argument.
pkg-config(1) no longer allows variable expansion to multiple values in a field (unlike freedesktop.org version).
Very early in suspend while the clock is still ticking realtime, save the clock back to the rtc.
When advancing mandoc(1) left margin, .RS also needs to reset the right margin to the default and check that the left does not outgrow the right one.
Mark softraid(4) crypto volumes as being capable of auto assembly (they are if used with a key disk).
In glob(3), limit recursion during matching attempts, similar to fnmatch(3) fix. Also collapse consecutive "*".
Clear RB_POWERDOWN early in boot() on hp300/hppa (which cannot powerdown and whose firmware does not send "spin up" to disks).
mandoc(1) will now display sane page header line even when .Dt is very long.
memconfig(8) now reports the "fix-active" flag, and print any other unknown flags in hex.
Add pipe2 to sys/compat/linux/linux_ipc.c and syscalls.master.
Add a test suite to analyse traffic going via pf(4). Needs four machines setup as described in the makefile.
Fix unix socket handling by trimming when the length is too large in sys/compat/linux/linux_socket.c.
Removed mandoc(1) terminal frontend flag TERMP_NOLPAD.
kdump(1) now understands "siginfo-style" signal sub-codes, and the (currently) limited subset of info the kernel supplies.
Vax system type constants cleaned up.
Enable loading kernel outside softraid(4) volume, yet still use it as root device (providing we booted from its chunks).
When installboot runs on a softraid(4) volume, add boot metadata to store volume/chunk DUIDs, (so can ID root disk).
Print 64 bit values in sys/arch/vax/vsa/hdc9224.c with %ll to get a meaningful message at attach time.
Use long calls in lib/csu/hppa64/md_init.h like we do on hppa, stops functions possibly being unreachable.
Sync with libX11/src/UIThrStubs to fix __pthread_once_stub() in lib/libpthread-stubs/stubs.c.
Fix _Xthr_once_stub_() to call the init routine for each different id in lib/libX11/src/UIThrStubs.c.
Set default daemon_flags (matching rc.conf.local(8)) for ftpd(8), identd(8), mopd(8), popa3d(8), rarpd(8). See rc.d(8).
Use arguments for rc script instead of env variables to indicate debug mode; allow "forced mode" even if daemon_flags="NO".
Kill prototypes for long removed ifconfig(8) functions.
Enable thread model posix for gcc 3. Dwarf2 exception handling and libstdc++ now thread safe.
Clean up systat(1) buffer cache statistics to remove useless statistics; add new ones regarding kva usage in cache.
Expand syscall awareness in preparation for pipe2 implementation in sys/compat/linux/syscalls.master.
Stopped unconditionally creating dynamic sections in gnu/usr.bin/binutils-2.17/bfd/elf64-hppa.c since that makes building static binaries impossible.
Removed some unnecessary debug code in sys/arch/hppa64/hppa64/machdep.c.
smtpd(8) fixed to avoid fatal() when we receive a line which have a length of exactly 1024.
Disabled TRAPDEBUG in sys/arch/hppa64/hppa64/trap.c.
Make it more clear what are subtypes and cleanup of the mrt definitions in bgpd(8) code.
Missing argument in STIDEBUG printf in sys/dev/ic/sti.c corrected.
Fixed sys/arch/hppa/dev/elroy.c and hppa64/dev/elroyc so %b format strings take the value before the bitname string, not the other way around.
In sys/lib/libkern/arch/hppa64/bcopy.m4, when checking if the addresses are 4-byte aligned, avoid sign-extension when extracting the low bits.
Remove %r and %z from printf(9) man page, deprecated some time ago. Mention %hh, %j and %t are not supported.
Handle an instruction memory protection trap from userland as an ordinary fault in sys/arch/hppa64/hppa64/trap.c.
In lib/libc/arch/hppa64/SYS.h, make sure entire system call address is cleared. Look at %r1 to determine whether a system call was successful, since that is where the kernel puts the information.
Removed the /usr/share/man/ps* hierarchy and supporting variables; MANPS disappeared during the source manuals switch.
Move cwm(1) client to group (movetogroup) and hide client only if group is already hidden.
Breaking the line at a hyphen is now only allowed by mandoc(1) if the hyphen is both preceded and followed by an alphabetic character. Fixes about a dozen places in base.
Make sure snooping is enabled on Intel HDA variants. Fixes audio on ThinkPad x220.
Add support for *at() system calls to systrace(1).
Fix more printf format string bugs in sys/ufs, and one more %hh format stringin sys/kern/uipc_mbuf.c.
Removed requirement for processes that need PS_* flags to #define __need_process, as they are exposed to userspace via sysctl(KERN_PROC).
Moved rq_host pointer to outside of rq_msg envelope, as a single smtpd(8) ramqueue message may be shared by many ramqueue envelopes for delivery to many ramqueue hosts.
Regression check whether breakable hyphens are formatted correctly (normal, bold or underlined) and actually break the line.
Renamed a few functions, structs, etc that collide with upcoming stuff in altq(9) code.
Add support for variable length optional metadata in softraid(4) allowing new optional metadata types to be added without needing to change the softraid metadata version.
Fix exchanged arguments in sys/arch/hp300/dev/mb89352.c.
Fixed pointer set to NULL not 0 in sys/dev/usb/ohci.c.
Regression test for pthreads(3) interrupted connect.
Sync to mandoc(1) version 1.11.7, main new feature is support for roff(7) .tr request; bugfixes and some refactoring.
Fixes to the trap save/restore and the signal handling code in sys/arch/hppa64/hppa64/locore.S and machdep.c.
Extract 8 octets (as per RFC 2661) rather than a long in usr.sbin/tcpdump/print-l2tp.c.
Move pf(4) pdesc initialization code into pf_setup_pdesc(); unify some IPv4 and IPv6 code and set fields in the same order.
Disable space-ID hashing in sys/arch/hppa64/hppa64/locore.S like we do on hppa.
Removed 'hh' modifier in printf format strings in sys/kern/kern_sysctl.c and subr_disk.c, unavailable in kernel printf.
Update the Loongson system clock when we resume.
Use an uvm object to track the page table pages, like on hppa. Add cache flushing in places where hppa does them.
Make sure daddr64_t filesystem values get printed with %lld.
Fix to various format string types to as a minimum match the width of the variables being processed.
Take into account the PIE bits when masking PDEs in sys/arch/hppa64/hppa64/pmap.c.
Add missing cache and TLB purges in sys/arch/hppa64/hppa64/mainbus.c.
Sync mandoc(1) to version 1.11.5: adding an implementation of the eqn(7) language.
Avoid potential 64-bit unaligned access on strict alignment architectures in tcpdump(8).
Reorder headerfiles used in bgpd(8). Move bgpd specific prototypes out of mrt.h to include only protocol specific defines.
Override LIB2ADDEH on ia64. Makes it possible to build a cross compiler; exception handling needs work still.
Makefile.cross corrected so ia64 will use gcc4.
Added futex support for compat_linux(8).
Make sysctl__string() handle truncated output case via two copyout()s instead of altering variable; return full length via oldlenp.
Add MACRO OVERVIEW to mdoc(7), listing macros ordered by purpose, to decide which is best for a particular use case.
Make tcpdump(8) -v print the id and seq of icmp6 echo packets.
Added pkg_add(1) regression tests for --variable (expansion to multiple values) and for linebreaks inside fields, both currently failing.
Document proper cross-tools command to run, especially when working on a new port.
Update pointer variable after copying misaligned packet in tcpdump(8).
Implement new bgpd(8) mrt table dump format as specified in draft-ietf-grow-mrt. Tested with IP and IPv6 sessions and against the libbgpdump parser.
Remove pd->ip_sum and pd->proto_sum fields in pf(4) code. Replace pd2.ip_sum with a local variable. Remove ip_sum and proto_sum from struct pf_pdesc.
Access a 32-bit field as u_int32_t, not as u_long in tcpdump(8).
Make pkg_add(1) -nvv work with respect to whatis(1) whatis.db updates.
Rewrite the main loop of the sed(1) "s/..." command, to fix multiple issues regarding the replacement of zero-length strings.
Apply the fnmatch recursion limit fix to the local copy of fnmatch in httpd(8).
Expand fnmatch() regress with patterns obtained from the tests for APR's new fnmatch implementation. Allow comment lines in the test data file.
Initial, incomplete support for -Tman to convert mdoc(7) documents to the man(7) language.
Standarize the ToS option across nc(1)/ping(8)/traceroute(8) so that they'll accept the same values as pf.conf. It accepts decimal, hexadecimal and the dscp/tos keywords.
Add SMALL infrastructure to ping(8) makefile.
Change the mandocdb interface to better agree with makewhatis(8); in particular, allow recursing multiple directories and create multiple databases in one call.
Use default_chip_unmap for sata_chip_map, lets the VIA controllers detach.
Cleaning of current solution for "Kill X on Ctrl+Alt+Backspace on default".
Update to xterm(1) version 275.
Move initialisation of pf(4) pd->nsaddr and pd->ndaddr from pf_test_rule to pf_setup_pdesc. Fixes logging of packets passed statefully.
Deduplicate pf(4) IPv4 and IPv6 code that handles fragments that have not been reassembled by normalization.
Improve -s description in ntpd(8) to explain set vs adjust and stay in foreground until we receive a reply or hit the 15 second timeout.
Work-around for default vs. no flavor in pkg_add(1).
sed(1) regression tests using hexdump(1) for input files ending without a newline, and catching NUL characters in output. Produce more intelligible errors.
Removed mdoc.samples(7) as all info already is in mdoc(7).
Removed {u,}lptioctl function which is a duplicate of enodev().
Use cdev_ulpt_init() to setup ulpt(4) instead of using cdev_lpt_init, for consistency.
Reorder SENSOR_* in switch() in sysctl(8), systat(1) and snmpd(8).
Intel E600/EG20T and some other devices added from submitted dmesgs to sys/dev/pci/pcidevs.
Now when ospfd(8) RTM_DESYNC is seen, set/extend a timer, only reload on expiry. Avoids "reloading interface list and routing table" repeatedly when machine overloaded on route socket.
Set the shared priority entry to the value of the current maxipl entry, not the index in sys/arch/macppc/dev/macintr.c.
Import of less(1) 444 with local patches.
Device driver and man page for usps(4) Fujitsu Components FX-5204PS smart power strip added.
For sensor framework change accuracy of SENSOR_FREQ from Hz to muHz and add SENSOR_VOLTS_AC entry for userland programs.
Use .St for ISO 8601 references in strftime(3), strptime(3), cal(1), newsyslog(8).
If a user configures logging explicitly in relayd.conf(5), do it regardlessly of debugging mode and compile switch.
Added Vaisala's "USB instrument cable" entry in sys/dev/usb/usbdevs and sys/dev/usb/uslcom.c.
Added entry for FX-5204PS in sys/dev/usb/usbdevs.
Fixed usb vendor id mismatch. VID: 0x430 is not SUN Microsystems, it is Fujitsu Component, Inc.
Use the correct regexp in etc/rc.d/ldapd to find the ldapd(8) server process.
Add a script for popa3d(8) to support running it outside of inetd(8).
Port the -Wbounded extension from gcc3 to gcc4 and add regression output.
Fix recognition of Synaptics touchpad in sbin/wsconsctl/util.c.
Switch vax to timecounters. 3 different clock sources: ICR/NICR on most systems (1MHz counter resolution), diagnostic timer on KA46/KA48 (1kHz counter resolution), 100Hz clock on VXT.
Update vt100 example in getcap(3) to vt200, as vt100 is no longer in the termcap database.
Initial kernel support for sandybridge intel chipsets in intagp and inteldrm.
ntpd(8) doesn't really support reload, so don't allow it in the rc script.
Regression test for threads in PS_FDR_WAIT state, check SA_RESTART before marking it as interrupted, (simulating system call restart behaviour in the non-pthreads case). Add a state for kevent since it shouldn't be restarted regardless.
First round of regression tests to check system calls restarting with pthreads(3).
On Vax KA43, silence noisy print of cache control registers at cache initialization time (but not during memory errors or machine checks); correctly access the prom mailbox register, so that halt and reboot work as intended.
Update to xf86-video-geode 2.11.12.
Let the intel driver/xf86-video-intel/src/i830_driver.c driver build with xserver >= 1.10.
Document that calendar(1) now behaves as date(1) and touch(1), with default values used when "yy" is given, but not "cc".
Added cwm(1) WM_TRANSIENT_FOR event support: moves dialogs, toolbars and such to the group of the main application window.
Repaired cwm(1) groupcycle (broke after cycle-in-group support added more flags) in app/cwm/group.c.
Do not invoke hardclock() until cpu_initclocks() has been invoked in luna88k; avoids a NULL pointer dereference because the softclock interrupt handler cookie is not initialized yet.
calendar(1) -t flag now uses macros instead of punctuation to avoid marking up the whole argument as an Ar block; remove a superfluous set of [] around month.
Introduce filtermask in struct smtpd(8) - do not forward lines to mfa when FILTER_DATALINE is not set in filtermask.
Update to tzdata2011j (timezone data) for Africa and Australasia.
Clamp a maximum number of outstanding requests at 40 in mpii(4) as performance decreases severely above this with newer firmwares.
Update to glproto 1.4.14; dri2proto 2.6.
Define symbolic constants for the addresses of Vax vsbus devices on 512KB PROM systems (e.g. KA49), or 256KB PROM systems built after KA49 (e.g. KA5[234]), and use them instead of magic numbers.
Fix sftp(1) leaks in do_hardlink() and do_readlink() from bz#1921, and in do_lsreaddir().
Fix inverted test when selecting resolution on the 1024x864 VLC frame buffer in lcg(4/vax).
Mention the 1GB offset PROM limit on some systems in distrib/notes/vax/install.
Support ssh(1) cancellation of local/dynamic forwardings from ~C commandline.
Xenocara/driver/Makefile adjusted to make testing of newer Xserver versions easier.
Updates to version: libXfont 1.4.4; libXt 1.1.1; inputproto 2.0.2; glproto 1.4.14; dri2proto 2.6.
Let pkg_add(1) pkg_mklocatedb work consistently with SUBDIRLIST (print only the fullpkgpaths referenced there and nothing more).
Support ssh(1) cancelling local and remote port forwards via the multiplex socket. Use "ssh -O cancel -L xx:xx:xx -R yy:yy:yy user@host".
Kill the sshd(8) preauth privsep child on fatal errors in the monitor.
Suppress scp(1) adding '--' to remote commandlines when the first argument does not start with '-'. Saves breakage on some embedded/router platforms.
Added an mdoc(7) St macro for ISO 8601:2004 (representation of dates and times) and now used in touch(1).
Added /var/nsd/ to hier(7).
MUX_C_CLOSE_FWD includes forward type in message (though it isn't implemented anyway) in usr.bin/ssh/PROTOCOL.mux.
Add -b option to tcpbench(1) which allows the client side to bind the socket to a numeric address.
Protocols 43 (ipv6-route) & 44 (ipv6-frag) names synched with IANA database.
Additional information on the -d option in touch(1).
Provide namespace-safe alignment macros in machine/_types.h, with compat names kept in machine/param.h.
In sys/socket.h, pull in sys/_types.h instead of the namespace polluting machine/param.h.
Eliminate __CMSG_ALIGN, replaced by _ALIGN.
Make the INT_FAST*_{MIN,MAX} macros match the types they're defined to; put internal macros in machine/_types.h.
Avoid possible SIGSEGV when wrong TOS option in sbin/pfctl/parse.y.
Better determination if the ksh(1) shell is restricted.
Updated key size and algorithm recommendations in ssl(8); knock out useless Pp in openssl(1).
Add test for http chunked encoding over relayd(8) http protocol.
Properly initialize struct carp_if (especially vhif_nvrs) with M_ZERO. This lets carp(4) delete IFF_PROMISC on its carpdev upon destroy.
Mark dead panes with some text saying they are dead in tmux(1).
Restore errno when it has been changed by the scheduling loop in lib/libpthread/uthread/uthread_kern.c.
Optimized bba(4/alpha) code to process four samples at a time as much as possible, before falling back to the remainder processed one byte at a time.
Fix typo in ssh(1) IPQoS parsing: there is no "AF14" class, but there is an "AF21" class.
ControlPersist and KbdInteractiveAuthentication descriptions added to -o section of scp(1) and sftp(1).
Enable MSI support and fix establishing a link to a GigE link partner from a FastE ale(4) controller.
Fix hang in emacs when going over the line limit.
Preserve errno across calls to open the password database(s), so that errno isn't changed when a normal user (who can't open spwd.db) does a lookup.
Switch sigreturn() to the normal syscall entry instead of int$80 in amd64.
Driver for the bba(4/alpha) TURBOchannel baseboard audio.
Add the possibility for a MD attachment to stack a stream filter (sw_code) if it needs to rewrite the audio stream.
Added /etc/ldap to hier(7).
Silenced awacs_trigger_input in sys/arch/macppc/dev/awacs.c.
Added two more udav devices and an Intel 6 Series/C200 Rate Matching Hub to sys/dev/usb/.
For cwm(1), make flavours of maximisation additive; reinit menu on reload (for upcoming menu config changes); allow menufg/menubg and menu font color to be configurable.
Add test whether relayd(8) is logging the correct http content-length.
General warning in sys/arch/amd64/amd64/locore.S (about gdb matching against sigcode instructions) added.
Fix backtrace across signals in gnu/usr.bin/binutils/gdb/amd64obsd-tdep.c.
Inaccuratly named char "*DefaultFontName" changed to char "*font" in cwm(1).
Add cwm(1) {r,}cycleingroup to cycle through clients belonging to the same group as the active client (as opposed to all unhidden clients).
Simplified cwm(1) color initialization.
Split off cwm(1) window hints from geometry so we don't need to carry them all around when dealing with {,h,v}max.
Disable PHY (physical media interfaces) hibernation in Atheros AR8131/AR8132 PCIe ethernet to automatically re-establish link when the cable is plugged in.
MI driver for AMD79C30 audio chip added (now used by sparc audioamd(4/sparc)).
Manpage added for vsaudio(4/vax), found in VAXstation 4000 VLC, /60 and /90.
Rewrite -column lists in many man pages (to permit some markup in the column headers) while awaiting mandoc(1) fix.
sys/scsi/scsiconf.c will now generate a devid from vpd page 80 if vpd page 83 doesnt exist or work.
Added regress tests for relayd(8) protocol http 1.0 and 1.1, http put and https.
Support for Intel Centrino Advanced-N 6205 network adaptors added (without differential gain calibration).
Added regression tests for relayd(8) session timeout.
Removed drupal5 reference in port-modules(5) as drupal5 is gone.
Fix the display in sysmerge(8) so utilities reported as running are what is actually running.
Stopped overwriting smtpd(8) data line with filtmsg buffer; removed excess debug lines; back filters now disabled at smtpd.conf(5) level.
Added missing header needed by bsearch() in usr.sbin/smtpd/parse.y.
Add regression tests for relaying connections through relayd(8) to test socket splicing works correctly.
Introduce a small set of functions to simplify smtpd(8) stat counters.
Log_debug() call moved to not get called for each line of DATA exchanged between smtp and mfa.
Allow mg(1) dired mode to open files regardless of characters in filename.
Use the same format/text, as far as possible, for date strings in ls(1), touch(1) and date(1).
In strptime(3) only one leap second is permitted, not two.
On a file write fail in mg(1) return an error value and show an error message.
Synch OpenBSD::Intro(3p) with current method of parsing packages.
Moved pkg_add(1) versionspec from PackageName to PkgSpec.
Add smtpd(8) support for per-line DATA callbacks, allowing filters to take their decisions while the message is still being received by the client.
Remove faux "enable floating point" and PR_ACCS register on KA45 and KA48 in sys/arch/vax/vax/ka48.c.
Report VXT cpu as "VXT", not "KA48" (to match what the PROM says) in sys/arch/vax/vax/vxt.c.
Add pf.conf(5) one shot rules automatically removed after match when it is the only rule in the anchor (eg for firewall proxies). Can be used by specifying a "once" filter option.
Make ps(1) -N/-M work again by correcting kernel vs user address handling in the FILL_KPROC() macro.
Make code match the touch(1) and at(1) manpages and POSIX when year specified but century isn't: century is 1900 if year >= 69; else 2000.
Make vlanprio (PCP/CF) available to our network stack.
Fixed format string in smtpctl(8).
Plugged memory leaks in tmux(1).
In mdoc(7) column lists, enforce ordering: ".Bl -column header1 header2 ... <Bl flags>".
Add another GeForce 8400 GS.
Call free() into ramqueue_remove_{batch,host,message,envelope}() instead of just after the function call in smtpd(8).
Switch to xkeyboard-config is done. Removed old xkbdata and unifdef it.
Regression test that perl(1) reverse splicing timeout does not affect forward splicing.
Mouse move via the keyboard restored.
Added gpsmap 62s to usbdevs(8).
In mg(1) dired mode, make point move up and down first character of file name; added missing keybindings.
Update to tzdata2011i for tzfile(5) from elsie.nci.nih.gov.
Update firmware for myx(4) to the latest version available from Myricom (1.4.53a).
Only provide FLT_EVAL_METHOD for C99 in float.h. Add missing DECIMAL_DIG for C99.
Remove the reference to the non-existent mount_portal(8) in keyword section of man(1).
Fixed a race causing some drives to trigger a panic in ncr53c9x_sched() at attach time on vax.
Removed reference in bsd.port.mk(5) discouraging use of xz distfiles on Sparc.
Added missing header needed by signal() in smtpd(8).
Return of the long missing powerpc interrupt rewrite.
Cast all smtpd(8) printed time_t to long long int, and change format string accordingly.
Allow perl(1) splice make regress to run with and without obj directory.
Version updates to: DejaVu fonts 2.33; xterm(1) 273; xset(1) 1.2.2; xrandr(1) 1.3.5; xprop(1) 1.2.1; xman(1) 1.1.2; xkbcomp(1) 1.2.3; x11perf(1) 1.5.4; twm(1) 1.0.7; smproxy(1) 1.0.5; mkfontscale(1) 1.0.9; libX11 1.4.4.
Remove redundant final paragraph of STANDARDS in touch(1).
Clear smtpd(8) bounce envelope structure, to avoid wrong use when bounce_record_message() returns 0.
Added support for the netid.byname YP map in ypldap(8).
Make sure lock(9) lockmgr() use a different address for the wchan when draining the lock.
Fixed a strlcpy(3) truncation test block in smtpd(8).
Added initial support for a session-time filtering API in smtpd(8).
Prevent iked(8) from bypassing a signature verification caused by an incorrect check of the EVP_VerifyFinal return value.
Prevent spurious disappearance of le(4/VAX) on some systems.
Prevent a bogus lcg(4/VAX) device from attaching on KA45 and also repair console operation if the S3 switch is down.
Fixed vsbus(4/VAX) verbose autoconf(9) output.
Added initial framework in tmux(1) for more powerful formatting of command output and use it for list-{panes,windows,sessions}.
Removed unused fatpackages from pkg_add(1).
Prevent watchdog timeouts in age(4).
Added a dmesg warning about sloppy disk I/O to vnd(4) devices to help identify bad distrib scripts/tools.
Added a tty_bell wrapper function, a pane-base-index option, support for line continuation with a backslash in the configuration file to tmux(1).
Make at(1) use standard EXIT_SUCCESS/EXIT_FAILURE and STD{IN,OUT,ERR}_FILENO defines instead of using custom macros.
Prevent that a sosplice(9) timeout error in one direction from being also added to the other direction.
Allow tcpbench(1) TOS/TCLASS to be set with -T and accept the same keywords as in pf.conf.
Added support for Radeon 4250 in radeondrm(4).
Make cron(8) use standard EXIT_SUCCESS/EXIT_FAILURE and STD{IN,OUT,ERR}_FILENO defines instead of using custom macros.
Moved powerpc to non-__STRICT_ALIGNMENT, as it always was.
Reworked cwm(1) warning on configuration parsing.
Make rc.d(8) read amd(8) amd_master using print -rn, fixes problems if the file has multiple lines.
Fixed touch(1) -t option.
Fixed some watchdog timeouts seen when unplugging the cable from the alc(4) NIC while running or the NIC not working if the cable is not plugged in upon boot up.
Fixed initial xkb_options setting in xf86-input-keyboard. Restores Ctrl+Alt+Backspace behaviour.
Fixed serial mouse on X.
Fixed memory leaks in tmux(1).
Make ahci(4) not waiting for FR to come on after setting the FRE bit in the port command register.
Added support for -v (enable verbose logging on the command line) in iscsid(8).
Updated x11proto to version 7.0.22 and util-macros to 1.15.0.
Decoupled ospfd(8), bgpd(8), dvmrpd(8), ldpd(8), ripd(8) log_verbose() from log_init() so the verbose flag stays set with "ospfd -v" (previously only "-vd" worked).
Fixed segfault on tcpbench(1) server when the remote end closes and reopens a connection.
Added nanosecond precision to touch(1) and support for -d option.
Make mpe(4), vlan(4), ppp(4) fix packet accounting in error cases.
Use futimens(2) instead of futimes(2) to avoid converting to/from struct timeval in crontab(1) and vipw(8).
Let ums(4) probe bounds of absolute devices if available.
Put libc and libm in line with the compiler on hppa64.
Make sure the stack is properly aligned for using SSE instructions in crt0.
Added sti(4) at dio(4/HP300) in hp300 GENERIC and RAMDISK kernels.
Improved hp300 sti(4) and wsdisplay(4) attachment on dio(4/HP300).
Prevent hp300 models 362 and 382 from skipping dio(4/HP300) frame buffer select codes.
Updated xterm(1) to version 271.
Set the PSL_O bit on hppa64, like it's done for 64-bit capable CPUs on hppa.
Fixed a memory leak in smtpd(8) runner_remove_envelope().
Prevent hppa64 locore.S from setting the PSL_S bit.
Moved ramqueue_host pointer from ramqueue_envelope to ramqueue_message. This allows to save one pointer from each envelope stored in ram while still allowing O(1) host lookups by ramqueue_envelope.
Make smtpd(8) know how to remove th new ramqueue structure.
Improved smtpd(8) rescheduling from O(n) to O(log n) with functions working on the new ramqueue structure.
Added assembler implementation of the GCM mode using the Carry-less Multiplication (CLMUL) instruction found in the new Intel and future AMD CPUs for amd64.
Added support for Synaptics touchpad in wsmouse(4).
Make pkg_add(1) and pkg_delete(1) syslog their activity by default.
Make sure the installer set two rtsol sysctl(8)s, not just the last one.
--------
Changes made between OpenBSD 4.9 and 5.0
Add so_idletv to netstat(1) -vP pcb-address output.
Move the ARM platform to the machine independent softfloat code.
Updated bsd.man.mk to allow parallel linting of manuals.
Fix sharing of the signal handling state for threads.
Various mandoc(1) updates.
Speed up cap_mkdb(1) by trimming comments.
Fix npppd(8) route sending issues.
On i386, remove compat_aout.
Removed old osyscall() kernel entry.
Back out MSI for inteldrm graphic devices.
Removed compat_svr4 support.
Fix route(8) issue when using -ifp.
Removed the map3270 termtype file.
Disabled the built-in arla AFS client in the GENERIC kernels.
Make syslogc(8) stdout line buffered.
Make sure RTM_IFINFO is sent when setting addresses on lo(4) interfaces also.
Make bgplg(8) support "show ip bgp peer-as".
Make sure raw sockets can be bound to 0.0.0.0.
Fix hppa64 pmap protection ID issues.
Fix byte-order conversion in the pppoe(8), which was inadvertently removed.
Make sure IPv6 packets with routing headers do not create state while dropping them in pf(4).
In tmux(1), show full targets for lsp/lsw -a.
Added the wcsdup(3) function.
In ospfd(6), make sure passive interfaces are added to the intra-area rtr LSA.
Removed the pf(4) "set require-order" option.
Allow carp(4) advbase to be set to zero for special setups.
Added least-states option to pf.conf(5).
Removed cdnr and rio disciplines from altq(9).
Added Romanian UTF-8 support to ctype(3).
Avoid void * pointer arithmetic in malo(4).
Added nvt(4) and enabled it on the amd64 and i386 platforms.
Fixed amd64 boot dump on bigmem machines.
Prevent unnecessary register accesses in the drm(4) ironlake interrupt handler.
Make ucom(4) understand the last-close semantic.
Added an option in tmux(1) to trigger the terminal bell when there is an alert.
Fixed NULL definition which was incorrect for C++ compilers that aren't gcc(1).
Make pf(4) garbage collect unused parameters to PFLOG_PACKET.
Removed support for uvm(9) UVM_HIST and UVM_CNT.
Make amd64 DMA bus map contiguous memory through the direct map in bus_dmamem_map() like in other archs.
Corrected NULL and 0 confusion in UFS and ext2.
Make tmux(1) include the existing window and session name in the prompt when renaming and add a new key binding ($) for rename session.
Updated lint(1) floating-point format specifier checks and make it recognize recently added %a and %A.
Make wsdisplay use wsdisplaypoll and not ttpoll.
Fixed return values of wsdisplay(4) wsdisplaykqfilter.
Make scanf(3) recognize %a, %A format specifiers as told by C99.
Avoided a void * pointer arithmetic in carp(4).
Updated termtypes.master to the terminfo.src from ncurses-5.9-20110626.
Removed uvm(9) UVM_STRAT defines.
Fixed vnd(4) support for read-only files.
Prevent carp(4) from using LINK_STATE_UNKNOWN for the INIT state. LINK_STATE_UNKNOWN has a special meaning and should only be set if the link state is not known because it is considered as being up. Make carp(4) use LINK_STATE_INVALID instead. Permits interfaces LINK_STATE_IS_UP() to now consider LINK_STATE_UNKNOWN as an up state.
Let rc.d(8) reload report (ok) or (failed) just like all other actions.
Added a SIMPLEQ_REMOVE_NEXT() macro analogous to SLIST_REMOVE_NEXT() in queue(3).
Removed config_activate() and DVACT_ACTIVATE from the kernel.
Make softraid(4) call config_detach() on the child scsibus in sr_detach().
Make pthread(3) thread_key_delete(), only scan other threads if the key was allocated and handle the case of specific_data being NULL.
Properly implemented the long double (%Lf) scanf(3) without the precision loss. Allows tests of 80-bit long double precision on platforms that support it.
Removed rogue(6) because of unproper license.
Make kqueue attach functions return an errno or 0, not a plain 1.
Make sparc use unlocked reads when spinning on a contended lock(9) as recommended in the sparc documentation.
Make sure route(8) accepts both -iface and -interface (an alias of -iface) flags in the monitor case.
Allow tmux(1) initial context on prompts to be set with the new -I option to command-prompt.
Updated resourceproto to version 1.2.0, libXcursor to version 1.1.12, libXrandr to version 1.3.2, xf86-input-joystick to version 1.6.0 and libXi to 1.4.3.
Trick lint(1) into recording the right prototypes in the llib-lc.ln database on the vax, similarly like has been done in gen.
Updated gdtoa to gdtoa-20110428.
Cleaned up the softraid(4) boot probe code.
Make pthreads(3) pthread_key_delete delete the data, so it's not reused by a later pthread_key_create.
Make diskmap use getvnode() instead of a its own file descriptor handling.
Prevent FFS from uselessly extracting a disklabel.
Improved pkg_add(1).
Added support for MSI interrupts on mfi(4).
Make sure pf(4) pf_headers union contains enough memory for a mld_hdr or nd_neighbor_solicit struct.
Updated xkeyboard-config to version 2.3.
Refactored machine-independent open/close/detach functions from sd(4), cd(4), wd(4), vnd(4), rd(4), ccd(4) code into machine-independent subr_disk.c.
Added disklabel(8) UID support for ext2 mounts.
Prevent opendev(3) from masking errno if it fails to open diskmap(4).
In all kernels configuration files, replaced all instances of "scsibus* at hba?" with a single "scsibus* at scsi?" rule, similar to how ethernet PHY drivers attach at mii(4).
Introduced new autoconfiguration code for X input drivers, based on X hotplug framework.This also takes care of the configuration of the keyboard layout from the wscons(4) layout that was hacked inside the keyboard driver.
Removed APM_NOPRINT from i386 RAMDISKs kernels.
Make sure sppp(4) always sets its auth secret, as other code assume it. Fixed a crash.
Removed the ega driver.
Make pstat -T behave as documented.
Fixed iopool conversion in oosiop(4).
Make sparc64 interrupt handler similar to other architectures.
Make sparc64 first run the higher IPL handlers.
Fixed an off by one in tcpdump(8) IPv6 printing functions.
Make arp(4) mark ARP request broadcasts with M_BCAST in the mbuf flags. Fixes a case in bridge_output() where ARP requests are not broadcast on interfaces without the discovery flag.
Added UTF-8 support to cwm(1) menus.
Updated zoneinfo database to tzdata2011h from elsie.nci.nih.gov.
Make aucat(1) display CPU usage when -d switch is used.
Expose aucat(1) audio client names through system exclusive messages, this way any midi client could determine which volume knob corresponds to which client.
Make sysctl KERN_FILE and KERN_FILE2 behaviour consistent: when the caller doesn't have the necessary rights, return f_offset=-1 and f_seek=0.
Removed 4.3 Reno support from vax kernels.
Fixed problem with amd64 and i386 disk checksumming (dkcsum.c) being unable to read data to checksum from subsequent devices after an I/O operation fails.
Removed mcd(4) from tree.
Moved if_downall() call to the machine-dependent boot() routines since it cannot be done machine-independent in sys_reboot() because vfs_shutdown() might need network (ie. nfs). Fixes a boot hang.
Added first pieces of MSI support for vpci(4/SPARC64).
Make sparc64 shared interrupt handler return the pil and ci_handled_intr_level to the level they were at before splraise()ing for the various handlers.
Fixed some inconsistencies in how sparc64 64-bit addresses are built from OF properties.
Removed obsolete mcast routes in ldpd(8) and ripd(8).
Implemented pci(4) pci_intr_map_msi() in sparc64.
particular function patterns, such as libc's __vfprintf.
Fix gcc(1) PR #35965 as suggested in http://gcc.gnu.org/ml/gcc-patches/2008-06/msg01641.html. This fixes a stack protector code bug.
Added MSI hypervisor calls in sparc64.
Make cwm(1) warn if it can't parse the config file on start.
Make sure the kernel endian conversion macro cast to unsigned when converting endian to same endian so that signedness of the input is suppressed.
Make swapctl -s show 512 B blocks and show 1 KB blocks when launched with -k, as it is supposed to do. Fixed PR6609.
Added a machine-independent sysctl(8) hw.allowpowerdown: if set to 1 (the default) it allows a power button shutdown.
Make sparc64 acknowledge a shared interrupt only once.
Speed up pkg_add(1) dependency checking by not computing @wantlib on -current and by adding an extra cache and by making the checking computation progress message less painful.
Replaced the .PHONY manlint target by an empty timestamp file, so man pages are only re-linted after an actual change.
Avoid a possible null dereference in softraid(4).
Make makewhatis(8) handle \*(Na in .Nd, as it is needed by nan(3).
Improved cwm(1) cursor behaviour.
Introduced window_raise, a new cwmrc(5) config option to raise a client via the mouse.
Introduced snapdist, a new cwmrc(5) config option to snap to the screen edge.
Improved cwm(1) vmax+hmax behaviour.
Replaced cwm(1) non-working check to see if another window manager is running with a method that actually works.
Fixed cwm(1) problems found by lint(1).
Make octeon always include ukphy(4) in the kernel if using any devices using MII.
Make ssh(1) monitoring code ignore EINTR errors from poll().
Install source manual instead of formatted ones in base and Xenocara.
Prevent uvideo(4) from leaking the ctrl_data in uvideo_queryctrl, uvideo_s_ctrl and uvideo_g_ctrl.
Make malloc calls in isp(4) isp_pci_mbxdma NOWAIT to match the bus_dma calls that are all nowait.
Prevent forbidden free(null) in the kernel from failing and going to done.
Make uvm(9) check the correct flag when checking to see if the page is part of an aobj.
Prevent uvm(9) from checking for an empty queue before calling uvm_pglistfree.
Moved uvm(9) uvm_pglistalloc and uvm_pglistfree to uvm_page.c and garbage collect uvm_pglist.c.
Make mbuf(9) and dma_alloc(9) have contiguous allocations.
Fixed bus_dma(9) bus_dmamem_map error path.
Set pd->af very early in pf(4) pf_setup_pdesc() since the AF is used in the pflog(4) code and not setting it will cause a panic in pf_setup_pdesc().
Simplified softraid(4) to behave like other HBAs by using a single scsibus(4) for all attached disks, rather than one scsibus(4) per disk.
Complete rewrite for rd(4) to eliminate unnecessary functionality and better follow current disk driver conventions.
Make cp(1) set{u,g}id bits only if the targets did not exist and -p is not used.
Added a couple of extra xterm-style keys that gnome terminal provides in tmux(1).
Make myx(4) cope with empty rx rings by scheduling a timeout to keep trying until it gets some packets onto the rings.
Handle correctly myx(4) link state.
Implemented in ssh(1) a channel confirm callback to warn the user then requested X11 forwarding was refused by the server.
Introduced ssh(1) sandboxing of the pre-auth privsep child using systrace(4).
Make myx(4) resume the tx_count on UP, since it may have been advanced from non-zero by a previous use.
Fixed function names in wd(4) debug statements.
Added beagle to distribution, thought it is not yet fully ready.
Added MSI support to myx(4).
In cnmac(4/OCTEON): fixed MAC address printing for dmesg(8), set IFCAP_VLAN_MTU to allow for VLAN sized frames.
Synchronized Bind root.hint, added IPv6 address for d.root-servers.net.
Enabled myx(4) in sparc64 GENERIC kernel.
Set myx(4) mac address on the chip correctly to make it work on sparc64.
Removed myx(4) myx_raw{read,write} in favor of myx_{read,write} and always write raw values to registers.
Added to systrace(4) a SYSTR_POLICY_KILL per-syscall policy option that sends SIGKILL to the traced process when the syscall is attempted.
Make uvm(9) validate pmemrange result, enabling early catching of bugs in the code.
Make myx(4) test unaligned DMA so it can figure out if it needs to fall back to the unaligned firmware.
Removed dpt(4) dependency on scsibus unit number and make it use a struct scsibus_attach_args instead of a struct scsi_link for attaching the scsibus.
Converted ping(8), nc(1), tcpbench(1), telnet(1), dhcrelay(8), ftp-proxy(8), ospfd(8), ripd(8), traceroute(8) SO_RTABLE protocol level to the SOL_SOCKET.
Make myx(4) report part number.
Removed pf(4) PFDESC_IP_REAS and pf_pdesc flags.
Make use of explicit_bzero for vnd(4) crypto key.
Restored changelist(5) wildcard support inadvertently killed by the recent security(8) rewrite.
Make aucat(1) -aoff option apply to MIDI ports (-q) as well, ensuring the device stays closed also if -q is used. Also added -a to midicat(1) so it behaves like aucat.
Make fdisk -e and fdisk -i work on devices with sector sizes greater than DEV_BSIZE.
Fixed a segfault in make(1).
Switched grep(1) binary file detection from !(isprint() || isspace()) to checking for embedded NULs as in GNU and FreeBSD grep and avoids problems with latin1-encoded files being treated as binary in the UTF-8 locale once grep(1) calls setlocale().
Added support for 's' malloc(3) option.
Improved kdump(1) output.
Prevent comparison between a char and EOF in sail(6), it does not fit if char defaults to unsigned like it does on arm and powerpc.
Serialized attach and detach of device sub-trees in autoconf(9) subroutines. Only one device sub-tree may attach or detach at a time. Attach and detach will sleep against each other.
Moved back to a private rw_lock rather than the disk_lock to avoid problems when instantiating new disks.
Make lint(1) know about %F, %A, %a format specifiers.
Quieted lint(1) false positive when check syslog(3) format strings that use %m.
Fixed a bad lockup in myx(4).
Implemented --static option in pkg-config(1).
Make pkg_add(1) avoid to extract identical files again.
Fixed softraid(4) to set xs->cmd = &xs->cmdstore rather than pointing it to a separately allocated SCSI command structure.
Updated mcd(4) to use disk_lock, etc. instead of its own tsleep(9) based locking.
Enabled myx(4) in i386 and amd64.
Fixed isa(4) devices that incorrectly cast the second argument to a "struct cfdata *" instead of a "struct device *".
Prevent drm(4) radeon irq parts from assuming interrupts if the command processor is not running.
Use disk_lock_nointr() in the xxclose() routines so that they cannot be interrupted in vnd(4), hd(4/HP300), wd(4), cd(4), sd(4).
Use disk_lock/disk_unlock directly and in the same way in vnd(4), hd(4/HP300), wd(4), cd(4) and sd(4), rather than using various wrappings. Convert vnd to using the sc_dk rwlock instead of using one of its own.
Removed the lockname argument to disk(9) disk_construct().
Clean up cnmac(4/OCTEON) ioctl handler.
Pass the correct size to memset in sppp(4).
Make ix(4) use MSI interrupts when available.
Cleaned up MSI code in amd64 machine-dependent code.
Make mandoc -T[x]html print out the link target for "Lk" if no link title is provided.
Make printf(1) warn and stop processing if the format string ends with an backslash.
Removed obsolete mbuf(9) PF_TAG_FRAGCACHE flag.
Make use of setproctitle for a mux master that has been gracefully stopped in ssh(1). Fixes bz#1911.
Make the protocol version an unsigned. Fixes bz#1913.
Make ssh(1) pre-auth privsep slave log via a socketpair shared with the monitor rather than /var/empty/dev/log.
Make ntpd(8) close pipe_prnt[0] earlier, foremost before forking the dns process.
Prevent a file descriptor leak in relayd(8).
Make mii(4) explicitly clear 1000baseT control register for F1 PHY used in AR8132 FastEthernet controller.
Enabled MSI support in age(4).
Cleaned up M_WAITOK in mpi(4), mpii(4), drm(4), wi(4), umidi(4), uticom(4), uvideo(4), mpath(4).
Updated ch(4) to use ISO C style function definitions to avoid confusing Lip6 Coccinelle.
Imported acpitoshiba(4) and enable it in i386 and amd64 GENERIC kernel.
Improved uvm(9) page deactivation after syncing.
Enabled MSI support on iwn0.
Raised the number of interrupt sources per amd64 CPU from 32 to 64.
Added mksubr to kdump(1). It permits to generate flags to name translation. Not yet usable.
Enabled MSI on newish em(4) PCIe hardware.
Limit ntpd(8) stratum to NTP_MAXSTRATUM.
Added cnmac(4/OCTEON) ethernet driver.
Freed apm(4) on macppc from its dependencies on adb(4/MACPPC).
Prevent sdmmc(4) from responding to VPD inquiries with standard inquiry data.
Stopped providing a bsd.scsi3 kernel on sparc. On a system with multiple disks and SCSI id#3 as the boot device, one must use DUIDs to mount its file systems.
Added following certs in OpenSSL: Go Daddy Secure Certification Authority/serialNumber=07969287, Equifax Secure Certificate Authority, VeriSign Class 3 Public Primary Certification Authority - G5, Entrust Certification Authority - L1C, Entrust.net Secure Server Certification Authority.
Added support for ZTE AC2746 in umsm(4).
Set RL_FLAG_INVMAR for re(4) RTL8105E/RTL8401E/RTL8168E VL so multicast will work and add PHY wake up code for RTL8401E.
Work in progress to have a working --static in pkg-config(1).
Fixed PR6601 in isakmpd(8).
Simplified the way pkg_create(1) handle transparent formatting of manpages.
Added to ip(4) stack IP_RECVRTABLE socket option to be used with a IPPROTO_IP level that allows one to retrieve the original routing domain of UDP datagrams diverted by the pf via "divert-to" with a recvmsg(2).
Added various mpath(4) improvements.
Improved acpitz(4) critical messages.
Make ix(4) schedule a timeout to keep trying until it gets some mbufs if the system runs out of them and cannot provide any when filling the rx ring.
Make sure ssh(1) key_parse_public/private_rsa1() no longer consumes its input buffer. Fixes ssh-add(1) for passphrase-protected ssh1-keys.
Make find(1) exit if there is an unknown option.
Make fr.dvorak kbdtype select the bepo xkb layout in xf86-input-keyboard.
Fixed pkg-config(1) version comparison, and added back 'rc' support.
Make pci(4) do a DIAGNOSTIC panic into returning failure for devices like parts of the NVIDIA C51 chipset which have a broken capabilities list.
Unbreak nsd(8) build with MANPS.
Added check for empty files in pkg-config(1).
Updated ix(4) to a state near of what's in FreeBSD. Fixes a lot of bugs.
Make rc.d(8) "rc_cmd start" return the code whether the daemon started successfully or not.
Prevent wdc(4) from setting the dying flag in wdc_wait_for_status, since there is at least one chip that spuriously returns failure.
Removed rdconfig(8).
Prevent sysctl(3) from copying the first octet of the source IPv6 address where the destination address should be, fixes broken fstat output for v6 socket connections.
Added 'relay as' and 'relay via as' rules to allow smtpd(8) to rewrite the user part, the domain part or the entire address of the sender at the SMTP session level. this is not masquerade but allows smtpd(8) to communicate with hosts that do a check of SMTP sender fqdn.
Make lint(1) accept and ignore -M so one can pass the same CPPFLAGS to lint(1) and cpp(1).
Make MSI interrupts work in pci(4) too.
Made several improvements in vax strtof(3).
On ARM, make GCC generate code which uses OpenBSD own fabs(3), fabsf(3) and fabsl(3) calls as they are correct and faster.
Make acpi(4) use static scope during AML disassembly to fix an error.
Updated xterm to version 270.
Make use of macppc macobio_* methods to manage the i2s GPIOs, removed the customs gpio_* methods and moved the remaining global variables in the softc.
Fixed a device reference leak in st(4) read and write routines by making them work like their cd(4) and st(4) equivalent.
Prevent pkg-config(1) from parsing the requirements for a module if only modversion or printprovides are requested.
Fixed pkg-config(1) PKG_CONFIG_LOG as the first argument to beautify_list() was incorrect.
Back out uvm(9) vmmap in order to repair virtual address selection algorithms outside the tree.
Use kernel malloc(9) and kernel stacks into non-dma memory.
Prevent memconfig(8) from opening /dev/mem to print the help.
Set sparc64 FEF bit in the %fprs register when handling an fp_disabled trap from userland. Prevents userland applications from trapping forever on the next floating point instruction executed after clearing this flag. Fixes issues with threaded applications, since our pthreads library clears the FEF bit under some circumstances.
Added preliminary steps for 'alpha' and 'beta' versions with pkg-config(1). Bumped version to 0.25.
Removed pcn(4) from RAMDISK kernel.
Added microphone mute button support from acpithinkpad(4). Not all audio(4) devices are yet supported.
Reverted amd64 uthread_machdep.c to version 1.4: if gcc(1) picks a memory operand for the asm then 'movl' will result in an assembler error. This file is currently no more compilable with llvm-clang.
Updated alpha bootblocks to use machine-independent loadfile code.
Fixed mpu attachment at isapnp(4).
Moved the bufcachepercent setting code to machine-independent locations.
Dropped kernel support for the useless DIOCWLABEL ioctl and prune a lot of silly flag twiddling code in various disk drivers.
Disable MSIs when appropriate in amd64 machine-dependent PCI routine pci_intr_disestablish().
Fixed format string in newfs(8).
Fixed an unaligned access panic with cmpci(4) on sparc64.
Prevent i386 machine-dependent code to calculate bufpages since it's done later in machine-independent bufinit().
Added a respawn-pane command to tmux(1).
Fixed function names in softraid(4) crypto discipline debug printfs and use a more user-friendly error message if the key disk cannot be opened.
Make amd64 direct MSIs at the appropriate CPU.
Fixed two compile errors in mcd(4/I386).
Make sure libsndio send the initial clock tick.
Allow aucat(1) device encoding to be set if -u is also used.
Fixed em(4) em_write_pci_cfg() and em_read_pci_cfg() to avoid unaligned access, and make em_write_pci_cfg() do a proper read/modify/write cycle, to avoid changing the neighbouring 16 bits. Also removed the comment in em_pci_set_mwi() and em_pci_clear_mwi(); writting 0 to the status bits in the command/status word is the right thing to do. Fixes a panic on sparc64 and other strict alignment architectures.
Reorganize the way aucat(1) command line options are parsed and stored.
Protect errno from damage in bc(1) signal handler.
Make ^D behave as it should in bc(1) when the cursor is at start of line after a ^C.
Improved current parent process ID checking in ssh-agent(1).
Prevent ssh(1) from preserving the command line from invoking ssh(1).
Make ssh(1) dynamic forward retry establishing the port forwarding after a small delay.
When checking to see if a pf(4) rule is referenced by any source-tracking nodes, actually check how many src nodes reference it, rather than checking the max_src_nodes for the rule which makes no sense.
Fixed crash in pf(4) ioctl(2).
Permit VMWare to put the latest 64-bit AMD multicore CPU behind a prehistoric Intel host bridge.
Fixed bug in acpi(4).
Improved vnd(4).
Fixed aucat(1) throttling while draining midi inputs.
Make sure data is drained on midi control ports when there are no more inputs.
Enabled MSI in azalia(4) and wpi(4).
Updated libXaw to version 1.0.9.
Improved bc(1).
As they don't require big lock, mark gettimeofday(2), clock_gettime(2), clock_getres(2), nanosleep(2), issetugid(2) with NOLOCK. syscall(9) sys_getpid() isn't really NOLOCK safe, as the compat bits inside it require the p_pptr member to stay valid.
Make sure in autoconf(9) subroutines that the kernel don't try to reuse device unit numbers and make it check the device pointer array.
Make lint(1) take into account padding of LDOUBLE, LDCOMPLEX, LDIMAGINARY to prevent it from doing portability checks against a non-existent architecture.
Make lint(1) warn on empty non-compound selection statements, such as "if (foo);".
Make lint(1) tt_domain = 3 (complex), not 1 (real) for the complex types (COMPLEX, DCOMPLEX, LDCOMPLEX).
Update iceauth(1) to version 1.0.5, xauth(1) to 1.0.6.
Removed MesaDemos from Xenocara tree.
Enable by default 640x480 mode in pnozz(4/SPARC).
Make sd(4), cd(4), wd(4), rd(4) and vnd(4) return EBUSY if the user tries to modify an open partition offset or size.
Back out unreliable revisions on ssh(1) dynamic forward. Improved startup, and prevent races.
Force full reset always on inteldrm(4).
Removed the freelist member from struct vm_physseg in all architectures.
Prevent a gcc(1) optimization from losing sign in an optimization with -0 input in tanh(3).
Enabled MSI in ppb(4).
Added mmuagp, a driver for the AGP chipsets on early amd64 machines.
Added RADEON_CS ioctl support for r600 and r700. Enabled r600.
Enabled MSI in inteldrm(4). Disable it explicitly for i945g and i945gm.
Updated libXext to version 1.3.0.
Enabled MSI on selected i386 and amd64 pci(4) hardware.
Updated libx11 to version 1.4.3.
Enabled MSI for HyperTransport devices that have MSI remapping enabled in pci(4).
Added kthread_create(9) to the kernel threads routines.
Make printf-like and scanf-like functions marked as such in llib-lc.ln and llib-lwrap.ln databases; so that the lint(1) features doing format strings checks are enabled by default.
Trick lint(1) into recording the right prototypes in the llib-lc.ln database on platforms without extended-precision floating-point support.
Applied sendmail 8.14.5 errata 2011-05-26 patch.
Make Xenocara automatically set XkbOptions to "terminate: ctrl_alt_bksp" if not defined in xorg.conf(5).
Added subdir method to to extrainfo and pkgpath to get to pkgpath string. Allows normalization of pkgpaths.
Turned pkg_add(1) @pkgpath into real objects, to simplify some updates by not having to figure out what matches precisely.
Added dfs(4/MACPPC) driver to support the Dynamic Frequency Switching feature found on some laptops.
Update to sendmail(8) 8.14.5.
Support additional L2C variants and L1D (AR813x/AR815x chips) in alc(4).
Fixed reload support in relayd(8).
In pf(4), change 'set skip on <...>' to work with interface groups.
Various drivers have been adjusted to use PCI Message Signaled Interrupts on amd64, i386, macppc and sparc64.
In addition to relative resizing, allow absolute resizing of partitions in auto-allocated labels with disklabel(8).
New AMD K10/K11 pstate driver allows setperf and apm to change CPU frequences on newer AMD CPUs.
Allow specifying k/m/g/... suffixes in newfs(8) -S and -s options.
Fixed client and group cycle defines in cwm(1).
Disable pipex for L2TP on disconnect.
Unified various macppc gpio(4) access methods that take an offset relative to the mac-io bus base address. Needed for upcoming dfs(4/MACPPC) support.
Make ssh(1) use FD_CLOEXEC consistently.
Fixed arguments to arm pmap(9) pool_init: alignment of alignment of L2_TABLE_SIZE_REAL is at offset 0 and not at offset L2_TABLE_SIZE_REAL.
Make pci(4) pass flags down the PCI bus hierarchy.
Fixed type warnings reported by clang in smtpd(8).
Added pci(4) register definitions for PCI MSI capability.
Fixed wrong id for UDP_ENCAP_TRANSPORT_DRAFT in isakmpd(8).
Make ssh(1) warn on unexpected key type in key_parse_private_type().
Make calls to malloc(3) malloc_dump() safer by avoiding file pointer computation for stats.
Fixed some warnings in adduser(8).
Introduced leak detection code for MALLOC_STATS in malloc(3).
Fixed bug in glob(3).
Make dhclient(8) more friendly to sequential option processing by always starting DHCP packet options with DHO_DHCP_MESSAGE_TYPE. Improved working with Nortel NetIP DHCP server.
Cleaned up adduser(8) handling of email messages.
Pre-allocate memory in ipsec(4) package to avoid sleeping after performing a lookup, which may lead to a race.
Removed support for authorized_keys2, a relic from the early days of protocol V2, in ssh(1).
Stop leaking swapslots in uvm(9) when doing a uvm_km_pgremove and a page is in swap only.
Removed uvm(9) vm_page_lookup_freelist().
Prevent security(8) from complaining about a group(5) line with a single "+" as "wrong number of fields", that abbreviated syntax for NIS map of groups is explicitly allowed by group(5). Warn if this isn't the last line of group(5) though.
Fixed an off-by-one that made smtpd(8) skip an "invalid" bucket that was actually valid.
Implemented correct prologue and epilogue for hppa64 machine-dependent init.
Make mips common kernel code set octeon's internal counter clock speed to its processor clock.
Fixed aucat(1) option handling and enable TCP in midicat(1).
Make more silent ssh(1) debug() logs by detecting that it's trying to load a private key in key_try_load_public() and returning early.
Make pfsync(4) use timeout(9) timeout_del return value to check if the timeout is actually removed when undeferring a packet.
Make timeout(9) timeout_del able to tell the caller if it actually did remove a timeout or not.
Refactored queue allocation and initialization into wdc(4) wdc_alloc_queue() function, and let attachment code call this rather than malloc(9). This prevents re-initialization of the queue in shared queue chipsets.
Initialize the wdc(4) ata_drive_datas structures earlier in wdcattach() so that chip-specific drv_probe routines can assume they've already been initialized.
Added a wprintf(3) man pages.
Always free the multibyte->wchar conversion buffer allocated in vfwprintf(3) __mbsconv().
Make sndio(7) sio_psleep() use an array of SIO_MAXNFDS pollfd structures rather than a single one.
Initialize the 'pstate' field of the aucat(1) wav structure.
Make gdb(1) handle lazy relocation stubs as Linux does.
Started a work in ospfd(8) to support opaque LSA.
Make relayd(8) use the proc.c privsep API/commodity functions based on work for iked(8) and smtpd(8).
Fixed segfault in smtpd(8) newaliases after global env move.
Fixed a few minor issues in i386 hibernate support code relating to improper swap device determination and memory range calculation.
Make tmux(1) reset last pane on break-pane. Fixes a problem reported in Debian bug #622677.
Make tmux(1) reset last pane on swap-pane across windows. Fixes a crash.
Fix memory handling in octeon machine-dependent code.
Prevent tmux(1) from dragging on click, only select.
Fixed memory leaks in tmux(1) command capture pane.
Fixed a memory leak in tmux(1) commands if cmd_pane_session succeed.
Added a new option to tmux(1), mouse-resize-pane which, when on, allows panes to be resized by dragging their borders.
Make tmux(1) use the tsl and fsl terminfo(5) capabilities to update terminal title and automatically fill them in on terminals with the XT capability.
Eliminated a few unused wdc(4) capability flags (WDC_CAPABILITY_HWLOCK, WDC_CAPABILITY_ATA_NOSTREAM, and WDC_CAPABILITY_ATAPI_NOSTREAM).
Added a small memory optimization in fsck_ffs(8).
Improved tmux(1) behaviour when TTY allocation fails: if RequestTTY is set to 'auto' make it not treat a TTY allocation error as fatal and just restore the local TTY.
Fixed xf86-input-ws on xserver 1.9 and earlier.
Make sure sysmerge(8) handle first /etc/group and /etp/master.passwd in case it need to install files or directories with newly added user/group ownerships.
Enabled xf86-input-synaptics on i386 and amd64.
Simplified physio(9) thanks to the fact that buffers now come out of a pool rather than a global list of statically allocated structures and aren't shared.
Added support to new wscons(4) ioctl WSMOUSEIO_SETMODE in xf86-input-synaptics.
Introduced a 'freeze' flag in tmux(1) which make it ignore any move or resize requests made on the windows it's applied.
Removed uvm_pglist.h from the tree.
Updated xf86-input-acecad to version 1.5.0, xf86-video-chips to 1.2.4, xf86-video-vmware to 11.0.3, xf86-video-siliconmotion to 1.7.5, xlsclients to 1.1.2.
Added a RequestTTY ssh_config(5) option to allow configuration-based control over tty(4) allocation, like ssh [-tT].
Make ssh_config(5) support negated host matching.
Added a %L expansion (short-form of the local host name) for ssh(1) ControlPath.
Set ssh(1) traffic class for IPv6 traffic as it's done for IPv4 TOS. Fixes bz#1855.
On cwm(1) map, prevent it from warping the windows that are marked as ignored.
Make ubsec(4) interrupt routine acknowledge only the interrupts it can process.
Make sure amd64 AES session id checks look at the lower 32 bits of crp_sid.
Make sysmerge(8) create the directory holding the link it's about to create if it does not exist.
Force loopback interfaces to IF_STA_LOOPBACK in ospf6d(8).
Fixed memory leak in ssh(1). Fixes bz#1849.
Make hppa64 gateway page accessible to all userland processes.
Put back cwm(1) window resize back to 60 Hz.
Reverted atapiscsi(4) to only attempting on IDENTIFY command against directly attached devices as in the pre-port-multiplier code.
Make the "mute" key work on macppc keyboards.
Make urndis(4) attach to Samsung Galaxy S.
Added disklabel(8) support in tunefs(8).
Make cwm(1) menu window aware of xinerama(3) info.
Keep synaptics touchpad to the current wscons(4) behaviour until WSMOUSEIO_SETMODE ioctl is issued to switch to synaptics mode.
Make sure hppa64 restore sr4 at the very end of locore.S to avoid further loads from the trapframe to be done at the wrong address space.
Make tftp-proxy(8) use 'divert-to'.
Make malloc(3) start scanning the bits of the chunk at a random position to take the first available free slots instead of starting from position zero and skipping a random number of free slots. Make things faster.
Updated relayd(8) logging and debug functions to use the C99 __func__ macro instead of static function names.
Allow a user to specify relayd(8) root priority.
Fixed check of errors in bgpd(8) sessions.
Make ssh(1) gracefully fall back when ControlPath is too large for a sockaddr_un.
Make atactl(8) capable of reading disklabel(8) UIDs.
Allow ssh-add(1) to read key from standard input with ssh-add - .
Make iscsid(8) handle logins more correctly.
Make scsi(4) skip leading blanks and collapse multiple white spaces into when when printing scsi device ids.
Prevent smtpd(8) from fork-bombing on startup when there are lots of mails in the offline queue by using a wait list to keep the number of forked processes below a reasonable limit when enqueueing.
Make tmux(1) change window with mouse wheel over status line if mouse-select-window is on.
Prevent use of strnvis(3) in tmux(1) title as it breaks UTF-8.
Make tmux(1) check if mouse-select-pane is on, not off when setting mouse flags.
Collapse mbuf(9) m_pullup and m_pullup2 into a single function.
Fixed macppc volume keyboard keys.
Cleaned up gotos in TCP input listening sockets to make it obvious when packets are dropped and when normal program flow occurs. Changed error return value of syn_cache_add() from 0 to -1 in order to clearly communicate intent.
Added a zlib.pc pkg-config(1) file.
Gave more room to hppa64 kernel stack.
Make hppa64 properly save and restore the space registers to/from the trap frame.
Make aucat(1) determine the default device in backend code instead of common code.
Moved softraid(4) SLIST initializations earlier so that failure handling paths can safely use them.
Make aucat(1) in server mode listen on all addresses when given '-' for address.
Fixed problems when there is an endian differences between aucat(1) server and client.
Make aucat(1) set the TCP_NODELAY option for TCP connections.
Fixed bad return value check in OpenCVS.
Fixed string containing state names used for debug printf() in aucat(1).
Fixed potential NULL dereference in ioprbs(4), ray(4), IPv6 fragmentation code and output routines.
Prevented myx(4) from checking malloc(3) return values against NULL as M_WAITOK is used.
Added libdrm_radeon to the system libraries.
Make radeon(4) use the r600 driver for r600+ chipsets, not r300. Should stop annoying errors for GL on r{6,7}00 chipsets.
Added PCI-Cardbus bridges and the most popular PCMCIA and CardBUS drivers to sgi GENERIC and RAMDISK kernels.
Make hppa handle userland pmap(9) mapping on unmanaged pages better.
Fixed em(4) 82578DC from only being able to negotiate at 10baseT.
Make the network stack recognize SO_RTABLE socket option (getsockopt(2), setsockopt(2)) at the SOL_SOCKET level.
Make iked(8) active SA lookup via policy work for NAT traversal.
Added a workaround for an em(4) 82579 hardware bug that can result in lost rx packets between the mac and phy.
Reworked iscsid(8) logout code.
Reworked and improved iscsid(8) logout.
Fixed counting of interrupts for devices that attach to elroy(4/HPPA).
Updated inteldrm(4) to the one contained in libdrm 2.4.23 for the ddx update and to stop mesa 7.9.2 crashing.
Copied glxinfo(1) and glxgears(1) sources from Mesa Demos.
Fixed NULL dereference if inteldrm(4) fails to attach.
Splitted sudo(8) ALL, ROLE and TYPE into their own actions.
Fixed reload issue with changing network statements.
Make bgpd(8) free cname and rcname on exit.
Make sure to cast mips64 physmem to a 64-bit type before passing it to ptoa().
Make pppoe use gid_t for setgroups().
Make asa(1) return > 0 when file is not found.
Make sh internal serial driver use cons_decl() instead of its own cn* prototypes.
Plugged holes in sparc and vax cdevsw[] to make vscsi(4), diskmap(4) and pppx entries match numbers in comments and the MAKEDEV majors.
Improved malloc(3) scanning for free chunks without losing any randomization.
Make gcc -02 raise an underflow exception on m88k to prevent incorrect optimizations in floating-point environments.
Improved sudo(8) netmask regexp.
Fixed gre(4) strange problems seen on directly connected tunnels.
Make softraid(4) only handle vanilla scsi inquiry requests and reject VPD requests since they are not handled.
Fixed carp(4) IPv6 only setups.
Make tmux(1) redraw only the status line on command update and not the entire client.
Explicitly pass the rdomain to tcp_respond() to prevent a RST from being sent on rdomain 0 in certain failure cases.
Prevent SCSI devices from inheriting the adapters addresses on fc fabrics.
Make iscsid(8) try to schedule a new task for the connection in conn_task_cleanup().
Make sure vscsi DATA OUT operations are piggibacked on the same connection as the initial SCSI REQUEST.
Enabled floating-point environment in all archs.
Bring back fwprintf() in libc and in gcc4 libstdc++.
Improved and cleaned floating-point environment.
Make mpath(4) retry commands in iscsid(8) when it comes back.
Make IPv4 in_broadcast() rdomain aware.
Fixed boot hangs due to usb(4) abuse of kthread_create_deferred(9).
Allow SOCK_DGRAM sockets sockets to be bound to the local network broadcast addr in TCP/IP PCB and raw IP functions.
Implemented a new authentication method allowing aucat and midicat to work over TCP.
Switched ftp-proxy(8) over to divert-to instead of rdr-to.
Fixed some off-by-one errors in atapiscsi(4).
Make acpithinkpad(4) attach to newer Lenovo models like the x120e.
Default gcc(1) on alpha to -mfp-rounding-mode=d, for code which assumes the rounding mode is always controlled by fpsetround(3).
Added toggable verbosity to iscsid(8).
Simplified ioprbs(4) scsi_xfer handling.
Make aucat(1) use more volatile sig_atomic_t in signal handler.
Added hds(4) a driver for Hitachi Modular Storage SCSI devices.
Prevent i386 from explicitly enabling an interrupt before returning from an interrupt.
Added support for rooting off multipath disks in sparc64.
Added support for Intel 6 series SATA in non RAID, non AHCI mode.
Fixed du(1) output for directories larger than 1 TB.
Added preliminary FSM support in iscsid(8).
Make mpath(4) use DMA safe memory when talking to devices.
Fixed envy(4) interrupt handler if it's shared with other pci devices.
Prevent mpi(4) from trying to issue SCSI commands against a target where it failed to get the RAID headers.
Make mpi(4) configure fc controllers to fail io as fast as possible when cables are yanked.
Make mpath(4) retry the IO down another path when a path returns XS_SELTIMEOUT.
Make mpi(4) nicer with mpath(4) when unplugging it from paths.
Make mpi(4) scanning of fibre channel ports match the way Linux does it.
Set UVM_FLAG_FIXED in sparc, sparc64 and vax.
Make dpt(4) use iopools.
Make ipsec(4) ipsec_input() pass IPv4 or IPv6 packets to the correct raw ip input function if ipsec(4) is disabled.
Added floating-point environment for mips64.
Make gcc default to -mpf-rounding-mode=d on alpha.
Make dpt(4) compile on 64-bits arches.
Allow the root device to be identified by its disklabel(8) UID on amd64 and i386.
Make trm(4) use iopools.
Added FPU emulation option to octeon.
Added floating-point environment for powerpc and sparc.
Teach sysconf(_SC_GETGR_R_SIZE_MAX) the correct size of a buffer for the reentrant getgrent(3) functions (getgrgid_r, getgrnam_r).
Removed svnd backward compatibility from vnd(4).
Updated xf86-input-vmmouse to version 12.7.0.
Make xf86-input-usbtablet handle obsolete X{alloc,free,realloc) functions.
Adapted xf86-input-usbtablet to revision 12.
Prevent dump(8) from using stdio in the SIGSEGV handler.
Fixed worms(6) "-d delay" option.
Update timezone to tzdata2011g from elsie.nci.nih.gov.
Fixed bug in ioprbs(4).
Allow commands like "route add 0.0.0.0/1 $SOMEHOST" to work correctly, previously they operated on the default route.
Prevent pkg_add(1) from erasing first man page in case two man pages have the same name.
Provided #h for short hostname (no domain) in tmux(1).
Make tmux(1) copy behaviour in vi mode slightly more like vi(1).
Make azalia(4) detachable and prevent constant interrupts when the device isn't used.
Merged GNU binutils 2.17.
Make a double link between pf(4) states and sockets.
Prevent mandoc(1) from breaking lines right before numbers, as Groff does.
Updated xf86-input-ws to revision 1.3.0.
Merged mandoc(1) version 1.11.1. Mostly cleanup and maintenance.
Added C99 floating-point environment in sh.
Make ahci(4) get the error ccbs state right for a put when a port is empty. Fixes noise during boot.
Enforced correct types in relayd(8).
Updated xorg-docs to version 1.6.
Removed support for very old ffson-disk formats from fsck_ffs(8).
Make radeondrm(4) match HD5450.
Make umsm(4) match Sierra USB305.
Prevent chio(1) and mt(1) from opening the 'c' partition on on devices that don't have one.
Implemented C99 floating-point environment for alpha, arm, i386 and sparc64.
Make hppa stop calling shared interrupt handlers as soon as one of them return 1 (positive interrupt was for me), like it's done on other architectures.
Prevent i386 kernel code or read only data to be writable by ddb(4). Only enable write for ddb(4) in the page table entry temporally.
Enabled the SIGWINCH handler in ncurses.
Added FE_DENORMAL to amd64 C99 floating-point environment.
Fixed sticky flags in hppa64 fpsr.
Make sysarch(2) available for userland in alpha.
Improved security(8) report of devices or setuid files owned by a nonexistent user or group.
Prevent vnd(4) from being opened for write in both simple and non-simple mode.
Fixed bug with autovivification in security(8).
Make traceroute(8) only print changed TOS in returned packets when -t is set.
Updated xf86-input-keyboard to version 1.6.0, xf86-input-mouse to 1.7.0.
Make beagle start at high ipl.
Make isakmpd(8) indicate which side of the connection responded during phase 1 while using -v.
Fixed uninitialized variables and formatting strings in acpi(4).
Prevent amd64 and i386 from printing irrelevant PCI interrupt line programmed by the BIOS for APIC interrupts.
Fixed sticky flags in hppa fpsr.
Added support for PCH2 (Sandy Bridge) MAC with em(4) 82579 PHY.
Moved the rc.d(8) bits from rc.{local,shutdown} directly into /etc/rc. By default, rc.{local,shutdown} don't output anything anymore.
Merged version 1.10.10 of mandoc(1): mainly cleanups and maintenance version.
Added C99 floating-point environment to adm64 and hppa.
Speed up softraid(4) XORP and XORQ operations in RAID6.
Fixed sgi dma_constraint upper limit computation.
Make sgi print memory sizes as longs.
Make sgi use 64 bit integer to compute IP35 memory ranges.
Make nsd-zonec(8) less verbose in nsdc(8) runs.
Improved sysmerge(8) detection of obsolete files.
Added a filter-routes option to snmpd.conf(5).
Added many improvements to hppa64 machine-dependent code.
Prevent apmd(8) daemon from hiding to the user it failed.
Fixed some long versus 64 bit type mismatches.
Make ahci(4) reserve its own ccb.
Make find(1) return exit code 1 if any path could not be traversed, as told by POSIX.
Fixed multibyte characters length mesuration in citrus.
Updated xf86-input-ws to version 1.3.0: API compatibility with Xserver 1.10, sync build system with other Xorg input modules.
Updated x11proto to version 7.0.21, xf86-input-keyboard to 1.6.0, xf86-input-mouse to 1.7.0, xorg-docs to 1.6.
Make awk(1) store the old seed when srand() is called and use it as the return value, as told by POSIX.
Fixed bugs in rint(3).
Fixed potential NULL dereference in compat_linux(8).
Make OpenCVS diff use -u when its context is 3.
Implemented correct prologue and epilogue for hpp64 machine-dependent initialization.
Added perl security fix for CVE-2011-1487.
Enhanced sysmerge(8) output.
Fixed return value in arc(4) interrupt handler.
Removed Potential NULL dereference in amd64 AES, amd64 and i386 VIA machine-dependent code.
Added support for Intel GM45 SOL in puc(4).
Prevent vr(4) from disabling interrupts in the isr before enabling them again when leaving.
Make gdt(4) use iopools.
Simplified umass(4) devid generation.
Make midi keyboards work with macppc.
Fixed potential null dereference in pf(4) ioctl, ahd(4).
Fixed dead assignments in spdmem(4).
Fixed dead store in wscons(4).
Removed UUCP special directory permission.
Automatically enter copy-mode in tmux(1) when mode-mouse is on and the mouse is dragged or its wheel is used.
Disabled mvme88k 88110 branch prediction logic on all revisions.
Fixed uname(3) return value check in tmux(1).
Added missing call to pmap_update() in uvm(9) km_alloc().
Make uvm(9) kernel memory free the correct pages when virtual addresses failed to be allocated.
Fixed type error in an amd64 vector.S comparison.
Make the IPv4 stack use an RB tree for local address lookups.
Include USB vendor and product ids in umass(4) when manufacturing a unique disk id from a USB serial number, as recommended by the umass spec.
Changed pool(9) constraints to use kmem_pa_mode instead of uvm_constraint_range. Use km_alloc(9) for all backend allocations in pool(9) and for the emergency kentry allocations in uvm(9) uvm_mapent_alloc. Garbage collect uvm_km_getpage, uvm_km_getpage_pla and uvm_km_putpage.
Fixed type bug in rdist(1).
Added Perl security fix for CVE-2011-1487: ucfirst(), uc() and lc() forget to set the tainted flag if input was marked as tainted.
Make sure the mouse should only work in copy mode for tmux(1) if mode-mouse is set, not just mouse-select-pane.
Added an option to tmux(1): mouse-select-window. It allows the mouse to be used by clicking on the status line.
Changed kernel pool constraints to us kmem_pa_mode instead of uvm_constraint_range; use km_alloc(9) for all backend allocations in pools; use km_alloc(9) for the emergency kentry allocations in uvm_mapent_alloc; garbage collect uvm_km_getpage, uvm_getpage_pla and uvm_km_putpage.
Prevent rc.local from printing 'starting local daemons' if rc_scripts is empty.
Updated Test::Simple(3p) to version 0.98.
Deprecated vnds in favour of svnds.
Removed the old style by-pass-the-buffer-cache vnd(4) code. This will treat vndX the same as svndX.
Make rdist(1) print size_t with %zu and ssize_t with %zd in error/debug output.
Improved the iked(8) acquire mode peer, policy matching.
Added support for "acquire mode" from iked(8) static flows.
Updated List::Util(3p) to version 1.23.
Fixed a sysmerge(8) bug where OBSOLETE_FILES would contain only the last appended occurrence. Display OBSOLETE_FILES on stdout.
Modify bnx(4) interrupt handler so it only processes the rings once rather than looping over them until it runs out of work to do.
Run the ppb(4) interrupt handler at IPL_BIO.
Make pciide(4), wdc(4) and wd(4) watch for wdc(4) registers returning 0xff which probably means the controller is dead.
Packed ssh-keygen(1) certificate options in lexical order of option name.
Prevent scsi(4) devices from attaching if mpath(4) is disabled in config or ukc.
Allow graceful shutdown of ssh(1) multiplexing: request that a mux server removes its listener socket and refuse future multiplexing requests.
Switched from the old shell script /etc/security to the new Perl script security(8).
Enabled disklabel(8) UID version of fstab(5) by default on install media.
Added Wake on LAN support to xl(4).
Fixed an assertwaitok panic in sppp(4).
Prevent ath(4) from increasing if_oerrors for every multicast frame leaving the interface.
Prevent dhclient(8) from warning on unknown DHCP server options unless asked to reject leases with unknown options.
Fixed a possible division by zero if a server sends dhclient(8) a broken option.
Added -t to tmux(1) list-clients.
Fixed tmux(1) character position check.
Make uvm(9) construct a better path to the swapdevice.
Fixed lround(3) bugs similar to lrint(3).
Allow the user to interrupt hppa boot procedure before booting the default kernel as on most architectures.
Added swap partition entries to disklabel(8) -F and -f output.
Moved the hppa64 FPU state out of hppa64 'struct pcb' like on hppa.
Initialize hppa %cr30 for proc0 with the address of proc0 fpstate.
Make nextafter(x, y) return y if x equals y.
Improved fsck_ffs(8) speed.
Use "aucatN" for aucat(1) socket path and "midicatN" for midicat(1).
Added '-F' to disklabel(8). It is the same as '-f' but uses DUIDs when writing the mount point information to the specified file. After every label write, read the label to get current UID info.
Removed the AMSG_GETCAP message from the aucat(1) protocol.
Make aucat(1) audio and midi(4) backends share the same code to communicate with the server.
Allow isakmpd -v (verbose logging) to work if any -D option is supplied.
Make rc(8) output 'starting standard daemons:' to be consistent with the rest.
Prevent all archs kernel machine-dependent disk(9) subroutines from copying, pasting errors by using 'R(<buf>->b_flags, B_READ | B_WRITE | B_DONE)' regardless of what the previous IO was.
Initialize bha(4) variables before use.
Improved uvm(9) pager.
Removed a wrong test in hppa longjmp.
Improved uvm(9) uvm_pageinsert().
Make wdc(4) skip waiting until active channels see their busy bit cleared.
Hunt drivers returning incorrect interrupt handlers.
Make smtpd(8) reprocess the ramqueue when an envelope is reinserted into the ramqueue after a trip to MDA or MTA.
Implemented smtpd(8) disk-queue layout in walk_queue().
Removed message_id and message_uid from smtpd(8). It now has an evpid associated to each delivery message, the evpid is an u_int64_t where the upper 32 bits are the msgid, and the 32 bits are the envelope unique identifier for that message.
Make sure iswctype(3) wcwidth() return -1 if the character is not printable. Adapt file(1) to this behaviour.
Removed dead assignments from ix(4) IPv6 Multicast Listener Discovery.
Prevent all kernels disk(9) subroutines from modifying flags used by the buffer cache.
Silence daily(8) errors in the temporary directory cleanup process.
Converted the kernel Makefiles to autogenerate dependencies during compilation using the -MD option to cc(1), with -MP, -MT, and -MF where needed, converting "make depend" to a no-op. This increases parallelism when using "make -j" and keeps the dependencies up to date with each compilation automatically.
Implemented -MP, -MT and -MF options in gcc(1) so all platforms can support so-called "advanced automatic dependency generation".
Added fsqueue_message_create(), fsqueue_message_commit() fsqueue_envelope_create() and fsqueue_message_purge() to new smtpd(8) queue API and removed queue_hash().
Added support for VIA VT6415 and VX900 IDE to pciide(4).
Make smtpd(8) use the new fsqueue API everywhere it needs a file descriptor.
Added fsqueue_message_fd_r() and fsqueue_message_fd_rw() to smtpd(8) to obtain a read-only and read/write descriptor to the message file.
Added RTL8401E, RTL8102EL, RTL8105E, RTL8168E/8111E-VL to re(4). Corrected definition of RTL8103E.
Added support for clarkdale Integrated Graphics Device in vga(4).
Prevent newsyslog(8) from compressing wtmp by default.
Added fsqueue backend to smtpd(8). It will implement a filesystem queue.
Make hppa locore.S spstrcpy work.
Removed pcb_uva from hppa64.
Reduced call to wskbd(4) update_leds() to what is necessary.
Fixed hppa64 locore.S copy_on_fault by decrementing the stack pointer before restoring the return pointer.
Make hppa64 bcopy.S and spcopy.S use 64-bit operations for address manipulation.
Correctly load p_addr and avoid trashing the source address in hppa64 bcopy.S and spcopy.S.
Modified sis(4) interrupt handler so it only processes the rings once rather than looping over them until it runs out of work to do.
Make softraid(4) sr_raid_start_stop() ignore SCSI start/stop: a softraid(4) displine should always reflect the correct status.
Make smtpd(8) use a ram-queue instead of doing a continuous walk on disk-queue.
Make spstrcpy() work as it should in hppa64 locore.S.
Enabled siop(4), scsibus(4) and sd(4) in hppa64 GENERIC kernel.
Removed noisy debug code from hppa intr.c.
Make ipsecctl(8) dump PFKEY in hexadecimal.
Fixed sasyncd(8) with NAT/T by making PFKEYv2 export udpencap state of SA to userland.
Fixed READ/WRITE confusion in bnx(4).
Added support for per-rthread base-offset for the %fs selector on amd64. Added pcb_fsbase to the PCB for tracking what the value for the thread is, and ci_cur_fsbase to struct cpu_info for tracking the CPU's current value for FS.base, then on return to user-space, skip the setting if the CPU has the right value already. Non-threaded processes without TLS leave FS.base zero, which can be conveniently optimized: setting %fs zeros FS.base for fewer cycles than wrmsr.
Replaced NULL by 0 in sparc64 console initialization.
Modified ix(4), em(4) interrupt handler so it only processes the rings once rather than looping over them until it runs out of work to do.
No longer special-case NULL as a long for kernel and bootblocks.
Replaced NULL by 0 in vme(4/MVME88K).
Fixed uninitialized variable in ccd(4).
Avoid kvm(3) starvation in UFS because of softdeps waiting on too many mapped buffers and consuming all the available kva mapping buffers.
Make mount(8) work when the device is provided as a disklabel(8) UID.
Enabled sosplice(9) in relayd(8) for TCP.
Put the accepted socket of a diverted connection into the routing domain of a connection originator in TCP input. this allows one to query the source rdomain with a SO_RTABLE socket option.
Make sshd(8) exit with 0 instead of 255 on SIGTERM. Fixes bz#1879.
Fixed -Wshadow in ssh-keygen(1).
Prevent as(1) from using NULL for scalar type assignments in vax atof().
Fixed SPL handling when PCDISPLAY_SOFTCURSOR is enabled in pcdisplay(4).
Allow man(1) to find the ports/infrastructure manpages by default.
Added -s option to detach all tmux(1) client attached to a session.
Make Xenocara video(1) use VIDIOC_ENUM_FRAMEINTERVALS to get the supported frame intervals and display the frame rates if at least on -v is used. Added new option -R to disable frame rate adjustment and display the frame rates if at least on -v is used.
Make uvideo(4) use VIDIOC_ENUM_FRAMEINTERVALS to get the supported frame intervals.
Make uvideo(4) calculate frame data sizes for uncompressed formats instead of believing the hardware (prevent from hardware returning bogus information); make it skip under-sized and over-sized frames; make it check it's using the right parameters.
Make new security(8) format the "Block device changes" as it was.
Fixed logical bug in dvmrpd(8).
Fixed a vi(1) display glitch leading to crash.
Merged viaenv with viapm(4) added support SMBus for VT82C596, VT82C596B, VT82C686A, VT8231 and ACPI timer for all VIA South Bridges.
Added support for Zaurus in xkeyboard-config.
Prevent azalia(4) from touching hardware in the detach path when its already gone, but azalia_pci_detach is called if the device could not be initialized.
Updated xkeyboard-config to version 2.2.1.
Extended amd64 pci(4) memory address space to 36-bit.
Allow rdist(1) to handle files larger than 2G. Fixes PR6586.
Added support for wscons(4) in Xenocara.
Fixed bugs in lrint(3).
Replaced NULL by 0 in installboot(8/SPARC64) and in sgi, mips64 machine-dependent code.
Implemented remaining checks in the new security(8).
Make amd64 bus_space use a 32 bit I/O port value since 64 bits isn't possible in practice.
Replaced NULL by 0 in sgi boot.
Repaired a 32-bit truncation in mips64 paddr_t calculation. Fixes Origin 350 boot.
Bumped tmux(1) buffer-limit default to 20.
Make dhclient(8) ignore obsolete option 33 (static route) that was broken.
On m68k, m88k and vax cerror.S WEAK_ALIAS does an implicit _C_LABEL().
Fixed issues with tabulation and space handling in rc.subr(8).
Replaced NULL usage in non-pointer context by 0 in pthreads(3).
Imported xf86-input-synaptics in Xenocara.
Make tmux(1) use sitm for italics instead of smso if the terminal supports it.
Make amdiic(4), amdpm(4), ichiic(4) and piixpm(4) use unique wait channels.
Make sure mfi(4) upper 32 bits are always written to instead of assuming it is 0.
Use dma_alloc in mfi(4) transient management commands.
Fixed type of a_syms in nlist(3): it's an int, not a pointer.
Make sure aucat(1) socket reorder its outgoing messages.
Prevent ld.so(1) from doing integer comparison with NULL in alpha parts.
Fixed a dma_free() in wd(4) ATA parts.
Fixed softraid(4) raidp/raid6 to make them work with new iopool code.
Make Xenocara override the new fonts auto-detection code in util-cf-macros.
Prevent ports using imake(1) from breaking.
Fixed device names in acpitz(4) acpitz_setfan() printf messages.
Make hppa64 syscall_return work.
Avoid truncating values in mips64 pmap(9) format strings.
Make sure the ALIGN() macro uses u_long on all platforms for consistency.
Make sendmail(8) localhost.cf the same as the prototype but listen on the loopback interface instead of all interfaces.
Avoid to use NULL in integer comparison in various places, as bios(4/AMD64), pxaudc(4/ZAURUS), pxammc(4/ZAURUS), hp300 wscons(4), astro(4/HPPA), hppa64 astro, bios(4/I386), vme(4/MVME88K), mkbc(4/SGI), sparc64 pmap(9), mbus(4/VAX), adw(4), fxp(4), sti(4), isapnp(4), inteldrm(4), malo(4), uath(4), uhts(4), routing sockets, sd(4) and uvm(9).
Avoid using an uninitialized variable when downgrading PIO mode on pciide(4) ITExpress chipsets.
Synchronized hppa64 apic code with hppa.
Moved aha(4) to iopools.
Added support for divert-to which provides some benefits over rdr-to in relayd(8).
Prevent passing uninitialized variable to uvm(9) uvm_km_free().
Added initial interrupt handling implementation for hppa64.
Make sd(4) more silent.
Changed tmux(1) -t option: an empty session name means the current sessions, empty session names and those containing a colon will be forbidden when they are created.
Make attaching decision of acpivideo(4) be based on the same methods than other ACPI drivers.
Prevent mbuf(9) from looping endlessly because of IPcomp-quine or IPcomp-IPIP-IPcomp.
make ra(4/VAX), mtc(4/VAX) use bdev_decl() to get block device function prototypes.
Fix bug in m88k trap to allow a sanity check in m88110_syscall() to be triggered.
Make rc.subr(8) print a fail message if reload fails.
Synchronized hppa64 cpu_match() and cpu_hardclock() with hppa.
Fixed installboot with softraid(4).
Moved ips(4) to iopools.
Put in the infrastructure for OpenBSD/arm gcc4 support. Not working yet.
Added a new serial devid type for scsi(4) devices.
Moved hppa64 CPL to struct cpu_info.
Make callers of machine-dependent disk subroutines check return value against 0 instead of NULL.
Make scsi(4) unconditionally print scsi device IDs instead of just when mpath(4) is enabled.
Allow pf(4) to filter on the rdomain a packet belongs to.
Make traceroute(8) with type-of-service setted (-t) display a message if the returned packet has a different tos type.
Defined NULL as a void pointer instead of a long integer, as required by Single Unix. ppp(8), procmap(1), rtadvd(8), user(8), ypldap(8). Use 0 for integers and '\0' for chars instead.
Removed NULL usage in non-pointer context in keynote(3), usbhid(3), ld.so(1), atactl(8), isakmpd(8), modload(8), mount(8), cdio(1), ipcs(1), kdump(1), mail(1), netstat(1), oldrdist(1), rpcgen(1), tmux(1), xstr(1), config(8), dvmrpd(8), httpd(8),
Fixed type error in httpd(8) proxy_ftp.
Make rc.subr(8) remove leading and trailing spaces from daemon_flags.
Allow softraid crypto discipline to work with bigmem.
Make softraid(4) handle bigmem for metadata reads and writes.
Make scsi(4) enquire against dmaable memory.
Make siop(4) dma safely to the xs->sense buffer.
Fixed test in uvm(9) in uvm_pmr_rootupdate().
Make space and tab the same for roff(7) on .de macro lines, after the new macro name.
Fixed a buffer cache bug in vfs(9).
Replaced a wrong logical or by a binary or in uticom(4).
Make pf(4) pf_check_proto_cksum() considering packets with the CSUM_OUT flags set to be ok.
Make IPv4 stack do an ICMP checksum if M_ICMP_CSUM_OUT is set.
Define M_ICMP_CSUM_{OUT,OK,BAD} in mbuf(9) header.
Prevent em(4) from using em_reset_hw() I/O space on hardware that doesn't handle it.
Added wd_hibernate_io(), a standalone disk I/O writer which tries to not damage kernel memory to wdc(4) and wd(4).
Make softraid(4) use iopools.
Added a flag to cmd_find_session so that attach-session can prefer unattached sessions when choosing the most recently used.
Added icelandic keyboard mapping to pckbd(4) and ukbd(4).
Updated xrdb to version 1.0.9. Fixes CVE-2011-0465 to which OpenBSD is not vulnerable.
Bind C-u to delete-line in tmux(1) vi mode like ksh does.
Removed portalfs.
Allow GCC2 to be used as a cross compiler from amd64.
Added macros for ssm/rsm in hppa64.
Implemented syscall_return in hppa64.
Added IPv6 ACK prioritization in pf(4).
Moved hppa64 PSW in struct cpu_info and ensure the kernel leave interrupts disabled when switching to virtual mode in the trap handler.
Added set_tid_address() syscall to compat_linux(8).
Fixed compat_linux(8) PID fetching.
Fixed bug to enable splower() and splraise() in hppa64.
Allow userland to inform connection to vscsi(4) is lost instead of failing it.
Fixed bug in usbhid(3).
Allow sgi IP27 kernel to pick memory from a different xbow(4/SGI) node than the one it booted from.
Reworked the way scsi(4) paths between mpath(4) capable devices and the kernel are managed.
Improved handling of vnode(9) vop_default struct in all file systems.
Make rc.subr(8) use printf(1) instead of echo(1) to handle case where daemon_flags is '-n'.
Make hppa64 locore.S save and restore the PSW value when making a PDC call, rather than blindly reloading from kpsl and enable wide mode for PSW defaults.
Removed compat_freebsd(8).
Added a SCSI probe routine to isp(4) so it can reject high luns when the midlayer is probing, rather than every time it issues an io.
Prevent potential problems with dma in wdc(4).
Fixed wrong m_dup_pkthdr() behaviour with M_WAITOK passing in mbuf(9).
Added ',' command in systat(1) to display numbers with thousands separators and to switch the ifstat view to Bits/s.
Fixed compat_linux(8) argument list.
Make xbow(4/SGI) rely on dma_constraints range and removed ATE code.
Make iscsid(8) log the SessionName to easily understand which session caused a problem.
Added AI_FQDN flag to getaddrinfo(3).
Turned macros into functions in IPv4 TCP input code and save more than 1400 bytes from the kernel on amd64.
Make sure i386 clear upper bits of the segment selectors in ddb_regs before entering ddb(4) so that "show registers" display sane values.
Moved tcp segments flushing from tcp_reass() to its own function: tcp_flush_queue.
Added linux_sys_{g,s}et_set_thread_area() support in compat_linux(8).
Correctly inherit and set the watermarks on socketbuffers. This fixes NFS problems and ensures that accepted sockets have correct socketbuffer setting.
Fixed mbuf(9) leaks in socket buffer.
Use routing socket m_copyback() return value to detect failure.
Make wcswidth(3) return -1 in case of unprintable character.
Cleaned up protocol checksums in pf(4), IPv4 and MPLS.
Make uvideo(4) reset time per frame to the default when the time per frame is setted to zero as the v4l2 spec says, instead of returning EINVAL.
Make mips64 correctly disassemble triadic version of {d,}m[ft]c instructions found on more and more mips64 processors.
Saved the IPv4 stack from a few unneeded IP header pull ups.
Prevent IPv4 stack from accepting ICMP redirects when acting as a router as it is done in IPv6 stack.
Removed useless check from MPLS.
Make gre(4) work between systems in the same LAN.
Prevent double free in mbuf(9).
Added another bpf hook in carp(4) carp_input to catch multicast and broadcast packets too.
Make Arla AFS NPPFS use alra_warnx instead of arla_warn is there is no errno to pass.
Removed useless ip checksums from pf(4).
Removed unneeded bridge(4) check in IP checksum handling.
Allow mount_msdos(8) to mount with option 'async'.
Moved P_EXEC flag from struct proc to process, so that setpgid() will fail regardless of which rthread calls execve().
Removed COMPAT_047 from GENERIC kernel.
In libc, moved __cerror to ___cerror with a weak alias so that rthreads can override it.
Fixed a gcc(1) warning in uvm(9).
Use route(8) -q options instead of >/dev/null 2>&1 in dhclient(8).
Changed some uvm(9) structs flag from ints to chars to make the structs smaller.
Make uvm(9) disallow swapping to vnd(4) devices and return ENOTSUPP to userland.
Added a new, unified allocator of kernel memory in uvm(9).
Clean up dhclient(8).
Added a new sysctl(3): kern.pool_debug which enable or disable POOL_DEBUG on the fly. Still defaults to on on -current.
Prevent a userland action to changed size of a closed half socket.
Prevent IPv6 input functions from enqueueing mbuf(9)s on sockets marked as SS_CANTRCVMORE.
Make aps(4) work on boot or resume.
The backplane version of em(4) 82575EB has no link state. It's always up.
Increased wd(4) timeout on I/O from 10s to 45s. This gives loongson enough time to wake up on resume.
Enabled the use of all the memory found on sgi IP27 and IP30 kernels.
Added a consistency check in sgi bus_dma(9) for the value returned by pmap_extract() against the dma_constraints range in _dmamap_load_buffer.
Make sure sgi dma_constraint is listed in uvm_md_constraints[] when it does not span the whole physical address space for uvm(9) pmemrange to operate correctly.
In octeon and sgi make sure resetting mtx_lock in mtx_lock is the last operation on the struct mutex.
Added helper functions for suspend in uvm(9): allow reclaiming pages from all pools, allow zeroing all pages. Not called yet.
Call setlocale() in hexdump(1), tcpdump(8) to avoid display glitches in UTF-8 locales.
Prevent libc locale from filling the ctype tab with Latin-1 information in UTF-8 locales.
Make mount_ntfs(8) handle disklabel(8) UIDs.
Make ahci(4) safer to use with bigmem by using dma_{alloc,free} for I/O.
Allow a desync to happen in a routing socket buffer when it becomes full rather than continually retrying until space becomes available.
Make ioprbs(4) use iopools.
Allow kernel printfs to go to console if in ddb(4) instead of being redirected to xconsole.
Make ncrscsi(4/MAC68K) use iopools.
Prevent the network stack from enqueueing mbuf(9)s on sockets marked as SS_CANTRCVMORE, as was done for routing sockets.
Prevent ipsec(4) from relying on implicit net/route.h inclusion via pf(4).
Make twe(4) use iopools.
Fixes display glitches occurring during virtual terminal switches with pcdisplay(4) and vga(4).
Moved PPWAIT flag from struct proc to process,so that rthreads in a vforked child behave correctly in most architectures machine-dependent code.
Use uvm_pmr_isfree() in uvm(9) when DEBUG is defined.
Allow allocation in inet6 in6_update_ifo() to wait.
Make ATA in wd(4) safer with bigmem.
Make spc(4/LUNA88K), mesh(4/MACPPC), aic(4), bha(4), oosiop(4), uha(4/I386), sea(4/I386) use iopools.
Allow bce(4) to run properly on systems with more than 1GB of physical memory and re-enable it on i386 and amd64 GENERIC and RAMDISK_CD kernels.
Hide the cursor during tetris(6)
Removed the AMD GART based iommu code.
Make Fujitsu MB89352 SCSI devices use iopools on hp300.
Enabled bigmem by default on amd64.
Updated xorg-cf-files to version 1.0.4.
Prevent pfsync(4) from deferring packets for states with NOSYNC set.
Set dma pools to IPL_VM.
Moved P_SUGID and P_SUGIDEXEC from struct proc to process. Ensures checks are done even from an rthread.
Constrain vfs(9) and uvm(9) buffer cache to use only the dma reachable region of memory. With this change bufcachepercent will be the percentage of dma reachable memory that the buffer cache will attempt to use.
Added stat counters to smtpd(8) lookup agent.
Make sure that amd64 physical addresses for dma are below the top of the dma constraint range and panic if they are not.
Removed obsolete vnode_if.* files from kernel.
Updated the xserver to version 1.9.5.
Improved DNAME handling in smtpd(8) resolver.
Removed buffer queues from vnd(4) since the disk that houses the image backing the vnd(4) also has a bufq.
Make ATA to SCSI translation layer safer to use with bigmem.
Removed the possibility to set the link 1 flag on an inet 4 lo(4).
Make mpii(4) correctly handle data underruns. Makes ses(4), safte(4) and lun probes work.
Make uvm(9) count the number of physical pages within a memory range.
Added support for pppx interfaces instead of tun(4) interfaces in npppd.
Added the local ip address to PIPEX session request ioctl so npppd can tell it to the kernel.
Improved libXi client/server endianness difference handling.
Make yacc(1) use some of its unused free functions.
Fixed error handling in uvm(9), and keep track of which pages need to freed.
Fixed wrong frame interval return value in uvideo(4).
Make sure everything run from i386 machine-dependent init .init and .fini sections gets a properly aligned stack.
Make loongson recognize 3A processor though it won't accept to run it yet.
Prevent udav(4) from processing packets where the USB xfer length is shorter than a packetheader, and prevent it from processing packets where the packet header length field says the packet is longer than the size of the USB xfer.
Make the top line of systat(1) stop updating, along with the rest of the data when 'p' is pressed.
Make sure everything run from amd64 machine-dependent init .init and .fini sections gets a properly aligned stack.
Fixed hppa64 trap diagnostic by correctly initializing oldcpi.
Make tmux(1) work out what type of option is being set by name regardless of the -s or -w options.
Removed unnecessary check in tmux(1) options.
On tmux(1), change -t on display-message to be target-pane for the #[A-Z] replacements and add -c as target-client.
Make sshd(8) print ipqos friendly string when launched with -T option.
Make smtpd(8) resolver use the CNAME query interface from asr for reverse lookups.
Added -a and -s options to tmux(1) lsp to list all panes in the server or session respectively. Added -s to lsw.
Make libXi aware of endianness difference between an X server and an X client.
Allow a start and end line to be specified for tmux(1) capture-pane which may be negative to capture part of the history.
Added mlphy(4), a driver for the MicroLinear 6692 Ethernet PHYs and include it in i386 and alpha.
Make ieee80211_node clean nodes until the number of cached nodes is smaller than the maximum number of nodes, otherwise it will never actually clean any nodes. Fixes issues with clients failing too attach because the node cache is completely filled.
Added icmptype and tcpflags to pcap(3).
Make tmux(1) set the terminal blocking earlier.
Make tmux(1) give each pane created in a tmux server a unique id (starting from 0), put it in the TMUX_PANE environment variable and accept it as a target.
Fixed libXi on sparc64.
Make hppa save its r4-r8 registers because the c3700 firmware corrupts their upper half.
Make sure loongson machine-dependent message buffer area is not zeroed unconditionaly. This gives up a persistent dmesg.
Fixed dhclient(8) interval handling.
Added umask and path checks in security(8) replacement.
Prevent smtpd(8) from failing to deliver a message if an MX address could not be resolved even though other valid MX exist. Make it only report the failure if no server address can be found at all.
Prevent MX from being silently dropped in smtpd(8) resolver.
Make sure smtpd(8) have an stdio stream opened for the message before trying to close it in an MTA session. Prevents from segv in case of DNS errors.
Modified smtpd(8) asr API to make things a bit smoother on the user side.
Make smtpd(8) client API receive an stdio stream rather than a file descriptor to the message file descriptor. Prevents a memory leak.
Make smtpd(8) resolver use an index for iterating into the MX list.
Make uvideo(4) fill in the timestamp when copying a frame into the mmap buffer.
Added support for VIDIOC_ENUM_FRAMEINTERVALS in uvideo(4).
In video(4) and uvideo(4), added support for VIDIOC_S_PARM and VIDIOC_G_PARM, ioctls used for setting and getting the frame interval.
Make uvideo(4) print the supported frame intervals when printing the frame descriptor.
Prevent uvideo(4) from changing the format group's default frame when configuring the device, and from using the default frame as the current frame: because the format group 'frame_cur' handles it.
Prevent uvideo(4) from trying to align its array of frame descriptors with the frame descriptor bFrameIndex field. The first valid frame in the array is at index 0, not 1.
Multiple improvements to uvideo(4): empty the queue of frames in the mmap frame buffer and set the index of the current frame to -1 when the mmap frame buffer is freed, set the index of the current frame to 0 when allocating the mmap frame buffer, panic if a) the mmap frame buffer is already allocated when it try to be allocated again, or b) the mmap frame buffer is not allocated when frames are tried to be added to it.
Allow ftp-proxy to proxy across rdomains.
Make pf(4) allow userland proxies to establish cross rdomain proxy sessions.
Increased rc.subr(8) timeout to 30 seconds.
Rewritten ospfd(8) lsack generation.
Make security(8) replacement checks home directories.
Make ssh-keygen(1) use strcasecmp() for "clear" cert permission option.
Make pf(4) reassemble IPv6 fragments. In the forward case, pf refragments the packets with the same maximum size. This allows the sender to determine the optimal fragment size by Path MTU Discovery.
Plugged bug in m4(1) to fix autoconf 2.5 and to match behaviour of Solaris m4.
Make hppa process interrupts in priority order.
Fixed some memory leaks in ospfd(8).
Initiated a replacement of security(8) not yet linked to the build.
Make sure smtpd(8) struct asr is always freed in asr_done().
Simplify smtpd(8) resolver initialization.
Make ifconfig(8) use the define for max rdomain with tunneldomain as well.
Make pf(4) address family independent functions reusable by netinet6.
Normalize sentinel in various archs machine-dependent code: Use _MACHINE_*_H_ and _<ARCH>_*_H_ properly and consistently.
Removed -d option from ssh-keygen(1).
Make com(4) read from UART only if there is something to read. Fixes beagle crash.
Make rc(8) use ssh-keygen -A to generate new host keys.
Added a -A option to ssh-keygen(1) to generate host keys (rsa1, rsa, dsa and ecdsa) with the default file path, an empty passphrase, default bits for the key type and default comment if the keys don't exist.
Allow scp://hostname/~user/subdir to work as a pkg(1) repository.
Prevent IPv6 stack from processing ICMP6 redirects by default. rtsol(8) will turn it back if -F is used.
Moved netinet6 MTU size check behind pf_test6() to avoid dropping unfragmented packet in ip6_forward().
Make cwm mouse reset the XSync timing change for client move only.
Make rtsold(8) print a warning when used to do IPv6 autoconfiguration while accepting redirects is turned off. Make it set net.inet6.icmp6.rediraccept to 1 if the -F switch is given.
Make netinet6 ip6_fragment() reusable by pf(4).
Increased the number of EBRs the kernel can transit looking for the OpenBSD partition from 8 to 256.
Make amd64 and i386 warn on install if the newly installed system won't be able to boot the install root disk.
Enabled beagle distrib.
Prevent tcpdump(8) from being strict when checking the length of an OSPF packet.
Make ueagle(4) and umodem(4) silently clear the endpoint when the device has failed.
Improved cwm.
Make use of timerclear macro in mrinfo(8), rpc.lockd(8), rtadvd(8), rtsold(8), traceroute(8) and wsmoused(8/I386).
Added support for NetMos Nm9922 dual serial port cards in puc(4).
Multiple smtpd(8) improvements: make it close datafd in client_close and reset smtp_client pointer to NULL after client_close(). Prevent smtpd(8) bounce_session() from closing msgfd as it is done by client_close().
Fixed a memory leak in smtpd(8) client.c and properly close envelope in queue_shared.c.
Fixed a memory leak in smtpd(8) client.c and properly close envelope in queue_shared.c.
Import the foundation for eqn(7) support in mandoc(1).
Prevent a protect fault in i386 and amd64 machine-dependent code by masking out invalid bits when reading MXCSR from userland sigcontext or a ptrace request.
Updated util-macros to version 1.13.0, dmxproto to 2.3.1.
Allow OpenBSD::Ustar(3p) to be more precise in its error messages: record position in archive, and caller can set description of file handle.
Fixes an AML issue on some Asus machines with acpi(4).
Make ntpd(8) and timed(8) use timerclear macro.
Pass to OpenBSD::PackingElement(3p) the new -c option to grotty when building manuals to avoid ANSI escape sequences and continue traditional backspace escaping.
Added support for ecdsa SSH keys in default xinit and xdm.
Make installboot(8/I386) and installboot(8/AMD64) error out if /boot cross the BOOTBIOS_MAXSEC line.
Added the ONDA MSA11OUP USB modem to umsm(4).
Fixed st(4) stdetach() to call vdevgone() with the right device minor numbers.
Make netstat(1) print icps_bmcastecho as "XX echo requests to broadcast/multicast rejected".
Improved comkbd(4/SPARC64).
Make pkg-config(1) print the URL of installed package newer version when requested.
Added basic validation for .pc files in pkg-config(1).
Fixed bugs in pkg-config(1).
Fixed obj directory probing to support cross compiling on arch hp300, loongson, sgi, sparc and sparc64.
Fixed ral(4) RT2661 firmware loading at startup and resume.
Prevent uk(4) from provoking a kernel panic when detaching an unknown SCSI device.
Make arm platform recognize OMAP3630/DM3730, as found in the beagleboard xM.
Make cd(4), ch(4), safte(4), sd(4), ses(4) and st(4) use dma_{alloc,free} instead of malloc to allocate buffers which need to be in the right address space.
Make it possible to allocate up to 64K of dma pools in the kernel dma allocator.
Make rc.subr(8) quiet unless RC_DEBUG=1.
Make rc.subr(8) print daemon names itself instead of using rc.{local,shutdown}.
Make rc.subr(8) notify the user if a given operation was successful or not by appending the (ok) or (failed) strings to the end of the daemon name.
Introduced an INRC environment variable in rc.subr(8) so it may know if it's called from rc.local or rc.shutdown.
In bios(4/I386), bios(4/AMD64), installboot(8/I386) and installboot(8/AMD64) make the various findopenbsd() functions non-recursive, eliminating a global, a couple of parameters, and opening up possibility of traversing a much longer EBR lists without blowing the stack.
Fixed trap sending in snmpd(8).
Make npppd use timerclear macro.
Removed evaluation of PATH_LOCALE in libc localization code to prevent abuses causing integer overflow.
Make smtpd(8) use user-provided Diffie-Hellman parameters for ephemeral key exchange. If no Diffie-Hellman parameters are found, fallback to built-in parameters as it was done until now.
Make softraid(4) attach one sensordev per discipline. This results in a drive sensor being attached for each volume under the same sensordev, instead of having multiple sensordevs each with a single drive. Fixes PR6576.
Added a -B flag to netstat(1) which displays buffer sizes for TCP sockets.
Make ssh-keyscan(1) use timerclear macro.
Make aucat(1) use timerclear macro.
Fixed uninitialized variable warnings in ksh(1).
Make ifstated(8) use appropriate timerclear macro.
Fixed a function return in mandoc(1).
Make sure tcpbench(1) rebuild its binaries if kvm(3) or event(3) have changed.
Updated zoneinfo database to tzdata2011d from elsie.nci.nih.gov.
Make it possible to boot OpenBSD on an amd64 or i386 up to the 7th extended partition below 128GB.
Prevent gcc(1) from warning because of recent HANDLE_PRAGMA_PACK_PUSH_POP.
Improved EBR handling in kernel disk(9) subroutines.
Added initial beagle distrib pieces.
Prevent usb subsystem crash in beagle with prcm.
Prevent rc.subr(8) from launching rc_start if rc_pre failed and from launching rc_post if rc_stop failed.
Implemented PKG_CONFIG_SYSROOT_DIR in pkg-config(1). Bumped version to 0.23.
Fixed a use after free in PIPEX.
Make socket(2) soreceive() block a process reading from a spliced socket that already got an end-of-file but still has data in the receive buffer until all data hase been move. Make kqueue(2) work with sosplice(9).
Fixed handling of VIS_ALL in vis(3).
Added Wake on LAN support for re(4) and vr(4).
Added 'wol' and '-wol' options to ifconfig(8) to enable and disable Wake on LAN on a system in standby or suspend mode.
Updated xkbcomp to version 1.2.1.
Synchronized ctype definitions for the UTF-8 locale to FreeBSD, fixing width of various zero-width characters.
Replaced type daddr_t (64-bit disk address) by type daddr_32t (32-bit disk address) in all archs machine-dependent code (bios, boot...). The bootblocks only do 32-bit block spanning for now.
Removed groff(1) from base.
Make sparc and sparc64 libc division and remainder use a better fitted register.
Prevent a race in sosplice(9).
Fixed relayd(8) client timeout.
Make ext2fs utilities use type daddr32_t because they can only operate with a 32-bit block number range for now.
Updated xkeyboard-config to version 2.1.
Replace the old, broken KERN_PROC ABI and its matching functions in kvm(3) with the stable-ABI versions that are currently named KERN_PROC2, kvm_get{proc,argv,envv}2().
In i386 machine-dependent parts, provide distinct segments for the %fs and %gs selectors to use by default, with per-rthread base offsets and with sysarch() functions, I386_{GET,SET}_{FS,GS}BASE, for fetching and setting those base offsets. This is necessary for both rthread and Linux compat support.
Fixed a bug that caused nbr addr_tree corruption in ldpd(8).
Make ldpd(8) log the fact that a session was not accepted because of missing HELLOs.
Clean bios(4/i386) and bios(4/amd64) stack garbage before passing buffer to biosd_io().
Added -z <output_zone> to date(1) for changing the specified time zone.
Make sure extra arguments are not passed to date(1).
Prevent which(1) -a option from changing the exit status.
Added support to admtemp(4) for detecting the NXP SA56004X.
Implemented options --print-provides, --print-requires and --print-requires-private in pkg-config(1).
Make pkg_config honour PKG_CONFIG_DEBUG_SPEW.
Allow ssh(1) GSSAPI authentication to detect when a server-side failure causes authentication failure and don't count such failures against MaxAuthTries. Fixes bz#1244.
Make IPv6 stack log MAC address changes in the IPv6 neighbour discovery protocol cache as "ndp info overwritten". Makes the behaviour similar to ARP.
Make smtpctl show stats display inet4 and inet6 repartition for incoming sessions.
Moved rc.subr(8) redirections into the rc_cmd itself instead of rc_start and rc_stop so scripts don't need to set it.
Implemented UDP mode for tcpbench(1) and switch it to use libevent.
Print em(4) debugging info via ifconfig(8) debug command instead of using a global em_display_debug_stats variable.
Make ksh(1) substitute '~' for $HOME in the \W prompt case. Matches bash behaviour.
Prevent rc.subr(8) from losing rc_{pre,post} when rc.d(8) override rc_{start,stop}.
Fixed truncation of IPv6 addresses in smtpd(8) mail delivery path.
Fixed a carp(4) reconfiguration problem.
Build xcb by default in Xenocara.
Added vrng(4/sparc64) to sparc64 GENERIC kernel.
Fixed extended partition searching in biosboot(8/i386), biosboot(8/amd64), cdboot(8/i386), cdboot(8/amd64), installboot(8/i386), installboot(8/amd64), pxeboot(8/i386) and pxeboot(8/amd64).
Allow ospfd(8) to send out LS updates larger than the MTU.
Make ospfd(8) use IP_MAXPACKET instead of IBUF_READ_SIZE as upper bound for packet building.
In tmux(1) prevent tiled producing a corrupt layout when only one column is needed.
Added support to pass through escape sequences to the underlying terminal in tmux(1).
Updated xterm to version 269.
Make usbhidaction(1) use fork(2) and exec(3) instead of system(3).
Make pkg_create(1) run makewhatis(8) when verbose mode is set.
Added editline support to bc(1).
Removed NTFS from alpha GENERIC kernel.
Prevent mandoc(1) from leaking information about software used into PostScript and PDF documents.
Clean up date handling in mandoc(1): always store dates as strings, not as seconds since the Epoch; for input, try the three most common formats everywhere; for unrecognized format, just pass the date though verbatim; when there is no date at all, still use the current date.
Make sure isp(4) MEMORYBARRIER(SYNC_REG) performs a read/write bus_space_barrier, instead of a read barrier only, as it is used in read-modify-write cycles.
Added to rc.subr(8) an "rc_bg" variable that is undefined by default and allows to start a daemon in the background.
Make getopt(3) ignore leading '-' in optstring if POSIXLY_CORRECT is set. Fixes PR6267.
Fixed potential crash when GZIP variable set and more than 512 command line arguments specified. Closes PR 6573.
Improved sparc64 machine-dependent code by removing tests already performed by bus_space_barrier(9).
Fixed DMA errors with dc(4) on sparc64.
Improved disklabel(8) auto-allocation scheme.
Prevent usb(4) devices from being non-functional because of a too long reset.
Improved tmux(1).
Fixed bug in azalia(4) resume.
Added -H to ls(1) (follow symlink) as required by POSIX.
Added -W <whiteexp> to spamlogd(8). Adjusts the time for whiteexp in hours.
Prevent mpi(4) from reading garbled replies.
Added -H to grep(1) (opposite of -h) to always print name.
Fixed passing of arguments from spamd(8) to pfctl(8). Fixes PR6142.
Prevent division-by-zero in zts(4/ZAURUS) when scaling down to the screen resolution.
Resized MAXDSIZ up to 2G on macppc and socppc.
Make cron(8) reset the SIGPIPE signal handler immediately before executing a command.
Make at(1) use dirfd(3) instead looking into struct dirent.
Added a -P option to tmux(1). Detaches to HUP the client's parent process.
Make smtpd(8) log correctly ip addresses on big-endian machines.
Make ping6(8) compare minimum amount of bytes between what was received and what was sent out and print additional information explaining payload size differences.
Fixed broken handling of ios_base::showpos in libstdc++-v3.
Added the socket splicing fields of struct socket to netstat -vP output for debugging.
Fixed a bug in atexit(3) __cxa_finalize().
Allow <sys/stdarg.h> to use va_arg macro as a local variable name.
Fixed a segmentation fault in rtadvd(8).
Make pfsync(4) use ip6_output for sending IPv6 frames instead of assuming everything is IPv4 and using ip_output.
Define HANDLE_PRAGMA_PACK_PUSH_POP just like on other platforms in gcc(1) to get #pragma pack and #pragma push work in order to be compatible with MS compilers as it is used by some projects like chromium.
Make sure disklabel(8) editor save the start and end sector of the OpenBSD area every time a user updates its bounds.
Synchronized scsi(4) ASC/ASCQ errors with <http://www.t10.org/lists/asc-num.txt>.
--------
Changes made between OpenBSD 4.8 and 4.9
Introduced a dummy function in ifconfig(8) if SMALL is defined to digest arguments like "rdomain", "description", etc. so that the ifconfig(8) on RAMDISK is able to parse hostname.if(5) files on updates.
Make Xorg properly restore xf86-video-r128 video mode upon exit on macppc.
Prevent a possible 5 seconds delay in socket splicing.
Fixed a buffer overflow in the pppoe receive packet handling.
Make dumpfs(8) disklabel(8) UID aware.
If relayd(8) "check script" doesn't exit(), treat the service as "down" rather than "unknown". Fixes a problem where the script is killed due to expiry of the interval timer.
Force the disklabel(8) UID cache used to generate hw.disknames to be updated after every disklabel read or write. Prevent the DUID cache from de-syncing.
Make mpii(4) look up the device attached to a raid volume by its address on the bus, not which bioctl volume id it is.
Removed daemon_shell and force the use of /bin/sh for the su(1) call in rc.d(8).
Prevent PIPEX from using address and control field on PPPoE, they must not be used as the protocol.
In IPv6, prevent the nd6_addr_add() work queue task from adding multiple addresses for the same prefix.
Fixed pf(4) source address rewriting for the icmp errors with rdr-to setup (PR6564).
Fixed PR6557 with RT2560 and RT2661.
Mark descriptors as invalid before unmapping the associated mbuf. Might prevent the unrecoverable DMA error mentioned in PR 6557.
Disabled PCIe Active State Power Management (ASPM) to avoid bge(4) randomly detaching from the bus on some machines.
Improved drm(4).
Improved ami(4).
Make makewhatis(8) quieter unless launched with -v option.
Fixed USB drives that spin themselves down due to inactivity in sd(4).
Make nsd(8) call setusercontext(3) before chroot(2).
Fixed stats about node allocation failures in ieee80211_proto(9).
Improved ieee80211_input(9).
Make mos(4) set IFF_BROADCAST in if_flags.
Make Xorg properly restore xf86-video-ati video mode upon exit on macppc and sparc64.
Fixed infinite loop in fdisk(8).
Prevent fdisk(8) from parsing blocks it did not successfully read.
Implemented the DIOCGCACHE and DIOCSCACHE ioctls in mpii(4) for raid volumes. Allows sd(4) to enable the write cache on such a volume on attach, like it is done in mpi(4).
Make radeonfb(4/SPARC64) re-initialize acceleration engine after leaving X.
Make pgs(4/MACPPC) only attach if the "device_type" properly is "programmer-button".
Improved disklabel(8) cleaning of badly formed partition.
Disable Xorg on alpha because Xrender is broken.
Improved alc(4).
Prevent carp(4) from stopping on a vlan(4) after it has been manually changed.
Disabled sbt(4) and ubt(4) on all kernels.
Fixed speaker auto-mute in azalia(4) for some IDT codecs.
Make umodem(4) allow interfaces other than slaves of the union interface to be the data interface.
Make azalia(4) check its widgets connection list.
Fixed off by one bug in lynx(1) page display.
Disable sysctl(8) kern.usercrypto (userland access to crypto(4)) by default.
Allow users to enable access to crypto(4) with sysctl(8) , but keep it turned off by default.
Make ssh(1) host based auth with ECDSA keys work correctly. Fixes bz#1858.
Fixed crash in viaenv(4).
Fixed suspend issues in vnd(4).
Added workaround for BCM5906 A0/1/2 controller silicon bug in bge(4).
Reduced i386 RAMDISK size by not compiling statistics counters code in em(4) if SMALL_KERNEL is defined.
RELIABILITY FIX: the sis(4) driver may hand over stale ring descriptors to the hardware if the compiler decides to re-order stores or if the hardware does store-reordering.
A source code patch is available.
[Applied to stable]
Make bgpd(8) nicely print 4-byte AS.
Make routing socket free mbuf in failure case. Fixes PR6562.
SECURITY FIX: PF rules specifying address ranges (e.g. "10.1.1.1 - 10.1.1.5") were not correctly handled on little-endian systems (alpha, amd64, arm, i386, mips64el, vax). Other address types (bare addresses "10.1.1.1" and prefixes "10.1.1.1/30") are not affected.
A source code patch is available.
[Applied to stable]
Fixed a bug with the pointer location in cwm(1).
Fixed a crash in cwm(1).
Allow relayd(8) debug logging before daemonization to help identify configuration issues. Fixes PR6314.
Clear bpf(4) filter memory before using it. Prevents leaking previous kernel stack contents through a malicious bpf(4) filter.
Fixed nc(1) PR6207.
Added the rc_scripts variable for rc.d(8).
Added linux_mprotect() syscall to compat_linux(8).
Avoid dereferencing a NULL pointer during VT switches when composite is active in xf86-video-intel. Fixes a crash.
Fixes the heavy rendering errors and crashes that could make inteldrm(4) unusable on a 865G since 4.8. Fixes PR6517.
Make crontab -l not crash on crontab(5) files that don't have the expected three lines of comments.
SECURITY FIX: An incorrectly formatted ClientHello handshake message could cause OpenSSL to parse past the end of the message. An attacker could use this flaw to trigger an invalid memory access, causing a crash of an application linked to OpenSSL. As well, certain applications may expose the contents of parsed OCSP extensions, specifically the OCSP nonce extension.
Applications are only affected if they act as a server and call SSL_CTX_set_tlsext_status_cb on the server's SSL_CTX. It is believed that nothing in the base OS uses this. Apache httpd started using this in v2.3.3; this is newer than the version in ports.
A source code patch is available.
[Applied to stable]
Put a limit on fnmatch(3) recursion during matching, and reject input of size greater or equal PATH_MAX.
Fixed tmux(1) split-window argument usage.
Added time related syscalls clock_gettime() and clock_getres() to compat_linux(8).
Set SO_KEEPALIVE on ftpd(8) sockets.
Fixed a crash with xf86-video-ati in zaphod mode if one screen is not present.
Make relayd(8) log the time taken for all types of check, not just tcp checks.
Make Xenocara build use mandoc(1).
Make the installation script use an absolute path to the temporary hosts file. Fixes hosts(5) creation upon install.
Updated zoneinfo database to tzdata2011b from elsie.nci.nih.gov.
Removed .NS from mandoc(1).
Put the max size of em(4) EEPROM to 16k. Fixed use of at least Intel PRO/1000 (82576) rev 0x01.
In pf(4), make sure that IPv4-ICMP6 and IPv6-ICMP packets are not rewritten in case they are dropped and logged.
Prevent mandoc(1) from breaking line between the arguments of .Bsx .Dx .Fx .Nx .Ox .Ux.
Fixed .Bk being ineffective in mandoc(1).
Make sgi platforms correctly pick the MP kernel on install if applicable.
In nm(1), fixed omission of symbol list for first object file in an archive with nm -s. Fixed PR6385.
Fixed NULL dereference with sudo -g group when the sudoers(5) rule has no runas, user or group listed.
Prevent a useless check already done in pf(4) pf_test_rule(): pf_test() and pf_test6() already drop IPv4-ICMP6 and IPv6-ICMP packets.
Multiple improvements in otus(4), rsu(4), run(4), urtwn(4): use usb_ref_{incr,decr,wait}() to avoid detaching the driver while a process is still using the hardware; don't add timeout(9)s if the device is detached; added checks to see if the device has been detached before running ioctls, timeouts, and tasks; use usb_wait_task() to wait for tasks to complete.
Make pf(4) reinitialize header length of unusual protocol number getting rewritten. Prevent a panic in m_clget().
Multiple improvements in usb(4): merged 'onqueue' and 'running' members of struct usb_task into a new member, 'state'; added new function usb_wait_task() which waits for queued or running usb_tasks to complete; in the USB_DEVICEINFO ioctl, fill struct usb_device_info in a usb_task, thereby avoiding races against driver attach/detach.
OpenSSH 5.8 released.
Fixed uninitialized nonce variable in ssh(1) key_certify().
Clear struct scsi_inquiry_data in atascsi_pmp_inq() from SCSI to ATA translation layer.
Prevent tmux(1) from requiring -d with -x or -y since it could be in the config file.
Make isakmpd(8) ignore any IP address not in the current routing domain when binding to addresses.
Merged in Xenocara fix for EXA bug #32803.
In the kernel semaphore handling, for SETVAL and SETALL operations make sure the specified value(s) are within the system limits. Fixes PR6547.
Fixed pf(4) check for invalid IPv6 fragment.
Merged in Xenocara fix for EXA bug #24703. Prevent crash.
Make tmux(1) redraw pane borders when switching to last pane.
Make crontab -e honour TMPDIR.
In the OpenBSD upgrade process, don't run fsck(8) for fstab(5) entries with zero or empty fs_passno and make it ask for permission to continue upgrade if one or more mounts failed.
Prevent mandoc -Thtml from printing out the <BR> before lines that have leading white space.
Make mandoc(1) .Bx accept no more than two arguments.
Make mandoc(1) quote .%T if .%B is specified, as in groff.
Make wscons(4) report the compose key on sun keyboards in raw mode as a different keycode from right alt.
Disambiguated return values of m_tag_copy_chain() in mbuf_tags(9).
Fixed tmux(1) problems with fatal() if the terminal disappear while locked.
Fixed logic errors in alc(4).
Make tmux(1) use input_clear to reset the APC, DCS, OSC state or it could be reused improperly by a later state.
Prevent an X server crash in Xenocara privilege separation.
Make Xenocara effectively close the AGP device fd in xf86GARTCloseScreen() if it's different from the consoleFd. Fixes crashes at server reset.
Improved iked(8) behaviour of drop_sa.
Fixed an mbuf leak in mpe(4) by replacing m_free() with m_freem() in mpe_input().
Fixed a memory leak by replacing m_free() with m_freem() in trunk(4) broadcast mode.
In generic Ethernet functions, changed an m_free() to m_freem() to free the whole mbuf chain and to prevent a possible memory leak with bpf(4) BIOCSFILDROP option which is currently used by dhcpd(8) and dhclient(8).
Prevent midi(4) from sleeping with the PCATCH flag while closing itself, otherwise a signal may cause the output buffer to not be drained and cause stale notes.
Upgraded to nsd(8) 3.2.7.
Added port multiplier support in sili(4) and ahci(4).
Prevent iked from initiating connections in passive move, even for ACQUIRE messages from the PFKEY socket in order to suit sasyncd(8).
Removed acquire flows from iked(8) to prevent it from passing traffic when there's no SA established.
Enabled child SAS in iked(8) and make it do SA and flow transfer after succeeding with all the preparation steps.
Improved tmux(1) jobs.
When clearing tmux(1) entire screen, clear lines that are used into the history like xterm does.
Make the pthreads(3) scheduler block signals while restoring a newly selected thread state.
Make tmux(1) check if the index is in use and fail before creating the child process, rather than leaving a stray child on failure.
Put -I${includedir} back into OpenSSL Cflags so configure script tests like test -n "`pkg-config --cflags openssl`" work.
Removed usb events from usb(4) devices.
Make mandoc(1) avoid double blank line before a table preceded by .PP.
Prevent tbl(7) from skipping data after horizontal lines in the layout. This avoids data loss in cpu(4/hppa).
Corrected tbl(7) horizontal spacing of data cells, alignment of centred cells and adjusted horizontal rule width to the new spacing.
Make pkg_add(1) prepend pkgname to ask-update prompt, so that user knows for sure which package is asking.
Fixed child SA deletion in iked(8) drop_sa.
Make mandoc(1) ignore .ns (no-space mode), .ps (change point size), .ta (tab control) for now.
Make mandoc(1) skip carriage return before newline, if any.
Fixed Intel Wifi Link 6200 support in iwn(4) by forcing Tx/Rx chains masks since ROM contains broken data.
Updated zoneinfo database to tzdata2011a.
Changed nsd(8) default paths.
Added support to installboot(8/i386) and installboot(8/amd64) for installing biosboot(8/i386), biosboot(8/amd64), boot(8/i386) and boot(8/amd64) on softraid volumes.
Make softraid(4) correctly handle I/Os that exceed MAXPHYS in size.
Make pfctl -x none equivalent to pfctl -x crit.
Allow tmux(1) top-bit-set characters to be used for key bindings.
Make tmux(1) set $TMUX without the session when background jobs are run.
Improved lcd(4/hppa) with SMP kernel.
Make pkg_add(1) display messages for new installed rc scripts and new material in the READMES directory.
Wrapped mg(1) basename, dirname with xbasename, xdirname functions.
Ensure that boot storage area exists and is large enough, before making softraid(4) install boot code.
Updated xfwp to version 1.0.2, x11perf to 1.5.3.
Make mandoc(1) check argument count validation for all in_line() macros.
Prevent pf(4) from scrubbing packets that will be dropped anyway.
OpenSSH 5.7.
Upgraded pixman to version 0.20.2.
Improved mg(1) filename completion.
Repaired iked(8) rekeying by sending appropriate traffic selector.
Make mpe(4) compile without errors when inet6 is not defined.
Make iked(8) use IKED_ADDR_EQ instead of memcmp on comparing two iked_addrs.
Fixed iked(8) traffic selector configuration so that it is always "from $localnet to $peernet" and not depending on the initiator/responder mode.
Prevent iked from creating child sas from empty proposals.
Make iked(8) handle empty encrypted payloads.
Reimplemented the iked(8) policy evaluation for incoming connections to use the last matching semantics of PF.
Split iked(8) pfkey initialization into a privileged and unprivileged part to prevent a possible crash.
Added Atheros F1 and F2 PHYS ton atphy(4).
Removed gotos in vte(4) vte_iff function.
Make clear mandoc(1) can't format pages with roff .it request.
Added support for ITE IT8721 to it(4).
Improved pf(4) packet reassembler.
Improved mg(1).
Gave pf(4) pf_normalize_ip() the same 3 way semantics as pf_test(): PF_DROP, the packet is bad, the mbuf still exists and must be freed; PF_PASS and *m0 is NULL, the packet has been processed, not an error; PF_PASS and *m0 is not NULL, continue with packet processing. Fixes a potential mbuf use after free.
When ospfd(8) is fixing conflicts make sure the right vertex is passed to lsa_merge() so that the correct sequence number is used for the LSA.
Fixed a kernel crash due to ifmedia(4) broadcast address changes.
Merged a change from ncurses(3) upstream to correctly recalculate a form field size on set.
Added join-line (M-^) to mg(1).
Removed handling of SIGUSR1 from crontab(1).
Improved iked(8).
Added initial acquire mode support in iked(8) and use it whenever Windows peers decide to drop Child SA based on the inactivity timer.
Fixed redistribution of overlapping routes in bgpd(8) rde.
Added back-to-indentation (M-m) to mg(1).
Make mandoc(1) skip .TH with excessive arguments instead of throwing a fatal error.
Make mandoc(1) skip .br .sp .nf .fi .na with arguments, using empty strings like groff instead of throwing a fatal errors.
Make random(4) be more careful with nanotime() calls in early entropy storage, since at least sparc may not have the clock mapped.
Continue to load acpiec(4) even if _REG fails.
Improved IPV6 forward.
Make hppa and hppa64 check in resettodr() if inittodr() has been called, otherwise it ends up resetting the clock when it doesn't need to.
Make netstat -w default to the first egress interface, which is usually the most interesting.
Fixed a double free in xwininfo(1).
Make iwn(4) trust the Tx/Rx chains masks in ROM except for the 4965 and 5100 chipsets which are known to have broken ROMs.
Improved iwn(4).
Sync tbl(7) handling with upstream version 1.10.9: .T} can be followed by a delimiter, then more data; do not limit table column widths (improves terminfo(5)); let numerical cells respect explicitly specified minimum cell widths; let terminal output survive missing data cells; parse and ignore arguments in parentheses on layout cell specifications; move tbl_calc() into out.c such that it can be used by all frontends; give tables an HTML class; some cleanup in tbl -Thtml code.
Make sure coding errors cannot make mandoc(1) miss fatal parsing errors by assert(3)ing valid parser state in the main parsing functions.
Added another check to pkg_create(1).
Make i386 and amd64 only use memory mapped extended PCIe config space access for the bus advertised in the MCFG table, and fall back on the traditional method for other busses.
Make authentication to ldapd(8) from pGina work.
Renamed imask[] to cpu_imask[] on powerpc architectures.
Fixed athn(4) LED handling.
Fixed a counter in ldpd(8) hello.
Enable athn(4) at uhub(4) on amd64, armish, landisk, loongson, macppc, socppc, sparc64.
Make ssh(1) client loop use variable host and not options.hostname, as the latter may have unescaped substitution characters.
Improved athn(4).
Make tmux(1) accept colours of the hex form #ffffff and translate to the nearest from the xterm(1) 256-colour set.
Support unix domain sockets in nc(1) with -Uu.
Minor improvements to random(4): only support pool words equal to 2048, define the amount of used key, define the amount of skipped rc4, use arc4random_buf instead of reimplementing in line, bzero some more "secrets".
Added socket option SO_SPLICE to splice together two TCP sockets. Allows to write relay daemons with zero data copy.
Updated Test::Simple(3p) to version 0.96.
Substantially rewrite random(4): put a very thin mutex at the entropy-collection side, place a 2nd very thin mutex at the call-down path as well, move the pool->MD5->RC4init sequence into a workq driven from a timeout.
Added a yield() in random(4) randomwrite() to prevent problems when root accidentally cat /dev/random.
Increased i386 MAXDSIZ to 2GB.
Permit to get all luns on a target probed in iscsid(8) with a single ioctl(2).
Make vdsp(4/sparc64) detect whether a disk image is an ISO image and set the media type to VD_MEDIA_TYPE_CD to vDisk 1.1 clients. Makes installing from a Solaris 11 Express bootable install CD work.
Fixed a malloc(9) call in vdsp(4/sparc64).
Added support for the vDisk1.1 protocol in vdsp(4/sparc64). Improved Solaris vtoc/disklabel support and implement VD_OP_SET_VTOC. Makes Solaris actually run on top of an OpenBSD control domain.
Reset ssh(1) SIGCHLD handler to SIG_DFL when executing LocalCommand.
For very large operations in random(4) randomread(), use a local rc4 instance much like arc4random_buf_large does, but without re-initializing it every 8K.
Fixed %n expansion in ssh(1) LocalCommand.
When ssh(1) exits because of a ServerAliveTimeout, mention the hostname that caused it.
Update CGI(3p) to 3.51. Includes a better fix for SA42443.
Implemented fast channel change in athn(4).
Align vdsp(4/sparc64) with Solaris expected behaviour.
Make athn(4) create an STA entry for the BSS upon association.
Make vnd(4) init and destroy the bufq in the ioctl handler to prevent problems when configuring a second one.
Make install fsck question default to 'no'.
Make all /dev/*random nodes supply data from the same source.
Prevent iscsid(8) task scheduler from locking up.
Make iscsid(8) pass the magic LUN -1 to VSCSI_REQPROBE so that all LU are probed by the midlayer.
Added minimal LUN handling to iscsid(8).
RELIABILITY FIX: sp_protocol in RTM_DELETE messages could contain garbage values leading to routing socket users that restrict the AF (such as ospfd) not seeing any of the RTM_DELETE messages.
A source code patch is available.
[Applied to stable]
Put htons(3) around ip_randomid() for pf(4) scrub random-id to make it consistent with the network stack.
Fixed bug in sl(4).
Added preliminary support for the Atheros AR9271 chipset and probably the AR9280+AR7010 and AR9287+AR7010 to athn(4).
Make acpi(4) MCFG ignore tables with an empty bus range.
Pass pmap_bootstrap() the memory range used by the PROM/BUG/firmware/... in aviion, luna88k and mvme88k.
Added minor optimizations to m88k pmap(9).
Make copypage() and zeropage() per-cpu function pointers on mvme88k.
Changed the count parameter to cmmu_tlb_inv(), and introduce cmmu_tlb_inv_all() to drop all user tlb entries on mvme88k.
Put su -c ... command into an rcexec variable so that it can be easily used it in rc scripts.
Reintroduced use of bufq in vnd(4).
Properly fixed PR6009.
Make mandoc(1) parse and ignore minimal column width specification.
Make apm(4/i386) support machdep.lidsuspend, at least on Thinkpads which have aps(4).
Added a cleaner integration of tbl(7) in mandoc(1).
Added support for Memory Mapped Configuration space access. Gives access to PCIe extended configuration space access on modern i386 and amd64 machines.
Use pmap_uncache_page() to alter cacheability of pages in bus_dmamem_map(). Makes the zaurus text mode console memory cached again after exiting from X.
Introduced pmap_uncache_page() in arm pmap(9) to make a page uncached and maintain this both at the pte and pv list level.
Prevent vcons(4/sparc64) from assuming it is always the console since it's possible to run CoolThreads servers with a graphics console.
Updated xproto to version 7.0.20.
Make random(4) arc4_stir() only grab 64 bytes from the MD5 output.
Added support for XVR-300 in radeonfb(4/sparc64).
Make rc.subr(8) check for a login class that matches the rc script name and use it if it is found, otherwise use daemon.
In bpf(4) bpf_movein(), range-check mbuf size against MCLBYTES before size_t to int truncation.
Implemented NOP-IN -> NOP-OUT handling in iscsid(8).
Make iscsid(8) cleanup tasks with a NULL callback after queuing the PDU to be sent out. Allows immediate responses to be issued with a task instead of very special code.
Make iscsid(8) truncate the scsi sense data to 18 bytes if more data was supplied. Improves connection.
Fixes parsing of login responses with additional padding in iscsid(8).
Make iscsid(8) log the PDU which failed because no task was found.
Added a missing session parameter in iscsid(8).
Fixes multiple man(7) .IP and .TP bugs for -Tascii and -Thtml.
Cleaned up and simplified tmux(1) command argument parsing.
Cleaned up argument count validation in mdoc(7): prevent segfault on empty .Db, .Rs, .Sm, and .St; let check_count() really throw the requested level, not always ERROR and downgrade most bad argument counts from ERROR to WARNING.
Added support for UTF-8 mouse input (\033[1005h) in tmux(1).
Make unprovided mandoc(1) macro arguments defaults to empty string and not NULL.
Removed the old COMPAT_23 SysV IPC structures from the kernel.
Fixed bugs in mandoc(1) macro argument parser with blank, backslashes and quotes escaping.
Make mandoc(1) use one common macro argument parser for roff and man macros.
Added to pkg_info(1) a -r <pkgspec> option to to check for a pkgspec by name, without looking at installed packages.
Reworked OpenBSD::Ustar(3p) object creation.
Plugged a memory leak in fortune(6).
Make ac97(4) use host_flags directly as they're initialized during attach time.
Allow to change vlan options of existing vlan(4)/svlan(4) devices at runtime instead of forcing the user to-recreate the interface with the changed options.
Make ac97(4) check the optional flags method is not NULL before using it.
Adjusted krb5 directories in OpenSSL pkg-config generator.
Reworked m88k systems backtrace code.
Reduced use of cd in the install script by using sub-shells or absolute paths when possible.
Improved vdsp(4/sparc64) with OpenSolaris virtual disk client.
Make hppa need_resched() call cpu_unidle() such that a process running on another CPU is woken up.
Make pkg_create(1) create formatted man pages as temporary files.
Improved OpenBSD::Ustar(3p) error printing.
Enabled Xorg on hppa.
Enabled udl(4) in Xenocara.
Prevent some NULL pointer dereferences in osiop(4).
Make elroy(4/hppa) store bus/dev/func numbers only when the corresponding pointer argument isn't NULL.
Improved vdsp(4/sparc64) with OpenSolaris virtual disk client and enabled to boot from a bootable automatic installer cdrom.
Added code for acpi(4) taskqueue. Eliminates need for state vars in acpi softc serialize processing ACPI tasks for sleep/powerdown/GPE event.
Make vdsp(4/sparc64) go past the version negotiation against an OpenSolaris virtual disk client.
Improved mvme88k cache handling.
Implemented READ CAPACITY in vdsk(4/sparc64).
Prevent random(4) from folding the MD5 in half.
Moved hppa setting cpu_hzticks to the clock initialization function, like other ports.
Improved softintr_establish() linked list management in hppa intr.c.
Make elroy(4/hppa), dino(4/hppa) store bus/dev/func numbers only when the corresponding pointer argument isn't NULL.
Prevent a buffer overflow in sort(1). Fixes PR6294.
Added support for OTPROM reading on athn(4) AR9485.
Added a -P option to new-window and split-window to print the new window or pane index in target form.
Reset tmux(1) session timer of an unattached session when it is attached.
Make wd(4) put the drive into standby in shutdown, but only if the machine will be powered down.
Rewrite the random(4) randomattach function.
Removed kq and poll code from random(4).
Adapt the m88k systems pmap(9) to aviion, mvme88k, luna88k.
Prevent athn(4) from exceeding power requirements in Atheros AR9380, AR9485, AR9380, AR9003 chipsets.
Better handle of writethrough mappings in m88k systems pmap(9).
Reworked the cache flushing routines in m88k systems.
Introduced a new cmmu routine in m88k systems.
Updated dirent.h for standard compliance: expose dirfd with XPG7 and scandir and alphasort with POSIX 2008.
Improved isp(4).
Added a new firmware package for iwn(4).
Reduced the chances of false pulse detect in AR9271 and AR9485 Atheros chipset and improved carrier leak calibration/correction.
Make athn(4) more bus independent.
Make pfctl(8) check pf.conf(5) scrub don't use no-df, random-id, set-tos options for IPv6 rules.
Make amd64 machine-dependent pthreads(3) compile with llvm-clang.
Make sigsetops(3) compile with llvm-clang.
Changed tmux(1) from a per-session stack of buffers to one global stack.
Improved random(4).
Fixed addressing block bug with wd(4) and 2010 Apple 13" MacbookPro.
Added hppa GENERIC.MP to the release build and ship bsd.mp for hppa.
Make sure hppa restore the right interrupt mask when switching CPUs.
Improved the loading of FPU context with multiple CPUs in hppa.
Turn hppa machine-dependent signotify() into a function that also calls cpu_unidle().
Implemented cpu_unidle() for hppa multiprocessor kernels.
Make mfi(4) use iopools.
Prevent run(4), rum(4), urtw(4) and ral(4) from adding timeouts if the driver is dying and improved detaching.
Add a process reference counting variable to struct usbd_device in usb(4).
Fixed some PCI power management issues that prevented acpi(4) (and perhaps apm) suspend on some machines.
Added support for all the four xterm mouse modes.
Allow tmux(1) config file parser and source-file to return "don't exit" to the client to let attach work from configuration files.
Prevent i386 and amd64 kernels from printing the "can't get bus clock" message with Xeon 3600/5600 and Xeon 6500/7500.
Removed non-essential, unused parts of random(4).
Removed fc_conf from rc.subr.
Removed more direct uses of print in pkg_add(1).
Fixed swapctl -A with DUIDs in fstab(5) and plugged a memory leak.
Implemented timeouts of scsi commands in mpii(4).
Make mpii(4) properly detach devices.
In mandoc(1) libmdoc, replace the union of pointers to structs of macro-specific data by a pointer to a union of structs, which makes the code simpler and more robust at the expense of a small memory overhead.
Fixed a bug in mandoc(1).
Corrected x86_atomic_*_ul() to operate on 64bit integers, removed x86_atomic_*_l(), and updated the callers of all of those to use the underlying x86_atomic_*_u32() functions they were expecting.
Removed unused and broken x86_multicast_ipi() from i386 and amd64.
Prevent issuing a m88k cache maintenance operation until the last one is completed.
Make rc.subr call rc_conf itself right after reading in rc.conf(8).
Properly initialize i386 MXCSR and XMM registers when writing only in the x87 FPU state and the process has not used the FPU yet.
Added cfattach activate functions and call usbd_deactivate() in the DVACT_DEACTIVATE case for cdcef(4), otus(4), rsu(4), urtwn(4), uberry(4), udfu(4), udl(4), uow(4), uyap(4). Make those which don't have dying flag call usbd_deactivate() in the DVACT_DEACTIVATE case.
Added some groff behaviour to mandoc(1): Specifying both .%T and .%J in an .Rs block causes the title to be quoted instead of underlined, such that journal title and article title appear visually different.
Removed pmap_phys_address(), and force every driver's mmap() routine to return a physical address in all platforms. Allows machine-independent drivers to implement mmap(2) routines without having to know about the pmap_phys_address() implementation.
Polished mandoc(1) HTML output: use <SMALL> for .SM and <CODE> for .Dl, <B> for bold and <I> for italic.
Added a param to uvm_map_hint to not skip over the heap, and use it as a last resort if mmap otherwise fails to enable more complete address space utilization.
Prevent linker failure with sparc crtbeginS.o.
Prevent pms(4) from crashing when doing an ioctl(2) (eg wsconsctl -a) before first activation (wsmoused or X).
Prevent rc.subr from overwriting local_rcconf by flags from the rc(8) script.
Make pkg_create(1) create more bogus packages to get errors out of pkg_add(1).
Prevent g++(1) from warning about undefined __throw_exception_again().
Make pkg_add(1) handle failures from ports tree with more care.
Have sd(4) devices check for and respect read-only information the way st(4) does. Have both decline to open read-only devices for anything but read-only access.
Fixed a tmux(1) crash due to side effects of server_kill_window with RB_FOREACH.
Prevent m88k systems from sharing their exception page with the one used by the firmware at address 0. Make it possible to catch NULL pointer dereference.
Add a common interface for various devices in pms(4).
Make m88k systems check for pcb_onfault being set for genuine kernel data faults.
Make the pte created by pmap_map() wired, and count them in pmap_kernel() statistics on m88k systems.
Improved pmap(9) mmap interface.
Increased the DATA limit to the maximum value in bgpd(8) RDE, do the same with NOFILE in the session engine.
Fixed dhcpd(8) when asked to log on stderr.
Make iked(8) use netmask instead of address when it is asked to.
Fixed iked(8) SA rekeying for responders.
Added more standard HTML tag to mandoc(1) -tHTML.
Allow drm(4) to work in -keepPriv situations.
Prevent removing of xf86drm device entry if open fails.
Make the installation script use the chrooted arandom(4) and add to it more commands of output of random junk.
Make rc(8) and the installation script use arandom(4) for feeding entropy to the kernel.
Prevent opendev(3) from prepending /dev/ to path if it already contains a slash.
Reworked iked(8) child SA rekeying and added a new per-policy "lifetime" in iked.conf(5).
Fixed some bugs in iked(8).
Make it easier to spot errors in pkg_add(1).
Make vnd(4) populate the disk name based on the mode in which it was configured (svndX if safe vnd disk, vndX if standard).
Add support for Dynex DX-SC51 envy(4).
Prevent an infinite loop in pkg_add(1).
Improved mandoc(1) vertical spacing, -Thtml.
Make tmux(1) store its sessions in a red-black tree by name rather than a list.
Updated xorg-server to version 1.9.3.
Prevent ipsec(4) input from leaking short packets.
Prevent opendev(3) from casting to non-const.
Converted netisr to a normal soft interrupt instead of having machine-dependent code for it.
Prevent a mbuf leak in ipsec(4).
Fixed iked(8) netmask from sockaddr conversion.
Fixed PR6524.
Fixed iked(8) log_warn and log_debug arguments.
Improved pkg_add(1) dependencies finder.
Improved mandoc(1) buffers. Fixes some segfaults.
Work around panic(9) due to 'invalid opcode' in mvme88k kernel trap.
Fixed panics when applying newfs(8) to the 'c' partition of a softraid(4) volume, though one shouldn't do that.
Improved pkg_create(1) solving of dependencies by making it ask the ports tree for the plist.
Make relayd(8) only set SO_REUSEPORT for listening ports. Fixes 'Address already in use' errors seen on high load.
Added a check in pkg_create(1): walk the dependency tree for @wantlib. Prevents packages that won't install.
Split solver class into a base that can be reused from pkg_create(1) in pkg_add(1) OpenBSD::Dependencies.
Make a real method out of find_candidate in pkg_add(1) OpenBSD::Dependencies.
Allow registration of library objects in pkg_add(1).
Make pkg_add(1) pass state to SharedLibs for direct printing.
Removed SESSION_DEAD flag from tmux(1).
Make tmux(1) use pointer rather than index for the client's last session.
Unified the way tmux(1) sessions are used by callbacks.
Added a -xxx option to pcidump(8) to print PCIe extended configuration space.
Prevent tmux(1) from destroying the index counter when a session comes up.
Make ucycom(4), utrh(4) and utwitch(4) the last drivers using their own macros instead of usb_lookup().
Fixed an alignment trap triggered by vnconfig(8) on sparc for kernels compiled with gcc4 in the kernel generic ioctl(2).
Added other-pane-height and other-pane-width options to tmux(1). Allows the width or height of the smaller panes in the main-horizontal and main-vertical layouts to be set.
Updated freetype to version 2.4.4.
Make mandoc(1) handle .Bk with HTML output format the same way it is for ASCII.
Make mandoc(1) handle .Bk the same way as groff 1.20.1: .Bk without arguments defaults to -words, .Bk with invalid arguments (including -lines) has no effect.
Fixed regression in smtpd(8): if MX look up fails, fallback to using the host itself.
Improved mandoc(1) HTML output: use less <DIV> and more <H1>, <H2>, <P>, <BR>, <PRE>, <UL>, <OL>, <DL> etc.
Removed 'i' and 'r' macro handlers in mandoc(1).
Added support for the Sweex LW154 to rsu(4).
Improved pkg_add(1) with uses of OpenBSD::State(3p).
Prevent usb(4) usbd_{bulk,intr}_transfer from catching signals if a timeout is set.
Fixed simple passwords with SHA in ldapd(8).
Avoid pointer arithmetic on void * in malloc(3).
Fixed length of the array containing VIA ciphers in crypto(9) and crypto(3).
RELIABILITY FIX: Bring CBC oracle attack countermeasures to hardware crypto accelerator land. This fixes aes-ni, via xcrypt and various drivers: glxsb(4), hifn(4), safe(4) and ubsec(4).
A source code patch is available.
[Applied to stable]
SECURITY FIX: Insufficient initialization of the pf rule structure in the ioctl handler may allow userland to modify kernel memory. By default root privileges are needed to add or modify pf rules.
A source code patch is available.
[Applied to stable]
Fixed getopt() bug in dhcpd(8).
Prevent uticom(4) from panicking when being attached. Enable it in i386 and amd64.
Added security fix in OpenSSL for CVE-2010-4180.
Prevent delays in usb(4) if the device dying.
Make cron(8) treat a missing spool dir like an empty one.
Disabled access to crypto(4) from userland.
Implemented fast path TLB miss handling on the landisk platform. Improves speed by 44-50%.
Make voyager(4/LOONGSON) use the dying flag in struct usbd_usb instead of a private dying flag.
Make ohci(4), uhci(4), ehci(4) use the dying flag in struct usbd_usb instead of a private dying flag.
Make math(3) HUGE_VAL, HUGE_VALF, HUGE_VALL, INFINITY, NAN expand to the constant expressions with the help of GCC version posterior to 3.3.
Fixed bug in cwm(1).
Make tmux(1) read ${X} environment variables in strings and $HOME from the global environment rather than getenv, this allows them to be updated during the configuration file parsing.
Fixed a race condition in ldconfig(8).
Simulate a full login with su(8) in rc.subr.
Make su(1) call setusercontext() with the LOGIN_SETENV flag for su -l to pick up environment variables specified in login.conf.
Prevent ospfd(8) and ospfd6(8) from using a carp address as ospf router.
Improved pkg_delete(1).
Prevent smtpd(8) resolver from reading past the end of a buffer.
Make sure GCC configuration file for sparc OpenBSD is consistent with <sys/types.h>.
Fixed segmentation faults with GCC4 by allocating a full C compiler-style stack frame that includes space for 6 extended word arguments slots required by the sparc ABI in sparc ld.so(1).
Make rsu(4) match the Planex GW-USNano.
Added support for the ZTE MF112 from MERIGHI Marcus to umsm(4).
Make urtwn(4) drop Rx'd frames larger than MCLBYTES.
Added rsu(4), a driver for Realtek RTL8188SU, RTL8191SU and RTL8192SU 802.11n USB devices. Enabled it in i386 and amd64 GENERIC kernels.
Allow tmux(1) to track the last session for a client and add a flag to switch-client a key binding (L) to move a client back to its last session.
Fixed tmux(1) rectangle copy to behave like Emacs.
Make tmux(1) prompt history global for all clients.
Make mandoc(1) SYNOPSIS sections and code having .nr nS enabled behave as if the whole code were wrapped in .Bk/.Ek.
Fixed bug in urtwn(4).
Allow the rc.d system to mark an rc action as unsupported by setting the corresponding variable to NO.
Prevent the rc.d system from overwriting settings in the rc scripts.
Added support for setting _user _class and _shell for a specific daemon launched with rc.d, and use su(1) to start the daemons.
Fixed bug in su(1).
Fixed a file descriptor leak in rcs(1).
Make mandoc(1) abort endless loops during roff macro and string expansion.
Allow mandoc(1) quote macros ('Op', 'Aq', 'Bq', 'Dq', 'Pq', 'Ql', 'Qq', 'Sq', and 'Brq') to have zero arguments without warning.
Added support for -s login-shell to su(1).
Fixed an infinite loop in bgpd(8).
Prevent isakmpd(8) from deleting SAs from the same IP on an INITIAL-CONTACT message. Fixes PR5562.
Added a -3 option to scp(1) to transfer copy between two remote paths through the local host.
Make xinput use ASCII art when the environment is not UTF-8 capable.
Distribute the panes more evenly in tmux(1) built-in layouts and set the default value of main-pane-width to 80 rather than 81.
Fixed bug in amd64 {rdmsr,wrmsr}_locked functions.
Updated xf86-video-geode to 2.11.10.
Improved i386 and amd64 checksumming of disks that need to be matched to BIOS disks. Prevent a wrong disk from being attached as boot disk.
Make mandoc(1) ignore .ft when used with -Thtml.
Prevent mandoc(1) from reporting the same problem more than one time.
Added an option in tmux(1) for silence (lack of activity) in a window.
Prevent mandoc(1) from printing .P, .PP and .LP header content.
Prevent mandoc(1) from following .D1 and .Dl inside .Bd with a blank line.
Avoid calling xf86DPMSInit() twice in xf86-video-sunffb. Fixes X server crashes that appeared with the xserver 1.9.2 import.
Allow better compiler optimization of PMAP_PREFER on arm, hppa, hppa64, m68k, mips64, solbourne, sparc and sparc64.
Updated CGI(3p) to version 3.50 (includes a fix for SA42443).
Added a -D flag to specify the display to start xtsscale(1) on.
Make ehci(4), ohci(4), uhci(4) set the dying flag when having an unrecoverable error. Check the dying flag in timeout and interrupt handlers.
Make uhci(4) delete the interrupt timeout in the detach routine as in ehci(4) and ohci(4).
Make use of usbd_deactivate and usbd_is_dying instead of own dying routines in atu(4), aue(4), axe(4), cue(4), mos(4), ral(4), rum(4), uath(4), udav(4), upgt(4), url(4), urtw(4), zyd(4), udcf(4), ueagle(4), umbg(4).
Make usb(4) call config_deactivate() before config_detach() when detaching devices.
Make usb(4) use usbd_is_dying() instead of directly checking the device's bus dying flag.
Make usb(4) check that the root hub has been configured before trying to free it's resources.
Added dying flag to usb(4) struct usbd_device. Added usbd_deactivate() to set it. Added usbd_is_dying() to check if the flag has been set and use it before issuing transfers or requests.
Improved xf86-video-glint for sparc64. Make mplayer play video without weird colors.
Upgraded xorg-xserver to version 1.9.2, xf86-video-savage to 2.3.2.
Make pyro(4/sparc64) and vpci(4/sparc64) return the appropriate size for the extended PCIe configuration space.
Make sure nfsrv_descrpt_pl pool is initialised only once in nfs_syscalls to prevent infinite loops.
Make pkg_add(1) framework easier to reuse.
Make pci(4) check the register offset against the device's configuration space size in PCIOCREAD and PCIOCWRITE ioctls.
Introduced a new pci routine, pci_conf_size(), in all platforms machine-dependent code. It returns the size of a given pcitag_t configuration address space.
Added a simple bus_space_barrier implementation in octeon.
Fixed a file descriptor leak in ssh(1).
Fixed iockbc(4/sgi) compilation.
Updated amd64 locore.S for handling the new size of pm_cpus, member of pmap(9).
Added support for DUIDs in swapctl(2).
Added a protocol extension to sftp(1) to support a hard link operation.
Make ssh(1) key authentication check for revoked keys earlier.
Fixed a file descriptor leak in smtpd(8).
Make mandoc(1) properly initialize the manual section to a default when .Dt is missing. Prevent it from dying on an assertion.
Added quirks to usb(4) to prevent it from attaching the hid interface of the Texas Instrument MSP430.
Prevent savecore(8) from reading lapic area by not linking vers.o last.
Make the hotplug(4) queue dynamic. Allow it to increase size without waste.
Introduced a -N option in tar(1) to make it use only the numeric UID and GID values when creating or extracting an archive.
Prevent umodem(4) from matching, attaching devices without a data endpoint since umodem(4) can't use them.
Prevent mandoc(1) from assuming autodetected file format are all the same.
Disable default maintainer mode in makedepend(1). Suppress extra attempts to re-run autoheader that fails.
Added a -s option in bioctl(8) to allow passphrase read from stdin.
Prevent find(1) from throwing an error if it can't opendir() while -empty is used.
Make perl(1) work with THREADED_PERL=true, though not enabled by default.
Increase the maximum number of monitored hosts and concurrent health checks in relayd(8). Fixes issues when having around 100 hosts or more.
Replaced a large stack buffer with a malloc call in localtime(3).
Avoid ssh(1) hostkey warnings when connecting to servers with new ECDSA keys that are preferred by default.
Improved iked(8) and isakmpd key exchange speed.
Updated xterm to 267, xf86-video-apm to 1.2.3.
Make tmux(1) configure mode-keys and status-keys to vi if $VISUAL or $EDITOR are set to "vi".
Let ifmedia(4) ifa_print_rb() build on kernels not implementing inet6. Fixes some RAMDISK builds.
Make ssh(1) correctly load comment for encrypted rsa1 keys.
Make fsck -p respect fs_passno > 2 as implied by fsck(8) manual.
Make bgpd(8) deny prefixes that have F_ATTR_PARSE_ERR set by default. Prevent them from leaking into the Loc-RIB or other RIBs but act as withdraws.
Introduced a new asynchronous resolver in smtpd(8).
Added rss mime type to httpd(8).
Removed .Sp, .Vb, and .Ve workarounds from mandoc(1) now it has a proper .de support.
Implemented the roof .ft (change font) request for man(7).
Bumped the number of supported CPUs from 32 to 64 on i386 and amd64.
Fixed hangs seen with MCLGETI and put it back in re(4).
Removed machdep.root_device sysctl(3) in alpha platform.
Added boot descriptor support to octeon.
Removed machdep.debug, machdep.booted_device and machedep.booted_kernel sysctl(3) in arm, armish, beagle, gumstix, palm and zaurus architecture.
Enabled __HAVE_PMAP_DIRECT on mips64, unless the kernel is configured to run on R5000 family processors.
Fixed a carp(4) panic.
Improved mandoc(1) handling of error message when parsing unimplemented macros.
Make mandoc(1) parse and ignore .ad, .hy, .nh and .ne roff requests to reduce ERROR messages from mandoc -Tlint.
Prevent mandoc(1) from printing bogus ERROR messages about undefined macros.
Improved the way saved registers are displayed in arm backtraces.
Removed the global pmap list and related debug code in arm machine-dependent code.
Removed the vm_map field of ddb(4) breakpoints and watchpoints, and do not pretend these could work on userland addresses.
Removed ddb(4) single-step load and store counters.
Updated xf86-input-keyboard to 1.5.0.
Make sure i386 and amd64 kernels don't attach more CPUs they can handle and allow OpenBSD to boot on machines with more than 32 CPUs/cores.
Make pkg_add(1) keeps track of all manpages directories.
Increase uvideo(4) UVIDEO_MAX_FRAME to 32 to support 28 possible frame types.
Improved gfxp(4/sparc64).
Disabled uscanner(4) by default on all kernels which configure it.
Fixed ldapd(8) re-indexing by checking if an index entry already exists.
Make rc.shutdown(8) print the daemon name before rc_stop.
Remove sunmouse protocol decoder from Xenocara.
Make scp(1) pass through ssh command-line flags and options when doing remote-remote transfers.
Make mandoc(1) support quoting of arguments passed to user-defined macros and make .del a synonym for .de.
Implement the .de (define macro) roff instruction in mandoc(1).
Updated xcalc to 1.0.4, xeyes to 1.1.1, xf86-video-ast to 0.91.10.
Updated xlsatoms to 1.1.0, xlsclients to 1.1.0, xwininfo to 1.1.1, all rewritten to use XCB.
Added floating-point emulation code for systems mips64 systems lacking proper FPU like octeon.
Allow machine-dependent code to setup machine-dependent specific mappings in sys_execve(), if machine-dependent <machine/_types.h> defines __HAVE_EXEC_MD_MAP.
Improved ptrace(2) usage on mips64.
Implemented a real pmap_proc_iflush() in mips64 chipsets.
Fixed uvideo(4) controls that use two-bytes signed data on sparc64.
Make sure that hw.disknames gets updated whenever a disklabel is set.
Make relayd(8) set the number of hosts that are up to zero when disabling and enabling tables.
Fixed bug in smtpd(8) aliases.
Avoid NULL dereference in ssh(1) when receiving a channel request on an unknown or invalid channel.
Improved octeon interrupt handling.
Prevent RAMDISK sysctl(8) from printing terminating null character after strings.
Make mii(4) recognize the Marvell PHYG65G Gigabit PHY.
Removed WINDOW_HIDDEN flag from tmux(1).
Make zs(4/macppc) use cons_decl() to get console routine prototypes.
Make installation script create devices for fstab entries that are using disklabel(8) UID.
Improved cd(4).
Removed timer randomness in random(4) ioctl.
In Xenocara, updated xf86-input-mouse to version 1.6.0.
Refactor ssh(1) internals of private key loading and saving to work on memory buffers rather than directly on files.
Make uhci(4) handle uhci_alloc_sqh() properly when it fails to allocate memory in uhci_device_setintr().
Make ssh-agent(1) use "$TMPDIR/ssh-XXXXXXXXXXXX/agent.<ppid>" instead of hardcoded "/tmp/ssh-XXXXXXXXXXXX/agent.<ppid>" for its socket.
Added wsdisplay_rawkbdinput() for raw mode input in wskbd(4).
Start work to get rid of avail_start and avail_end in the kernel.
Prevent mac68k machine-dependent code to overrun memory ranges array.
Fixed panic on bridge(4) destroy.
Added urio(4), uscanner(4) and pseudo-device hotplug(4) to sgi GENERIC-IP27, GENERIC-IP30, GENERIC-IP32 kernels.
Added urio(4) and uscanner(4) to loongson GENERIC kernel.
Added pseudo-devices hotplug(4) and wsmux(4) to hp300, landisk and sparc GENERIC kernels.
Make install/upgrade drop dhcp group from interfaces which did not go UP and got an IP address.
Do not allow malloc() to wait in uhci(4) uhci_device_setintr(), instead check for failure and return USBD_NOMEM: callers will do the right thing.
Make KERN_CPTIME return an average number of ticks across all CPUs in sysctl(3).
Prevent installboot(8/sparc64) from crashing if the bootblock is zero-sized. Apply similar fixes to installboot(8/mvme68k), installboot(8/mvme88k) and installboot(8/sparc).
Prevent dhcpd(8) from trying to listen on interfaces that don't have a valid broadcast.
Fixed lynx(1) SSL error when going to sites using wildcard certificates.
Prevent MAKEDEV from running for a UID in install.
Make sure NTFS and ext2 readdir cookies are actually allocated with the correct size.
Added NVIDIA MCP89 SATA controllers in the PCI IDE controller driver.
Make bgpd(8) log notification messages.
Make bgpd(8) accept but ignore updates with AS_CONFED_* path segments, treating them as withdraw.
Added ifa_print_rb() to ifmedia(4) to allow dump of the ifaddrs red-black tree to the console in ddb(4).
Make ifmedia(4) maintain a red-black tree of ifaddrs structures and make ifa_ifwithaddr use it for lookups.
Applied security fix for OpenSSL CVE-2010-3864.
Introduced ifa_update_broadaddr in ifmedia(4) to update an ifaddr's broadcast address,
Allow iked(8) -D command line flag to actually define macros.
Make mount_msdos(8) handle disklabel(8) UID.
Make fsck(4) try to determine file system type using readlabelfs(3) when given a disklabel UID.
Added support for Marvell 88E8059 in msk(4).
Fixed a null pointer dereference in route(4) that was causing kernel crashes.
Make urtwn(4) attach FeiXun products.
Fixed error message when ld.so(1) ends up loading a different than expected library, but other library needs the one loaded.
Periodically measure temperature in urtwn(4) and redo LC calibration if temperature changes significantly since last LC calibration.
Added support in relayd(8) for enable/disable table when using relays instead of redirects.
Fixed a pointer bug in cardbus(4) com(4).
Make ipw(4) and iwi(4) ${if}_stop reset ic_scan_lock as in wpi(4) and iwn(4)
Added urtwn(4) to armish, landisk, macppc, socppc and loongson GENERIC kernel.
Make readlabelfs(3) handle disklabel(8) UID.
Make isduid(3) easily usable.
Prevent smtpd(8) from exiting if smtpctl schedule is run with a valid but non-existent message ID.
Improved amd64 AESNI driver.
Prevent who(1) from producing lines longer than 80 columns.
Make tmux(1) show more window and pane flags in list-* output, and put layout on the same line.
Improved aucat(1) midi.
In Xenocara, updated Pixmap to version 0.20.0.
Prevent tmux(1) last and active window from becoming the same.
Allow ssh and sshd to set arbitrary TOS/DSCP/QoS values instead of hardcoding lowdelay/throughput.
Removed bdwrite to bawrite conversion in vfs(9).
Switched from TSS-per-process to TSS-per-CPU in amd64.
Reverted MCLGETI for re(4) as it is causing hangs.
Push all potential system MI .h files not utilized by the bootblocks into the ctags run as well to bring #define's and structs and such into scope.
Make pfctl(8) and tcpdump(8) show the rdomain correctly.
Make the installer properly quote the wireless config into hostname.if(5).
Added XAUTHORITY to tmux(1) update-environment.
Added a -a flag to tmux(1) unbind-key to flush all key bindings.
Make tcasic(4/alpha) and esp(4/mac68k) compute synchronous transfer periods (involving the bus clock) with a better accuracy.
In Xenocara, updated libXdmcp to version 1.1.0, libXext to 1.4.0, libXft to 2.2.0, xtrans to 1.2.6, libXi 1.4.0, bh-ttf to 1.0.3, mkfontdir 1.0.6, xdriinfo 1.0.4, xgamma to 1.0.4, xinput to 1.5.3, xkill to 1.0.3, xrdb to 1.0.7, xrefresh 1.0.7, xset 1.2.1, xwd 1.0.4, xwud 1.0.3.
Prevent acpibat(4) from recursing infinitely on the notify function.
Updated athn(4) AR9380: added the different ROM templates for the different chips, fixed AR_PHY_65NM_CH0_TOP_XPABIASLVL definition, applied attenuation settings from the ROM.
Pass aesni_ctr_enc an initial counter block instead of an initialization vector in amd64 aesni.
Enable low latency interrupt modulation on ix(4) and set the LL interval to the maximum value to reduce the number of low latency interrupts hitting the card when the ring is getting full.
Fixed an issue in bgpd(8) where the RDE would start up as route-collector because uninitialized memory made the RDE switch to that mode.
Make ldapd(8) -dvv flags produce debug traces of decoded BER messages on stderr. Also shows a hexdump of the input buffer if BER decoding fails.
Make ldapd(8) prefix debug logging on stderr with time and pid, like syslog.
Use only libcrypto APIs that are retained with OPENSSL_NO_DEPRECATED in ssh(1).
Set rdomain maximum route-id to RT_TABLEID_MAX in ifconfig(8), as it is for the kernel.
Improved drm(4).
Prevent rc(8) from printing 'Null message body; hope that's ok' in the rc output if the call to rc.firstime doesn't output anything to mail(1).
Added %F, %g, %G, %u, %z (extended) and %Z conversion specifications to strptime(3) format string.
Use scandir(3) instead of getdirentries(2) in diff(1). Call to getdirentries(2) should be avoided outside of libc.
Clear ERL register on octeon locore.S.
Added sched_get_priority_{min,max} to libpthread.
Moved softraid(4) raid1 and crypto to a workq.
Make sio_onvol(3) return a integer exposing whether a volume knob is available for the stream.
Added a temporary workaround for imake(1) buff with variable substitutions.
Prevent revision 0xc4 and earlier of the Acer Labs M5229 UDMA IDE from doing DMA for LBA48 commands. It makes large disks slower but work properly.
Make ATA wdc(4) work around some bugs in certain pciide(4) controllers.
Added security fix for the TrueType FX font variation loader of FreeType in Xenocara (CVE-2010-3855).
Added a security fix for the TrueType bytecode interpreter of FreeType in Xenocara (CVE-2010-3814).
Added urtwn(4) to sparc64 GENERIC kernel.
Added urtwn(4), a driver for Realtek RTL8188CU/RTL8192CU 802.11n USB devices.
Added experimental support for full dynamic range of 24-bit hardware use for i386, amd64 and sparc64 only. It is disabled by default since most hardware and audio programs use 16-bit precision.
Added moscom(4), ucom(4), uts(4), uhts(4), uberry(4), uath(4), otus(4), upgt(4), urtw(4), urtwn(4), utrh(4) to macppc GENERIC kernel.
Implement ddb(4) command "show mbuf addr".
In Xenocara update xf86-video-geode to 2.11.9.
Fixed a possible use of uninitialized variable in mrouted(8) IGMP.
Make systat(1) print relative number of mbuf(9) livelock that happened between two systat updates instead of showing absolute figures.
Make ldapd(8) return earlier when the base DN in a search request doesn't exist.
Make ldapd(8) truncate additional incomplete requests when the input buffer already received two complete requests. Fixes the number of bytes consumed from the input buffer.
Make bridge(4) filter out reserved destination MAC addresses (01:80:C2:00:00:0x) as per the 802.1D-2004 spec.
Synchronized tcpdump(8) with tcpdump.org to fix multicast DNS support.
Make ldapd(8) publish matching rules in the cn=schema subentry as the matchingRules attribute as required by RFC4517.
Make ldpd(8) rewrite all packet parsers to be more careful about alignment.
Make ldpd(8) only consider paths with highest priority when replying to label requests.
Make sure sysmerge won't end up using /usr/src/etc when the correct option isn't passed.
Fixed a bug in pkg_add(1) when used with: -nz bsr.
Make ntpd(8) use all the IPs written during install by default in ntpd.conf(5).
Make sftp-server(8) parse umask as octal.
Make ctags(1) -t flag do nothing for backward compatibility as tags creation for typedefs, structs, unions and enums are the default by POSIX.
Make pool_sethardlimit(9) not imply pool_sethiwat(9).
Make ldapd(8) recognize all matching rules from RFC4517 except the optional wordMatch and keywordMatch.
Use caseExactMatch instead of caseExactIA5Match in ldapd(8) core.schema.
Make ldapd(8) evaluate filters according to the three-valued logic of X.511, as required by RFC4511.
Make vmt(4) attach only if mainbus(4) is specifically asking for it after vmt_probe succeeds. Prevents mainbus(4) from hanging.
Make trm(4) reduce useless retry of commands getting sense errors.
Make make -q exit with 1 and not -1. Fixes PR6494.
Make <sys/ressource.h> usable on its own by including <sys/time.h> as required by POSIX.
Make the network livelock counter available from sysctl(8) and systat(1).
Make sysctl(3) export the network livelock counter.
Replaced a boot(RB_HALT) to a panic in amd64 machine-dependent trap.c to make it in line with the other architectures.
In Xenocara updated xf86dga to version 1.0.3, xinit to 1.3.0,
Added support for hex keys in the ifconfig(8) wpakey code (full length only).
Fixed OpenCVS init command.
In Xenocara, updated bigreqsproto to version 1.1.1, compositeproto to 0.4.2, damageproto to 1.2.1, fixesproto to 4.1.2, fontsproto to 2.1.1, randrproto to 1.3.2, recordproto to 1.14.1, scrnsaverproto to 1.2.1, xcmiscproto to 1.2.1, libFS to 1.0.3, libXres to 1.0.5, libXScrnSaver to 1.2.1, libXaw to 1.0.8, libXcomposite to 0.4.3, libXcursor to 1.1.11, libXfont 1.4.3, libXinerama to 1.1.1, libXmu to 1.1.0, libXpm to 3.5.9, libXrandr to 1.3.1, libXt to 1.0.9, libXtst to 1.2.0, libXv to 1.0.6, libXxf86dga to 1.1.2, libXxf86vm to 1.1.1, libdmx to 1.1.1, libfontenc to 1.1.0, libxkbfile to 1.0.7, imake to 1.0.4, makedepend to 1.0.3, xorg-macros to 1.11.0, bdftopcf to 1.0.3, beforelight to 1.0.4, bitmap to 1.0.5, editres to 1.0.5, fslsfonts to 1.0.3, fstobdf to 1.0.4, iceauth to 1.0.4, ico to 1.0.3, mkfontscale to 1.0.8, rgb to 1.0.4, showfont to 1.0.3, smproxy to 1.0.4, twm to 1.0.5, viewres to 1.0.3, xconsole to 1.0.4, appres to 1.0.3, xdpyinfo to 1.2.0, xedit to 1.2.0, xev to 1.1.0, xfd to 1.1.0, xfs to 1.1.1, xfsinfo to 1.0.3, xgc to 1.0.3, xhost to 1.0.4, xkbevd to 1.1.1, xkbutils to 1.0.3, xlogo to 1.0.3, xmag to 1.0.4, xman to 1.1.1, xmodmap to 1.0.5, xprop to 1.2.0, xrandr to 1.3.4, xsertroot to 1.1.0, xsm to 1.0.2, font-util to 1.2.0, encodings to 1.0.4 and all fonts packages to latest X.Org versions.
Make the return of rfork(2) consistent with gethrid(). Fixes an rthread breakage.
Make netstat(1) print socket structure internals when netstat -P pcbaddr is called with -v.
Make the installer create a matching group for the user upon user creation.
Fixed high frequencies being removed on envy(4).
Fixed a 10 year old bug in the ld.so(1) memory allocator, which affected only sparc.
Improved run(4) and otus(4).
Fixed mandoc(1) command list parsing.
Removed colcrt(1), checknr(1), soelim(1) from base.
Removed "secrets" map from smtpd(8) and allow creation of user defined maps holding credentials.
Make stat(1) include the octet of the mode that contains the setuid/setgid/sticky bits in the output format used for the -x option.
Set bpf(4) alignment to 32 bits instead of sizeof(long).
Added preliminary support for PCI and SATA to octeon.
Allow some rules to have longer expiry delay than the default in smtpd(8).
Fixed a 'bstp still active' panic that happens if a stp enabled interface is destroyed while in the bridge(4).
Prevent route(4) from sending route messages to userland processes if those messages are rejected by the kernel because of bad encoding.
Make sure the mbuf data is properly aligned when function is reinjecting packets from low level output functions into high level output functions in Ethernet-inside-IP processing.
Added m_print() a function to print mbuf(9) headers. Can be called from ddb(4) with an mbuf pointer as argument to see the contents of it.
Removed libdes, src/ports users have been switched to libcrypto.
Replaced getdirentries by a new one, renaming the first to ogetdirentries().
Fixed memory leak in OpenCVS.
Fixed a possible NULL deref on loading a corrupt ECDH key in ssh(1).
Prevent mandoc(1) font alternating blocks like .RB from breaking the line between children in literate mode.
Removed skipjack and cast from libc.
Added _SC_HOST_NAME_MAX in sysconf(3).
Make alpha trap report proper pc address in siginfo.
Fixed a few logic errors in misp64 comparison instruction emulation: make sure the less than relation is correctly computed, and check for both operands being signaled NaNs, instead of only the first NaN found, to decide whether to raise an invalid exception or not.
Fixed an off-by-one in a mandoc(1) assertion, crashing the renderer on ".Os \&".
Prevent various usb network devices from freeing network related resources if they were not allocated.
Added preliminary support for rc scripts in pkg_add(1).
Prevent mandoc(1) from throwing errors when .HP .IP .RS .TP have no arguments, as they are optional.
Merged -k and expand @@ parsing code between OpenCVS and OpenRCS, resulting in a performance gain in OpenCVS in some "cvs update" scenarios.
Downgraded nearly 20 mandoc(1) ERRORS to WARNINGS.
Added support for so (low-level roff "switch source file"), needed for Xenocara and various ports.
Added a simple 'rc' system to base (/etc/rc.subr) in order to start/stop/restart/reload services installed by the ports system.
Moved the MSIZE, MCLSHIFT, MCLBYTES and the MCLOFSET mbuf constants from hppa machine-dependent param.h to machine-independent param.h.
Added optional "match" keyword in relayd.conf(5) to allow simpler rdr-to filter rules.
Implemented the optional label request message ID TLV in ldpd(8).
As required by the RFC, make sure that a wildcard FEC is the one and only FEC of that message for label release and withdraw messages in ldpd(8).
Improved ldpd(8) struct mapping_entry.
Make ldpd(8) lde_check_request(), lde_check_mapping(), lde_send_labelmapping(), lde_send_labelrequest() and lde_nbr_do_mappings() follow the algorithms defined in appendix A of RFC 5036.
Allow the ldapd(8) userPassword attribute to specify a login class when using simple binds with BSD Authentication, using '#' as the delimiter.
Enabled vmt(4) in amd64 and i386 GENERIC kernels.
Make vmt(4) log suspend and resume.
Big update to vmt(4), vmware tools functionality: initiate shutdown by signalling init with SIGUSR2 when requested by the host; initiate a reboot by signalling init with SIGINT when requested by the host; report the guests hostname, first non-loopback IP address and uptime to the host; update the guests timedelta sensor using the 64bit rpc.
Added a new CF driver for octeon.
Added a fullwidth option to pkg.conf(5).
Make ld.so(1) search loaded libs first and add support for SONAME matching.
Make a workaround for PR6500 in route(8) before real fix is made in the kernel.
Improved md5(1) performance.
Fixed a rare race-based kernel crash by statically initializing TAILQ ifnet/ifg_head in ifmedia(4).
Make sdmmc(4) use iopool.
Prevent mandoc(1) from throwing FATAL when there is no need to (nested displays: .Bd containing .Bd, .D1, .D1 or a forgotten block end macro or an unstarted ending block or a failed uname(3)).
Make OpenBSD::PackingElement(3p) redirection more efficient.
Improved OpenBSD::State(3p).
Let .Bsx print just "BSD/OS" in mandoc(1) like in modern groff.
Make TCP follow SUSv4 namespace rules in includes by hiding everything but the TCP_* options unless __BSD_VISIBLE is defined. Fixes PR 6192.
Make sftp(1) escape '[' in filename tab-completion.
Updated xterm to version 264, freetype to 2.4.3.
Prevent a file descriptor leak in libedit.
Make OpenCVS use CVSROOT for cvs import and ignore CVS/Root files. Fixes PR6497.
Make usb(4) check that a timeout(9) has been initialized before deleting it.
With mandoc(1) .Sm no longer produces a line break when used in .Bd and also avoid an extra space after the opening bracket in .Op in -Thtml
Fixed boot hangs that are showing up because the kernel use usb tasks to attach/detach usb(4) devices.
Make dhclient(8) verify that the interface is registered before using it.
Fixed the bugs that prevented the RT30XX ral(4) devices from working.
Added a last-pane command in tmux(1).
Prevent tmux(1) from changing the active pane when removing a pane unless the active pane is actually the one being removed.
Fixed a crash when mixing fold(1) legacy width option (e.g. fold -70) with getopt()-style options, such as "fold -b70". Mixing the legacy width with another option is no longer permitted.
Fixed PR6492 in hexdump(1).
Prevent aucat(1) from running a destroyed stream.
Start implementing the missing label mapping messages in ldpd(8) LDE.
Make malloc(3) print the pointer value that caused the error (if available).
Make ehci(4), ohci(4) and uhci(4) disestablish interrupts if attachment fails.
Allow X to be build by disabling __thread for alpha on OpenBSD.
Merged OpenCVS rcs_deltatext_set into OpenRCS, fixing a memory leak.
Prevent ldpd(8) from printing "route vanished before delete" on shutdown.
Prevent a null pointer dereference in rcs(1) and OpenCVS if rcsparse_deltatexts is called with a revision not specified as delta in an RCS file.
Put mandoc(1) by default in man.conf(5).
Fixed a OpenBSD::PackingElement(3p) split() which was causing problems with the mbox.5 man page in Mutt.
Add a few more tcpcb and sockbuffer variables that tcpbench(1) can inspect.
Fixed a segmentation fault in ldapd(8).
Fixed ldapd(8) rejection of messages when there are multiple requests queued in the input buffer.
Make access control work for SASL and BSDAUTH binds as it does for simple binds in ldapd(8).
Make use of OpenSSL cast.h in isakmpd(8) crypto.
Improved OpenBSD::PackingElement(3p) groff(1) handling. Fixes tcl and the few ports with non-standard man locations that can't rely on mtree fake.
Improved uvideo(4).
Allow configuration of 802.11 interfaces in the OpenBSD installer.
Improved isakmpd(8) interoperability with Fortigate's devices.
Removed sup(1).
Removed vgrind(1).
Fixed a memory leak in ncurses(3).
Removed groff(1) from base, now totally replaced by mandoc(1).
Make the athn(4) driver more efficient on AR5008 and AR9003 chipsets for architecture with strong alignment constraints like sparc64.
Added MPLS and mpe(4) in GENERIC kernels.
Removed miscXX.tar.gz sets.
Added wpakey/-wpakey options to ifconfig(8).
Make the shadow password database smaller on install media kernels.
Removed various usd/psd/ssm files and references in manuals.
Added Compact Flash support to octeon.
Make udl(4) attach again.
Reverted latest smtpd(8) queue code optimizations to facilitate further improvements.
Make trm(4) work again.
In uvideo(4): added a structure that represents USB descriptor with variable sized member as in uaudio(4) and reenabled control support for devices where bControlSize is different from 2 in the processing unit descriptor.
Fixed tcpdump(8) printing of pflog(4).
Fixed filtering with new pflog(4) headers.
Fixed glob(3) using programs (notably ftp(1)) to be triggered to hit resource limits.
Fixed crash with uvideo(4) and Kodak S100 webcam.
Fixed envy(4) on big endian architectures.
Allow the ikectl(8) CA to be used with all kinds of other VPN tools in addition to iked(8) and isakmpd(8).
Improved cmpci(4).
Allow optional path for ikectl(8) install commands, assume they are relative to /etc if relative paths are specified.
Make ikectl(8) show certificate details.
Replaced old acpi(4) suspend/resume gpewalk function by separate functions for enabling wake and runtime GPEs.
Allow ikectl(8) to specify the export password on the command line.
Prevent ldpd(8) from adding MPL routes with a incoming MPLS_LABEL_IMPLNULL label.
Handle IMPLNULL labels directly in the kernel.
In ikectl(8): added a -q (quiet) command line option that will be used by ike CA to set openssl batch mode, allow to specify the initial CA password on the command line, allow to create certificate for clientAuth or serverAuth only.
Set saner permissions on ikectl(8) CA directory export, so there is no need to change perms of /etc/iked when extracting.
Make ikectl(8) create an empty but valid CRL list when a new CA is created.
Improved envy(4) physical address check.
Fixed some pms(4) versus wsmoused(8/I386) issues.
Added OpenSSL fixes: updated local engines for the EVP API change, use hw_cryptodev.c instead of eng_cryptodev.c, make x86_64-xlate.pl always write to the output file and not stdout.
Removed Skipjack from crypto(9).
Fixed physical address issue in none i386 envy(4).
Prevent from waking up at IPL_NONE instead of IPL_HIGH in i386 machine-dependent acpi code.
Fixed x_wakeup_vector condition in i386 and amd64 machine-dependent acpi code.
Zero out crypto(9) soft auth hash context before freeing it.
Prevent spamd(8) from passing GREY entries to pf(4) spamd-white table if already TRAPPED. Fixes PR6467.
Make ssh(1) kill proxy command on fatal().
Updated xterm(1) to version 262, libX11 to 1.3.6, oclock(1) to 1.0.2, setxkbmap(1) to 1.2.0, x11perf(1) to 1.5.2, xauth(1) to 1.0.5, xclock(1) to 1.0.5, xcmsdb(1) to 1.0.3.
Make tmux(1) skip NULL entries in the sessions list when choosing the next session.
Added acpi_disable_allgpes function to clear acpi(4) GPE status.
Improved rcs(1) invalid characters check.
Implicitly protect mbuf(9) m_cldrop() with splnet(9).
Added support for midi(4) to envy(4) in i386 and amd64.
Make os fingerprinting work on little endian systems. Updating pf.os(5) is mandatory if using os fingerprinting options, otherwise, the system will be blocked.
Updated pf.os(5) to match against OpenBSD -current systems. The automatic send and recv buffer scaling changed the OS fingerprint.
Added iopool to adw(4) and iha(4).
In Xenocara updated pthreads(3) aliases to version 0.3, pixman to 0.18.4.
Prevent the Dream Link USB LED Message Board from being attached as an HID device so it can be used in userland.
Synchronized octeon FPU handling with latest mips64 changes.
Make openssl(1) DES_LONG be an u_int like all platforms instead of an u_long on i386.
Turn off lidsuspend if halt -p is in progress.
Removed support for srandom and urandom.
Fix for some pms(4) pckbc handling.
Make macppc install scripts try update the boot blocks.
Updated OpenSSL to 1.0.0a.
Added nsd(8) startup logic to the rc(8) scripts.
Implemented a combus to support the com(4) devices on Octeon without modifying dev/ic/com.
Added -R option to pfctl(8) to show only a specified rule by numeric ID in combination with "-s rules" or "-s labels".
Make sure iked(8) gets transforms in the proposal before trying to parse it.
Prevent bad free() in ssh(1) when overriding AuthorizedKeys in a Match block.
In iked(8), fix padding issues and warnings from openssl.
Added ehci(4) DMA sync operations, fixes issues with macppc.
Added support in OpenCVS for update -C.
Make sure the TCP will not recalculate the rscale factor after the initial SYN is sent.
Make sure OpenRCS and OpenCVS parse all deltas before expecting "desc" keyword.
Do not delay ACKs on connections using loopback interfaces.
Implemented a per-cpu held mutex counter for all non-x86 platforms to help debugging.
Added pregenerated unicode files for perl.
Make -k work in tcpbench(1) client mode.
Added support for gamma and sharpness/acutance controls in video(1).
Added support for variable sized processing unit bmControls and for more processing unit controls in uvideo(4).
Make sftp(1) call ioctl(TIOCWINSZ) to get the window width only once instead of per-filename when performing an "ls" in columned mode.
Prevent glob(3) from freeing array before freeing members.
Removed pms(4) and ums(4) from installation media.
Unified some pool(9) and malloc(9) flag values.
Added two new options to tmux(1) : server option "exit-unattached", makes the server exit when no clients are attached, even if sessions are present; session option "destroy-unattached" that destroys a session once no clients are attached to it. These are useful for preventing tmux remaining in the background where it is undesirable and when using tmux as a login shell to keep a limit on new sessions.
Merged pmsi(4) into pms(4).
Make mandoc(1) report an ERROR if an explicit scope is still open at the end of an input file: it can still render the page by just closing the open scope, but it is likely that information will be missing or document structure mangled.
Modified tmux(1) server permissions on the socket when adding or removing +x to show attached sessions, rather than replacing them.
In mandoc(1), make no punctuation after .%* outside .Rs in .Rs, mark full stops after .%* as end of a sentence.
Make uvm(9) page daemon and uvm(9) swap configuration and io manager appear in ddb(4).
Allow mod_headers to handle RequestHeader directives known from apache2 in httpd(8).
Fixed L2TP length field in PIPEX.
Prevent cwm(1) from warping to clients marked 'ignore'.
Fixed bug in cwm(1).
Make ppb(4) respect pci_dopm, like pci(4) does and make it not try to poweroff the bridge if pci_dopm=0. Fixes Gateway LT3103u and Lenovo Thinkpad 100e netbooks, allowing them to suspend again.
Added gcc4 cross compilation support under OpenBSD.
Use snprintf(3) not sprintf(3) in a2p(1).
Make ospfctl(8) print the checksum as a simple fingerprint of the LSDB.
Make ospfd(8) build the sum of the ls_checksums when counting the lsa. It allows quick verification that two LSDBs are in sync.
Updated Compress::Raw::Bzip2(3p) to version 2.031.
Make use of new glob(3) GLOB_KEEPSTAT extension in sftp(1) to save extra server round trips to fetch per-file stat(2) information.
Make video(1) compile on static archs, and enabled it in the build for all archs.
Deactivate all vscsi(4) children when it is closed so they don't retry the commands still on the queue when killed.
Avoid potential infinite loop in bridge(4).
Added L2TP support to PIPEX in TCP/IP stack and npppd.
Updated Perl to version 5.12.2 with local patches and fix for CVE-2010-0405.
Prevent IPv6 from trying to add new addresses by making use of sleeping pools.
Switched mips-based ports to gcc4.
Bumped libc major version to 57.
In fts(3), bumped fts_level from short to int and added a spare short.
Provide IRIX-compatible get_fpc_csr(3/MIPS64) and set_fpc_csr(3/MIPS64) for mips. This will allow userland to flip the "flush denormalized to zero" setting, which is being relied upon by tcl.
Make it possible to use "dhclient egress" to refresh a lease without remembering which interface dhclient(8) was actually active on.
Added timingsafe_bcmp(3) to libc and removed it from OpenSSH. timingsafe_bcmp is also in kern(9).
Added to glob(3) a GLOB_KEEPSTAT option that retains a copy of the struct stat information that is looked up while matching globs.
Implemented if_freenameindex() in TCP/IP stack as a real function as required by POSIX.
Added stricter asserts to DIAGNOSTIC kernels to help catch mutex and rwlock issues: i386 and amd64 now count the number of active mutexes so that assertwaitok() can detect attempts to sleep while holding a mutex, i386 and amd64 check that we actually hold mutexes when passed to mtx_leave(), calls to rw_exit*() now call rw_assert_{rd,wr}lock() as appropriate.
Linked iscsid(8) and iscsictl(8) to the build.
Added vscsi(4) to GENERIC Kernel build.
Fixed bus spacing bugs in glxpcib(4/i386) and glxpcib(4/loongson).
Added iscsictl(8), the control tool for iscsid(8).
Added iscsid(8), an iSCSI Initiator daemon using vscsi(4). Currently implements the absolute minimum of the protocol to make it work against targets.
In pfctl(8) , removed the check that enforced rdr-to only inbound and nat-to only outbound.
Remove dying flags in various usb(4) devices. The flag will be set in activate()/deactivate().
Fixed before-boot umass hangs on units without media in disk(9) subroutines.
Added TCP send and recv buffer scaling. It increases download speed.
Fixed npppd to setup a PIPEX if MPPE is not required by config and CCP failed to be opened because peer doesn't support MPPE.
Prevent usb(4) from accidentally waking up.
Fixed overflow in nsd(8).
Improved mandoc(1) column alignment and handling of .Nm block wider than the column it is in.
Remove tn3270(1).
Fixed VOP_LOOKUP(9) calls with a struct proc pointer as it should have been in softraid(4), raid(4), disk(9) subroutines, NNPFS, EXT2FS, UFS.
Added cvs_mkdir() in OpenCVS for recursive directory creation on import. Fixes PR6398.
Fixed memory leak in rcs(1).
Renamed uyurex(4) to utwitch(4) and enabled it by default in all GENERIC kernels.
Make pf(4) rule counter update consistent between IPv4 and IPv6.
Make loongson mainbus(4) attach mfokclock(4/loongson) later for cpu scaling.
Correctly identify mount points when they are specified in fstab(5) using a disklabel UID. Fixes PR6471.
Included the disklabel UID in sysctl hw.disknames.
Make disk(9) subroutines provide the kernel with the disklabel which include the disklabel UID.
Introduced a DKF_NOLABELREAD flag in disk(9), which is used by a device to prevent automatic reading of disklabel on attach. Applied it in fd(4) and cd(4).
Added aes-gcm support in iked(8).
Improved MCLGETI algorithm under load in TCP/IP stack.
Prevent the usb task thread from going to sleep forever in ehci(4).
Added usb_rem_wait_task() to usb(4), a wrapper for usb_rem_task() that waits for the task to complete if the task is already running.
Added two members to usb(4) struct usb_task: "usbd_device_handle dev", the device responsible for the task (use this to not run the task if the device's hub is dying) and "int running", a flag to be set when the task is running.
Improved check of dying usb(4) bus.
Save a little time on boot thanks to a usb(4) improvement.
Reduced race during normal usb(4) device detach by making detach happen in the same process.
Added a new IP level socket option IP_PIPEX. This option is used for L2TP support by pipex.
Added an option per-read/write callback to atomicio, and added a bandwidth limit option to sftp(1).
In clct(4), use audio(4) quiesce/resume for data i/o, and ac97_resume() for mixer suspend/resume support.
Added autoconf activate, suspend/resume support in eap(4).
Added AES-GCM-16 (as aes-gcm) and ENCR_NULL_AUTH_AES_GMAC (as aes-gmac) encryption transformations support in ipsec.conf(5).
Added Support for AES-GCM-16 and ENCR_NULL_AUTH_AES_GMAC in IPSec ESP as per RFC4106 and 4543.
Added a new interface: pppx(4), the ppp multiplexer to be used with npppd and pipex. pppx(4) creates an interface whenever a session is created so that altq and pf can work on these.
Removed msgs(1) from tree.
Added AES-GCM Transform Identifiers as specified by IANA in RFC4106 and 4543 to PF_KEYv2.
Added support for the Galois/Counter Mode (GCM) for AES as described in FIPS SP 800-38D to crypto(9).
Unified npppd(8) MS-CHAP implementation to iked(8).
Make iked(8) work as an initiator with strongswan/charon without any specific phase 1 configuration.
Add DIOCGPDINFO to presto(4/sparc), xd(4/sparc), xy(4/sparc), hp(4/vax), vax RA disk device and RX MSCP floppy disk device driver.
Added new log option "matches" to pfctl(8).
Added a new pf(4) log option PF_LOG_MATCHES that forces logging on all subsequent matching rules.
Make disk(9) garbage collect struct disk field dk_label.
Added a KexAlgorithms knob to ssh_config(5) and sshd_config(5) to allow selection of which key exchange methods are used by ssh(1) and sshd(8)
Fixed a locking bug in accept(2).
Make vscsi(4) call config_deactivate() on SCSI links in vsciclose().
Avoid race with autoconf(9) in vscsi(4).
Removed physio(9) buf pointer argument.
Make npppdctl arguments match the format string in usage.
Fixed a QUIESCE crash on inteldrm(4).
Fixed null pointer dereference for protocols without port numbers in pflog(4).
Improved mandoc(1) vertical alignment.
Make inteldrm(4) always unconditionally set the C3_LP_WRITE_ENABLE bit in ARB_STATE on gen3 hardware. Prevents some 945 chipset from hanging.
Enable error interrupts on inteldrm(4) ironlake, as we do on all other chips.
Prevent mips64 based machine from panicking in MipsEmulateBranch() if the instruction is an unspecified OP_BCOND sub function.
Improved inteldrm(4).
Replace the mips64 old floating point completion code with a C interface to the machine-independent softfloat code, implementing all MIPS IV specified floating point operations.
Improved eso(4) suspend/resume.
Changed audio(4) quiescing to make it not call the audio_hw_if halt method in interrupt context, because drivers like eso(4) or envy(4) might want to sleep with their own halt method.
Avoid USBD_IOERROR in uhub(4) by determining the size of the buffer for USB hub interrupt pipe with bNbrPorts in hub descriptor.
Added a real DIOCGPDINFO to cd(4) and sd(4), allowing access to the physical information about the device rather than the contents of whichever disklabel was read.
Added watchdog suspend/resume logic to glxpcib(4/LOONGSON) and make glxpcib(4/LOONGSON) save and restore its configuration on suspend/resume.
Added '-label' option to route(8) to specify you only want to see routes having the given label.
Make tcpdump(8) show the original addresses/port too when a packet had his addresses and/or ports rewritten.
Make pflog(4) put the original (before rewriting) addresses into the already existing address fields in the pflog header, same for ports, and add a "rewritten" indicator.
Make pf(4) apply actions from the last matching pass or block rule and not the last matching rule after ruleset eval is done. Fixed PR6401.
Make ldapd(8) print a warning if schema file can't be opened.
Improved axe(4) PHY probing.
Cleaned memory shortage in PIPEX code.
In pf(4), make the "match log" rules log on the fly.
Make the mpi(4) SAS IO unit to use 32 openings when talking to SATA disks if the firmware has it configured lower.
Make aac(4) compile with gcc4.
Avoid double unlocking the drm(4) lock in drmclose().
Adapted tcpdump(8) and pflogd(8) to new pflog(4) longer header.
Made a pflog(4) overhaul to fix wrong logging of nat/rdr addresses. The pflog header is now longer.
Removed physio(9) in wdc(4) ioctl(2) handler.
Added gpio(4) at glxpcib(4/loongson) to loongson GENERIC kernel.
Added an iopool to umass(4) to prevent the kernel from panicking when multiple commands are issued when umass(4) has multiple LUNs.
Use audio(4) DVACT_{QUIESCE,RESUME} and ac97(4) ac97_resume() for suspend/resume in auacer(4) and autri(4).
Added autoconf(9) activate function to auixp(4).
In auglx(4), use audio(4) DVACT_{QUIESCE,RESUME} to handle I/O stopping/restarting for suspend/resume, and ac97(4) ac97_resume() to reset and restore the codec at resume.
Added support for newer asus boards that use a different method to poll and enumerate the sensors in aibs(4).
Added assertwaitok() to declare code paths that assume they can sleep. Updated malloc(9) and pool(9) to use it as appropriate.
Added mclgeti() support for xl(4).
Make machine-dependent splassert(IPL_NONE) work on amd64 the same as it does on i386.
Make ix(4) recompute the list_offset and data_offset when attaching a unknown SFP+ module on the 82598 controller.
Make mips64 md_printins() get the printf-like function as an extra parameter, and make it visible so that machine-dependents parts of the kernel can use it for debug messages.
Make mandoc(1) format multiple authors (.%A) in the same way as groff: two authors with "and", but without a comma; three or more with commas, and an "and" before the last one.
Prevent mandoc(1) from doing fatal errors when .Pp and .br have arguments.
Fixed length of an eap identity message payload in iked(8).
Implemented support for ldapd(8) bsdauth authentication via simple binds, not only SASL.
Added cache operations for the octeon platform.
Make smtpd(8) use the same buffer for local deliveries to files and commands.
Make snmpd(8) return error on GET requests without an instance identifier, both for tables and scalar values. Fixes PR6468 by not calling table get functions with an unexpectedly short OID. Also fixes PR6071. Scalar variables without an instance specified now returns a noSuchInstance error. GetNext requests correctly returns the .0 instance but it must be specified explicitly: $ snmpget -v2c -c public localhost SNMPv2-MIB::sysDescr.0
Allow output of null values with a context class. This is used in SNMPv2 to return an error exception value for a varbind result ("noSuchObject[0] IMPLICIT NULL" in RFC1905).
Fixed a variety of structure packing and byte order bugs in ixgb(4) to try to get BE support working.
Removed xx_shutdown() hooks in network drivers where possible, since they are taken down already via their xx_stop() routine. Done in bge(4), bnx(4), cas(4), de(4), fpa(4), lmc(4), msk(4), nge(4), pcn(4), sk(4), txp(4), pgt(4), ti(4), DEBNA/DEBNT/DEBNK ethernet cards, fta(4), fea(4).
Allow the ssh(1) session multiplexing to determine that the server socket is either ready or stale without races. Stale server sockets are now automatically removed.
Moved getpeereid(2) function declaration in kernel COMPAT_47. In 4.8 and onwards getpeereid(3) is library code using socket options.
Simplified evcount(9) by removing counters in a tree hierarchy.
Added octeon platform.
Fixed security problem in the disabled and unfinished ssh(1) handling of J-PAKE protocol.
Added a SIGHLD handler to reap ssh(1) expired child process.
Added some missing firmware to install media: ral(4) RT2860 for i386, amd64 and sparc64; run(4) RT2870 and RT3071 for landisk, macppc, socppc and sparc64.
Fixed a null pointer dereference in ciss(4).
Fixed an uninitialized variable access in uhci(4) suspend/resume.
Prevent cd(4) and st(4) from calling bufq_drain in deactivate.
Added the start of an activate function in glxsb(4/i386).
Added an activate function to get sub-devices in glxpcib(4/i386).
Added DVCAT_QUIESCE to glxpcib(4/LOONGSON).
Fixed bug in atw(4).
Initial support for the Octeon platform.
Added SIGCHLD handler to reap expired children in ssh(1).
Fixed null pointer dereference in ciss(4).
Increased rate buffer in atw(4) to prevent overflows.
Make ddb(4) recognize all MIPS IV instructions, as well as some mips64r2.
Corrected NCQ depth calculation for atapiscsi(4) devices and controllers.
Added support for 82583V devices in the em(4) driver.
Fix for em(4) initialization on ET quad 82575 cards.
Improved X11 lib handling in the ports(7)-supplied libtool.
Fixed local DoS when core-dumping elf binaries.
FPU and ddb(4) updates for mips64 CPUs.
Fixed crash in iked(8).
Various scsi detach issues fixed.
Fixed endless loop when handling punctuations in mandoc(1).
Make traceroute work through MPLS tunnels, including RFC4950 extension headers.
Fix PMTU over sppp(4) links.
Fix leaking scsi_xfers or bufs when hot-unplugging mpi(4) devices.
Fix mpi(4) event handling to ack more than one outstanding event at a time.
Fixed a bug in OpenSMTPD "Lookup agent" code.
Added DVACT_{QUIESCE,RESUME} to cleanly suspend/resume audio(4) and use it in auvia(4), auich(4), clcs(4), cmpci(4), emu(4), azalia(4).
Make tmux(1) use UTF-8 line drawing characters on UTF-8 terminals.
Make tmux(1) ignore terminal overrides settings without a value.
Fix lazy binding issue on mips64 run-time link-editor. Fixes an nm(1) crash that happens when passed multiple object files on the command line.
Provided a bus_dmamap_sync() implementation for the amd64 IOMMU. It fixes bigmem.
Added infrastructure to build gcc4 on mips64.
Prevent azalia(4) from unmuting the speaker muted by plugged headphones when the master volume control is unmuted.
Allowed hotplug of Fiber Channel devices.
Prevent sd(4) io handler from being run on a gone device.
Make gcc4 build on landisk.
Many improvements in iked(8): allowed ESP proposals without integrity and AH proposals without encryption; added additional nonce length field, use that for the ciphers that require additional keying material; setup right flow direction depending on the mode: fixes up iked(8) working as an initiator against charon.
Added an ECDH/ECDSA compliance fix to ssh(1).
Cleaned up i386 apm(4) resume/suspend code.
In tmux(1), added -n and -p flags to switch-client to move to the next and previous session.
Prevent tmux(1) from crashing if the screen size is too small for the indicator in copy mode.
Activated NTFS in i386 and amd64 GENERIC kernels.
In disk(9), introduced a disk_lookup() function which calls device_lookup(), before verifying that the resulting device is present on the disklist. This avoids a race whereby the disk driver can be accessed as soon as the softc has been allocated, but before the disk has completed initialization and has called disk_attach().
Improved crypto(4).
Added support for sender expansion in smtpd.conf: %U for sender localpart, %D for sender domainpart.
Make smtpd(8) queue and reschedule message when failing to fork a DNS process.
Make scsi(4) detach everything on the whole bus on request, rather than just a target/lun.
In the TCP/IP stack, allowed ip_forward() to know the difference between blocked packets (EACCESS) and those that can't be forwarded (EHOSTUNREACH).
Switch the MPLS blocks for RTM_CHANGE in the routine socket interface.
Permitted traceroute(8) to work over MPLS.
Make tcpdump(8) of pflog(4) interfaces work with 'net <net>' expression.
Enabled aesni for amd64. While running ipsec on amd64 with 'aes' cpu flag, it provides aes accelerated encryption in cbc and ctr modes for all three key sizes: 128, 192 and 256.
Removed the powerhook code and use the ca_activate tree traversal code everywhere to suspend/resume devices.
Fixed a potential race between cd(4) resume and detach.
Replaced all PWR_{SUSPEND,RESUME} by DVACT_{SUSPEND,RESUME}.
Prevent compiler unwanted optimization in i386 and amd64 machine-dependent bus_dmamap_sync().
Make the PCI-CardBus bridges driver save and restore pci config space registers on suspend/resume.
Fixed freezes occurring by removing CardBus cards with Ralink Technology RT2560, RT2561, RT2561S and RT2661 chipset.
Improved amd64 pmap(9).
Enabled wide character support in ncurses(3), lynx(1).
Switched to using ca_activate calls instead on powerhooks on apm(4/I386).
Fixed suspend/resume on intel agp(4).
Improved handle of PCI BAR.
Prevented ldpd(8) from crashing sometimes when calling nbr_act_session_establish() on slave systems.
Fixed an off by one in mandoc(1).
Added an ioctl to figure out the non-sticky bits in pci(4) BARs used for determining the size of those BARs. Make pcidump(8) use this new ioctl to print the size of PCI BARs.
Make the sparc tree more GCC4 friendly.
Make the v3 demangler support code compile in libiberty.
Added support to pcmcia(4) indirect Card Information Structure data. Improved and fixed a bug in pcmcia(4) CIS parts.
Added support for SiS191 in se(4), fixed bugs, and improved it too.
Removed macppc default xorg.conf(5).
In Xenocara, updated glproto to version 1.4.12, renderproto to 0.11.1, videoproto to 2.3.1. Added xextproto 1.7.2. Updated libxcb 1.7, libXi 1.3.2, libX11 1.3.5, libXfont 1.4.2.
Prevent vr(4) from seeing stale contents because of insane compiler or hardware optimizations.
Fixed athn(4) Ubiquiti SR71-12 and Winstron DMNA92 adapters.
Added an EXIT STATUS section to some /sbin, /usr/sbin and /usr/libexec man pages.
Make ldapd(8) resolve matching rules from superior attribute types at schema load time instead of when each attribute is validated.
Added an EXIT STATUS section to most /bin and /usr/bin man pages.
Implemented attribute syntax from RFC4517 in ldapd(8).
Switched ssh(1) ECDSA default key size to 256 bits, which according to RFC5656 should still be better than our current RSA-2048 default.
Fixed ControlPersist=yes for ControlMaster=yes in ssh(1).
Permitted -b 256, 384 or 521 as key size for ECDSA in ssh-keygen.
Fixed enqueue routing messages on sockets marked SS_CANTRCVMORE.
Fixed a memory leak in rcs(1) and OpenCVS.
Fixed bug in st(4).
Fixed a spurious line insertion in wscons(4).
Make tmux(1) reset running jobs when the status line is enabled or disabled.
Updated freetype to version 2.4.2.
Prevent ldapd(8) from finding syntax error when parsing schema from the subschema.
Disabled use of SIGIO by default in xserver, it breaks multi-card configuration.
Improved the consistency of the flexible buffer queue by making struct bufq a member of the softc for devices that use it.
Removed SIGIO handler from Xenocara DRI.
Added DVACT_QUIESCE (warn the device about suspend) support to ahci(4), auich(4), azalia(4), alc(4), ale(4), bge(4), em(4), lii(4), msk(4), nfe(4), sis(4), pci(4), pciide(4), ppb(4), sili(4), vga(4), pchb(4), acpi(4), dc(4), fxp(4), xl(4), pcmcia(4), wdc(4), sdhc(4), ehci(4) and pckbc(4).
Make cd(4), pccbb powerhook code call an activate function.
Cleaned up activate/deactivate functions in various drivers: pchb(4), ubt(4), sdhc(4), sis(4), nfe(4), bge(4), fxp(4), xl(4), pckbc(4), sd(4), uvisor(4), uhidev(4), usb(4), ohci(4), wd(4).
In ssh(1), implemented Elliptic Curve Cryptography modes for key exchange (ECDH) and host/user keys (ECDSA) as specified by RFC5656.
Started work to add suspend/resume for Loongson Lemote.
In ssh(1), added buffer_get_cstring() and related functions that verify that the string extracted from the buffer contains no embedded \0 characters*. It prevents random (possibly malicious) crap from being appended to strings.
Make ohci(4), pxaudc(4/ZAURUS), zaudio(4/ZAURUS), zkbd(4/ZAURUS), zssp(4/ZAURUS), zts(4/ZAURUS), lcd(4/ZAURUS), apm(4/ZAURUS), arm mainbus(4) powerhook code call an activate function.
Prevent processes from entering wi(4) ioctl when another process is tsleep'ing in it.
Disabled SVR4 compat by default in sparc GENERIC kernel.
Converted pcmcia(4) powerhook to an activate function for an(4), cnw(4), ep(4), malo(4), ne(4), ray(4), sm(4), wi(4), xe(4), wdc(4).
Avoided a race in softraid(4).
Added ddbcpu for sgi.
Fixed a race that could lead to hanging processes in libevent.
Avoided possible aliasing-related compiler issues in cd(4), ch(4), ses(4), st(4).
Makes X autoconfiguration more intuitive on machines with multiple SBus or UPA framebuffers, where wsdisplay0 isn't the console.
Make atw(4) and rtw(4) powerhook code call an activate function.
Make sure local arrays of chars are word-aligned on strict alignment architectures with gcc(1), as is done for global ones. Though not explicitly allowed by the C standard it has been historically handled correctly by most C compilers.
Fixed kernel compiling with disabled IPSEC and enabled GIF/MPLS.
Make 2nd resume work on arm and zaurus.
Correctly compute loongson memory size if less than 256MB.
Fixed an uninitialized value leading to bogus KASSERT in uvm_pmr_use_inc().
Started implementation of activate function in acpiasus(4) to replace powerhooks functions.
Fixed autoconfiguration for accelerated drivers on sparc/sparc64, currently limited to sunffb(4).
Provided a way to get < and > symbols on pckbc(4) pc101-key slovenian layouts.
Make PCI Power Management optional, and only enable it when acpi(4) attaches.
Make apm(4) runs powerhook with interrupts blocked.
Big powerhooks clean up to improve suspend/resume: make powerhook code call an activate function in various devices: sdhc(4), wi(4), neo(4), auacer(4), auglx(4), auich(4), autri(4), esa(4), eso(4), yds(4), maestro(4), ath(4), bge(4), dc(4), nfe(4), pgt(4), ipw(4), iwn(4), rl(4).
Improved sdhc(4) sdhc_activate().
Added screen blanking code in smfb(4/LOONGSON) for SM502.
Removed PWR_STANDBY from various drivers: acpiasus(4), ath(4), atw(4), pgt(4), rtw(4), esa(4), sdhc(4), ehci(4), ohci(4), uhci(4), auixp(4), ray(4).
Added screen burner support for SM712 flavour on loongson Lemote Yeeloong.
Allowed multiple interfaces to be specified instead of all or one in rarpd(8).
Fixed a memory leak in ldpd(8).
Fixed mounting of cdXX.iso and installXX.iso on hppa.
Make CardBus ral(4) suspend and resume properly on machines that keep the CardBus bridge powered up during suspend.
Prevent ftp(1) from freeing proxyurl and cookie twice in the location code.
Make tmux(1) reset any mode before freeing the buffer event when destroying a pane.
Enabled the pixman library for m68k, fixed it for hp300 and mvme68k.
Added scsi_iopool_destroy() and scsi_link_shutdown() to scsi(4).
Use lockmgr(9) instead of rwlock(9) in sdmmc(4).
Fixed a file descriptor leak in ccdconfig(8).
Updated libc time functions to tzcode2010k from elsie.nci.nih.gov.
Check for duplicate variables in the environment when setting a value via setenv(3) and putenv(3).
Fixed tip(1) .tiprc parsing.
Implemented bus_space_barrier(9) in sgi.
Avoided disable bridge interrupts on sgi platform when trying to access an unimplemented ioc3 register.
Improved azalia(4).
Worked around a rare race condition that can happen if daily(8) zaps old files from /var/tmp while pkg_add(1) is installing or updating a package and hasn't yet moved or even read some of the files in /var/tmp/pkginfo.* (typically +DESCR).
Fixed two problems in the kernel work queues.
Added support for the LSISAS2004 chips in mpii(4).
Improved ospf6d(8).
Prevent Cisco's OSPF 6 from ignoring ospf6d(8) network-LSAs.
Enabled nsd(8) to the build.
Fixed a 16 year old bug in the radix tree sorting routine for non-contiguous netmasks. It can have a huge impact on IPsec performance.
Make tmux(1) client stop calling fatal() on exit.
In Xenocara, updated libXvMC to version 1.0.6, xf86-input-vmmouse to 12.6.10, xf86-video-vmware to 11.0.2, xf86-video-mga to 1.4.13, xf86-video-nv to 2.1.18, xterm to 261.
Updated nsd(8) to version 3.2.6.
Added a flag to vis(3): VIS_ALL - encode all characters, not just invisible ones, it can be called from vis(1) withe the '-a' option.
Added Huawei E1820 to umsm(4).
Added a quirk for the apple clear orb USB speakers.
Fixed bugs in xf86-video-openchrome.
In Xenocara, updated xbproto to version 1.0.5, x11proto to 7.0.18, libXau to 1.0.6, xset 1.2.0, utils-macro to 1.10.0.
Make sysmerge display usage information as well as the error when a path to src/*.tgz isn't specified.
Fixed an mbuf leak in ATA over Ethernet driver.
Improved mandoc(1) column padding calculation.
Changed the UFS DIP macros to be aware of the FFS2 kernel option by not bothering to check the mount type when FFS2 support is omitted.
Changed hzto(9) and tvtohz(9) arguments to const pointers.
Implemented user interface for error handling in mandoc(1): -Wlevel selects warning you care about (error or fatal); -Wstop stops after parsing a file with the selected warning level; provide consistent exit status code for the selected warning level; always finish parsing each file unless fatal errors prevent it; removed the -f option and -Werror.
Prevent wsconsctl(8) from ignoring errors silently if the device could not be opened.
Prevent gcc(1) from optimizing i386/amd64 lidt() function that provide access to i386/amd64 LIDT instruction. It fixes instant reboots with bsd.rd on Pentiums with F00F bug.
Introduced a machine-independent kern.consdev sysctl(8) that will replace the machine-dependent machdep.console_device.
Fixed a leak in tmux(1).
Make tcpdump correctly decode and print GPRS Tunnelling Protocol access point names.
Updated zoneinfo database to tzdata2010l from elsie.nci.nih.gov.
Fixed a NULL pointer dereference in midicat(1) option parsing when '-' is used as filename.
Improved uaudio(4).
Fixed xserver autoconfiguration on sparc and sparc64.
Removed Linux compatibility code in hppa and hppa64 GENERIC kernel and locore.S.
Fixed a bug in the Atheros AR9003 family driver.
Fixed a division by zero in athn(4) AR9003 family chipset.
Make athn(4) stop receiving beacons from other BSS when associated in STA mode.
Removed the standard pod2man \*(C+ pre-predefined string ("C++") in mandoc(1).
Make sure mandoc(1) correctly prints .Lk arguments in -Tascii.
Make sure mandoc(1) throws away non-ASCII characters.
Added several fixes in pr(1).
On sparc, make sure fast trap handlers correctly invoke soft interrupts by marking them explicitly pending before triggering the softintr.
Added missing files (floppies and/or install.iso and/or miniroot...) in the build time SHA256 file for alpha, amd64, hppa, hppa64, landisk, macppc, mvme68k, mvme88k, sgi, socppc, sparc, sparc64, vax.
Added power management for PCI devices, currently it just put everything in the D3 (deepest sleep) state upon suspend, and restore power upon resume.
Added support for larger sparc kernels when booting from tape, and avoided stomping on PROM data below 4MB on sun4c.
Adjusted disktab(5) miniroot disklabel to changes caused by fdisk partition alignment changes.
Removed support for loading 64 bit kernels from cdboot(8/HPPA).
Fixed a gcc4 mis-alignment in rdate(8).
Improved IP stack fragmented packets handling.
Prevented tools that fork and run a captive ssh(1) for communication from failing to exit.
Enabled periodic (every 4 minutes) power amplifier calibration on athn(4) AR9285 and AR9287.
Fixed athn(4) AR9280/AR9281 chips in open-loop power control mode.
Make fsck(8) print the real device name followed by the disklabel UID in parenthesis when it is run against a disklabel UID.
Fix a one character typo on inteldrm(4) i915 that broke interrupt handling on ironlake.
Fixed xl(4) memory corruption after resume.
Corrected a format string in ccdconfig(8).
Fixed a off-by-one bug in NTFS.
Disabled the RTC periodic interrupt on i386 and amd64 to fix problem like Dell Inspirion 4150 waking up immediately.
Plug several resource leaks in gzsig(1).
Make the number of vnode(9)s correspond to the number of buffers in buffer cache.
Fixed a logic problem which could in theory cause pfctl(8) to recursively print anchors with wildcards when not requested via the command line but in practice only applied to automatically generated inline anchors (which don't have wildcards) or when recursion was requested.
Forbade duplicate tmux(1) session names from being created.
Added support for terabytes units with disklabel(8) editor 'T' command.
Make tmux(1) list panes command show which pane is active.
Fixed two problems in gdt(4), introduced in 4.7: eliminate a use-after-free of xs for xs->flags, avoid calling scsi_done() twice when synchronizing disks during shut down.
Remove extra '.' from less(1) -m prompt string.
--------
Changes made between OpenBSD 4.7 and 4.8
RELIABILITY FIX: the sis(4) driver may hand over stale ring descriptors to the hardware if the compiler decides to re-order stores or if the hardware does store-reordering.
A source code patch is available.
[Applied to stable]
SECURITY FIX: PF rules specifying address ranges (e.g. "10.1.1.1 - 10.1.1.5") were not correctly handled on little-endian systems (alpha, amd64, arm, i386, mips64el, vax). Other address types (bare addresses "10.1.1.1" and prefixes "10.1.1.1/30") are not affected.
A source code patch is available.
[Applied to stable]
SECURITY FIX: An incorrectly formatted ClientHello handshake message could cause OpenSSL to parse past the end of the message. An attacker could use this flaw to trigger an invalid memory access, causing a crash of an application linked to OpenSSL. As well, certain applications may expose the contents of parsed OCSP extensions, specifically the OCSP nonce extension.
Applications are only affected if they act as a server and call SSL_CTX_set_tlsext_status_cb on the server's SSL_CTX. It is believed that nothing in the base OS uses this. Apache httpd started using this in v2.3.3; this is newer than the version in ports.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: sp_protocol in RTM_DELETE messages could contain garbage values leading to routing socket users that restrict the AF (such as ospfd) not seeing any of the RTM_DELETE messages.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: Bring CBC oracle attack countermeasures to hardware crypto accelerator land. This fixes aes-ni, via xcrypt and various drivers: glxsb(4), hifn(4), safe(4) and ubsec(4).
A source code patch is available.
[Applied to stable]
SECURITY FIX: Insufficent initialization of the pf rule structure in the ioctl handler may allow userland to modify kernel memory. By default root privileges are needed to add or modify pf rules.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: Fix a flaw in the OpenSSL TLS server extension code parsing which could lead to a buffer overflow. This affects OpenSSL based TLS servers which are multi-threaded and use OpenSSL's internal caching mechanism. Servers that are multi-process and/or disable internal session caching are not affected.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: The vr(4) driver may hand over stale ring descriptors to the hardware if the compiler decides to re-order stores or if the hardware does store-reordering.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: Non-Maskable Interrupt in pci(4) device mapping.
A source code patch is available.
[Applied to stable].
RELIABILITY FIX: Uninitialized memory may force the RDE into route-collector mode on startup and may prevent bgpd(8) from updating or announcing any routes.
A source code patch is available.
[Applied to stable]
Fixed a bug in pkg_add(1).
Improved disklabel(8) editor prompt for the 'R' (resize) command.
Make sure hardware and software are synchronized in auich(4).
Added suspend/resume handler for radeondrm(4).
Closed race between the acpi(4) thread and wscons(4) ioctls running in process context.
Added suspend/resume for auich(4).
Make vga(4) try to save the vga hardware state around suspend.
Moved to 4.8 release status.
Make ioapic(4) restore the APIC ID to what we set it to at boot.
Activated malo(4) function for suspend/restore.
ssh(1) version 5.6.
Make disklabel -p slightly nicer by accepting capital letters and printing a more useful error message for invalid ones.
Make ehci(4) silence BIOS takeover failure messages on unsuspends.
Make acpi(4) report sleep state on RAMDISK kernel.
Fixed bug that could lead to panic in NTFS.
Fixed bug in pkg_add(1).
Added suspend/resume functions to aliagp, viaagp and amdagp.
Improved sisagp suspend/resume.
Allow a mdoc(7) initial macro on a line to be delimited by a space or a tab (as groff(1) behaviour).
Fixed bug and memory leak in relayd(8).
Make intelagp save and restore registers on suspend/resume.
Preserved blank lines at the end of .Bd -literal in mandoc(1) -Thtml output.
Enforced acpi(4) register access restrictions.
Make acpiac(4) and acpibat(4) generate power change events for APM. Makes power up and power down scripts work with ACPI.
Avoided panics when detaching a partially attached pgt(4) device.
Added resume support for com(4).
Upon resume, make acpi(4) notify all the acpiac(4) and acpibat(4) drivers to update their status.
Improved pkg_add(1) dependencies check.
Make init(8) disable lidsuspend when powering down.
On resume, make the host RNG reactivate on the pchb(4) host bridges that need it.
Added initial support for com(4) at puc(4) or isa(4) suspend and resume.
Corrected a problem in bgpd(8) which could cause the wrong af to be displayed.
Fixed suspend/resume bugs with inteldrm(4) i915 chipsets.
Fixed suspend/resume bugs with intel i810 chipsets.
Fixed bug in libsndio.
Added suspend/resume for bwi(4).
Added ca_activate handler in xl(4), sis(4), fxp(4) and nfe(4) for suspend/resume.
Fixed a bug in bktr(4).
Added a new i386/amd4 sysctl(8) entry: machdep.lidsuspend which decides whether a lid close causes a suspend.
Added suspend/resume support for sili(4).
Removed the AML parser from acpidump(8).
Improved acpibtn(4).
Fixed traceroute(8) via pf(4) by splitting pf_icmp_mapping() into IPv4 and IPv6 sections.
Improved acpi(4) to allow some machines to have more than one suspend cycle.
Added Windows 2009 to the DSDT valid OSI table.
Avoided a tail queue corruption in pckbc(4).
Make the caps/num/scroll lock keys on btkbd(4) to lit correctly the LEDs instead of panicking.
Fixed bugs in ssh(1) local/remote window calculation for datagram data channels.
Added ca_activate handler in dc(4) for suspend/resume.
Explicitly disable ftgl in xlock(1).
Disable bce(4) in i386 GENERIC and RAMDISK kernels.
Improved athn(4) and ath(4) resume.
Added suspend/resume support for PCI ral(4) devices.
Make atapiscsi(4) cdroms attached to pciide(4) wake up.
Make sure xkblayout is not set from wscons(4) setting if specified in xorg.conf.
Let mandoc(1) render literal displays correctly when there is more than one macro on an input line.
Fixed keylength for aes-128-cbc in isakmpd(8) quick mode.
Updated zoneinfo database to tzdata2010k from elsie.nci.nih.gov.
Make acpi(4) print supported sleep states to dmesg.
Fixed a bug in em(4).
Make tcpdump(8) print the MTU in OSPF dd packets.
Activated function for suspend/resume in wi(4).
Added support for CA keys in ssh-keygen(1) PKCS#11 tokens.
Added fixes from upstream to XCB in Xenocara: various memory leaks, ensure get_wm_class_from_reply returns a valid C-string.
Enabled certificates for host based authentication in ssh(1).
Make MAKEDEV create two more USB device nodes by default.
Make sd(4) stop attempting to read or write caches on USB disks.
Added support for 82576 fiber adaptors for the em(4) Ethernet devices.
Prevent pkg_add(1) update from silently ignoring a pkgpath problem.
Make inteldrm(4) i915 light up after unsuspend.
Fixed a leak in ypldap(8).
Improved disklabel(8).
Allowed usbhidctl(1) to be used on ukbd(4) and ums(4).
Fixed knote(9) handling for exiting processes.
Ignore SIGPIPE in smtpd(8) message enqueueing as it prevented /usr/sbin/sendmail from relaying the server diagnostic back to the user.
Suppressed MAKEDEV(8) warnings about 'unknown device' that can appear during upgrades when /etc/fstab is using disklabel UID's to mount partitions.
Prevent an illegal struct from casting in carp(4).
Make pcidump(8) show PCIe link/speed.
Make pciide(4) save/restore more registers at suspend/resume for those chips which look like they need it or don't, when it appears they don't need it.
Fixed readlink(2) on FFS and ext2 file systems to consistently return EFAULT when appropriate.
Improved USB keyboard support to permit rogue keyboard to attach and be usable to a certain extent.
Added infrastructure to build GCC 4.2.1 on sparc platform.
Make remote(5) parsable again by tip(1).
Fixed switching back from a text VT in usbtablet(4) and make it avoid stealing the keyboard or other input device events.
Prevent ftpd(8) from letting regular users logging in during anonymous-only mode (-A).
Improved pkg_add(1).
Merged mandoc(1) version 1.10.5 with feature -Tpdf now fully working and bug fixes: proper handling of quoted strings by .ds in roff, allow empty .Dd, make .Sm start no-spacing after the first output word, underline .Ad, minor fixes in -Thtml.
Fixed X server mysteriously exiting on macppc platform.
Added support for M-audio Audiophile 192k in envy(4).
Fixed an infinite loop in OpenCVS.
Fixed ym(4).
Removed the 'midisyn' framework and anything using it: the opl device and the midi interface to pcppi(4).
Updated xrange to version 1.3.3, libpciaccess to 0.12 and sessreg to 1.0.6.
Prevent midi devices from attaching as uaudio(4) that could lead to leave a phantom uaudio(4).
Fixed Python 2.6 build on hppa.
Improved pckbc(4).
Make "netstat -rvA" not print "Label" caption.
Avoided an xclock bus error on sparc64.
Make route(8) and netstat(1) print a column with the routing label if "netstat -vr" or "route -v show" are called with the -v switch.
Improved ipw(4), iwi(4), iwn(4) and wpi(4).
Added -U and -C to specify context length for OpenCVS diff command.
Added suspend save/restore for SIS3112.
Make acpi(4) delay suspend a bit longer before giving up, it fixes machines that sometimes don't suspend.
Added ca_activate handler in alc(4) for suspend/resume.
Added suspend/resume for bce(4).
Fixed lint(1) compilation on gcc2 platforms.
Make sure to stop DMA before suspend in re(4), bge(4).
Update xserver to version 1.8, xf86-input-keyboard to 1.4.0 and xf86-input-mouse to 1.5.0.
Added support for multibyte characters in libc, installed the en_US.UTF-8 ctype locale support file, and allow the UTF-8 ctype locale to be enabled via setlocale(3) (export LC_CTYPE='en_US.UTF-8').
Make acpi(4) set the sleeping indicator light on machines that support it.
Added ldapd(8) to rc(8).
Fixed video on HP Pavilion dv7-3160us on resume.
Fixed docked Thinkpads hang at boot.
Added scsi_cmd_rw_decode() in scsi(4) for decoding any SCSI READ or WRITE command, and update atapiscsi(4) to make use of it.
Added additional notify handler for acpidock(4), according to ACPI specifications.
In disklabel(8), make sure FFS inputs and outputs are aligned for optimal performance on newer disk that lie about their sector size.
Added acpiasus(4) to amd64 GENERIC kernel.
Make ale(4) back after resume on eeepc 1000HE.
Improved pkg_add(1) update progress message.
Make lii(4) back after resume on eeepc701.
Added a framesize quirk for Microsoft LifeCam in uvideo(4).
Turn on -Wsystem-headers by default in gcc(1).
Fixed watchdog timeout issues on em(4).
Added acpisony(4) to support Sony ACPI hotkeys. Currently it only supports the suspend button.
Fixed a bus error in ldapd(8) B-Tree.
Improved rthreads by correcting the links between threads, processes, pgrps and sessions.
Synchronized mandoc(1) with upstream, adding bug fixes: do not let mdoc(7) .Pp produce a newline before/after .Sh, avoid double blank lines related to man(7) .sp and .br, let man(7) .nf and .fi flush the line, let "\ " produce a non-breaking space, discard \m colour escape sequences, map undefined 1-character-escapes to the literal character itself; and new features: support the .in macro in man(7), support minimal PDF output, support .Sm in mdoc(7) HTML output, support .Vb and .nf in man(7) HTML output, complete the mdoc(7) manual.
Updated a lot of fonts packages in Xenocara.
Added portslock cleaning in daily(8).
Make DVD play again with cd(4).
Extended lint(1) to make it handle C99's _Bool and _Complex plus some GCC extensions (__real__ and __imag__ operators, the use of '~' for complex conjugation, and 'i' or 'j' as a suffix for complex constants).
Fixed dead locks in tmux(1).
Make elroy(4/HPPA) converts PCI addresses to proper 64-bit physical addresses on hppa64.
In Xenocara, updated xmore to version 1.0.2, xf86-video-ark to 0.7.3, xf86-video-chips to 1.2.3, xf86-video-rendition to 4.2.4, xf86-video-sisusb to 0.9.4, xf86-video-trident to 1.3.4, xf86-video-tseng to 1.2.4, xf86-video-voodoo to 1.2.4, DejaVu TrueType fonts to 2.31, fonts/encodings to 1.0.3, font/alias to 1.0.2.
Added check for vblank_mode in DRI2 GLX code.
Added config query extension to Xenocara DRI2.
Work around the recent Xenocara slowing down caused by mesa changes.
Make pmap(9) pmap_extract() work for large pages on hppa64.
Fixed an uvm(9) safe lock causing panics.
Moved to 4.8-beta.
Fixed a race in vscsi(4).
Added suspend/resume to pms(4).
As latest GNU patch, make patch(1) sends normal output to stdout instead of stderr.
Fixed a memory leak in ci(1).
Make ftp(1) handle non standard redirection to relative URL in the 'Location:' header of HTTP responses.
Prevent smtpd(8) from exiting on a fatal error when it permanently fails a bounce delivery.
Make sure the call to reboot(2) is reached without being killed by some other processes in reboot(8).
Changed the strategy for using the FPU in the amd64 kernel. The kernel FPU state is now shared with all processes and threads.
Fixed a leak of FPU and SSE registers content between processes in machine-dependent initialization of amd64 and i386.
Added support for playback sync endpoints in uaudio(4).
Imported video(1) in Xenocara. video is an application for recording and/or displaying images from a video(4) device.
Improved vscsi(4) protection against opening by multiple processes at the same time.
Added suspend/resume to iwn(4).
Permitted pipe(2), setresgid(2), setresuid(2) in policy for chrooted named(8).
Improved suspend on laptops by giving wd(4) more time to complete the STANDBP IMMED command.
Fixed a tmux(1) crash.
Make pciide(4) save and restore as many registers as it can from front-ends chips. More to be added, chip by chip.
Improved wd(4) resume.
Fixed the "no changes" detection in ci(1) when a file has RCS keywords.
Removed the VM_KMPAGESFREE sysctl.
Fixed a NULL pointer deref in iked(8).
Added suspend/resume to wpi(4).
Improved vnd(4) buffer error handling.
Make pckbc(4) keyboard reset on resume.
Added support for disable and enable states for the pckbc(4) mouse for suspend/resume.
Big cleanup of SMALL_KERNEL macro in acpi(4).
In amd64 AES CTR mode, fixed counter increment for buffers larger than 64 bytes.
Make systat(1) -N resolve network addresses.
Prevent a process from entering wpi(4) wpi_ioctl() while another process has called a tsleep(9) in wpi_init().
Fixed various regression in scsi(4) due to scsi_scsi_cmd() removal.
Prevent a .Nm block from getting a special handling as in the SYNOPSIS when being used as a normal in line element.
Make systrace(4), crypto(4), pty(4) use ENODEV instead of read()/write() functions.
Make ypldap(8) search filter ldapd(8) compatible.
Fixed NULL deref in ypldap(8).
Improved FPU context checking when an IPI occurs on amd64 and i386.
Added suspend/resume to athn(4).
Added quirks for E-MU 0202 in uaudio(4).
Make OpenCVS "ci" and ci(1) use username when author is NULL.
Disabled vscsi(4) in the GENERIC kernel.
Added bits for USB 2.0 playback support in uaudio(4).
Make uaudio(4) support 24-bits encodings (and removed support 16-bit big endian encodings).
Make acpitz(4) print to dmesg the temperature that will provoke critical temperature shutdown.
Prevent iwn(4) from timeouting when stopping DMA channels.
Added OpenSSH's timingsafe_bcmp() to libkern and switched some obvious network stack MAC comparisons from bcmp(3) to timingsafe_bcmp().
Improved filesystem stability during suspend by using bufq_quiesce() and bufq_restart() on i386 and zaurus.
Improved acpi(4) interrupt controller.
Improved tsleep(9) usage in acpiec(4), acpitz(4), preventing troubles with wakeup(9).
Fixed a bug in the flexible buffer queue API.
In make(1), allowed variables SysV modifiers, added :QL modifier.
Fixed bug in hostap mode for the Ralink RT2860, RT3090, RT3390, RT3562 chipset driver.
Use new callback in ieee80211(9) hostap mode to notify the driver when a STA leaves the BSS.
Fixed handling of hidden symbols for the gcc(1) Binary File Descriptor library on the hppa platform.
Added a "ControlPersist" option to ssh_config(5) that automatically starts a background ssh(1) multiplex master when connecting.
Improved LSA handling in ospfd(8).
Added a quirk in uaudio(4) to allow attaching devices which are audio class compliant enough even if the device claim to have a vendor defined interface class.
Fixed bug in sftp(1).
Updated termcap(5) from upstream ncurses-5.7-20100717.
Fixed cproj(3) family to not return garbage on finite arguments.
Fixed a bug in sftp(1).
Updated termcap(5) from ncurses-5.7-20100717.
Added support for VBLANK in drm(4).
Avoided going back to sleep/reboot/shutdown immediately after resume by clearing acpi(4) event status on resume.
Make xf86-video-wildcatfb driver compatible with Xorg 1.8.
Repaired Gdium support on loongson.
Gave each arc(4) devices on the bus full openings.
Added support for Winbond/Nuvoton W83627DHG-P in wbsio(4).
In Xenocara, updated xf86-video-dummy to version 0.3.4, xf86-video-neomagic to 1.2.5, xf86-video-sis to 0.10.3, libXcomposite to 0.4.2, libXdamage to 1.1.3, libXfixes to 4.0.5, libXrender to 0.9.6, libXext to 1.1.2.
Patched freetype from upstream to fix CVE-2010-2497 freetype integer underflow, CVE-2010-2498 freetype invalid free, CVE-2010-2499 freetype buffer overflow, CVE-2010-2500 freetype integer overflow, CVE-2010-2519 freetype heap buffer overflow, CVE-2010-2520 freetype buffer overflow on heap.
Many diff(1) improvements.
Make strip(1) exit with an error if an objfile could not be read.
Added more timing paranoia in ssh(1).
Make diff(1) return 2 on error.
Improved systat(1) terminal capabilities.
Improved mandoc(1) .Sm macro and end of sentence recognition.
Make mpii(4) use iohandlers to acknowledge asynchronous events.
Fixed antenna diversity on Atheros AR5416, AR5418, AR9160, AR9220, AR9223, AR9280, AR9281, AR9285, AR9227 and AR9287 chipsets.
Make OpenCVS "diff" command and rcsdiff(1) die if pread(2) fails.
Prevent MetaGeek Wi-Spy 2.4i from attaching to uhid(4).
Make pkg_add(1) store openssl error output during verification, and log it if it didn't work.
Added 'bps' and 'msb' members to audio(4) structs audio_encoding and audio_prinfo. They respectively describe the number of bytes per sample and data alignment in the sample.
Fixed panic due to virtual memory map lock in uvm(9).
Fixed double active connections printing in netstat(1).
Implemented videopoll() for video(4).
Fixed a MRT file descriptor leak in bgpd(8).
Prevent ioprbs(4) from always reporting success on read/write requests even if they failed or only partially completed.
Make the routing table sockets, ospfd(8), route(8) notify about lost packets with new message RTM_DESYNC.
Fixed bugs in em(4).
Prevent OpenCVS from silently overwriting untracked local files with newly-added repository files.
Improved OpenCVS conflicts recognition.
Fixed ci(1) segfault when used with -l option and a zero byte long message. Fix added to OpenCVS RCS too.
Fixed a kernel panic caused by an integer overflow in FFS allocator.
Added a DMA allocator in the kernel: dma_alloc() and dma_free().
Handled Tm macro in makewhatis(8).
Fixed a bug in makewhatis(8).
Fixed pflow(4) display in rule printing.
Fixed iop(4) dmesg printing.
Avoided a double free(3) in ldapd(8).
Make sure rc(8) delete all files in /tmp at boot.
Implemented a timing_safe_cmp() in ssh(1) to compare memory without leaking timing information by short-circuiting like memcmp() and used it for some of the more sensitive comparisons.
Fixed a broken mask for Core 1 and 2 temperature and bias properly for degC in itherm(4).
Fixed PR 6376 in pthreads(3).
Merged mandoc(1) to release 1.10.4: proper .Bk support, mostly finished -Tps output, implemented -Thtml output for .Nm blocks and .Bk -words, allowed iterative interpolation of user-defined roff strings. Plus bug fixes and performance improvements.
Expand %h to the hostname in ssh_config(5) Hostname options.
Make ExitOnForwardFailure work with fork-after-authentication for -f option of ssh(1).
Updated libevent to version 1.4.14b: fixed memory-leak of signal handler array with kqueue, make evutil_make_socket_nonblocking() leave any other flags alone, adjusted fcntl() retval comparison on evutil_make_socket_nonblocking(), re-added event_siglcb, fixed a free(NULL) in min_heap.h, clean up properly when adding a signal handler fails.
Fixed bugs in OpenBSD::State(3p).
Make tmux(1) print an error when an old client is not compatible with a new server.
Reduced delays a bit in the miibus read/write routines for re(4).
Added bootstrap loader to the beagle platform.
Added support for sun4e on the sparc platform.
Updated libpciaccess to version 0.11 in Xenocara.
Prevent clients from hanging on ldapd(8) by retrying requests when the B-Tree is busy.
Fixed aucat(1) parameter handling: don't try to open a "default" midi port if no files are given on the command line.
Fixed a kernel panic in scsi(4) by limiting SCIOCCOMMAND and ATAIOCCOMMAND requests.
Rewrote the polling codepath in mpii(4), make it better multiprocessor-safe.
Make OpenCVS and rcs(1) conforms to GNU cvs(1) allowed characters in symbol/tag names.
Made cvs_unedit_local() OpenCVS conform to other functions with the '-t' and '-n' flags used simultaneously.
Fixed cross build problem with cpp(1).
Added support for using IPsec in multiple rdomains.
Fixed table removing bugs in the kernel resident routing tables.
Allowed to reduce the messages sent to AF_INET or AF_INET6 only daemons in the routing table sockets.
Fixed pkg_mklocatedb(1).
Fixed an ospf6d(8) crash.
Fixed bulk update bugs on pfsync(8).
On the i386 platform, removed aha(4), tl(4) from the RAMDISK kernel; geodesc(4/I386), gdt(4), twe(4), iha(4), adw(4), xl(4), exphy(4) from the RAMDISKB kernel; ne(4), nsphyter(4), rlphy(4), bmtphy(4) from the RAMDISKC kernel. Those kernels went too big after the gcc4 switch.
Prevent fsck_ffs(8) from crashing by using correct types for block numbers, those can grow big on very large filesystems.
Many improvement on the bge(4) interface: setup proper mbuf pool watermarks for BCM5717 / BCM57765 chipsets, disabled initiation of multiple DMA reads for BCM5717 chipset, added a performance tweak for BCM5785 chipset, corrected the return ring count used for BCM5717 / BCM57765 chipsets, fixed fibre media detection for BCM5717 chipsets.
Updated sudo to version 1.7.2p8.
Added mapping for ACPI device to PCI bus/device/function.
Switched hppa, i386 and powerpc to gcc4.
Make traceroute(8) parse extended ICMP messages defined by RFC 4884.
Added definitions in the TCP/IP stack for ICMP extended headers available for some ICMP messages like time exceeded messages.
Use config_activate_children to get down to the ISA bus activation code.
Prevent devices without read or write functionality from returning ENODEV to the poll.
Improved pipex.
Improved aesni.
Moved crypto(4) pool initialization to init_crypto and removed the crypto_pool_initialized variable. This prevents crypto_getreq() from checking if the pool is initialized each time its called.
Make ifstated(8) print run commands in debug mode only (ifstated -d).
Fixed deadlocks on sparc64.
Added mpi_wait over to mpii(4) as a multiprocessor-safe mechanism: sleep while waiting for a command to complete.
Made mpii(4) more multiprocessor-safe.
Improved siop(4).
Created distinct entry points functions for sun4/4c and sum4m as the bits in their interrupt enable register are completely different (intreg_clr_44c() and intreg_clr_4m() instead of ienabic(), intreg_set_44c and intreg_set_4m instead of ieanb_bis()).
In acpi(4), use spl(9) spltty() to lock downcalls from apm(4) against the information being modified by the acpi(4) thread.
Make "apmd & zzz" work correctly.
Prevent ldapctl(8) from segfaulting if "ldapctl stats" is run when a database is being reopened due to compaction.
Make aucat(1) try to detect busy loops caused by misbehaving audio drivers or hardware. If a busy loop is found, then close the device that caused the loop.
Fixed a memory leak in ldapd(8).
Added owctr(4), a driver for the externally triggered counters on the Maxim/Dallas DS2423.
Enabled FIFO IO for sd(4) devices.
Improved the event notification on mpi(4).
Moved the last direct uses of mpi_{get,put}_ccb over to using the scsi_iohandler wrappers in mpi(4).
Make aucat(1) handle all streams (audio files and client connections) the same way. Cleaned command line options: stream parameters (-Ccehjmrtvx) must precede stream definitions (-ios) and per-device parameters (-abz) and stream definitions (-ios) must precede device definitions (-f). Since there's no "server" and "non-server" modes anymore, the -l option just detach the process.
Make ospf6d(8) advertise a intra-area-prefix-lsa with all prefixes for the network if there are any adjacent neighbors on link.
Removed compat_bsdos(8).
Fixed ldapd(8) update writing to the B-Tree while having a cursor open on the affected pages.
Fixed use after free in ypldap(8).
Fixed a memory leak with transaction abortion on ldapd(8).
Fixed an NFS crash on sparc.
Make sysmerge(8) automatically install missing users/groups.
Fixed failure on resume on some machines by resetting acpi(4) SCI_EN on resume.
Make ^D handling consistent in fdisk(8).
Improved iked(8) non-debug logging messages when a session is established/closed.
Implemented rudimentary support for user defined strings in mandoc(1).
Make the i386 kernel responsible for saving the FPU state before running signal handlers.
Removed getrdomain(2) and replaced it by getrtable(2). It fixes the naming of interfaces and variables for rdomain and rtables and make possible to bind sockets (including listening sockets) to rtables and not just rdomains. You'll need to remove /usr/share/man/cat2/[gs]etrdomain.0 after this.
Removed ss(4) and usscanner(4) from all kernels.
In pfctl(8), fixed recursive printing of wildcard anchors, fixed printing of multi-part anchor paths, added a warning to prevent users from specifying multi-component names for inline anchors.
Make sd(4) stop on suspend and start again upon resume.
Added itherm(4), a driver for Intel 3400 Thermal Sensor.
Implemented translation of the SCSI START STOP UNIT command.
Added proper locking around vinvalbuf(9) in NTFS.
Fixed the return value of pmap_steal_memory() on hppa64.
Saved some space on RAMDISKs kernels.
Added new workaround for PCH devices in em(4) and make an Intel GbE 82578 PHY actually work.
Provided an iopool in arc(4).
Removed support for compat_sunos(8).
Fixed bugs in npppd.
Dropped fill_eproc() from SMALL_KERNELS.
Allowed systat(1) to print date and time when in raw mode.
Passed and saved state in pkg_add(1) repository related libraries, used to print all error messages.
Make sdmmc(4) be detached and re-attached on resume.
Allowed softraid(4) to implement seamless transitions from the previous metadata version to current version without needing to recreate the softraid volume by determining the data offset using a variable specified within the softraid metadata.
Improved ciss(4) sensor setup loop.
Make ath(4) come back after resume without having to manually ifconfig(8) it again.
Improved tip(1).
Allowed clients to present custom editing forms in ldapd(8).
Added more MCP79 AHCI ids to the list of devices that need special handling in ahci(4).
Fixed bad sshd_config(8) options parsing with quoting string (e.g. 'AllowUsers "blah blah" blah').
Fixed pci(4) uninitialized variable warning.
Recent uvm(9) changes exposed an eight year old bug in the network stack: an item was reference after it has been returned to the pool.
Fixed an error handling in fdisk(8).
Prevent ldapd(8) from validating modification of immutable attributes in the namespace if configured with relaxed schema checking.
Forbid deletion of non-leaf nodes in ldapd(8).
Fixed memory leaks in ldapd(8) schema parser and B-Tree.
Added ability to limit memory presented to kernel at boot with 'machine memory =128M' style commands on i386 and amd64.
Added Lenovo Thinkpad X100e quirk for vga_pci.
Mobility Radeon HD 4870 works with drm(4).
Avoid register leaks into new i386 or amd64 process images.
Added more support for ARMv7 on the arm platform.
Allowed .nr nS to force SYNOPSIS-style .Nm indentation outside the SYNOPSIS in mandoc(1).
Make i386 and amd64 synchronize FPU state instead of flushing them before suspending.
Implemented vslock_device() and vsunlock_device() and used them for physio(9).
Fixed memory leak by adding a missing free(3) in ospf6d(8) and ospfd(8).
Corrected handling of trailing punctuation in .Nm block headers in mandoc(1).
Remove PAGEFASTRECYCLE option from the generic kernel.
Removed obsolete docs from the source tree.
Implemented LDAP compare operation in ldapd(8).
Constrained malloc to only grab pages from DMA reachable memory.
Allowed uvm(9) to swap when there is more memory than what can be DMA.
Make deeply nested dlopen(3) binaries start faster.
Switched getpeereid(3) from system calls to library routines by using getsockopt(2) with SOL_SOCKET and SO_PEERCRED.
Improved pkg_add(1) debug mode.
Make ldapd(8) parse and ignore schema extensions with an X- prefix.
Removed compat_ibcs2(8).
Follow POSIX (IEEE Std 1003.1, 2004 Edition) in the implementation of the sed(1) "y" (translate) command.
Allow [ to be used as a delimiter in sed(1).
Make wsconsctl handle more than the first keyboard, mouse and display.
Make ciss(4), ips(4), vga_pci compile with SMALL_KERNEL.
Improved mandoc(1) .Nm indentation in the SYNOPSIS.
Fixed terminal mode restoration after suspending scp(1).
Added support for disklabel UIDs in bioctl(8).
Make ldapd(8) reset number of revisions after B-Tree compaction.
Fixed statistics loss in ldapd(8).
Improved scsi(4) by killing struct scsi_device.
Provided safepri value and uvm(9) constraints to hppa64 machine-dependent initialization code.
Allowed easier canceling of bad requests in ldapd(8).
Added a man page to npppdctl(8).
Fixed a null pointer dereference and two possible null pointer assignment in ldapd(8).
Saved memory on sparsely populated scsi(4) buses.
Prevent code paths from exposing uninitialized memory to user space or devices in scsi(4).
Fixed ncr(4) on vax.
Prevent a thread kill(2) from sending the signal to a separate process.
Added screen types and emulations in wsconsctl(8).
Make it possible to get the screen types and emulations for a wsdisplay(4).
Removed dead assignments in ldapd(8).
Added support in iked(8) for the tap extension that will tell the kernel to send all IPsec traffic for derived SAs to the specified enc(4) interface instead of enc0.
Added support in ipsecctl(8) for dumping the pfkey ADB_X_EXT_TAP extension to communicate the encX interface unit for a specified SA between userland and kernel.
Allowed to specify an alternative enc(4) interface for an SA.
Removed GENERIC kernel compatibility with OpenBSD 4.3.
Fixed subordinate bus number for multi-root PCI buses.
Handled special vga(4) cards for resume on i386 and amd64.
Checked ldapd(8) modify don't add immutable attributes.
Cleaned up now irrelevant TODOs and READMEs in the tree.
Improved performance on some disks (those that have 4K sectors but report 512B), by making 'fdisk -i' start the partition on a power of 2 block boundary.
Improved ldpd(8) for future multipath routes support.
Silenced the activation debug reporting in the kernel to prevent possible interactions when printing vga states.
Fixed an ldapd(8) crash by making it stop pruning page cache directly when adding to it.
Prevent disklabel(8) editor from crashing when pressing ^D.
Removed compat_osf1(8).
Improved error reporting in mandoc(1): avoid error exit after warnings, added ERROR: and FATAL: to messages.
Added SOL_SOCKET and SO_PEERCRED support to getsockopt(2).
Make ldapd(8) validate that an entry can't belong to an abstract object class directly.
Added a global root user that is allowed to read/write entries in all local namespaces to ldapd(8).
Silenced the activate function when unknown events are given to scsibus.
Fixed mg(1) buffer problems.
Use a SLIST for the ccb free list in ips(4) and mfi(4).
Make sd(4) flush its cache before suspend.
Make sure pthreads(3) FPU state is aligned on a 128-bit boundary on i386 as it is on amd64.
Make tcpdump(8) print MPLS label as decimal instead of hexadecimal.
Fixed route label in pf(4) control device.
Better handling detaching of cd(4).
Fixed ldapctl(8) stats, avoided a null pointer dereference when reopening a namespace.
Fixed arguments to fpu_kernel_enter() and fpu_kernel_exit() on the amd64 platform.
Modernized pkg_merge(1).
Improved the AD1848 Parallel-Port 16-Bit SoundPort Stereo Codec.
Allowed recording to work for Crystal Semiconductor CS4231 Audio Codec/mixer chip when there is only one DMA channel.
Lots of improvements in pkg_add(1) around the new OpenBSD::State(3p) API.
Improved ucom(4).
Added support for Ironlake (clarkdale and arrandale, i.e. core i3 and core i5 internal graphics) to intel agp(4) and intel drm(4). Mostly works, but the suspend/resume handler doesn't put the registers back 100%.
Make ExpressCard hotplug work after suspend/resume cycle by saving PCIe slot control and status register.
Reworked ldpd(8) network distribution so all path of an active route are sent to the lde so it can assign remote labels to all of the paths.
Fixed uhci(4) on numerous machines by preserving and restoring BARs on suspend/resume for all pci(4) devices.
Make ldapd(8) validate that all attributes are allowed by any of its object classes.
Synchronized ldpd(8) kroute.c with ospfd(8) one for future multipath routes support.
Updated libedit to bring it into sync with the latest version from NetBSD.
Allowed key options (command="..." and friends) in sshd(8) AuthorizedPrincipals.
Allowed ssh-keygen(1) to import (-i) and export (-e) of PEM and PKCS#8 encoded keys
Improved -o in ftp(1).
Added some missing UHCI and EHCI register restores on resume.
Added support for mapping ACPI to PCI devices.
Added support for referrals in ldapd(8).
Added aesni, an amd64 driver for the crypto framework, similar to the VIA driver for supporting the AES-NI instructions found on recent Intel cores. Special thanks to Huang Ying at Intel for getting the assembly code relicensed from GPL to a more suitable license.
Many improvements in sparc boot.
Replaced enc(4) with a new implementation as a clonable device.
Added PADDR_IS_DMA_REACHABLE macro in uvm(9).
Reworked cypress cpu cache setup and enabled writeback mode on sparc.
Added fpu_kernel_enter() and fpu_kernel_exit() on the i386 and amd64 platform. This allows the use of the FPU in the kernel.
Fixed some USB keys by removing extra_bytes field in scsi(4) struct scsi_sense_data.
Make iked(8) lookup the RSA public keys in /etc/iked/pubkeys/ as an alternative to X.509 CA verification.
Make ldapd(8) return a protocol error when trying to use starttls without a configured certificate, instead of just blocking the client.
As it is not anymore setuid, removed tip(1) complicated public/private/root permissions scheme for options in favour of a single read-only bit.
Removed compat_hpux(8).
Used the libutil implementation of UUCP locking in tip(1).
Factored iked(8) Diffie-Hellman implementation for isakmpd(8) with lots of benefits: smaller code, libcrypto instead of custom crypto code, theoretically adds support for many new MODP and EC2N/ECP modes.
Added missing free()s in iked(8).
Fixed use after free(3) in pfctl(8).
Improved Intel GbE 82578 and 82578 PHY in em(4).
Removed mentions of operating system binary emulation in installation notes.
Improved ahci(4) suspend/resume.
Improved acpi(4) suspend/resume by using recently added bufq_quiesce().
Make sasyncd(8) use only 3 verbosity level: None, Important, All.
Removed compat_ultrix(8).
Avoided a null pointer dereferencement in usbhidaction(1).
Added support for badly nested blocks in mandoc(1).
Cleaned tip(1) from obsolete acu.
Make call to sysctl(3) fail if a process asked KERN_PROC2 or KERN_FILE2 (or their libkvm wrappers) for more informations than the running implementation knows how to provide.
Synchronized mandoc(1) to release 1.10.3: support -Tps -Opaper=a4 and -Opaper=letter.
Automatically set /etc/pkg.conf 'installfrom' entry to the public mirror used while installing or upgrading.
Added a framework for glyph width encoding in mandoc(1).
Fixed a logic error in spdmem(4).
Changed st(4) to use the FIFO buf sorting discipline rather than the default disk-sorting one.
Fixed aucat(1) crash by explicitly initialize members of struct dev in dev_open().
Prevent aucat(1) from checking if the midi control interface is idle when the device isn't open yet.
When given NULL or "" as argument, make unsetenv(3) set errno to EINVAL, conforming to POSIX.
Improved the FPU register saving on the hppa platform.
Factor out code used to save and flush process FPU context in hppa.
Forced the dns buffers to be aligned using a union in smtpd(8) and ypserv(8) as a workaround for "misaligned strings on the stack" bug in gcc4 and as a better and more common idiom.
Added custom layout in tmux(1), the list-windows command displays the layout as a string that can be applied to another window using select-layout.
Allowed selecting both address family and protocol in netstat(1).
Rewritten ldapd(8) schema parser. The new parser now support symbolic OID names. You need to update your /etc/ldapd.conf: schemata are now included with the 'schema' keyword.
Added VIA xcrypt for amd64 in libssl.
Cleaned interface stats handling in pfctl(8): '-Fi' reset ALL the interface statistics and make '-Fa -i ifname' fail.
Fixed IFADDRDEL imsg error message in ospfd(8).
Make tmux(1) commands use stdin, stdout and stderr sent from client to server. You'll need to restart your server after this upgrade.
Fixed keyboards in wsconsctl(8), better handling of none latin-1 characters.
Added initial support for Intel GbE 82578 PHY in em(4).
Added iked(8) to rc(8).
Added the rtable id as an argument to rn_walktree() in the network stack. This permits functions like rt_if_remove_rtdelete() to be able to correctly remove nodes.
Used an SLIST instead of a TAILQ for the ccb free list in arc(4).
Massive removal of unused struct scsi_device.
Updated the perl(1) Safe module to version 2.2.7 for CVE-2010-1168 and CVE-2010-1447.
Modified IPv6 stack to conform to the last ospf6d(8) changes. Now neighbour discovery is solely based on the cloning route and not on the address neigbourship anymore.
Added initial support for RTL8168E in re(4).
Make ospf6d(8) create a cloning route if there is no next hop but an interface index.
Used the interface index for writing routes into the kernel in ospf6d(8).
Allow tty drivers to request larger buffers at attach time using a max-baud-rate hint. These larger buffers are required by the very high speed KDDI devices in Japan (com(4), or ucom(4)).
In cwm(1), fixed window name and class to match cwmrc(5).
Added definitions in acpi(4) for Intel/AMD IOMMU ACPI tables.
Implemented iopools in osiop(4) to get rid of another use of XS_NO_CCB.
Used in com(4) a more moderate FIFO trigger level (4) for moderately quick (sub-38400) port speeds.
Synchronized bind(8) root.hint with latest version from rs.internic.net.
Fixed kernel manuals thanks to full .nr nS support in mandoc(1).
Stopped probing "volume knobs" in azalia(4) on resume. This fixes a resume break.
Disabled uguru(4) on i386 and amd64 GENERIC kernels.
Added PCH/82577 bits from FreeBSD in em(4).
Fixed a crash in ftp(1) when the directory entry isn't complete.
In bgpd(8), instead of specifying the control sockets on the command line have them in bgpd.conf. Removed the -s and -r arguments from bgpd.
Marked the PXE boot device as "netboot" in the i386 and amd64 platform, even if we do not contain NFS client support.
Fixed .Bk in mandoc(1): do not print invalid arguments verbatim, do not trigger TERMP_PREKEEP twice, do not die from invalid arguments, continue to ignore even valid arguments.
Fixed recursion in pmap_enter(9).
Make azalia(4) check if the jacks that will mute the speaker can generate unsolicited events.
Cleared acpi(4) fixed event status on resume (power buttons/etc) so that some machines don't immediately resume after suspending to S3.
Added support for 800x480 in udl(4).
In route(8), Make 'route exec' emit error messages like xargs when execve() fails does.
In iked(8), allowed to have multiple certs for the same CA but different srcids in the certs/ directory. This enforced that the subjectAltName has to be set correctly.
Fixed a possible double free in iked(8).
In ospfd(8), fixed rtmsg_process to return on an error during processing rather than continue. Fixed kr_dispatch_msg so it acts when rtmsg_process fails.
Fixed a NULL dereferencement on zombies processes.
Fixed two PRS in pthread(3).
Added the TPOFF* and DTP{MOD,OFF}* definitions that ld.so will need for doing thread-local storage in amd64, i386, powerpc, sparc and sparc64.
Added uvm(9) DMA address constraints in every architectures machine-dependent initialization.
Make use of current working directory when default-path is not set in tmux(1).
Fixed the length check for ASN1_ID Ids in iked(8).
Fixed DIOCCHANGERULE in pf(4) control device.
Basic implementation of .Bk/.Ek in mandoc(1).
In ldapd(8), added support for different page sizes in the btree.
Added quirks in azalia(4) for IDT 92HD71B7 in HP laptops.
Multiple improvements iked(8).
Added option detach-on-destroy in tmux(1) to set what happens to a client when the session it is attached to is destroyed.
Suggested a reboot if "sh MAKEDEV" was run or login.conf was modified after using sysmerge(8).
Make use of a mutex to make atomic operations atomic on hppa multiprocessor kernels.
Added /dev/diskmap to RAMDISKs kernels.
Allowed processes to be scheduled onto secondary CPUs on the hppa platform.
Cleaned useless #include <sys/user.h> in more than one hundred files.
Fixed removal of one-level search index in ldapd(8).
In com(4), grown COM_IBUFSIZE from 1024 to 8192 to be enough size for recent devices. It fixes the problem using KDDI W04K.
Brought ss(4) device referencing into line with sd(4), cd(4) and st(4) recent changes.
HTTP is now the default network install method rather than FTP.
Implemented a simple keepalive mechanism in gre(4) that is compatible with the one used by Cisco.
First steps toward variable width fonts in mandoc(1).
Added the extendedKeyUsage flags serverAuth and clientAuth in libssl, those flags are required by recent Windows.
Added his own Low Power Link Up code to PCH based em(4).
Include the Id type in the generated SA tag that is passed to the kernel, a la isakmpd(8).
Allowed -c0 in ping(8) and ping6(8).
Make sure some single bit bitfields in rtadvd(8) are single bit.
Fixed bug in tmux(1) command list pointer.
Merged mandoc(1) release 1.10.2, bug fixes (interaction of ASCII_HYPH with special chars, handling of roff conditionals, Bd -offset will no more default to 6n), improvements (more caching of .Bd and .Bl arguments for efficiency, deconstify man(7) validation routines, add FreeBSD library names) and start PostScript font-switching.
Added GENERIC.MP kernel to hppa.
Improved dired in mg(1): position cursor at first filename after, don't reposition cursor on reopening, check for permission before attempting to open directory.
Prevent the amd64 and i386 platform from hanging on resume in the inter-processor interrupt handlers.
Fixed 100% interrupt usage on amd64 MP resume.
Fixed a bug in adw(4) and sii(4/VAX).
Removed OpenCVS from the build.
Avoided a potential race when unlocking a mutex on the hppa platform.
Added HUAWEI E182 (aka Emobile D31HW) in umsm(4).
Removed -m option from pfctl(8).
Added X11ForwardTimeout option in ssh(1).
Make ssh(1) log the hostname and address that we connected to at LogLevel=verbose after authentication is successful to mitigate "phishing" attacks by servers with trusted keys that accept authentication silently and automatically before presenting fake password/passphrase prompts.
Worked OpenBSD::State(3p) in the packages system.
Make skip the initial check for access with an empty password when PermitEmptyPasswords=no in sshd(8).
Fixed a bug in aucat(1).
Fixed requirement for /dev/null inside ChrootDirectory with "internal-sftp" in sshd(8).
In OpenSSH, removed hardcoded limit of 100 permitopen clauses and port forwards per direction.
Make st(4) use xshandlers for scheduling IO.
Fixed the ikectl(8) log verbose/brief commands.
Included files annotated @bin in the database produced by pkg_mklocatedb(1).
Prevent sd(4) from sleeping while dumping.
Added a CA export command for EAP in ikectl(8).
Improved errno in ldapd(8).
Removed compaction and indexing from ldapd(8). Reimplemented it in ldapctl(8).
Fixed a bug in uvm(9) uvm_pmr_get1page().
Fixed multiple inclusions in the IPC messaging functions.
Make ami(4) ioctl(2) and sensor paths more reliable.
Fixed condition in ospfd(8).
Fixed printing of extensions in v01 certificates in ssh-keygen(1).
Updated Mesa to version 7.8.2 in Xenocara.
Do not propagate cache invalidate operations between processors on 88110 systems, improves GENERIC.MP kernel speed by 8% on the MVME197DP (mvme88k platform).
Prevent the framebuffer from taking over serial console on early 2.x sun4c PROM if no keyboard is connected.
In mpii(4), protected the Command Control Blocks free list with its own mutex.
Doubled the dmesg buffer size on the amd64 platform.
Included the user name on "subsystem request for ..." log messages in OpenSSH.
Added auth debug messages for bad ownership or permissions on the user's keyfiles in OpenSSH.
Standardized error messages when attempting to open private key files with ssh-keygen(1).
Exposed sshd_config(5) options inside Match blocks (AuthorizedKeysFile, AuthorizedPrincipalsFile, HostbasedUsesNameFromPacketOnly, PermitTunnel).
Added a choose-buffer command in tmux(1) for easier use of the paste buffer stack.
Added initial support for PCH based em(4) adapters with intel GbE 82577 PHY.
Implemented PA linearization on adapters with digital predistorters in athn(4) for AR9003 family only.
Fixed printing of multipathed route in ldpd(8).
Stop requiring { } blocks in ldpd(8).
Improved athn(4).
Fixed an integer arithmetic overflow and an overflow of the xs sense buffer in vscsi(4).
In ami(4), protected the Command Control Blocks free list with its own mutex.
Extended tmux(1) -t:+ and -t:- window targets for next and previous window to accept an offset such as -t:+2.
Allowed hardlinks to tmux(1) sockets to be used more easily.
Fixed the disappearance of wild characters in tmux(1).
Fixed midicat(1) device mode when only -i or only -o is used.
In eap(4), locked the sample rate of es1731-based devices to 48kHz.
Make pkg_create(1) display bad symlinks by destination.
Make various HP laptops boot correctly with acpi(4) by fixing reference counting panic for CondRef.
Fixed a NULL dereference by skipping exiting process in sysctl system call.
Linked a new iwn-firmware-5.5 package that contains an update for Intel Centrino Advanced-N 6200/Ultimate-N 6300 adapters for iwn(4) devices.
Make bioctl(8) work with disklabel UIDs by trying to use opendev(3) first.
All programs which make use of opendev(3) can now operate with disklabel UIDs.
Fixed a segmentation fault in ftpd(8) on ftpd_popen() error during status command.
Fixed a memory leak in sftp(1).
Fixed sftp(1) "ls" in working directories that contains globbing characters in their pathnames.
Fixed ldapd(8) byte alignment on sparc64.
Added support to use sasyncd(8) with iked(8) instead of isakmpd(8).
Fixed a NULL pointer dereference in sd(4).
Compaction can now be done by a separate process in ldapd(8).
Prevent fsck_ffs(8) from failing when used with disklabel UIDs.
Fixed a panic with softraid(4) when sd(4) tries to enable write cache on all disks.
Make a whole bunch of newer umsm(4) Huawei devices to work.
Count of deinstalling package fixed in pkg_delete(1).
Write cache enabled on sd(4) disks during attach.
In mpi(4), allowed the cache enabling on virtual disks to run as part of the disks attach routine.
Initial support for initiator mode with certificate, which allows to run iked(8) as a "client" or to configure iked(8) to iked(8) (OpenBSD to OpenBSD) IKEv2 VPNs.
Added commands in iked(8) to create/delete/install/import keys without involving certificates.
Fixed a memleak in the disk mapper.
Fixed block length for AES in iked(8).
Fixed EAP responder mode in iked(8).
In iked(8), make NAT detection work in initiator and responder mode.
Fixed memory leak in ypldap(8).
Adjusted FTP reply codes in ftpd(8) (in error conditions) to conform to RFC 959.
Segmentation fault fixed in lock(1).
In ldapd(8), fixed a btree reference counting when opening the database with a file descriptor directly using btree_open_fd().
Make ospf6d(8) stop preventing dynamic route redistribution because of a "dispatch_rtmsg no nexthop" error was emitted in wrong cases; fixed a use after free(3), fixed a segfault.
Make ospf6ctl(8) print additional new line after 'Number of Links' in show database router.
Make ospfctl(8) print 'Number of Routers' in show database network.
Fixed a memory leak in ypldap(8).
In scsi(4), Restore an unusual XS_SENSE semantic; Fixes restore(8) problems seen on certain tape drives.
In ldapd(8), Wrap searches in a read-only transaction so it is guaranteed to see a consistent snapshot of the database.
Implemented IP-FORWARD-MIB for IPv4 in snmpd(8).
Add support for Intel AES-NI and the CLMUL_ instructions, plus a few others that are needed to implement accelerated AES (and AES-GCM mode) on newer Intel cores.
In ldapd(8), track changes in btree_txn_* API, pass a NULL btree when also passing a transaction.
In ldapd(8), when a btree NULL pointer is passed to a function that accept both btree and a transaction, the btree is taken from the transaction.
Fixes in sort(1): clarify sort's various modes of operation; -m is overridden by -C and -c; ordering options should not appear after -k.
In ldapd(8), append a "tombstone" meta page after a database has been compacted. This allows other processes to pick up the change and re-open the file.
Added minimal initial -Tps support in mandoc(1).
Allowed configure queue expiry in smtpd(5).
In fsck_ffs(8), added missing headers needed for opendev(3) and close(3).
Declare safepri at the MD level on each platform, so that the kern_synch.c does not have to deal with it as a common.
In ikectl(8), added a command to revoke a certificate and generate a CRL; make the ca install command install the CRL as well.
Added a -S flag to iked(8) to do the same as "set passive" but matches the isakmpd(8) flag.
Added new commands to iked(8) and ikectl(8), the couple/decouple commands will set loading of the learned flows and SAs to the kernel the active/passive commands are required to use iked with sasyncd(8).
Stopped printing FEC twice in ldpd(8).
Added another tree in iked(8) to lookup policy SAs by peer address.
Removed the CRYPTO_ALGORITHM_ALL define from crypto(4).
In ospfd(8), restricted the interface scope embedding to link local nexthops.
In ospfd(8), fixed an infinite loop hit when the prefixlen is not dividable by 32 by decoding prefixes correctly.
Fixed time on Mostek time-of-day chips with dead batteries.
Moved the logging of FEC changes to the LDE and print the FEC and label information.
Allow FFS file system to be mounted by a disklabel(8) UID.
Fixed MPLS pop operation to make PHP work again.
Reworked UI messages in pkg_add(1).
Properly enable vscsi(4) on the loongson platform.
Make ospfd(8) calculate size of update packet with IPv6 header and reserve space for IPsec.
Introduce a diskmap pseudo device which allows userland to open a disk specified via its disklabel UID.
Merged mandoc(1) bits that will be going into 1.10.1.
Fixed various problems of auich(4) on SiS 7012 based chips.
Reworked the way onboard devices attach on Sun 4/110 systems.
In tcpdump(8), added minimal decode support for IKEv2 exchange types and payloads.
Fixed a bug which prevented diskless station from booting (PR6382).
Make ldpd(8) store all labels in ldpd in host byte order without any additional shifting.
iked(8), ikectl(8) enabled in the build.
--------
Changes made between OpenBSD 4.6 and 4.7
In smtpd(8), used safe file descriptor limits in smtp, lka, queue, and control. It removes a possibility of fatal fd-starvation when under heavy load.
Fixed leaks in cvs(1).
Improved conflict resolution in pkg_add(1).
Added missing splbio() protection when sending commands to the vDisk server on the sparc64 platform.
Implemented sending of the QUIT command in smtpd(8).
In smtpd(8), stop qualify empty sender address with the domain.
Link wsudl(4) to the build on architectures that support udl(4).
Fixed cd mounting with FSDEBUG kernels.
Fixed two memory leaks in afs LWP.
Fixed an incorrect array size calculation and a memory leak in pts(1).
In RPC, fixed a file descriptor bug.
Make sur self dependencies install/uninstall in the correct order to be able to handle any @exec activity in pkg_add(1).
Fixed two memory leaks in the Editor/termcap-curses interface.
Fixed three buffer overflows in ppp(8).
Swaped an int for a long in cwm(1) make stop giving dodgy properties values on amd64.
In cwm(1), implemented _NET_DESKTOP_NAMES, _NET_WM_DESKTOP and _NET_WORKAREA for the NetWM support.
In inet(4), make IPSEC getsockopt(2) return proper information instead of 2 bytes of uninitialized kernel stack.
Plugged a memory leak in ssl(8).
Avoided some 64bit to 32bit pointer truncation on the sgi platforme.
Fixed potential bugs in battlestar(6), mille(6), huntd(6), hack(6).
Fixed SwapXY and rotation support in ws(4).
In cwm(1), implemented _NET_CURRENT_DESKTOP, _NET_DESKTOP_VIEWPORT, _NET_DESKTOP_GEOMETRY, _NET_VIRTUAL_ROOTS and _NET_SHOWING_DESKTOP for the NetWM support.
In config(8), removed support for setting old SysV SHM size limits global variables.
In ldpd(8), make sur that the length of host address in the FEC TLV is encoded in number of octets.
Fixed a memory leak and off by one buffer overflow in Kerberos.
Fixed a memory leak in fgen(1).
Fixed a careless fscanf(3) in tn3270(1).
Fixed cwm behaviour with multiple screens and groups.
In NFS vnode op calls, fixed a potential race with renames.
Fixed memory leaks in fsck_ffs(8) and fsck_ext2fs(8).
Fixed memory leaks in pfctl(8).
In smtpd(8), fixed a case when 2yz status would not override existing 4yz one.
Fixed buffer overflows in smtpd(8).
Added option '1' in top(1) to display all cpu stats combined.
Added server options in tmux(1).
Fixed memory leak in dhcpd(8).
Make netstart(8) stop only on malformed inet or inet6 lines in hostname.if(5).
Added uhts(4), a driver for USB HID touchscreen.
Fixed an off by one error in carp(4).
Make bge(4) more accurate with input errors.
Added entries in compat signal mapping arrays for SIGTHR for compat_hpux(8), compat_ibcs2(8), compat_linux(8) and compat_svr4(8). This fixed overflows in compat_ibcs2(8) and compat_svr4(8)
Fixed some i386 and amd64 laptop resume.
Added tow new machine dependent pmap(9) APIS for the i386 and amd64 platform: pmap_flush_cache() and pmap_flush_page().
Added clfush() and mfence() instructions in i386 and amd64 cpufunc.
Make i386 and amd64 platform detect cache line size for the CLFLUSH (Cache Line Flush) instruction when the CPU is identify.
Fixed a buffer overflow in crunchgen(8).
In bgpd(8), make the RDE decisions easier.
Make the disks in a dell 960 work.
Improved pane reference in tmux(1).
Started NetWM support in cwm(1) (_NET_SUPPORTED, _NET_ACTIVE_WINDOW, _NET_CLIENT_LIST, _NET_NUMBER_OF_DESKTOPS).
Added firmware for Elite3D framebuffers.
Support uk.swapctrlcaps as a valid keymap in pckbc(4).
Don't run the kernel with instruction cache disabled while netbooting on ARCBios.
Fixed fault when accessing the stack of 32bit ARCBios on sgi platform.
Get page size information by reading the kernel image' struct uvmexp on the sgi platform, instead of the value of PAGE_SIZE found in the standard headers when compiling.
Make userland malloc(3) use __LDPGSZ granularity on mips, regardless of the actual kernel page size.
Update sudo(8) to version 1.7.2p2.
Avoided a NULL pointer dereferencement in smtpd(8) when logging a DNS lookup failure.
Fixed potential divide-by-zero in sftp(1) "df" output when talking to a server that reports zero files on the filesystem
In pthreads(3), make internal file descriptor handling async-signal safe by eliminating the use of spinlocks and malloc(3). All needed memory is allocated upfront and _thread_kern_sig_defer/undefer() is now used to protect critical sections.
In sysmerge(8), added /var/db/locate.database and /var/games/tetris.scores to IGNORE_FILES.
Fixed some session initialization failures in ldpd(8).
Fixed a bad memcpy call in bgpd(8).
Make uts(4) ignore HID devices that have the same vendor and product ids than devices actualy supported by uts(4).
In smtpd(8), fixed interface tagging listeners in the ipv6 case
In acpi(4) use new acpi_maptable on AMLOP_LOAD operations; do not panic if bad checksum, fixes Thinkpad SL300.
Avoided stopping during wrongly mounted root in rc(8).
Put back ahc(4) in kernel RAMDISKB.
In pkg_add(1), fixed the case where you look to update one package.
In cdio(1), make cd blanking on sparc64 possible.
Make crunchgen(1) mangle names in sequence instead of randomly.
In bgpctl(8), clearing a neighbor bring it into the confured state after a bgpctl reload.
Restrict bgpd(4) to log only when there may be a chance the session come up.
Added -w flag to tmux(1) set-option and show option.
In scsi(4), fixed a completion interrupt pulling io of the buf queue.
Fixed stge(4), putting the interface into promiscuous mode all the time with the ST1023 chipset is no longer necessary.
Fixed order dependency of pfsync(4) interface setup.
Make numlock work in tmux(1).
Close tmux(1) pane if the process die because of a signal.
In pkg_add(1), fixed inter-dependencies case.
Fixed the mixer interface for the CE4231 sound card found on sparc64 platform.
In tmux(1), added new command capture-pane which copies the entire pane contents to a past buffer.
Added new exec command to run a process and its children in a non default rdomain/rtable in route(8).
Make tmux(1) look for mice and xterm keys before standard function keys.
Fixed dmesg printing of error in acpi(4).
Mark sd(4) disk as dirty when starting a write to it.
Properly handle all struct scsi_xfer states that can be returned by an adapter in sd(4).
Make mpii(4) compile on i386.
Make creator(4/SPARC64) load firmware that is needed for accelerated X on Elite3D boards.
Make bge(4) re-initialize the interface upon resume.
Handle partial xterm function key sequences in tmux(1).
Overflow fixed in memprob.c by probing memory on machines reporting memory region greater than 32.
Added a new Elfxx_Phdr check hook for sgi machine-dependent initialization to prevent from loading a kernel not compiled for the platform we are running on.
Improved pkg_add(1) dependencies handling.
Improved Xenocara speed with inteldrm(4) on multiprocessor systems.
Improved uthum(4).
Improved pkg_add(1).
Make inteldrm(4) able to save and restore its state on suspend/resume.
Make tcpdump(8) print outer ipv6 addresses for encapsulated packets only if tcpdump is run with -v.
Moved MB_LEN_MAX into machine independent sys/limits.h ant set it to 4, to accommodate for future UTF-8 support (RFC 3629).
Make librthread detect when a thread is completely done with its stack without need of a kqueue(2).
Added setrdomain(2) and getrdomain(2) system calls to libc.
Improved malloc(3) by using the queue(3) macros. It greatly enhances speed of freeing chunks in reverse or random order at the cost of a little space.
Added SIGTHR (Thread AST) to signal(3) for librthread. It is used for interthread ASTs for cancelation and suspension.
Fixed SNMP trap interface in snmpd.
Added support for 'set origin' in bgpd.conf(5).
In tmux(1), emulated il1, dl1, ich1 to run with vt100 feature set.
Reduced uaudio(4) latency.
Allowed uaudio(4) USB xfer requests to use up to 16 frames per xfer, depending on blocksize.
Make msk(4), re(4) pci(4) interfaces re-initialize on suspend only if they were running.
Fixed an issue where 82573L based em(4) devices had long latencies on the recieved packets.
Improved siop(4).
Improved acpiec(4).
Improved acpi(4).
Fixed tmux(1) keys for application and number keypad modes.
Improved the scheduler.
Added support for em(4) interfaces found on Intel EP80579 SoC.
Added support for Thinkpad suspend button in acpithinkpad(4).
Better handling of notification types in acpibtn(4) for LID and Sleep button.
Re-added uvm_objwire() and uvm_objunwire() in the kernel.
Added support for include in ospfd.conf(5).
Improved ukbd(4).
Implemented smp_malloc() on sgi platform.
Removed battery insert/removal reports from dmesg.
Added event framework to mpii(4).
Added a -p flag in tmux(1) to display-message to print the output rather than displaying in the status line.
Make i386 and amd64 ACPI machine-dependent parts save FPU state before suspend.
In Xenocara, updated xf86-video-openchrome to version 0.2.904, xf86-video-radeonhd to 1.3.0.
Make wsconsctl(8) preserve wsmouse(4) rawmode when setting scale.
Make acpi(4) abort suspend on SMP systems until it is written.
Make eephy(4) properly re-initialise PHY upon resume.
Fixed a mbuf(9) leak in msk(4).
Implemented support for suspend/resume in azalia(4).
Changed libc ENOTSUP's strerror(3) to "Not supported".
Enabled uthum(4) in i386 and amd64 GENERIC kernels.
Allowed the passphrase to be changed on softraid(4) crypto volumes.
Make ppb(4) save state on suspend and restore that state and the bridge windows on resume such that devices behind bridges get a chance to work after resume.
Fixed ehci(4) hardware polling interval calculation.
Improved rtw(4) detach.
Make vge(4) detachable.
Make pci(4) handle suspend failure.
Fixed interrupts storm in athn(4) when the radio switch is turned off while the interface is up and running by properly clearing the condition.
Added uthum(4) device driver for TEMPerHUM USB temperature and humidity sensor.
Suppressed uhidev(4) warning message for polling only HID devices.
Implemented a new raw mode in Xenocara xf86-input-ws.
Added suspend/resume bits for intel drm(4).
Added config_activate_children() in pci(4), ppb(4), bios(4), acpi(4) and on i386 and amd64 mainbus(4), pchb(4) and bios(4).
Improved the Ethernet software status link.
Improved softraid(4) ioctl.
Enabled by default suspend/resume paths in the i386 and amd64 kernels.
Added new config_suspend() in acpi(4) and improved its suspend/resume state.
Make config_activate_children() more useable as a suspend-and-resume device tree walker and added config_suspend() in autoconf(9) subroutines and in the kernel device structures.
Added new umsm(4) type modems: Softbank C01SW (Sierra OEM) and Emobile H12HW (Huawei OEM).
Moved ipsec(4) creation key before isakmpd(8) in rc(8) and make sshd the first of the network daemons so that it can be used if another daemon stops in its tracks.
Make bnx(4) work on sparc46.
Added NetMos NM9901 multiple peripheral board support in puc(4).
Fixed pckbd(4) and acpihpet(4) suspend/resume.
Prepared future pci(4) suspend/resume.
Removed brconfig(8), all its fonctionality is now in ifconfig(8).
Stopped supporting bridgename.bridge* files in netstart(8), and moved them to hostname.bridge* files.
Don't repeat iostat(8), vmstat(8) or netstat(1) banner if not a tty. Added a -c count option to netstat(1).
Merged brconfig(8) into ifconfig(8).
Advanced work on amd64 for future suspend/resume.
Make drm(4) intel GEM Buffer stop growing too much.
Make amd64 use Intel Enhanced SpeedStep even if the CPU model is not known.
Reimported xf86-input-usbtablet, xf86-input-ws in Xenocara.
Fixed ifconfig -a vs. ifconfig -A and make ifconfig without any arg behave like ifconfig -a.
Added basic suspend/resume autoconf(9) functionnality.
Added SMP support on MIPS clock.
Removed flash option by default in vi(1) and put the beep again. The beep is faster on old machines.
Make sur chunks are not already in use when creating a softraid(4) volume.
Make bpf(4) work on vether(4).
Many Xenocara updates: xf86-input-acecad to version1.4.0, xf86-input-vmmouse to 12.6.5, xf86-input-void to version 1.3.0, xf86-input-joystick 1.5.0, xf86-video-apm to 1.2.2, xf86-video-ark to 0.7.2, xf86-video-ast 0.89.9, xf86-video-chips to 1.2.2, xf86-video-cirrus to 1.3.2, xf86-video-dummy to 0.3.2, xf86-video-i740 to 1.3.2, xf86-video-neomagic to 1.2.4, xf86-newport to 0.2.3, xf86-video-r128 to 6.8.1, xf86-video-rendition to 4.2.3, xf86-video-s3 to 0.6.3, xf86-video-s3virge to 1.10.4, xf86-video-savage to 2.3.1, xf86-video-siliconmotion to 1.7.3, xf86-video-sis to 0.10.2, xf86-video-sisusb to 0.9.3, xf86-video-tdfx to 1.4.3, xf86-video-tga to 1.2.1, xf86-video-trident to 1.3.3, xf86-video-tseng to 1.2.3, xf86-video-vesa to 2.2.1, xf86-video-vmware to 10.16.8, xf86-video-voodoo to 1.2.3,
Make passing of zero-length arguments to ssh(1) safe by passing "-<switch>" "<value>" rather than "-<switch><value>".
Probed modes for SATA disks in wdc(4), make CF behind SATA work and gives more speed to things like SSDs that do UDMA 6.
Added a lot of bpf(4) and counter manipulation to bridge(4).
Make pkg_add(1) partial update update only their dep tree.
Make pkg_add(1) update less verbose.
Improved pkg_add(1) to solve more dependencies on the fly.
Fixed RTS/CTS and CTS-to-self protection modes, fixed 802.11a TXTIME computation in athn(4).
Fixed uninitialized variables in db_stack_trace_print() on mips64 machine-dependent initialization.
implemented mplock and rw_cas for the mips64 platform.
Fixed ddb(4) "print $registername" on 64 bit platforms.
Fixed registration of memory after 1GB on sgi Octane.
Prevent MIN_UID from removing root in yptest(8.)
Make ieee80211 avoid dhclient(1) timeouts when wpa is enabled.
Make tmux(1) use home from struct passwd if $HOME is empty or NULL.
Make athn(4) led blink during a scan.
Make umbg(4) detach function remove usb tasks before calling any other teardown functions.
Reordered atu_detach operations to the correct order in atu(4).
Added new option tunneldomain to ifconfig(8) to specify the routing table to be used for sending out gre(4)/gif(4) encoded packets.
Make ftp-proxy(8) use match rules instead of pass rules in pf(4).
Make intel DRI stop printing to stderr when we fail to initialise GEM.
Fixed User triggerable KASSERT()s and NULL dereferences in netbt setsockopt()s, fixed mbuf leak when the wrong level is used.
Fixed file stream orientation in several stdio functions.
Make tmux(1) calculate the percentage size with the width instead of the height when using -h and -p.
In inet(4) ip_output() and inet6(4) ip6_output(), fixes a NULL dereference.
Proper display of UTF-8 in tmux(1) status line messages and prompt.
Remove oldest message and not newest when limit is hit in tmux(1).
Corrected off-by-one in percent_expand() in ssh(1).
Use HostKeyAlias when ssh(1) prompts for passwords.
Stopped failing if stating the subsystem binary fails with sftp(1) so as to better handle chrootdirectory+forcecommand=sftp-server and restricted shells.
Avoid getting stucked in ssh(1) client while a client attempts to ssh a server with ForceCommand=internal-sftp in a shell session.
Avoided overflow from protocols being greater than IPPROTO_MAX.
In tmux(1), fixes status-left string option "##".
Added code to set up windows on PCI-PCI bridges left unconfigured by the firmware. Fixes some (laptop) machines with ethernet and/or wireless behind a bridge.
On the mips64, removed code allowing native binaries with 032 ABI to run.
Change status line drawing in tmux(1) to create the window list in a separate screen and then copy it into the status line screen.
Handle turning athn(4) radio switch off.
Added two new options in tmux(1), window-status-format and window-status-current-format, which allow the format of each window in the status line window list to be controlled using similar # sequences as status-left/right.
xterm-keys reverted off by default on tmux(1). tmux(1) stopped interpreting #() for display message.
Added regression tests for stdio threading.
Change sgi xbow memory handling to prevent using memory on Octane machines in the 2.0-2.5G range since it causes errors, as a consequence memory usage is limited to 1.5G on Octane.
Changed pthread_rwlock_wrlock() to increment the count of writers just once and not on every wakeup.
Disable support for Dell SVR4 binaries, see compat_svr4(8).
In mavb(4/SGI), always move the same amount of data in the interrupt handler, rounded blocksizes, fixed display of mixer controls, recording support added.
First steps towards 64-bit page-table entries on mips64.
Let iockbc(4/SGI) attach to iof(4/SGI) on sgi.
Stop complaining about not knowing the bus_clock for EP80579 (model 0x15) in machine-dependent initialization of i386.
Moved tmux(1) handling of UTF-8 grid data in a new file: grid-utf8.c.
Added a per-client log of status line messages displayed while that client exists in tmux(1).
Mark -n keys with (no prefix) instead of [] in tmux(1).
Shrink static binaries and ramdisk, chops 888kB /bin and /sbin on i386.
Improve the bpf(4) path in vether(4).
Tidier promisc/multicast handling in cas(4).
Fix a DPRINTF format string in athn(4).
Remove the temperature sensor from wpi(4) since it doesn't use a known temperature unit.
Updated hardware multicast filter in athn(4).
Initialize the FPU to be in double precision mode for SH4. Fixed segmentation faults in omalloc_init() for shared executables linked with the pthreads library.
Permit top-bit-set characters to be entered in tmux(1) status line.
In tmux(1) chose mode, assign each item a number or lowercase letter from those available and accept that as a shortcut key for the item.
Shortened message when library is not found in pkg_add(1).
Reworked interactive prompts in pkg_add(1).
Fixed handling of 5yz response to EHLO in smtpd(8), falling back to HELO.
Fixed incorrect exit status when multiplexing and channel ID 0 is recycled in ssh(1).
Tidier promisc/multicast handling in vic(4).
Fuller progress meter for pkg_add(1).
Fixed panic when wep is enabled on athn(4).
Fixed generation of .IX entries that include characters escaped with a backslash in Pod::Man(3p).
Fixed tmux(1) crashing when the screen is one cell wide.
In smtpd(8), minimize the delay between receiving response to "." and removing the queue entry in order to avoid the risk of sending duplicate mail.
If two (or more) inputs in aucat(1) use channel ranges having no intersection, then don't reduce their dynamic range to "share the volume".
Added athn(4) to the sparc64 GENERIC and RAMDISK kernels.
Added NO_CCB support to ciss(4).
Make athn(4) link LED turn on for AR9287.
Added athn(4) to the amd64 and i386 RAMDISK_CD kernel.
Fix for blind prefix injection in libssl.
Added support in smtpd(8) for userpart+something@domain receipient addresses.
Updated time zone data to tzdata2009r.
Added vether(4), a virtual ethernet device.
Added code on sgi to send L1 commands and parse command results. Used to get the ethernet address on IP35 systems with IOC3 onboard ethernet.
Updated xenocara xcompmgr to 1.1.5.
Added IPv6 support for divert sockets in pf(4).
Make it possible to add an interface with brconfig(8) even if it was already added.
Moved tmux(1) over to use event(3).
Added support in tcpdump(8) to decode the GPRS Tunneling Protocol.
Allow any program using aucat(1) to act as a MMC slave and MTC master.
Added support in smtpd(8) for multiple aliases maps.
In run(4) and otus(4), defer WEP key setting until the interface is brought up.
Applied a fix in perl(1) which could cause it to crash on certain invalid UTF-8 codes.
Fix pf(4) rtable and rdomain handling.
Make dhclient(8) pick up the routing domain from the specified interface and use that rdomain for relaying the packets to the server.
Implemented "log verbose" and "log brief" in bgpctl(8), dvmrpctl(8), lpdctl(8), ripctl(8), ospfctl(8) and ospf6ctl(8).
Added M-Audio Revolution 5.1 to the list of supported envy(4) devices.
Added kqueue(2) support for midi(4).
Added iec(4), a driver for the sgi IOC3 onboard ethernet interface.
Added ATI hudson2 to the list of supported ahci(4) chips.
Two minor fixes in the YP allocation code error paths.
Establish a shutdown hook on the sparc64 LOM code to prevent watchdog triggers after the kernel has halted.
Updated xenocara libXt to 1.0.7, libXv to 1.0.5, libXvcMC to 1.0.5, libfontenc to 1.0.5 and xtrans to 1.2.5.
Updated xenocara libXfontcache to 1.0.5, libXft to 2.1.14, libXmu to 1.0.5, libXpm to 3.5.8 and libXrender to 0.9.5.
Updated xenocara libXdamage to 1.1.2, libXdmcp to 1.0.3, libXfixes to 4.0.4 and libXfont to 1.4.1.
Updated xenocara libICE to 1.0.6, libXRes to 1.0.4, libXau to 1.0.5, libXcomposite to 0.4.1 and libXcursor to 1.1.10.
Updated xenocara xserver to 1.6.5 and xterm to 250.
Added support to boot up sgi IP30 secondary CPUs.
Added isp(4) to the hppa GENERIC kernels.
Added iha(4) to the amd64 RAMDISK_CD kernels.
Added code to unwedge the sparc64 LOMlite.
Better input validation in stty(1).
Updated terminfo to the 20091003 version from upstream.
Unbreak route-to in pf(4) by using a dedicated pf pool for route options.
Fix a NULL pointer store in the ip_output code path. Exploitable on older (4.3) OpenBSD versions.
Make it possible to set the rdomain in ssh(1)/sftp(1)/scp(1)/sshd(8)
Make sure ldattach(8) reinitializes the poll events after each call to poll.
Removed EISA support from i386 RAMDISK kernels.
Synced mandoc to 1.9.11.
Fixed a null dereference in the scsi sleeping code.
Initial mpii(4) driver for MPI2 SAS HBAs, disabled for now.
Added support for power(4) to sgi Octane machines.
Updated the time zone data to tzdata2009p.
Better error handling in bgpd(8) when doing mrt dumps.
Fix aliases resolution in smtpd(8), could accidentally skip recipients sometimes.
For sudo(8), add DISTDIR to list of variables to preserve by default.
Fix in iwn(4) for >=5000 series devices.
Updated xenocara xvinfo to 1.1.0, xwd to 1.0.3, xwininfo to 1.0.5, xwud to 1.0.2 and xbitmaps to 1.1.0.
Updated xenocara xpr to 1.0.3, xprop to 1.1.0, xrdb to 1.0.6, xrefresh to 1.0.3 and xsetroot 1.0.3.
Updated xenocara xkbutils to 1.0.2, xkill to 1.0.2, xlsatoms to 1.0.2, xlsclients to 1.0.2, and xman to 1.1.0.
Updated xenocara xdpyinfo to 1.1.0, xdriinfo to 1.0.3, xev to 1.0.4, xgamma to 1.0.3, xhost to 1.0.3 and xinput to 1.5.0.
Added -a option to tmux(1) to kill all except current pane.
Added M-audio Audiophile 2496 to the list of supported envy(4) devices.
Updated xenocara x11perf to 1.5.1, xclipboard to 1.1.0 and xcmsdb to 1.0.2.
Updated xenocara iceauth to 1.0.3, mkfontscale to 1.0.7, mkfontdir to 1.0.5 and smproxy to 1.0.3.
Enabled event handling on the mpi(4) driver, makes SAS hotplug work.
Reworked interrupt handling on the sgi platform.
Added an xbpci(4) device for mips machines, between xbridge and PCI.
On mips64, prevent mapping of the zero page.
Added Option GT HSUPA 380E to the list of supported umsm(4) devices.
Added support for a passphrase file to bioctl(8).
Fix 2TB issue in sd(4).
Synced mandoc to 1.9.9.
Added handle locking in stdio for threaded applications.
Prevent deadlocks in popen(3) on FILE locking when threaded applications fork(2).
Reworked UTF-8 handling in tmux(1).
On sgi, added dri2 to the list of pre-loaded Xorg modules.
Updated time zone data to tzdata2009o.
Sync mandoc to 1.9.6.
Make interfaces able to accept gratuitous ARP requests where the link route points over the carp interface.
Make sure the kernel cancels the timeout when disabling the profiling/virtual timer.
On sgi machines, get serial console speed from the PROM.
Added detach support to various network drivers.
Imported gcc 4.2.1, the last release with GPLv2 license.
Disable interrupt coalescing on mpi(4).
Make IP30 and IP35 sgi systems report exact model for the hw.product sysctl.
Fix buffer cache backoff in the page daemon.
Added support in m4(1) for the -P option to prefix builtins with m4_.
Make sgi iof(4) pass its bus speed to attached children to allow com(4) work if the PCI bus degrades.
Connect pcppi bell to ukbd so x86 systems with an USB console keyboard can cause beeps.
Moved the WRKOBJDIR default location for ports(7), since the obj dir would confuse mirror-maker and other apps.
Fix in libevent when handling a malloc failure.
Added SB600 to the list of supported auixp(4) devices.
Imported perl 5.10.1.
Fix em(4) support for 82543GC-based devices.
Added a fuzzy addition mode to pkg_add(1).
In smtpd(8), implemented proper virtual domains.
Enable kbd(8) on the landisk and socppc platforms.
Added support in bge(4) for the Broadcom BCM5717 ASIC and the BCM 5717/8 chipsets.
Updated xf865-video-geode to 2.11.6.
In em(4), add support for the ICH9 M V chipset.
Fix mbuf leak in the route rtinit() function when detaching an interface.
Updated xf86-video-nv to 2.1.15.
Added a "grouped sessions" option (-t) to tmux(1) and an option to allow the mouse to select the current pane.
Updated xenocara xmodmap to 1.0.4 and xfs to 1.1.0, xbacklight to 1.1.1 and setxkbmap to 1.1.0.
Let udl(4) select the maximum resolution using the EDID parsing from videomode.
em(4) now has a working detach function.
In tmux(1), be less aggressive about turning the cursor off.
Fix in azalia(4) for NVidia hda controllers.
Added support for the temperature sensor of VIA Nano and C7-M CPUs.
Redid the route lookup in the pf(4) output (and IPv6 forwarding) path if the destination was changed by pf(4).
Added support in bgpd.conf(5) to enable/disable individual BGP capabilities per neighbor, and enable all capabilities by default from now on.
Added minimalistic detach/unmap bits for pciide(4).
When processes exit, move the dropping of the big lock from the end of exit1() to the middle of sched_exit(). May prevent reaper panics.
Added some Intel 10GbE cards to the list of supported ixgbe(4) devices.
Merged detach logic from msk(4) to sk(4) so this driver can detach as well.
Readded support for divert(4) sockets in pf(4).
Fix ipsecctl(8) when operating IKE in dynamic mode and no srcid is given.
Avoid i386 panics when handling XMM exceptions.
Avoid NULL dereference in smtpd(8) when the final RCPT TO is refused.
Added support for DS15/DS25/ES45 alpha models.
Move alpha kernel link address higher to accomodate SRM with larger footprint than the usual 2MB.
OpenSSH 5.3 released.
Added support for generic soft interrupts on macppc.
In ospfd(8), announce a stub network LSA for backup carp interfaces.
Added Phison PS5000 to the list of supported pciide(4) devices.
Added -S and -L options to pfctl(8) to store and load pf state table from a file.
On amd64 and i386, make sure the video buffer area and BIOS areas are unavailable for PCI resource allocations if the BIOS memory map did not reserve them.
Updated time zone data to tzdata2009n.
Added IRIX-compatible cacheflush() routine to mips ports, needed for gcc -ftrampoline operations.
Added preliminary rdomain support to ripd(8).
In xenocara, update xmag to 1.0.3 and xrandr to 1.3.2.
Removed rstart from xenocara.
In xenocara, update util-macros to 1.3.0, appres to 1.0.2, bdftopcf to 1.0.2, bitmap to 1.0.4, xauth to 1.0.4 and xclock to 1.0.4.
Enabled axe(4) and aue(4) on palm RAMDISK kernels.
Fix cwm(1) to hide borders of maximized windows when Xinerama is enabled.
Fix potential double free in the 802.11 crypto code.
Make tmux(1) support -c like sh(1) to execute a command, useful when tmux(1) is a login shell.
Initial Xorg driver to support udl(4) devices.
Update capability code in bgpd(8) to follow RFC 5492.
Allow multiple prefix keys to be defined for tmux(1).
Add support for the watchdog in the sparc64 lom(4).
Synced mandoc to 1.9.5.
Fix for bpf descriptor reference counts when using kqueue.
Implemented a detach function for wpi(4) and iwn(4).
Added support for VIA Nano CPU core temperature sensors.
Added support in axe(4) for AX88772A-based devices.
Initial version of a driver for LOMlite2 found on Sun Fire V100, V120 and Netra X1.
Added bits for X11 support over the wsdisplay framework on udl(4).
Updated xterm(1) to version 248.
Fix libpcap IPv6 mask issue.
Synced mandoc to 1.9.2.
Make lock(1) back off password guesses like login(1).
In find(1), allow -maxdepth 0.
Added support for TP-LINK TL-WN821N to the list of supported otus(4) devices.
Added Huawei E160E and E156G to the list of supported umsm(4) devices.
Rework of the scsi midlayer code in order to help mpath(4) development.
Make udl(4) handle if the command buffer runs full. Allows for higher resolutions without bumping the command buffer or xfer buffer memory.
For socppc machines, added a 'machine fdt' command to the boot environment to dump the device tree if present.
Make tmux(1) able to configure option such as status-bg using the entire 256 colour palette.
Reduced the memory usage of spamd-setup(8) when handling large lists.
Added support in udl(4) for font sizes up to 16 pixels wide.
Added support for divert sockets to pf(4).
Updated Time Zone data to tzdata2009m.
Make the tcpdump(8) BGP OPEN capability parser RFC 5492 compliant.
Update bgpctl(8) irrfilter to support IPv6 and 4-byte AS numbers.
Bring support in socppc for the RB600 machine.
Implemented pf(4) binat-to as a macro-like rule using a nat-to and rdr-to combination.
For socppc machines, attach devices to obio(4) based on the flattened device tree.
Updated xserver to 1.6.4rc1.
Make udl(4) displays use new wsdisplay EAGAIN-like ability if the usb command queue is full. Also makes udl(4) work on MP kernels.
Updated libxcb to 1.4, xcb-util for 0.3.6, and xterm to 247.
Fix stackgap_alloc() issues in the compat code.
Initial code for a palm platform.
Bring back ICH10 support in em(4).
Endian fix for vge(4) on big-endian platforms.
Better sparc64 ELF load address checks in the boot blocks.
Added support in dhcrelay(8) for RFC3046 "DHCP-over-ipsec".
Defer hardware crypto network operations to splsoftnet in order to not create issues with ipsec.
Make socppc attach devices to mainbus(4) based on information from the flattened device tree.
Make getaddrinfo(3) accept numeric servname when ai_socktype is not specified.
In smtpd(8), show mbox write errors in "show stats".
In bgpd(8), implement the RFC4486 BGP Cease Notification Message subcodes.
Initial support for ISP2000 SBus FC cards.
Enabled SBus ti(4) on sparc64 GENERIC and RAMDISK kernels.
Make pf.conf(5) no-df clear the IP_DF bit when enabled, like it was intended.
Glue for sbus version of the ti(4) Sun Vector Gigabit Ethernet card.
Fix a race in ssh-agent(1).
Large rewrite of all NAT code in pf(4) turning nat and rdr into actions on regular rules.
Make relayctl(8) exit with a non-zero value if relayd returned an error.
In dhcpd(8), echo back the Relay Agent Information option if present, and add support for the ipsec-tunnel hardware type.
Make the rtinit() routing code cope when there is a more specific route available than the one planned to remove.
Added a "display-panes" command to tmux(1).
Prevent ppp(8) from ending up in an infinite loop during NAT.
Added support for sparc isp(4) ISP220 SBus FC cards.
Make tcpbench(1) use poll(2) instead of forking lots of children.
Fix cap_mkdb and curses to better reformat terminfo entries into the capabilities database format.
Allow sftp-server(8) setting an explicit umask on the command line.
Reduced polling of the keyboard controller in the pckbc code.
Don't stop libc fts(3) from traversing a directory if we reach SHRT_MAX.
Make relayd.conf(5) allow interface names as addresses.
Speed up softraid(4) RAID6 writes by precalculating XOR lookups.
Avoid renaming on destination files in ftp(1) when following a redirection URL.
Added OGG media types from RFC 5334 to the httpd(8) mime.types database.
Added ! support to ProxyPass in httpd(8) to exclude directories from being proxied.
Added Novatel EU870D to the list of supported umsm(4) devices.
Enabled compression in udl(4).
Make amd64 and i386 machines without PS/2 keyboards not attach pckbd0, so a USB keyboard can become the console.
Added support in udl(4) for a 16bit huffman table to allow for pixel difference compression.
Updated xf86-video-ati to 6.12.2.
Removed the strip(4) device.
Added iha(4) to amd64 GENERIC kernels.
Moved NFS request from a global tailq to a per nfsmount queue.
Added parser on socppc for Flattened Device Tree.
Don't set up multicast on fxp(4) when in promiscuous mode.
Fix order of arguments to memcpy() in pf(4), partial fix for interfaces with >64 aliases.
Added keybinding in cwm(1) to allow horizontal maximization of a window.
Improved CF slot handling on socppc machines.
Fix nnpfs mmap vs read sync issue.
Updated libFS to 1.0.2, libSM to 1.1.1, libXt to 1.0.6 in the xenocara tree.
Synced mandoc to 1.8.5.
Fix in bgpd(8) for peers with a 4-byte AS number when connecting to a template neighbor.
Corrected c++ reference counts on hppa/hppa64.
Rework asynchronous I/O in NFS using separate buf queues for each mount.
Fix for ld.so(1) regarding the library minor numbers.
Added support for iof(4) serial using the sgi IOC4 chip.
Added support in sftp(1) for recursive transfer support.
Removed the sysmerge(8) -a switch, that is default now.
Updated time zone data to tzdata2009l.
Added a ddb(4) command to show all buffers.
Make relayctl(8) report routers.
In sshd.config(5), allow PubkeyAuthentication to the list allowed in a Match block.
Make it possible to specify a port in resolv.conf(5).
Added UDF 2.5/2.6 support, allowing read-only access to HDDVD and Blu-ray disks.
Added ddb(4) function to show all nfs nodes.
Enabled lisa(4) on amd64 and i386 GENERIC kernels.
Use a lock to prevent the nfs_nodetree from a race condition when vnode recycling could pull a vnode out under our feet.
Avoid double release of vnodes in the NFS server code.
Added packet rate counters on the vmstat screen in systat(1).
Added rwlock(9) assertion functions, disabled for now.
Add wake support for pckbd(4).
Added option KVA_GUARDPAGES to config(8), to enable guard pages for kernel allocations and slow recycling of kva.
Rewrite the promisc mode/multicast handling code for the sparc hme(4) driver.
Added vscsi(4) to GENERIC kernels.
Allow tcpbench(1) to bind to a different rdomain.
Added a "router" functionality in relayd(8) to add or remove routes.
Added a command in ddb(4) to show all vnodes.
Changed amd64 kernel linking to use a linker script, Helps if we want to use larger pages for text/etc, and stop saving the .eh frames.
Made the i386 APIC code closer to amd64.
Add wake support to acpihpet(4).
Optimized raid6 in the softraid(4) code. 30% speedup on write.
Changed the way the hppa pmap code marks non-equivalent writeable aliases in pages and whack all other mappings on that page.
Redone the filesystem namecache from a large single hash table to a global LRU of entries, and a redblack tree in each vnode.
Make sure backing store for EGA and VGA virtual consoles are done using the correct geometry.
Rework the if_start routine for interfaces to better handle overload situations where it would otherwise call the softint too seldom.
New lisa(4) driver for the ST LIS331DL accelerometer.
Make MCLGETI handle situations when we get low on clusters for RX rings during interrupts and make the driver free up clusters for later allocation.
Added support for the "Slots Power" sensor on the PowerMac9,1.
Added support in sysctl(1) for SENSOR_WATTS.
Make sftp(1) handle most of scp(1)s command line arguments.
Add support for more sensors in smu(4) on macppc.
Enabled bwi(4) on armish GENERIC and RAMDISK kernels.
Fixed a few bugs in the NFS rename error recovery code.
Use splhigh instead of splclock for amd64 and i386 IPIs, fixes stability problems on some SMP machines.
Added gpio(4) support for amd64.
Changed the way shutdown for interfaces are done to prevent active interfaces to continue do DMA during and after a reboot.
Moved the filehandle/node lookup hash tables to red-black trees.
Removed the old NFSv2 write-gather code, didn't actually improve performance.
Initial version of the DDB_STRUCT kernel option, to add symbolic information about kernel structs and ddb(4) commands to display them. Not enabled by default.
Scale both receive and send buffer on the raw socket in ospfd(8), makes it work on networks with large MTUs.
Synced mandoc to 1.8.4.
Added mpath(4), a driver that steals paths to scsi devices if they could be available via multiple paths and then made available via mpath(4).
Reworked the SysV message queue code to not allocate a static amount of memory for messages.
Fix multicast handling in ale(4).
Added support in ipgphy(4) for the IC Plus IP1001 GigE PHY.
Fix livelock in the buffer cache code for low-memory situations.
Enabled alc(4) on amd64 and i386 RAMDISK kernels.
Added alc(4), a driver for Atheros AR8131/AR8132-based ethernet devices.
Added Digitus DN-7001G to the list of supported acx(4) devices.
Added -E flag to sed(1) to enable extended POSIX regular expressions.
Initial code for Loongsoon2E/F processor support.
Make sure we do not read 1000BaseT specific registers on a 10/100M ale(4) device.
Enabled XCB on the shared libs architectures.
Specify ID-type of IPV4_ADDR or IPV6_ADDR in ipsec.conf(5) if the srcid or dstid is given as an IPv4 or IPv6 address, rather than as a FQDN.
Fix crash in wall(1) when sending to a large group.
Recommitted the dynamic buffer cache support.
Fix hangs on hppa due to races when accessing the list of interrupt handlers.
Added support for VSC8211, CS8244 and VSC8601 PHYs in the ciphy(4) driver.
Added support for BCM5761 in the brgphy(4) driver.
Added Linksys WUSB54GC v3 to the list of supported run(4) devices.
Fixed named(8) DNS update DoS.
Plug a memory leak when calling rtable_add() multiple times.
Change configure test of pixman to make it use MMX code if possible.
Added Alfa AWUS036H to the list of supported urtw(4) devices.
Added gem(4) and gentbi(4) on sparc RAMDISK kernels.
Enabled ti(4) on hppa GENERIC kernels.
Added flow control support to age(4) and ale(4).
Added Digital EtherWORKS to the list of supported ti(4) cards.
Added bus speed recognition on Nehalem based CPUs. Makes Enhanced SpeedStep work.
Added a PCIOCGETROM ioctl(2) to read PCI ROMs.
Fix flow control on stge(4) devices.
Synced mandoc to version 1.8.1.
Alignment fix in bwi(4) on armish machines.
Added midi data sending capabilities to aucat(1) using midicat(1).
Switch re(4) over to the MCLGETI buffer allocator.
Retune sleep time on VIA VT6202 based machines, especially armish ones.
Added softraid(4) framework for RAID6, disabled for now.
New aibs(4) driver for ASUSTeK AI Booster hardware monitoring.
Added big-endian support to the sis(4) driver.
Fix ddb(4) traceback disassembly on sparc64 when the fault is on the first instruction of a routine.
Added PCI-Cardbus bridge support on sgi for both O2 and Octane/Origin class systems.
Allow systat(1) to resolve names by adding the -N flag.
gcc 2.95 fixes for xcb-util.
Updated the time zone data to tzdata2009k.
Make sure the xf86-video-sunffb disable the hardware cursor before exit.
Added "text" (executable) to the fstat(1) and fuser output.
Synced mandoc to 1.8.0.
Fix potential mbuf leaks in the NFSv2 rpc code.
Added bus_space_[read,write]_raw_[248] functions for sgi. Makes wi(4) devices work.
Updated the bus_dma(9) on sgi machines to be closer to the other platforms. Adds a working bus_dmamap_load_uio() which in turn makes crypto(4) devices work.
More careful format string parsing in printf(1).
Added Edimax EW-7711UTn to the list of supported run(4) devices.
Back out the one-slot queue length commits for trunk(4) and vlan(4).
Enabled ppb(4) on sgi O2 kernels.
Make PCI-PCI bridge initialization code on sgi bus-independent.
Added round, roundf, trunc and truncf for hppa libm.
Unbreak the moko builds, move SOFTSERIAL to SOFTTTY and a pmap change for moko.
Added gem(4) on sbus(4) for sparc GENERIC and SUN4M kernels.
Added a bus_dma(9) interface for sparc sun4m machines.
Added rdomain checks in the sppp(4) case.
Make the vlan send queue one slot long, to force packets off the virtual interface queue down to the physical interface immediately.
Synced mandoc to 1.7.23.
Make fstat(1) accept numeric UIDs as well as usernames.
Enabled gem(4) at sbus for sparc64 GENERIC and RAMDISK kernels.
Enabled hotspare rebuilds for softraid(4) RAID1.
Added support for global hotspares to softraid(4)
When rebooting sgi machines, pass a request to the PROM to skip diagnostics and memory initializations. Shortens reboot times.
Delayed creation of tun(4) devices in the netstart(8) script.
Fixed link state handling in the ix(4) driver.
Added support for the onsemi cat34ts02 and cat6095 sensors in sdtemp(4).
Reverted the MCLGETI allocator for sk(4).
Added POSIX-compliant fuser mode to fstat(1).
Better invoking of login shells in tmux(1).
Made ripd(8) aware of MPLS routes.
Synced mandoc to 1.7.22.
Rewritten PCI resource allocator for sgi machines. Makes bge(4) work.
--------
Changes made between OpenBSD 4.5 and 4.6
Added radeonfb(4) to sparc64, an accelerated framebuffer for Sun XVR-100 boards.
Added support in re(4) for RTL8103E and RTL8168DP devices.
Fix em(4) MAC address for dual-port 8257[56] cards.
Added support for BCM5709 devices in the bnx(4) driver.
Split bnx(4) firmware into several files and updated them.
Make ksh(1) avoid infinite recursion if unlink of the history fails.
Make ssh(1) handle long home dir paths.
Add workaround to isp(4) autoconf for arches where the clock is not running yet.
Make floor(3) round towards -inf instead of towards zero.
Make the rc(8) scripts create a syslogd(8) socket in /var/www/dev when httpd is enabled to make logging to syslog work.
Move the sparc second stage bootblocks 256KB higher to accomodate the growth of the GENERIC kernel.
Updated time zone data to tzdata2009j.
Added HW VLAN tagging/stripping for ix(4).
Enabled isp(4) on hppa GENERIC kernels.
Bring back MCLGETI support for ix(4) again.
Fix ix(4) TX DMA map swapping.
Teach sysmerge(8) how to handle links.
Updated xf86-video-openchrome to rev 753.
Make the install scripts add the default user to the 'staff' login class.
Fix segmentation fault in m4(1) macro code.
Fix a use-after-free in the pagedaemon.
Fix in dc(4) for reading the MAC address out of the eeprom instead of CIS.
Added support for ICH10 variants of em(4).
Added support for VIA VX855 chipset in the viapm(4) and pciide(4) drivers.
Updated xf86-video-intel to 2.7.1 and xf86-video-openchrome to svn rev 750.
Re-enabled inteldrm in the i386 GENERIC kernel.
Added a workaround for ehci(4) on ATI SB600 revisions and ATI SB700 south bridge revisions A12 and A13.
Enabled softraid(4) on alpha, hppa and sparc64 RAMDISK kernels.
Make watchdogd(8) lower stacksize before mlockall().
Added support for the Broadcom HT-1100 chipset in the piixpm(4) driver.
Fix extra psignal/wakeup in exit1() which could cause double SIGCHLD signals.
Major update of the isp(4) driver.
Synced mandoc to version 1.7.20.
Added support for 82574L based devices in the em(4) driver.
Fix pf(4) scrub max-mss for IPv6 traffic.
Disable memory above 2G on sgi machines.
Added and enabled stge(4) on sgi GENERIC kernels.
Make wsmoused(8) support mice with lots of buttons.
Updated sudo(8) to version 1.7.2.
Fix possible NULL dereference in ssh(1) when aborting if key_sign fails.
Make vax preserve more registers in sigcontext and return them in sigreturn. Fixes signal return regressions.
Move the MI hme(4) fix for properly clearing the RUNNING/OACTIVE flags and watchdog timer to the sparc hme(4) code.
Fix DMA map issues in the de(4) driver.
Added two new views to systat(1), "nfsserver" and "nfsclient".
Synced mandoc to version 1.7.19.
Added MCLGETI support to vr(4) devices.
Enabled experimental raid 4 & raid 5 disciplines in softraid(4).
Added raid 4 and raid 5 in bioctl(8) create.
Force softraid(4) Raid0/4/5 volume size to multiple of stripe size.
Make ndp(8) check for the correct RTM_VERSION before accessing anything in the rt message.
Make ntpd(8) handle ENOPROTOOPT, can happen when using IPv6.
Better pfsync(4) detection of when we have a better version of the TCP sequence window than our peer.
Fix "gcc -Z" on powerpc machines.
Synced mandoc code to version 1.7.16.
Enable support in pfsync(4) for deferring the packets that creates a state so sync peers are able to receive the state before the reply.
Fix tcpdrop(8) after the routing domain changes.
Fix file(1) byteswapping in the ELF parsing code for BE64 systems.
Removed the xf86-video-suncg6 driver from xenocara.
Make sure splsoftnet() masks softclock on sgi machines.
Rewrite the way pfsync(4) merges states into the local tree.
Improvements in the softraid(4) raid 4 and raid 5 code.
Limit the BCM5701 B5 chipset-based bge(4) devices to 32-bit mode.
In bge(4), set the DMA read watermark to 4 to prevent some TX timeouts.
Make hppa machines correctly flush direct cache and TLB mappings.
Create a hotplug callback mechanism in softraid(4).
Fix freelist overrun in libc gdtoa routines.
Added support for VIA CX800 south bridge to the viapm(4) driver.
Make hotplugd(8) ignore ECHILD from waitpid().
Switch sgi to per-process ASTs.
Added udl(4) and url(4) to sgi GENERIC and RAMDISK kernels.
Fix procmap(1) on hp300 by allowing /dev/mem reads in the direct mapping region where there is corresponding physical memory.
Move vi(1) to use poll(2) instead of select(2).
Initial version of raid 4 & raid 5 support in softraid(4). Not functional yet.
Fix NULL pointer dereference in pf(4) when receiving empty tables over pfsync(4).
Do not accept IPv4 ICMP redirects by default. IPv6 redirects are still enabled.
Updated the installation user input routines to redraw the question if dmesg changes are detected.
Bring back "L" to list keyboard layouts during installs.
Disable xlights on macppc GENERIC kernels.
For amd64 and i386, do not enable EST if the machine only reports a single state.
Updated time zone data to tzdata2009i.
Fix file descriptor leaks in sdiff(1) when diffing regular files.
Fixed minor memory leak in libc yp(8) code.
Fix ftp(1) to handle abort transfers when talking to broken ftp servers.
Make amd64 and i386 disable interrupts during the lock step frequency/voltage change. Fixes random lockups seen with "apm -C".
In ntpd(8), when the clock has become unsynched, reset the number of saved time corrections.
Imported xkeyboard-config into xenocara.
Synced some rcsdiff changes into cvsdiff. opencvs diff -t now works.
Implemented support for RTL8187b based devices in the urtw(4) driver.
When running a 802.11 scan, make it fail if the interface is not up and not running.
Initial code to bring in upcoming DRM support to X.org, starting with the i810 Intel IGP chipsets.
When using sendbug(1) as root, add base64 encoded pcidump(8) and acpidump(8) output
Removed debug output from dhclient(8).
Added an X86EMU option to amd64 and i386 GENERIC kernels to enable the emulator subsystem.
Added VGA BIOS repost support for amd64 and i386 using a small x86 emulator.
Fix lapic, interrupt and clock issues on amd64 and i386 ACPI S3 resume.
Fixed iwi(4) bug.
Removed xf86rushproto and lots of input drivers that have been dropped by X.org.
Updated xf86-video-suntcx to 1.1.1 and xf86-video-sis to 0.10.1.
Fix NULL dereferencing in the ugen(4) USB code.
Updated libpixman to 0.15.8, xf86-video-newport to 0.2.2, xf86-video-suncg3 to 1.1.1 and xf86-video-suncg6 to 1.1.1.
Add support in fxp(4) for the 82552 MAC found in some ICH7 chipsets.
Fix mg(1) cursor position after undo of a region-kill.
When yp(8) is parsing the group(5) file, check early if YP is active or not, instead of half-way through the parsing.
In the yp(8) code, treat an empty domainname as a failing call to getdomainname.
Make the kernel time code abort any adjustment in progress if the clock is set with settimeofday.
Make tmux(1) check LC_CTYPE, LC_ALL and LANG before trying to decide about UTF-8.
Enabled IPv6 receive TCP/UDP checksum offload for jme(4).
Add ability in wsmoused(8) to attach it to a different wsdisplay using -D.
Add support to ping(8), traceroute(8), arp(8), nc(1) and telnet(1) to specify which routing domain to use.
Add code in ifconfig(8) to bind an interface to a routing domain.
Initial support for routing domain. Allows you to bind interfaces to alternate routing tables and separate them from other interfaces in distinct routing tables.
After calling adjfreq to correct the clocks rate, measure and fix the clock offset.
Fix problem in mg(1) where line numbers get out of sync on a region-kill.
When running sysmerge(8) in auto-mode, install binary files from the X sets automatically.
Make backtraces in ddb(4) through interrupts work.
Switched default depth on xf86-video-glint to 24/32 bpp.
Make rtsold(8) turn on -inet6 on the interface.
Make ix(4) devices switch to a dynamic pool backed TX so it doesn't have to allocate everything up front.
Recycled four unused fields in the disklabel structure to fit in bounds information about the zone of the disk that OpenBSD can use.
Implemented CBT support (backward tab) in tmux(1).
In setenv(3), do not assume we can overwrite strings in the environment.
Allow ifconfig(8) to turn off IPv6 completely for an interface using the -inet6 option.
Added Sitecom WL-608 to the list of supported run(4) devices.
Added proper support in tmux(1) for tab stops.
Plug NFS mbuf leaks in the DRC.
Added a resolv.conf(5) option to specify the order in which getaddrinfo(3) queries will be made. Changed the default to ipv4 first and then ipv6.
Endian fixes in xf86-video-glint.
Plug memory leak in systat(1) when the terminal is resized.
Added support in tmux(1) for C0 within escape sequences and the C0 vertical tab.
Make relayd(8) keep the SSL session for each checked host, making subsequent checks faster and lighter on the server.
If getgrent(3) fails while handling a +groupname:*:: entry due to lack of memory, make sure we report the error condition.
Fixed segfault in locate(1) if count gets out of bounds.
Make tun(4) emulate link state depending on the open and close of the device fd.
Fix the installer ftp(1) client to handle bracketed IPv6 host addresses.
Fix auto-negotiation on some msk(4) devices.
Rework the ip_input code decision on whether a packet is to be delivered locally or forwarded. Improves forwarding speed on boxes with many local addresses.
Fix re(4) IPv4 RX checksumming for the non-TCP/UDP case.
Added "rde rib <name>" to the bgpd(8) config and allow the rde to use these other RIBs.
Enable bge(4) IPv6 receive TCP/UDP checksum offload for the 5755 and later chips.
Make ksh(1) in vi mode handle ^W erase more like vi(1).
Fixed active ftp sessions over IPv6 in ftpd(8).
Added gfxp(4) to sparc64 GENERIC, RAMDISK and RAMDISKU5 kernels.
Added a kern.bufcachepercent sysctl(8) to allow adjusting the buffer cache size on a running system.
Make wireless interfaces have priority 4 by default. Other interfaces remain at 0.
Make tmux(1) pass window titles through vis(3) to remove nonprintable characters.
Added hotplug device support on SGI machines and added hotplugd(8) to SGI builds.
Changed the httpd(8) config to allow localhost to query server-status by default.
Added basic infrastructure to take advantage of TCP and UDP receive checksum offload over IPv6.
Added support in em(4) for the newer 82575 (and maybe 82576) chips.
Make yp(8) support group(5) exclusion.
Make putenv(), setenv() and unsetenv() in libc standards compliant.
If both -h and -k are specified in df(1), the latter takes precedence.
Better scp: URL handling in pkg_add(1).
Fixed crash in tmux(1) when swapping pane positions.
Imported an acpi power resource driver to amd64 and i386 GENERIC kernels.
Make bge(4) set IFF_ALLMULTI properly when in promiscuous mode.
Make dhclient(8) use the newer route flush functionality, which allows for multiple dhclients to coexist.
Added acpivideo code to get brightness support for all laptops except thinkpads.
Updated the NFS over UDP transmit logic.
Enabled acpidock on amd64 and i386 GENERIC kernels.
Disabled tmux(1) UTF-8 detection code, breaks on sparc64 machines.
Fix apache so it reports Content-Length as 64-bit integers, allowing for files larger than 2G to be served.
Switched uvm object global hash table to a red-black tree.
Make the install scripts detect changes in the interface list.
Reintroduced the powerpc interrupt rewrite for the macppc and socppc platforms.
Make ospfd(8) and ripd(8) track reject and blackhole routes and allow them to be redistributed even if pointing to 127.0.0.1.
Make softraid(4) rebuilds restartable over reboots.
Fix bug in mg(1) where it would crash if lots of characters were inserted into the minibuffer.
Make fxp(4) and rl(4) at pci detachable.
In the iwn(4) driver, make sure it does not leak mbufs in the RX path in case hardware decryption failed.
Make tmux(1) spawn login shells by default.
Make atw(4) and dc(4) at pci detachable.
Make gscsio(4) cope with logical device number gaps.
Do not leak memory in tmux(1) if multiple -f flags are given.
Fix problem with ypldap(8) lookup by uid.
Fixed ksh(1) macro handling.
Enabled the CRYPTO option by default on macppc and zaurus RAMDISK kernels.
Make xl(4) at pci detachable.
Added tmux(1) to the builds.
Enabled machfb(4) and raptor(4) on the sparc64 RAMDISKU5 kernel.
Enabled machfb(4) on sparc64 GENERIC and RAMDISK kernels.
Implemented machfb(4), an accelerated driver for the sparc64 PGX/PGX64 framebuffers.
Added an interface for CPU idle on amd64.
Make rtw(4) devices detachable.
Initial bits for softraid(4) rebuilds. Disabled for now.
Fix NULL pointer dereference in the libc rpc(3) code when a client encounters ENOMEM while trying to print an error message.
Better atomic locking routines for mips64.
Imported tmux(1), a terminal multiplexer.
Make smtpd(8) propagate the recipient domain through aliases expansion.
Initial version of ldpctl(8) and ldpd(8), a label distribution protocol daemon for mpls.
Make the uvm(9) RLIMIT_DATA check deal with wraparounds.
Fix the order of checking whether an amd64 or i386 machine has MTRR.
Disconnected sup(1) from the builds.
Fix NULL dereference in acpidump(8).
Fix ksh(1) crash when handling expressions containing "--" and "++".
Make udl(4) allow font widths other than 8 pixels wide.
Removed window(1).
Enabled zyd(4) on more platforms after the endian fix.
Display SSL negotiation information in the received line of incoming sessions in smtpd(8).
Fix libevent EV_READ/EV_WRITE for smtpd(8) also.
In udl(4), fix End Of Command token for async transfers.
Fixed endian issue in zyd(4).
Add uvideo(4) to zaurus GENERIC kernels.
Move the test for EST capability on amd64 outside the intel vendor check and use the EST CPU feature to determine if it is available or not.
Enabled udl(4) on the socppc platform.
Enabled pf(4) by default in the rc.conf(8).
Make the pf(4) "set" operations for loginterface, hostid, reassemble and debug transactional.
Reduced udl(4) overhead by addressing 256 pixels per command instead of 128.
Added support for audible ping(8) and ping6(8). Use -e to beep on replies and -E to beep on missed packets.
Fixed routing daemons using libevent to handle if EV_READ and EV_WRITE are set at the same time.
Updated xcb-proto to 1.5, libxcb to 1.3 and xcb-util to 0.3.5.
Workaround xterm(1) issue on ARM cpus.
Updated lynx(1) to 2.8.6-rel15.
Added SCH IDE support in pciide(4).
Re-enabled interface state tracking again.
Fix a missing refcnt bump causing panics in the kernel routing socket code.
Added VIA CPU crypto support on the amd64 platform.
In ntpd(8), use the SCM_TIMESTAMP socket option to get the time we received a reply, instead of the time when ntpd read from the socket.
Added support in smptd(8) for specifying a certificate when relaying to another host which requests client certificates.
Do not consider unresolved weak symbols in the ldconfig(8) prebind code an error.
Added an acpi(4) error handler for missing AML nameref.
Fixed acpi(4) parsing rules for Scope opcode. Fixes panics on some HP systems.
Have softraid(4) bring up raid sets that have missing members.
Make ddb(4) allow 8-byte writes on 64-bit platforms.
Make route(8) flush accept "-iface/-interface" or "-priority" to be specified to only flush routes matching these conditions.
When booting SGI machines in the "install software" mode, make them load the correct bsd.rd.IP## instead of just bsd.rd.
Make fsck_ffs(8) check values in cg_initediblk more strictly to prevent corruption.
Make vr(4) return the RX descriptor after pointing it to a new mbuf, fixes panics seen when handling many small packets.
Fix disklabel(8) exit codes in order to help the install scripts catch failures.
Make SGI machines handle NMI interrupts on IP27 and IP35 systems.
Make smtpd(8) include both the incoming message size and the envelope address in the email headers.
Made the install script acquire the list of attached disks and CDs whenever required so you can plug in additional devices after the install has started.
Temporary fix in the smtpd(8) ruleset processing.
Fixed old dhclient bug which could cause lease entries to be lost when initially loading the client leases.
Make sure smtpd(8) will only allow one AUTH command per session and reject further AUTH attempts.
Added request flood mitigation to smtpd(8).
Updated the time zone data to tzdata2009g.
Allow iwn(4) to coexist with Intel Active Management Technology which may use WLAN too.
Added an option to bgpd(8) to change the "connect-retry" timer.
Make sure cloned routes inherit the route label.
Select the SGI TLB handler workaround at run-time since the fix for R5000 will confuse R10k rev 3 CPUs.
For tcpdump(8), add a missing check for truncated dport in the returned UDP header for ICMP_UNREACH_PORT.
Endian fix in em(4) VLAN handling.
Make the security(8) script honor the SUIDSKIP variable to exclude paths from setuid and device checks.
Added limited iommu functionality to the SGI xbow XBridge code, allows an IP35 machine with memory after the 2GB boundary to run.
Enabled support in bge(4) for HW TCP/UDP/IP receive checksumming, and IP transmit checksumming.
Added Pantech UM175 to the list of supported umsm(4) devices.
BCM57790 is also supported in bge(4) since the last update.
Added D-Link DWA-130 rev D1 to the list of supported otus(4).
Added Unitek Y-2240 to the list of supported udl(4) devices.
Imported libxcb 1.2 and xcb-util 0.3.4 into the xenocara tree.
Add support for BCM567x, 577x and some new 572x/578x devices in bge(4).
Added ForwardVideo EasyCAP008 and Knig CMP-USBVGA10 to the list of supported udl(4) devices.
Make daily(8) skip ROOTBACKUP when the destination disk device is not configured.
Make sure daemons do not fall back to the user "nobody" if the specific _user is not found.
Add code to sparc and sparc64 to attach mice as wsmouse(4) devices. Allows sparc and sparc64 users to run X without a configuration file. Multihead still needs a minimal configuration file though.
Make ntpd(8) check mode to prevent replying to broadcast and other unwanted ntp packets.
First step towards smtpd(8) configuration reload.
Prevent injection of raw 802.11 control frames through bpf(4) on devices that do not explicitly state this capability.
Added Hercules HWNU-300 to the list of supported run(4) devices.
Updated xinput to 1.4.2, xf86-input-vmmouse to 12.6.4 and xf86-video-vmware to 10.16.6.
Make sure all users of the routing table index uses a signed type.
Added support for the DisplayLink USB<->DVI Adapter in udl(4).
Fix in gcc for sparc64 for INTMAX_TYPE and UINTMAX_TYPE.
New firmware package for iwn(4), containing a new image for Wifi Link 5150. No change for 4965, 5000, 5100 and 5350-based devices.
Rework color handling in cwm(1).
Updated the Mesa GL code to 7.4.2.
Make cwm(1) redraw the border when unhiding a client window.
In bgpd(8), rework most of the RDE to allow multiple RIBs.
Initial version of vsw(4), a driver for the virtual network switch on sun4v sparc64s.
Enabled udl(4) on amd64, i386 and sparc64 GENERIC kernels.
Enabled udl(4) and wsmux(4) on the armish platform.
Enabled udl(4) and ukbd(4) on the landisk platform.
Fix ospfd(8) route metric for "redistribute default".
Updated the run(4) microcode.
Added Mvix Nubbin MS-811N to the list of supported run(4) devices.
Better MBR validation routines.
Added Various GENERIC-IP## and RAMDISK-IP## files to the arch/sgi/conf dir to support the various models.
Different SGI interrupt deadlock prevention using a timeout. Makes Origin 200 run multiuser.
Make SGI boot code compile both 32-bit and 64-bit boot blocks.
Added udl(4) in macppc GENERIC kernels. Disabled by default.
Added cwm(1) configfile commands 'grouponly[1-9]' to select a group and hide all the others.
Avoid loop in the UDF disksort() code.
Added support on newer axe(4) devices to set a different MAC address than the one in the EEPROM.
Added Adaptec AAR-1225SA to the list of sili(4) devices. Should work.
Make sure pfsync(4) only send frequent updates for TCP connections, the state sync for all the other protocols only have 1-second resolution anyhow.
Added udl(4) to i386 GENERIC kernels, disabled for now.
Switched iwn(4) and wpi(4) over to the MCLGETI buffer allocator.
Added support in umsm(4) for Truinstall enabled modems like Sierra 881U.
The daily(8) script now looks for VERBOSESTATUS and if set to 0, no mails will be sent unless there is something to report.
Added a new feature to sysmerge(8) when run in -a mode, to checksum reference files in order to be able to automatically upgrade all unmodified files next time. Also, -S and -X switches are now deprecated.
Add Edimax RT2860-based devices attach to ral(4).
Fix iwi(4) association with APs that refuse non short slot-time capable STAs.
Enabled USB RX stream mode for run(4) devices.
For VT6105M-based vr(4) devices, enable the IP, TCP and UDP checksumming.
Enabled vcc(4) and vcctty(4) on sparc64 GENERIC kernels.
Added a vcc(4) and vcctty(4) driver for the "Virtual Console Concentrator" found on the control domain of sun4v systems.
Avoid the expensive mbuf copies on modern vr(4) devices and use a quirk table for device matching.
Better job handling in make(1).
Initial udl(4) console device driver for USB displays based on DisplayLink DL-120 / DL-160 display chips.
Rewrite of the daily/weekly/monthly scripts run from cron(8). Weekly and monthly will be more silent now.
Fix xbow devio byteswap on the SGI platform, makes isp(4) happy on IP27 and IP35 machines.
Initial code for a port to the ARM7-based omap35xx platform. Not functional yet.
Moved amas(4) to the generic dev/pci source dir and added it to the i386 platform also, still disabled by default on amd64 and i386.
Make the default dot.login scripts skip terminal initialization when logging in from an xterm.
Fix for SGI clock interrupt checks, would run at HZ/2 previously.
Make sure ls(1) in -C mode does not ignore the COLUMNS environment variable even if the output filehandle is not a tty.
Initial version of endrun(4), a driver for the EndRun Technologies native time-of-day timedelta sensor.
Fix for xf86-video-mach64 ATI reference clock for Rage XL and Mobility cards on sparc64 so you can run X without an xorg.conf on machines like Blade100 and the Tadpole laptops.
Updated libdrm to 2.4.9.
Updated xf86-input-mouse to 1.4.0, xf86-video-ast to 0.89.0, xf86-video-nv to 2.1.13 and xf86-video-siliconmotion to 1.7.1.
Updated xf86-input-penmount to 1.4.0, xf86-input-vmmouse to 12.6.3, xf86-input-void to 1.2.0 and xf86-input-keyboard to 1.3.2.
Updated xf86-input-fpit to 1.3.0, xf86-input-hyperpen to 1.3.0 and xf86-input-joystick to 1.4.1.
Updated xinit to 1.1.1, xf86-input-acecad to 1.3.0 and xf86-input-citron to 2.2.2.
Updated xproto to 7.0.15, and xextproto to 7.0.4 and libX11 to 1.2.1.
Various installation script updates and fixes, and a new ftplist backend that tries to provide a good ftp server for you to use.
Updated inputproto to 1.5.0, libXi to 1.2.1 and xinput to 1.4.1.
Updated xrandr, randrproto and libXrandr in xenocara to 1.3.0.
Fix link state updates in vr(4) when used together with an rlphy(4).
Added READ(16) and WRITE(16) commands to mfi(4).
Make the boot loader able to pass db_console to the kernel, then use it to set ddb.console early in the boot for amd64 and i386.
Enable hardware VLAN tagging/stripping on ix(4).
Implemented 64-bit FIFO modes for ciss(4) devices.
Extended top(1) STATE column to fit more than 9 CPUs.
Added VLAN support on the install media where it fits.
Make sure vr(4) interfaces do not get stuck if the interface went through a link state change.
Make OpenCVS support some additional diff options: -a, -b, -d and -w.
Updated time zone data to tzdata2009g.
Fixed security issues in the freetype library.
Updated xf86-video-radeonhd to 1.2.5.
Make xterm(1) default to being a login shell by setting XTerm*loginShell:true in the Xdefaults for users.
Make sure ftp(1) is not trying to send NOOP strings after server closes the connection.
Added basic support for Envy24HT chips in the envy(4) driver.
Fixed scalbn, scalbnf and frexpf on amd64 libm.
Enabled berkwdt(4) on i386 GENERIC kernels.
Updated file(1) to 4.24. Includes a "-i" switch so file(1) can output mime type strings.
Added berkwdt(4), a driver for the Berkshire Products PCI PC Watchdog.
Make relayd(8) allow both UDP and TCP redirections now.
Moved ix(4) buffer allocations to MCLGETI.
Added support in pciide(4) for ICH10 SATA devices not operating in AHCI mode.
Fix segfault in ping(8) when displaying certain ICMP packets that are not echo replies.
Move bge(4) jumbo frame allocator to the MCLGETI interface.
Allow bgpd.conf(5) and bgpctl(8) to contain 32-bit ASN numbers written in ASPLAIN format.
Make ntpd(8) ignore replies with timestamps after 2030 to prevent time_t / tv_sec wraps.
Make bgpd(8) discard pfkey replies that were destined for some other host.
Increased the default thread stack size to 256k for 32-bit hosts and to 512k on 64-bit hosts.
Added Emobile D12HW to the list of supported umsm(4) devices.
Added an 8U252AM4 chipset to the list of supported uftdi(4) devices.
Make ftpd(8) log both remote IP and the remote hostname when receiving a new connection.
Various small improvements in spamd(8).
Fix renice(8) for a negative pid when in historic mode.
Added an amas(4) device for amd64 based machines to describe the physical memory layout.
Fix bnx(4) DMA map unmapping and unloading in the TX cleanup path.
Enabled schsio(4) on amd64 and i386 GENERIC kernels.
Moved ARM and SH soft interrupts to mutexes also.
Switch the amd64 and i386 soft interrupt code over to mutexes instead of simplelocks + splhigh().
Synced sudo(8) with version 1.7.1 final.
Switched hme(4) over to the MCLGETI mbuf allocator for the RX ring.
Make MPLS correctly handle packets the are leaving the MPLS cloud and joining the IPv4/IPv6 stack.
Added "Connection close" to HTTP check headers in relayd(8) to not confuse HTTP/1.1 servers claiming keepalive sessions.
Added support for -t, -v and -F cmdline args in the smtpd(8) sendmail interface.
After the large pf(4) rewrite, fix a few things like correctly inheriting queue stuff, tag, rtableid from the rule if we have no state.
Removed the unused en(4) driver.
Convert the sis(4) driver to the MCLGETI buffer allocator. Makes it handle overcapacity far better.
Initial implementation of package signatures for pkg_add(1).
Updated time zone data to tzdata2009f.
Enabled ix(4) on amd64 and i386 RAMDISK kernels.
Some tweaks to the CPU affinity code.
Make sure the bnx(4) driver does not free an mbuf that still is in the TX queue.
Start of Origin 200 support in the SGI platform.
Converted various macros in the NFS code to functions to reduce kernel memory usage.
Added a "-T title" option to ftp(1).
Implemented a /dev/mdesc file for sparc64 platforms to read the machine description on sun4v virtual machines.
Added support for IOC3 interrupts on SGI machines.
Make smtpd(8) not assume all certificates match the interface names when explicitly provided in the configuration.
When running sysmerge(8) in automode, it will automatically install files that only differ by CVS Id.
RELIABILITY FIX: Null pointer dereference in pf(4)
A source code patch is available.
[Applied to stable]
Updated sudo(8) to 1.7.1.
Added auto-disk layout to the installation media for simple one-disk installs.
Moved sparc to generic soft interrupts.
Updated xf86-video-i740 to 1.3.0, xf86-video-vesa to 2.2.0 and libICE to 1.0.5.
Added a hook in sysmerge(8) to deal with special sendmail db files under /etc/mail.
RELIABILITY FIX: OpenSSL ASN.1 invalid memory accesses.
A source code patch is available.
[Applied to stable]
Allow to specify an alternate control socket for ospfd(8).
Disabled tht(4) checksumming, appears broken on fragmented packets.
Updated time zone data to tzdata2009e.
Initial version of a mandoc(1) program.
Fix panic when unplugging an otus(4) device.
Removed pf(4) scrub rules, and only do one kind of packet reassembly. Regular rules can now have per-rule scrub options. Also new "match" keyword and a small speedup.
Make sysmerge(8) create a report summary file in the work directory.
Updated OpenSSL to 0.9.8k.
For the SH architecture, implement and use sqrt, sqrtf and fabsf in hardware.
Updated fontconfig to 2.6.0.
Make patch(1) also return an exit code to indicate failure, apart from the stderr output.
Updated xterm(1)to version 243.
Make OpenCVS properly expand modules if requested by the client.
Make systat(1) show interface description names in the interface view.
Added code in the scheduler to peg a process to stay on a CPU forever.
Fixed smtpd(8) auth PLAIN authentication issues.
Fixed SEM_UNDO handling for rthreads.
Converted the procfs from lockmgr(9) to an rwlock(9).
Added support in relayd(8) for specifying a CA file to verify SSL server certificates when connecting as a client from relays.
Make relayd(8) re-initialize tables after reload to handle new and changed tables.
Remove duplicate entry in fdisk(8) for partition id 0x07, so it shows up as NTFS.
Added support in relayd(8) for client-side TCP connections from relays.
When the acx(4) watchdog times out, reset the full chip.
Fixed possible memory leaks in the yacc parser code used in various applications.
RELIABILITY FIX: Use of pmap flags in DMA'able memory mapped by devices on i386 may cause the flags to be uninitialized and the devices to misbehave.
A source code patch is available.
[Applied to stable]
Switch sk(4) over to the MCLGETI allocators for the RX ring.
Make systat(1) show usable numbers for fast disk transfer speeds in the vmstat view.
Switched bnx(4) to the MCLGETI jumbo frame allocator.
Fix puc(4) rate calculations for the 8-port Serial Technologies Expander PCI-232-108.
Enabled ahc(4) on sparc64 RAMDISK kernels.
Various ospf6d(8) updates and fixes.
Fix kernel crash in uvideo(4) when closing bulk devices.
Bypass macsec on extreme/supreme-based msk(4) devices, makes 88E8072 chips work.
Fix hard lock issues on msk(4) devices.
Fix hard locks in the msk(4) driver.
Fix for race in mfi(4).
Added an U command to the disklabel(8) E(ditor) to revert the label to the previous state.
Added C99-conformant nan, nanf and nanl for the Vax platform.
Fix for decoding pathnames in rdistd(1) which contain space,tab or newline characters.
Fix soft interrupt handling on sun4m sparc machines, so Ross systems work when using hme(4).
Added EW-7717Un and 7718Un to the list of supported run(4) devices.
Added Edimax EW-7318Ug, 7318USg and 7618Ug to the list of supported rum(4) devices.
Added support for the BCM5825 and 5860/61/62 Broadcom CryptoNetX IPSec/SSL Security processor in the ubsec(4) driver.
Added ASUS USB-N11 to the list of supported run(4) devices.
Fix for (root) logins when yp(8) is configured but temporarily unavailable.
Added Sitecom WL-603 to the list of supported zyd(4) devices.
Added Linksys WUSB200 to the list of supported rum(4) devices.
Added a couple of GW3887/v2-based devices to the upgt(4) driver.
Fix permission race in install(1) when run with -S.
Fix handling of files in Attic/ for OpenCVS, also fixes -l and -r for checkout/update when a file in Attic exists in HEAD which is a directory in the normal repo.
Updated xf86-video-siliconmotion to 1.7.0.
Synced the net802.11 code with 802.11w draft 8.0.
Added support for CACE AirPcap Nx in the otus(4) driver.
Updated freetype to 2.3.9.
Switched OpenCVS file and directory lists to Redblack tree(3) for faster lookups.
Added watchdog timer support to schsio(4).
Moved the NTFS kernel code from lockmgr(9) to rwlock(9).
Added "Chen-Source CM12402 Eagle IR Cam" to the list of supported uvideo(4) devices.
Make perl(1) encoding library recognize "646" as an alias for "ascii".
Added Emobile D21LC to the list of supported umsm(4) devies.
You may now feed sysmerge(8) older etcXX and/or xetcXX tarballs so sysmerge(8) can automatically update files that did not have local changes between versions.
Added support for AES-CBC with the BCM5823-based ubsec(4) devices.
Enabled otus(4) on amd64 and i386 GENERIC kernels.
Changed the behaviour of "redistribute default" for ospfd(8) and ripd(8). A default route has to be present in the FIB to be correctly advertised.
Upgrade txp(4) to a newer firmware, needed by some variants.
Switched msk(4) to use MCLGETI for jumbo frame allocations.
Initial version of otus(4), a driver for Atheros AR9001U USB IEEE 802.11 devices.
Added rlog -d support in OpenCVS.
Added CPU process affinity for SMP arches.
Fix possible out-of-bounds access in ssh-agent(1) if the environment variable SHELL was shorter than 3 characters.
Fix auto-negotiation for manual media type selection on ale(4).
Add workaround for gem(4) RX MAC/FIFO hangs on ERI.
Added an 'A' command to disklabel(8) Editor mode, and -A flag to automatically execute it on disks without a label.
RELIABILITY FIX: Audio interrupts while filling the audio ring buffers could make the audio application go out of sync during high system load.
A source code patch is available.
[Applied to stable]
Made acpiprt(4) always re-route interrupts.
Switched vax and sgi machines to have generic soft interrupts.
Attached smtpd(8) to the build.
Updated time zone data to tzdata2009c.
Prevent ips(4) from setting error on data underrun, allows a scsi tape on the pass-through bus.
Added support for 88E8057-based Yukon 2 Ultra 2-devices in msk(4).
Initial support for pruning in dvmrpd(8).
Added D-Link DWA-130 to the list of supported run(4) devices.
Added SCSI Pass-through and enclosure support to ips(4).
RELIABILITY FIX: aucat(1) in server mode will send each synchronization message twice which may cause stuttering.
A source code patch is available.
[Applied to stable]
Fix bgpd(8) to correctly encode MP unreachable NLRI so IPv6 prefixes get removed correctly.
Make sure iommu attaches to AMD family 10h processors too.
Added the MAC address to the log entries for DHCP ACK/NAK/OFFER in dhclient(8).
Added sensor devices for Thinkpads.
Updated freetype to 2.3.8.
Enabled vic(4) on amd64 GENERIC and RAMDISK_CD kernels aswell.
Make httpd(8) drop privileges to www/www instead of nobody/nogroup if the User/Group config file entries are not present.
Enabled urtw(4) on amd64 and i386 GENERIC and RAMDISK_CD kernels.
Initial version of a driver for the FFB3/XVR-1000 graphics adapters for sparc64. Disabled for now.
Updated xterm(1) to 242.
Switched the m88k platform to timecounters.
Added support for Geyser2 devices and fix some Geyser1 devices that can be found in iBook G4 12" machines.
Removed deprecated proxymgr and xfindproxy applications from xenocara.
Updated xauth(1) to 1.0.3 plus some fixes from the git repository.
Updated xf86-video-neomagic to 1.2.2 and xf86-video-s3 to 0.6.1.
Updated xf86-video-ast 0.88.8, xf86-video-chips to 1.2.1, xf86-video-dummy to 0.3.1 and xf86-video-glint to 1.2.2.
Updated xf86-video-voodoo to 1.2.1, xf86-video-apm to 1.2.1 and xf86-video-ark to 0.7.1.
Updated xf86-video-tseng to 1.2.1 and removed xf86-video-cyrix/xf86-video-vga.
Updated xf86-video-sisusb to 0.9.1, xf86-video-sunleo to 1.2.0, xf86-video-tdfx to 1.4.1, xf86-video-tga to 1.2.0 and xf86-video-trident to 1.3.1.
Make dvmrp(8) RDE aware of multicast group members per interface.
Bring in a few more PCI IDs into aac(4) to match IBM ServeRAID 8i and 8s.
Added support for the IBM ServeRAID-8k in the aac(4) driver.
Make ELF platforms generate ELF core dumps.
Teach bfd and gdb(1) about the upcoming ELF core dumps.
Stricter pf(4) checking for ICMP and ICMPv6 packets.
Updated xf86-video-rendition to 4.2.1 and xf86-video-s3virge to 1.10.2.
Added a user and a group for smtpd.
Fix clock drift on 197DP mvme88k SMP machines.
Make sure ntpd(8) does not convert the received refid to host byte order.
Fix NFS on m88k SMP kernels.
Added POSIX character class support to ksh(1) globbing.
Added a few more RealTek RTL8187-based cards to the list of supported urtw(4) devices.
Make sure the radix_mpath code checks rt_gateway is not NULL.
Fixed the standalone tftp client to send valid ERROR packets to prematurely terminate a transfer.
Added support in the mvme68k platform for MVME141 and MVME165 boards.
Enabled raptor(4) on sparc64 GENERIC and RAMDISK kernels.
Fixed ksh(1) test(1) operator precedence inconsistency.
Added raptor(4), an accelerated framebuffer driver for the Tech Source Raptor GFX cards on the sparc64 platform.
Make libc mktemp(3) also use digits in the random file name. Also include a termination condition after 2*N^62 attempts where N is the number of X's in the filename template.
Prevent normal users from running "smtpctl show stats" and "smtpctl schedule".
Make pfsync(4) check IFF_RUNNING before doing stuff, to save time for people that don't use pfsync.
--------
Changes made between OpenBSD 4.4 and 4.5
Fix quick reuse of TCP states in pf(4).
Better NMI handling for m88k, without the AST and softintr parts.
Fixed panic in the acx(4) driver.
Added two ioctls to the apm(4) interface to give other parts a chance to act when a machine suspends, not just apmd(8).
Make pfsync(4) bulk update code run under splsoftnet to prevent races.
Fix multicast support in jme(4) and ale(4).
Enabled ale(4) on amd64 and i386 GENERIC and RAMDISK_CD kernels.
Added ale(4), a driver for the Atheros AR8121/8113/8114 Ethernet controllers.
Fix pfsync(4) to make ipsec gateway failover work again.
Fix issue with sis(4) chips that report VLAN tagged packets with an RX error even if everything is fine.
Added hardware acceleration in gbe(4) to SGI O2 framebuffers.
Teach smtpctl(8) how to reschedule a message even if the retry delay has not expired.
Prevent pfsync(4) from putting packets on the wire if no syncdev is specified.
Added SAS1078DE to the list of supported mfi(4) devices.
Better short frame detection in the tcpdump(8) pfsync decoder.
Moved OpenSSH to version 5.2.
Reduce lower bound of uvm_km_pages for machines with less than 16M of physical memory.
Stop enforcing a minimum size for nkmempages by default.
When doing IPv6 MTU discovery, make sure the requested MTU is not less than the minimal v6 MTU minus the size of a frag header.
Added yukon-2 FE+ to the list of supported msk(4) devices.
Limit the amount of file descriptors to create when passing fd's so it will fit the amount the receiver will allow.
Make sure OpenCVS properly convert dates between timezones before comparison.
Reworked m88k MP lock logic, now allows for multiuser and parallel kernel builds on MVME197DP boards.
Various OpenCVS improvements and fixes.
Fix kernel crash in the uvideo(4) bulk device code when closing the video stream.
Better atomic operations for m88k, makes 197DP machines almost reach multiuser.
Fix for m88k to let M188 kernels compile again.
Let the sdmmc(4) adapters tell the sdmmc layer how many sectors they can transfer with one command. Speeds up some devices by 2.5 times.
Make sure the bpf(4) tap is always called with the same interrupt priority level as the tun(4) to prevent races.
Fix an rthreads race in the reaper.
Reworked the Intra-Area-Prefix LSAs in ospf6d(8) to be RFC5340 compliant.
Make ospf6d(8) send the correct nbr state to RDE.
Disabled all IGPGART chipsets from the radeondrm driver, since all the tested ones have issues.
Enabled zyd(4) on socppc GENERIC and RAMDISK kernels.
Fix installer so it accepts '\' characters as password.
Make the smtpd(8) newaliases read aliases path from smtpd.conf(5).
Fix crash related to incorrect initialization of queues in pfsync.
Fix crash in libc mktemp(3) where there filename was all X characters.
Moved mvme68k ethernet buffers higher in memory in the bootblocks to allow for larger bsd.rds to load correctly.
Make sysmerge(8) always run pwd_mkdb(8), newaliases(1) and MAKEDEV(8).
RELIABILITY FIX: bgpd(8) issue when attaching its own AS to an AS-PATH sequence of 255 elements.
A source code patch is available.
[Applied to stable]
Fix pfctl(8) -v printing of anchors.
Various m88k 88110 SMP fixes.
Disabled kernel memory pool debugging stuff for the release.
Changed max username and password length for sppp(4) to 255.
Fix for crashes on machines with Core i7 chips when trying to read MSR_TEMPERATURE_TARGET.
Moved the pfsync(4) protocol to v5, which breaks compatibility with previous pfsync(4) versions. Improves performance and allows several types of updates in a single packet.
Make rdist(1) silently ignore special files which cannot be moved.
Make sure chpass(1) in a secure yp(8) context will not turn a users password into "*".
Prevent display and saving of fsize/bsize fields for UNUSED partitions via the disklabel(8) 's' command.
Various DRM and dmamem related improvements in xenocara.
Make xenocara libpciaccess domain-aware. Makes X capable of discovering PCI devices in other domains.
Prevent rcs(1) and OpenCVS leaving temporary files behind.
Added support in rcs(1) for "rlog -d".
Fix issue in smtpd(8) where list of 6 MXs or more was not handled correctly.
Make ifconfig(8) "chan" option list support channels and "scan" list access points or to list known stations in HostAP mode.
Limit HPPA physical memory to 2G maximum.
Implemented "makemap -t" and "makemap -o" for smtpd(8).
Added vsbic(4), a driver for the MVMW327A SCSI and floppy controller on mvme88k machines. Only for SCSI so far.
Enabled age(4) on amd64 and i386 RAMDISK_CD kernels.
Increase default snaplen in tcpdump(8) to 116, to allow capture of pflog+ipv6+tcp without tuning.
Various MP fixes and improvements for mvme88k machines.
Fix "boot -d" on amd64 MP kernels.
Prevent sleep(1) from trashing the argv space when parsing arguments.
Fix for re(4) problems, removed undocumented accesses to register 0x82 for earlier hardware.
Add ssh(1) support for remote port forwarding with a zero listen port to dynamically allocate one at runtime.
Remove 'free list modified' panics in pf(4).
Fix alignment in bgpd(8) for 64bit architectures when dealing with sockaddr_in6 structs.
Fix fts(3) level going negative on really deep directories.
Fix gcc bug that broke double -> unsigned long conversions on sparc64.
Enable run(4) on all arches where ural(4) and rum(4) exist.
Prevent panic in the mbuf code path if m_copyback() is working on a M_READONLY mbuf.
Initial bio(4) support for ips(4).
Updated leapseconds time zone data to tzdata2009b.
Make libsndio ignore environment variables if the program is setuid or setgid.
In the i915 intel graphic code, make sure vblank is not enabled if the pipe is disabled.
Moved to 4.5-beta.
Enabled ips(4) on amd64 and i386 CD RAMDISK kernels.
Fix cpu_hardclock() issues on HPPA machines.
Initial 802.11 defragmentation code to handle reception of MSDU or MMPDU fragments.
Added missing mux locators to non-USB keyboards and mice on sparc64 GENERIC kernels.
Make ksh(1) built-in 'echo' behave according to POSIX when "set -o posix" is in effect.
Bumped the number of /dev/sd* device nodes on all USB-capable architectures.
New font selection logic on sti(4) frame buffer console.
Fix crash on zaurus when plugging in certain sd memory cards.
Fix HW WEP support on run(4), and a few other fixes.
Added Huawei E160G to the list of supported umsm(4) devices.
Fix kernel crash in uvideo(4) for devices with unsorted frame indexes.
If aucat(1) has too many connections, stop accepting new ones rather than exit()ing with a fatal error.
For some systems which claim ACPI 2.0 but still do not provide an XSDT address, fall back on the RSDT.
Make intel xenocara Mesa code choose the right vblank pipe to sync to, in case there is only one.
Make aucat(1) daemonize when in server mode.
Make aucat(1) in server mode create a /tmp/aucat-userid/ directory and create sockets in it to prevent eavesdropping.
In ospf6d(8), set the LA-bit for all prefixes of 128-bit length in the Intra-Area-Prefix LSAs.
Added Buffalo WLI-U2-SG54HG to the list of supported rum(4) devices.
Better rate calculations in apmd(8) for MP machines.
Enabled build in xenocara of kdrive/Xephyr for the gcc3 architectures.
Save VGA text mode color palette upon startup and restore it when switching consoles or when X11 exits.
gcc2 fixes for dhclient(8).
Move mvme88k vs(4) driver to bus_dma.
Unbreak non-INET6 case in the pf code.
Make smtpd(8) handle connection descriptor limits better.
Make ipsecctl(8) print out a warning if the ipsec.conf(5) file changes the default peer configuration later in the file.
Mark routers as uninstalled after deleting the default route. Makes it possible to get a new default route by router advertisements after the old one got deleted or timed out.
Make sure more of the IPv6 code runs under splnet() in certain places.
Fix "target kvm" in gdb(1) for powerpc.
Fix ksh(1) evaluation of '||' and '&&' in certain combinations.
Updated xdm to 1.1.8.
Switch member names in struct stat timespec to the names from POSIX 1003.1-2008 with compatibility macros for the previous names.
Make sure macppc laptops skip pmu commands if no adb device appears in the device tree.
Make ospf6d(8) originate Intra-Area-Prefix LSAs which reference a router LSA.
Updated xf86-input-elographics to 1.2.3.
Initial STARTTLS support in the MTA part of smtpd(8).
For i386, only start using the rtc for statclock after we have received the first interrupt.
Initial support for SSL in the MTA part of smtpd(8).
Always zero the IP checksum field for packets and packet fragments being passed down if using HW checksum offload.
Make aldap anonymous binds work properly in ypldap(8).
Added -mplslabel to route(8), to allow IPv4/v6 packets enter MPLS clouds.
Improved logging in isakmpd(8) for SA delete messages.
Log warning when ntpd(8) can not read the drift file.
Added support in mfi(4) for the next generation Megaraid SAS Raid controllers.
Added "show database intra" command to ospf6ctl(8).
Teach ospf6d(8) to originate Intra-Area-Prefix LSAs.
The MPLS code can now act as an edge node and allow IPv4 packets to enter a label switched path and not just forward MPLS packets.
Remove undocumented support for -e in ex(1).
Implemented proper multicast support in tsec(4) for the socppc platform.
Re-added "Category" to the sendbug(1) template.
Fixed libstdc++ issues where ports would include <math.h> and expect C99 macros in that file to be available.
Enable -d for the export command of OpenCVS.
Fix sti(4) font selection.
When printing the database with ospf6ctl(8), print the right header for Intra-Area-Prefix LSAs.
Make dhclient(8) use the rtsock filters to restrict which messages it will get on the route socket.
Updated xf86-video-radeonhd to 1.2.4.
Added loop detection support in smtpd(8).
Implemented basic routing socket filtering.
Prevent hme(4) devices from mapping the full 16M PROM.
Fix the way the flows are acquired for the "any" network in the ipsec code.
Make ftp(1) ignore pseudo-directories so recursive transfers do not cause a loop.
Make ospf6d(8) propagate the neighbours interface ID to the RDE.
Fix rare pager deadlock in the UVM code.
Make trunk(4) handle HW VLAN tags being passed down.
Fix some integer overflows when accounting the used mbuf memory percentage in netstat(1).
Improved error handling in ypldap(8).
Make cwm store group state in an X Atom.
Updated libdrm to 2.4.3.
Make sure bgpd(8) also does check for highest IP in host byte order.
Make sure ospfd(8) converts IP addresses to host-byte order before checking which one is smallest.
Updated Xtrans to 1.2.3.
Make netstat(1) mark multipath routes with P.
In route(8), mark multipath routes with P in the show command flags.
Make ssh(1) work around the CPNI-957037 Plaintext Recovery Attack by always reading 256k of data on packet size or HMAC errors.
Removed /dev/drum and associated code.
Added udfu(4), a driver to put dfu-capable devices in dfu-mode for later use with dfu-util.
Improved time granularity in the NFS code, helps with cache coherency.
Make NFS propagate O_EXCL flag down to the file systems by setting VA_EXCLUSIVE.
Added schsio(4), a driver for SMSC SCH311x LPC SuperI/O ICs. Enabled on amd64 and i386 GENERIC kernels.
Make aucat(1) catch SIGHUP and SIGTERM to ensure that recorded files are properly closed.
Made re(4) at pci(4) detachable.
Double the receive space in the nfs_socket code to reduce chance of retransmits.
Added Moxa CP-104JU to the list of supported puc(4) devices.
Make libkvm operations on live kernels use the sysctl interface.
Make sysctl(8) change of the value of kern.clockrate set errno on failure.
Fix for Sun USB keyboard when getting layout information for Swedish and British country codes.
Extended ifb(4) code handle XVR-600 and XVR-1200 acceleration.
Updated time zone data to tzdata2009a.
Added borderwidth as a cwmrc(5) keyword.
Added softraid(4) to macppc RAMDISK kernels.
For i386, install ACPI S3 resume trampoline code in a lowmem page. First part of ACPI S3 suspend/resume support.
Add support in isakmpd(8) and ipsecctl(8) to install SAs with a different source network than we have negotiated with a peer.
Make Sparc64 XVR-600 and XVR-1200 devices revert to software routines if acceleration code will not work.
Added support in umsm(4) for Novatel Wireless Ovation U727 devices.
Move HEAP_START on mvme88k bootblocks to allocate space below it for ethernet buffers.
Make sure the NFS attribute set operations perform the same checks as open/read/write.
Added NFS hooks to ddb(4) to print outstanding nfsreq's and the struct nfsreq.
Enable atphy(4) for age(4) on amd64 and i386 GENERIC kernels.
Added support for DS1822 devices in owtemp(4).
Enabled vrng(4) for sparc64 GENERIC kernels.
Make alpha ES40 machines recognize environmental change machine checks.
32-bit fixes for savecore(8).
Fix state leak in pf(4) triggered by certain icmp types matching a NAT rule.
Make it possible for sparc64 to boot from vdsk(4) devices.
Make azalia(4) support 20 and 24-bit sample formats.
Fix audio(4) so it can deal with sample precisions that are not a power of 2.
Make sure vdsk(4) transfers larger than PAGE_SIZE work on sparc64.
Improved the VIO state machine in the vnet(4) driver on sparc64.
Fix double free and other memory leaks in ypldap(8).
Add support for IT8720F devices in the it(4) drivers.
Initial version of age(4), a driver for the Attansic L1 gigabit ethernet adapter.
Fix memory leak in the SysV semaphore code.
Fix macppc installs over serial consoles.
Removed support for krb4 '.' instance separator in the libc authentication code.
Add "ESMTP" to the smtpd(8) banner now that it does support some extensions.
SECURITY FIX: DNSSEC signature validation error in named(8).
A source code patch is available.
[Applied to stable]
Re-enabled PIE support for powerpc platforms.
Enable vdsk(4) on sparc64 RAMDISK kernels.
Added uaudio(4) support to sgi GENERIC kernels.
Make ssh(1) support the SOCKS4A protocol.
Added option 150 to dhclient(8), voip-configuration-server as an array of IP addresses.
Added wcstoimax(3), wcstoumax(3), wcstof(3) and wcstold(3) to libc.
For amd64 and i386, turn mpbios(4) into a real device so people can disable it.
Make ypldap(8) check the ypldap.conf(5) permissions, since it may contain secrets.
Enabled wscons(4) RAWKBD support on sparc64 GENERIC kernels.
Make the vt100 wscons(4) code recognize CAN and SUB characters.
Updated xserver to 1.5.3 plus some patches.
Initial version of sparc64 virtual disk support for sun4v logical domains.
Remapped the sun type 5 audio mute key to prevent collisions with keypad-equal key on type 4 keyboards.
Make macppc disklabel(8) walk the Apple partition map to find out the bounds of the OpenBSD area.
Added RAWKBD support in wscons(4) for sun serial keyboards.
Revert earlier VFS commit to fix DVD playback.
Added loopback mode to aucat(1).
Enabled cbus(4) and vnet(4) on sparc64 GENERIC and RAMDISK kernels.
Updated xterm(1) to version 239.
Add support on apple laptops for the volume and CD eject buttons.
In dhclient(8), use the kernel to set ifam_hdrlen so ABI changes will not cause older clients to stop working.
Added multicast support to vnet(4).
Make sure to enable support for RFC2546 TLS extensions to allow for multihomed TLS servers.
SECURITY FIX: OpenSSL libraries did not correctly check the return value from certain verification functions.
A source code patch is available.
[Applied to stable]
Updated OpenSSL to 0.9.8j.
Add support for SDHC cards in the sdmmc(4).
Fix egress group matching for IPv6 in the interface code.
Make sure sudo(8) does not try to set the close-on-exec flag on sudoers if we didn't actually open it.
Added full stub area support in ospfd(8).
Added urlphy(4) support on amd64 and i386 RAMDISK kernels.
Added Linksys WUS600N to the list of supported run(4) devices.
Enabled ipgphy(4) on all arches where stge(4) is supported.
Added GeForce 9300 GE to the list of supported NVidia chipsets.
Send broadcast and multicast traffic up to the network stack on all bridge interfaces.
Updated xterm(1) to version 238.
Make authpf(8) support group and login class in authpf.allow.
Updated OpenSSL to 0.9.8i.
Add 2 missing chunks from the 2.1.12 update of xf86-video-nv, adds support for a bunch of new chipsets.
Fix various off-by-one errors in the MSDOS file system code by leaving the fsinxtfree field untouched.
Make the runner process of smtpd(8) able to pause/resume scheduling of deliveries for both mda and mta, also smtpctl(8) can be used to enable/disable deliveries.
Initial version of vnet(4), a virtual network device for sun4v logical domains on sparc64.
Added support for CS5535 IDE controllers to pciide(4).
Make smtpd(8) do aliases/forwards expansion better, removing a race condition.
Fixed memory leak in ypldap(8).
Make it possible to boot sparc64 from devices on cbus(4).
Enabled run(4) on amd64 and i386 GENERIC kernels.
Initial version of run(4), a driver for Ralink RT2700U/2800U/3000U USB 802.11n devices.
Updated the microcode for RT2870/3070-based rum(4) devices.
Add support in ospf6d(8) for originating router LSAs over point-to-point links.
Accelerate solid fills and inverted cursor on ifb(4) for sparc64.
Make savecore(8) handle core files larger than 2G.
Added support in the openmoko platform for the display found on GTA01.
Fix ssh(1) KEXGEX hash calculations.
Fix hangs in ssh(1) when connecting to a server that has MaxSessions=0.
Changed the ISO week number calculations in cal(1).
Initial version of ifb(4), a driver for sparc64 wildcat-based framebuffers.
Updated mkfontscale to 1.0.6 and xedit to 1.1.2.
Added cbus(4) to sparc64, a virtual bus for devices that use logical domain channels as found on sun4v.
Make man(1) -S option case insensitive.
Initialize the sample rate converter on ES1371-based ac97(4) chips to 48KHz.
Added extra paranoia for malloc(3) by protecting the main bookkeeping data.
Handle cases in fsck_ffs(8) where remsize can go negative and cause SEGVs.
Fix compiling i386 kernels without apm(4).
Updated root.hint, added IPv6 address for the L-root server.
Plug some memory leakage in the ypldap(8) parser.
Make cdio(1) work with aucat(1) regardless of the buffer size used.
RELIABILITY FIX: Reception of an invalid update with 4-byte AS attributes allows a third party to close remote BGP sessions.
A source code patch is available.
[Applied to stable]
Added ifb(4) to sparc64 GENERIC kernels.
Use hardware acceleration for scrolling in ifb(4) on sparc64, avoids overlay artifacts.
Fix libc file descriptor leak in fts_children().
Added accelerated putchar routines for sparc tcx(4) consoles.
Fix race condition in ls(1).
Added support in softraid(4) for non-disk devices.
Plugged a couple of memory leaks in netstat(1).
Make tty EVFILT_WRITE filters return the amount of space remaining in the write buffer.
Added -S and -s options to apropos(1).
Fix two mbuf leaks in the arpresolve code.
Added basic acceleration code for sparc tcx(4) graphics.
Fixed double brightness increments on some newer Thinkpads.
Removed deprecated xf86-video-i810 and xf86-video-nsc.
Reenabled xf86-video-i740 and xf86-video-voodoo.
Make bge(4) schedule a timeout if it can't put enough packets on the RX ring.
Add firmware load for iSight first generation devices to uvideo(4).
Use the RXO (RX Overflow) interrupt in em(4) to try to refill the RX ring.
On amd64 and i386, let ctrl-alt-del enter ddb(4) if ddb.console=1 and machdep.kbdreset=2.
Make the "machine xir" ddb(4) command work on pyro(4)-equipped machines.
Imported first bits of SMTP AUTH support in smtpd(8).
Sync some bits in sudo(8) with 1.7.0.
Make aucat(1) use simple linear interpolation in the resampling code.
Various fixes for smtpd(8).
Make systat(1) print interface livelocks if non-zero.
Make acpi(4) code a bit smarter when picking IRQs from the list of possible IRQs.
Added support in ripd(8) for demotion counters.
Rewrote the systat(1) mbuf page to display mbuf usage information from system pools.
Make it possible to edit a merged file in sysmerge(8) with an external editor.
Implemented a "machine xir" command for ddb(4) for sparc64.
Fix sparc64 IPI-related panics when returning from send_softint().
Made ospfd(8) and bgpd(8) routing priority aware.
Added support in ifconfig(8) to set an interface priority.
Introduced an if_priority that will be added to static routes without an explicit priority. Allows to specify less preferred interfaces that take over if the primary interface loses link.
Fix HW crypto on ral(4) devices.
Bumped the isakmpd(8) RSA host key size to 2048 bits.
Prevent cdio(1) from faulting when /dev/audio is busy.
Added Qualcomm AC8700 modem to the list of supported ubsa(4) devices.
Convert bgpctl(8) aggregator AS number into host byte order when diplayed in "show rib detail".
When booting from a CD on amd64 and i386, assume the root filesystem is on the CD instead of asking for it every time.
libstdc++ bump to handle integer argument for the math functions.
Added 80-bit and quad precision trigonometric functions to libm.
Libc work on long doubles and 3BSD-versions of finite().
Added non-blocking support for xdrrecs in the xdr(3) code.
Disable ~C escape handling on multiplexed ssh(1) sessions.
Rewrote renice(8) to be POSIX compliant.
Added ability in uvideo(4) to load firmware for devices which require it.
Change handling of redirections in relayd(8) with the sticky-address option set.
When resampling in aucat(1), do not require the sample frequency to be an integer.
Make acpiprt(4) handle interrupt routing better and delay re-routing until a handler for it is established.
Added option to systat(1) to order the pool view by size and number of pages.
Added ability in smtpd(8) to specify an interface instead of an address to listen on.
Changed the way relayd(8) reports errors.
New smtpctl(8) app to control smtpd.
Added ethertype 0x88a8 to tcpdump(8) for stacked VLAN packets.
For vic(4), enable 9k frames again, new mbuf allocator in place that works.
Added support in em(4) for ICH9 IGP M and IGP M AMT chipsets.
Initial import of the vscsi(4) device, somewhat like a tun(4) devices which sends scsi commands up to userland for handling.
Initial versions of newaliases/makemap application to be used with smtpd(8).
Allow iwn(4) and wpi(4) users to select a fixed rate.
Fix USB packet size handling in uvideo(4).
Make ssh(1) follow RFC 4254 instead of triggering 'Non-public channel' error messages on some sshd systems.
Preliminary support in iwn(4) for Intel WiFi Link 5150.
Initial support for neighbor expiry in dvmrpd(8).
Added Huawei E510 to the list of supported umsm(4) devices.
Updated xf86-video-intel to 2.4.3.
Initial version of the bt.conf(5) file.
In jme(4), configure clock source for TX mac/offload engines. Required for JMC261-based devices.
Remove ukbd support for keyboard/mouse over bluetooth on landisk GENERIC kernels.
Make uvideo(4) set up three isoc transfers at a time to not miss frames.
Added initial support in re(4) for 8168D/8111D-based devices.
Added sndio support to cdio(1).
Fix for 64-bit high-speed isoc USB transfers in ehci(4).
Initial gpiodcf(4) driver that attaches to a GPIO pin, decodes the signal from an attached DCF77, HG or TDF receiver and provides a timedelta.
Make growfs(8) refuse to work on dirty filesystems, and set the filesystem to dirty when done, to force fsck afterwards.
Initial driver for the Netgear WG1111v2 RTL8187-based devices in urtw(4).
Enabled bluetooth on alpha, amd64, armish, hppa, i386, landisk, macppc, sparc64 and zaurus GENERIC kernels.
Better avoid network livelock by adding a timeout that will reduce high water marks on network interfaces if we never get below softclock.
Fix pf(4) state linking for v6-over-v4 gif(4) tunnels.
Only allow to set gpio(4) pin configuration on securelevel 0. Also allows to give the pin names.
Initial port of the xscale based gumstix platform and the ARM based OpenMoko.
Implemented btd(8) config reloading.
Move em(4) RX ring allocation to have 4 mbufs and then allocate more on demand.
Switch buffer usage in wd(4) to a simple m_devget() call to copy a packet from the RX DMA ring.
Imported btd(8) and btctl(8), Bluetooth daemon and control utility.
Fix panic at attach in uvideo(4) by sanitizing wrong bDefaultFrameIndex values.
Imported btsco(4) into the Bluetooth stack.
Introduced route hold down in dvmrpd(8).
Move vic(4) from the 4k to the 9k jumbo allocator.
Enable the 8, 9, 12, 16 and 64k backend allocators for mbuf clusters.
Initial support in ospfd(8) for stub areas.
Make the kernel allow allocations larger than PAGE_SIZE from pools.
Queue tc randomness when available, to improve the early arc4random() calls.
Allow entropy to be queued before randomattach() is called.
Fix old make(1) bug.
Move vic(4) jumbo frame allocator to use the second RX ring and populate it with 4k frames.
Move the cardbus code use workq.
Add -A and -D to gpioctl(8) to attach and detach gpio devices at runtime.
Move vic(4) to the new cluster allocator so it can start out with 4 mbufs on the ring and allocate more on demand.
Add several backend pools to allocate kernel mbuf clusters of various sizes out of.
Implemented link-state tracking on the routing table.
Make the random pool seed with the dmesg buffer at randomattach() so early arc4random() calls return something unique on different machines.
Prevent infinite loop in bc(1).
Reworked sdmmc(4) locking to remove recursion.
Make sure we handle ext2fs with big inodes.
Added softraid(4) support for aoe(4).
Move inteldrm vblank data allocations to attach, not at irq enable.
Removed the final bits of pccom(4).
Enable bio(4) on mpi(4).
Fix IPv6 related crashes by checking cached v6 routes to make sure they are still valid.
In the installer scripts, create new bpf(4) device files whenever a dhclient is started to allow for multiple interfaces being configured with DHCP during install and upgrades.
Move the DRM drivers from attaching to the VGA bus to a similar scheme as the audio(4) interfaces, making it essentially bus independent.
Make bge(4) perform bus_dmamap_syncs on the RX mbufs.
Allow wired memory on i386 to be accounted. Users are now allowed to call mlock, while the limit is imposed by the current MLIMIT_MEMLOCK.
Move i386, amd64 and sparc64 to cpu_unidle, to replace what signotify used to do.
Enabled a use-after-free protection for kernel memory pools.
Fix in ahci(4) for some NVidia MCP77 AHCI controllers.
Re-enabled ACPI PDC support for amd64 machines.
Make config(8) enable selected by attribute work.
Synced the bluetooth code with NetBSD.
Relax FAT sanity checks so any two-byte jmp followed by a NOP or a three-byte jmp will be acceptable as preamble to a FAT boot sector.
Moved Option Globetrotter GT Fusion from ubsa(4) to umsm(4).
Reverted -fpie for powerpc.
Make bgpd(8) track nexthops when the underlying route is changing.
Backout the new powerpc interrupt subsystem, some bug still left to find.
Make ssh(1) disconnect on padding errors too.
In dvmrpd(8), introduce support for flash updates.
Make both aucat(1) and audio(4) backends use the AUDIODEVICE environment variable to determine the sockets or device to use.
Move allocations between half a page and a page as close to the end of the page as possible.
Reduce the leeway malloc(3) allows when moving allocations to the end of a page to 0.
Do not reset the TX threshold value in xl(4) when xl_init() is called, also make sure the TX queue is empty before clearing the watchdog timer.
Make azalia(4) jack sensors available as read-only mixer items.
Add HP P711m and P721m to the list of supported ciss(4) devices.
Use the generic azalia(4) mixer configuration for Realtek ALC codecs. Adds output.master to ALC885 and ALC888.
Allow aucat(1) to listen on multiple sockets.
In aucat(1), make clients inherit the volume parameter when the -v option is used in server mode.
Make sure wpi(4) and iwn(4) clear pending interrupts in the driver attach routine.
Make ipsecctl(8) differ between IPV4_ADDR and IPV4_ADDR_SUBNET depending on if you add a "/32" on the address or not to help interop with other IKE implementations.
Upgraded sudo(8) to 1.7.
Add support for ST's chips in the sdtemp(4) driver.
Help the 802.11 code to mitigate the MIC failure notification attack to guess the CRC.
Added support in gcc(1) for Position Independent Executables, PIE. Adds -fpie and -fPIE flags.
Enabled support in gdb(1) for debugging PIE programs.
Make aucat(1) expose the volume knob in server mode too.
Use RFC2409-compliant notification messages in isakmpd(8) when client identities are not valid during phase 2.
Make aucat(1) in non-server mode terminate when it is idle.
Make sure any kernel operations done with a process's directories are atomic and not after sleeping.
In aucat(1), add a per-stream "soft volume".
Fixes for monop(6) rules when buying hotels.
Added eMPIA Technology 2761 to the list of supported uvideo(4) devices.
Added BULK xfer support to uvideo(4).
Make aucat(1) stop the audio device if it is idle when in server mode.
Prevent apps that poll a stopped sndio device from using 100% CPU.
New agp(4) attach code, similar to how audio(4) attaches.
New bpf(4) code to create VLAN encapsulation from the tag stored in the mbuf header.
Make the kernel fork code allocate required space for systrace early so we are sure the activation code wont sleep in sensitive places.
Major overhaul of wpi(4) to bring in HW CCMP encryption/decryption among other things. Requires new wpi-firmware.
RELIABILITY FIX: Problems with DH0_DHCP_OPTIONS_OVERLOAD in dhcpd(8).
A source code patch is available.
[Applied to stable]
Add malloc and bucket views to systat(1).
Added new sysctl(8) ddb.trigger to take the OS into the ddb(4) debugger if ddb.console=1 and the write comes from the actual console tty.
Fixes for trunk(4) LACP code to help it work with Catalyst 3500s.
Better initialization for BCM5906 based bge(4) devices.
Set default coalescence factor to 64 for both RX and TX on jme(4) devices.
Make libsndio expose the block size in the sndio API.
Fix for gem(4) TX FIFO threshold underruns.
Set default acceleration for i830 graphic chips to EXA.
Set the IFCAP_VLAN_MTU for aue(4), axe(4), mos(4) and url(4) so they are allowed to transmit full sized VLAN tagged frames.
Added support for iso8859-13 in lynx(1).
Various aucat(1) CPU usage reductions.
Added support for the J-PAKE password protocol to ssh(1), not enabled by default.
Various make(1) improvements.
Reduce aucat(1) CPU usage when only channel conversion are required.
Updated xf86-video-nv to 2.1.12 and xf86-video-openchrome to 0.2.903.
For iwn(4) devices, add HW CCMP encryption/decryption support of unicast frames.
Added ~x support to mail(1).
Updated xf86-video-sunffb to 1.2.0.
Added support for w83627dhg devices in the i2c driver.
Updated xserver to 1.5.2 in the xenocara tree.
Updated Mesa to 7.2 in the xenocara tree.
Added a view in systat(1) that shows pool(9) information.
Disabled portalfs in the GENERIC kernels.
Initial version of smtpd(8), an smtp server implementation.
Updated xf86-video-radeonhd to 1.2.3.
For systat(1), improve reporting of cache misses in the vmstat view.
In azalia(4), add support for converter groups where members have non-identical sample size and rate capabilities.
Fix building of trunk(4) for non-INET6 kernels.
Use msleep() in the reaper code, to prevent it from losing events.
Make arp resolving less prone to loose packets by queueing small burst of packets.
Added support in emu(4) for Audigy 2 Value based devices.
Add bio(4) support to cac(4).
In pf(4), skip 'urpf-failed' test for IPv6 link local addresses.
Avoid infinite recursion in the gcc(1) stack protection code.
Added support for multiple pflow(4) interfaces.
Do DNS resolution in a separate process for ypldap(8).
Various updates to the bio(4) support in ami(4).
Added beginnings of bio(4) support for mpi(4).
Feed IPv6 flow label in trunk(4) hash calculation.
for trunk(4), show the ACTIVE flag in ifconfig(8) for the single interface that is active in failover mode.
Re-added TX Vlan tag insertion on nge(4), and RX Vlan tag stripping for nfe(4).
Fix for 4-channel output on auich(4) for SiS 7012-based devices.
Try harder to use ACPI on i386 machines.
Updated Time Zone data to tzdata2008i.
In azalia(4) for AD1984 based devices, connect headphones to the proper DAC.
Plug mbuf leak in the NFS RPC record error case.
Added minimal audio server capability to aucat(1).
Make pkg_create(1) default to sha256.
Added auacer(4) to amd64 and i386 GENERIC kernels.
Fix for "uvm_km thread out of memory" situation.
Added S/PDIF output support for ac97(4), auich(4) and auvia(4).
Enabled 4 and 6 channel support in auich(4).
Added mos(4) to amd64, i386, macppc and sparc64 GENERIC and RAMDISK kernels.
Initial version of a mos(4) driver for MOSCHIP MCS7x30 USB Ethernet chips.
For older IT8712 based it(4) chips, round up to nearest minute 16-bit timeout.
Make azalia(4) power down the codec if it has no audio functions groups.
Make pflogd(8) log pcap stats upon SIGUSR1.
Added FAN4 and FAN5 support to IT87(16,18,26) based it(4) devices.
Add TX vlan tag insertion and RX vlan tag stripping to stge(4) and vge(4).
Added bpf/tcpdump support to pflow(4).
RX vlan stripping for xge(4).
Re-added TX vlan insertion and RX vlan stripping for ixgb(4) interfaces.
For jme(4), enable support for RX checksum offload, RX vlan stripping and TX vlan insertion.
RX vlan stripping for ti(4) and bnx(4).
Re-added RX vlan tag stripping to bge(4), and em(4), and TX vlan insertion for em(4).
In mpe(4), prevent users from assigning reserved labels to interfaces.
Make ftp(1) handle resume when local file does not exist.
Added S/PDIF support in azalia(4).
Make bridge(4) handle interfaces with and without hardware vlan tag support and forward packets inbetween.
Make -a default for usbhidctl(1).
Make the vlan(4) code drop promiscuously received packets if the vlan interface is not in promiscuous mode itself.
Added support in tcpdump(8) for IEEE LACP and MARKER protocols as per 802.3ad.
Make PPPoE sessions IDs unique per receiving interface so interfaces can reuse it on different networks.
Added ichiic(4) driver for ICH10.
Make -a default for radioctl(1).
In the azalia(4) driver, remove unconnected pins from connection and mixer lists.
Make random(9) return per-cpu values.
Enabled inteldrm and radeondrm on both amd64 and i386 GENERIC kernels.
Make the kernel random device yield between copying out large chunks of random data to userspace.
Enabled ypldap(8) in normal builds.
Added support for referrals and lists of attributes to ypldap(8).
Make MPLS handle IPv4 and IPv6 explicit null labels.
Try to get MAC address from jme(4) devices even though the imported driver was trying to randomize one for us.
Added a method in libpciaccess to read the legacy BIOS region on alpha/amd64/i386.
Updated xedit to 1.1.1 and xf86-input-mutouch to 1.2.1.
Rewrite of iwn(4), added support for Intel WiFi Link 5000 series adapters. Requires an iwn-firmware upgrade, even for 4965AGN devices.
Disabled IPv6 PCB linking for UDP packets.
Updated Time Zone data to tzdata2008g.
Updated xf86-video-tseng to 1.2.0, xf86-video-tdfx to 1.4.0, xf86-video-voodoo to 1.2.0 and xf86-video-vmware to 10.16.5.
Updated xf86-video-s3 to 0.6.0, xf86-video-s3virge to 1.10.1, xf86-video-savage to 2.2.1 and xf86-video-trident to 1.3.0.
Updated xf86-video-i128 to 1.3.1, xf86-video-i740 to 1.2.0 and xf86-video-rendition to 4.2.0.
Updated xf86-video-vesa to 2.0.0, xf86-video-intel to 2.4.2 and xf86-video-glint to 1.2.1.
Adjusted the socppc platform to the redesigned powerpc interrupt architecture.
Make vcons(4) on sparc64 interrupt driven.
For re(4) devices, use hardware timer to simulate interrupt moderation.
Fix kernel internal pool allocator to check for PR_WAITOK instead of M_NOWAIT.
Removed /dev/prandom.
Improve -X output in tcpdump(8) for PPP packets.
Added rum(4) to the mips64 GENERIC kernel.
Added missing spl(9) in the azalia(4) driver for codec command setting/retrieval.
Teach rcs(1) about $OpenBSD$ expansions.
When adding a new user with user(8), do not move YP lines to the end of the file.
For amd64 and i386, skip memory areas smaller than 1 MB above the 16 MB boundary to deal with buggy ACPI BIOSes.
Prevent crash in socket timeout code by handling HZ calculations with unsigned numbers to prevent negative results.
Plug memory leak in snmpd(8) after sending a trap.
Support setting PermitEmptyPasswords in a Match block in sshd_config(5).
Added an -y option to ssh(1) to force logging via syslog rather than stderr.
Make pppd(8) report both IP addresses if the setup fails due to either the local or the destination address already exists.
Make vmstat(8) handle interrupt rate calculations over 2 billions.
Make sed(1) handle arbitrarily long lines. Also plug a memory leak.
For "gunzip -N", store the extracted file if the header has no directory as if the -N was not specified.
Make systat(1) in pftop mode print child queues right under their respective interface root queues.
Make mtree(8) return the correct exit codes for extra files.
Enabled GL for libraries but not the X server on SGI mips64 machines.
Added uhci(4) at cardbus(4) on amd64 and i386 GENERIC kernels.
Fix alpha ieeefp emulation code when converting doubles to unsigned long ints.
Prevent sed(1) 'l' command from encoding newlines.
Make sure page 0 is selected when initializing the eephy(4).
Fix memory leak in the acpi(4) dsdt scope evaluation code.
Better signal protection against races in authpf(8).
If lii(4) driver fails to read the MAC address from the eeprom, fallback to reading the MAC address registers.
If mpi(4) fails to fetch a config page for a SAS target, let the scsi midlayer try to probe it again.
Make pcidump(8) dump PCI devices from all the domains available in the system.
Make fstat(1), pstat(8) and some sysctl(8) entries hide file offsets and other information unless the user is the owner or superuser.
Do not exit in httpd(8) if the logfile specified on the command line can not be created due to a path component not existing.
Updated awk(1) to version 20071023.
In ehci(4), don't force multi transaction endpoints down to single transactions.
Add missing checks for sc_focus in the wscons(4) driver.
Updated Time Zone data to tzdata2008g and code to tzcode2008g.
Make sendbug(1) parse all arguments before it starts working.
Fix for em(4) link state getting stuck in LINK_STATE_UNKNOWN.
Added a pciutils like pci.ids file in xenocara for libpciaccess.
When closing the video stream in uvideo(4), switch back to the default interface as a last action.
Make libc malloc(3) avoid splitting up regions when purging stuff from the cache and also, when increasing the size of an allocation, try mapping the region next to the existing one first.
For amd64 DDB, make extra CPUs 'hlt' instead of spin in a tight loop.
Added new -D option to spamd-setup(8) to daemonize on early startup.
In quiz(6), fix long group handling.
64-bit fix for adventure(6) save files.
Make sigwait(3) work correctly for some cases where the signal could be diverted but sigwait(3) would still block.
Repair ppp(8) "set reconnect random 0".
Cleanup of ethernet ioctl(2) handling, also makes drivers return the correct errno of ENOTTY instead of EINVAL/ENXIO when encountering unknown ioctl's.
Fix ld.so(1) mmap(2) error checking to be correct 64-bit addresses.
Fix auvia(4) ring descriptor problem by not using the 256th descriptor.
Fix for huntd(6) and add -b option to allow it to run in the background.
Added the IBM 4810 SCC to the list of supported puc(4) devices.
Fix in pf(4) when using sticky-address and a matching pass rule uses reply-to.
Make closed, disconnected or otherwise failed sockets still return stat information.
Implemented pf.conf(5) "set state-defaults X" to list state options to apply to all rules which do not have explicit "keep state" rules.
Added POSIX character class support for fnmatch(3) and glob(3).
Make sure received IPv6 neighbor solicitations which isn't from the unspecified address match one of the interfaces address prefixes.
Make lockspool(1) use the real uid instead of getlogin().
Fix in the libc DB code for sequential retrieval failures when using large key/data pairs.
Make acpiasus(4) handle the two ACPI events sent from the display cycle key.
Better stability for hppa machines by more aggressive cache flushing.
Provide a scsi probe hook in mpi(4) that checks if an atapi device is plugged into SAS mpi(4) variants.
Make the macppc properly count memory where OpenFirmware reports zero-sized entries in between filled memory banks.
Make w(1) properly display files with embedded colons being transferred via ftp.
Make ftpd(8) always say "User %s access denied" in all cases to avoid problems when parsing the results. Also do not close the connection on 530 results.
Fix "-m mode" in conjunction with the -p flag for mkdir(1).
Fix occasional mfs-related panic on reboot.
Fix in lynx(1) gopher code.
Added Xinerama and XRandR dual head support in cwm(1).
Added jme(4) to sparc64 GENERIC and RAMDISK kernels.
Added I-O DATA PCET/TX-R to the list of supported ne(4) devices.
When running syslogd(8) in debug mode, prevent closing of random file descriptor.
Updated perl(1) to 5.10.0.
Fix logic in bgpd(8) where IPv6 prefixes would match on a simple "deny from any prefix 0.0.0.0/0".
Enabled jme(4) JMicron Ethernet on amd64 and i386 GENERIC and RAMDISK kernels.
Use pools to do memory allocations for all sizes that are less or equal to the page size.
Allow relayd(8) to listen on a port range for redirections.
Make it possible for ospfd(8) to learn new interfaces during runtime.
Make sure we clear the PF state key when a IP (v4 or v6) exits a gif(4) tunnel.
Updated isp(4) 12160 firmware from 10.04.32 to 10.04.41.
Initial implementation of 802.11x PMKSA caching and pre-authentication.
Add support in agp(4) to attach Intel Q35 integrated video.
Added support in snmpd(8) to add an additional restricted control socket.
Added support in ftp(1) for proxies with password.
Added a jme(4) driver for the JMicron JMC250/260 Ethernet controllers.
Added a driver for the Attansic F1 PHY.
Fix vr(4) panic seen under high load.
Updated xterm(1) to version 237 and pixman to 0.12.0.
Stop uvm(9) from merging userland map entries.
Added support in uath(4) for Philips SNU6500.
Make cwm(1) display the current window title, not a previous one in the case of "show all" in the window search dialogue.
Make X on sparc64 stop messing with the PCI BARs. Makes the ATI driver work again on Ultra5/10.
Perform mvme197 latency timer reprogramming on the boot blocks, in addition to the kernel.
Fix problems and races with POSIX file locking.
Increase the maximum length of the #! interpreter path from 64 to 128.
Initial infrastructure to support hardware VLAN tag stripping.
Reworked drm locking in xenocara.
Fix ftp(1) for gcc2 architectures.
Added a flag to procmap(1) to print amap usage.
Redesigned powerpc interrupt architecture.
Fix crash in pflow(4) on a not correctly configured pflow interface.
Added a key in sysmerge(8) to see a diff between the merged file and the new or old file.
Make rcs(1) and OpenCVS use getlogin(2) when committing as root (or via su(1)/sudo(8)).
Fix probing on SGI machines for com@ioc.
Updated xf86-video-cirrus to 1.2.1.
Added support in gdb(1) for reading auxiliary vectors.
Make it possible to get the ELF auxiliary vector through ptrace(2).
Added netstat(8) statistics for pflow(4).
Added support in DDB for SMP powerpc machines.
Enabled dirty buffer detection in mg(1).
Updated timezone data files to tzdata2008f.
Removed deprecated applications from xenocara, including lbxproxy, xphelloworld, xplsprinters and xprehashprinterlist.
Added xcompmgr(1) to xenocara.
Make ftpd(8) not split large commands into multiple commands on a 512-byte boundary. Prevents some attacks.
Allow a user defined MERGE_CMD to be used in sysmerge(8).
Plugged two memory leaks in OpenCVS while using -r argument with various CVS commands.
Make OpenCVS be very conservative about state changes with "admin -s".
Make sure the IPv6 icmp mbuf recycle code clears the recorded pf(4) state information.
In acpitz(4), try to send fan commands to "power resources" objects, makes some HP laptops run cooler and quieter.
For ntpd(8), move DNS lookups to its own process so it will not block ntp.
Make the uvm(9) waste less memory for amaps.
Fix for dc(4) watchdog timer, and make sure we don't clear IFF_OACTIVE unless there are at least 6 free TX descriptors available.
Make the NFS kq code issue a NOTE_TRUNCATE if the file size has shrunk.
Fix acpitz(4) Thermal Zone entities parsing when they are named object references instead of direct object references.
Make some dc(4) devices with broken DC_ISR_RX_STATE poll for RX packets, fixes trunk(4) usage on affected interfaces.
Added support for the ARM9e core to the ARM platform.
Added support for 16-pin PCA9555 devices in pcagpio(4).
Fix memory free error in bgpd(8) when carp_demote_get encounters an error.
64-bit fixes for acpidump(1).
When waking a specific process sleeping on a unique address, don't traverse the full wakeup queue.
Reenabled PF state key linking.
Added 40-bit GART support for PCIE devices in the ATI drm code.
Fix possible incorrect option handling in dhcpd(8).
Added SparkLAN WCFM-100 to the list of supported malo(4) devices.
Fix printing by group name in ifconfig(8).
Added pflow(4), a NetFlow v5 compatible flow export interface.
Make eephy(4) recognize Marvell 88E1116R Gig PHY.
Added ftp(1) option so it can get only newer files (-n) and specify maxdepth (-d) of recurrence.
Enable support in printf(1) for %a, %A and %F.
Make vmstat(1) show InUse rather than Releases for pools.
Fixed link state issue in bge(4).
Update code for relative priorities of 802.3 Selector Field value so 100Base-T4 does not have higher priority than 100Base-TX Full duplex.
Major libm overhaul.
Updated inputproto to 1.4.4 and xinput to 1.3.0.
Allow some ifconfig(8) set-style commands to have zero arguments.
Updated OpenSSL to 0.9.8h.
Make pkg-config(1) exit with a 0 return code when started with --help.
Make bgpd(8) ignore unknown SAFIs in the MP capabilities.
Make ls(1) -ln and -nl combination behave identically, same for -gn and -ng. Also allow -m and -x to override -1Cgln if specified last.
For mount_vnd(8), replace -s (sector size) option with more general -t (disktype) option which makes the vnd device emulate the geometry of the specified disktab(5) entry.
Make restore(8) start with a max tape buffer rather than 1/2 of the max, allows for automatic recognition of dumps written with 64k buffers.
Prevent possible overflow in carp(4) when the sum of all demotion counters gets bigger than 255.
Make cwm(1) keep exec menu entries sorted.
Make sure sysmerge(8) leaves no leftovers from sendmail in src when it stops unexpectedly.
Make lpd(8) more careful in checking disk space.
Make systat(1) pftop mode display direction In/Out/Any for rule display, not just In/Out.
Add interrupt mitigation for Intel i9xx user_irq, should save a bit of power.
Make sure inet_pton(3) does not overflow for large prefixes.
Switched ath(4) to softcrypto to enable support for WPA/WPA2.
Make sure the re(4) driver takes the PHY out of power down mode before probing for PHY.
Fix vi(1) cscope support in the case that someone provided a filename without a directory.
Added support for AMD Family 11h (Turion X2 Ultra et al) in km(4).
Fix re(4) multicast/promiscuous handling.
Added WPA support to iwi(4).
Make sure the bwi(4) driver does not try to attach rev 2 BCM431[1-2] chipsets, as they require v4 firmware and bwi(4) currently uses v3.
Added WPA support for ipw(4).
Fix for xf86-input-elographics, would get stuck in an infinite loop.
Initial driver auacer(4) added to sparc64 GENERIC, for Acer Laber M5455 integrated sound found on recent Ultra workstations.
Enabled uvideo(4) on sgi GENERIC kernels.
Updated xf86-input-keyboard to 1.3.1.
Updated xwd to 1.0.2, xwininfo to 1.0.4 and libXau to 1.0.4.
Fix length check in PPPoE when parsing discovery phase packets.
Added C-c target to mg(1) so you can bind ctrl-c ctrl-c in your ~/.mg file.
Fixed 128-bit divisions in gcc(1) for amd64.
Fix an uvideo(4) panic on sparc64 by aligning data in a struct better.
Fixed a couple of problems in the gem(4) driver that make the devices to get stuck.
Updated libdrm to 2.3.1.
Plug potential memory leak in the uvm_amap code.
Updated xterm(1) to update 236.
SGI machines now get an installXX.iso image to install from.
Added support for usb(4) devices on sgi.
Make NFS correctly invalidate attribute cache entries in case the vnode mode changes.
Added support in uvideo(4) for processing unit controls.
Stop making sd(4) report CHS information, since it mostly is lies.
Updated xf86-video-chips to 1.2.0 and xf86-input-mouse to 1.3.0.
Added support for Gunze touchpanels, found on Panasonic Toughbook CF-27.
Updated xf86-video-ark to 0.7.0 and xf86-video-ast to 0.85.0.
Make xf86-video-sunffb build on sparc64 machines.
Updated the xenocara input code for: magellan, microtouch, mutouch, palmax, penmount, summa, tek4957, ur98 and vmmouse.
Updated the xenocara input code for: acecad, calcomp, citron, digitaledge, dmc, dynapro, elo2300, elographics, fpit, hyperpen, jamstudio and xf86-input-joystick.
Make mbstowcs() return the correct length of the wchar_t string in some cases.
Fixed the libc wcschr() function.
For Vax machines, let lkms(4) support VSXXX-AB tablets in addition to the mice already supported.
Smarter implementation of calloc(3), based on mmap(2) returning zero filled pages.
Merge crunchgen(1) and crunchide(1) into one, and move to usr.sbin.
Make sure OpenBSD sets _POSIX_JOB_CONTROL and _POSIX_SAVED_IDS to the correct values.
Set the PIE address range on hppa, mips and sh to minimize mmap pressure.
Make ftp(1) commands which toggle settings take an explicit on or off argument.
In the libc getgrouplist code, after spotting a + record, continue scanning and pick up later groups in the file.
Added sbus support code to xenocara to be able to support the sunffb driver.
Updated the xf86-video-siliconmotion driver to 1.6.0.
Updated freetype in xenocara to 2.3.7.
Make ssh(1) allow ForceCommand internal-sftp with arguments.
Initial minimal graphics driver for VAXstation 3[58}x0 LEGSS option. Limited to 8 bit and no acceleration.
Enabled support for socket maps in sendmail(8).
Make gzip(1) use and report errors the inflate(3) can return.
Allow devices attaching at boot to be disabled in UKC.
Made it possible to enter DDB on macppc from a serial console.
Added DLink DWA-110 to the list of supported rum(4) devices.
Added support for the "Firefox" VAXstation 3[58][24]0 workstation machines.
Added stge(4) and gentbi(4) to hppa GENERIC and RAMDISK kernels.
Updated pcc from the master repo. Can now compile both userland and kernel (with some patches).
Let m4(1) be more liberal in include handling and stop skipping spaces outside of parentheses.
Added an option to force TCP lookups in resolv.conf(5) and extend nameserver declaration syntax to support port numbers.
Fix acpi(4) dsdt parsing causing panics on the Asus eeePC 1000H when attaching the acpiasus(4) driver.
Make mount_vnd(8) accept a sector size to be specified by the user when configuring a vnd(4) device.
Added a VIDIOC_ENUM_FRAMESIZES ioctl to uvideo(4) so applications can query the available formats and resolutions of a device.
Initial import of a driver for the integrated random number generator of the UltraSPARC T2.
For amd64 and i386 on some newer Turion CPUs with the C1E 'feature', running a hlt instruction with both cores kills the timer. Disable that 'feature'.
Added the 8139D PCI id to the rl(4) device list.
Fix out-of-bounds memory access in Mesa.
Fix multiple addition errors for amd64 and i386 when extended partitions are just before an OpenBSD partition in an MBR.
Added BIP, Broadcast/Multicast Integrity Protocol defined in P802.11w to provide integrity and replay protection for broadcast/multicast management frames.
Make the 802.11 code maintain a count of TKIP and CCMP replayed frames.
Initial implementation of the HMAC-MD5, HMAC-SHA1, HMAC-SHA256, AES-128-CMAC and AES Key Wrap algorithms.
Basic ELF header bounds check in config(8) to avoid crashes on truncated kernels.
Add support for RX/TX checksum offload on newer re(4) chipsets.
Plug a memory leak in ksh(1) when freeing I/O redirection in commands.
Added hw.cpuspeed for all sparc64 CPU types.
Added hw.setperf support for UltraSPARC-IIe-based sparc64 machines.
Prevent buffer underrun in fingerd(8).
Stop demoting USB2 uvideo(4) devices to USB1, instead let them attach to ehci(4) since we have isoc support.
Add support for VAXstation 3[58][24]0 to the bootlocks, currently limited to serial console.
Use STICK logic on UltraSPARC-IIe-based sparc64 machines to generate clock interrupts.
Add hypervisor calls on sparc64 for the Sun4v random number generator interface.
Added support for isochronous xfer support for ehci(4).
Add Jumbo support flag to MCP79-based nfe(4) devices.
Added fr-dvorak-be'po layout as fr.dvorak for PS/2 and USB keyboards.
Allow creation and use of ffs filesystems on non-512 byte sectorsize devices. Only i386 and sgi for now.
Make relayd(8) add a $SERVER_NAME variable which is "OpenBSD relayd" by default.
Fix possible memory leaks in relayd(8) chunked encoding handler.
In relayd(8), support HTTP responses that neither specify a Content-Length header nor chunked encoding.
Do not latch the IPSec tdb to the inpcb unconditionally, since packets could get encrypted unintentionally.
Add Longshine LCS-8031N to the list of supported ral(4) devices.
Increment if_ierrors in upgt(4) if we fail to extract the mbuf in the RX routine.
Plug memory leak in m_pullup2().
Reenabled the routing priority again.
Make sparc64 use %sys_tick to generate clock interrupts on systems that have it.
Fix sparc64 SMP %tick interrupt handling. Sometimes clock would stop ticking on some CPUs because of lost ticks.
Make sure the spanning tree bridge(4) code account for STP frames in if_obytes and if_omcasts.
Enabled ALTQ and VLAN on tsec(4) for the socppc platform.
Do not wait in the socket code for a free buffer in sosend(). Fixes userland hangs if the system runs out of mbuf clusters.
--------
Changes made between OpenBSD 4.3 and 4.4
In gcc(1), unconditionally disable -fcse-skip-blocks at -O2 for m68k, causes bad code generation in some cases.
Fix for trunk(4) panics and unbreak failover/loadbalance/broadcast status handling.
Back out acpi(4) setpdc code and the code to allow EST to use acpicpu on amd64 machines.
In re(4), add support for reading the MAC address for newer chipsets.
Since newfs(8) is meant to be run on raw devices, it now refuses to run on block devices.
Updated BIND to 9.4.2-P2.
Added support in amd64 and i386 for using extended partitions by handling chained EBRs correctly.
Fixed bsd.rd for the hppa and armish platforms.
Compile inteldrm and radeondrm in i386 and amd64 GENERIC, but disabled.
Prevent crash in the Mesa code if Delete is not defined for the given renderbuffer.
Disabled pf(4) state key linking for now.
Make sure the 802.11 layer drops unencrypted frames when WEP is on, or when WPA is on and RX protection for TA is enabled.
Unconditionally force route priority to RTP_DEFAULT, effectively disabling route prio. Not all parts of the system deal with them correctly yet.
Make iwn(4) wait much longer for clock stabilization.
Updated sudo(8) to 1.6.9p17.
Fix uvideo(4) crashes seen in MS LifeCam NX-6000 and internal laptop Sonix chipsets.
Make sure systat(1) does not accept negative or zero delay values on the command line.
Added ath(4) on sparc64 GENERIC kernels.
Added wi(4) on PCI on sgi GENERIC kernels.
Added Sierra Wireless MC5725 to the list of supported umsm(4) devices.
Enabled ix(4) to the amd64 GENERIC kernels.
Fix potential division by zero in the trunk(4) driver.
Stability fixes for the radeon(4) driver, mostly related to VBLANK interrupt handling.
Prevent memory leak for IPv6 output descriptors in the pcb code when detaching.
Prevent sparc64 Tadpole SPARCLE machines from using DMA in the pciide code and fall back to PIO instead.
Updated xf86-video-mga to 1.4.9, xf86-video-nv to 2.1.10, xf86-video-neomagic to 1.2.1 and xf86-video-vmware to 10.16.4.
Added stricter checking for values controlling loops and memory allocations in the i915 and Radeon DRM code.
Allow port distfiles to be stored as by_digest/sha1/di/digest to prevent distfiles directories exceeding the maximum number of links.
Fix for record ring pointers when audio pauses or overruns.
Try harder on sparc64 to find the aux port in pckbd(4). Tadpole SPARCLE needs it.
Add rebuild mark to softraid(4) to restart a rebuild upon clean shutdowns.
Fix FIFO overruns in ath(4) for PCI-E chipsets.
Make sure route message length is properly aligned to the next natural boundary.
Update the timezone data to tzdata2008e and code to tzcode2008e.
On m88k-based machines, disable delay slots in the locore 88110-specific parts.
In the network route code, fix tracking of RTF_MPATH.
Added Option GlobeSurfer ICON7.2 and Option GlobeTrotter HDSPA ICON 225 to the list of supported umsm(4) devices.
New implementation of malloc(3) from otto@.
Increase the size of the TSB on large memory sparc64 machines.
Extend the malo(4) device firmware load timeout from 50000us to 500000us.
Make sure uvideo(4) fails properly if the image resolution changes on the fly and exceeds the buffer size.
New target for ports makefiles "update-or-install".
Add -b switch to locate(1) for matching on the last part of the path only.
Fix for alpha PIE executables that sometimes could end up mapped on, or above, the stack.
Make RAMDISK kernels work on sparc64 T2 systems by switching early to a temporary stack.
Make sure libstdc++ does not undefine C99 math macros if !_GLIBCPP_USE_C99.
Add code for alpha to decode machine checks on Avanti, providing a description of the problem.
Make sure we clear the pf(4) state key pointer in the mbuf header to prevent ipsec encapsulated state to be linked to the decapsulated one.
Implemented various C99 functions like isnormal(3) and isnan(3) in libc.
Fix for occasional double free in getpwent(3).
Fix ps(1) output problem on hppa triggered by faulty cache aliasing boundary sizes.
Fix stack abuse in the ksh(1) "time" command.
Make relayd(8) validate packet length in debug dns packet logging before printing the header.
Prevent sshd(8) from printing options that have been compile-time disabled when running in config test mode.
Added dynamic IPv6-to-IPv4 and IPv4-to-IPv6 translation in relayd(8).
Added proper interrupt handling for alpha PCI devices behind bridges.
Added some more C99 definitions to math.h.
Implemented a method to fetch scsi device "devid".
Implemented the cpu_yield hypervisor call for sparc64, used in the idle loop of SUN4V-based machines. Huge performance boost when most of the CPUs are idle.
Fix timekeeping anomalies on Sparc64 T1000 machines by moving smp_signotify() from IPL_NONE to IPL_SOFTINT.
Move Huawei E618 and E620 from ubsa(4) to umsm(4).
Bug fix for pow() and powf().
More accurate algorithm for tan() in libm.
Provide a timecounter for sparc64 based on the UltraSPARC IIe STICK logic.
Better metadata handling in softraid(4).
Make alpha read SRM hints for the bottom 4 PCI slots of an AlphaServer 1000A.
Added acx(4) at cardbus(4) for sparc64 GENERIC kernels.
Introduced a new 'parent' keyword in relayd(8) to inherit the state from another host with the specified Id.
Added ohci(4) and ehci(4) at cardbus(4) for sparc64 GENERIC kernels.
Add support in the kernel to recognize, load and execute position independent executables and randomize the load address. Not for all arches yet.
Fix for isp(4) firmware loading, now works again on sparc64.
In relayd(8), use getaddrinfo/getnameinfo instead of inet_pton/inet_ntop to allow specifying and printing the IPv6 scope identifier.
Add -E flag and 'skipempty' option to mail(1) to skip sending messages with empty bodies.
Add prototype for infnan in math.h so it returns correct values.
Fix relayd(8) NAT lookup for IPv6.
Link UDP PCBs to pf(4) states, same as for TCP.
On bge(4), enable the read DMA engine's PCI read request long burst mode for PCIe chips. Resolves poor TX performance.
Add a timecounter on sparc64, based on the $sys_tick register, and use it on machines that have it.
Fix re(4) so newer PCIe devices work (8168C*/8102*).
Updated xenocara ati driver to 6.9.0.
Make sparc64 IV processors only attach the first thread of every core for now.
Imported the openchrome video driver 0.2.902 into xenocara.
Add support for the Marvell 88E8016 PHY in eephy(4).
Provide sparc64 Fujitsu based SPARC-IV machines with a core(4) device for each core and thread and attach cpu(4) to them.
Make libc handle sign of negative zero in the printf code.
Add support in the sparc64 platform code for Fujitsu SPARC-IV CPUs.
Make pf(4) NAT code also check source port allocation against net.inet.(tcp|udp).baddynamic lists.
Fix leak in pf(4) in the NAT case where the second state key needs to be freed manually in case of failure.
Make disklabel(8) read the vendor flag from ASCII disklabel.
Make the rc(8) boot script populate the baddynamic list of ports with the contents of /etc/services to avoid well-known ports.
Make the sysctls net.inet.(tcp|udp).baddynamic source port cover the entire 65536 port space.
Updated BIND to 9.4.2-P1.
Make relayd(8) use the non-repeating shuffle instead of arc4random() when binding sockets for DNS requests.
Update relayd(8) dns code to open new UDP socket to send the forwarded dns requests instead of sending from the server socket. Fixes some limitations and allows for randomizations.
Add support in ftp(1) for recursive mget transfers.
Fixed really old bug in yacc(1) when reducing a rule which has an empty right hand side.
Fix crash in bgpd(8) when trying to print an int as a string under certain circumstances.
Initial version of vmt(4), a kernel level implementation of the vmware tools. Only provides the hosts clock as a timedelta sensor so far.
Updated isp(4) microcode to 3.03.19, prepares for major isp(4) code upgrade.
Extended sbbc(4) for sparc64 to provide a console for the v1280 machines.
Update time zone data files to tzdata2008d.
Add AGP and pchb(4) hostbridge support for Intel 82945GME chipsets.
Fix pthreads(3) when using application-specified thread stacks.
During installation, make 'dhcp' the initial default answer during network configuration.
Added sbbc(4), a driver for the BootBus controller for sparc64 and ssm(4), a driver for the scalable shared memory device.
Brought in various fixes to make V1280 a supported sparc64 model.
In udcf(4), add support for the new Expert mouseCLOCK USB II.
Make ksh(1) accept \$ PS1 when started as root, and refuse to import a PS1 unless it contains a '#' character.
Teach sysmerge(8) how to retrieve etc*/xetc*.tgz files from FTP/HTTP paths using ftp(1).
Fix httpd(8) proxy module in SSL mode.
Clean up parser in pkg_add(1), also dropping the restriction that URLs need to end in a slash.
Make ssh(1) support negation of groups in a "Match group" block.
Fix panics seen in pf_state_key_attach for pf(4).
Updated the xenocara radeondrm and inteldrm driver.
Add rum(4) to macppc RAMDISK kernels.
Link pf(4) states with TCP pcbs, and vice versa. Speeds up lookups.
Added softraid to amd64 and i386 RAMDISK_CD kernels.
Updated the page daemon to modern limits and rework the logic in it.
Added bio and bioctl to sparc RAMDISK kernels.
Added initial version of acpivideo for acpi(4).
Enable FFS2 on hppa RAMDISK kernel also.
Increased the ephemeral key size in ssh(1) protocol 1 from 768 to 1024 bits.
Moved OpenBSD to 4.4-beta.
In ipsec.conf(5), if rules contain a hostname instead of an address, use the list of all possible addresses from DNS and not only the first one.
Added bio and bioctl(8) to macppc and hppa RAMDISK kernels.
Enable FFS2 on most larger RAMDISK media.
Even stricter probing for AMD Geode CPUs in the amdmsr(4) code.
Allow cdio(1) in TAO mode to set the write speed.
Fixed three-state boolean logic in sendmail(8).
Added re(4) at cardbus? to amd64 GENERIC kernels.
Updated xf86-video-intel to version 2.3.2.
Added a usb2.0 to usb1.1 handover method for devices which only work in 1.1 mode but where usb2.0 would attach it.
Reenabled branch prediction on swift CPUs for sparc.
For opencvs, make sure we only check out files again if a sticky tag was in fact set when the user supplies -A.
Make sure we clear the swap encryption keys before dumping a kernel image.
Hook up arc(4) blinkenleds to bioctl(8).
Added uvideo(4) to alpha, macppc and sparc64 GENERIC kernels.
Plugged memory leak in rcs(1) in the rcs_rev_getlines() function.
Added bio and bioctl(8) to amd64 and i386 RAMDISK_CD, to zaurus and sgi RAMDISK and to alpha RAMDISKBIG kernels.
Initial import of ypldap(8), a drop-in replacement for ypserv to glue in an LDAP directory for get{pw,gr}ent family of functions.
Moved ssh(1) Fingerprint Visualization from CheckHostIP to an own config option named VisualHostKey.
Make ssh(1) test the primes in /etc/moduli better.
Allow sftp(1) chmod(2) operations to set set[ug]id and sticky bits. Does not apply to transfers, only chmod commands.
Fix sticky-address on pf(4) rdr.
Added support for Intel G35 graphics.
In disklabel(8) interactive mode, always suggest offsets and sizes inside the OpenBSD area. Added an 'l' command to print headers only.
Various improvements in ftp(1), including better handling of resumes.
Fix in bootloader to skip CHS checks if LBA is found and OK.
Added auglx(4), an audio(4) driver for the AC'97 audio codec found on some AMD Geode LX systems with CS5536 companion chips.
Allow i386 and amd64 to boot from extended DOS partitions.
Teach ldd(1) how to handle PIE executables.
Implemented time-based rekeying for idgen32.
RX chain corruption fix for bnx(4) in low memory situations.
Disallow processes from mapping their own page 0.
Implemented reentrant functions getpwnam_r() and getpwuid_r() in libc.
Make cdio(1) automatically distinguish between CD-DA tracks and WAVE audio files when writing them in TAO mode.
Updated freetype to 2.3.6. Fixes CVS-2008-1806,1807 and 1808.
Added Marvell Yukon devices based on 88E8040T chips to the list of supported msk(4) network cards.
Reenabled amdmsr, now it properly checks for AMD Geode LX CPUs with a graphics processor.
Prevent wc(1) from printing spurious whitespace when reading from stdin.
Make printf(1) ignore double dash even though it does not take any options itself.
Added ix(4) to amd64 and i386 GENERIC kernels, enabled on i386 only.
Fixes for vblank in the DRM code.
Updated xf86-video-apm to 1.2.0.
Updated xinit(1) to 1.1.0.
Removed lbxproxy, xphelloworld, xplsprinters and xpreharshprinterlist.
Fix segmentation fault in mg(1) when writing to an alternate name.
Updated the Xext code for MIT-SHM, fixes CVE-2008-1379.
Unbreak OpenCVS diff for newly added files.
Fix cwm(1) crash when compiled with -g.
Fix ftp(1) transfer interrupting when confirmrest mode is used.
Prevent ssh(1) from calling isatty() on a pty master, prevents hang on exit on some non-openbsd platforms.
Make MaxAuthTries available inside Match blocks in sshd_config(5).
Disabled amdmsr(4) until a way to only make it work on Geode CPUs is found.
Reenabled ipmi(4) again on amd64 and i386 GENERIC kernels.
Allow bgpd(8) to delete more than one community per filter rule.
Make powerbooks and ibooks default to adb keyboards for console.
Added 802.3ad LACP support in trunk(4).
Make the amd64 platform capable of getting EST CPU operating points from ACPI when running on Intel CPUs.
Initial version of rpc.statd(8).
Make ftp(1) accept empty passwords in URLs.
Make OpenCVS handle addition of new files in branches.
Make rpc.lockd(8) handle filehandle comparisons between NFSv2 and v3.
Make uvideo(4) notify the user that attaching to echi(4) wont work.
Better bounds checks on RAW_PART devices so we never access past the end of the device.
Updated xserver to 1.4.2 in the xenocara tree.
Added xf86-video-geode driver to the xserver.
Add support in carp(4) to specify carppeer, the unicast address of the remote carp peer.
Initial version of amdmsr(4), a driver to access model specific registers on AMD Geode CPUs.
Make sure each nfs iod can enqueue more than one asynchio, and limit the amount of buffer cache it is allowed to a sensible amount. Improves write performance due to less syncing.
Improved the mg(1) undo code.
Make OpenCVS handle RCS files without a head revision set.
Added support in OpenCVS for sticky date set in CVS/Tag and CVS/Entries per directory.
Two performance improvements in OpenCVS, one by reusing the last opened CVS/Entries until we switch directory, and switching writes to fwrite(3) instead of line-by-line.
Allow ath(4) to detach cleanly when attaching via PCI.
Add cmp(4) to sparc64 RAMDISK kernels too.
Updated bioctl(8) and softraid(4) to enable softraid crypto. Still experimental!
Fix ldscripts for i386 when using -pie.
Make carp(4) not log state transitions to or from INIT by default.
Add support in bge(4) and bnx(4) for fiber PHY using BCM5714/5780 and BCM5706/5708 adapters.
Implemented NFS file locking in rpc.lockd(8).
Implemented xdr_int64_t and xdr_u_int64_t to the rpc xdr(3) suite.
Added strtof(3) to libc.
Update xenocara xfs(1) to 1.0.8.
Rework bridge(4) mac address selection when using Spanning Tree Protocol.
Added D-Link DWA-111 to the list of supported rum(4) devices.
Updated xenocara showfont to 1.0.2.
Make ssh(1) refuse to read ~/.shosts or ~/.ssh/authorized_keys that are not regular files.
Added support in sysmerge(8) for ignoring files and directories using optional /etc/sysmerge.ignore file.
Make ssh(1) fall back to creating a new TCP session for most multiplexing errors.
Make amd64 and i386 detect Intel's SMX, Safer Mode Extensions.
New display mode for systat(1), "pftop".
Added support for malo(4) and ep(4) at pcmcia(4) and also re(4), ral(4) and xl(4) at cardbus(4) for sparc64 GENERIC kernels.
Enabled uvideo(4) on i386 GENERIC kernels.
Added support in tcpbench(1) for opening more than one concurrent tcp session.
Some preparations in ld.so(1) for PIE executable support.
Enabled uvideo(4) on amd64 GENERIC kernels.
Added statistics in nfsstat(1) to show how many async to sync changes are done.
Better dsdt AML parsing for acpi(4).
Improved privsep support for X11/DRI.
Fix synproxy in pf(4).
Make systat in "iostat" mode show buffer cache statistics too.
Make OpenCVS handle symbol names that are also RCS tokens.
Prevent NULL dereference in ELF loader.
Fix libm compiles on gcc2 architectures.
Added com(4) and wdc(4) at pcmcia(4) for sparc64 GENERIC kernels.
Fix egress group matching for IPv4.
Added dc(4) on cardbus(4) for sparc64 GENERIC kernels.
Plug small memory leak in ssh(1) multiplex escape char handling.
In OpenCVS, completely remove the need for TMP_DIR when running checkout.
Make sure asynchronous I/O in NFS fail correctly if all nfs iods are busy and downgrade them to synchronous ones.
Make ssh(1) display the key type as a caption in the frame of the random-art screen.
Do not look for foreign ELF binaries unless emulation is enabled.
Remove race in ssh(1) by maintaining a queue of outstanding global requests we expect replies to, and use it to verify success for remote forward.
In ssh(1), enable ~ escapes for multiplex slave sessions.
Introduced a basic c-mode in mg(1).
Add "delete volume" functionality to bioctl(8).
Make ldattach(8) flush stdout after printing the pty name.
Update isp(4) QLogic 2200 firmware to 2.02.06.
Added ssh(1) fingerprint ASCII visualization.
Updated libX11 to 1.1.4 in the xenocara source tree.
Updated the math(3) libraries in regard of gamma/lgamma and tgamma() functions.
Added a bunch of new ciss(4) devices.
Added support in relayd(8) for transparent L7 forwarding in relays.
Fix in the xserver DBE extension.
Fixes in xenocara for various overflows, CVE-2008-1377,1379 and 2360-2362.
Added vlan support to pcap(3).
Updated the DRM code in xenocara.
Enabled memconfig(8) on the amd64 platform.
Synchronized the amd64 MTRR API with i386, and enabled it on GENERIC kernels.
Make bgpd(8) independent from system time changes by using monotime.
For sparc64, use the prom address to map clock(4) at ebus(4) if available.
Improved pf(4) forwarding performance by removing need for a state lookup on outbound packets.
Added "tar -j" option to launch bzip2 for compress/uncompress operations.
Initial version of softraid(4) crypto support. Disabled for now.
Fixed panic in bwi(4).
Added clear-mark function to mg(1).
Reduce memory usage in fsck_ffs(8) by about 20% by packing state and type of an inode in a single byte.
Make ssh(1) support CIDR address matching in .ssh/authorized_keys from="..." stanzas.
Added NFS cache improvements.
Added AMD Geode LX support in xenocara.
Add no-more-sessions extension to ssh(1) to indicate it will never request another session.
Increased isakmpd(8) fifo command buffer size to accommodate IPv6 addresses.
Make relayd(8) use sloppy pf(4) state keeping for routed sessions (Direct Server Return).
Make pf(4) counters on table addresses optional, and disabled by default. Saves about 40% memory if counters are not being used.
Fixed buffer cache pending read statistics.
Fixed memory leak in usbf(4) code.
Made signal permission checks POSIX compliant.
In OpenCVS, make sure we properly inherit file permissions.
Revamped the buffer cache.
Shrink pf(4) state structure by collapsing two 8 bit ints into one.
Make ldattach(8) sleep if the slave device of the pty(4) is not connected.
Fix isakmpd(8) so it has the same behaviour for IPv6 and IPv4.
Do not ask "override?" in rm(1) if the access fails for other reasons than EACCESS.
Allow emulated linux binaries to call setsockopt(,TCPNODELAY,) on a AF_LOCAL socket.
Fix IPv4 in IPv6 IPSec encapsulation issue.
Added /dev/video* on the amd64 platform.
Added extended test mode (-T) to ssh(1).
Added -O option to rtsold(8) to run an external script when the "other configuration" flag is found in the RA message.
Fix interrupt handling in sd(4) for Iomega Jazz drives on ahc(4) and others.
In pf(4), implement a sloppy tcpstate tracker which does not look at sequence numbers at all.
In sshd_config, support full CIDR address matching in Match blocks, with support for negation and fallback to classic wildcard matching.
In ntpd(8), when using IPv6 addresses, return the first 32 bits of the MD5 hash of the address as ref ID.
Update ntpd(8) to respect RFC4330 when run as a secondary server.
Make amd64 machines be able to use more than 4G ram, and crank the MAXDSIZ to allow allocations/mmap() up to 8G.
New trigger framework in OpenCVS.
Added cmp(4) to sparc64, a dummy driver to make attaching CMT CPUs easier.
Update access(2) semantics regarding X_OK and the superuser.
Make gcc on alpha use -mieee by default. Fixes many FPE problems.
Drop root privileges in rtadvd(8).
Introduced an idgen32(9) facility to generate unpredictable 32 bit numbers and use them for IPv6 IDs and NFS server/client XIDs.
Make netstart(8) ensure the hostname.if(5) files have the correct permissions on each boot.
Better merge conflict handling in OpenCVS.
Deprecated slattach(8) and nmeaattach(8) in favor of ldattach(8).
Improved superblock location code in fsck_ffs(8) since newfs(8) creates alternate superblocks in different locations.
Better wireless support in rtsold(8).
Add -p option to ldattach(8) to pass data received from the device to the master device of a pty(4) pair.
Prevent ntpd(8) from leaking memory on refid production failure.
Fix Sun Fire V490 boot delay.
In ntpd(8), allow outgoing replies from sensor-driven servers to have a user-configurable reference ID, eg. "GPS" or "DCF".
Fix segmentation fault in OpenCVS annotate code.
Implemented an AES XTS mode in the crypto(9) framework.
Fix 64-bit issue in ndp(8).
For sendmail(8), disable ident queries, crank max queue children in bulk config and use the C flag in the bulk config file.
Make cdio(1) figure out if media supports TAO or blanking.
When rtadvd(8) receives SIGUSR1, send debug output to syslog instead of a file.
Add ability in cdio(1) to determine media capabilities.
Added IODATA WN-G54/US and MELCO WLI-U2-KAMG54 to the list of supported uath(4) devices.
Make sftp(1) client store statvfs replies in wire format.
Adapt uvideo(4) mmap frame buffer to a ring buffer.
Initial import of ix(4), a driver for the Intel 82598 PCI-Express 10 Gig Ethernet Adapter.
Fix suspend/hibernate issues in rt2860-based devices.
In ntpd(8), do not ignore a slightly unresponsive server for an hour, 5 minutes is enough.
When adding PMTU related routes to the table, inherit the priority from the parent.
Fixed NULL pointer dereference in pf(4), affected IPv6 only.
For ixgb(4), sync the TX ring and post new packets to the chip once per call to the start routine instead of once per packet.
Fix fault in OpenCVS when running status -v on non-existing files.
Prevent segmentation fault in ed(1) when receiving a signal while being in getpass().
Allocate ipq's for fragment reassembly in the ip_input code from a pool instead of using malloc().
For i386 and amd64, make serial console on non-primary ports work.
Make OpenCVS properly check passed tags for validity before attempting the import and allow multiple release tags.
Make et(4) devices detachable.
Removed support for dhcpd.interfaces in /etc/rc and deprecated the file /etc/dhcpd.interfaces.
Fix memory leaks in OpenCVS in the directory tag handling code.
In dumpfs(8), fix generated size for -m.
Fix ld.so(1) prebind to not leak file descriptors.
Add code to make UltraSPARC-IV work.
Add disabled com4 device in i386 GENERIC for Fujitsu Stylistic Touchscreen devices.
In sftp(1), increase statvfs member fsid to 64 bits.
Add acphy/mtdphy/luphy and sqphy which are used by dc(4), hme(4) and ne(4) to hppa GENERIC and RAMDISK kernels.
Add baudrate handling for bge(4) fiber boards using the TBI interface.
Add link state/baudrate handling to ti(4).
Stop spurious "got link" message from dhclient(8).
Moved the Apache manual from /var/www/htdocs/manual/ in the etcXX file set to /usr/share/doc/html/httpd/ in the miscXX file set.
Remove hardcoded route priority in arplookup.
For acpi(4), add _?RS methods evaluation to obtain additional heuristics and setting interrupt routing.
For rthreads, make fork(2)/vfork(2) wrapper functions to reset state in the child process. Also protect libc/ld.so(1) critical areas during those calls and add pthread_atfork(3) implementation.
Added first bits for supporting mmap(2) in uvideo(4).
For i386 and amd64, allow pchb(4) to find additional non-coherent HyperTransport links.
Prevent cwm(1) from trying to exec a null char.
Make cwm(1) honor termpath and lockpath if given in the cwmrc(5) file.
Beginning to remove OLF support.
If acpidump(8) is given -o, do not disassemble the AML so you can get the dump if the disassembler crashes.
Extend awk(1) with bitwise operations.
Fix bias for upper_bounds in really large ranges for the random number generators. Nothing in the source tree yet requests such ranges.
Make DRM code for X.org use D_CLONE so per-open data works. Preparation for privilege separation.
In the pthreads(3) library, do not grab the file descriptor read lock for getsockopt(2), setsockopt(2), getpeername(2) or getsockname(2). Prevents deadlocks if another thread already holds that lock.
Allow aucat(1) to play/record from input-only or output-only devices.
Reduced ixgb(4) and em(4) code size by moving periodic debug output inside #ifdefs.
Revert xenocara inputproto to 1.4.2.1 again.
Prevent aucat(1) from being suspended from the tty.
Make aucat(1) over- and underrun behaviour user selectable per stream.
Make aucat(1) handle over- and underruns without disturbing other streams.
Shrink scsi_mode_sense to 254 bytes to please ahci. Makes some SATA tapes drives work.
Fix uvm swapencrypt for the last 128 page area.
Make acpithinkpad(4) ignore the brightness changed event.
In uftdi(4), add some ELV Elektronik based devices.
Move amd64 interrupt setup before ddb setup on the amd64 platform to allow boot -d from UKC.
Fix synproxy breakage in pf(4) introduced with the new state tables.
Fix kernel freeze from umsm(4) when unplugging an active device.
Fix double free in tail(1) which can happen if the last line has no newline.
Added PRIMEPOWER 650/850 to the list of supported sparc64 machines.
New ACPI parser for i386/amd64.
Make sure sparc/sparc64 isp(4) use the same SCSI initiator ID as the prom.
In sysmerge(8), make it possible to merge files from xetcXX.tgz only.
Fix acx(4) TX performance issue in HostAP mode by using 1MBit/s as beacon sending rate.
Updated Mesa to 7.0.3 in the xenocara tree.
Removed ext2fs from i386 RAMDISK B.
Make sure cdio(1) will not try to blank a CD twice.
Fix NULL dereference in OpenCVS logging code and segfault in keyword expansion code if no RCS file is available.
Added support of diff -D in OpenCVS.
Make sure we don't overflow the static buffer in the uvideo(4).
Add support for PCA9552 LED dimmer in the pcaled(4) driver.
Rewrote pf(4) state logic.
Enabled hme(4) in hppa GENERIC and RAMDISK kernels.
For ln(1), do not print a warning if source and target already point to the same inode when given -f.
Removed limit in OpenCVS on arguments on command line or sent by client.
Add support in umsm(4) for Option GlobeTrotter 3G+ cards.
Fix aucat(1) resume after suspend.
For mpi(4), only look up initiator ID on Sparc64.
Added DRM support to amd64 platform also.
Make netbt code compile again.
Updated libiberty to 2.17.1.
Do not allocate fixed frame size in uvideo(4), and skip too large frames.
Updated time zone data to tzdata2008c.
Fix in pf(4) for flushing of count of states.
Added ZyXEL G-202 to the list of supported zyd(4) devices.
Fix bringing down a socppc tsec(4) interface.
Make the scsi subsystem print out the initiator ID.
In pkg_add(1), remove nlist optimization, since some ftp servers have issues with NLIST *.tgz.
Added tsec(4) to socppc RAMDISK kernels.
Reorganized some fields in fsck_ffs(8) inodesc and inoinfo structs to reduce size on some archs.
Added -q for quiet to aucat(1).
Enable cmpci(4) and eso(4) on macppc GENERIC kernels.
Make et(4) count output packets.
In dhclient(8), if an interface has no link at startup, try to force it up.
Make sure dhcpd(8) does not error out if dhcpd-sync does not exist in the services(5) file, and no sync options were specified.
Fix rdistd(8) with regard to rdisting symbolic links.
Fix TSEC2 RX interrupts on socppc.
Updated xenocara inputproto to 1.4.3.
Move cmpci(4)and eso(4) out of the alpha GENERIC untested section.
Enabled emu(4) on sparc64 GENERIC kernel.
Enable userland to read(2) video streams from /dev/video.
Updated libpciaccess to 0.10.2, xkbfile to 1.0.5, libtrans to 1.2 and printproto to 1.0.4.
Updated Xfont to 1.3.2, Xinerama to 1.0.3 and Xv to 1.0.4.
For the socppc tsec(4) devices, configure the media when bringing up an interface and use the mac address passed by the firmware.
Added IPv6 support to identd(8) when run in standalone mode.
Added Schneider & Koch SK-9821/SK-9843 to the list of supported sk(4) devices.
Added some Fujitsu ethernet cards (PW008GE5 and GE4) that actually are bge(4).
Update sem_otime on semop(2).
Prevent alpha ramdisks from adding swap space automatically.
Fixed Ctrl-T status report on some ttys without carrier.
Fixed situation in NFS when TCP mounts timeout and processes get hung in the reconnect code since they do not have enough privileges.
Removed USER_LDT code from the amd64 platform.
Removed old awi(4) driver.
Make GENERIC.MP work on sun4u CPUs too.
Make OpenCVS properly pass the directory tag of parent directories into new subdirectories.
In aucat(1), add support for recording full-duplex, format conversions and resampling on the fly, mixing multiple inputs of different formats, upto 16 channels and more linear encodings.
Bumped spamd sync protocol, fixes sending ip addresses being sent in host byte order, and sub-headers in the frame were not natively aligned for 64-bit arches.
Remove ises(4) from alpha and amd64 GENERIC kernels.
Make OpenRCS/CVS correctly deal with non-zero depths specified in rcsnum_cmp().
Added MCP77,79 and 7B SMBus controllers to nviic(4).
Add Fujitsu PRIMEPOWER250/450 ethernet to the list of supported bge(4) devices.
Updated the xf86-video-intel driver to 2.3.1 in the xenocara tree.
Speedup for SH-based machines in the cache handing code.
Initial code for supporting Sun4u machines with Fujitsus SPARC64-V CPU.
Switched the i386 platform from pccom(4) to com(4).
Make cwm(1) menu_filter handle mouse movement too, enables keyboard search dialogues to be manipulated with the mouse.
Implemented a -U option for httpd(8), to set the default address family to PF_UNSPEC for ambiguous directives.
Added multicast support to lii(4).
Fix ksh(1) cast pointer arithmetic to correctly handle underflows.
Added tsec(4), a driver for the socppc Three Speed Ethernet Controller.
Removed libc recalloc(3) call.
Fix httpd(8) compiles on gcc 2.x architectures.
Fix usb memory leak when there is no power source.
Add support in ssh-keygen(1) for -l in combination with -F to search for a known host and display its fingerprint.
Fix ssh(1) sending tty modes when stdin is not a tty.
Fix in cwm(1) for alt-tabbing when programs steal key events.
Added the SO_BINDANY socket option for IPv6 also.
In the usb subsystem, try a few times before giving up while getting the device descriptor.
Implemented keyboard binding in cwm(1) for group toggling.
Removed en(4) from alpha RAMDISKBIG kernels.
Fix for ssh(1) protocol keepalive timeouts.
Fixed small memory leaks in cwm(1).
In umass(4), avoid leaking pipes in error cases.
Fix glass console on the sgi platform.
Added full branch support in OpenCVS.
Make spamdb(8) check for an @ sign when given -t or -T.
In sppp(4), initialize timeouts only once, not everytime they are started.
In relayd(8), clear source nodes on table changes in sticky mode.
In uvideo(4), fix kernel crash when device gets detached, and make sure we free the sample buffer on detach.
Allow ntpd(8) to step the time at startup, regardless of how large the offset is.
Added support in pf(4) for diverting IPv6 traffic also.
In ehci(4), avoid clearing the port enable bit when bringing it out of reset.
Added cmpci(4) and eap(4) to Sparc64 GENERIC kernels.
Added a non-interactive mode to sysmerge(8).
Allow thinkpad ACPI button events to change the volume.
In the NFS code, make sure we do not grab the receive lock if the reply has already been received while we slept.
Prevented a race condition in rdistd(8).
In st(4), fix device reference counting.
In the umsm(4) driver, if we find a E220 device in umass mode, send the magic command to enable the serial portions of the device.
Fixed a crash in the libc hash code when iterating over a hash and removing its elements.
Added a few more macros to the tree(3) suite.
Fix segfault in the "cvs admin" command for both GNU cvs and OpenCVS.
Plugged a memory leak in rcs(1) and (open)cvs for rcs_delta_stats.
Added Buffalo LUA-U2-GT to the list of supported axe(4) devices.
More protection against mbuf pool corruption in the IPv6 input code.
Remove limit of 128 arguments on the command line for OpenRCS.
Initial import of the socppc, a port of OpenBSD for the Thecus N1200, and potentially other PowerPC SoC platforms.
Various file descriptor and pipe fixes in ssh(1).
Added support in pfctl(8) to kill states by rule label or state id.
Added support for NTT DoCoMo A2502 to the umsm(4) driver.
For umsm(4), increase buffer size to 4k and make use of interrupt endpoint to increase responsiveness.
Added support for IPv6 in httpd(8) while keeping the default at IPv4.
Fix for bge(4) link status change handling.
Make the sd(4) code lock in removable media while determining the disk parameters.
Make dhclient(8) not give up when the link is not available on startup, also renew the lease whenever the link was lost and becomes active again.
Make ssh(1) port forwarding code try additional addresses when connecting to a destination whose DNS name resolves to more than one address.
Added the SO_BINDANY socket option from BSD/OS.
Import of tcpbench(1), a small TCP benchmarking tool.
Fix when detaching tape drives.
Added support for Microsoft Wireless Intellimouse and Notebook Optical Mouse 3000 Model 1049 in the ums(4) driver.
Make the maximum number of ssh(1) sessions run-time controllable via MaxSessions in sshd_config(5).
Implemented a channel success/failure status confirmation callback in ssh(1).
Reorder elements in the pf_state_peer struct to avoid wasting memory. Saves 8 bytes per entry on 64-bit machines.
Make ssh(1) avoid extra malloc/copy/free when receiving data over the net. Gives up to 10% speedup for localhost scp.
Updated file(1) to 4.21.
Correct the duration in cdio(1) by taking the pre-gap into account.
Enable TX mitigation when putting packets on the wire.
Add synchronization support to dhcpd(8).
Removed routed(8), ripd(8) will replace it.
In spamd(8), check if the received buffer of a sync element is big enough to hold the header with length field.
Make pf(4) scrub packets based on tags.
Allow pf(4) to set TOS with scrub.
Allow virtual interfaces to add to the random pool.
In ssh(1), enable the AllowAgentForwarding in sshd_config(5) by default.
Implemented routing priorities, to be used to resolve conflicts from various routing daemons.
Removed the ises(4) driver.
Added an alternative "route-to" mode to relayd(8). A first step towards support for "DSR", direct server return.
Map i810 on the same PCI BAR as inteldrm.
Initial version of an mpe(4) interface, the "MPLS Provider Edge".
Add support for the Apple USB A1277 Ethernet adapter in the axe(4) driver.
Make pf(4) kill an existing state if we get a SYN for a state that has been closed from both sides.
Make msts(4) return clock status as a signal sensor.
Change pax(1) behaviour when running in -u mode and no files are being updated due to them not changing, to exit with a success return code.
Allow nc(1) to set TCP send and receive buffer sizes.
In pfctl(8), add a counter to record how many states have been created by a rule.
Endian fix route(8) sockaddr labels.
Prevent possible int overflow in the pf(4) ioctl code.
Make nmea(4) provide a signal sensor that reflects the status of the receiver like other sensors.
Prevent ndp(8) from installing a /128 net route for proxy NDP entries.
For relayd(8), put relay sockets in non blocking mode too.
Added Huawei E220 to the list of supported umsm(4) devices.
Convert some wscons keyboard layouts to correct X names.
Updated sendmail(8) to 8.14.3.
Fix SGI memory detection if memory sticks are not populated in decreasing sizes.
Make PowerPC SMP machines not grab biglock for syscalls marked SY_NOLOCK.
For M88k SMP, make sure we grab the biglock unconditionally when system calls go through systrace(4).
Fixes in bgpd(8) for the RIB eligibility logic and correctly mask looping paths.
Plugged potential mbuf leaks in the NFS syscall code.
Fix the socket option SO_TIMESTAMP.
Update libevent to 1.3e, retaining local changes.
Make libc readdir/telldir code more careful about entries deleted after a seekdir().
Make hp300 recognize different built-in frame buffers 362 and 382.
Updated sysmerge(8) to handle xetcXX.tgz support and cleanups.
More amd64 serial console fixes.
Make ssh-scan(1) default to RSA protocol 2 key, instead of RSA1.
Make sure we drop all MPLS packets when MPLS is not enabled.
Enabled building of DRI modules and Mesa drivers by default on amd64 and i386 for X.org.
Improved SIS 96x chip detection in pciide(4), and added some 964/965 devices to the list of supported chipsets.
Enabled km(4) on amd64 and i386 GENERIC kernels.
New driver km(4) for sensors on the AMD Phenom and Opteron Barcelona CPUs.
Spin up secondary cpu on more ppc systems.
In the vesa(4) framebuffer code, do not alter mode parameter.
It is now possible to enter static MPLS routes into the kernel with route(8).
Plug three memory leaks in dc(1).
Added PCI ids for the AMD64 Phenom/Opteron 8300 series and Griffin.
Various cddb fixes to cdio(1).
Added an acpithinkpad(4) driver for IBM/Lenovo laptops.
For hppa, add a gecko(4) driver for the GeckoBOA BC GSC+ port.
Bring macppc/powerpc closer to SMP.
Adjust the output voltage for the bge(4) BCM5906 PHY, otherwise it might not get a link.
Enable hardware TKIP+CCMP in RT2860-based ral(4) devices.
Small optimization for TKIP phase 2 for little-endian architectures.
In rcs(1), duplicate envstr and free it on error, instead of allocating for each argument and freeing each on error.
Fix in gcc(1) for mips code generation to prevent user asm statements from being put in delay slots.
Fixes for SH in gcc(1) when compiling PIC code and other optimizations.
For i386, make ipending per-cpu.
When allocating amd64 interrupt 'slots', always check all slots to see if we already allocated a slot for a particular pin.
Plug potential mbuf leak in the NFS vfsops code.
Boot loader argument parsing for amd64 was configuring serial console even when using a glass console. Fixed.
Added another HSDPA MSM to the list of supported umsm(4) devices.
Added support for more NM9845 variants in puc(4).
Corrected the brk(2) prototype to match POSIX.
Prevent overflow in rcs(1) if RCS_INIT and command line arguments exceed buffer size.
Initial acpiasus(4) driver for ACPI based hotkeys.
Fixed sgi IP30 serial console.
Allow amd64 to use serial ports other than com0 for console.
Make rthreads also return the proper values for failures in pthread_sigmask(3) and sigprocmask(2).
spl(9) fixes for softnet interrupt handlers when dealing with the ifqueues.
Fix for some ciss(4) firmwares that use different physical drive addressing.
Make pthreads(3) code return the proper values upon failure for pthread_sigmask(3) and sigprocmask(2) in threaded programs.
Added support for the Netmos 6 port version to puc(4).
Removed the pre-802.11 rln(4) driver, was never finished.
Imported basic LSR MPLS support.
Remove kludge in NFS that map EEXIST to a success return code on the assumption it is a duplicate reply.
Added sysmerge(8), a mergemaster-like utility to help you update /etc and configuration files after upgrading to a new release or snapshot.
Close potential mbuf leak in the NFS code.
Make ftp-proxy(8) flush output buffers before closing the TCP session, fixes case where the proxy would eat the 221 response.
Make syslogd(8) drop messages when writing to a pipe that is too slow to process input.
Clean up logging in rtadvd(8) by introducing same logging API as other daemons.
Fix for WPA/WPA2 when receiving an RSN IE in message 3 together with the WPA. Ignore it instead of deauthenticating.
Prevent truncation in the fdopen/fopen/freopen libc calls if the file descriptor number is larger than SHRT_MAX.
Fixes in ed(1) for SIGHUP handling.
Initial version of an adt(4) driver for the adt7462 sensor devices.
Allow low level audio(4) drivers to specify a default sample format, instead of 8-bit mono mulaw @8kHz.
On hppa64, use the firmware for reset when rebooting.
When starting Xorg without an xorg.conf, and the wskbd is "user", don't try to set such an xkb layout.
Replaced the hppa64 pluto(4) driver with astro(4) from hppa.
Added a proper bus_space_vaddr(9) implementation for hppa64.
Updated xinit(1) to 1.0.8, xkbcomp(1), xprop(1) and xset to 1.0.4 and xrdb(1) to 1.0.5.
Sync hppa64 console handling to the hppa code base.
Moved amd64 and i386 serial boot handling to talk directly to the hardware and not relying on the BIOS to do it for us.
Check bge(4) for BCM5704-based devices and only for them, set special register settings used in TBI mode for fiber adapters.
Add workaround for bge(4) CRC bug errata with BCM5701 A0 and B0 chipset-based devices.
For rl(4), make sure we don't call rl_rxeof() twice if both RX Ok and Err bits are set.
Changed the ELF loader to use the LMA as the load address for the various segments.
Updated twm(1) to 1.0.4.
Updated xenocara xf86-video-radeonhd to 1.2.1, xf86-video-sis to 0.10 and xrandr to 1.2.3.
Fix for Mesa in xenocara when using SSE where newly allocated memory would not be marked as executable, causing faults on various hardware setups.
Add a driver flag to ahci(4) to force negotiation of SATA 1 transfers.
Add filtering on direction for tcpdump(8).
Proper checks in the client code of opencvs(1) for memory allocations.
In pr(1), if memory allocation fails during error message buffering, print all held back messages and exit.
Allow cal(1) to show week numbers.
Add a function to uvideo(4) which can identify an USB descriptor explicitly by its size.
Added an sftp(1) extension called "statvfs@openssh.com" and "fstatvfs@openssh.com" that implement statvfs(2)-like operations. Also, add a "df" command to the sftp(1) client to produce a df(1)-like display of filesystem space and inode usage.
Extended the if_ethersubr.c CRC functions to support updating a running CRC in addition to the oneshot mode and also a speed improvement from marking some of the functions as "pure".
Make FTDI 2232L attach to uftdi(4).
Fix potential segfault in the Mesa i965 code due to a bad realloc.
Add missing monitor mode capability flag to uath(4).
For sparc64, make sure hardclock is called for every clock tick, even if we miss one.
Make the periodic security(8) run check for world-readable hostname.if(5).
Make netstart(8) check that hostname.if(5) files are not world readable before using them.
Fix the libc resolver to allow "_" in the middle of DNS name components.
Make the xf86-input-keyboard pick up the wscons keymap name to set up XkbLayout and XkbOptions if started without an xorg.conf.
Added a kernel implementation of the 4-way handshake and group-key handshake protocols of 802.11i, and a software implementation of TKIP and CCMP, making WPA/WPA2-PSK usable in both station and hostap modes for bwi(4), malo(4), ral(4), iwn(4), wpi(4), ural(4), rum(4), upgt(4), and zyd(4).
Fix for ehci(4) timeout handling.
Add workaround for UltrasparcII clock tick management where stopping the clock would sometimes fail.
Added support for the Texas Instruments bq4802 real-time clock found on the Ultra-25 and Ultra-45 sparc64 machines.
Added untested support for LM76 in the lmtemp(4) driver.
Added support for 2D acceleration on some mgx(4) video boards.
Enter wpa-psk(8), a tool to generate WPA-PSK keys from the ssid and passphrase.
Reworked the NFS mbuf write routines.
Clear CPUF_RUNNING when halting a CPU on amd64 and i386 MP systems, fixes power-down problems.
Rework the help output in disklabel(8) so it again fits on one page.
Improved the libc DNS resolver ID generation algorithm by wrapping the existing LCG in a random permutation generator based on a Luby-Rackoff block cipher.
Protect errno in ftp(1) from being trashed by other functions.
Make sure the swap encryption code gets the correct amount of swap pages, might not match when using a miniroot in the swap partition.
Updated mkfontdir(1) and mkfontscale(1) to 1.0.4 in the xenocara tree.
Fix crash in DRM code when it is enabled, but no device is attached when X tries to use it.
Synced pcc compiler with the master repository.
Fix bug in ld.so(1) when the error was DL_NOT_FOUND for libs which were found but could not be loaded.
Make vgrind(1) output to groff(1) instead of troff(1), so we end up with postscript output by default.
Added support for an "include" directive in the ipsec.conf(5) file.
Introduced mitigation for packet sending in the interface start routine.
Fix multicast packet and input bytes counting for ethernet devices being used by trunk(4).
Make sure the tty subsystem code scrubs stack-based buffers.
Rate limit FFS messages when it runs out of inodes/space to once every 2 seconds.
Make IPI sending on sun4v based Sparc64 machines use a single hypervisor call. Improves kernel compile times by 20%.
In azalia(4), add support for recording through the mic jack on AD1984-based devices.
Added Microchip MCP 98242 temp sensor support in sdtemp(4).
Added a -m flag to cal(4) to show weeks starting on mondays.
For ami(4), prevent phantom devices from appearing on the passthrough buses.
Added untested support for Microchip MCP9805 JC-42.2 sensor to sdtemp(4).
Added support for NPX SE97 devices in the sdtemp(4) driver.
Improved support in ld.so(1) for shared libs at non-zero addresses.
For com(4), increase the buffer size sent to the fifo.
Initial import of uvideo(4) and video(4). uvideo(4) is a driver for USB video devices and video(4) is a device-independent layer implementing the V4L2 API.
Various ehci(4) fixes for hangs at boot and shutdown.
Make i386 MP kernels not grab biglock for syscalls marked SY_NOLOCK.
For em(4), sync the TX ring and post new packets to the chip once per call to the start routine instead of once per packet.
Fix for sparc64 memory accesses, makes puc(4) work on T1000-based machines.
Make rshd(8) not call setpwent().
Make ahci(4) detachable.
Initial implementation of SGI XBow bus support.
For amd64 and sparc64, do not grab kernel biglock for syscalls marked SY_NOLOCK.
Added sdtemp(4) to alpha, amd64, armish and i386 GENERIC kernels.
New sdtemp(4) sensor driver for JDEC-JC-42.4 DIMM temperature sensors.
Fix disklabel(8) -w -d <disk> as used in the install scripts.
Do not call pthread_atfork(3) handlers when a multithreaded program calls vfork(2).
Reduce maximum number of state change interrupts tht(4) can generate to 100 per second.
Switch it(4) back to PnP config mode on amd64 and i386.
Fix for lii(4) TXD buffer wrap.
Add nsgphy(4) to the sparc64 GENERIC and RAMDISK kernels.
Add support for the National Semiconductor Saturn in the cas(4) driver.
Add support for the DP83865 PHY in the nsgphy(4) driver.
SECURITY FIX: Avoid possible hijacking of X11-forwarded connections with sshd(8).
A source code patch is available.
[Applied to stable]
Make xdm(1) zero out the password as early as possible when using bsd_auth(3).
Make the bcrypt(3) code zero the state buffers on return.
Fix code which blocks passing file descriptors into a chroot jail.
Add support for ZTE CMDMA MSM modem from qualcomm to the ubsa(4) driver.
64-bit fix in ld.so(1).
Added Corege CG-WLUSB2GPX to the list of supported rum(4) devices.
Refine the "netboot" interface group semantics to the interface we booted from, or if that is not known, the root device.
Make MP kernels work on sun4v-based sparc64 machines.
Updated zoneinfo code to tzcode2008a.
Updated the zoneinfo datasets to tzdata2008b.
Re-enabled lii(4) on amd64 and i386 GENERIC and RAMDISK kernels.
OpenSSH 4.9 released.
Enabled ELF loading on vax boot blocks.
Pad the lii(4) RXD buffer so packets are aligned on a 128-byte boundary. Prevents some hard locks.
Updated the xenocara xf86-video-intel driver to 2.2.1.
More sun4v work for sparc64 machines. GENERIC and RAMDISK kernels will now boot, MP kernels does work yet.
Fix for amd64 and i386 serial console handling for non-default speeds.
Enabled kate(4) on amd64 and i386 GENERIC kernels.
Enabled shared libraries on the landisk platform.
Make sgi machines drop user into ARCS interactive mode instead of rebooting if we fail to load the kernel.
Added kate(4), a new driver for AMD K8 temperature sensors.
OpenSSH bumped to 4.9.
Prevent boggle(6) from spinning if the tty goes away.
Plug a memory leak in the atascsi layer.
For xenocara, replace autotools based build by native BSD Makefiles.
Prevent crashes on macppc in pci_intr_map(9).
Have ssh(1) ignore ~/.ssh/rc if sshd_config ForceCommand is specified.
Make it possible to enable and disable pseudo devices in the UKC, config file and at config(8) -e.
Add it(4) at port 0x228 for amd64 and i386 GENERIC kernels.
Initial version of ifb(4), a Sun Expert 3D card driver. Not working yet.
Fix libMesa build on amd64 with XENOCARA_BUILD_DRI set.
In config(8), don't make a disable of a disabled device as a change, same for enable.
Make sftp(1) prefer POSIX style renaming over filexfer if the server supports it.
Add command in ddb(4) to show all mounts.
Make sure eeprom(8) does not abort walking the OpenFirmware tree if a node's content is too large.
Added AGP support for the Intel G33 chipset.
andl(4) enabled in amd64 and i386 GENERIC kernels.
Added the andl(4) driver to support the Andigilog aSC7611 sensor.
Added support for DIOCRLDINFO, DIOCGPDINFO and DIOCGPART to the fd(4) drivers.
Add ability to audio(4) to have different block sizes for play and record.
Raised the MAXUSERS constant for alpha,amd64,hppa and macppc.
Make ksh(1) ulimit able to get and set multiple limits in a single invocation.
Fix VLAN tag info for re(4) devices.
Fixed race condition in mips64 exception handling.
In relayd(8), handle the case when Content-Length HTTP header is 0.
Make xenocara run fc-cache at the end of a "make build" to save time later.
Adapt maximum permitted MTU on pppoe(4) to the MTU of the connected Ethernet/VLAN interface.
Added NxN grid capability to boggle(6).
Enabled fins(4) on i386 GENERIC kernels.
Updated xterm(1) to rev 234.
Added a driver for the Fintek F71805F LPC sensors to fins(4).
Add all interfaces we netboot from to the "netboot" interface group.
Make sure the libc bcmp(3) returns 1 on a difference, instead of a casted number.
Better spl(9) locking for pppoe(4).
Fix for netstat(1) when given -I.
Fix segfault in libX11 when using XDM-AUTHORIZATION-1 keys for remote X11 clients over IPv6.
Fix bug in snmpd(8) when encoding powers of 128.
Added support for the IRZ MC35pu GSM Terminal to the uslcom(4) driver.
Removed KGDB code from sparc64 platform.
Fix df(1) so it can show larger values.
Add _SC_SYS_PAGES and _SC_AVPHYS_PAGES to sysconf(3).
New APIs for arc4random, one to fill a buffer with random numbers and the other to return a uniformly distributed random number without bias.
Widen statfs struct to support large file systems and to support statvfs(3).
Make agp(4) attach at vga(4) instead of pchb(4).
Have syslogd(8) do waitpid(2) in a loop until all children are gone.
Timing fixes for sensorsd(8) so time always goes forward and so reports don't get duplicated or lost.
For snmpd(8), implement the hrSWRun portion of HOST-RESOURCES mib.
Make GENERIC.MP work on the E10000 sparc64 machines.
Support the old-prom XVideo board on the sparc platform by rewriting the sbus range registers.
Various CMSG related fixes in the network applications.
Improved the IP ID and named(8) shuffle code initialization to a single forward pass.
Better lladdr generation from tv_usec in cdce(4).
Only allow pppoe(4) interfaces to be attached to Ethernet or Vlan interfaces.
Make sure acx(4), atw(4) and pgt(4) do not increase the input packet counter erroneously.
Attach prtc(4) on sparc64 if no real-time clock was found.
For sensorsd(8), allow a program invoked on state change to receive sensor status.
Added a __data_start symbol to all ELF architectures to consistently mark the beginning of the writeable sections.
When running nfsd(8) without arguments, make sure 4 servers on UDP are started.
When attaching a cdce(4) that lacks a proper mac address, use tv_usec from getmicrotime(9) to create one.
For audio(4), correctly set high water mark to the buffer size.
For PPPoE, return the relay-sid in the response, if one was received.
Fix infinite loop in snmpd(8).
Prevent mvme68k boot media from using instructions the 68060 does not support.
Turn on keep-alive by default in ftp(1).
Implemented a partial HOST-RESOURCES-MIB for snmpd(8).
Fix NULL dereference in ifstated(8) when config files refer to undeclared states.
Enabled ehci(4) on hppa RAMDISK kernels.
Added sun4v IOMMU hypervisor and virtual PCI host bridge code to sparc64.
Added proper repository locking in opencvs.
Prevent opencvs from sending "Directory" messages for arguments in remote setup if the specified files or dirs do not exist.
Add support for checkout/update -j on opencvs.
Sparc64 drivers for the virtual bus vbus(4), virtual real-time clock vrtc(4) and virtual console vcons(4) on sun4v.
Added UltraSPARC Hypervisor interface for sun4v to the sparc64 platform.
Make the firmware loader look in /mnt/etc/firmware as well, for the ramdisk installations.
Avoid infinite recursion in vi(1) on certain error conditions.
Make sparc64 check the status of OFW nodes, so devices which are disabled in the OpenFirmware gets avoided by OpenBSD.
Segfault fix in vi(1) for the "set nu" case when very long lines contain tabs.
Allow response to icmp6 node information when local hostname starts with a digit.
In the config(8) UKC> prompt, avoid request for input if 'lines' are set to zero.
Moved to 4.3-current.
--------
Changes made between OpenBSD 4.2 and 4.3
Fix the RX FIFO problem for re(4) devices, especially visible when using them at gig speeds.
ral(4) RT2860 microcode is now included.
Make the alpha CD ISO image contain a bsd.rd called 'bsd' to avoid need for PROM commandline options to get to the kernel.
On zaurus X11, remove SunPaste symbol from the Fn+v key combination to avoid xterm(1) from calling insert-selection() when v alone is pressed.
Move hppa bootblocks in memory so bsd.rd fits.
Work around NULL pointer dereference in the de(4) driver.
Allow 80 and 160 second timeouts in pkg_add(8) to help big updates.
Fix segfault in rcs(1) when trying to lock and unlock rcs files that contain no revisions.
Prevent the VFS layer from creating files with a NULL filename.
Added Atlantis Land A02-UP1-W54 to the list of supported rum(4) devices.
Fix use-after-free in the IPv6 rt_llinfo route handling code.
Added serial console handling for alpha, macppc and zaurus when installing.
Added Palm 700WX support to the uplcom(4) driver.
Fix for small modulo bias in the arc4random used for IP ID and named(8) PRNG.
While installing, keep a resolv.conf.shadow file around when restarting an install.
Include sigcode in core dumps, allows gdb to backtrace through signal handlers.
SECURITY FIX: Buffer overflow in ppp command prompt parsing.
A source code patch is available.
[Applied to stable]
For azalia(4), clear interrupts on detach, fixes interrupt storm on digital-only controllers.
For em(4) fiber adapters, return nothing when checking flow control status instead of reading the wrong values.
Fix for sf(4) watchdog handling, causing endless loops.
Allow dryruns (-n) to work properly in OpenCVS.
Make sparc64 sabtty(4) read and adopt the speed configured in OpenFirmware when it is the console.
Make sure OpenCVS will not overwrite CVS/Root files when given an alternate CVSROOT.
Make OpenCVS handle file permissions and owner properly, now you can update group owned files.
Replaced the IP ID and the named(8) PRNG algorithm with one based on a Durstenfeld shuffle.
Make sure audio(4) blocksize sticks when set explicitly by an AUDIO_SETINFO call.
Initial code for BCM5706/5708 fiber support in bge(4).
Prevent file races in the opencvs code.
Avoid creating ridiculously large core dumps when the stack memory map is fragmented.
Add an extension to sftp(1) to perform POSIX atomic rename operations.
Add support in pciide(4) for ICH8M SATA IDE.
Corrected the watchdog time code in em(4).
Fix segfault in gnu cvs(1) when doing checkout -c if there is an unknown flag in the CVSROOT/modules file.
Make diff3 report temporary file errors on stderr and not stdout.
Make awk(1) fail nicely instead of crashing for format strings containing '*'.
Added OpenCVS to the main build, installs as /usr/bin/opencvs.
Fix memory leak in snmpd(8) parser.
In bgpd(8), ignore and drop path attributes with a type code of 0, instead of sending an error back.
Make ftp-proxy(8) not pass quick when tagging so tags can be used later.
Add support for EPSON CX5400 scanner in the uscanner(4) driver.
Add support for Axesstel MV100H in the ubsa(4) driver.
Fix memory leak in the hw_cryptodev engine code of OpenSSL.
Make ppp(8) allow a range of baud rates similar to tip(1)/cu(1).
Added et(4) to amd64 and i386 RAMDISK_CD kernels.
Comment out lii(4) from i386 GENERIC, add commented to amd64 GENERIC.
Make rmail(8) support giant files by using ftello(3).
For compress(1), fix setting testmode when using both the -l and the -t flag.
64-bit fix in sdmmc(4).
Make sure the ip6_input code has a complete rthdr before trying to do m_copydata() on it.
Fix in xterm(1) so script(1) will not exit immediately when started inside an xterm(1) with vmin=0.
Make the bt code handle "QOS" L2CAP configuration request option.
Synced the netbt code with NetBSD.
Added vax install ISO image.
Fix in ld.so(1), use rounded-down address when changing memory protections on the GOT.
Prevent memory leaks claimed by ipw(4) firmware on "ifconfig down".
Add safety check in the libc regex code for allocset() failures.
Make bnx(4) avoid unaligned PCI config space accesses.
Allow all SSH2 packet types, including UNIMPLEMENTED to reset the keepalive timer.
Fix for macppc eeprom(8) command to handle multiple NULL characters within string-valued properties.
Support for new devices added to axe(4) and uftdi(4).
Added support for Corega CG-WLUSB2GL WLAN in the rum(4) driver.
Added I-O Data USBRSAQ5 serial device support to uplcom(4).
Fix in the xf86_video_intel driver for i830-based devices. Fixes crashes seen on ThinkPad X40s.
Fix sort(1) processing of numbers containing zeroes in -n (numeric mode).
Prevent possible free list corruption when malloc(9) sleeps.
Make sure fxp(4) 16-bit registers do not get accessed by 8-bit reads/writes.
Enabled envy(4) on amd64 and i386 GENERIC kernels.
Implement AK4524 input and output volume knobs and output mute switches on envy(4).
On amd64 GENERIC kernels, allow opl(4) to attach to cmpci(4).
Fixed return-rst for IPv6 in pf(4).
Reworked sgi device attachment rules.
Reworked libc free list handling to prevent cases where freeing memory requires memory.
Fixed a use-after-free bug in sendmail(8).
RELIABILITY FIX: Incorrect assumptions in tcp_respond can lead to a kernel panic.
A source code patch is available.
[Applied to stable]
Use autopolling for link status on bge(4) when it has link. Fixes input errors and might avoid firmware hangs on some cards.
Fix segfault in pstat(8) when called with -vT.
tda(4) enabled on sparc64 GENERIC kernels.
On sparc64, make tda(4) run the fans at maximum speed when about to enter ddb(4), in order to avoid overheating in case of a system crash.
Fix mbuf leak when receiving PPPoE packets but without any PPPoE interfaces set up.
Added support for the Intel ICH9 chipsets in the em(4) driver.
Add support for the optics on the Sun variant of ixgb(4) boards.
Added support for AnyDATA ADU-500A in the umsm(4) driver.
Change sgivol(8) to not require the -f option.
Add initial bits in bge(4) for fiber support with the BCM5714/15/80 chipsets.
Add support for VIA VT8237S south bridge in viapm(4)
Initial driver for wbsio(4), a driver for Winbond LPC Super I/O chips. Enabled on i386 and amd64 GENERIC kernels.
In isakmpd.conf(5), define default configurations for AES-192 and AES-256.
Remove wait instruction from mips64 cpu_idle_cycle, causes problems on RM7000 machines.
Better error reporting in mfi(4) when running out of ccb's.
Better support for 11b mode in bwi(4).
Switch pf(4) to RFC 1948 ISN generation.
Updated xterm(1) to version 232.
Reenable idle modes on powerpc.
Revert workq to pre-mutex state, fixes locking issues on alpha.
Make bwi(4) deal with 64-bit BAR such as with PCIe chipsets.
Implemented crypto support in softraid(4).
Better armish time base calculation for those who do not have very accurate clock generators.
Fix sparc64 so the interrupt handler does not get on the per-cpu list of pending interrupts twice. Makes usb keyboards work as console.
Make sshd(8) skip the check for being started with an absolute path when run with -t for configuration test mode.
Added authpf-noip for authpf(8) to allow multiple users to connect from a single IP.
Fix 4bit depth xserver for arches without lazy binding.
Aligned the stack gap for arches where stack grows upward.
Fix crash in OpenCVS when asking for status on an unknown file.
Fix for mkdir(1), to better support systrace(1) and mkdir -p.
Upgraded X11 Mesa to 7.0.2.
Initial driver for tda(4), controls speed of ambient and CPU fans on sparc64.
Make the install scripts adjust serial speed tty entry if no console is enabled while installing.
Better cache handling in the SGI pmap code.
Upgraded xf86-video-intel to 2.2.0.90 in the xenocara tree.
Make the TCP input code take the window size into account from the first ACK packet.
Fix in relayd(8) dns protocol handling.
Added support in relayd(8) for making snmpd(8) send traps when the state of a host changes.
Added support for PERC6, aka LSI SAS1078 in mfi(4).
Fixed watchdog timeouts on gem(4).
For sparc64 ebus(4), attach the lom-console, hopefully providing a proper console on Netra T4/Netra 20 when the console is redirected to the LOM.
OpenCVS now makes sure not to allow commits to files that have a sticky date set.
Delay tilde expansion in sshd(8) for ChrootDirectory until user is logged in.
Fixed date parsing on date tags set in CVS/Tag or CVS/Entries.
Extended support for -D in OpenCVS, writes CVS/Tag and CVS/Entries properly now.
Add 64-bit physmem and usermem entries to sysctl(8), and make sysctl(8) print out these values for hw.physmem and hw.usermem.
Added date support for OpenCVS annotate.
Fix memory leak in snmpd(8) ber I/O engine.
Proper support for -A in checkout/update in OpenCVS.
Initial version of -D support for checkout and update, both local and remote, in OpenCVS.
Add sshd_config(5) ChrootDirectory option to chroot(2) users to a directory and tweak internal sftp server to work with it.
Fix setting of recording parameters in auich(4) when configuring for full-duplex.
Make arp(8) default to -na when called with no arguments.
Added -o flag to pkill(1) and pgrep(1).
Enable DMA in the wd(4) driver for 1-sector devices (most flash devices).
Add support for 'co -c' in OpenCVS.
Improved add in OpenCVS, now has fixed server-side adds, support for add in branches and does not add files in N-tagged directories.
Make sure OpenCVS puts a 'T' in front of sticky tags in the CVS/Entries file.
Fix possible memory leak in isakmpd(8) when sending Phase 1 IDs.
Move carp(4) to a simpler configuration scheme. This change also allows for IPv6 NDP balancing. Check your carp setup if you use balancing, this is a flag day.
Enabled ACPI 3.0 for amd64 and i386 machines.
Change the way netstat identifies which connections to hide when used without -a.
Prevent the "ttflush write failed" panic in mg(1) when resizing a the window.
Linked sftp-server(8) into sshd(8).
OpenCVS also supports the -i flag now and the -n for checkouts to control execution of programs in CVSROOT/modules.
Added support for the -k flag in OpenCVS for all commands that support it.
Add PCI ids for 82571-based em(4) devices.
Add support in msk(4) for 88E8075 and a second 88E8055 chipset, and initial support for the Marvell Yukon Supreme ASIC.
Added support for basics of -d support in OpenCVS.
Added rdiff support to OpenCVS.
Map sparc64 pcmcia window little-endian as MI code expects.
For pthreads(3), relocate the internal pipe file descriptor if newfd collides with it.
Initial CVSROOT/modules support in OpenCVS.
Make it possible in xenocara to build DRI support.
Make authpf clean anchors recursively via ioctls to properly clear the users anchors even then anchors are nested inside it.
Enable filter_opts in pf.conf(5) to be used on anchors.
snmpd(8) added to the generic build scripts now.
For all routing daemons, make sure confd's are not leaked on malloc failure in the control_accept() function.
Make bge(4) recognize BCM5755 C0 ASIC revision devices.
Make the brgphy(4) recognize BCM5722 PHYs.
Improved softraid(4) crypto performance by avoiding unnecessary context switches and decrypting only once.
Prevent segfaults in relayd(8) on certain syntax errors in the configuration file.
Add support for VIA VT8237S SATA in the pciide(4) driver.
Make sure relayd(8) frees up resources on parsing failures, since reloads might keep the daemon alive afterwards.
In pthreads(3) code, make sure stack is properly aligned for code that uses SSE2 instructions.
On ntpd(8), reconnect the client socket after three consecutive failures. Allows for recovery after an IP address change.
Fix in pfctl(8) for automatic tables generation in the rule optimizer.
For mfi(4), sync DMA memory back to CPU on poll failure.
Added support for some additional VIA C3 cpus.
Prevent USB network devices from generating page faults on removal while holding open bpf(4) handlers.
Move softraid(4) to use 16-byte commands, allows for >2TB disks.
More work on supporting raid 0 in softraid(4).
Finished the sparc64 beep(4) device by hooking it up to the ukbd(4) beep handler.
Extended the output of "show rib detail" for bgpctl(8).
For upgt(4), make monitor mode work again, and enable fast channel switching.
Added Y.C Cable USB-serial adapter to uplcom(4).
Fix double VOP_UNLOCK() in the VFS layer error path.
Fix in dumpfs(8) for FFS2 type dumps.
Add Fujitsu PRIMEQUEST 10GBASE-SR LAN Card to the list of supported xge(4) devices.
Make disklabel editor use 64 bit math to hold partition offsets when calculating offsets and sizes of free chunks.
Update sudo(8) to 1.6.9p12.
Add shutdown hook to upgt(4) which resets the device when called. Fixes re-attach issues when rebooting.
Make sure sftp(1) ACKs all issued requests when a remote write error occurs during upload.
Make sftp(1) use as many file descriptors as we have available, instead of fixed limit at 100.
Added support for SMC SMCWUSBT-G2 devices to the uath(4) driver.
Allow upgt(4) users to set fixed rates, but send all management frames at DS1.
Fix SGI boot time interrupt storm on mec(4).
Fix in sftp when uploading a filename with glob metacharacters in the name.
Initial code for softraid(4) raid level 0. Not done yet.
Make ssh(1) use 64 bit math so it can hold the maximum useful rekey limit. (2^32)
Fix bug in ssh(1) where it could listen to both v4 and v6 when forwarding ports using -L, despite having set 0.0.0.0 as a bind_address.
Make sure ssh(1) hashes just the specified hostname when hashing individual hosts.
In sftp(1), fix remote handle leak on local file open error.
Fix file descriptor leak in ssh(1) on session multiplexing error path.
Make scp(1) -q imply "ssh -q" for the underlying connection, not just hush the progress meter.
Added upgt(4) to macppc GENERIC kernels.
Endian fix for upgt(4).
Added LED support to upgt(4).
Fix crash in dhcpd(8).
Initial driver for environ(4), a driver for the environment device found on Sun Enterprise machines.
Added an snmpctl(8) command to send traps to registered receivers using the imsg trap interface.
Fix RX queue stalling in upgt(4).
Add cast so myx(4) code compiles on i386.
Fix in ether_input() soft interrupt scheduling, causing delays for non-real devices like tun(4) on architectures where soft interrupts are executed immediately.
In snmpd.conf(5), allow optional per-trap receiver community, and restrict the receivers to a specified MIB.
Add basic snmpv2 support to tcpdump(8).
Fix in libc readpassphrase(3), use TCSAFLUSH instead of TCSANOW when turning echo back on so that there is no chance of output that was written but still pending to be displayed.
Fixes from X.org, Misc extension out of bounds array index, file existence disclosure, Xinput extension memory corruption, TOG-cup extension memory corruption, MIT-SHM and EVI extensions integer overflows and PCF Font parser buffer overflow.
Edit netstart(8) to execute rtsol(8) after trunk(4) and vlan(4) interfaces have been taken up, so they are taken into consideration.
Update upgt(4) firmware to 2.13.1.0, don't forget to update the firmware package.
Make xenocara build both the old i810 and the new intel driver and let X autoconfiguration code choose which to use based on the chipset.
Started working on an interface for snmpd(8) where userland applications may send an imsg to it using a socket resulting in a trap.
Work around i386 Intel BIOS bug where ACPI tables end up in a region marked free for use.
For sparc64 machines, make sabtty(4) adopt the speed configured in OpenFirmware when it is the console.
Enabled umbg(4) on sparc64 GENERIC kernels.
Add Dell SAS 6/iR to the list of supported mpi(4) devices.
Add support in xenocara for GeForce 8800 GT in the xf86-video-nv driver.
Lots of fixes for ac97(4) and auvia(4).
Enabled umbg(4) on Zaurus GENERIC kernels.
Internal disklabel now allows for 48 bits in 512 bytes units, resulting in max partition or disk size of 64 PB.
Fix building of alpha kernels with debug symbols by replacing STABS debug info with limited DWARF2 generated symbols.
For m88k machines, add a sysctl machdep.cputype to return the processor type.
Update xf86-video-nv to 2.1.6 in the xenocara source tree.
Improved error reporting in make(1) for parallel mode, and reorder jobs based on who did output last.
Fix for gem(4), makes onboard fiber device on Sun fire V880 work.
Make sure disklabel(8) will not allow users to use (a)dd or (m)odify to create 0 length partitions.
RELIABILITY FIX: A missing NULL pointer check can lead to a kernel panic.
A source code patch is available.
[Applied to stable]
Make dump(8) compute transfer rates using 64 bit arithmetics.
Add Broadcom 10Gb PCI id for BCM57710 devices.
Added support in OpenCVS for local and remote rtag.
Added some more Intel 10G PCIe entries for the ixgb(4) driver.
For OpenCVS, do not ignore files and directories due to patterns on the repository side. Finally enables a fully working "cvs checkout src", even though options might not work.
Make sure OpenCVS commands do not segfault on RCS files without head keyword.
In OpenCVS, add support for expansion of the Log keyword.
For hppa, allow multiple uark(4) devices to attach.
Endian fixes in snmpd(8).
Changed rc(8) and netstart(8) so pfsync(4) is not brought up before the working ruleset has been loaded.
Add a couple of USB devices to hppa GENERIC now that they are tested.
Add support in cmpci(4) for 4,6 and 8 channel playback and fix CMI8768-based devices.
Make the disklabel(8) (re)calculate command better in showing details of the free space it calculates.
Make Sparc64 V880 machines force serial console speed to 9600, instead of 115200.
Update sudo(8) to 1.6.9p11.
Update time zone data and code to tz2007k.
Fix kernel build for Sun4c based Sun machines.
Degrade msts(4) sensor state from OK to WARNING and CRITICAL after a ten minute period.
On SGI, enable raw keyboard for wscons(4).
Fix in xenocara Makefile for parallel make builds.
Make FFS code for disk block numbers 64-bit clean. Quota and statfs is still only 32-bit.
Updated xf86-video-radeonhd to 1.1.0 in the xenocara tree.
Add support for msts(4), the Meinberg Standard Time String format as a line discipline similar to nmea(4).
In xdm(1), set the resolution at which fonts in the login widget are rendered, and switch to Luxi TrueType.
Added SPARKLAN RT2573 to the list of supported rum(4) devices.
Mark vadvise(2) as obsolete, and remove its implementation.
Make sure m68k-based platforms do not leave an unused page after the kernel message buffer.
Add support for xserver on SGI and enable build for it.
Add -n flag to snmpctl(8) to dump numeric IODs instead of symbolic names.
Fix upgt(4) driver so it works on amd64 too.
Make ipsecctl(8) strip off trailing "/32" when address type is IPV4_ADDR, since isakmpd(8) will not accept it.
Make lii(4) read the hardware mac address.
Make sendbug(1) avoid mangling < and > in comments.
Make vs(4) on mvme88k use wide scsi commands.
Make named(8) use local zone files for localhost reverse lookups again.
Moved more of netstat(1) into reading values with sysctl instead of kvm.
In cwm(1), adjust the initial window placement with any geometry that would place the window at, or over the right or bottom edge.
Fix for sparc64 trap handling.
Fix page fault in upgt(4) which occurs when device is detached after a failed attach attempt.
Fix race condition in mkdir(1) -p that may lead to an erroneous successful exit status.
Tune TX descriptor to improve upgt(4) TX performance. Still some issues left to fix.
Make sshd_config(5) allow PermitRootLogin in a Match block.
Make both scp(1) and rcp(1) with argument "-p" assume "epoch" if they receive timestamps originating before epoch.
Make libc arc4random*() functions thread safe.
Enabled upgt(4) and lii(4) in amd64 and i386 GENERIC and RAMDISK_CD kernels.
Initial driver for lii(4), the Atheros L2 ethernet chip found on Asus eeepc.
Enabled gbe(4) and mkbc(4) on SGI GENERIC kernels.
Many improvements on gbe(4) for SGI, including 8 and 16bpp colour depths.
Make pf(4) "scrub max-mss" rule work correctly.
Update timezone data and code to 2007j.
Use correct packet maximum sizes for remote port and agent forwarding in ssh(1), prevents server from killing the connection if too much data is queued.
Make ssh(1) update the ServerAlive and ClientAlive timers even when receiving unimplemented or ignore messages from the other end.
Make the clock adjustment handle up to 5000 usec/sec offset.
Add missing length header check in spamd(8) when receiving sync packets.
Make sure NFS exported directories use the same chunk size as the underlying file system has for block size.
Remove last debug bit from m88k machines with a 88110 CPU, and do not force serialization of memory accesses any more. Brings huge speedups.
Teach hppa bootloaders how to boot 64-bit kernels.
Increase processor bus timeout on the MVME197LE boards, makes it possible to turn instruction cache back on again.
Reimplemented an m88110 floating point emulator.
When disklabel(8) is used with -E, implement "d *" to clear out all partitions, just like "z" does now.
Make ntpd(8) log if the drift file can not be opened or written to.
Fix POSIX mode bug in df(1).
Make sure the cardbus code will not panic if someone inserts a slot for which the support is disabled.
Updated sudo(8) to 1.6.9p10.
In relayd(8), implement statistics for redirections.
Removed an obsolete NFS kludge, improves performance.
Make sure net ioctls return ENOTTY instead of EINVAL for unknown ioctl requests.
Fix page fault in upgt(4) TX path.
Fix le(4) memory allocation on aviion machines.
New it(4) driver for amd64 and i386.
Add a power(4) driver for SGI machines, to shut down nicely if the sysctl(8) machdep.kbdreset is set.
Fix remaining cases of potential mfs problems with concurrent accesses.
Fix stack increment calculations in core dumps on hppa where the stack grows upward.
Initial driver for upgt(4), Conexant/Intersil PrismGT SoftMAC USB2.0 devices.
Disable the instruction cache on 40MHz MVME197LE boards due to instability.
Change vmstat(8) to use sysctl to gather information, and remove setgid kmem from it.
On SGI, make gbe(4) attach as the console if the graphical console is selected via ARCBIOS.
Fix login_radius(8) so a non-standard port name or number can be used.
snmpd(8) has an official PEN for OpenBSD now, 30155.
Sync xserver 1.4.0.90 into xenocara.
Implement sysctls to report IP, TCP, UDP and ICMP statistics, so netstat can use them instead of kvm.
Large update of ospfd6(8).
Fix for extra fan sensors on adt7460-based i2c-devices.
Fix "lls" command in sftp(1).
Fix usbtablet(4) for X.org 7.3.
Fix systrace(1) on HPPA by making sure arguments and environment is not stored in the space reserved for stackgap on machines where stack grows upward.
For macppc i2s-based sound devices, remove support for 8KHz sample rates.
On vge(4), remove unused HW VLAN stripping and tagging code.
Updated pixman to 0.9.6 in xenocara.
Make relayd(8) warn if configuration reload fails, instead of killing the daemon.
Make lcspx(4) attach to SPX option boards on VAXstation 3100s.
Enable Out-of-Order execution on 88110 CPUs.
In ral(4), fix automatic rate control on RT2860-based devices if the rate falls down to 6 or 1 Mbps.
Added mount_ntfs(8) to the alpha platform, and included support in alpha GENERIC.
Updated the BIND named(8) to 9.4.2.
Simplified the pool code in the kernel by removing the pool cache.
Make the i830 xf86 driver use XAA acceleration instead of EXA.
Make relayd.conf(5) consider the generic handler to be TCP-based, so you can use "protocol foo" without defining a type.
hoststated(8) gets renamed to relayd(8). Similar change for relayctl(8).
Unbreak snmpd(8) on 32bit architectures.
SMP fixes for mfs concurrent buflist access.
Make adt(4) also support sch5027.
In the atascsi layer, ask for write cache and read look ahead to be turned on.
Fix file descriptor/ssl leak in hoststated(8) SSL checks.
Make sure sensorsd(8) logs positive events with LOG_INFO instead of LOG_ALERT.
Add TRENDnet TEW-401PCplus cardbus to the list of supported bwi(4) devices.
Initial import of snmpd(8) and snmpctl(8), a lightweight SNMP implementation.
Make sure nfe(4) adapters are not in powerdown mode.
Work in progress for SMP on m88110-based systems. Boots multiuser.
Fix attach/detach issues with rt2860-based expresscard ral(4) cards.
Imported xf86-video-radeonhd into xenocara.
Added libGL DRI code to xenocara, not connected to the build yet.
Make puc(4) detachable.
For sppp(4), handle if the other end insists on a MRU of 1492, even if they should cope with 1500.
For mfs file systems, avoid out of bounds access at the tail end.
Allow USB serial number to be printed in verbose mode. Useful for hotplugd(8) users.
Updated sudo(8) to 1.6.9p9.
Beginning of a real floating-point exception handler for 88110 CPUs.
Reworked m88k spinlock code too, similar to i386 fix earlier.
Make sure pf(4) does not leak state if key allocation fails during add.
Fix null pointer dereference in the pf(4) ioctl code.
New 4965AGN iwn(4) firmware, 4.44.1.20.
Make pci(4) and ppb(4) detachable.
Initial import of DRM, direct rendering manager on i386, disabled for now.
Make owtemp(4) handle negative values from the sensors.
Simplify i386 cpu detection and always assume 386 CPUs are unknown and promote them to 486 instead of panicking.
Add a "restart wm" function to cwm(1).
Let hoststated(8) bump the current file descriptor limit to the maximum number for the login class.
When updating the timestamp on pipes, use getnanotime() instead of nanotime(), since it is cheaper and good enough.
Add a -d argument to pstat(8) to peek at values in the kernel.
Implement the amd64/i386 MP fix for spin at splhigh on sparc64 also.
In zyd(4), properly update the hardware multicast filter.
In ld.so(1), fix dlsym with special handles when called from an executable that has been linked without -E.
Removed old TCP_COMPAT_42 from the GENERIC kernels.
Initial support for SGI Graphics Back End gbe(4). Disabled by default.
Make carp(4) behave more like an ethernet interface when initializing the IPv4 interface address.
For xclock(1), invert logic in geometry computation in norender digital mode.
In bgpd(8), add prefixes (paths) that would cause routing loops to the RIB, but marked as not eligible.
For wd(4), enable read ahead and write cache if the disk claims it is supported.
Move amd64 spinning behaviour in line with i386 for MP biglock.
Add LSI PCI Ids for 1078 based Megaraid devices to mfi(4).
Added warning to gcc(1) for auto declarations whose size is not known at compile time.
Add new PERC6/CERC6 PCI Ids to the list of mfi devices.
In mbg(4), degrade the timedelta sensor if the clock is free running for too long.
Make libc popen(3)/pclose(3) thread safe.
Bump ciss(4) maximum cdb size to 16 bytes.
Added syslog logging to tftpd(8).
In cas(4), make Cassini+ devices work.
Move the implementation of the biglock into MD code. For i386, stop spinning at splhigh, and do not try to grab biglock when releasing it. Huge speed improvement for i386.
Re-enable pthreads(3) support in libGL.
Implemented a -C option to ftp(1) for continuing ftp, http(s) and file transfers.
New AGP code for amd64, re-added i965GM device and use correct major for the /dev/agp0 device node.
Relax MSDOS SecPerTrack limit to allow 64 instead of 63, makes iRiver Clix devices work.
Fix hardware cursor mapping in the AGP i810 code.
Make modload(8) use /dev/ksyms as a kernel file by default.
for wscons(4), ask the emulation code to hide the cursor when leaving emulation mode.
Make AGP attach as a device, makes more AGP bridges get detected and attached. Enabled on amd64 and i386.
Re-enabled softraid(4) in GENERIC configs for all platforms.
Move crypto threads to workq's, lets cryptoraid attach early.
Fake out the apm device node to switch between apm and acpi on i386.
Fix mount_mfs(8)/newfs(8) when mounting with a relative path.
Enable et(4) on amd64 and i386 GENERIC kernels.
Correctly set up TX descriptors on et(4) devices.
Add entries for Transmeta Efficeon CPUs.
Turn off COMPAT_35 in the GENERIC kernels.
Use ACPI reset methods for reboot on all machines where acpi(4) is available.
Make config(8) file directive accept multiple pathnames separated by '|'.
Make msk(4) detachable.
Added support for the Sigmatel codec id 7662 to the azalia(4) driver.
Updated xserver, xf86-input-keyboard, xf86-input-mouse, xf86-video-intel, xf86-input-void, xf86-input-vmmouse, xf86-input-acecad, xf86-input-magellan and xf86-input-spaceorb in the xenocara sources.
Updated inputproto, randrproto, renderproto, libXrandr, libXi, xrandr and Mesa in xenocara and imported xbacklight.
Make wsmoused(8) sleep increasingly longer while trying to get the mouse device from X after switching to console.
More fixes for make(1) when running parallel jobs.
Fix for large clock drift on some macppc models.
Updated libXfont to 1.3.1 in the xenocara sources.
Try a forced unmount if mount_mfs(8) is killed with SIGKILL.
Enabled PCIAGP on amd64 GENERIC kernels.
Early support for hotplug of sili(4) controllers.
Implemented scsi vpd page translation for fetching disk serial numbers in atascsi.
Make the atascsi layer claim SPC-3 when faking an INQUIRY.
Reimplemented the "mark" keyword in hoststated.conf(5), somewhat similar to pf.conf(5) tags.
Fix relay roundrobin mode in hoststated(8) when multiple hosts in a table are down.
Unify number and string reading in top(1) to make sure command line args and interactive use of "d" and "n" now also interpret "max", "infinite" and "all".
RELIABILITY FIX: A memory leak in pf can lead to machine lockups.
A source code patch is available.
[Applied to stable]
If the ntpd(8) drift file is missing, reset adjfreq to zero.
Disabled ipmi(4) on i386 GENERIC kernels.
Fix for panics when running "mt(1) rewoffl".
In hoststated(8), allow HTTP digest type be either MD5 or SHA1, determined by the length of the digest.
Fix for M88110 setregs() so binaries work to some extent on MVME197 machines.
Fix possible mbuf leak on error in the trunk(4) code.
Fix in pthreads, make the threaded version of vfork(2) actually use the system vfork(2) in order to retain the semantics, instead of calling fork(2).
Make sure cwm(1) default keybinding always exist. Additional bindings now overlap.
Make sure the kernel will not overwrite a core file owned by another user.
In hoststated(8), always enable "late connect" relay mode, if an expect or filter action has been specified.
Fix in acpimadt(4) for GENERIC.MP kernels where it would map ISA interrupts for which there was an override.
Add the Planex GW-US54GXS adapter to the list of supported zyd(4) devices.
Add support in pcidump(8) for dumping PCI config space in hex.
Fix "mount -a" so it continues to try mounting the rest of the filesystems even if a line refers to a non-existent mount point.
Updated the zyd(4) ZD1211B firmware, supposed to fix hardware reset problem.
For cron(8) and vipw(8), deal with unchanged files better, since new timers have finer resolution.
Fix stalls in nfe(4), by disabling jumbo allocator until low number of buffers case is better handled.
Fix false splassert warning during boot on m88k machines.
Make GPIO functionality available on AMD Geode LX CS5536-based machines.
Make sure to return the correct so_error instead of EINVAL if a non-blocking connect which has completed and failed gets called again.
Initial import of uticom(4), a driver for TI TUSB3410 usb serial devices.
Make sure the atascsi layer accepts ATA ioctls, so tools like atactl(8) work on disks behind the atascsi layer.
Enabled most acpi(4) functionality by default. If you encounter problems, "disable acpi" or "disable apm" and report the problem.
Initial import of a driver for the Ralink RT2860 chipset. Will attach as ral(4).
Try to get a working console on sparc64 when redirected to the RSC card on Sun Fire 280R/V480/V880.
Make i386 MP kernels use smbios to count number of CPUs. If > 1, disable apm(4).
Make sure the MS-DOS handling code reads 4k when reading the boot sector, help iPod nano file systems.
Do not call crypto_done() on errors. Fixes panics on crypto errors seen on reboots.
Add Marvell 88E8042 and 88E8072 to the list of msk(4) devices.
Make sure ldattach(8) does not set explicit com parameters for the tty, instead use the existing ones. Also do not artificially limit the baudrates.
Make sure wscons(4) on SGI machines compile ok and prevent it from stealing the console.
Fix clock drift on MP m88k systems.
Make an openprom(4) device file for the macppc platform.
Fix some amd64 problems with lazy fpu context handling.
Fix for i386 MP where interrupt time was always shown as 0%.
Make sure pf(4) does not leak pfstatekey upon insert conflicts.
For SGI macebus, add spurious interrupt detection, enables user to "boot poweroff" from ddb.
Make sure m88k dma_cachectl() flushes all processors unconditionally.
In OpenCVS, if a file has modifications in it when being updated, reapply umask.
Updated eso(4), now recording and setting block size works, and there is a master volume mute.
Add support for more multifunction Epson devices to uscanner(4).
Added umbg(4) to i386 and macppc GENERIC kernels.
Added umbg(4), a driver for USB attached Meinberg USB5131 DCF77 radio clock devices.
Allow -c in conjunction with -d (and -u) in uniq(1).
M88k now builds bsd.mp kernels.
Make sure m88k MP kernels grab the kernel lock when processing soft interrupts.
On sparc64 MP systems, use the interrupt stack as the initial stack for spinning up secondary CPUs.
Make the in-kernel disklabel code NTFS aware.
Add Exar UART XR17C152, 154 and 158 to the list of puc(4) devices.
Fix AML string parsing in the acpi(4) battery code, to better handle the invalid pointers aml_val2str() sometimes returns.
Prevent null-pointer dereference in pf(4) when empty groups are used in "set loginterface".
Fix potential heap overflow in perl(1), given a specially crafted regexp.
Make md5(1) properly exit with a result code >0 when encountering bad md5 in the checklist.
Close a race on sparc64 where the FPU state might be dropped to the wrong process in the IPI handlers.
Prevent panic in the arpintr() code if IF_DEQUEUE returns NULL.
Have make(1) simplify the way it deals with implicit rules and handle $<.
Add support for Epson multifunction USB devices, for the functions we do support.
Update time zone info to tzdata 2007i.
Avoid coredump in mailwrapper(8) when there is only one token on a line.
Prevent SEGV in top(1) on wrong sort name.
Better handling of OSS emulation when calling AUDIO_SETINFO and AUDIO_GETINFO at once.
Add support in mbg(4) for PEX511 PCI Express DCF77 devices.
Workaround in acpi(4) for late establishment of interrupts on GENERIC.MP kernels.
Fix in raid(4), where the disklabel reading to find raid components was causing hangs.
Cleanup in the audio(4) endianess conversion routines.
Remove the delay in top(1) when a command line argument is wrong.
In mbg(4), add support for the Meinberg PCI509 5V DCF77 time signal station receiver.
Make sure ATI-based ahci(4) devices do not cause a wdc(4) controller appear when running in IDE compat mode.
Fix lkm(4) for the amd64 platform.
Make sure spamd(8) clears the last entry from an empty TRAP list.
In the acpi(4) dsdt code, identify as WinNT in hopes the machine will present "better" AML, or at least better settings for machines that do not support _OSI.
Update named(8) hint file since l.root-servers.net has a new address.
Added ldattach(8), a command to attach line disciplines to a tty line.
Fix incorrect 'retry times' settings in zyd(4), and increase max RX size.
Fix wpi(4) and iwn(4) reset handling so the firmware does not panic. Also, fix ifconfig -M. Only works when the interface is down.
In make(1), mark nodes as made when there is no command around the target.
Avoid errno trashing in signal handler in ssh(1).
Prevent ssh(1) from getting data from getpwuid(3) clobbered by another getpw*() call.
In ssh(1), fix memory leak in the process_cmdline() function.
Updated sudo(8) to 1.6.9p8.
Lots and lots of work on make(1), including: optimized job runner which avoids forking the last command since it is running in a subshell, replaced parallel job buffering to deal with non-blocking descriptors, store list of errors during parallel make and print them on exit.
Fix potential panics on the arm xscale based platform by reusing cache cleaning address calculation.
In top(1), bump arbitrary limit on argument length shown by -C.
Add Admtek/Shantou ADM8515 to the list of supported udav(4) devices.
Prevent pf(4) from sending anything in response to blocked icmp packets.
Make sure sppp(4) does not potentially leak secret authname through ioctl() interfaces.
Workaround MP timeout/splhigh/scsi race at reboot on amd64/i386 using a delay.
Initial driver et(4) for the Agere/LSI ET310 ethernet devices.
Do not print the prompt in readpassphrase(3) when process is backgrounded and the input would not be read anyway.
Fix for list handling code in the bridge(4) code.
Fix for m88k when secondary CPU gets its interrupt pin stuck. Put the process it was running on the run queue again, unless it was the idle proc.
Fix setup of TX descriptors in the ath(4) driver.
In ssh(1), make behaviour identical for non-existent users regarding options set in the Match block.
Plug tiny mem leaks in ControlPath and ProxyCommand option processing in ssh(1).
Enable PCIe snoop for SB600 and MCP51-based azalia(4) devices. Fixes noise, looping and distortion problems.
On m88k, work around the fact that secondary CPUs are started late in the boot and sched_init_cpu() has to be invoked early. Lets MVME188 SMP systems boot multiuser.
Make sure m88k machines do not flag a processor as "alive" until it really is ready to accept IPIs.
Fix panic in siop(4).
Added envy(4), a driver for ICE1712 VIA Envy24 audio devices.
Prepare audio(4) for addition of the envy(4) driver, enable 32 bit samples and bump max channels to 12.
Let vic(4) attach to the virtual pcnet hardware in vmware.
Take the correct lock on m88k when handling userland data faults in kernel mode, lets bsd.mp run multiuser on SP boards.
Replace the carp(4) replay protection counter with a cookie.
Make sure compat errno mapping arrays go up to ELAST for all emulated syscalls.
Workaround for chip bug on ahci(4) based ATI IXP600 AHCI controllers.
Fix ring buffer overflow in the audio recording code path.
Fix file descriptor leak in the freetype library in xenocara.
Fix alignment issues on sparc64 when running tcpdump(8).
Improved vmstat(8) output, increasing the "fre" column and aligning memory and traps labels.
Fix probability rules parsing in pf.conf(5), and add support for 0% and 100%.
On E250 sparc64s, do not forget the channel number when reading environmental values off the sensor to prevent always reading from channel 0.
Make sure mips platforms enable interrupts when exiting ddb(4) if they were enabled before the break.
Update sudo(8) to 1.6.9p7.
Added support for command line "-D macro=value" to all routing daemons.
Change m88k system call invocation sequence to no longer pull arguments from stack, improves performance for all syscalls except mmap(). All m88k binaries must run against a 4.1 or more recent kernel.
Add support for power supply temperature sensors on the E450.
Fix logic in make(1) command-line / MAKEFLAGS parsing.
Move scp(1) network read/write into an atomicio()-like function to handle short reads, apply bandwidth limits and update counters.
Make sftp(1) do argument splitting and parsing so it can cope with common shell escapes and make handling consistent with sh(1).
Change the daily security(8) script to record package installation/removal.
Allow alipm(4) to be used for reading spdmem(4) info on sparc64, even if alipm(4) is not used for other parts.
Add support for the SUNW,envctrl as found on E450 machines.
Fix for temperature sensor conversion factors on E450 sparc64 machines.
Added support in uipaq(4) for the HTC smartphones.
In ssh(1), make sure that both the local and remote port are correct when parsing -L.
Make mips kernel options recognized from the boot command line in addition to the OSLoadOptions.
Add a broadcast mode to trunk(4), this mode sends all frames on all ports, and receives frames on any port.
Added support in hoststated.conf(5) for including other files.
Added pcidump(8), a utility to read pci configuration spaces.
Properly document decision weight of prefixes in the bgpd.conf(5) file.
Do not use next_tick() to start the clock ticking on sparc64 secondary CPUs. It fails from time to time.
Make the ddb(4) kernel debugger clears its output buffer on powerpc before it starts processing.
Make sure dhcpd(8) sets the max message size to at least the minimum IP MTU.
Make cs4280-based devices able to be brought back from power save mode if needed.
Add support for temperature sensors on the SUNW,envctrltwo device found on the Sun E250.
Replace DMA and interrupt handling in auich(4), fixes recording from the microphone input as well as full-duplex operation.
Add ShanTou ZT6688 usb 10/100 nic to the udav(4) device driver.
Make su(1) call setegid() before seteuid().
On sparc64, use HDL2CELL when passing OpenFirmware handles, makes bsd.mp boot on an E250.
Add support in hoststated(8) to schedule an immediate check through hoststatectl(8).
Fix in the VFS layer for possible spl() problems in the buffer cleaning daemon.
Add support for the Moosehead PS/2 controller found on SGI O2 machines.
In OpenCVS, avoid memory leak if a tag is defined in CVSROOT/config more than once.
Add some LED support to the bwi(4) driver.
Add support for the Intel ICH9 chipset to the pciide(4) driver.
Use TCSAFLUSH instead of TCSADRAIN in sudo(8) when turning off echo.
On sparc64 US-III cpus, spin up secondary CPU if running MP kernel.
Updated sudo(8) to 1.6.9p6.
Replacement for the pctr(4) codebase that can handle amd64 processors too.
On sparc64, make lazy FPU context switching work for MP kernels.
For top(1), properly handle terminals consisting of only a few lines.
Make rc(8) allow TCP NFS mounts too.
Fix in xf86-video-nv driver for G80 displays if BIOS leaves it stuck.
Allow ntpd(8) to report the status of peers and sensors to syslog.
Switch kernel arc4random routine to use different arc4 code and rework spl(9) handling so it goes to splhigh and back once per request instead of once per byte.
Fix stream reset errors on ALC883 based azalia(4) devices by waiting 40 usecs for the run bit to clear before performing a reset.
Add audio(4)-compatible mixer items for ALC883 in azalia(4).
Enable wbng(4) on amd64 and i386 GENERIC kernels.
Provide a way on macppc to attach spdmem(4) by faking an I2C bus with EEPROMs with content from OpenFirmware.
New wbng(4) driver for Winbond W83793G Hardware Monitor.
On sgi machines, disable timer/compare interrupts on the macebus(4), prevents interrupt storms on IRQ 6.
Add Planex GW-US54GD to the list of supported zyd(4) devices.
Add an "include" directive to pf.conf(5), and make sure the included file have the same strict permissions like the main configuration file.
Make sure hoststated(8) does not trash errno in the signal handler.
Remove unused kerberos authentication code from the NFS code base, and make sure we never generate a zero xid.
Add support for the BCM5906 bge(4) device.
Allow nmeaattach(8) to turn off timestamping by calling it without the -t option.
Add support for channel setting on newer Atheros AR5424 and AR2423 etc.
Added ospf6ctl(8), a controller for the recently imported ospf6d(8) daemon.
In bge(4), make BGE_JUMBO_FRAMELEN big enough to include a vlan tag.
Serialize usb(4) probing and attachments.
Enabled puc(4) on armish GENERIC kernels.
Fix for acpi(4), when walking the acpi tree to find _PRT methods, check whether device is actually enabled and functioning.
SECURITY FIX: The SSL_get_shared_ciphers() function in OpenSSL contains an off-by-one overflow.
A source code patch is available.
[Applied to stable]
Fix for macppc when using the new context switching code.
Reworked the context switching code to a more machine-independent design. Allows MD context switching without spls or locks, and sleep queue wakeup goes from O(n^2) to O(n).
In bgplg(8), limit the number of allowable characters in a request to prevent cross-site scripting issues.
Add support for RTL8211B PHY devices in rgephy(4).
Rework the azalia(4) debug dmesg to perform a more complete codec dump.
Fix range check for carp(4) vhid in ifconfig(8), vhid 0 is not valid.
Do not skip i2c scanning for IPMI machines, as done previously, but only use it for non-sensor devices like spdmem(4).
Add proper support for branch revisions in annotate for OpenCVS.
Make the OpenCVS rcs code properly resolve branches when given base revisions.
SECURITY FIX: Malicious DHCP clients could cause dhcpd(8) to corrupt its stack.
A source code patch is available.
[Applied to stable]
Make malo(4) work with trunk(4) also.
On arm, align the suspend save data to a cache line boundary, prevents issues upon resume.
Fix trunk(4) on 802.11 devices.
Fix segfault in OpenCVS when committing new files.
Enable spdmem(4) on alpha, amd64, armish, i386, macppc and sparc64 GENERIC kernels.
Added ospfd6(8), an OSPFv3 daemon to support OSPF for IPv6. Not useful yet.
Add support for 230400 bps speed in the uslcom(4).
Make spdmem(4) indicate if the memory module is registered.
Add amdpcib(4) driver for the AMD 8111 series LPC bridge and HPET.
Make spdmem(4) print CAS latency for DDR/DDR2 memory.
Added spdmem(4) driver for Serial Presence Detect memory information.
Add glxpcib(4) support in the i386 architecture for PCI-ISA bridge, timecounter and watchdog found in the CS5536 companion chip to the AMD Geode LX-800 processor.
Allow dhcpd(8) to operate the various pf(4) table actions independently.
Make the UFS dirhash code correctly allocate cleared memory, fixes edge cases.
Fix in hoststated(8) for non-SSL relays.
In eephy(4), disable fiber/copper auto-selection on the 88E1111 to work around some cards that in fact only have copper connectors.
Fix in azalia(4) for devices found on Acer TravelMate 3010.
Update libc date code and timezone data to tz2007h.
Make tcpdump(8) handle CARP over IPv6 in the printing routine.
In bgpd(8), when inserting blackhole or reject routes, set the gateway address to 127.0.0.1 / ::1 unconditionally.
Merge bwi(4) firmware into a single file, requires update of the firmware package to v1.3.
Added two new ioctl()s to the audio layer, AUDIO_GETPRINFO and AUDIO_GETRRINFO to help porting non-native audio applications and the OSS emulation.
Added libpixman to xenocara.
Make OpenCVS reset the default branch early, so rcs_head_get() does not return a possibly wrong revision as 'current'.
Make gdb(1) distinguish states saved by normal context switches and states saved by satectx(). Makes backtraces from kernel crash dumps work much better.
Merge xfs(1) 1.0.5 into xenocara, contains security fixes for heap overflow and corruption vulnerabilities.
Fix in grep(1) for patterns containing $ and ^ but not as the last or first char.
In libc, fix a libpthread panic regarding seekdir(3).
Added initial support for the Marvell PCIe Yukon FE+ Fast Ethernet chipsets to msk(4).
Fix for vr(4) to handle I/O accesses chipsets which do not have PCI power management capabilities.
Added new Intel E1000 and 10Gb PCIe PCI ids.
In bwi(4), fix 'bogus xmit rate setup' panic seen while associating with an 11b AP.
Add support for the high-resolution timer found in GPS170PCI cards to mbg(4).
Updated xf86-video-nsc in xenocara.
On i386, only call amd64_errata() on amd64 processors. (family 0xf).
Fix unaligned access in bwi(4) for strict-alignment architectures.
Updated libXaw, xf86-video-savage and xf86-video-nv in xenocara.
Make ospfd(8) always include interface IP address when printing the config.
Updated libICE and libX11 in xenocara.
Updated libXcomposite, libXrender, libxtrans and libXdamage in xenocara.
Fix two panics in bwi(4) on macppc.
Updated makedepend(1), libXxf86dga and xf86dgaproto in the xenocara source tree.
Make vnd(4) work on block devices.
Make startx(1) use /dev/arandom to generate the cookie.
Implement SNDCTL_DSP_[G|S]ETTRIGGER to the ossaudio(3) code.
In pf(4), add loginterface support for groups, and modify pfctl(8) to allow a groupname of "all" to see overall statistics.
Added automatic rate control (AMRR) to bwi(4).
Fix off-by-one overflow in SSL_get_shared_ciphers, backported from the OpenSSL_0_9_8 branch.
In hoststated(8), move SSL context creation to after privs are dropped, one more step towards graceful L7 reloads.
Cleanup in newfs_msdos(8).
Fix ep(4) packet header initialization.
Cleanup of the STAC7661 codec for azalia(4).
Make sppp(4) handle protocol reject packets, now that it has more than one protocol.
For ssh(1), when updating a key that already exists, update the properties instead of discarding them.
Fix emulated encodings in uaudio(4).
Update tht(4) microcode to SNIC 0xf. Fixes UDP reception issues.
Last piece for equal cost multipath support in ospfd(8). Enabled via sysctl(8).
Make split(1), authpf(8) and ppp(8) correctly handle empty strings returned from fgets(3).
Make route(8) obey rtable ID when doing "route flush".
First step in hoststated(8) for reloading layer-7 configurations, two new functions to load certificates while chrooted and with privileges dropped.
Add bwi(4) to amd64 and i386 GENERIC kernels, but disabled for now.
Add radio tap support to bwi(4).
Fix audioctl(1) returning bogus values for 'output_muted'.
Add support in OpenCVS to commit modified files to branches.
Make sure carp(4) code does not crash when dealing with multicast packets.
Fix crash in bwi(4) when changing media and device is up.
Fix atime updating issues in the file system code.
Properly handle physical address in bwi(4), now usable enough to ssh over.
Make sure OpenCVS overwrites the sticky directory tag if update is given -r, since -r gets priority.
Make sure OpenCVS does not litter /tmp with 0-sized files on the server when client sends info about a file that is up to date.
Add support in OpenCVS for checking out with a local repository already in place.
In tcpdump(8), when printing pfsync packets, print hexdump and not pcap header.
Add ASUS WL-138g to the list of supported bwi(4) devices.
Add mixer items, master volume and DACgroup init for Analog Devices AD1984 to the azalia(4) driver.
Make "mount -a" on sparc and sparc64 recognize Linux ext2 labels.
Add CrystalFontz CFA 635 to the list of supported uftdi(4) devices.
Improve parsing of .cvsrc and allow longer command arguments in OpenCVS.
Various fixes for the exphy(4) driver.
Make ixgb(4) and xge(4) use the proper baudrate for 10Gbit now that it can fit.
Update libXinerama, libXcursor and libXtst in the xenocara source tree.
Allow 4095 multicast group memberships per socket instead of 20.
In pf(4), allow state reuse if both sides are in FIN_WAIT_2 and a new SYN arrives.
Correctly track the E-bit of router LSA on config reloads for ospfd(8).
Make sure sendbug(1) do not treat dmesg lines with angle brackets <...> in them as comments.
Move ifmedia_baudrate to a 64-bit int.
Prevent out-of-bounds memory access in tempnam(3).
Implement the output_muted member to audio_info_t as found in original Sun audio.
Fixed memory leak in tail(1).
Updated xman, xmessage, xmodmap, xprop, xrbd, xset, xsetroot, xvinfo and xwininfo in the xenocara source tree.
Fixed a memory leak in bgpd(8).
Fix for nexthop issues in ospfd(8) when having multiple point-to-point links between two routers.
Various fixes and internal work on make(1).
Allow pulling USB sticks out with mounted FFS file systems on them without crashing or deadlocking.
Updated xcursorgen, xdm, xdriinfo, xgamma, xhost, xinit, xload and xmag in the xenocara source tree.
Lots of work on the bwi(4) driver.
Updated xconsole to 1.0.3 in xenocara.
Improvements in the common parser code generator for various OpenBSD daemons.
Plug memory leaks in the tail(1) command.
Add/sync AMD SB6/7/800 chipsets to the piixpm(4) code.
Add the NVIDIA MCP73 SMBus controller to the list of nviic(4) devices.
Add -n option to ntpd(8) for testing the configuration file.
Added annotate support to OpenCVS for local and remote repositories.
Make the i386 bootloader not complain about missing apm support.
Add an option to ntpd.conf(5) to compensate for a reference clock in ntpd(8) that is early or late.
Port the pctr(4) i386 performance counters to the amd64 platform.
Initial import of bwi(4), a driver for the Broadcom AirForce wireless devices.
Update setxkbmap, xcalc and xclock in the xenocara sources.
Fix for nfe(4), use a TX interrupt to clean up the DMA ring if IFF_OACTIVE is set when starting it up.
Undo zero-copy RX path for uath(4), it still has issues.
Similar 64 bit baud rate fixes for bgpd(8), ripd(8) and dvmrpd(8).
Some 64 bit fixes for netstat(1).
Move more of the baudrates in ospfd(8) to 64 bit counters.
Speedups in the kernel arc4 crypto code.
Updated bdftopcf, iceauth, ico, sessreg and mkfontdir in xenocara.
Add PLX 9016 to the list of supported puc(4) devices.
Fix STAC9221-equipped Mac master volume and mute controls by binding the DAC volumes in azalia(4).
Fix in azalia(4), CMI9880 should work now.
Improve cylinder group selection in FFS when creating new directories.
Make sure vnodes are locked before calling ffs_unmount().
Add support in iwn(4) for 802.11 headers with various sizes.
Fixes for mac68k interrupt handling.
Improvements in the iwn(4) sensitivity handling code.
Make sure cdio(1) do not skip the code which sends QUIT to the CDDB server and validate returned track names.
Add support in hoststated(8) for relaying DNS traffic. This adds an infrastructure to support UDP based protocols.
Fix crash in OpenCVS when parsing .cvsrc if an invalid cvs command has been specified.
Fix setting of multicast filter on ie(4).
Make sure azalia(4) tries 48KHz if 44.1KHz sample rate is not available.
Fix for cases where audioctl(1) would produce "set failed" errors on devices without master controls.
Various fixes in azalia(4) for chipsets which solves no-sound problems for codecs using the generic functions.
Make sure ptrace(2) cannot change any privileged bits in the Machine State Register on macppc.
Added support in OpenCVS for checkout -p with local repository.
Sync rcs(1) ident behavior with GNU RCS.
Disable page zeroing in the idle loop on SH-based machines.
Added thmc(4) to i386 GENERIC kernels.
Added uchcom(4) to alpha,amd64,armish,hppa,i386,landisk,macppc,sparc64 and zaurus GENERIC kernels.
New thmc(4) driver for TI thmc50/adm1022/adm1028-based devices.
Fix some false negatives in lint(1) when dealing with unreachable code.
Fix for uaudio(4) devices using signed mixer controls.
Update libXfont to 1.3.0 and freetype to 2.3.5 in xenocara.
Added adl(4) to amd64 and i386 GENERIC kernels.
Make bioctl(8) exit with a return code of 1 on error.
Add uchcom(4), a driver for WinChipHead CH340 USB serial adapters.
Fix OpenCVS so checkout/update -p works in both local and server mode.
Do not recalculate TCP payload length in pf(4), since it is already cached.
Re-enable interrupt coalescing on iwn(4), it now properly ACKs interrupts.
Fix in acpi(4) for the "multiple bus 0" problems.
Added support in OpenCVS for single file checkouts.
Make iwn(4) pad the first segment of a TX descriptor if needed to make the length a multiple of 4.
Added initial driver adl(4) to handle Andigilog aSC7621 devices.
Fix potential uninitialized memory access in the routing socket code.
Add "show sessions" command to dump complete list of relay sessions in hoststated(8).
Tweak heuristics in the speedstep code to better detect compatible Mobile Intel Pentium 3 as found on Dell c610.
Improvements in the PowerNow K7 power state code.
Add an unsolicited event handler for the Apple Sigmatel codecs. Now speaker and line outputs will mute and unmute on headphone presence.
Make ITM touchscreens return pressure as an absolute z axis in the uts(4) driver.
Make ksh(1) smarter when waiting for input for non-interactive scripts.
Fix temperature sensors on iwn(4) devices.
New iwn(4) driver for Intel Wireless WiFi Link 4965AGN. Needs non-free firmware (see man page).
Make trunk(4) do error checking correctly when packets enter a non-master interface.
For sdhc(4), do not try to disable bus power before setting the voltage on the controller.
Fix buffer overflow in cwm(1).
Update sudo(8) to 1.6.9p5.
Various internal changes in the qli(4) driver.
Fixed newfile() algorithm in split(1).
Add IPv6 support to the sppp(4) layer.
Make sure ksh(1) calls ERR trap before doing exit handling.
Remove compat link to /usr/sbin/vnconfig. It is in /sbin only now.
Add support in eeprom(8) for printing the derived tree from the OpenPROM, like "devinfo" and "prtconf".
Remove FPU detection code on sparc64, all ultrasparc CPUs have one.
Initial lmn(4) driver for lm93 sensors, common on IPMI machines.
Reset the sn(4) chip after internal memory exhaustion, makes the driver more solid with heavy NFS usage.
Add the ability in hoststated(8) to specify a host header when using http(s) methods.
In OpenCVS, handle Ctrl-D as a)bort in log message question.
Make the ssh(1) ConnectTimeout option apply to both the TCP connection and the SSH banner exchange.
Add support for chained SSL certificates in hoststated(8).
Make ssh(1) file descriptor code return an error rather than call fatal(), to make masters survive slaves failing to pass all stdio FDs.
Fixes for mips64 signal handling.
Change internal communication regarding routes to support 64 bit counters and routing table id in the headers of most routing messages.
Add __cxa_atexit() support to gcc3, provides support for shared object destructors called at dlclose() time.
Add memrchr(3) and recalloc(3) call to libc.
Make ksh(1) not fail if unsetting a non-existent variable.
In carp(4), make use of the preempt counter to signal number of transitions of any carp group to master status.
Add some more PCI ids to the mpi(4) driver.
Disable ROM search acceleration in uow(4) for now.
Handle quotation marks in .cvsrc correctly for OpenCVS.
Make sure OpenCVS logs the 1.1 revision as "Initial revision" instead of 1.1.
Add support for Alltel UTStarcom PPC6700 in the uipac(4) driver.
Add bthidev(4) bluetooth device.
Fix a use-after-free in the ccd(4) device driver.
Add VLAN reception support to vr(4).
Various fixes to xtsscale(1).
Delay IPMI sensor creation until kernel goes multiuser, removes annoying delay during boot.
Add qli(4) (qlogic iSCSI) initial driver, not usable yet.
Make sure uts(4) does not swap X and Y coordinates while in raw mode.
Fix lock ordering when updating mount points.
Remove old CVSROOT caching mechanisms in OpenCVS.
Make OpenCVS handle sending of multiline commit messages properly.
Add support in pf.conf(5) for address ranges like "from 10.1.2.50 - 10.1.3.75".
Make uberry(4) handle new pearl-style devices which now attach their SD cards as umass(4).
Add missing xfree() in the OpenCVS add code.
Add AfriNIC whois server to whois(1) so referrals are followed.
Make pf(4) send RSTs due to "block return" using the correct routing table.
Back out change in sppp(4) interface code, since the m_pulldown was not copying the header.
Add -I option to tcpdump(8) for printing the interfaces.
Make OMRON BX35F not attach as a uhid(4), since it is an UPS.
Fix for sparc64 dmesg when printing more than 2G of memory.
Update xterm(1) version to 229.
Move xenocara expat to 2.0.1.
Fix a bug leading to infinite recursion in the perl(1) AutoLoader(3p).
Add new configuration directive to httpd(8), RLimitNOFILE to set the number of open file descriptors.
Initial support for onboard Fast-Wide scsi on the 735 and 755 hppa machines in siop(4).
Remove need for hardcoded address of sti(4) on hppa. Makes C180 models work.
Add compatibility in X11 with the new XInput API.
Continued development of the nxe(4) driver.
Make pf(4) allow RST packets with th_seq equal to seqlo +-1. Reduces amount of 'loose state' messages.
Make banner(1) check the result code from fgets(3) and do a proper newline strip.
Make ssh(1) execute commands with $SHELL instead of /bin/sh.
Support for "Banner=none" in sshd_config(5).
Fix high-power charging on uberry(4) devices.
Fix in wpi(4) RX code path which could block incoming traffic, only seen when running without WEP.
Enable Xft support in xdm(1).
Update the time zone data files and libc time zone code to 2007g.
Make sure com(4) source compiles with KGDB enabled.
Fix in OpenSSL for CVE-2007-3108.
Add a -s option to sort(1) in order to make the radix sort a stable sort.
Make sure bbc(4) on sparc64 does not repeat the device name on attach failure.
Fix for sparc64 gdb(1).
Make sure pf(4) does not access th_flags when it isn't available.
--------
Changes made between OpenBSD 4.1 and 4.2
Fix in pkg_add(1) regarding package names.
Make sure sppp(4) aligns the packet after the ppp header, fixes use on sparc.
Add rlphy(4) to amd64 RAMDISK kernels.
Do not fill spamd(8) debug with bogus config errors if there are no traps.
Make ftp-proxy(8) add rules immediately after the client sends the PORT command instead of waiting until the client actually requests a transfer.
Update sudo(8) to 1.6.9p4, adds IPv6 support and improved man pages.
Add sti(4) at uturn on hppa GENERIC and RAMDISK kernels.
Make ssh(1) not fall back to the trusted X11 cookie if generation of an untrusted cookie fails.
Added nxe(4), a driver for the Netxen 10GE cards.
Work around problems on VIA CPUs when switching between FPU context and Padlock entropy polling.
Fix segmentation fault in tcpdump(8) when decoding 802.11 traffic in certain ways.
Remove unfinished nx(4) driver.
Add missing siop(4) at phantomas and uturn on hppa GENERIC and RAMDISK kernels.
Error out on passwd(1) if trying to change the YP password and the rpc.yppasswdd(8) daemon is unreachable.
Stop isakmpd(8) from complaining about not being able to read non-existent files.
Enable CF malo(4) for macppc GENERIC kernels.
Endian fixes for malo(4) in the association code path.
Be more careful on sparc64 when asking the openprom for the next property.
Fixed a DoS in httpd(8) where the server might terminate arbitrary processes.
Add event handler to malo(4), which allows for automatic reassociation after receiving a disassociation frame.
Make systat(8) also handle NULL when doing realloc.
Make btree DB code in libc handle NULL when doing realloc.
Make sure ld.so(1) does not get built and installed on NOPIC architectures.
Fix in httpd(8) mod_status module for CVE-2006-5752.
Prevent a potential null-pointer derefence on amd64.
Force xterm to legacy mode regarding Shift-F1 to Shift-F4, since the behaviour changed in xterm-225.
Add "dma" and "ledma" on sparc64 as buses again, makes Ultra-1 machines find their root disk.
Make isakmpd(8) check file type after fstat, since d_type is not passed over NFS.
Make sppp(4) use length of the mbuf instead of the packet when sending a protocol reject.
Make kqueue(2) correctly handle EOF on pipes.
Provide software HMAC for glxsb CPUs, so IPSec can use the crypto HW.
Make sure OpenSSH executes LocalCommand after the tunnel device is opened.
Bring vfs handling back to former performance levels.
Make malo(4) RX/TX work on big endian arches.
Disable XDCMP over IPv6 for now.
Fixed two issues in ospfd(8) regarding RIB calculation.
Add support on hppa machines for Zalon NCR 53c720 FW scsi.
Add support in siop(4) for non-PCI NCR 53c720/70-based devices in big-endian mode.
Enable Compact Flash driver for Marvell 88W8385 Chips on amd64, i386 and zaurus GENERIC kernels.
Fix crash in mkalias(8) for yp(8) when using specific malloc.conf settings.
Full HW WEP in malo(4).
Allow key exchange in isakmpd(8) with RSA signature authentication with peers who only send their certs in response to CERT_REQUEST.
Add AGP support for Intel i965 chipsets.
Fix crash in X11 savage driver during resolution change.
Add ne(4) on cardbus for sparc64 GENERIC kernels.
Added rbus to the sparc64 platform.
Make ddb(4) ps able to print full name of wait states instead of truncating them.
Fixed a potential deadlock when the pagedaemon waits for pages.
Add nvram(4) code from i386 to the amd64 platform.
Fix memory leaks and potential null dereference in ksh(1).
Add proper recording encodings to auich(4).
In netstart(8), move the delay for IPv6 DAD to after all interfaces have been started.
Retired the cats platform.
Stop making de(4) win over dc(4) on alpha machines, and include both dc(4) and de(4) on all installation media.
Fix for null dereference in column(1) when -t flag is given and a line consists solely of delimiters.
Lots of 802.11 improvements and code in preparation for WPA and other auth styles.
Make ksh(1) escape [, ] and ? as well.
Allow ftp-proxy(8) to add tag statements to the pf(4) rules it inserts.
Add code for auto association in the malo(4) driver.
Plug a mbuf leak in the malo(4) TX path.
Fixes for mixer handling on azalia(4).
Improvements in the malo(4) RX/TX path.
When setting a vlan device without specifying a tag in ifconfig(8), infer the tag from the interface name.
Make ln(1) warn when source and destination are identical.
Improvements in the way pcmcia based malo(4) devices get rates-element-id from management frames sent from certain APs.
Avoid segfault in ifconfig(8) when given an empty interface name.
Fix for isakmpd(8) cases where it could not get in-kernel last-used-counters in order to implement DPD.
Various improvements to make(1).
Add support on sparc64 for different styles on the bootpath so Ultrabooks booting off wd(4) can find their root disk.
Fix for random crashes on PA-8700 and PA-7200 hppa machines due to cache-line sharing.
Bring in GLw from XF4 to xenocara to replace the Mesa version.
Do not map sparc64 interrupts that already are fully specified. Makes onboard IDE work on Ultrabook 170/200.
Prevent PXE-booted i386 and amd64 machines from storing the MAC address in case root is supposed to be local disk instead of NFS.
Replaced a few malloc() calls with calloc() for safety in top(1).
Make powernow-k7 code use the ACPI _PSS table for retrieving p_state data.
Updated sudo(8) to 1.6.9p1. Note that environment handling differs from earlier versions.
Make it possible to show alternate routing tables in netstat(1).
Added an rc4_skip() function so you can discard bytes from the arc4 stream.
Make wpi(4) use hardware WEP in the TX path.
Add rl(4), ssio(4) and its com(4) ports to hppa RAMDISK kernels.
Enable thread support in libobjc.
Improvements in the cdce(4) driver, makes Sony Ericsson K610 and other devices work.
In ospfd(8), display multipath routes in "ospfctl sh fib" output if they exist.
Fix in make(1) where .for loops could give weird results.
Enable rl(4) on hppa GENERIC kernels.
Add 64 bit mips support to arla lwp code.
Added sk(4) to hppa GENERIC and RAMDISK kernels.
Enable lcd(4) on hppa GENERIC kernels.
Make sure pf(4) does not drop outgoing packets in case of a congested input queue.
Enable emu(4) on mips64 GENERIC.
Fix for hangs on i386 and hickups on mips64 when copying data out of /dev/audio with dd due to incorrect pointer advancement.
Fix for mips64 ddb trap handling.
Fix for re(4) MAC address reading out of the EEPROM for 9346 and 9356-based devices.
Backported a gcc3 fix (cse_end_of_basic_block).
Fix percentage computation of wrapping numbers in top(1).
Add a lcd(4) driver for the front panel LCD display found on the four-digit B/C/J-class hppa workstations.
Delay switching to the real serial console on hppa until we attach the serial device. Should make the second serial port on four-digit B/C/J-class machines work as console too.
Make sigreturn(2) set the proper space ID for the instruction queue. Fixed some more pthreads regressions on hppa.
Make sure encrypt(1) does not trim whitespace from stdin.
Fixes in delay constant calibration for mac68k on machines configured to use A/UX style interrupts.
Add bge(4) to hppa GENERIC and RAMDISK kernels.
Various 802.11 fixes.
Make the arc(4) driver use the full 64 bits when reporting sizes, now bioctl(8) shows the correct size for 2+TB volumes.
Add FFS2 support to quotacheck(8).
Prevent division by zero in the disklabel code if argument values are bogus.
Fix for emu(4) audio which was overriding the reqeusted encoding format.
Upgraded the wpi(4) driver to handle the new 2.14.4 firmware. Do not forget to update the wpi-firmware package.
Implement a -q option in bioctl(8) to query scsi disks for inquiry data like vendor, model, revision, serial # and so on.
Change SGI O2 LED behaviour so it is red in user mode and green while idling.
SECURITY FIX: Fix potential heap overflow in file(1)
A source code patch is available.
[Applied to stable]
Reduce optimization when compiling growfs(8) on m68k to work around compiler code generation bug.
Do not allow clustering reads for filesystem whose block size is smaller than the hardware page size. Fixes vnd(4) read problems on alpha and sparc64.
Make the PPP printing in tcpdump(8) support IPv6.
Various internal changes in make(1).
Enable "ifconfig -M" support for pcmcia based malo(4) devices.
Make sure both pthreads(3) and rthreads report the correct stack size and top.
Add support for Realtek ALC883 in azalia(4).
Thread fixes for hppa machines.
Update growfs(8) to support FFS2.
Fix for using poll(2) on audio devices.
Try harder on sparc64 to print the actual faulting address on SIGSEGV instead of the mmu tag word.
Various 802.11 code improvements.
Fix a really old bug in the socket code when passing M_NOWAIT to sblock().
Fix for the SGI ddb disassembler printing code.
sk(4) and skc(4) removed from first install floppy for i386.
Add FFS2 support to quot(8).
Removed the fe(4) driver.
Fix a "use after free" in the network interface code, when detaching an interface before it is removed from the multicast group.
In pf(4), fix ICMP rdr/binat corruption.
On hppa machines, mark ukbd(4) as console keyboard when appropriate.
In ipsecctl(8), allow proto ESP/AH in flow specifications.
Fix memory leak in the kernel sensors code.
In the tcpdump(8) 802.11 output routines, display payload for DS to DS and NO DS traffic.
Add pciide(4) on jmb(4) for amd64, i386 and sparc64 GENERIC and RAMDISK kernels.
Allow pciide(4) to attach to jmb(4) too.
Enable jmb(4) SATA on amd64, i386 and sparc64 GENERIC and RAMDISK kernels.
Fix potential crash on ISA-based lm(4) sensors.
Add gentbi(4) to sparc64 GENERIC kernels.
On hppa machines, reset PDC devices before enabling iova space if not on a serial console. Makes glass console on four-digit B/C/J-class systems work.
Make pfctl(8) accept "states" also, for the -s and -F options for consistency.
Bump the number of supported interrupt routing entries for hppa machines.
Update libc to tz2007f code base.
Add 802.11d command to the pcmcia malo(4) driver code.
Fixes for timeouts in the ugen(4) driver.
Make it easier in tcpdump(8) to spot which version of NFS the traffic is.
Add a SIGCHILD handler to identd(8) when running in background mode so it will not leave a zombie.
Fix for netstat(1) due to the IPX removal.
Add aliases "1" and "2" to "l" and "r" on sdiff(1) to make interactive merges easier.
Make tcpdump(8) handle overlapping data on 64 bit arches when decapsulating packets.
Fix for Intel errata AI91 in the i386 pmap handler code.
Make OpenCVS handle updates regarding remote files which have been removed from the repository,
Prevent checknr(1) from accepting zero-length strings for the -a and -c options, and fix a file descriptor leak.
Enable newfs(8) to create FFS2 file systems larger than 1TB. Note, work still remains.
On hppa, switch pciide(4) to native mode on ssio(4)-based machines.
Division by zero fix in fortune(6) for empty input files.
Fix for PC87415-equipped hppa machines in the pciide(4) code.
Fix a race condition in the pfsync(4) code during ruleset reload.
Fixes in the vframe handling for i386 trap code.
Make ath(4) devices use a O(log(N)) algorithm instead of O(N) for bit swaps.
Alignment fixes to kue(4).
Fix buffer overflow in lam(1) by increasing the file descriptor limit to the correct limit.
Rework the algorithm in scandir for estimating the number of directory entries.
Add support for rlog to OpenCVS.
Allow OpenCVS to ci -N<tag name> even when you have no changes, to match GNU behaviour.
Make the lm(4) driver support early W83627EHF-A chips.
Teach fsdb(8) and fsck_ffs(8) about 64-bit block addresses.
Crank the ifq_maxlen from 50 to 256, so it will match most interface rx rings.
Make com(4) on ssio(4) on hppa attach as console when appropriate.
Make the scsi(4) midlayer handle disk sizes above 2^32-1.
Expand disklabel(8) size/offset to 16 characters, and drop the Cyl comments.
Removed the vr(4) driver from i386 install floppy C due to space restrictions.
Make carp(4) use a masked destination network instead of the interface IP for the destination of the route belonging to the carp interface.
Update FFS1/2 time last written for cylinder groups in clusteralloc().
Add PCI-based malo(4) to alpha GENERIC kernels.
Extend SGI bus_dma(9) to cope with different views of memory. Allows for more than 256M RAM again.
For pfsync(4), reimplement interface bound states. Adds forwarding performance.
Make tcpdump(8) print leading zeroes in MAC addresses.
Fix case where a 4.2BSD partition falls partly within the area defined by the 'b' command in disklabel(8).
Add lpt(4) at ssio(4) for hppa GENERIC kernels.
On the SGI platform, make sure the IPL_CLOCK blocks device interrupts.
Make NFS bail out if the READDIRPLUS option is set on a v2 mount, since it is a v3 option only.
Make pf(4) allow "log" for NAT rules without "pass".
Make pkg_add(1) deal gracefully with absent packing lists, to make it easier to recover from disk crashes that leave /var/db/pkg half empty.
Add support for VIA CX700/VX700 IDE to the pciide(4) driver.
Add Novatel ES620 to the list of supported umsm(4) devices.
Add com(4) at ssio(4) for hppa GENERIC kernels.
Add a ssio(4) driver for the PC87560 SuperIO chip on hppa.
Add support in ospfd(8) for mapping route labels to AS-external route tags.
Allow ospfd(8) reconfigurations through SIGHUP too.
Ignore SIGHUP in bgpd(8) children to allow the use of "pkill -1 bgpd" for reloading.
Fix in the i386 pmap code for a possible AMD bug, which slightly speeds up TLB misses.
Make ifconfig(8) accept IPv6 addresses that use CIDR notation.
Prevent spin in ssh(1) by using poll() if the file descriptor is non blocking.
Handle azalia(4) interrupts for the record stream as well. Recording now works.
Disable memory above 256M on SGI machines for now, it triggers bugs as it is.
Make sure alpha (or SRM) designs accept level 3 interrupts for I/O, instead of the more commonly encountered level 4.
Simplified disklabel infrastructure, MBR handling is now machine independent to simplify hotplug media on most architectures.
Lots of internal work on package(5) tools.
Implement a 'keep-alive' option to ftp(1) that sends NOOPs over an inactive connection.
Enable iophy(4) for fxp(4) on hppa GENERIC and RAMDISK kernels.
Make gcc(1) regard INTMAX_TYPE and UINTMAX_TYPE as long long always, regardless of the size of a long.
Fix in dump(8) to prevent access to the wrong blocks.
Merge xterm(1) code with version 225.
Drop the current random timestamps and ISN generation code for TCP and replace both with a RFC1948 based method so TCP clients now have monotonic ISN/timestamps.
Make systrace(1) keep trailing slashes in path normalization, as they might result in errors otherwise hidden by systrace.
Fix crash in pf(4) where a IPv4 packet labeled with IPPROTO_ICMPV6 would be incorrectly handled.
Fixed a panic in the vic(4) driver.
Make sure netstat(1) does not truncate long interface names.
Update time zone data files to tzdata2007f.
Add "rtlabel" option to ifconfig(8).
Make tcpdump(8) print BGP communities in a nicer format.
Make the pfsync code compile if you remove the kernel IPSEC option.
Various enhancements in the disklabel handling code.
Swap xOrigin and yOrigin in the XRender rectangle clipping code.
Fix crash on shutdown in ospfd(8) in the vertex removal code.
Make ospfd(8) ignore updates that do not change the route.
Enable cookie support in ftp(1).
Allow IPv4 addresses be specified in ifconfig(8) with CIDR notation.
Make azalia(4) support the Macbook, Macbook Pro, Mac Mini and possibly the iMac.
Switch macppc to the interactive bootloader.
Fix a 10-year old bug in make(1) which was causing it to spin if given large -j values.
Add -K flag to ssh(1) to set GSSAPIAuthentication=Yes and GSSAPIDelegateCredentials=Yes.
Fix slave exit value in ssh(1) when control master goes away without passing the full exit status.
Make scp(1) try to skip FIFOs rather than blocking when nothing is listening to the other end of the socket.
In rcs(1), allow checkin without locking (after rcs -U).
In ospfd(8), when removing AS-EXT LSA, initialise the metric to a sane default.
Make dump(8) store old_atime and old_mtime too, when dumping FFS1 file systems.
Make ssh(1) send "window adjust" messages every three packets, and do not wait until 50% of the window is consumed.
Make top(1) clear to end of line at quit, needed for terminals that do not restore content on quitting curses mode.
Enable re(4) at cardbus for macppc GENERIC kernels.
Fix in pf(4) regarding pflog(4).
Better handling of old libraries in pkg_add(1).
Update the "nv" driver in X.Org to xf86-video-nv 2.0.2. Adds new chipset support.
Make disklabel(8) aware of new fields in the labels, allowing for larger than 2T disks, partitions and offsets.
In rcs(1), if strict locking is disabled, make file writable on checkout.
Add support in puc(4) for Digi Neo 8-port serial adapter.
Fixed memory corruption bug in the X.Org i810 driver.
New MAC algorithm available for data integrity in ssh(1), UMAC-64. About 20% faster than HMAC-MD5.
Fix for pfioctl() panics from the state - state key split in pf(4).
Enable reload support in hoststated(8) for layer-3 configurations.
Fix cylinder rounding calculation in disklabel(8) for those who wants to use all space.
Fix for vlan(4) to handle reconfigurations better.
Make the USB hub output shorter in the dmesg.
Make rm(1) unlink files with multiple links when using -P.
Major wpi(4) update, be sure to update the firmware file.
Big changes to libc and libpthread, various fixes and cleanups.
Make ssh(1) preserve context between packets, saving 2 hash calls per packet. Gives some 12-16% speedup for arcfour256/hmac-md5.
Enable channel switching on pcmcia malo(4).
On cold-start panics, make ddb(4) print out a few lines of backtrace, since the glass console might not work at this stage.
Various internal package(5) improvements.
Removed IPX support.
Unbreak tcpdump(8) 802.11 element parsing by using the TCHECK2 macro correctly.
Fix for apmd(8) when using auto-adjust modes. Cycle through 0 and 100 to make sure we are in a known state when starting up.
Make malo(4) RX path work on big endian machines too.
Add FFS2 support to dump(8) and restore(8).
Add a check for Intel Core CPUs with Scalable Bus Speed of 200 MHz.
Add support for ICH8M IDE in the pciide(4) driver.
Fix ssh(1) memory leak on error path.
Fix in the parser code for OpenCVS remote merging.
Enabled softraid(4) in GENERIC so people can test. Work in progress.
Add RX path to malo(4) and enable monitor mode.
Add infrastructure to allow hppa to have root on wd0.
Add Gude Export mouseCLOCK to the list of supported udcf(4) devices.
Fix for some Pentium 4 machines running in 64-bit mode and have EST, but with a different MSR.
Add paranoid snprintf calculation to avoid possible overflow in SSL session ID parsing in httpd(8).
In disklabel(8), add RAID to the list of partition types for which we do not prompt for a filesystem.
In OpenCVS, add support for local and remote branch checkout.
Make the VFS layer not request zeroed memory when allocating data regions for buffers. Saves a lot of memset calls when doing heavy I/O.
Establish interrupts for xlights(4) after checking the i2s subsystem, fixes a problem with Xserve G5.
Removed support for mounting AmigaDOS filesystems.
Fix for bogus PHYs seen on Marvell Yukon 88E8036 msk(4) devices.
Apply the "skip ipsec if there are no flows" to IPv6 too.
Add Intel pchb RND device support to amd64, same as i386 earlier.
Add Bluetooth drivers to GENERIC, not enabled yet.
All NFSv2 client to retry when getting ESTALE from the server, matches NFSv3 behaviour.
Add more PCI IDs to the list of pchb chipsets with a randomness source.
Make ksh(1) only process ENV when in interactive mode.
Fix in spamdb(8), prevents corrupt database if given an empty spamtrap address.
In softraid(4), fix redundancy for RAID 1.
Initial driver for the Myricom Myri-10G Lanai-Z8E 10GE driver, myx(4). Not working yet.
Make PowerNow-K8 on amd64 and i386 use the _PSS object from ACPI to retrieve p_state data.
Make bgpd(8) check the AS community number so nobody uses 65535.
Add Gunze USB Touch panel to the list of supported uts(4) devices.
Prevent autonegotiation with every address change on em(4) by only calling em_init if IFF_UP is set.
Bring em(4) flow control delay timer down to what it should be. Increases throughput.
Extend the Sun disklabel format to contain filesystem types. Allows for creation of raid partitions.
Add basic support for crypto(9) backed RAID C discipline in softraid(4).
Various package(5) tools improvements.
Major update to sensorsd(8). Smart sensors that provide status by themselves are automatically monitored and make WARN, CRITICAL and UNKNOWN statuses not being considered the same.
Import parts of the NetBSD bluetooth stack.
Make xlights(4) probe correctly on Xserve G5.
Fixes for the i386 and amd64 ELF32/ELF64 code. Allows i386 and amd64 boot blocks to boot both ELF32 and ELF64 kernels.
Add new kevent(2) filter type for timers, allows processes to create a series of oneshot or periodic timers.
Window fixes for cwm in the xenocara codebase.
Add demote support to ospfd(8), makes carp setups with ospfd(8) more reliable.
Fix for rip code in cdio(1) so it gets the size of the current track instead of the previous track.
Add support for CPU temperature sensors on Intel Core CPUs.
When forcibly mounting dirty filesystems, do not clear the "unclean" flag.
In hoststated(8), make sure relay processes do not start unless L7 balancing is needed.
Remove Token Ring support from the networking code.
Removed support for 80386 processors in the i386 platform code. 486 or better required from now on.
Another performance improvement in the networking code by skipping ipsec tag checks if there are no ipsec flows.
Add new check method to hoststated(8) which allow to run external scripts/programs for custom evaluations.
Fix race in softraid(4) sync code.
Added workarounds in the SHM code, fixes current opera with SHM.
Make i386 machines with APM not attach ACPI by default.
Improvements in the amd64 EST code for intel CPUs and support for CPU temperature sensors.
Update disklabel(8) format to support larger disks and partitions.
Make ldd(1) able to print dynamic linking information on libraries themselves.
New driver for the Sparc v215/245 front panel LEDs added to sparc64 GENERIC.
64-bit fixes in the softraid(4) code.
Move top(1) to use curses instead of hand-crafted redraws.
Another pf(4) speed improvement. Delay packet checksumming in the PF code until we are sure we need to send RST/ICMP error messages back, and only do it then.
Allow set-uid binaries to dump core into /var/crash if the sysctl(8) kern.nosuidcoredump is set to 2.
Remove support in boot for the long list of different kernel names to look for.
Removed unmaintained COMPAT_NETBSD code.
For fxp(4), nudge the interrupt coalescing timeout to 128 ms. Lessens the interrupt load on busy fxp(4) cards a lot.
Small steps towards hoststated(8) reloads.
Fixes for the softraid(4) disk assembly code. Not usable yet.
Improvement in the memory pool handling code, removing time from the pool header leads to better packet rates.
Add a global-wd-mode command to mg(1), which toggles between the current and the old behavior of one global working directory.
Enable interrupt holdoff on DP83816 sis(4) chips. Significantly improves performance of such devices under load.
Allow bgpd(8) to match on communities using 0 in the AS path.
Large performance improvement for pf(4) by keeping information previously stored in a mbuf tag in the mbuf header directly.
Fix for sparc64 machine dependent code for autoconf, fixes panics seen on Sun v215 machines.
Add pcn(4) to the macppc GENERIC and RAMDISK kernels.
Make the internal random pool seed only from network interrupts, not once per packet due to drivers using interrupt mitigation more now.
Remove support for the old Archive/Wangtek cartridge tape driver, wt(4).
Lots of internal work on the various package(5) utilities.
Clean up NFS and the nfssvc() system call, and remove old non-working kerberos code.
Second step of making hoststated(8) reload checked in.
Allow hoststated(8) to specify table templates in the configuration file and to inherit them from multiple services or relays.
Completely rewritten ips(4) driver.
On hppa, dynamically allocate IRQs for PCI devices on elroy(4).
Enable ips(4) on amd64 GENERIC kernels.
Make pcmcia-based malo(4) devices work on big endian arches too.
Add additional truncation checks in tcpdump(8) when parsing and printing bgp packets.
Fix off-by-one in i386 bounce buffer allocator code.
Fix off-by-one error in the cvs(1) server code.
Link mount_vnd(8) to the build scripts, and make usr/sbin/vnconfig a link pointing to it.
Add tht(4) to sparc64 GENERIC kernels.
Add dynamic buffer cache to all platforms, instead of fixed amount of pages.
First steps to implementing reload support in hoststated(8).
Enable bio(4) on all platforms.
Initial import of a che(4) driver for Chelsio 10GE ethernet cards.
Add support in X11 to use the "W" axis for mouse and input devices.
Add re(4) to the sparc64 RAMDISK kernel.
Fix for macppc machines which boot off 2940 scsi disks.
Make mount_vnd a C program, in order to completely replace vnconfig(8) in the future.
Add cdrip and cdplay commands to cdio(1).
Protect against races in rthreads code when initializing mutexes.
Remove y2k hack in date(1), if no century is specified, use this one.
Make cron(8) handle SIGPIPE when writing to sendmail, allows cron(8) to run jobs when sendmail is missing or broken and will log a warning instead.
Rework TLB shootdown code for i386 and amd64, gives fairly large speed improvements.
Added skeleton implementation of Xwscons, a kdrive based X server for wscons dumb framebuffer mode.
Sanity check the time spec for touch(1), and if no century is specified, use this one.
Initial driver for Marvell 88W8385 PCMCIA malo(4) device.
Add support for W83627DHG hardware monitors chipsets in the lm(4) driver.
Fix integer overflow in the freetype lib for xenocara X11.
Improved partitioning and installation procedure for macppcs machines.
Make at(1) default to this century if not specified.
Add ZD1211B-based Edimax EW-7317LDG Wireless Detector / USB Adaptor to the list of supported zyd(4) devices.
Add code to spin up secondary CPUs on macppc, still work in progress.
Change dmesg printing of memory to MB instead of KB.
Enabled elroy(4) on hppa GENERIC and RAMDISK kernels.
Fix in pf(4) for pppoe f_addrhook panics.
Add BCM5709 SerDes to the list of bnx(4) devices. Disabled for now.
Add pciide(4) support to hppa GENERIC and RAMDISK kernels.
Prevent newly created interfaces from causing reload problems in ospfd(8).
In bgpd(8), only try to merge an AS_SEQUENCE if there is a difference between the 4-byte AS path and the 2-byte one. If they are the same length, just use the new path instead of trying to merge.
On TCP input when a partial ACK is received, check if congestion window is larger than acked bytes and update the window accordingly.
Make Logitech Quickcam Notebook attach to ugen(4) and not uaudio(4).
Enable uts(4) - USB touchscreen support on amd64 and i386 GENERIC kernels.
Add support for bluetooth adapter found on MSI S270 laptops in the ubt(4) driver.
Add support for hppa 8700/pcvw2 CPUs.
Ask hppa firmware for reset before trying ourselves, needed for four-digit b/c/j hppa models.
Improved i386 and amd64 PCI interrupt code to handle several levels of PCI-PCI bridges, fixes mapping for devices that sit behind two such bridges and the firmware only provides mapping for the first.
Add msk(4) to hppa GENERIC and RAMDISK kernels.
Initial driver for the hppa astro(4) and elroy(4) chips.
Add FFS2 support to ncheck_ffs(8) and clri(8).
Make bridge(4) mark packets with M_PROTO1 if gif(4) needs to use etherip encapsulation. Unbreaks remote ipsec bridges.
Handle extra open events in sppp(4) due to timeouts/retransmissions.
Add -f option to wsconsctl(8), to specify alternative control devices.
Added xtsscale(1), used to calibrate uts(4) touchscreens.
Add support for zmore(1) to be called as zless(1) too.
Add em(4) to hppa RAMDISK kernels.
Kernel option added for PCIAGP on amd64 which lets i945 chipsets work, but disabled for now.
Add aps(4) to amd64 GENERIC kernels.
Add a GENERIC.MP configuration for mvme88k, not usable yet.
Add xl(4) to hppa GENERIC and RAMDISK kernels.
Make xl(4) have a brief pause after reset for PIO too.
Add support for kernel crash(8) dumps for arm-based platforms, with minimal support in libkvm.
In newfs(8), do a bounds check to see if the inode table fits on the disk, prevents core dumps on really small filesystems.
Lots of work on package(5) tools, mostly internally visible.
Fall back to gethostname() on ssh(1) when outgoing connection is not on a socket, as in the case when ProxyCommand is used.
Limit buffer cache memory to 30% on hppa machines.
Make sftp-server(8) stop reading and processing commands when buffers get nearly full so it doesn't get into a fatal() error later.
In install(1), allow stripping of files even if the destination filename starts with a dash.
Removed unused catman(8).
Update the ifp of bridge cache entries if the entry is not static. This makes carp(4) fail-over work over bridge(4).
In systrace(1), do not assume 4-byte alignment of memory when intercepting a string.
Fix in bgpd(8) printconf for peers with the 'down' flag set.
Wait for the correct fd for dhcpd(8).
Improve dmesg output from setroot() so "rootdev=0x400 rrootdev=0xd00 rawdev=0xd02" becomes "root on sd0a swap on sd0b dump on sd0b".
Initial code for a sli(4) driver for Emulex Fibre Channel controllers.
Fix for msk(4) on MP systems, could cause reboots on heavily used machines.
More package(5) improvements.
Enable PowerNow on amd64 processors running MP kernels.
Prevent core dumps in tip(1) if strpbrk() returns NULL.
Fix for Yukon-2 based msk(4) cards, by taking alignment restrictions into account when setting up RAM buffer addresses. Makes FE chips work reliably.
Various internal improvements on the package(5) tools.
Disable xenocara OpenGL on vax and sgi platforms, and Xprt on vax and landisk. Makes xenocara build on vax now.
Fix in fsck_ffs(8) for the fifth pass, make sure we do not end up with a partially initialized info struct.
Make sure reboot(8) doesn't try to power off some machines.
Fix in pciide(4) when receiving unexpected interrupts. Fixes cdrom hangs on sparc64.
Fix potential NULL dereference in hoststated(8).
Make IPv6 kill all packets with the RT Header type 0 extension or multiple routing headers.
Make pf(4) drop all routing header packets too, unless the matching rule explicitly specifies 'allow-opts'.
Make each pointer/mouse device under wscons(4) have its own calibration values.
Rework ami(4) timeouts to handle the fact that they have no mechanism to take commands off them once submitted.
Disable loadable font modules for Xorg(1) on static-only arches.
Fix for mips64 when receiving hardware interrupts while CPU is in usermode.
Add POSIX compliant -g option to ls(1).
Bump isakmpd(8) crypto buffer logging to level 70 from 30.
Make sure all Phase 1 negotiation failures are logged in isakmpd(8).
Lots of internal work on the various pkg_* utilities.
Plug realloc memory leaks in cap_mkdb(1).
Make tcpdump(8) not fail on non-RH0 routing headers.
Fix SEGV in tcpdump(8) when parsing IPv6 packets with unknown or corrupted header options.
Add multiprocessor aware setperf mechanism to amd64.
Add support for FFS2 in dumpfs(8), and add -m flag to output newfs(8)-style commands to make a filesystem with the same settings.
Provide hook in ld.so(1) so rthreads can spinlock to protect from races.
Increase number of TX and RX descriptors in tht(4) from 64 to 128 and make tht(4) use TX checksumming in hardware.
Removed unused strcpy and strcat calls from kernel.
Make carp(4) routing table modification attempts exhibit routing messages to not confuse userland routing daemons.
Stop shipping CKSUM files for releases.
Move the setroot() for all arches to a clean machine-independent version.
Fixes for the vic(4) device.
Add config(8) file for macppc MP kernels. Not working yet.
Fix a panic on tun(4) on trunk(4) if ioctl() is called with uninitialized ifreq.
Enable support for more than 512M of RAM on mips64-based machines.
Reduce the IPv6 header nest limit from 50 to 10.
Enable fast channel switching for malo(4) devices, makes apps like kismet happy.
Fix in azalia(4) for a bug that prevented full device names from being printed.
Fix in bge(4) for BCM5754/5787-based devices.
Support for mtrr(4) on AMD Opteron CPUs.
Add event handler to the azalia(4) code to mute/unmute based on headphone presence. Also some fixes while there.
Add FFS2 support to tunefs(8).
STABILITY FIX: Fix a divide-by-zero in Xorg(1) which can be triggered by a malicious client.
A source code patch is available.
[Applied to stable]
Do not rely on interrupts being configured by the PROM on Sparc64 machines, makes Simics boot a bit further, and doesn't harm real machines.
Expose the nx(4) temperature sensor into the sysctl(8) hw.sensors framework.
Fix for link state announcements in vge(4).
If resolving a name fail for ntpd(8), be more aggressive retrying, but with care.
RELIABILITY FIX: Link state not correctly tracked in ospfd(8) and ripd(8).
A source code patch is available.
[Applied to stable]
Enable FFS2 support in the GENERIC kernels.
Add support in df(1) for reading ffs2 data directly from the device.
Lots of updates in the various pkg_* tools.
Fix in the softraid(4) code for older compilers.
Initial version of led_blink sysctl(8) for the landisk platform.
Make amd64 boot(8) process skip reading boot.conf(5) if the Control key is pressed during boot.
Add support in nx(4) for accessing the flash memory in the ROMUSB register area and read the board information on startup.
Support for CPU throttling on MP systems in apmd(8).
RELIABILITY FIX: Bugs in spamd(8) could corrupt the database.
A source code patch is available.
[Applied to stable]
STABILITY FIX: Incorrect spl level can lead to panics under heavy kqueue usage.
A source code patch is available.
[Applied to stable]
SECURITY FIX: Make sure IPv6 icmp code check return value from MGETHDR and fail if its NULL.
A source code patch is available.
[Applied to stable]
Import cwm-3 to the xenocara source tree and remove wm2 from it.
Fixes in pthreads(3) code for sizing the fd/fdp tables to help applications who increase nofiles using setrlimit().
Check for Control Key being pressed on i386 boot, and if so, skip reading the boot.conf.
Make ripd(8) inject a route for 224.0.0.9 on startup and remove it on exit, since it needs that route in order to work.
Make disklabel(8) always use the BIOS geometry if there is one provided.
RELIABILITY FIX: On PPC based systems, handle AltiVec assist exceptions better, fixes a panic under certain situations.
A source code patch is available.
[Applied to stable]
Add a setperf mechanism for ICH speedstep on some Pentium 3/ICH systems.
Enable tht(4) on amd64 and i386 GENERIC kernels.
Add capacity to add one ntp server during install.
Fix for alpha platform in the clock setting routines.
Fix endless loop code in tht(4).
Also apply PowerNow setperf fix to amd64.
Make init(8) power down the machine on power(4) button press instead of just halting it.
Prevent NFS send failures from logging, since they aren't helpful anyway.
Make the power(4) on sparc64 map registers in I/O space if memory space fails.
Fix for i386 SpeedStep/PowerNow state selection code, use number of states rather than the frequencies of the available states to distribute in the hw.setperf 0-100 range.
Make mount(8) also mount FFS2 filesystems when given the -a flag.
Add support in systat(1) for non-integral refresh intervals, possibly as low as 0.1s.
Fixes for command line parsing in join(1).
Make bgpd(8) and bgpctl(8) 4-byte AS compatible.
Switch alpha to new timecounters.
Add driver for macppc "System identifier" driver.
Rename the macppc LED driver to xlights(4).
Fix memory leaks in isakmpd(8).
Add ahci(4) to sparc64 GENERIC kernels.
Fix for ahci(4) on sparc64, prevents free panics.
Introduce an SMP aware hw.setperf mechanism.
SECURITY FIX: IPv6 type 0 route headers can be used to mount a DoS attack against hosts and networks.
A source code patch is available.
[Applied to stable]
Add driver for the macppc Xserve LEDs.
Increase the firmware upload delay for malo(4), since 100ms is not enough for some X40s.
Fix for the PHY selection code in gem(4), gets rid of duplicate PHY on SPARC64 Blade1000 machines.
Teach dumpfs(8) about the "updated" flag.
Make the vfs_cache not be O(n^2) in certain cases.
Update less(1) to version 382.
Add sili(4) to alpha GENERIC kernels.
Endian fix for the tht(4) firmware.
Added microcode to tht(4), since Tehuti allows redistribution of it under a 4 clause BSD license.
Plug memory leak in the xserver on client disconnect.
Make sure fsck_ffs(8) does not look for FFS1 alternate superblocks when checking a FFS2 file system.
In nm(1), fix a NULL dereference if the ELF symbol table size is zero.
Make Alpha machines fill in the hw.serialno sysctl(8) if possible.
Fix for newfs(8) when used with "-c".
Fix a double free in gif(4) mtag check loop.
Add support in ppp(8) for setting the address of the ppp peer.
Fix for acpi(4) docking code.
Add support in ftp(1) for proxies which require passwords.
Fix in newfs(8) for FFS2 case.
Fix debug info in acpi(4) code when docking/undocking.
Fix for wdc(4) drive detection, now detects certain microdrives plugged into Soekris boxes.
Initial import of a nx(4) driver for NetXen Inc multiport 10Gb and Gigabit ethernet cards.
Fix macppc OpenFirmware code to allow booting and having root on a USB device.
Initial import of the tht(4) device, a driver for the Tehuti networks 10Gb ethernet cards.
Fix in isakmpd(8) for vpn peers that start rekeying on port 4500 when NAT-T is used.
Fix for cas(4) on platforms where page size isn't 8k.
Make systat(1) exit on "q" like top(1) does.
For sd(4) devices that are unable to report geometry, change the fake geometry used to allow for even larger devices.
Introduce mount_vnd(8) and fsck_vnd(8) commands to support fstab(5) usage of vnd(4) images.
Add support in newfs(8) for creating FFS2 file systems. Make install media create FFS1 by default.
New timecounter code for macppc.
Fix panic in ath(4) when attaching to some IBM/Lenovo T42/T60s.
Allow more than one -t to md5(1) in order to accommodate faster CPUs.
Improved signal delivery for smp i386 systems.
Make date(1) use UTC instead of GMT0 when given "-u".
For hoststated(8), add a new relay "path" action to filter the URL path and arguments.
Enabled sili(4) on sparc64 GENERIC and RAMDISK kernels.
Add support for a fourth axis on wsmouse devices. Currently limited to USB mice.
New bbc(4) driver for the sparc64 BootBus Controller.
New pmc(4) driver for the NatSemi PC87317 SuperIO chip.
Add support in fsdb(8) for FFS2 also.
Add support in fsck(8) to check FFS2 file systems.
Another fix for msdos file system code, this time when renaming into existing destination.
Prevent infinite loop mapping interrupts on sparc64 Openfirware code when "reg" property is missing.
Next step in making ospfd(8) equal cost multipath aware, by making SPF calculation multipath aware.
Fix a vnode leak in the FFS code.
Fix out-of-bounds memory access in dump(8).
sili(4) enabled on amd64 and i386 GENERIC/RAMDISK kernels.
Enable ral(4) on sparc64 GENERIC kernels.
Add support for NCQ error recovery and NCQ command submission in the sili(4) driver.
Make file(1) recognize mp3 files with an ID3v2 tag.
Bring back i945GM support for xenocara.
Fixes in the pthreads code for file descriptors getting blocked when using fork(), causing deadlocks in the parent process.
In bgpctl(8), implement "show neighbor <peer> terse" to print all statistics in an easily parsable form.
Add a pidfile argument to pflogd(8) so individual instances can be rotated via newsyslog.
Make cp(1) try to create sparse files when copying blocks of zeroes.
bcw(4) driver under development removed.
Lots of work on the sili(4) driver.
Import the older i810 video driver into xenocara from the X.org version shipped with 3.9/4.0.
Update Sendmail to 8.14.1.
SECURITY FIX: Multiple security fixes for X.org applied.
A source code patch is available.
[Applied to stable]
For bge(4) on sparc64, prefer the local-mac-address provided by the PROM.
Improved heuristic for detecting SMP on old-world macppc machines.
Add Sun Fire V215/250 to the list of supported sparc64 machines.
Implement a DK INFO ioctl so userland may query scsi disks for product, vendor etc.
Fix for error handling when creating directories with long names in msdos filesystems.
Do not make mkfs(8) reserve space for bad sector replacement, since modern disks to it themselves.
Make tftpd(8) be more forgiving about tftp requests coming from 255.255.255.255.
Initial import of a driver for the sparc64 Host/PCIe bridge found on the Sun Fire v215/245/445 machines.
Have syslogd(8) retain the memory buffers on a SIGHUP if the syslog.conf(5) remains unchanged.
Make ccd(4) accept an interleave of 0.
Make an exception for the VT8521 SATA so ahci(4) wont attach to it, will revert to pciide(4) until it is fixed.
Enable acx(4) on macppc GENERIC kernels now that it works on big endian boxes.
Rework the prefixlen parsing in bgpd.conf(5) so filtering IPv6 prefixes finally works.
Fix bug in acx(4) HW DMA setup, makes TX work on big endian machines.
Add support in bgpctl(8) for "show rib community <community>".
For carp(4), do not pick up IPv6 link local IPs on address deletions.
Add base64 support to cksum(1) and friends.
Add Sierra Wireless Aircard 580 to the list of supported umsm(4) devices.
Fixes in tcpdump(8) for bus errors on sparc64 when dumping 802_11_RADIO packets.
First step of making ospfd(8) equal cost multipath aware.
Make ahci(4) attach devices based on PCI class and interface fields, not just on a list of pci devices. This will cause disks to change from wd* to sd*.
In ftpd(8), do not log when the slave gets killed because read() returns 0.
Implement support for the NOOP smtp command in spamd(8), and change the behaviour or the maxblack parameter.
Make sendbug(1) accept $VISUAL in addition to $EDITOR.
Added ahci(4) support to i386 RAMDISK kernels.
Synchronised carp(4) advertisements on group demotion to reduce group failover to a few milliseconds.
Add support in tcpdrop(8) for the 2-address format fstat outputs, also enhance IPv6 support by unpacking [addr]:port format.
Make ospfd(8) re-originate the router LSA if the interface metric changes so the change can propagate instantly.
Yet another buffer fix for ftp(1).
On amd64, allow compilation of kernels with MULTIPROCESSOR defined but with DDB undefined.
In ntpd(8), improve sensor polling interval to 30 seconds, just like ntp polls.
Add new flag to netstat(1) to restrict route display in conjunction with -r to routes in the same address family.
Replaced the shellscript sendbug(1) with a rewritten version.
Make httpd(8) not output the version numbers to silence confused auditing programs.
Fix wrong length check in ftp(1), previous version could ignore the "/" character.
Fix buffer overflow in ftp(1) when parsing the .netrc file.
Initial import of sili(4), a SATA chipset from Silicon Image.
Add HUAWEI Mobile Connect E620 to the list of supported ubsa(4) devices.
In dvmrpd(8), add code to parse unicast routes learned from route report packets.
Add support in mount_cd9660(8) for mounting arbitrary sessions.
Enable NCQ on ahci(4) based SATA controllers.
Make libevent use arc4random() when generating the random IDs.
ahci(4) enabled for i386 also.
Add support for RFC3137 in ospfd to allow Stub Router Advertisements.
Make pfctl(8) enable basic ruleset optimization by default.
Enable ahci(4) on amd64 kernels, only attaches to jmicron controllers so far.
Lots of work on the ahci(4) driver to get native support for some sata controllers instead of going over pciide(4).
Add support in hoststated(8) to specify a number of attempts to retry forwarded services.
Add support for playing simple RIFF file (.wav) to aucat(1).
Add delay to com_console so the fifo has time to flush itself before resetting, to avoid garbled dmesg output seen on some arm machines.
Add line-buffering flag (-u) to sed(1).
Remove force-PIO workaround for landisk using the pciide(4) driver.
Make the SH-based landisk platform default to writeback cache in the CPU.
Deactivate the pmap in cpu_exit, avoids quite a lot of TLB shootdowns in the reaper.
Update libevent to 1.3b, keeping local changes.
Luna88k LCD device is now controllable with the lcd(4).
Add FFS2 fields to the superblock, change fs tools to keep accessing the FFS1 fields.
Make sure the privilege separated daemons do not signal "connection closed" upstream when receiving EINTR or EAGAIN.
Move i386 to new timecounter code.
Improvement in the way nmea(4) takes the timestamp from the timedelta sensor when no PPS signal is available.
Initial import of a softraid(4) device, providing a framework for I/O manipulation. Disabled for now.
Add IP (v4 and v6) load balancing to carp(4), similar to the ARP balancing.
Add Sierra Wireless Aircard 875 to the list of known-to-work umsm(4) devices.
Enable pxammc(4) and sdmmc(4) on Zaurus RAMDISK kernels too.
Initial support for PXA27x SD/SDIO/MMC controller on the Zaurus platform.
Fix in locate(1) for filenames containing spaces.
Add OX16PC945K to the list of supported puc(4) devices.
Fixes in the signal handling code when waking up. This fixes the majority of the rthreads lockings and hangups.
Start USB1 initialization later, so all USB2 controllers have completed before starting USB1 legacy emulation.
Better delay handling for USB startup code, speeds up booting if you have lots of host controllers.
Fixes for hoststated(8) communication sockets, now shows relay statistics of all preforked processes.
Enabled wpi(4) on amd64 GENERIC kernels.
Make the upgrade script default to not fsck(8) non-root filesystems.
Added uts(4), a driver for USB touchscreens.
Add support in the alpha platform for a couple of new Alpha models, AlphaServer 1200 and 4100.
In tcpdump(8), make sure we recognise more vendor payloads in the IKE decoder.
Update bgpd(8) multiprotocol extension code to RFC 4760.
Make sure the distributed prefix has a metric != 0 in ospfd(8).
New timecounter code for the sparc64 platform.
Add PCI id for Intel's PCIe quad port fiber adapter to the em(4) driver.
Fix for UltraSPARC-IV CPU detection in OpenFirmware to prevent crashes.
Make sure the OpenFirmware node can be found on UltraSPARC-IV CPUs.
Fix in rcs(1) where multiple input files for ci would have flags from previous files affect the later ones.
Fix for pthread include file.
Allow nmeaattach(8) to start a sensor in the rc(8) scripts before starting ntpd(8) to give it time to cold start.
Do not delete greylisted entries in the spamd(8) database when whitelisting, they expire anyway and there could be a race when using -M and a retry comes in.
Fixes for ext2fs code.
Fix for acx(4) devices running in HostAP mode, solves problem of getting DHCP leases from the AP when the network is quiet.
Fix in sort(1) for very large input files.
Allow IP_TTL and IP_MINTTL to be specified in the hoststated.conf(5) to support GTSM according to RFC 3682.
Add quirk for Sony DSC-T10 umass(4) devices.
Fix for hanging or extremely slow "bgpctl show rib" commands in some cases.
Fixes for "hal" on ath(4) 5210, 5211 and 5212 based devices on big endian systems.
--------
Changes made between OpenBSD 4.0 and 4.1
Fix page fault trap in bcw(4) radio init code.
spamd(8) config files moved to /etc/mail, -g goes away - greylisting is the default. -b renamed to -l.
Make spamdb(8) error out if the -t or -T options are specified without -a or -d.
Fix for mbuf cluster allocations.
Handle requests with chunked transfer-encoding in hoststated(8).
Make hoststated(8) re-use the retry value from table host entries for inbound relay connections.
Do not enforce RLIMIT_FSIZE on vnd(4) I/O operations.
Fix memory leak in dhclient(8).
Add cas(4) to sparc64 GENERIC and RAMDISK kernels.
Add code to cas(4) to make receiving packets to work also.
Make systat(1) use the 1 line load from 'systat vm' on all other displays, giving them more room.
Make firmware upload work on BCM4318 bcw(4) devices.
Make bcw(4) count the number of cores better.
Work around a transmit hang problem in cdce(4) and make it count dropped packets as input errors.
Initial import of a Sun Cassini gigabit ethernet driver, cas(4).
Make hoststated(8) SSL proxy default to HIGH encryption, disable SSLv2 and disable anonymous DH.
Add support in hoststated(8) to specify the allowed cipher suites and SSL protocols, as well as some other smaller improvements to the SSL and networking code.
Change spamd(8) to include the HELO/EHLO identification string in the tuple key when greylisting.
More endian fixes for acx(4) on big endian systems.
Add a display for hardware sensors to systat(1).
Make pf(4) default to 200k max table entries if the machine has more than 100MB physical memory.
Some greytrapping improvements for spamd(8).
Add support for "Auto-Submitted: no" to vacation(1).
Add support for Winbond W83627EHF chips to the lm78 lm(4) sensor.
Fixes for multihead support in XF4 on radeon cards.
Make gif(4) altq(9)-aware, simplifies traffic shaping on gif(4) tunnels.
In pf(4), make urpf-failed work with multipath routes.
Make sure bgpd(8) does not try to set IP_TTL on non-INET listening sockets.
For amd64, enable ACPI interrupts in APIC mode.
Add Layer-7 functionality to hoststated(8), used for L7 load balancing, SSL acceleration, general TCP relaying and transparent proxying.
Make disklabel(8) always write the label to disk when asked, even if it appears unchanged.
In diff(1), defer printing of per-file diff header until after the regexp "ignore" processing has finished.
Make ACPI-enabled GENERIC.MP kernels work on systems that only supports PIC mode.
Fix to prevent syslogd(8) SIGPIPE race on restarts.
Make acx(4) firmware loading work on big endian systems too.
Boot console now only echoes certain characters and ignore the rest.
Make sshd(8) clear SIGARLM before restarting sshd(8) on SIGHUP, other the new process will get SIGARLM before the handler is set up and terminate.
Add GlobeTrotter 3G+ to the list of supported ubsa(4) devices.
Prevent the sd(4) scsi driver from unconditionally spin up SDEV_UMASS devices.
ACPI fix for hpet, makes bnx(4) work on amd64 machines.
Revert PAE pmap for now, stops freezes commonly seen on amd64 machines running in i386 mode.
BPF hook fix for etherip_input(), fixes tcpdump on bridged gif(4) interfaces.
Make sure sensors do not leak kernel pointers when sysctl(8) is copying out to userland.
Add PCI-based ral(4) to amd64 install RAMDISK kernel.
Implement code to allow syslogd(8) to log into another program's stdin.
In ssh(1), set the maximum packet and windows sizes the same for multiplexed connections as for normal connections.
Various bits to support pthreads on SH-based machines.
Fixes for rum(4), ral(4) and uath(4) to help them work on macppc.
Add support for building X11 on the landisk platform.
Initial import of atascsi code, a scsi to ata translation layer.
Add handling in pf(4) on skip steps for urpf-failed addresses.
Add support for ESP+NULL encryption for ipsec. Useful for traversing NAT where AH can't be used.
Make rcs(1) keep correct permissions when locking/unlocking file with ci/co.
Another fix for macppc shutdown code to prevent it from booting again after shutdown.
Add functions for getting EDID information from monitors to the vesa framebuffer driver. Currently unused.
Add support for ShanTou ST268 in the udav(4) driver.
Make sure vax read the disklabel sector before rewriting it, to preserve non-disklabel contents.
Add ACPI to amd64 and i386 install images.
In DDB, fix buf printing for 64 bit daddr_t.
Same checks for the i386 platform.
Add code on the amd64 platform to check for the AMD amd64 errata, and correct them where possible.
Add some axe(4) and uslcom(4) id's to the list of supported devices.
Enable malo(4) on macppc GENERIC kernels.
Restrict which flags ppp(8) can change when running over a tun(4) interface.
Fix to allow mv(1) to move files starting with a dash across file system boundaries.
Fixes for fsck_ffs(8) calculation of alternate superblocks based on the disklabel.
Fixes for multicast on PCI-Express re(4) devices.
For bridges using Spanning Tree Protocol, make sure topology change is propagated on all ports except the caller.
Workaround for cdce(4) USB host scanning if attached but not up. Will not send any packets until a packet has been received.
Added a small program to return sysctl hw.disknames so install scripts do not have a dependency on a clean dmesg to scan for disks and cds.
Add SIOCADDMULTI and SIOCDELMULTI ioctl handlers to pgt(4) and malo(4), without them IPv6 does not work.
GNU RCS removed from source tree, OpenRCS has replaced it.
Fix for grep(1) when using empty files as search patterns.
Fix 64 bit compiles for httpd(8).
More work on the cdce(4) driver for ARM platforms.
Fix a problem in mg(1) with wrapped incremental searches.
Make fsck_ffs(8) do some extra validation of the superblock, otherwise a corrupt superblock might lead to crashes.
Smarter _INI code to acpi(4), helps with some disappearing devices.
On i386, check the xPTR result of the CPUID test.
Check for some CPUID flags found on newer Intel processors in the amd64 platform code.
Avoid unnecessary resets on fiber based 88E8021/22 msk(4) devices.
Fixes for macppc power management to enable wake on AC loss.
Provide a libc internal interface to get random numbers for malloc without calling getpid().
Fix the hw.vendor/product sysctl(8)s on sparc64, handle the case where banner-name begins with "SUNW," and copy the platform_type buffer before chopping it up.
Fix for sparc64 __fpu_ftox() code.
In bgpd(8), switch address and AS fields in the mrt dump messages so source and destination match the actual traffic flow.
Various fixes in fsck(8).
Enable AES on AMD Geode LX CPUs. Used by OpenSSL, but not IPSec.
Fix a crash in ospfd(8) when redistributed routes were removed shortly after startup.
Move to 4.1-beta.
Add HP Proliant NC360T PCI Express Dual Port Gigabit NIC to the list of supported em(4) devices.
Make sure uvm code compiles with "option DEBUG".
Make mount(8) rely on the filesystem information provided by disklabel, and when there is only one usable partition on the selected disk, just mount it without asking.
Add support for fiber on the 88E1112 PHY.
Various fixes for I/O mapping and cache routines on the m88k platforms.
Add Dlink DGE-550T B1 to the list of supported msk(4) devices.
Add preliminary support for Marvell Yukon-II Extreme chips in the msk(4) driver.
Small improvement in i386 interrupt register load/dump.
Fix off-by-one in spamd(8) blacklist memory allocation.
Make readdir buffers depend on file system block size, rounded up to page size in libc and ld.so(1).
Improvements in the luna88k LCD device driver.
Allow pf(4) counters to be reset with DIOCGETRULES, so atomic read and reset counters is possible.
Add more hardware to the list of supported zyd(4) devices.
Plug memory leaks in fsck(8) which can occur when checking multiple file systems in a row.
Prevent vnconfig(8) from asking for a key when unconfiguring or listing devices.
Fixes for ipsec in IPv6.
In pf(4), compute IPv6 pseudo header checksum based on final destination as ip6_dst.
Fix for fsck(8) where a corrupt inode might lead to invalid dir sizes.
Add support for the Quantis USB random number generator.
Add more hardware to the list of supported rum(4) devices.
Fixes for nm(1) memory allocation and deallocation in elf_symload().
Add new "log (updates|all)" configuration option to hoststated(8).
Add -D option to hoststated(8) to define macros on the command line.
Fix for nm(1) so checks for st_name validity also check for overflow.
On macppc, enable arc(4) on GENERIC and RAMDISK kernels.
Add bio(4) to macppc platforms.
Define trap 0x81 for cache range flush on SH CPUs, needed for gcc(1) trampoline code and ld.so(1).
Make landisk get memory size from SH-IPL+g instead of hardcoded size of 64M.
Timezone code updated to tzcode2007a, adds support for 64 bit time_t if needed in the future.
Use new mutex for manipulating p_siglist in struct proc, solves problem with lost signals on MP kernels.
New mutex implementation for atomic operations.
Change behaviour of tun(4) on close. If auto-created, destroy on close, otherwise only mark as not running.
Make hoststated(8) inform hoststatectl(8) of ruleset changes and table syncs.
PCI space map fixes for kauaiata(4) on macppc.
Add zyd(4) to amd64 and i386 CD ramdisk images.
Make top(1) complain if user enters negative time specification for delay between updates.
Timezone data updated to tzdata2007a.
Introduced '+' interactive command in top(1) to reset all filters.
Two fixes for libevent.
Clean up unix domain socket on exit from Xorg(1) -configure.
Update sendmail to 8.14.0.
Stop OpenCVS from trying to parse empty lines as dates, saves lots of time.
Make bc(1) save and restore not only scale, but ibase as well.
Fix for spurious "i" partitions on newer iPod Shuffle devices with a FAT32 but without an MBR.
Enable all of the cache on 7751 landisk machines.
Plug memory leak in ftp(1).
Fix for gcc(1) on sh where it would clobber registers when __udivsi3 was issued through the PLT.
Add a new "accounting" variable to rc(8) to enable accounting, creating /var/account/acct if it does not already exist.
In vnconfig(8), make -c, -l and -u mutually exclusive.
On amd64, make sure signals to processes on other CPUs are delivered as soon as possible.
Add a monitor mode to hoststatectl(8) to continuously report changes in hoststated(8).
Make sure OpenCVS expands keywords before checking if a checked-out copy is the same as what is in the repo.
Initial version of reload support in ospfd(8).
In ospfd(8), send out an empty OSPF hello packet when an interface is going down, so that other routers will drop the session immediately.
Add support for [-k mode] in OpenCVS.
Do not throttle and serialize I/O operations on vnd(4) devices.
Fix for disappearing EST/Powernow when booting kernels with ACPI enabled.
In bgpd(8), do not check that the aspath is loopfree for the peer when sending updates. Fails when using AS 23456 as a placeholder for 4-byte ASNs.
Bump default openfiles-cur limit to 128 so firefox has enough file descriptors for most uses.
Workaround for the SD card reader where it stops responding after a card is ejected.
hoststated(8) linked to builds.
Make link state in trunk(4) report full duplex if it has at least two ports.
Make apachectl(8) pick up httpd_flags so restart and graceful does not try to start another instance of httpd(8).
Rework AGP memory allocation, so it does not try to allocate big chunks of contiguous memory in a loop.
Fixes for pckbd(4), allows oqo model 01/01+ to work.
Plugged small memleak in hoststated(8).
Allow the bnx(4) driver to make use of all available hardware multicast hash slots.
Add SSL support to hoststated(8).
Initial import of LCD device driver for luna88k.
Bump the fixed part of the stackgap to 2048 bytes, allows two full paths to be stored, needed by systrace.
Various fixes for vesabios code.
Make libpthread return ESRCH instead of segfaulting when a thread ID could not be found.
Make sure hexdump(1) does not access uninitialized variables and make it accept a leading 0x for the -n length parameter.
Add merging support to OpenCVS, both local and remote sides.
Enable transmit TCP/UDP checksum offload for bnx(4) devices.
Add an -S option to vnconfig(8) for specifying the salt file for -K.
Make OpenCVS add command support the -k mode.
Massive rework of the control imsg flow in bgpd(8), resulting in dramatic decrease of memory consumption op operations like "bgpctl show rib".
Workaround for em(4) interfaces on Lenovo X60/T60 laptops where the interface will fail to initialize if the link is down during boot.
Reduced memory usage in OpenCVS in server mode by immediately removing the temporary copy of a recently checked out file.
Add sensor to acpidock(4) to see if we are docked or not.
Update BIND to 9.3.4.
Plug a memory leak in OpenCVS remote code.
Make fsck(8) create lost+found directories with the same owner as the root directory, not the user running fsck(8).
Crash fixes in bgpd(8) by locking the nexthop while parsing an update.
Make ripd(8) and dvmrpd(8) and hoststated(8) ignore SIGPIPE in parent and RDE, needed to correctly report crashes.
Better handling of escaped CR-LF in hoststated(8) configuration file.
Fix "Device Busy" error in OpenCVS.
Introduced -Q option to pkg_info(1), shows all packages in $PKG_PATH which match the given query.
Prevent OpenCVS from doing a fatal exit when unexpected files are encountered in the working directory.
Initial version of acpidock(4), a driver for ACPI docking stations.
Improvements for cache handling and flushing on MicroSPARC-1 based CPUs.
Make scp(1) decide if progress meter should be shown by testing if stdout is a tty, not stderr.
Make sftp(1) report error when uploading write fails due to full device.
Make cdce(4) iterate over endpoints looking for appropriate interface descriptors to use. Makes certain adsl modems work.
In the NFS vnops code, do not assume our directory vnode will be flushed out, fixes crash when unmounting nfs volumes.
Add support in OpenCVS admin mode for the -A flag.
Add -Wstack-larger-than-X support to alpha gcc(1).
Make the st(4) SCSI Tape midlayer return values when receiving a MTIOCGET ioctl, allows things like Bacula to work much faster.
Prevent sparc64 schizo(4) panics on non-fatal iommu errors.
Move interrupt establishment in bnx(4) till after everything in the softc is set up and allocated. Prevents problems when the bnx(4) device is sharing interrupts with other devices.
Fix for OpenCVS when having CVSROOT on AFS or NFS.
Workaround for DMA HW errata on bge(4) PCI Express chips.
Make sure compress(1) only uses gzip when called with names like "gzip, gunzip, gzcat" and so on.
In pfctl(8), implement "-T expire", so you can expire all entries in a given table that are older than a certain number of seconds.
Allow kernels with TCP_SIGNATURE but without IPSEC to compile.
Add support for remote import in OpenCVS client and server.
Make ciss(4) handle situations where it cannot map physical drives into volumes.
Do not reinitialize sk(4) devices at every media change.
Add support for AX88772 based axe(4) devices.
Added support for remote checkout in both OpenCVS client and server.
Fix potential integer overflow in libc printf(3), when passing in very large values for the field width.
Fix for uvm, which should stop crashes in X11 startup seen after activities that exercise memory a lot.
Make the scsi layer report SDEV_UMASS devices as non-scsi when asked via SCIOCIDENTIFY. Fixes cdparanoia on USB CD devices.
Make em(4) drivers report flow control status.
Initial import of a power(4) driver for the Landisk platform.
Fix infinite loop in case nip6 and nicmp6 are not on the same mbuf.
Fix for chpass(1) -a handling when given an entry with an already existing user.
Shrink memory requirements in OpenCVS when dealing with very large trees.
Make OpenCVS reset sticky tags when using -A.
Fixes for ntpd(8) when using sensor time sources.
Add Philips SNU5600 to the list of supported zyd(4) devices.
Various fixes for option handling in dhclient(8) BOOTP and DHCP.
Match some additional devices in the zyd(4) driver.
Make sparc64 vgafb code not attach to Expert3D and Expert3D-Lite cards, these will require a different driver.
Do not keep entire file in memory in OpenCVS when sending or receiving it, fix memory leaks and remote update.
Major rework of the RCS api in OpenCVS, resulting in huge speedups and reduced memory usage.
Turn secondary CMMUs data cache on for luna88k to not hog the bus while they spin.
Move kernel virtual address space on sparc64 to make sure it doesn't overlap with physical memory on US3 and US3+ based machines.
Complete binary support for OpenCVS. Adding/importing binary files now works too.
Fix altq(9) support for mc(4) on mac68k
Add a few more video cards to mac68k.
Make user(8) compare against the username, so listing groups when given a numeric user id to userinfo works.
Add support for sti(4) on pci to be used as hppa console.
Add callbacks to enable and disable sti(4) rom. Allows dual-sti@pci setups work.
Make acpi assume the first cpu in the table is the boot processor, instead of the cpu with apic id 0.
Merge icmp4 and icmp6 in hoststated(8), and use real asynchronous events for checks.
Rework OpenCVS so it can deal with binary files.
Make FFS correctly deallocate dependencies when growing into an indirect block and failing to acquire a data block.
Make OpenCVS validate all options before connecting to the remote server.
Make dhclient(8) reject all packets with an option claiming to extend past the end of an option buffer.
Add flow control support to bge(4) and brgphy(4).
Upgraded BIND to 9.3.3.
Moved bnx(4) microcode to network byte order.
In ipsecctl(8), allow rule if there is at least one matching address family combination.
kue(4) microcode moved to network byte order.
hostated renamed to hoststated(8). Do not forget to update the passwd file.
When printing bootp option numbers, use unsigned chars in tcpdump(8).
Moved hostated(8) regexp interface to shell globbing rules instead.
Add Gigabyte GN-WI05GS adapters to the list of supported rum(4) devices.
Add support for HW TCP/IP checksum offloading on the nfe(4) adapters that support it.
Allow hostated(8) to use service names in addition to numberical port numbers.
Allow sasyncd(8) to use shared key specification in hex.
Add a generic send/expect check using regexps in hostated(8).
Add support for Leadtek Winfast TV 2000 XP in the bktr(4) driver.
Fix for gdb(1) to allow unwinding through sparc64 kernel trap frames.
Rework wscons VT100 emulation code to run in degraded mode if some of the non-vital dynamically allocated elements aren't available.
OpenCVS now accepts log messages from external editors.
Stop FFS from printing messages when switching between optimizations for space/time.
Preliminary support for the hp300 single ISA slot found in 4xx "t" models.
Updated bcw(4) for the new network byte order firmware file.
Fix for microcode loading so it becomes byte order independent. Will require that people update the microcode files.
Fix two memleaks in hostated.
Make bcw(4) understand combined firmware files, so we can have one instead of 15 files.
Make bgpd(8) not run rde_shutdown() unless bgpd(8) is started with -d.
Add support for OpenCVS "remove" in a remote setup.
Fix for OpenCVS client logging.
Add a 'g' command to top(1) to only show processes having a certain string in their command name.
Do not leak mbuf tag memory in the an(4), ath(4), atw(4), rtw(4), ipw(4), iwi(4) and wpi(4) drivers either.
Fixes for group handling in adduser(8).
Added support to syslogd(8) for continuous reading of syslog memory buffers.
Initial code for bcw(4) firmware upload.
Added better support for IPv6 hostname/numeric representation in the ipsecctl(8) parser.
Fix support for checking out binary files in rcs(1).
Fix keyboard problem for Intel Macs, where only first keypress is seen by boot.
Prevent mbuf tag memory leak on atu(4), ral(4) uath(4) and zyd(4) too, just like rum(4).
When creating an X11/Xorg config, do not force a Mouse section if none was found.
Make acpiec(4) be the first device to attach to acpi(4). Some systems require this.
Add support for -s state to OpenCVS.
Make rndc(8) create output files in /var/named/tmp, which is writeable by the 'named' user.
Make malo_init() check for firmware loading errors, and reset the card in case of an error, so later malo_init() can work.
Fix for mbuf handling on rum(4), fixes mtag memory leaks on armish platform. Same fix applied to acx(4), malo(4) and pgt(4).
Enable jumbo frames on msk(4), except for Yukon-2 FE devices.
Rewrite of eephy(4) code, allows auto MDI/MDI-X on various chipsets.
Add flow control to re(4) devices.
Fix for 802.11 WEP key buffer size when using non-standard wep keys >= 104 bits.
Added support for the Meinberg PCI511 and GPS170PCI-based mbg(4) devices.
Remove warnings about illegal prefixlength when a default inet6 route is present in route(8) and netstat(1).
Fix another problem with sparc64 US3 D-cache flushing, fixes problems with svnd(4) on such machines.
Add support for ST16C654 com(4) devices.
Add MC8755 to the list of supported umsm(4) devices.
A few more D-cache fixes for US3-based sparc64 machines.
Add code to change video mode on the fly for pnozz(4) on the sparc platform.
Switch ARM platforms to new syscall ABI. This is a flag day for binaries from before the middle of November.
Add "C" as command line argument to top(1).
Fixes for exception handling in gcc(1) for alpha.
Add support for ADT7475 in the adt(4) driver.
Make sure fxp(4) devices do not re-initialize the card every time the IP address changes.
Fix for inline x86/x86_64 asm in libstdc++.
Make sysctl(8) show more digits in timedelta sensors as the timedelta sensors become increasingly more precise.
Make tcpdump(8) print icmpv6 inside security header (AH/ESP).
Make non-autonegotiated 10BaseT and 100BaseTX work on msk(4).
For bnx(4), use the correct size when loading the RX/TX descriptor bus DMA maps.
Fix for mg(1) where inserting a file resulted in an incorrect line-number count.
Add column-number indication to the mg(1) status line.
Added a two-level sysctl sensor API.
For Ultrasparc-III machines, patch some crucial D-cache flush instructions and enable the cache.
Make sure the kernel only add sensors for NMEA devices if there was no error in nmeaopen().
Add special handling in URPF code to handle urpf-failed on carp interfaces.
Fix for Core 2 Duo X6800 setperf code where it would report invalid setperf MSR leading to a divide by zero.
Let hme(4) use the arpcom copy of the ethernet address so that updates to lladdr can work.
Add Avlab PCI 2S to the list of supported puc(4) devices.
Eliminate BSMAP #ifdef in mg(1), exposing bsmap-mode which swaps ^H and DEL.
In ospfd(8), unbreak "redistribute default" and make it possible to specify a metric for the default route as well.
Plug memory leaks in OpenCVS and OpenRCS code.
Fix a potential panic in pf_route().
In mg(1), enable auto-complete for the Execute: prompt when using auto-execute.
Enable recursive interrupts on the armish platform.
ACPI code added to various amd64 and i386 install images, though disabled.
Add rum(4) to amd64 and i386 RAMDISK_CD kernels.
Hook up acpicpu to the hw.setperf sysctl(8) mechanism, allowing people running ACPI kernels to scale processor and frequency voltage.
Make IPv6 input code reject packets from outside with interface-local multicast address in ip6_dst.
Sync KerberosV code with heimdal.
Add support for pci-based sti(4) devices on hppa.
Enable mbg(4) on macppc and sparc64 GENERIC kernels too.
For sensorsd(8), provide dampening on negative events for sensors that flip due to bugs or erroneous readings, and increase polling frequency accordingly to provide same rate of reporting.
Activate mbg(4) on i386 GENERIC kernels.
For landisk pciide(4), force speed down to PIO mode 4 until some DMA issues are sorted out.
wscons fixes for accented keys.
Import of mbg(4), a driver for Meinberg FunkUhren time signal station receivers. Currently, DCF77 PCI32 receiver card is supported.
Fix index of ERP information element in beacons for rt2560 and rt2661-based devices.
Fix for dual port msk(4) cards, now second port is enabled again.
On hppa platforms, make hil(4) aware of shared interrupts, hil_intr() gets invoked when serial ports interrupt too.
Update the xenocara XOrg code to X.Org7.2RC3.
Import of hostated(8) to monitor remote hosts and dynamically alter pf(4) tables and redirection rules.
Added acpi code to amd64 and i386 RAMDISK_CD kernels.
Generic fixes for MII code to allow correct duplex reporting for ethernet drivers.
Fix for msk(4) when processing status descriptors. Makes Yukon-2 XL Rev A3 devices work.
Add HP NC373i PCIe Gigcards to the list of supported bnx(4) devices.
OpenCVS now can handle Sticky bits on client and server side.
Removed GEMDOSFS from MS-DOS filesystem code.
Add esp(4) driver to macppc, supports NCR53c94 SCSI controller found on old world macs.
Fix for man(1), make sure it closes fp before returning.
Fix a minor bug in the TX data queue setup for ath(4) devices.
Fix for MS-DOS filesystem code where the fs claims to have more clusters than can be represented in the FAT.
Enable nested interrupts on the Zaurus platform, so interrupts are counted correctly.
Partial fix for acx(4) regarding broken beacon frames when running in AP mode.
For ssh(1), make PermitOpen work with multiple values.
Added IPv6 passive OS fingerprinting in pf(4) and tcpdump(8).
Make the bgplg(8) produce valid XHTML1.1 code.
Add a workaround for hardware ip4csum-tx on re(4) chips, it would be mangled on IP packets less than 28 bytes.
Make malo(4) work on macppc by adding lots of endian fixes.
Make ftp-proxy(8) handle SIGPIPE, fixes a race where ftp-proxy(8) would silently exit.
In the SCSI layer, add the ability to requeue I/O rejected by a driver using the new NO_CCB result.
Imported a looking glass for bgpd(8) to be used for CGI web interfaces and so on. See bgplg(8) for usage.
In the TCP input code, allow RST with th_seq incremented.
Change sig_atomic_t on alpha from long to int.
In the ppp(8) code, if the remote peer rejects our MRU request, but our request is smaller than what the peer accepts, set the MRU anyway.
Make OpenCVS permit readonly checkouts using -R or the CVSREADONLYFS env. variable.
Make "flags 0" disable si(4) and sw(4) DMA on sparc.
In udcf(4), handle unexpected minute gaps better and restart collecting bits immediately after a parity error.
In ip6_output(), make sure ia is initialized before use.
Add USR5423 to the list of supported zyd(4) devices.
Sparc and sparc64 wscons rework, and vt100 emulation removal. Saves 16KB on kernels.
Make spamd(8) take multiple add/delete arguments, thus making it much easier to do bulk add/deletes without opening and locking the database for each one.
Enable udcf(4) on Zaurus GENERIC kernels.
Initial code for a coming ahci(4) driver.
Switch IPv6 API from RFC2292 to RFC3542. Kernel still handles RFC2292 set/getsockopts so old binaries still work.
Better check for powernow on AMD K8 and AMD64 cpus.
In ospfd(8), fix a crash seen on busy area border routers.
Fix some channel tweaks in pgt(4).
Make it possible to set the metric and LSA type for redistributed routes in ospfd(8).
Cleanups and fixes for axe(4).
Fixes for TX DMA on sk(4) and msk(4) devices.
Add sf(4) to amd64 GENERIC kernels too.
Enable mesh(4) and mc(4) in macppc GENERIC and RAMDISK kernels.
Replace Adaptec AIC-6915 sf(4) driver with fully bus_dma(9)-able driver from NetBSD.
Fix NULL dereference in NFS code, and make sure current buffer is big enough before caching current entry.
Added ZyXEL ZyAIR G-100 to list of supported pgt(4) devices.
Add dutch keymap to hppa map listings.
Implement correct fix for PCI scanning routines for old world macs.
Imported fixcoff for macppc and made some changes to ofwboot makes it possible to boot OpenBSD on Power Macintosh 9500 and 9600.
Fix memory leak in isakmpd(8).
Make sure isakmpd(8) does not leak message structures when unsupported payloads appear or when payload allocation fails.
Implement TTL security hack in bgpd(8).
For tcp input code, make the syncache code inherit the TTL from the listening socket when sending the SYN/ACK response.
Do not install pmtu routes for transport mode SAs.
Add Sweex LW053 to the list of supported rum(4) devices.
Make axe(4) devices avoid unnecessary memcpy() operations in the TX path.
Report half/full duplex state on bge(4), em(4), ixgb(4) and vge(4) devices.
For pppoe(4), wrap authname and authkey in quotes to prevent problems when using special chars.
Added rde_check_route to dvmrpd(8), still not complete.
Fix for sparc colormaps when using cgtwo graphics.
Fixes for uath(4) regarding detach and firmware RX.
Make the virtual vmware vic(4) always assume full duplex when up.
Added Rapid Spanning Tree Protocol support to bridge(4).
First shot at endian fixing malo(4), still needs work.
Fix for sparc64 machines using a frame buffer whose endianness differs from the host CPU.
pthread fixes for pipes left in non-blocking mode after being closed.
Two fixes for compress(1), one for using stdin and destdir not writeable, and the other for having a file called '-'.
Make ipsecctl(8) handle multiple SAs with same src/dst but different port.
Added some more ZD1211B variants to the list of supported zyd(4) devices.
In malo(4), enable short slots, should stabilize and increase throughput.
Add support in XF4 for vesafb to the wsfb driver. Allows unaccelerated and unprivileged X server on i386, with allowaperture=0.
Remaining bits for ZD1211B support in zyd(4).
Endian fix in ips(4) firmware handling code.
Fix for block address calculation in specfs code for devices with blocksize other than 512.
Enable monitor mode on malo(4) devices.
Make kernel stack non-swappable.
Make sure amd64 and i386 only enable acpi if ACPI_ENABLE is defined in the kernel config.
Move the isakmpd(8) autogenerated public key into /etc/isakmpd, making it readable for unprivileged uses too.
Let nmea(4) use tty timestamps if enabled, increases precision and lessens jitter.
Code added to allow bgpd(8) to work on alternate routing tables.
Make sure apm code handles the case when acpi steals power management functionality.
Enable usbf(4) and cdcef(4) on Zaurus RAMDISK kernels so it can be used during install.
On i386, make sure Enhanced Speedstep and other non-acpi setperf mechanisms are used only if acpi is not attached.
Make the kernel malloc() print out a warning when returning NULL due to M_CANFAIL.
Fixes for DMA TX handling on the ixgb(4) devices.
Make spamd(8) error out for a greylisted session only after the DATA command, not after the RCPT command. Helps out with sender verification schemes.
Change the way dhclient sends to a unicast destination IP address.
Added support for different video modes on cfxga(4) devices. 8-bit modes disabled for now, and default still 640x480x16.
Added acpi support to i386 and amd64 GENERIC kernels, though disabled.
Initial import of vesabios for i386.
Enable kvm86 in the i386 GENERIC kernels.
Initial import of ips(4), a driver for the IBM ServeRAID controllers.
Only use the ichpcib speedstep feature if we're running in a (Mobile) Pentium 4, since celerons do not support it.
Add portugese LK-201 keyboard layout to vax machines.
First attempt at making kvm86 multiprocessor safe.
Prevent panics when booting GENERIC.MP with a vesabios kernel.
Initial bits for ZD1211B support in zyd(4). Untested.
Enable WEP on malo(4) devices.
Speed up cfxga(4) by not storing complete bitmaps as a backing store for multiple screens, but remember character cells instead.
Separate solid fills ops from regurlar raster ops in cfxga(4), brings us accelerated copyrows and copycols.
Enable uberry(4) on i386 and amd64 GENERIC kernels.
Make use of the multiple routing tables in the IPv4 and IPv6 input and forward handling code.
Initial import of uberry(4), for battery charging and powering of the USB Blackberry device.
For cfxga(4), always update cfxga_scr emulops field when creating a new screen, in case the card was removed and reinserted.
Fixes for malo(4) reset handling, so ifconfig up/down works on amd64 too.
Fix the blitter functions on pcmcia based cfxga(4) graphics, providing an accelerated putchar and fix synchronization points.
Enable mpi(4) on sparc64 GENERIC kernels.
Reworked the raster ops code for pcmcia based cfxga(4) graphics when monitoring cpu-to-display operation. Much faster that before.
Enable malo(4) on amd64 GENERIC kernels.
Silence some dmesg noise on Sun x4100 virtual consoles.
Activate pwdog(4) on i386 and macppc GENERIC kernels.
Added support in the scsi midlayer to handle detached targets better.
Fix malloc() panic in msdos_mountfs().
Remove dpt(4) from alhpa, amd64 and i386 kernels.
Enable new devices (flash, usbf, cdcef) on Zaurus GENERIC.
Initial USB device controller (UDC) and USB CDC Ethernet function support for PXA27x/Zaurus.
Add code to detect if the pwdog(4) card is jumpered to work I/O or memory mapped.
Enable malo(4) on i386 GENERIC kernels.
Add support for the Quancom PWDOG1, watchdog timer card.
Sync the amd64 acpi code to i386, also fix interrupt routing for multi-ioapic systems.
Fix for acpiec handler code, fixes deadlocks.
Initial import of X.org 7.2 called xenocara. Not hooked in the build tree yet.
Initial NAND flash support for Zaurus platform, not enabled yet.
Also enable malo(4) devices to have fixed rates set.
Fix for double free panic when detaching interfaces.
Enable automatic rate adaptation on malo(4) devices.
Complete rewrite of the reset routine on bcw(4) devices, clears up the random attach warning on warm boots.
Make sure we zero out the fsid field when copying out a statfs struct to userland in the VFS code.
Add support in pf(4) to tag ipsec traffic belonging to specific IKE-initiated phase 2 traffic. Allows policy-based filtering of encrypted and unencrypted ipsec traffic.
Fix for the STP bridging code, allows to use bridge STP with USB ethernet devices.
On arm platforms, use correct define to detect soft cpu.
Remove 802.11a stuff from malo(4).
For now, do not attach the second port on dual port msk(4) cards. Makes the first port work.
Add 88W8310 chipsets to the list of malo(4) devices.
Add BCM4312 to the list of bcw(4) devices.
Fix an int overflow in banner(1).
Make sure the kernel malloc() return NULL on too large sizes when caller has set M_CANFAIL instead of panic()ing.
Attach to cardbus bcw(4) cards.
Redo line parsing in ypserv(8), fixes out of bounds array access for short strings.
Make wi_get_txpower() fail on USB wi(4), so we do not CSR_READ on them.
In malo(4), free allocated mbufs at TX done. Also reset some TX descriptor values. Fixes "mclpool" warnings.
In ipsecctl(8), do not delete sections that might be shared with other connections. This workaround might leak isakmpd(8) entries, but is ok for now.
Added sysctl net.inet6.ip6.multicast_mtudisc for multicast routers.
Fixes for external editor launch in lynx(1).
Remove watchdog handler workaround in em(4), not necessary anymore.
Reenable hardware vlan tagging on ti(4) devices.
Fix a 32 bit overflow on 32 bit platforms for ksh(1) ulimit.
Make bnx(4) only do hardware checksum offload on UDP and TCP.
Fix vlan support in bnx(4) when transmitting frames.
Enable support for audio on landisk platforms.
Add support in pfctl(8) for -K, to kill source tracking nodes explicitly, behaves like -k for killing states.
Re-enable Intel i31244 support in pciide(4).
Add support in tcpdump(8) for displaying Rapid Spanning Tree Protocol frames.
Fixes for bnx(4) transmit code which would drop sent packets at mediom/high load.
Add PCI hookup code to malo(4) devices.
Fixes for mg(1) regarding isearch.
Fix line number bugs regarding marks while opening same file several times and one concerning pgup/pgdown in mg(1).
On amd64, decide whether we need to attach the primary cpu by checking the CPUF_PRESENT, like we do on i386.
Initial import of bcw(4), a driver for IEEE 802.11 Broadcom BCM43xx chipset based devices. Not usable yet.
Add support for multiple networks on one interface for ospfd(8).
In pax(1), fix extracting and setting permissions for tar archives when multiple -C options are present and/or multiple file selection args are used.
Make getpeereid() work on both sides of the connection. The client can now get the euid/egid of the server it connects to.
Make sure we copy the IV back into the session structure instead of the softc for VIA cpu-based crypto.
Fix a segfault in mg(1) when using isearch.
Add a lower TX treshold value in em(4) and use this when checking the number of available TX descriptors, in the case that em_encap() has tried to reclaim descriptors.
In grep(1), reset the number of lines of tail context before processing each file, to avoid printing lines from the previous file.
Changed the semantics of ff01::/16 to local interface multicast in the IPv6 stack.
In md5(1), add support for -r and -q options.
Add support for four new radios in zyd(4), AL2210, CGT, Maxim New and Maxim New2. Untested.
All network interface code create empty groups, so the rc scripts can do carp demotion early in the boot process.
Various IPv6 utilities transitioned from RFC2292 to RFC3542 behaviour.
Hook up acpi apic interrupt routing support to generic acpi code.
Fix for infinite loop in malo_tx_intr() for malo(4) devices and enable data packet transmission.
Fix integer promotion on 64 bit arches in udcf(4) code.
Fix for vge(4) when vge_encap fails, would leave an mbuf in the if_snd queue otherwise.
Add rlog and rannotate commands to OpenCVS.
Rework em(3) transmit register handling, required for future chipsets.
Make ipsecctl(8) handle rules with addresses from mismatched address families correctly.
Remove a delay() in malo(4) by actually waiting for the command to finish.
For i386, get rid of magic ISA and EISA bus numbers in mpbios code, paves way for alternative sources for interrupt information.
Fix memory leak in fsck_msdos(8).
Add support for the 3Com 3CRWE154G72 pgt(4) device.
Add support for Sun 1000baseSX cards in gem(4).
Make mopd(8) check the correct bits in the control byte.
Fix DMA firmware command interface in malo(4), now can associate successfully with an AP.
Have em(4) pre-allocate TX DMA maps instead of creating and destroying a DMA map per packet sent.
In the nfe(4) driver, defer setting the valid bit in the first TX descriptor until all descriptors have been set up, otherwise hardware may start processing descriptors faster than us.
In ifconfig(8) for wlan settings, allow -nwid to clear the prefered nwid, just like -nwkey clears the key.
Make m88k-base platforms fetch syscall arguments beyond r9 with copyin() from the userland stack, instead of having the userland code put the first three arguments in r10-r12.
Fix set_rpc_maxgrouplist, so mount_nfs(8) -g works again.
Have md5(1) accept both upper case and lower case letters.
Make ipsecctl(8) check both source and destination when grouping SAs.
Fix grouping for SAs in ipsecctl(8), now all combinations of SAs are possible, not only ESP+AH.
Make sure ipsecctl(8) does not count sa, ike and tcpmd5 rules twice.
Introduce reference count in dvmrpd(8) for route_report so it can be shared and freed correctly.
Make ripd(8) clear lists before deleting neighbor.
Fix an mbuf leak in tun(4) error path.
bpf(4) fixes for the acx(4) driver.
Lots of USB devices added to the landisk GENERIC and RAMDISK kernels.
Initial support for OpenBSD/sh support in gdb(1).
Add multicast filter to vic(4) instead of using ALLMULTI all the time.
Make sure diff3(1) respects TMPDIR.
More fixes in malo(4) for the firmware commands.
Make isakmpd(8) support public keys without SubjectPublicKeyInfo.
OpenCVS now can do remote tag command.
On landisk platforms, force TS_CARR_ON for the serial console, since they have no DCD line.
Make ospfd(8) and ripd(8) properly indicate the state of "fib-update".
Add a -y flag to fdisk(8) for non-interactive use.
Make sk(4) XMAC work on big-endian systems too.
Add support for Decision Computer multiport serial cards in puc(4).
Fix sigmask handling bug for landisk platform that caused SIGCHLD to be almost always masked.
Various fixes for em(4).
Add xmphy(4) to macppc GENERIC and RAMDISK kernels.
Fix dd(1) so checks for seekability is done using isatty() instead.
Various fixes for the landisk platform.
Fixes for softdep mkdir syncing during pagedep flush.
Correctly check for bad signature in the ssh(1) monitor, otherwise the monitor and unprivieged process can get out of sync.
Add timecounters to the adm64 platform.
In dd(1), fix skipping then reading from a tty.
Add support in ne(4) for AX88790 chipsets, and fix AX88796 waiting after sending a packet, since it seems to lack "remote DMA complete" bit in ISR.
Fix in pfctl(8) to unbreak authpf(8) by handling non-inline anchors separately.
When stopping malo(4) devices, also reset the TX ring.
Correction in trek(6) where signed char fixes prevents infinite loops.
For vax, do not let memset() behave as bzero() for lengths over 64KB.
In ssh(1), add missing checks for OpenSSL return codes.
Fixes for HPPA savecore.
Initial import of MFM controller code for Vax VS2000 and some VS3100, enabled in GENERIC and RAMDISK kernels.
For tip(1), replace -### with -s### for the speed string.
Enable malo(4) to transmit management frames. Fix/add firmware commands.
Landisk/SuperH platform switched back to softfloat code generation for now.
bgpd(8) would announce restart capabilities when announcing refresh capabilities. Fixed.
Force a new sensor task to be run as soon as possible in order to collect early values instead of waiting for the first timeout.
Make USB wi(4) adapters not advertise themselves as supported hostap devices.
In vic(4), set the RX filters after setting the shared data address. Fixes a crash of the VMWare host when running an OpenBSD guest.
Add MCP67 SMBus controller to list of supported nviic(4) devices.
Sync em(4) to Intels 6.2.9 version. Adds support for a few newer Intel PCIe boards and a few bug fixes.
Add gem(4) and gentbi(4) to amd64 and i386 GENERIC kernels.
Endian fix in httpd(8) for mod_proxy code.
Add MCP67 PATA and SATA to the list of supported pciide(4) devices.
Add NVidia MCP67 LAN to the list of supported nfe(4) devices.
Add power state table for 1GHz VIA Eden 90nm 'Esther' CPUs.
Do not enable hardware cursor on vax in the Brooktree DAC on the 8 bpp model.
Wait two seconds after reset before probing for devices on vax, lets RX23 devices get detected again.
Handle hil(4) loop reconfiguration in a kernel thread instead of doing it from interrupt context.
Do not let pfctl(8) open a transaction for a ruleset unless it is a brace expansion that contain rules.
Fix a potential memory leak in libevent.
Make arc(4) query the firmware for the number of devices, and then iterate through them to get the right names for sensor creation.
Fix a bug in awk(1) when converting a variable from numeric type to string.
Fix in X11 for video playback in the Radeon driver for Mobility M6 based machines.
Add AL7230B to list of supported zyd(4) devices. Untested for now.
In ripd(8), if the nexthop is not reachable through outgoing interface, set it to INADDR_ANY.
If the hardware does not say it can do scatter gather lists for tx on vic(4) devices, limit it to only one dma segment.
Enable vic(4) on i386 GENERIC and RAMDISK kernels.
Make raidctl(8) error out when passed an empty string as device name.
Make the vic(4) driver set a tick up to check the link state every second.
Add active cooling support to acpi.
Fix vic(4) initialization so ifconfig up and down now work.
Add German LK-[24]01 keyboard layout for vax platform.
Have zyd(4) abort bulk-in and bulk-out pipes before freeing the RX/TX transfer lists.
Fix firmware fatal errors on re-associations in wpi(4).
In vic(4), fix the TX path so it can use more than one scatter gather entry when sending the packet.
Fix range checking in the argument parser for dd(1).
Make vic(4) handle slightly short frames, such as those coming from VMWare.
Add support in ipsecctl(8) for aggressive mode.
Make pfctl(8) allow a user to recursively print anchors, including those without reserved names if a trailing * is specified in the anchor name.
Make ssh(1) check DH_compute_key() for -1 even though it should be valid due to earlier checks.
In the TCP code, do not regenerate the timestamp modulation offset for SYN-ACK retransmits.
Initial code for adding sensors to arc(4) devices.
Make pfsync devices to be cloned, but prevent more than one instance for now.
In pf.conf(5) allow pfctl(8) ruleset optimizer to be controlled from within the ruleset, or optionally on the command-line.
Fix infinite loop in gcc(1) for i386 code when passing objects with 3+ base classes by value.
Major work on the vic(4) driver. Closer to working now, but the TX code path still needs work.
Added a timecounter based implementation of adjfreq(2).
Fix dynamic tuning of the radio sensitivity on rt2661 based devices.
On luna88k, have the primary CPU start the CMMU for secondary CPUs because secondary CPUs will run endless loops without cache otherwise.
Change CMMU probing method on luna88k machines.
Fix in output of "show vnode" in ddb(4).
Plug a memory leak in talk(1).
Let ospfd(8) allow braces to fit on a single line if only one or no argument is used.
In libc, make __dtoa() and strtod() thread safe.
Fix in isakmpd(8) TAILQ usage, preventing crashes.
On amd64 and i386 platforms, make sure swap defaults to partition "b" on the same disk as root, not partition "b" on unit 0.
Make landisk booting more reliable by disabling cache before jumping into the kernel.
In the NFS socket code, make sure nm_srtt and nm_sdrtt arrays are not initialized out of bounds.
In ld.so(1), only mprotect(2) pages during relocation if the library is marked TEXTREL.
In pf.conf(5), add support for anchors loaded inline., enclosed in a brace-delimited block.
On macppc, have gcc(1) make stack executable when doing trampoline code.
On vax, hide hardware cursor on 4 bpp gpx displays.
For sparc machines, blank then screen immediately if the lid is closed during boot.
In ntpd(8), use clock_gettime(CLOCK_MONOTONIC,..) to get a monotonically increasing time, and make ntpd(8) use that to send the next query to an ntp peer.
Make udcf(4) degrade the sensor status to WARNING on first error condition and to CRITICAL if valid time information comes within 15 minutes.
Partially revert some of the macppc PCI range calculations, since it broke some newer machines.
Fix fxp(4) so it will reset the link when you change speed.
Have bgpd(8) store copies of everything needed to remove SAs and flows later. Allows for migration from tcp md5sig to ipsec esp ike with just bgpctl reload on both sides and bgpctl neighbor $foo clear on one side.
Make sure bgpd(8) store SPIs for tcpmd5 outside the conf struct so it can clear old SAs when the session is restarted after a config reload.
Add support for AMD Geode LX security block. Currently only RNG, AES to be added later.
Initial driver for MosChip MCS7703 based USB serial devices. No hardware flow control yet.
Allow pflogd to listen on alternate pflog interfaces.
On sparc64 USIII-based machines, make sure we flush the I-TLB from the primary context and not the secondary.
Allow spamlogd to use an alternate pflog interface.
Fix localhost DoS when using oversized values with crypto devices.
Fix for segfaults in pthreads code in _thread_kern_poll when descriptor is in closing state.
Add code to allow up to 16 pflog interfaces, and add support in pf.conf(5) to specify which interface to log certain lines to.
Make a RAMDISK kernel image for the landisk platform.
Fix RX DMA handling in malo(4) and make sure we reset the RX descriptor ring on ifconfig down/up.
Add new trace function to ddb(4), "machine acpi trace" so users can send useful traces without enabling acpi debug.
Improvements in ntpd(8) when updating from timedelta sensors.
Fix a crash in as(1) when using --statistics.
Build rthreads by default for easy testing.
Reworked malloc(3) to keep pginfo and pgfree structs away from application memory by using special allocators for those instead of imalloc. For chunks, return randomly from a short list of recently freed chunk.
Make the pflog interface cloneable.
Add Sundance TC9021 to list of supported stge(4) devices.
Fixes for PCI configuration on old-world macppc machines with non-contiguous PCI memory spaces.
Make bge(4) recognize BCM5715 A3-based devices.
Fix colormap in 4bpp mode on vax gpx displays.
Make zyd(4) devices blink the LED on transmit.
"Bogus xmit rate" panic fixed for rum(4) too.
Replace rate control code in ral(4), should also fix "bogus xmit rate" panics in HostAP mode.
Make zyd(4) handle per-node rate control.
Add Edimax EW-7318USG to the list of supported rum(4) devices.
Fixes for rate handling in iwi(4).
Fix RX handling in malo(4) devices, now can receive management frames.
Make sure bnx(4) keeps at least 16 TX descriptors unused, and handle TX loads problems better.
Enable zyd(4) on i386 and amd64 GENERIC kernels.
Major rework on zyd(4) to bring it into a working state. Should work with ZD1211 chipsets, though IBSS and HostAP modes does not work yet.
Fixes for the client part of OpenNTPD.
Add ASIX 88190 to the list of supported ne(4) devices.
More fixes for VFS softdep code.
Boot fixes for the landisk platform, now supports "boot -c".
Reworked the TX path of bnx(4) devices.
Another fix for the wscons jump scrolling code which can occur if autowrapping is on and certain control characters are encountered.
In the VFS layer, promote certain bdwrite calls to bawrite for some cases so they wont get deferred due to pending softdeps.
Make pciide(4) match the CS5536 IDE controller in AMD Geode LX-800-based system.
Replace ACPI ioctls with APM ioctls, now apmd(8) can be forced to use /dev/acpi.
Various acpi fixes.
In sort(1), remove code that could cause a SEGV if a buffer is realloc()ed, instead allocate two buffers early.
FPU detection fixes for AMD Geode LX-800-based machines.
For the SGI platform, enable ipv6 on the RAMDISK image.
Do not enable Geode watchdog if building small kernels.
On gcc(1) for alpha, do not force -msmall-data for -fpic and -mlarge-data for -fPIC. Makes -fpic and -fPIC equivalent, as was the case with gcc 2.x.
Initial import of ripd(8), a routing daemon for the RIP protocol.
Return ECONNABORTED when a non-blocking socket has been shutdown() for receives instead of returning EWOULDBLOCK, since that misleads applications to think accept() may eventually succeed. Corrects a pthreads deadlock.
Change the way wd(4) calculates the number of cylinders on non-CPU_BIOS architectures.
Disable firmware fastboot feature in bge(4) for 5752/5755 and 5787 ASICS, eliminates firmware timeouts.
Reset fixes for non-SC100 Geode cpus.
Deadlock fixes in libpthread regarding _FD_LOCK.
Make sure i386 and amd64 uses partition 'b' for swap, not just the first partition after root.
Increase max pf(4) tag name size from 16 to 64 characters.
Make sure pf(4) doesn't set 'flags S/SA' on stateless rules.
In re(4), fix for watchdog timeouts experienced with some RealTek adapters.
In ps(1), make the session field 8 chars for 32-bit cpus and 16 chars for 64-bit cpus since it is a pointer. Also, left-justify the state field name to match the state data.
Use 64 bit daddr_t for logical blocks in the file system layer too.
Initial import of malo(4) code, a new driver for the Marvell Libertas chips.
Remove a potential race in ftp-proxy(8) by closing file descriptors before cleaning up events.
For gem(4), get MAC address from VPD, like we do for hme(4).
Add BCM5787 A2 to the list of supported bge(4) devices.
Enable bce(4) on amd64 GENERIC and RAMDISK kernels.
Also add cross-compiling hints to crunchgen to allow for a different obj/ directory.
Fixes to allow cross-compiling of less(1).
New checks in ACPI code for Embedded Controllers, should be detected correctly now.
Fix for ath(4) reset procedure of single-chip variants. Should make AR5424 PCIe chipsets work.
Fix kernel page fault in pgt(4) when the device gets detached after the firmware failed to load.
In lynx(1), add checks for mkdtemp() failure, prevents segfaults when TMP or TMPDIR environment variables are set to non-existent directories.
Massive ACPI changes.
Make file(1) recognize OpenBSD/sh binaries too.
Fix a potential null dereference, and a memory leak in the pgt(4) error path.
Make sure ssh(1) exits instead of doing a blocking tcp send if we detect a client/server timeout, since the tcp sendqueue might be full of alive requests.
Fixes for SIGCONT, may be sent to any process with the same session ID as the caller, not to any process that is a descendant of the current process.
Add udcf(4) to amd64 GENERIC.
Implemented the IP_MINTTL tcp socket option.
Implemented the IP_RECVTTL socket option for raw or udp sockets.
In pf.conf(5), allow the 'quick' keyword on an anchor.
Various fixes for xge(4).
Revert firmware synchronization change in bge(4), since breaks dual-port cards.
Make ssh(1) sleep before retrying, not after, since sleeping affects errno.
Stop spoofing NetBSD/FreeBSD MBR partitions as the 'a' partition in a disklabel when no OpenBSD partition is found.
Fixes in the delay routines for dp8390-based devices on fast machines.
Add powerhooks to the pgt(4) driver.
Fix glitch in jump scroll code for wscons vt100 emulation.
SuperH additions to ld(1) and as(1) in binutils.
Fixes for linux emulation regarding linux_sys_waitpid() calls.
Add PCI Express Fibre Channel FC949E to the list of supported mpi(4) devices.
Fix for macppc mc(4) by using the "Enforce in-order Execution" to stop it from crashing under heavy load.
Make cd-roms retry forever while the device indicates that it is becoming ready, in the same way it was done for tapes in st.c.
Enable pgt(4) on cardbus for the i386 and amd64 GENERIC kernels.
Fix cardbus support for pgt(4).
Initial import of the SuperH-based landisk platform.
Various binutils and gcc(1) additions to handle 32-bit SuperH cpus.
In pf.conf(5), make 'flags S/SA keep state' the implicit default for filter rules.
SECURITY FIX: Integer overflow in systrace(4)'s STRIOCREPLACE support. This could be exploited for DoS, limited kmem reads or local privilege escalation.
A source code patch is available.
[Applied to stable]
Update OpenSSH to 4.4.
Always allow read-only opens on (s)vnd devices, despite the type of the first open (svnd vs vnd).
Add mc(4) driver for AMD AM79C940 (MACE) ethernet chip to macppc.
Make sure bufcache calculation on i386 does not take memory above 4g into account since it wont be used anyhow.
Fix for write(1) to handle cases where the utmp file is missing.
Fixes for pci(4) where unit numbers do not match PCI Bus number.
SECURITY FIX: Several problems have been found in OpenSSL. While parsing certain invalid ASN.1 structures an error condition is mishandled, possibly resulting in an infinite loop. A buffer overflow exists in the SSL_get_shared_ciphers function. A NULL pointer may be dereferenced in the SSL version 2 client code. In addition, many applications using OpenSSL do not perform any validation of the lengths of public keys being used.
A source code patch is available.
[Applied to stable]
Use 64 bit daddr type for physical block numbers in the filesystem code.
Enable altq on acx(4) devices.
Altq fixes for pgt(4), vge(4) and axe(4) based devices.
Fixes for libpthread regarding dup2() and _thread_fd_table_init() return values.
Add ServerWorks PCIe bridge ids to pcidevs.
OpenBSD/cats platform now discontinued.
Switch i386 fpu control too, i386 also has proper "long double" support now.
Initial code for 88E3082 Fast Ethernet PHY. Untested at the moment.
Switch amd64 fpu control word to hardware default, makes us use 64-bit precision instead of 53-bit, giving us proper support for "long double".
Make sure SAF/TE and SES free their sensors on detach.
Small fixes for running nm(1) on ELF binaries.
Improved CPU signature detection in the powernow K7 code.
Various small fixes in the re(4).
Make sure rtl81x9 code discards packets in the receive handler if they are too short or too large.
Small fix for powerpc pthread stack allocation code.
Add support for HenTong WK-668 to list of supported udav(4) devices.
Make sure rtl81x9 code free the mbuf chain on certain failures.
Tree search speedup in hostapd(8) via inlined compare function.
Fix hostapd(8) parser for event rules and handling of multiple matches of the "not" grammar rule.
Add cardbus support for pgt(4).
Add uath(4) to sparc64 GENERIC. Almost works.
Add an(4), atw(4), auth(4) and wi(4) to alpha GENERIC.
Add ifstated(8) to rc startup bits.
Enable uath(4) on amd64.
Fix in ospfd(8) to better detect on which interface incoming OSPF packets arrived.
Add uow(4) 1-Wire support to all USB-capable arches.
Add pgt(4) and acx(4) to sparc64 GENERIC too.
Plug memory leak in OpenRCS diff code.
Add acx(4) to alpha GENERIC kernels.
Switch alpha to gcc3.
Initial support for HostAP mode on pgt(4).
Make sure port number 664 isn't used since packets might get stolen by IPMI/asf.
Reduce number of unsafe signal operations in the X server logging functions.
In grep(1), allow zero-length patterns with -x.
Make pthreads allocate stack using mmap instead of malloc.
More of the fd race and deadlock corrections in pthread code.
Make sure bge(4) does not allocate jumbo buffers and also does not allow reception of large frames until mtu is set to higher value.
On acx(4), make HostAP mode work, and fix IBSS tweaks.
Add ELECOM LD-USB20 to list of supported aue(4) devices.
Endian fix for ISO chksum in dvmrpd(8).
Fix races in FFS code which may violate softdep processing and create inconsistant on-disk ffs state and absuse kmem aswell.
Fix in httpd(8) for error response to unsupported Expect: header.
Fix for the shutdown hooks on arc(4) so it syncs correctly.
Make nc(1) also accept "HTTP/1.1 200" as a success response.
In ld.so, fill in the list of loaded segments for the main executable so we can unprotect them if needed for binaries that have TEXTREL set.
Add pgt(4) to alpha GENERIC kernels.
Add TRENDnet TEW-429UB A to list of supported zyd(4) devices.
Make sure sparc64 can dump memory above 4GB.
Fixes for file descriptor races and deadlocks in the pthread code.
Add support for Marvell Yukon 88E8056 to msk(4).
Add support for hot plugging mpi(4) SAS devices, but disabled for now.
In OpenRCS, add support for all other diff flags that are pertinent to files, and do not conflict with rcsdiff-specific flags.
Make libXpm more robust when parsing XPM files with unterminated comments in them.
Make the wsfb driver inform the X server that is does not require direct access to the hardware.
Make sure the SCSI midlayer frees the scsi_link struct on detach now that hotplugging of controllers is possible.
Fix the way delays between retransmissions are calculated in NFS when receiving NFSERR_TRYLATER from the server.
Fix memory leak in top(1).
Implement zero-copy RX data path for uath(4) devices.
Corrected SpeedStep table for Pentium M 770.
Make vnd(4) work on read-only file systems.
Enable pgt(4) on amd64 GENERIC kernels.
Enable AR2413, 5413 and 5424 based devices.
In tcpdump(8), enable ESP and AH dissectors over IPv6.
Disable 802.11g mode on AR5211 and 5212 based devices for now.
Fixes for re(4) on cardbus, for kernel faults on halt/reboot.
The macppc platform extended .text and .data segments to 64MB, allowing programs with large .text segments to run.
Re-add Dell PHY LED setup workaround and Jumbo capability flag on bge(4).
Various fixes in the RX path for em(4) devices regarding mbuf cluster allocations, updating status bits in RX descriptors and DMA map unloading on errors.
Re-add re(4) link state check, as a workaround for a link state issue found on 8139C+ chips.
Alignment fixes for em(4) when doing VLAN and jumbo frames together.
Fixes for bge_reset() in bge(4), eliminates firmware timeouts for the BCM5752.
Make rdate(8) ignore ntp responses with ALARM status.
Defer the establishment of interrupts on bge(4) until later during attach. Fixes panic on some systems running non-MP kernels.
--------
Changes made between OpenBSD 3.9 and 4.0
Plug memory leak in top(1).
Limit maximum work done in ssh(1) performed by the CRC compensator attack detector.
Fix for error message parsing in pkg_add(1).
Initial import of uath(4), an Atheros USB2.0 WLAN device. Added to i386 GENERIC.
Avoid a write to NULL on mac68k.
Bring pgt(4) to a working state and enable it on i386 GENERIC.
Rework mpi(4) error handling from hardware so the scsi midlayer can handle them correctly.
Do not ask for HWERR interrupts on msk(4) and not acknowledging them later. Leads to interrupt storms on several machines.
Also add Intel 6321ESB SATA support to pciide(4).
Add VIA VT8237A SATA to supported devices. Untested but should work.
Reserve some command slots in ciss(4) for bioctl/sensorsd so ciss does not crash under load.
Make sure re(4) devices preserve mac address on thecus if the hardware mac is a specific number.
Reset the armish sysfail LED on thecus, so it does not blink.
Fixes for integer overflows in CID encoded fonts parsing for X.org.
Fix RSA signature padding vulnerability in OpenSSL.
Security update to BIND 9.3.2-P1.
Teach sasyncd(8) to set isakmpd(8) up in passive mode, based on current carp(4) state.
Add command to isakmpd(8) to force it into passive mode. Will be used by sasyncd(8) in HA setups.
Fix for UltraSparcIII sparc64 machines with more than one memory bank filled.
Add IPv6 link-local addresses to carp(4) interfaces when virtual MAC is set. Makes route6d work on systems with carp(4) interfaces.
Even more dhclient link detection adjustments.
Fix for getting mac address for bge(4) on sparc64, should fix Blade 1500 problems.
Fixes for the VAX ze(4) driver, and various other small VAX fixes. Allows VXT2000+ machine to (net)boot multiuser.
Have applications that write to pf_key socket understand EAGAIN errors and retry later.
Make sure atw(4) does not panic when channel tuning code returns IEEE_80211_CHAN_ANY.
In netstat(1), fix KVM snooping code so netstat -A work again.
Enable arc(4) on amd64 GENERIC and RAMDISK_CD kernels.
Fixed handling of 802.11 beacon frames by stations while associated. Should fix BSS mode with both 802.11b and 802.11g stations.
Added support for UFQDNs in ipsec.conf(5).
Fix for the 802.11 rate handling code to prevent devices being forced into protection mode and degrade performance.
Added support for IKE AH rules to ipsecctl(8).
Add support on UltraSparc machines for the onboard bge(4) devices.
Allow arbitrary values when changing the carp demotion counter, as long as the result still is in valid range.
In ssh(1) work around a problem in Heimdal when KRB5CCNAME file is missing.
Fix a possible kernel panic in the ucom(4) code caused by using already freed data in ttyclose().
Have dhclient(1) take net devices up in order for them to do media negotiation, since some devices requires this before the dhclient(1) 10 second link test.
Fixes for the installation scripts when parsing site-version-hostname.tgz files.
Make sure sparc and sparc64 platforms create more tty device files.
Allow building of procfs on arches that do not define PT_STEP, like sparc64.
Rework iwi(4) RX buffer allocation to make sure it never does DMA outside the mapped buffers.
Enable arc(4) on i386 RAMDISK kernels.
Make sure the sppp(4) code check for illegal options in LCP packets and drop such packets.
For sparc64, make sure onboard bge(4) gets the MAC address from the OpenFirmWare local-mac-address.
Fix for disc size check in cdio(1).
Fixes for LED handling on bge(4) chipsets found in some Dell machines.
For sparc64, enable HORRID_III_HACK, but make sure USI & II CPUs get to keep their data caches enabled. GENERIC now runs on USIII too.
Add some support for bio(4) on ciss(4) controllers.
PCI interrupt fixes for sparc64, makes it work on v210 machines.
Work in progress of VXT2000 support for vax.
Endian fix in bgpd(8) regarding sending of route refreshes.
Rework arc(4) code for detecting degraded volumes, since it would report degraded disks as online.
For armish platforms with fintek(4), have the fans blow at full speed.
Disable interrupts during the attach of UHCI and EHCI controllers. Avoids possible NULL pointer reference.
Make sure AMD PowerNow code does not propagate low level errors to userland on i386 and amd64.
Add support for VIA C3/C7 crypto driver HMACs.
Make tcpdump(8) recognize ipsec xauth vendor payload.
For ral(4) and rum(4), fallback to 1Mbps if tx rate is returned as zero. Avoids division by zero seen on amd64 sometimes.
Make ld.so(1) on ARM platform support libraries with DT_TEXTREL.
Add Nova Tech NV-902W to the list of supported ural(4) devices.
For i386, provide some smp locking around protection fault trap from user too.
Initial import of code to support the PrismGT pgt(4) chipsets.
Change bgpd(8) back to not send empty UPDATE messages, some routers do not handle it very well.
Enable acx(4) on amd64 GENERIC kernels too.
Have carp(4) interfaces answer ARP queries if the interface is in a bridge with the physical interface that received it.
Add support for Jumbo frames in bnx(4).
Enable RX checksum offload in bnx(4).
Add Intel 6321ESB and 82801H SMBus controllers to ichiic(4).
Add Intel 6300ESB and 6321ESB AC97 controllers to auich(4).
Add Intel 82801H/ICH8 SATA support to pciide(4). Untested but should work.
Add lm75a to the list of supported lmtemp(4) devices.
Lots of small fixes for iwi(4).
Add ucycom(4) to all USB capable arches.
Fix some file descriptor leaks in XFree error handlers.
for i386, add a new Core Xeon CPU and an older Pentium Pro model to the bus clock detection.
Add support for RT5225 in rum(4) and various other rum(4) fixes.
Disable SPNEGO as per RFC4462 in ssh(1).
Add bio(4) sensor support to arc(4) devices.
Enable msk(4) for alpha, amd64, macppc and sparc64 too.
Fixes in the VFS layer for proper mountpoint selection when mounting softdep file systems in a dir of a async mounted file system.
On hp300 with 68040, setup the transparent translation with writeback cache instead of writethrough.
Major rework of the hp300 boot code, removes lots of old junk and adds sgc frame buffer console support.
Jumpscroll code for vt100 and sun wscons emulations. Speeds up macppc and zaurus console a lot.
Add msk(4) to i386 GENERIC and RAMDISK kernels.
Initial driver msk(4), for Marvell Yukon-2 Gigabit ethernet controllers.
Add BelkinRT2601 USB device to list of supported rum(4) devices.
Have carp(4) send out a second delayed gratuitious ARP request after the MASTER election is won, so wacky L3 switches picks it up correctly.
Do not misreport some VS4k/90 machines as uVAXens.
LCSPX probe for vax now more reliable.
Add Belkin F5D705C to list of supported zyd(4) devices.
Initial code for a ucycom(4) driver.
Make bgpd(8) send an "empty" update message after a bulk transfer, used as End-of-RIB marker.
Add bnx(4) to i386 and amd64 GENERIC and RAMDISK kernels.
Make vacation(1) also add headers as per RFC 3834.
For ssh(1), add ability to match groups to Match keyword in sshd_config(5).
Add uslcom(4) and uark(4) on all USB capable arches.
Initial driver for uark(4), ARK3116 USB UART devices.
Fix for systrace symlink handling when calling rename(2).
Fixes for USB2.0 error handling.
Enable arc(4) on sparc64 GENERIC kernels.
Make cron(8) add Auto-Submitted header in generated mail as per RFC 3834.
Fix a panic when trying to fdisk vnd(4) devices which are backed by weird images.
Fixes for domain keyboards on hp300 models 362 and 382 aswell.
Fix for hp300 HIL keyboards during boot.
Update to sendmail 8.13.8.
Enable hostap mode for acx(4).
Preliminary import of Xwsfb for vax, still has endian issues on smg.
Make signal strength for acx(4) rssi depend on the radio type, so percentage value works.
Enable rum(4) on all arches where ural(4) is enabled.
In OpenRCS, correctly handle -e and -E flags for merge(1) and rcsmerge(1).
For hp300, try and determine keyboard layout from its identification string.
Fix a panic regarding SysV semaphores when overallocating more than the default number.
Fixes in xge(4) for DMA maps and RX descriptor maps.
Fix a use-after-free in mpi(4).
Fix for dhcpd(8) where a DHCPDISCOVER packet with a 32-bit client identifier would cause dhcpd(8) to mistakenly exit.
On hp300 platforms, use the blitter again for the cursor on non-mono frame buffers.
Lots of fixes for the rum(4) driver.
Endianess fix in ral(4) in the rate adaptation code.
Sync em(4) to Intels latest FreeBSD em driver (6.1.4). Adds support for the PCIe quad port copper adapter, improvements for media support with fiber adapters and some fixes for the ICH8 support.
Avoid div-by-zero in visual effects in fdformat(1).
Fix use-after-free bug in sendmail(8), triggered with too long header lines.
Enable WEP on acx(4).
ld.so(1) fix for Alpha in regard of gcc3.
Endian fixes for both wpi(4) and arc(4). arc(4) works on sparc64 now.
Switch luna88k platform to rasops from rcons.
Add BPF hooks to acx(4).
Enable arc(4) in i386 GENERIC kernel.
Fix for re(4) on PCIe busses where a second packet might get stuck if sent in short succession of an earlier packet.
Add Intel Raid Controller SRCSAS18E, and SRCSAS144E to mfi(4).
Add Intel 6321ESB to the pciide(4) driver.
In the re(4) driver, restructure TX/RX descriptor handling, and bump the number of TX descriptors for rtl8169-based cards.
Various fixes to the vax bootloader code.
Let pkg_add(1) check for errors on all reads/writes.
Make sure ssh(1) can build without kerberosV support, and with SKEY defined too.
Make the scsi layer report ENOMEDIUM and EMEDIUMTYPE to userland, so tar(1), dd(1) and friends can report useful error messages when there is no media in the device.
Add "restart" to max-prefix in bgpd(8), allows restart of suspended sessions after a given number of minutes.
Enable acx(4) on i386 GENERIC kernels.
Have bgpd(8) clean the routing table of all PROTO1 routes, since they might be leftovers from an earlier crash.
Re-enable IPMI on i386/amd64 GENERIC kernels.
Initial import of the acx(4) wireless driver.
Disable jumbo frames on xge(4) until reception of jumbo frames is fixed.
Add NVIDIA MCP51 AC97 to the auich(4) driver.
Have vax support font widths from 9 to 16 bits, and use 12x22 font by default.
Make ssh(1) allow fallback to known_hosts entries without port qualifiers for non-standard ports too.
Make pkg_delete(1) be better in reporting dependency problems when removing multiple packages at the same time.
Added puc(4) at cardbus for amd64, i386 and macppc, but commented out.
For amd64 GENERIC kernels, enable an(4) at pci. Untested, but should work.
Armish platform now allows argument passing from bootblock to kernel.
Add more strict receive path validation code to sk(4).
Fixed race condition in bgpd(8) when neighbor reached max-prefix, leading to a crash.
For dz(4), allow keyboard attachment on VS 4k/90 aswell.
Various vax fixes for console detection.
Improved armish bootloader into an interactive one like i386. Defaults to boot from wd0.
Make sure never to attach a dz(4) console to a keyboard port on VAXstations so machines with unsupported frame buffers can work with serial console.
Fixes for wscons(4) code on non-i386 platforms so an older X server runs.
First version of arc(4), the Areca RAID controller driver. Not usable yet.
Fix for scsi_inquiry_data version number parsing. Fixes SCSI5 and SCSI6 in dmesg.
Initial driver for color frame buffers found on VAXstation 3100 models 3x/4x. Rough but usable.
Make ipmi code only read one sensor at a time, also lower the polling frequency to every 5 seconds instead of every 10.
Make sure mount_nfs(8) allows synchronous mounts.
Initial code for an armish bootloader.
Fix in httpd(8) for mod_rewrite which potentially could be exploited.
Add some new twe(4) pci ids.
Compile all kernels with the new stack usage warning code in gcc(1).
Add cmpci(4) to i386, alpha and amd64.
Fixes for rcs binary file handling.
Add checks to all fdisk(8) write attempts, and try to keep it in a consistent state upon write failure.
Malloc fixes for rcs(1) and cvs(1).
Newer cmcpci(4) sound driver for i386.
Make sure kernels with VFSDEBUG option set can boot again.
Fix several timeout quirks in tftp(1) and tftpd(8).
For vax, replace kvtope() and kvtophys() with assembler versions.
Kill option GPL_MATH_EMULATE from the i386 kernel.
Add a wsdisplay driver for VS4000/60 and VLC vax machines.
Add TFTP Option Extension to tftp(1) according to RFC2347.
In ssh(1), disable tunnel forwarding if no strict host key check and key has changed.
Make brconfig(8) without arguments behave like "brconfig -a", similar to the ifconfig(8) change.
Lots of fixes for smg(4) on vax.
Various LUN-related fixes to the scsi code.
Improved Yukon init routine for sk(4).
Remove some scsi ioctls, most importantly those that can reprobe the bus.
Add ADMtek ADM9511/9513 to dc(4).
Add ATI SB450 and SiS 966 HD Audio to the azalia(4) driver.
Prevent segfault when "cpio -o" called without input.
Make "PermitOpen" in sshd_config(5) take a list of permitted ports.
Lower the number of TX descriptors in xge(4) from 8k to 2k.
Introduced new warning to gcc(1) to check for greedy functions using too much local stack storage.
Initial support for LEDs on vax machines.
Fix latvian keyboard map for wscons.
Add blksize option to tftpd(8) according to RFC2348.
On armish platforms, always assume root is on wd0a.
Add 'target kvm' support in gdb(1) for alpha.
Various fixes for the rum(4) devices.
Dont reject FAT filesystems with more than 255 heads since some USB keychains exist that use 256.
Add ForceCommand support to sshd_config(5) too. Equivalent to "command=" key option.
Add support for X11Forwarding, X11DisplayOffset and X11UseLocalhost to the Match keyword in sshd_config(5).
Add cd_powerhook to the scsi code. Drives may forget they were locked otherwise on PWR_RESUME.
Add support for ADMTek 983C chipsets.
Swap inode's associated device number on big-endian architectures when calling checkalias() for ext2fs.
Various other fixes for rum(4).
Fix channel 11 RF R4 setting for RF2528 based rum(4) devices.
On certain TI controllers, clear the SD/MMC bit in the flash media so the SD host takes over.
Remove arc network support.
Fix for obvious race in SD/MMC code and simplify the implementation of future host controllers.
Slight increase in number of jumbo frame slots for ti(4) and bge(4) on sparc64.
Correct the way SD/MMC hosts are allocated, fixes crashes on controllers with multiple slots.
Fixes for NVIDIA MCP04 SATA interrupts.
Initial import of csplit(1).
Import texinfo 4.8.
Change in udp receive code which allows IP_RECVIF to get the incoming interface, similar to INET6 code.
Add "PermitOpen" directive to sshd_config(5). Useful in combination with "Match".
Fix false positives in vax splasserts for older VAXstations.
Fix for LX164 Alpha systems where ISA video boards are reported as pci boards with invalid bus/slot numbers. Check for this when deciding which vga attachment to use.
Add Airprime PC5220 to the list of supported umsm(4) devices.
Fix for bus_dma on arm platforms, makes em(4) work much better.
Correctly NULL-terminate strings while parsing fonts and avoid a buffer overflow later in X11 Freetype code.
Add support for Genesys Logic GL523SM and Global Mixed-mod Technology G781.
Make mpi(4) use the lowest possible speed while doing inquiry and attach. Some devices like tapes and enclosures dont like being probed at high speeds.
Have the scsi code catch "Media Removal Prevented" and return EBUSY to userland instead of spewing scsi sense info to the console.
Add major line for wd* on armish, to allow kernels with root on wd0a to work.
Allow vax kernel stack tracebacks even when the kernel did not panic.
Initial PHY driver for IC Plus IP1000A.
Make sure little endian platforms without alignment requirements do not split multibyte access on usb.
Add support in sshd_config(5) for "Match" keyword, similar to the "Host" directive in ssh_config(5).
Add round(3) and roundf(3) from C99 to libm.
Increase the maximum jumbo frame size on stge(4).
Make sure pppoe(8) code handle remote error messages not being null terminated.
Ensure virtual and profiling interval timers are reset in child process after fork().
Add support for ExitOnForwardFailure to ssh(1) to terminate if we cannot set up all requested dynamic, local and remote port forwardings.
Make the UDF mounting code hint the kernel where to find the VAT.
Fix for gcc(1) false positives in the -Wbounded warnings for sscanf(3).
Only copy the part of environment variable in ssh(1) that we actually use. Prevents ssh(1) from bailing out later on long variables.
Hook up hw.product sysctl on macppc.
Remove SpamHaus entry from the spamd.conf(5).
Make sure the ELF loader can handle executables with all sections marked read-only.
Disable Speedstep and p4tcc setperf mechanisms on SMP systems.
Fix potential crash in SOCKS 5 code for ssh(1).
Fix for zero sized remote files in OpenCVS.
Make sure fdisk(8) doesn't try to read /usr/mdec/mbr unless the platform actually provides it.
Support for 68020-based hp300 machines removed.
Some fixes for ne(4) detection, allowing for unplug of a card when the probe gets stuck without panicing.
Implement firmware upload to mpi(4). This is the last feature mpt(4) had.
Make sure modification flags are unset if you undo all the way from a loaded buffer in mg(1).
Various fixes regarding line counting in mg(1).
Add support for ATI IXP300 SATA.
First version of remote code for OpenCVS. Fairly usable, but not recommended for real development yet.
Fix for in-kernel ddb hangman so it counts correct guesses right.
Re-sync the em(4) driver to Intel's 6.0.5 FreeBSD driver. Previous version included an unrelated change in the I/O which broke it last time.
Let mac68k kernels map an empty page at the beginning of the kernel so it can be mapped invalid to catch null pointer references.
In pf(4), allow rules to point to alternate routing tables and tag packets matching that rule.
Add options to sftp(1) to enable logging of transactions.
Add support for arguments to Subsystem commands in sshd_config(5).
Add VAT support in the UDF file system according to UDF 1.50.
Revert em(4) back to previous state.
Make sure the libc crypt(3) routine allocates enough space for gsalt.
Disable alipm on sparc64 until a spurious bug is found.
Initial version of nmeaattach(8). Attaches a serial line as a source of a timedelta sensor.
Sync em(4) driver with Intel's latest FreeBSD driver (6.0.5). Adds support for new chipset revisions found on ESB2 and ICH8 core logic chipsets.
Back out premature 68060 stuff from mvme68k locore.s.
Fix for OpenOSPF where ospfd(8) would redistribute bgpd(8) routes into ospf.
Various fixes for re(4).
Let isakmpd(8) send out vendor ID announcing isakmpds release version.
Sync systrace(1) to 1.6d.
Enable zyd(4) on i386.
Fix channel frequency/flags in radiotap structs. Channel probes now actually cycle 1-14 instead of just sitting at channel 1.
Make sure ifconfig(8) also updates the 802.11 address when the user changes the mac address. Replaces old wicontrol(8) -m option.
Add support for 5750 C2-based bge(4) cards.
Improvements for the sparc and sparc64 frame buffers.
Add -K option to vnconfig(8) which uses a salt file and pkcs5 pbkdf2 to create a more secure key.
Make sure ntpd(8) doesn't write anything to the log until it is daemonized.
Remove the mpt(4) now that mpi(4) has replaced it.
Change the iostat output in systat(1) to print kilobytes instead of bytes.
Make sure the EEPROM reading code on re(4) devices work as expected.
Make sure amd64 kernels compile cleanly even if DEBUG is defined.
Fixes for the softupdates queue handling code to avoid endless recursion when forcing worker threads to process worklist items before adding more to the worklist.
In OpenOSPF, track the uptime of the ospfd(8) itself.
Add the "nwflag hiddenwid" for hidden SSID mode and "nwflag nobridge" to prevent inter-station communications to ifconfig(8) for 802.11-based devices.
In hostapd(8), add new event rules to match optional elements like signal percentage, transmit rate and channel frequency.
Remove jumbo frame capabilities from the 5714-based bge(4) devices for now.
In systat(1), replace the iostat view to something that actually looks like the ifstat view.
Add code to ifconfig(8) to support scanning and node listing for 802.11 devices. Also allow it to print BSSID.
Fix in re(4) for RX path on architectures which require strict alignments and workarounds for reception of jumbo frames.
Add support for RealTek 8169SC and 8101E based network cards.
Upgrade OpenSSL to 0.9.7j.
Add support for RSSI max reporting in RFMD 2958 based atu(4) devices.
Pass process credentials to VOP_READ making it possible to load firmwares over NFS.
Enable mpi(4) on SGI.
On sparc64, always skip the offending instruction on a fpu fault.
Enable wide targets on FAS366 esp(4) controllers.
Add Sun type 7 keyboards to detected usb devices and try to see what country code they have selected..
Have ntpd(8) reset adjtime on startup, otherwise it will overcompensate and produce confusing log entries.
Initial import of bcx(4), driver for Broadcom NetXtreme II gigabit cards for PCI-X and PCIe. Still in development.
wicontrol(8) goes away, ifconfig(8) will replace the lost functionality.
Enable ne(4) on amd64 platforms.
Allow Xorg to run without privileges when using the wsfb driver.
Import support for Promise PDC205xx based SATA controllers.
Set the RSSI max value in ath(4) and add code to allow hostapd(8) and tcpdump(8) to print those values.
Let ifconfig print out signal quality for 802.11 devices if those have reported the RSSI max value.
Add an optional max_rssi attribute to the 80211com structure so it can be exported to userland. Used to control signal strength.
Ext2fs removed from RAMDISKC due to space constraints.
Add Promise PDC40518 SATA-II to the list of supported devices.
Endian fixes for sk(4), allows those cards to work on macppc and sparc64.
Let ntpd(8) save computed clock drift and use it on next startup.
Add CX4-based hardware to list of supported ixgb(4) devices.
Add BCM5703 B0 to the list of supported bge(4) devices.
Enable mpi(4) on alpha too.
Allow init(8) to accept SIGUSR2 for mandatory powerdowns.
Improvements in the UDF file system so it can find virtual partition maps.
Add support on sparc64 to power down nicely using the power button on the front panel.
Initial code to handle the zyd(4) driver for Zydas ZD1211 802.11 devices.
Avoid a race in ntpd(8) by installing SIGCHLD handler before fork().
Add media types for 10GE.
Make sure the nmea(4) driver stores the timestamp events early so other events don't overwrite it.
Fix for zaurus suspend problem introduced earlier.
Fix memory reporting on 2+ GB alphas.
Added kvm routines for vax platform so "target kvm" works in gdb for kernel crash dumps.
Add support for hotspares on mfi(4).
pcn(4) removed from i386 RAMDISKC install image due to size constraints.
Improve 802.11b/g interoperability and move towards better compliance with IEEE Std 802.11g-2003.
Fix a crash in ext2fs code.
On rt2661 and rt2560 based ral(4) cards, enable packet bursting when operating as as STA.
Enable udcf(4) on sparc64.
Add support for equal-cost multipath IP, enable with sysctls.
Import frequency correction code to ntpd(8).
Reenable AMRR on wpi(4).
The FFS code will now refuse to mount a filesystem where the number of frags isn't 1,2,4 or 8, instead of panicing later.
Make sure mouse and keyboard devices on recent Powerbooks doesn't register twice.
Implement carp demotion control for OpenBGPD. Sessions can be configured to modify carp demotion counter for an interface group.
Allow udcf(4) to build without clock_subr.c, which means any usb-enabled arch can attach it.
Fix for dvmrpd(8) on sparc64 which lets it fetch the interfaces correctly.
Fix file descriptor leak in isakmpd(8).
Driver for Philips PCA9532 LCD dimmer on ARM-based Thecus.
Better logging of refusals and transfers in tftpd(8).
Initial import of rum(4), a driver for the next generation Ralink Technology USB 802.11 a/b/g wireless network device.
Add rt2573 microcode to ral(4) driver.
Add skeleton driver for sparc64 Ultra5 power button. Not useful yet.
On wpi(4), load firmware block by block since contiguous memory may not be possible, and fix reassociations.
Make sure the privileged child process of dhclient has "/" for working directory so it wont hold locks on directories like /mnt if started from there.
Support for multichannel (>3) recording on azalia(4).
Fix for mpi(4) when running under VMWare since the VMWare mpi code doesn't fill in all the fields when probed.
Enable mpi(4) on hppa.
Switch i386 and amd64 to use mpi(4) in favor of mpt(4).
Add support for the fan controller on Thecus armish machines.
Add Ricoh rtc support for the armish platform.
Fix watchdog timeout errors in sk(4).
Rework Alpha interrupt code.
Put support for multiple routing tables back in again.
Add adjfreq(2) call to adjust the clock frequency.
Make sure iwi(4) ipw(4) and wpi(4) clear the IFF_UP interface flag before shutting down the interface.
Fix bug in sendmail(8) for deeply nested mime which could crash sendmail queue processing.
Make sure KerberosV doesn't look for a krb4 keytab.
Avoid potential deadlock in UDF filesystem code during hash lookup.
In ssh(1), limit the number of pre-banner chars we will accept.
Enable NMEA 0183 line discipline by default.
Initial support for iic buses on sparc64 for UltrasparcIII machines. Still in development.
Allow SHA2 and AESCTR in IKE for ipsecctl(8).
Kernel Virtual Mode 8086 support added to i386.
Disable jumbo frames in vge(4) for now.
Make sure we return EIO and not something else if cpu fails to alter performance mode for both powernow and p4tcc code paths.
Some more Enhanced SpeedStep fixes for i386 in regard to unknown EST CPUs.
Make kernel crash dumps work on vaxes too.
Move default keying in ipsecctl(8) from AESCTR to AESCBC.
wdt(4) device removed. watchdog(4) is there instead.
Small fix for link detection code in bge(4).
In isakmpd(8), make deletion of SAs on shutdown optional, needed for ipsec failover. Default is to not delete SAs now.
Fix checking of WEP flags in ral(4).
In isakmpd(8), support SHA2 for main mode and AESCTR for quick mode encryption.
Allow setsockopts succeed for any value that is not an increase in size when under mbuf pressure rather than when setting the value to the 4k minimum.
Simplify carp(4) device detection code in OpenBGPD.
Add X11 support to the armish platform.
Add EFI partition types to fdisk(8).
Let ami(4) report percentages for BGI and rebuild when probed from bioctl(8).
Make sure ipsecctl(8) allocates enouigh storage for sockaddr_in6.
On ral(4) devices based on RT2661 chipsets, keep track of the average RSSI to tune radio receive sensitivity.
Fix for potential NULL pointer dereference in ipsecctl(8) when testing for quick mode lifetimes.
Fix for fxp(4) on cardbus. Should make it work on macppc.
On hp300, when killing a process due to parity error, notify syslog. Also be careful with caches when checking for the parity error itself.
azalia(4) audio driver enabled on i386 and amd64.
Fixes in FFS softdep code relating to removal of large directories.
ntpd(8) now compensates old offsets with the amount of adjustment done, avoiding overcompensation.
Updated a couple of CAs that has been changed in the openssl(1) codebase.
Teach tip(1) set line disciplines.
On mips64, when deciding to flush the icache for a page, invoke the TLB-friendly cache function.
In the re(4) driver, write the words of the mac address in reverse order to fix a MAC problem on some Realtek 8169s.
In the wpi(4) driver, discard bad Rx frames early, dont start AMRR if we have a fixed rate and a fix to TSF synchronization.
Allow any user to request the current time adjustment with adjtime(2).
Fix the issue when ifconfig would create an address after a delete.
Make aic6360 devices detachable.
Add com* at cardbus? for macppc.
Add cloneable device implementation for the filesystem code.
Make sasyncd(8) fall back correctly with carp preemption enabled. Slight change in syntax for carp interfaces.
Better logic to find leaf le(4) device on sparc.
Move the carp(4) demotion counter into the interface group. This adds possibility to define which carp interfaces are demoted together.
splassert() implemented on vax.
Fix issue where bge(4) cards claim all interrupts for it's own.
ppm(4) driver added to sparc64 in order to be able to blink the power switch LED.
Add powerhooks to ral(4) cards with RT2560 chipsets.
Reenable the I-cache on UltraSparcIIIs even if HORRID_III_HACK is defined.
Add xge(4) to macppc and alpha builds.
Speedup in kernel build with debug enabled while stripping the bsd file.
Add basic NMEA0183 support as a line discipline. This allows for normal serial communication with the device, but adds a timedelta sensor suitable for ntpd(8).
Fix for ifconfig(8) where a delete of the last address of an interface could unintentionally re-add 0.0.0.0/0 to it afterwards.
Add support for flows with port modifiers in ipsecctl(8).
Various fixes in X11 for several integer overflows and null pointer dereferences in freetype2.
Add powerhooks for ral(4) devices based on RT2561 chipsets.
Initial import of dvmprd(8), still in development.
Enable RX hardware checksum on xge(4) cards and enable xge(4) on i386 and amd64 RAMDISK CD kernels.
Have cdio(1) test disc size before trying to burn 4Gb onto a CD-R.
Make transpose in mg(1) undoable.
Endian fixes in mpi(4) for the ioc_status field.
Make sure ACPI powerdown hooks are not called unless the init went ok.
Initial support for Blade 2000 sparc64s, though without cache.
Have vic(4) stop counting packets that already are accounted for in the general ethernet code.
In isakmpd(8), make sure phase 1 SAs of active connections stay alive. Fixes DPD breakage.
Enable mpi(4) on amd64, i386 and macppc.
In ch(4), add support for reading volume tags, usually barcodes.
Allow dhcpd(8) to manipulate pf tables on certain lease events.
Enable wdt(4) on i386 GENERIC.
Add rewritable blanking and track-at-once burning support to cdio(1).
Implemented chained scatter gather lists in mpi(4).
Implemented monitor mode for ipsecctl(8).
Widen the aperture used for legacy vga space on macppc, needed for mac minis ATI graphics cards.
Fix crash in netstat/route when ipv6 SA flows are present.
Handle zero length bulk and interrupt transfers on USB 2.0.
Bump minimum stack size for pthreads.
Make sure the UFS filesystem code does not dereference a pointer before NULL check.
Enable mpi(4) on sparc64.
Added support for import in OpenCVS.
Add SAS1064 as a supported mpi(4) device.
When ntpd(8) backs off polling, tell the user how long until next poll.
Crash prevention in ip printing tcpdump(8).
Add support for audio volume keys found on many laptops builtin keyboard.
Enable lists in the ipsecctl(8) parser.
Limit the number of scatter gather entries sent to mpi(4) so it fits in the maximum request frame size.
Implement \$ and \# expansion for PS1 in ksh(1).
Make sure tcpdump(8) uses snapend when printing captured ipx packets, could possibly print behind the captured packet otherwise. Also fixes for netbios parsing.
Add proper bounds checks for the CDP and SSDP protocol parsers in tcpdump(8).
Add support for i80321 "armish" systems.
Revert the recent NFS change regarding reserved ports.
Add gssapi-with-mic to PreferredAuthentications on ssh_config(5).
Implement reliable microtime on i386 smp systems.
Add support for NVIDIA nForce MCP04 to auich(4).
Bump mpi(4) to use 64 bit for all dva.
Add support for remove in OpenCVS.
Fixes for interrupt handling in the re(4) driver and flush the tx data buffer before handing it over to the hardware. Fixes tx on arm.
Improved error checking in the MBR read and write routines for fdisk(8).
Correction in the USB 1.0 status value check code.
Initial version of sparc64 beeper support.
Enable SD/MMC on amd64 too.
Fixed a memory overrun in the ACPI aml parser code.
Misc fixes to the st(4) subsystem.
Add support for NFS mounts from non-reserved ports, controlled by sysctl. Default is still to require reserved ports.
Improved nexthop delete behaviour in OpenBGPD.
Fix bounds checks in tcpdump(8) when printing tcp to prevent crashes.
Have OpenBGPD preload and pin nexthop used in filtersets so they are validated when used.
In tcpdump(8), make sure complete llc frame is captured, rather than the first three bytes.
Initial ipv6 support for ipsecctl. Not complete yet.
Add weight to ntpd(8) regarding sensors or servers so one can weigh sensors higher than peers.
Fix open(2) semantics for ch(4) devices.
Added support for SD host controllers like Ricoh 5C822, and scsi emulation for SD/MMC memory cards.
In systrace, allow len ==1 for systrace_fname() so systraced processes can get ENOENT instead of forced EINVAL.
Fix multicast and broadcast over gre(4) tunnels.
In pfctl(8), enable adaptive timeouts by default. Explicitly setting the timeouts will override the default.
hotplugd(8) now includes device id in the event logging.
In trunk(4) code, check if interfaces are active and UP. Some interfaces report link even if DOWN.
On st(4) devices, always allow ioctl's to work, even if there is no media loaded.
Fix potential crash in tcpdump(8) when printing ipv6 frags using -v.
Fix for National variants of the sis(4) cards when switching to allmulti mode.
Let dhcpd(8) continue even if an interface lacks a subnet configured in the dhcpd.conf(5), instead that interface will be ignored.
Add mpi(4), an alternative driver for LSI Logic Fusion MPT controllers, currently supported by mpt(4).
Rework udcf(4) attach code to create a timedelta sensor immediately, so ntpd(8) doesn't have to check for hotplug events.
Make libc getcwd(3) use the new __getcwd() system call.
Add pruning support to both update and checkout commands in OpenCVS.
Large updates to the OpenCVS code. Basic checkout, update, status, diff and commit works in local mode.
Make pkg_add(1) exit gracefully if it cannot read from a file handle, which happens when the ssh connection could not be established.
Add support for Option UMTS 3G+.
Add support for timedelta sensors in ntpd(8). Only udcf(4) at the moment.
Enable optional handling of the u-area in pmap if defined. Currently used only on xscale arm.
In ntpd(8), figure out the refid to send to NTPv3 clients early and store it.
Add automatic rate control (AMRR) to wpi(4).
Switch diff3(1) to use mkstemp(), avoiding possible race conditions.
Fix to allow alpha kernels to compile with gcc3.
Add support in X11 for Intel 945GM chipset video.
Fix for incomplete logic in the ipv6 input code.
On i386, simplify the SpeedStep detection.
Make sure the kernel compiles without SYSVMSG support.
Have less(1) remove trailing space in filename completion list.
Add code to dissect Vlan Query Protocol in tcpdump(8).
Allow OpenBGPD to request a route refresh from a neighbor if that neighbor has announced route refresh capabilities.
In pfctl(8), handle the case when member interface groups have no IP address.
Added support for Myrcicom Z8E.
Attach TTTech MC322 using the re(4) driver instead of rl(4).
Add support for RAID 10 and 50 in the mfi(4) bio.
On USB1.0 shutdowns, make sure we only call the disestablish function if there actually is a shutdown function established.
On wdc(4), directly invoke the wdc_do_reset() instead of using the reset function pointer, this could cause NULL pointer dereference on some systems.
Fix a possible endless loop situation in vi(1).
Remove static buffer usage in ksh(1) and make sure item 0 in an array is set since it might be used in a loop even if unset before.
On ami(4), allocate ccbs in the attach code instead of preallocating 126 of them in the softc.
In the tcpdump(8) bootp printout code, fix size checks for bootp packets.
Recognize Perc4/DC firmware.
Add BCM5706C and 5708C support.
Make a copy of the sensor structs in the sysctl code so we don't get a use after free if the sensor is detached while it is being used.
If packets arrive on inactive failover ports in a trunk(4) setup, do not increase the error count, just silently drop them.
In the routing code, make sure the kernel doesn't panic if the address family is not found in the rt_tables.
Add show all pools command to inkernel ddb, listing all pools like vmstat(8) does.
In FFS code, make sure we dont mark a mount-point Read-Only if we are about to sync it.
Reimplement Enhanced SpeedStep CPU detection code. Makes a number of VIA C7-M and Pentium-M models work.
Initial version of thermal zone support in ACPI.
Enable mfi(4) on i386 and amd64 GENERIC.
Add a shutdown hook for aue(4) devices to reset and stop the device since they can do weird things on a warm reboot.
Remove spppcontrol(8) now that ifconfig handles sppp(4).
Added a duplicate check to carp(4) for our own advertisements, necessary for dumb non simplex interfaces.
Fix a SEGV in bc(1) when reading erroneous syntax from the command line.
Enable azalia(4) on i386 and amd64 to get feedback. Still in development.
Make sure the scsi disk probing tests the state of the disk after spinning it up, and not before in order to handle stuff like empty USB card reader slots.
Various fixes for wpi(4).
Implemented support for sppp(4) in ifconfig(8).
Add network bootloader for AV400 Aviion systems.
Add https URL support to ftp(1).
Attach 8139s capable of C+ mode to the re(4) instead of rl(4).
In the re(4) driver, only allow Jumbo MTU frames if the chipset is 8169.
Initial implementation of IP Roaming in hostapd(8).
Add -h option to spamd(8) to override the hostname that is reported in the SMTP banner.
Permit proto 0 in ipsecctl(8).
On i386, add support for Intel 945G/GM video chipsets.
Add xge(4) and clcs(4) to amd64 GENERIC.
Initial import of wpi(4), a blob-free driver for Intel PRO/Wireless 3945ABG, found in Centrino Duo laptops.
Let Aviion deal with arbitrary load addresses needed for later boot code.
Fix for corrupted graphics when using X.Org on some Intel PCI bridges, which misreport themselves as normal bridges when they are transparent.
Fix for unwanted int to unsigned short conversions in libcurses.
Add -hex option to the openssl(1) rand command to produce hexadecimal output.
Add support for the usb-attached MetaGeek Wi-Spy.
Enable twe(4) on amd64.
Add ALTQ support to san(4) devices too.
Make sure hostapd(8) sets the correct timezone before writing to syslog.
Allow hotspare disk to be used on ami(4) even if the firmware sometimes misreports what SCSI type this device is.
Fix for pim register corruption in the multicast routing code.
Handle malloc() failure in df(1).
Add -x and -X options to kdump(1) to print output in hex.
Add support for listing interfaces as arguments to dhcpd(8) and traverse the list, ignoring all other interfaces for which no entry was given.
Make sure zzz(8) fails with a reasonable error message if apmd(8) is not running.
Added support for the Aviion platform, a Data General m88k based machine.
Enable alipm(4) on sparc64 again, and sprinkle some bus_space_barriers around the driver to help debugging it.
Import global ACPI interrupt code to i386 from the amd64 platform.
Do not allow delay times of 0 in systat(1).
On i386, avoid estimating pentium mhz too low, resulting in non-monotonic time.
Add 'link-timeout n' support to dhclient(8). Default remains at 10 seconds.
Removed unsafe setjmp/longjmp calls in tftpd(8) that were used in signal handlers.
azalia(4) audio driver added to i386 and amd64 GENERIC, though commented out.
Endian fix for getservbyport(), which wants network byte order.
Add bio(4) framework to gdt(4).
Remove the pool(9) draining hooks. Probably never used in a meaningful way anyhow.
Fixes for sgi debug code, unbreaks builds with DEBUG defined.
Move the userland stack on m88k to the top of userland address space.
Make sure MVME188 machines dont panic if the abort switch is pressed while at ipl 7.
On m88k, decide whether we are running a 88100 or 88110 by reading the processor identification register instead of basing it on the MVME board number.
Endian fix for pfsync code.
Fix for pfkey, allowing sasyncd(8) to reliably set up pfkey promiscuous mode.
Some pmap fixes for the m88k platform regarding obio on 88100-based system.
Added various ethernet devices to Alpha GENERIC and RAMDISKBIG kernel images.
Restore ALTQ support which was lost on de(4).
Fix two SEGVs in lint(1).
Make sure ssh(1) and isakmpd(8) also check for such degenerate Diffie-Hellman public exponents.
Backport checks for degenerate Diffie-Hellman public exponents from OpenSSL 0.9.8a.
Remove potential overflow in mg(1) when doing file I/O and len == 0.
Add 88110 instruction support to the m88k in-kernel debugger.
Initial code in ld.so(1) for prebinding binaries without compromising the security of randomized library linking. Still under development.
Make sure OpenRCS diff3 respects the TMPDIR environment variable.
Add Neterion Xframe-II 10GbE id to xge(4) pcidevs.
In mg(1), have each buffer store their own working directory.
Plug possible memory leak if AMD K7 powernow init fails.
Repair creation of subanchors with pfctl(8), and loading of subanchors from file.
Add Rx/Tx FIFO flush support to Yukon based sk(4) cards.
Fix for broken mpbioses on VT8237 and nForce4 chipsets. This fixes interrupt routing for several integrated devices on those chipsets in GENERIC.MP.
Increase Tx ring count on nfe(4) from 64 to 256.
In pf.conf(5), add support for "tagged {}" lists.
Make sure iwi(4) get initialized correctly, fixes a firmware panic if the same WEP key is entered multiple times.
Initial import of the Neterion Xframe-I 10GigE xge(4) driver.
On macppc, add support for fxp(4) and rl(4) on Cardbus on GENERIC and RAMDISK kernels, and add dc(4) and wdc(4) to RAMDISK too.
Added a driver for the Silicon Laboratories CP2101/CP2102 usb serial adapters.
On macppc, allow the nv X driver to mmap() as on i386 when running in mapped mode and allowaperture is non-zero.
Added support for the National Instruments PCI-GPIB card.
Cleanup of pdisk(8) for mac68k.
Implemented separate pmap for PAE i386 machines, allows for support for machines with more than 4G RAM. Not enabled by default.
Support for HBG and DCF77 time sources in the udcf(4) device.
Added support for the ICH7-M DH controller in RAID mode.
Fixed NULL pointer access in error path for kernel routing code.
Initial framework for the azalia(4) audio driver added.
Added support for ATI IXP 600 IDE/SATA controllers.
Rewrite setjmp()/alarm() code in tftpd(8) with poll() to avoid signal races.
Remove virtual tunnel support from the mrouting code. It breaks multicast on gif(4) interfaces and a real gif(4)-tunnel is more manageable than a multicast tunnel.
Make sure ssh(1) tries only once to open private keys, and not ask for passphrases if the keys cant be opened later anyhow.
Fix endian issue in netatalk code.
Fixes in libc regarding malloc() when allocation of the region succeeds but the allocation of a required page dir fail. Could leave holes in the directory list.
Enable asm profiling for i386 if either PROF or GPROF is enabled.
Add pci ID for 82801GBM SATA in AHCI mode, found on X60/T60 Thinkpads.
Endian-safe codepath for AMDtek variants, fixes dc(4) on macppc.
Add support for Dell Bluetooth 350 USB module.
Allow Intel SATA to map compatibility interrupts, makes a lot of ICH6M/ICH7M systems work.
Add support for puc(4) and com on macppc.
Rework the signal handler code in the privsep part of tcpdump(8).
Repair MVME147.
Add support for Adaptec 2130S and 2230SLP raid adapters.
Make udcf(4) devices work as a SENSOR_TIMEDELTA type sensor.
Implement outgoing interrupt pipes in uhci USB, makes Creative Voip Blaster work.
Add support for Encore ENL832-TX-ICNT device in the ste(4) driver.
Add support for BCM5752 A2 devices in the bge(4) driver.
Switch ssh(1) pipe usage to socketpairs. Saves a file descriptor and makes userland ppp over ssh work.
Add a few more integrated devices on nForce4 amd64s.
Add support for Belkin F5D6020 802.11b Wlan card.
Fix off-by-one read in yacc(1).
Fix some signal races in fsck_ext2fs(8) too.
Initial driver to decode DCF77 time codes.
Add hostname resolving and support for interface groups to ipsec.conf(5) parser.
Make sure we dont leak other processes execution history when restoring fpu state on the i386 and amd64 platforms.
Backport a gcc(1) bug fix for code generation which appeared when compiling htons() with -march=686 -O2 flags.
Added some more Intel GigE pci IDs.
In the kernel watchdog, make sure the parameters are reset to defaults when it is shut down.
Move bignum functions in ssh(1) to a file of its own, now sftp(1) and the sftp server don't have to link with libcrypto.
Display logical disk status in sysctl for ami(4). Now you can use sensorsd to monitor disks on ami.
Better detection between K7 powernow and Cool-n-Quiet for amd cpus.
Several signal race issues in fsck_ffs(8).
Fix two NULL dereferences in the sk(4) driver.
Support for ICH7R SATA in pciide(4).
Preliminary support for Colorgraphic VoyagerVGA pcmcia frame buffer.
Add support for Asus MyPal A730 PocketPC.
Make sure awk(1) handles / inside []'s correctly.
Fix problem in ssh(1) when input buffers becomes too large.
Produce missing caps lock key event on hp300.
Add support for the VT8363 PCI-PCI bridge found in Sony Vaio FS201s.
Fix for Kerberos5 code on static arches.
On i386 and amd64, enable 3DNow! and SSE support in X11, and enable the via driver for amd64.
Added another nForce4 ISA bridge PCI device ID to amd64.
Various fixes for AMD K7-powernow code on i386.
Add support for non-RAID part of the ITExpress IT8212F.
Remove all of the i386 DUMMY_NOPS code for good.
Initial support for HP98705 "Tigershark" framebuffer for hp300. Text console and X11 are supported.
Update Heimdal Kerberos 5 to release 0.7.2.
Show cpu time spent in interrupts on the vmstat page in systat(1).
File descriptor leak in httpd/mod_ssl code fixed.
Various fixes and updates for both OpenCVS and OpenRCS.
Free up memory in axe(4) if attach fails.
In ipsecctl(8), add support for "local" to ike rules for multihomed machines.
Fix signal races in ping(8) and ping6(8).
Rewrite attribute changing code to remove+add instead. Fixes "equal attributes encountered" errors in bgpd(8).
Make rthreads code compile again after header change.
Fixes for spl and interrupt counting in em(4) when dealing with half-completed work queues.
Fix some memory leaks in ldconfig(8).
In the vlan interface code, make sure we copy the baudrate (link speed) on link state changes from the parent device.
Switch to OpenRCS, even though some features are still lacking.
Add Intrepid 2 GMAC support to the gem(4) driver.
Added some wi(4) reset code since some cards freeze up sometimes.
On macppc and sparc64, if allowaperture=0 only allow mmap()-ing of the framebuffer memory in WSDISPLAYIO_MODE_DUMBFB mode.
Do not honor the address split scheme on MVME188 systems with more than two CMMUs per CPU when operating on caches, since it doesn't work.
Fix for sparc64 bus attachment code to better detect which driver to attach. Allows gem(4) netbooted machines to detect their root device.
Don't panic in apic code for i386 if an interrupt isn't shareable and is already taken.
Plug simple memory leaks in pfctl(8) and lpr(1) too.
Fix memory leak on fork failure in mount(8).
Improvements for the umidi(4) USB MIDI interface.
Add workaround for nfe(4) mbuf leak.
Superblock sanity checking code added to ffs vfsops.
Update xterm(1) to version 211.
Revert pci access method for xfree code on amd64 since the /dev/pci could cause problems on some machines.
Allow lists inside lists in pf.conf(5).
When running emulated binaries, release kernel lock after the exit hook to protect possible free()s.
Fix a process datasize leak in UVM when doing mmap with MAP_FIXED.
Add skeleton driver for mfi(4) MegaRAID SAS cards.
Fixes for floating point state saving in threads code for i386.
Fix for bgpctl(8) where it would show only the first announced prefix when doing "show rib det source-as #nr".
Fix a bug in mg(1) when writing buffers sharing the same basename.
Update to BIND 9.3.2.
Endian fix for an(4), now also enabled on hppa, hppa64 and macppc.
Reap child processes asynchronously in hotplugd(8).
Add power hook to bge(4).
Enable tqphy(4) for macppc found on xl(4) cards.
Add "set nexthop self" support to bgpd(8).
DMA fixes for xscale ARM when changing DMA completion handler.
Remove bundled dbm and regex lib from httpd, it picks up our dbm anyhow.
Installation fixes for Zaurus C3200, avoids a known problem in zbsdmod.
When parsing file urls in ftp(1), ignore http_proxy.
Don't nul-terminate GSSAPI buffers in ssh(1).
Fix interactivity issues in ami(4) and remove a busywait.
Prevent panic in iwi(4) if pre-3.0 firmware is being loaded.
Fix for timestamp setting problem over nfs.
Fix for ctrl-W in mg(1).
Lots of small non-invasive changes in preparation for FFS2.
Allow 32-bit session-ids in ssh(1) now that sha256 kex is used.
Make som channels in ICH IDE/SATA controllers native to be able to use the maximum number of disks.
Fix for sensorsd(8), it will now probe all sensors even if gaps are found in the list.
Plug huge memleak in libc regarding how the semantics around telldir() works.
Fix memory leak in sasyncd(8).
Add sysctl to retrieve routing table statistics.
Small steps taken in preparation for FFS2.
Add support for GSM modem SIEMENS ES75 on usb.
Add iop(4) to amd64 GENERIC.
In ssh(1), make sure we handle truncated files while converting keys, and also prevent duplicate log messages when privsep=yes.
Add percent escape chars to the IdentityFile option in ssh_config(5).
When fsck(8) asks y/n, it will now also accept "F" to force yes to all further questions.
In ftp(1), allow fetching zero-length files, and also fix progress-meter for >2G files.
Fix it(4) detection on newer ASUS boards for i386 and amd64.
Fix ami(4) sync_cache command so it can run asynchronously.
Enable MPI-401 MIDI UART on amd64 GENERIC.
Imported Perl 5.8.8.
Add simple printer for IEEE 802.1AB LLDP to tcpdump(8).
Add Intel 82801GB SATA support to pciide(4).
Add more space to memory columns in the vm page for systat(1).
Sync em(4) with Intel's FreeBSD em (5.1.5) driver, adds support for 82563 PCI Express chipsets and a few fixes.
Added some HiFn, Safenet and Bluesteel crypto cards to GENERIC on alpha.
Rework of iwi(4), enabling s/w antenna diversity, upgrade firmware to v3.0 layout and reworked rings allocation.
Sync ixgb(4) with Intel's FreeBSD ixgb (5.0.1) driver.
Add support for Realtek RT8111B PCI Express Gbit MAC.
In pstat(8), check for syncer vnodes before calling fs specific routines, so NFS and ext2fs gets correctly handled.
Split serial on macppc so zs devices are ttya and tty00 supports com(4) devices.
Sync libpcap with tcpdump.org's 0.9 APIs.
Added support for accessing 8-bit ISA I/O through the gpio(4) framework. Makes Acrosser AR-B1662 boards work.
Added support for Falcom Samba GPRS modem in the uftdi(4) driver.
Don't allow gpio ping change if /dev/gpio was opened in read-only mode.
Per-file I/O accounting is now possible to show in fstat(1).
Allow bpf(4) to ignore packets based on their direction.
Fixup IP checksum when modifying IP header fields in pf(4).
Fixes for the receive filter in sis(4) when enabling/disabling promiscuous mode.
On dc(1), show error message if the argument is a directory.
Added support for umsm(4) serial interface for Qualcomm MSM EVDO modems. Enabled on amd64, hppa, hppa64, i386 and macppc.
Turn on PCI parity checking on sparc64, and set the PCI latency timer for bus master devices.
Fix for adb keyboard caps key problem, if remapped to a dead key.
Fix for broken amd64 mpbios'es on VT8237 and nForce4 chipsets. Fixes interrupt routing for SATA on those when running GENERIC.MP.
Various fixes from the NetBSD coverity runs.
Add support for macros in ipsec.conf(5).
Change the way bgpd(8) selects nexthops. Required for complex setups e.g. where an additional IGP is running.
Add a new SHOW imsg to send optional attributes in bgpd(8) - used to show communities in bgpctl output.
Rework signal handling in ftp-proxy(8).
Add a helper pci_find_device() function to pci(4) to enumerate the PCI bus.
Plug a memory leak and fix a possible crash in usbhid(3).
In the /etc/security script, deal with the fact that some shell scripts may contain binary characters.
In pkg_add(1), fix an infinite loop in case of an error in the archive header.
Implement the Michael MIC as defined in IEEE 802.11i for TKIP. This generates a weak 64-bit digest protected by an additional key - required for future IEEE 802.11i/WPA support.
Better error checking in ifconfig(8).
Make ural(4) read and show real MAC/BBP rev as determined, instead of the hardcoded RT2570.
Fix panic on iMac G5 (iSight) in smu(4) due to a missing kernel unlock.
Fix an out-of-bounds memory access in ksh(1).
In m4(1), add limited support for format builtin in gnu-m4 mode. This is used by some autoconf scripts.
Allow the wscons(4) wsfb X server to run without the need for xf86(4) aperture to be set.
In the X server, use /dev/pci to access the PCI configuration space on i386 and amd64, instead of directly accessing the addresses from userland.
A large amount of memory leak plugging in various system utilities inspired by Coverity reports, as well as ruling out of hypothetical NULL dereferences.
Many changes in ssh(1) to be more careful with types.
In isakmpd(8), make sure the command fifo is ready before returning - fixes a startup race when interacting with ipsecctl(8).
Improve lint(1) to reduce more false positives and thus make the output more useful.
Fix some memory leaks in ssh's gssapi(3) code.
Change powerpc's BLKDEV_IOSIZE down to 2KB like on all other platforms.
Recognize more Intel pci(4) devices as found on the Acer Travelmate 3012WTMi laptop.
Plug memory leak and potential NULL dereference in hash(3).
Make asa(1) use getopt(3).
In init(8), plug potential memory leaks in error path.
Teach pcn(4) to recognize Am79c976 and Am79c978.
On sparc64, use OFW nodes to enumerate the PCI bus. This makes detection of devices hiding behind bridges more reliable.
Extend PCI bus enumeration to allow architecture-specific hooks.
Plug potential memory and descriptor leaks in ssh(1) and sftp(1).
Provide new amd64-specific implementation of exp(3).
Plug memory leak in revnetgroup(8).
Teach it(4) to probe IT8712F-a and SiS950 devices.
Rework tty handling in bc(1) so that things get cleaned up reliably on abort.
Place reasonable bounds on memory usage of bufferevents in libevent.
Provide implementations of the C99 math functions trunc(3) and truncf(3).
Plug memory leaks and a possible NULL dereference in systrace(1).
Make isadma happier on alpha by honoring the 'high' parameter in _bus_dmamem_alloc_range.
Change implementation of delay(9) on alpha to use rpcc instruction.
Plug memory leak in usbhid(3).
Clean up fts(3) leak in cp(1).
Clean up file descriptor leak in authpf(8).
Make ptrace(2) single-stepping work on alpha.
Fix an off-by-one error in csh(1) error handling.
Simplify descriptor cleanup in ksh(1), helping us to avoid any descriptor leaks that may have existed.
Fix an off-by-one error in ping6(8).
Drastically simplify handling of SCSI vs. AMI commands in the ami(4) driver. This is the first step to supporting more RAID features.
Correctly deal with -I (interactive) option in rcs(1) co command.
Improve clarity of messages in SGI installer.
Fix some off-by-one errors in talkd(8).
Delint various size_t/ssize_t/int mismatches in cvs(1) and rcs(1).
In rcs(1), set exit code when checking out a specific revisions fails.
Fix value of hw.cpuspeed sysctl on certain Pentium III models (early stepping 1 Coppermines).
Turn EXTENT_ALIGN into an inline function, shaves 100 bytes from RISC kernels.
Remove unused code from siop(4), shaves half a KB from kernel.
Fix mincore(2) to pass byte count to UVM functions, rather than page count.
In lmc(4) driver, consolidate error message array to shrink kernel by about 1KB.
Clean up and ANSIfy tip(1) code and fix some latent bugs.
Make rcs(1) co command honor the -q option.
In scp(1), display error messages even when remote stdout is not initialized.
Optimize tun(4) by using mbuf clusters instead of mbuf chains for large packets.
Fix some "reload" bugs in ifstated(8).
Make AMD PowerNow speed control stuff print nice dmesg lines.
Fix a quirk of ^C in vi(1).
Add sysctl_int_lower() API, consequence of which is that root can now lower the machdep.allowaperture variable without rebooting.
Some i386 laptops need more physmem segments (consequence of the kernel moving up by 1MB).
A few small fixes to bgpd(8).
If poll(2) is interrupted, remember to clear the pollfds array.
The zaurus no longer needs to use the xf86(4) aperture.
Fix %A printing in spamd(8).
Move parsing of wsconctl.conf(5) to earlier in the /etc/rc sequence, so that people can use their remapped control key earlier.
Install apm(4) utilities on amd64 so that the hw.setperf sysctl for CPU speed can be conveniently manipulated through them.
Fix BN_is_prime(3) to realize that 2 is prime. It took the OpenSSL people what... 8 years to fix this?
Fix amd64's exp(3) implementation which was broken in certain cases by switching to the C version.
Repair anonymous logins without passwords in ftpd(8).
Some churn in ami(4), heading towards improvements...
In pf(4), implement Unicast Reverse Path Forwarding (uRPF) which optionally verifies that a packet is received on the interface that holds the route back to the packet's source address. This makes it an automatic ingress filter, but only when routing is fully symmetric.
Add support for Sony CLIE PEG-T625 (and other new) devices in uvisor(4).
Move the i386 kernel up 1MB in virtual address space to provide more space for isadma(4).
Fix pkg_add(1) to work with stdin input (pkg_add -).
On alpha, protect sgmap extents with splvm().
On i386, use pause instructions during IPI lock spinning.
Slightly improve the situation with multi-function pcmcia(4) cards.
Make compress(1)/gzip(1) work without /dev/stdin and /dev/stdout.
In ssh(1), allow configuration directives to contain spaces, if wrapped in double quotes.
In ssh(1), set TCP_NODELAY flag for all connections not just interactive ones - fixes poor network performance and protocol stalls under some network conditions.
On the i386, fix userldt handling (consequence of recent i386 W^X changes) which causes a crash if a LDT-using process does an execve().
In mount(8), add -s flag which skips a mount if the file system is already mounted, handy for MFS partitions.
Switch from using PCI le(4) driver to pcn(4).
Handle emc6d100 and emc6w201 in the i2c adt(4) driver.
Fix local arbitrary command execution vulnerability on local/local and remote/remote copies in rcp(1).
Change the install script question 'Do you expect to run the X Window System?' to have 'no' as a default answer, to prevent people accidentially hitting return on the prompt on machines that don't need it.
Fix a few subtle bugs in vi(1).
Support IAPP pre-standard port 2313 in hostapd(8).
A output formatting bug (missing space in command line printing) was recently introduced into ps(1).
Grok %z in the format string warning code for the older gcc we have in the tree.
Foil potential timing attacks in login by using bcrypt(3) on non-existent users as well, instead of DES.
On amd64, properly route ISA interrupts through ioapics.
Some obscure fixes to ospfd(8).
Support the iic(4) controller found in the amdpm(4).
Now AMD PowerNow K8 support works on i386 and amd64, so that hw.setperf can adjust the processor speed.
Serial port support on the Zaurus was busted by the recent clock changes because of an interrupt mask mistake.
Improve the iic(4) scanning for ADM1030 and ADM1031 devices (supported by admtemp(4)).
In grep(1) do proper handling for patterns which include newlines.
Using pcibios(4) information, properly initialize the VIA VT8233, and support SiS 962.
Fix the long delay probe for adb(4) on some machines (in particular, the powerpc Mac Mini).
In bgpd(8), group block parameters were reset to default (duh, that is wrong).
Repair a really stupid (and old) bug in spanning-tree bridge(4) support.
Make pkg_add(1) work with scp (see PKG_PATH).
In ssh(1), implement diffie-hellman-group-exchange-sha256 key exchange method (which is now default when client/server support it).
In the com(4) driver, add support for the cardbus(4) Sony Ericsson GC89 UMTS/GPRS/GSM modem.
For all you Road Warriors in need of more dynamic IPSEC, in ipsecctl(8), add dynamic option ("ike dynamic esp") which uses the system hostname as source identifier instead of the IP address. See ipsec.conf(5).
Repair UDMA for the Via VT8237 in the pciide(4) driver.
Fix a mmap(2) related panic.
Fit mt(1) and eject(1) onto all the install media.
Add some acpi(4) debugging support to ddb(4).
Move remaining bits of the network stack to use splnet instead of splimp, see spl(9).
OpenCVS development continues with new energy.
Stop trying to allocate rotationally optimal blocks in FFS, since modern disks don't care.
Repair stdin handling in sdiff(1).
tun(4) is not a point-to-point interface, but a tunnel.
Fix a buffer cache race in vnd(4).
Fix a memory leak in cap_mkdb(1).
Fix a bug in tar(1) that cut short our filename lengths by one miserable character.
Initial 1-Wire onewire(4) bus support, including drivers for gpioow(4), owid(4), owtemp(4).
More churn in pkg_add(1).
In X11, support 10-bit color DAC video cards on Alpha TGA2 cards.
Do underlining in the zx(4) sparc/sparc64 video driver.
Fix an old bug on ARM-based machines, that would very rarely and very randomly deliver a SIGBUS that was not expected or wanted by anyone.
Display cpu states right away (not delayed) in top(1).
art(4) now works on sparc64 as well.
In ami(4), support a few more re-licensed parts by ACER, FSC, Intel and NEC.
Support Compaq Flash Socket CF 10/100 card in ne(4).
Support National Semiconductor DP83847 DsPHYTER PHY in nsphyter(4).
Some repair to vic(4) so that it might soon work for VMWARE.
Handle National Semicondutor lm96000 in the i2c adt(4) driver.
--------
Changes made between OpenBSD 3.8 and 3.9
Fixes for nfe(4), makes nfs+icsphy work again.
Like i386, prioritise low 16M for isabus_dmable memory allocations on amd64. nvidia ethernet was robbing isadma of bounce buffers.
On macppc, add smu(4) so we can read the clock off G5 machines.
In nfe(4), make a special case for ciphy to ask for RGMII interfaces at 2.5V. Makes Cicada/Vitesse PHYs attached to nfe work.
Switch atw(4) to software WEP. Fixes WEP on ADM8211A.
Fix logout recording in ssh(1) when privilege separation is disabled.
Fixes for ktrace when running emulated binaries.
Create the xsession error file with correct permissions instead of chmod afterwards.
Fix for tcp window update in the tcp input code.
Handle soft interrupt frames in gdb(1) for i386.
Fixes for link state in the ixgb(4) 10GE driver.
Add initial version of vic(4), the VMWare vmxnet interface.
Fix an error in mg(1) when a terminal is resized while it is suspended.
In ospfd(8), keep track of the individual uptimes of the entries in the RIB. "ospfctl show rib" will display them now.
Fix for sppp(4) on non-i386 arches. Fixes panic on alpha and makes cisco HLDC work again.
Add TTTech MC322 to the rl(4) driver.
Fix for the nfe(4) interrupt mitigation code.
Allow child resource limits to be set in httpd(8).
In the em(4) driver for 82544 and newer chips, increase the number of TX descriptors to 512.
Add optional 3rd choice [y/N/a] for "always" in pkg_add(1).
New default algoritm is AES, not 3DES in main mode. Document it in ipsec.conf(5).
Overhaul of the bge(4) link handling so CARP will see link state on fibre cards.
Add rm6 support for X11, a driver for Radeon Mobility M6 chipset.
Performance improvements in ospfd(8) while receiving packets, and improvements in the way the LS list is traversed.
Enable interrupt mitigation and fix h/w VLAN tagging in nfe(4).
Add the TTTech MC322 to known pcidevs.
Update time zone data to tzdata2006a with US DST changes disabled for now.
In ral(4) fix a a problem could happen in HostAP mode where net80211 could free nodes when the driver was not expecting it.
Fix a use after free in vi(1).
Fix problems with processing large files that have large snaplens on 64 bit architectures in tcpdump(8).
Allow the root path for an NFS server to be set via bootparamd(8) when netbooting Alpha machines.
In pchb(4) find additional noncoherent HyperTransport links by looking at the HyperTransport configuration. Fixes the detection of missing PCI busses on various Opteron systems.
In pcppi(4) do not bell if keyboard.bell.volume=0.
Add support for IC Plus IP101 PHYs to rlphy(4).
Add support for i915 devices to the kernel i810 AGP code.
Fix a bug in uplcom(4) which effectively swapped the RTS and DTR lines.
The NVIDIA nForce Ethernet driver (nfe(4)) now works for most people.
Support another 5714 family chipset in bge(4).
Add USB quirk required to make the CMOTech CM5100P EVDO card work with umodem(4).
Fix LBA48 access for ServerWorks SATA in pciide(4).
Add pcfadc(4) driver for Philips PCF8591 I2C Analogue to Digital Converters.
Add configuration file options to bgpd.conf(5) for removing communities from the path attributes.
Prevent neighbouring nodes in ospfd(8) from getting stuck in one FSM state.
Fix a possible crash in vlan(4) that could occur if the parent interface of the vlan had been destroyed before destroying the vlan interface.
In iic(9) allow controllers to pass a cookie to the device such as an OpenFirmware node.
Add support for Panasonic 50" touch panel in uplcom(4).
Fix a memory leak in grep(1).
Improve support for TV tuning in radio(4).
OpenSSH 4.3 is released.
In X's mouse driver, check buffer size before reading next char, which fixes a long standing mouse bug.
Add pcfiic(4), a driver for the Phillips PCF8584 i2c controller.
Add support for VIA VT6410, Intel 82451NX (PIIX4) and 82801DBL (ICH4-L) to pciide(4).
Fix local arbitrary command execution vulnerability on local/local and remote/remote copies in scp(1)/sftp(1).
In pf(4), the TCP SACK option needs sequence number modulation.
Add basic radiotap support to an(4).
Disable iic(4) when ipmi(4) is enabled - fixes machines that freak out when more than one driver touches the i2c devices.
Fix HMAC calculation in carp(4).
Implement HTTP proxy authentication support in nc(1).
In ossaudio(3), fix a problem leading to unintentional changes of the audio settings with certain applications.
Support Path MTU Discovery for link2 ipsec bridges (see bridge(4)).
Add evbuffer_add_vprintf(3) interface to libevent.
Support more models (and MII) in sm(4).
Fix UDMA on the IDE function integrated on the VIA VT8237 south bridge.
Fix a cross-site scripting vulnerability in httpd(8)'s mod_imap.
apmd(8) performance modes tweaks; show CPU speed in apm output.
Active development on acpi(4).
In pf(4) traffic normalization (scrub) code, fix a bug leading to kernel panics due to double-insertion in the fragment cache.
In ipsecctl(8), add support for pre-shared keys with "ike esp" using the new keyword "psk".
Add wbenv(4), a driver for the Winbond W83L784R/W83L785R/W83L785TS-L hardware monitor.
Add gpioiic(4), a driver for I2C bus bit-banging through GPIO pins.
In macppc wdc(4), allow proper detaching so that detaching a mediabay device works as expected.
Add lldiv(3), imaxabs(3), imaxdiv(3), strtoimax(3) and strtoumax(3) to libc/stdlib.
Add Path MTU discovery for NAT-Traversal (see isakmpd(8)).
Move to using GDT only (no more LDT in the general case) with a variable limit selector, to allow the W^X line to float much more dynamically.
Fix checksumming on little endian systems in hme(4).
Fix a crash in less(1) that occurred with files with very long lines.
Fix a tun(4)/bridge(4) crash that could occur in certain circumstances.
Fix the axe(4) driver on the big endian architectures.
Rework the an(4) driver for net80211 support and support for newer hardware, as well as remove the need for ancontrol.
In ral(4), add preliminary support for Ralink Technology RT2561, RT2561S and RT2661 chipsets.
In signal.h, expose structs sigcontext/sigstat/sigaltstack for XPG4.2 compliance.
In vfscanf(3), fix the handling of negative hexadecimal numbers in integer formats.
Add real C99 stdint.h and inttypes.h headers.
Make it possible to set a default vlan priority to a vlan(4) interface.
Many rtw(4) (Realtek RTL8180L) improvements.
On mac68k, switch to real keyboard and mouse drivers and wscons(4) as console. Also XF4 server support added for mac68k for the wsfb driver.
Add nviic(4), a driver for the NVIDIA nForce2/3/4 SMBus controllers.
bgpd(8) and ospfd(8) improvements.
In ip_input(), fix a case where pf(4)-modified packets could send icmp errors with corrupted payload.
Fix for a perl sprintf buffer overflow.
A fix in pxeboot(8) to help older PXE clients.
In uaudio(4), fix a potential crash when changing parameters with audioctl(1).
For macppc, switch from the maciic(4) driver to the general iic(4) infrastructure, simplifying the future.
Add amdiic(4), an AMD-8111 SMBus controller driver.
Add asbtm(4) driver for the Asus ASB100 sensors.
Merge with X.Org 6.9.
W^X support for macppc G5's.
Enable ichiic(4) on amd64 GENERIC too.
Add VMWare virtual NIC device id to pcidevs list.
In ospfd(8), use a timewheel instead of a simple timer per neighbor for the LS retransmission list. Makes it possible to cluster multiple LSA updates into one OSPF packet, giving massive speedups when large databases need to be synced.
Add 'include' support to hostapd.conf(5).
Fix the last pieces for hppa rthreads support.
Import tftp-proxy, a PF proxy for the TFTP protocol.
Split the <errno.h> from <sys/errno.h> which now only contains errno values.
Let gdb(1) skip the ld.so resolver on sparc and sparc64, making stepping into functions in shared libraries work.
Fix single stepping over system calls in gdb(1) for sparc and sparc64.
Updates to the adaptec scsi driver timeout code.
Add lots of i2c bus drivers to alpha, amd64 and i386.
On mvme88k, keep an array of command blocks instead of using malloc/free for every scsi command. Also remove the 1:1 association between scsi targets and work queues.
Fix a possible crash in lynx(1), backported from 2.8.6dev16.
Fix possible overflow in the tabstops[] array in expand(1).
Add a public domain sdiff(1) to the tree.
i2c sensor code now works on sparc64 v120 too.
Add sparc, sparc64 and mips64 support to rthreads, and add fixes for alpha, powerpc, amd64 and i386.
Added a basic ipsec.conf for ipsecctl(8).
Add m68k, m88k, vax support to rthreads.
Added support for Nintendo Wi-Fi USB driver in ral(4).
Lots and lots of i2c drivers added and workarounds for quirks in various chipsets.
Add emu(4) and missing midi attachment on macppc eap(4).
Enable ichiic(4) on i386 GENERIC.
Fully implemented microtime() on arm/xscale cpus.
Rework PHY setup, media handling and dualport detection on sk(4).
Teach gdb(1) about i386 interrupt frames.
Disable Zaurus lcd dma when screen is closed. May give performance improvements.
Make sure MMX/SSE includefiles are installed on amd64.
Teach gdb(1) how to unwind i386 and amd64 kernel trap frames.
On hp300 and hppa, postpone hil console detection to the first detection of a keyboard.
On Zaurus, allow sysctl machdep.lidsuspend=1 to cause suspend on screen closure. Opening does not yet wake it up though.
Make sure userland programs include <errno.h> and not <sys/errno.h>.
Reworked signal handling in isakmpd(8) and make sure it removes it's pid/fifo on exit.
Add machdep.maxspeed sysctl(8) for Zaurus to change the meaning of hw.setperf=100.
Various fixes in mg(1).
Make ssh(1) uses exitcode 255 on errors to match documentation.
Make sure zaurus returns to the speed it was at before, when doing wakeup.
Switch zaurus to use clock4 instead of clock0 so we get clocks when running at 91MHz.
kqueue(2) fix in libevent.
Make "cksum -c" understand checklists made with cksum, sum and sysvsum.
Add tpms(4), an Apple touchpad driver for the newer PowerBooks and iBooks.
Add %hhd format to *printf(3)/*scanf(3) and %z to *scanf(3).
Add ichiic(4), Intel ICH SMBus driver to be used with the iic(4) framework.
libresolv has been removed.
Fix ipmi(4) bugs which had caused instabilities and crashes during boot on some machines.
Initial support for an NVIDIA nForce Ethernet driver (nfe), not yet functional.
Prevent recursive interrupts with an i386 MP kernel which lead to kernel stack overflow under heavy network interrupt load.
Add M-x lint mode to mg(1).
Fix a huge delay attaching adb(4) on some macppc machines.
In hostapd(8), add an option to increase the multicast TTL so one can use inter-network multicast forwarding of hostapd messages.
Compile all system libraries with gcc(1) -g to aid in the debugging usefulness of a default system.
Do not allow setuid/setgid processes to open /dev/fd/# (see fd(4)), as documented in issetugid(2).
Fix ISC nslookup(1) to print the ">" prompt to stdout as historically done, as scripts depend on this behaviour.
Add support for tun(4) forwarding over ssh(1) - a simple way to use OpenSSH for ad hoc virtual private network connections, like secure wireless access.
Remove fdescfs (file-descriptor file system).
Add IPIP support to ipsecctl(8) to tunnel IP traffic over IP without setting up gif(4) interfaces.
Add support to bktr(4) to tune the channel via radio(4) and the corresponding features to radioctl(1).
In top(1), add support for toggling thread viewing (-T option).
Beginning support for kernel threads (rthreads), non-default for now. The implementation uses rfork(2) to create threads, and there are several new syscalls added to facilitate a userland thread library.
Add threads support to gdb(1).
More lint(1) hacking, recognise gcc __attribute__(x) and other noise-reducing improvements.
Fix signal races in event(3).
Tweaks to apmd(8)'s automatic performance adjustment change (raise when needed) and new -C option to have the old behaviour.
Add initial SB Audigy support to emu(4).
More forward leaps for OpenCVS.
In axe(4), add support for ASIX AX88772 10/100 ethernet adapters that are similar to the gigabit AX88178.
Add -j option to date(1) to suppress setting the clock, but parse the given argument (for format conversion or to test).
In ssh-keygen(1), enforce DSA key length to exactly 1024 bits and increase minimum RSA key size to 768 bits.
Many lint(1) improvements, avoid various false positives.
Make lynx(1) use arc4random(3) instead of other random functions; fix a possible crash.
A lot of mvme88k/luna88k improvements and fixes.
In carp(4), fix a bug where lower prioritized hosts would invalidly switch to MASTER for a short time at boot-up.
Make a trunk(4) interface's link state depend on the link states of the trunkports and fix a possible crash.
Initial support for ASF in the bge(4) driver.
Fix interrupt moderation timer frequences for Yukon/Yukon-II cards in sk(4).
Re-introduce debugging aid for queue macros to sys/queue.h, disabled by default.
Update xterm(1) to version 207.
Remove kernfs.
In ipsecctl(8), remove old-style keyed sha1/md5 - only hmac-sha1/md5 are supported.
Various lint(1) modernizations and infrastructure changes to facilitate its use.
Make iwi(4) work on big endian architectures.
In ral(4), implement the Adaptive Multi Rate Retry Algorithm (AMRR) for BSS mode and other miscellaneous driver improvements.
Permit apmd(8) to run on systems without APM support and let it handle hw.setperf manually or dynamically.
In dhcpd(8), fix problem of server looping with "already acking lease" when busy With short lease times.
In tcpdump(8), add a printer for IAPP and hostapd(8) messages.
Many improvements and added features to mg(1).
In ipmi(4), do extra checks to prevent crashes on machines with a buggy BIOS.
Move contents of sys/select.h into sys/selinfo.h in preparation for a userland-visible sys/select.h in consistence with other systems.
Add esm(4), a driver for Embedded Server Management for Dell PowerEdge servers.
Perform Kerberos calls even for invalid users to prevent leaking information about account validity in ssh(1).
In siop(4), fix microcode and driver to solve problems with interaction with some problematic drives.
Add hostapd(8) support for multiple hostap (wireless) interfaces.
In rtw(4), add support for GCT GRF5101 based hardware.
In bge(4), correct a performance bug that remained from the original driver and eliminate an unneeded and expensive PCI register write.
In wi(4) usb, add support for ViewSonic Airsync Prism 2.5 USB adapters.
Remove lockmgr(9) kernel mechanism and access curproc directly which is simpler and will avoid many bugs in the interface.
In pcap(3), avoid a memory error that could lead to a crash after a complex bpf filter was specified.
Add support for onyx(4) audio device driver.
A fix in macppc's i2s audio framework that makes iMac G5 sound work.
Update pcap(3) to libpcap-0.9.4's API and update tcpdump accordingly.
Major improvements to the aac(4) device driver.
In sd(4), use sectors as the partition size unit. Fixes disklabel error messages for devices that have no OpenBSD disklabel and sectorsize larger than 512.
Introduce new C99 math functions, lrint(3)/lround(3) families.
In rup(1), sort hosts when specified on the command line as well.
Fix a buffer overflow in ftp-proxy(8).
In tun(4), fix automatic device creation so new devices get added to the proper interface class group.
Add zrc(4) driver on zaurus for the Sharp CE-RH2 remote control.
Fix awacs(4) mixer control names.
Add support for pi2c(4), the macppc I2C controller on via-pmu.
Add maxds(4), a driver for the maxim ds1631 temperature sensor.
Add pcagpio(4), a driver for the philips pca9554 i2c gpio device.
In disklabel(8), fix conversion of K units to handle case of sector size greater than 1024.
In hostapd(8), work towards multiple daemons running on one machine.
Add admtmp(4), a driver for the adm1030 temperature and fan controller.
Add tsl(4), a driver for the TAOS TSL2560/61 light sensors.
In brgphy(4), add DSP init code for more models (BCM5703 copper) and other revision-specific changes.
Fix i386's exp(3) implementation for arguments Inf/-Inf.
Add adc(4), a driver for the Analog Devices AD7417/7418 temperature sensor.
Add maxtmp(4), a driver for the Maxim6690 i2c dual temperature sensor.
Make bktr(4) work on alpha.
In cron(8), make sure changes made within a single second get taken into account (due to the granularity of st_mtime this could misbehave).
Add ixgb(4), a driver for the LR/SR and CX4 Intel 10Gb Ethernet cards.
Add lmenv(4), a System Hardware Monitor device attaching to the i2c bus on macppc (so far).
In sendmail's makemap(8), do not hardwire Tab as delimiter as -t may specify it.
In ifconfig(8), add -descr/-description flags to clear interface description.
Start at kgdb(7) support for amd64.
In scsi(4), use 6 byte MODE SENSE commands for ATAPI Tape drives - the specification for them is different from other ATAPI devices.
Copy buffer in mg(1) before handing it to basename(), and improve error checking of snprintfs.
Add more stat counters to em(4).
Rework the scsi delay code so attached umass(4) devices don't freeze the system shortly and also speeds up the scsi probing at boot.
Add lock code to both ses(4) and safte(4) to prevent concurrent writes.
Handle asprintf() failure in krb5 login handler.
For m68k platforms, compute rough estimate of how much mem uvm_init() will allocate to prevent problems with early pmap inits.
Provide useful information if the hp300 frodo(4) driver panics due to looping interrupts.
Print hp300 HP-IB disk geometry the same way as scsi disk geometries.
Add support for interface names as host specifications in ipsecctl(8).
Fix filedescriptor leak and missing fclose() in ccdconfig(8).
No longer require Alpha bootflags to be set to "a" so that "s" can be used to go single-user. Default is multiuser now.
Add i2cbus to smu and i2c to maciic on the macpcc platform.
Move ac(8) from monthly to weekly in /etc.
Fix even more memleaks in sysctl(8).
Make ipsecctl(8) handle transport/tunnel mode.
Add support for VIA Rhine ethernet on macppc GENERIC and RAMDISK kernels.
Move the ses(4) code to use sensor kthreads instead of its own.
Make sure vax disksystem only touch associated processes of physical buffers.
Fixed memory leak in sysctl(8).
Several rounds of asprintf() replacing malloc()+snprintf().
For macppc, print available memory at boot the same way as i386/amd64.
Enable common editing keybindings in mg minibuffer mode.
Make the Zaurus scan the keyboard more often, from 8 to 20 scans a second.
in /etc/security, make sure not to scan afs/xfs directories.
Tweak the timing on Zaurus power button for sleep and safe-shutdown.
Code added to enable and disable keyclick on attach for sparc/sparc64.
In exec_elf, let unusual linux binaries run even if all sections are marked writeable.
Add maciic(4), an OpenFirmware aware version of iic(4) for macppc.
Disable TRACE method for httpd, potential security risk and not that useful for debugging.
Use more verbose error messages for the "bogus xmit rate" problem on ath.
Disable ahc0 on ISA buses until bugs are found, causes too much problems for everyone else.
getent(1) added to OpenBSD.
Make sure libwrap uses correct size when zeroing fd sets.
Split bios memory map into 4G segments on i386, and ignore parts beyond 4G.
Move safte(4) over to the new kernel sensors framework.
Handle unreadable dirs better in cp(1).
Fix for checksum on 64bit arches in pax(1) when checking sv4cpio archives.
In the IDE driver, don't fall back to fake geometry if other methods fail.
dlopen() fixes in ld.so and support for RTLD_NOW added.
Major splimp to splnet overhaul on various network drivers.
Missing cast fixed in ISO9660 code, fixes PR 4480.
Fix single stepping in gdb(1) for sparc64.
Allow any PPC instructions in macppc kernels, since we need 64-bit and altivec instructions anyhow.
bus_dma(9) support in san(4), makes it work on amd64.
Lots of 'register' cleaning in vfs filesystem code.
Add PCI ids for Intel Pro/10GbE CX4 adapters.
Sync Intel Gigabit em(4) driver to v3.2.18.
Better debug messages for scsi attach messages when size is unavailable.
Allow ctrl-key patterns in mg(1) keybind function.
Fixes to amd64 for upcoming kdgb support.
spl fixes and graceful error handling for sf(4), sk(4), ste(4), tl(4), vge(4),vr(4) and wb(4).
Add bus_dma support to de(4).
Add LMC cPCI HSSI card support.to the lmc(4) driver.
Steal code from pfctl(8) to improve address & mask handling in ipsecctl(8).
Add keyboard bell support to dnkbd(4) on hp300.
Add bus DMA and big endian support to lmc(4). Enable it on alpha, amd64, macppc, and sparc64 now.
Add init code for BCM5421 to brgphy(4).
Fix some resource leaks in error paths in ssh(1).
Fix interrupt handling in trm(4) to avoid "overlapping command attempted" error.
Fix lots of little issues in ospfd(8) so it handles time jumps gracefully and correctly keeps the candidate list sorted in cost order.
Bump pf(4) state, byte, and packet counters to u_int64_t.
Remove hardcoded key lengths in ssh(1) key exchange code, allowing implementation of KEX methods with different hashes (e.g. SHA-256).
Add the required pieces to bgpd(8) to support the "filter drop" option.
TCP sockets now inherit sack_enable from listening socket. This should allow connections with both SACK and md5 options in SYN.
In ld.so(1), also allow shared libs with paths to use version matching rules, rather than requiring an exact match.
Teach bgpd(8) how to parse IPv6 addresses.
Simplify SCSI delay code so that we can support different delay lengths for different devices in some cases.
In gem(4), handle TX underrun by resetting the chip.
Support soft reconfig in bgpd(8). On config reload, filter changes in outgoing rules propagate to peers automatically.
Add basic support for hw.setperf and hw.cpuspeed to change CPU MHz on zaurus.
Add tumbler(4) audio driver for macppc.
Add aoa(4) audio driver for macppc.
Add daca(4) audio driver for macppc.
Add ipcomp(4) support to ipsecctl(8).
Make ftp(1) reget of partially downloaded files > 2GB work.
Audit entire tree for misuse of QUEUE(3) macros, and put lots of thought into man pages so we show the exactly correct way to use them.
Add preliminary powernow support on K8, and improve support on K7.
Allow Sierra AC710 and AC750 pcmcia(4) wireless devices to attach.
Allow pfsync(4) to attach states to their rules, as long as rulesets are the same. This makes altq(9) and per-rule settings to play nice with pfsync.
Make em(4) more stable on hppa.
Add very basic handling code for MCE and MCA on i386. This lets the system tell us when something has gone horribly wrong. amd64 should get this next.
Fix a race condition in isakmpd(8) between DPD timeouts and exchange timeouts.
Add support for I2S sound bus on macppc, this will allow us to write audio drivers for new Macs. snapper(4) can use it right now.
Sync art(4) link state handling with sppp(4) and get blinkenlights for free.
Sync pf(4)'s state modulation code with rest of the TCP stack.
In netstart(8), do not process mygate if using dhcp for ipv4 or rtsol for ipv6.
Allow nc(1) to set ToS bits.
Revamp interrupt handling in em(4) for better performance.
Rework multicast group deletion code for vlan(4) and trunk(4) so it doesn't molest groups on parent interface.
OpenCVS rcsmerge(1) is working.
Improve error reporting and progress meter display in pkg_add(1).
Don't treat the processor in elansc(4) as a Pentium when it's a 486.
Fix RID handling in USB wi(4) driver that should avoid some wicontrol(8) errors.
Enable ipmi(4) on amd64.
Add support for VT8237 to viaenv(4).
In pciide(4), don't try to match VIA IDE chips as ISA bridges.
Add ability for ipmi(4) to read power state, chassis intrusion, etc.
Allow wi(4) channel to be changed from ifconfig(8).
Teach gcc(1) how to unwind StackGhost when generating DWARF2 info.
Add smu(4) driver for fan speed control and real time clock on iMac G5's and some PowerMac G5's.
In pf(4), allow dynamic interface group expansion (e.g. "pass to group").
In sis(4), do not reset timer while packets are queued for transmission, fixes device stalls in certain scenarios.
In wi(4) usb, fix command/write rid handling which makes scanning work to some extent, and improves error reporting.
In wc(1), add -h option to display human-readable numbers.
Some safety checks added to queue.h, to avoid accidents on certain operations (eg. double list removal) being undetected.
Make pf(4) use one mbuf tag instead of 6 distinct ones and optimize the lookup code, thus helping performance.
In pciide(4), fixup cache line on sii3114 controllers (as on sii3112). Also add VT8251 support.
Sync with heimdal 0.7.
Add v6 support to mygate(5).
More rcs(1) improvements toward GNU compatibility as well as OpenCVS progress.
Many fixes and improvements in ospfd(8).
In ftp(1), fix mget directory traversal vulnerability, CAN-2002-1345.
In usb(4), make all usb1 controllers sleep until all the usb2 controllers have probed and handed over any usb1 devices to the companion. For example this enables usb keyboards to be used before the root is mounted, eg. to enter the root device.
In adjtime(2), fix arithmetic overflows which fixes adjusting in the wrong direction for large offsets.
macppc sysctl added to determine whether altivec is available on the running CPU, with useful possibilities for applications.
Beginning of macppc crashdump support added, as well as much more macppc SMP progress.
Various lge(4) driver fixes, which turned it from a completely useless to a working driver, now in GENERIC.
In tcpdump(8), add a "best effort" MPLS decoder - since the protocol info is not always available in the tag, a "guess" is done.
In vfs(9), undo a very old change which was never quite finished, and could cause severe corruption in the buffer lists by removing a buffer from the hash twice.
Fix msdos filesystem corruption when moving a directory under a new parent.
Sync to Intel's latest em(4) driver, which adds support for the 82571 and 82572 PCI Express chips.
Add Spanning Tree Protocol support to pcap(3).
In iwi(4), use firmware extended scan command (which doesn't crash) and enable 802.11a scanning for 2915ABG adapters.
In ext2fs, use part of the reserved space on the disk inode to scatter 16 more bits for the UID/GID, making them 32-bit.
Make mg(1) undo much more emacs-like and correct.
In ksh(1), introduce mknod as a built-in, which has significant speed gains in MAKEDEV.
Add cardbus(4)/ pcmcia(4) support for AMD64.
Add multicast routing to GENERIC, now it can be enabled/disabled using the sysctl(8) interface.
In vfs(9), make the syncer grab a reference for the vnode it uses, to avoid it from being reclaimed while in this sensitive time frame. This fixes the sched_sync: fsync failed panic often seen on MP machines.
Add ipmi(4), a driver for the Intelligent Platform Management Interface, an autonomous monitoring and recovery mechanism implemented directly in platform management hardware and firmware.
Bump max array size in ksh(1), needed for MAKEDEV speed-ups.
In lndir(1), ignore the "special" .#* files left over by cvs/emacs.
In ami(4), eliminate possible I/O failures caused by ioctl/raw commands.
In trunk(4), add a simple active "failover" trunk mode.
In hardclock(9), fix a race condition in process exit, which caused freed memory to be left referenced in the master kernel timeout worklist, leading to a possible uvm_fault crash.
In ral(4) and ural(4), fix a problem in packet enqueue function which prevented dhcpd to work in standalone AP mode (without bridging).
OpenCVS: work keeps going, now with the help of cloudy weather in the Caribbean!
In hostapd(8), implement a way to match IEEE 802.11 flooding, which helps detect known DoS attacks.
Beginning stages for macppc G5 support!
In vfs(9), sync dirty data when going from read-write to read-only, fixes crashes.
In uvm_map(9), grab a fresh page using the uvm_km_page allocator instead of calling panic() when running out of static kernel map entries.
In umodem(4), add support for nokia 6680 with a ca-42 cable.
In axe(4), enable support for gigabit adapters; only works reliably with USB1 for now.
More ld.so(1) fixes: fully unload dependant libraries, fixes bug exhibited with gphoto2.
In ehci(4), force takeover of host ports after hibernate/resume, otherwise devices will incorrectly attach to the companion controller.
In atw(4), handle needed operations specially to make ADM8211B devices work.
Only allow root to run tcpdump(8), it's needed for the chroot security.
In art(4), notify sppp about link state changes, which fixes PPP encoding.
In ath(4), remove the very basic rate control implementation and use rssadapt(9) instead.
In ftp(1), add the ability to disable EPSV/EPRT from the command line.
In cd(4), add missing parenthesis which can problems with devices not supporting TEST UNIT READY.
Improve bgpd(8) IPv6 support.
In iwi(4), add initial bits for IBSS support and fix association with APs not broadcasting their SSIDs.
Make ppp(8) RFC 2472 compliant and fix various IPv6 problems as well as improve radius support.
In ath(4), don't attach unsupported radio chipsets.
Fix initialisation of net.inet.udp.baddynamic.
Add amd64 fdc(4) floppy support.
Correctly close raid(4) devices which fixes crashes.
More OpenCVS improvements, RCS keyword expansion now works for all keywords except $Log$.
Change rpc.rstatd(8), yppush(8), ypserv(8) to use poll() instead of select().
In ld.so(1), rework symbol lookup to more closely match sun's documentation and treat dlopens as load groups. Also cleanly handle the case where a dynamic object is opened, but one of it's dependent libraries is missing. Do not promote DT_NEEDED libs to RTLD_GLOBAL when being dlopen'ed. A few other simplifications and behaviour improvements and regression tests to match.
Make ospfd(8) correctly handle loopback interfaces and other fixes.
Allow ptrace(2) to follow fork(2) with PTRACE_FORK.
Support ATI IXP 200/300/400 pciide(4) controllers.
In ieee80211_input(9) and family, replace node hash table with red-black tree. Fixes some bugs in the node table, hash collisions are no longer a possibility, and it simplifies things.
In mountd(8), fix a NFS race when mounting filesystems on nfs servers.
X.Org fix for a buffer overrun observed as a crash by eclipse users, also fix a possible integer overflow in pixmap creation code.
In sd(4), fake geometry for all UMASS devices since it's almost always fictitious, reported to fix various devices.
In sasyncd(8), fix transfers of very large SA/SPD snapshots.
Make xargs(1) POSIX compliant, make it run programs even when zero arguments are specified.
In trunk(4), add multicast, VLAN support and various improvements.
In gem(4), program the MAC address correctly into the card after it has been changed, e.g. by ifconfig(1).
In shutdown(2), return ENOTCONN if a socket is unconnected.
Change hostapd(8) to use red-black trees for the node tables instead of hash tables.
In ath(4), fix a possible division by zero.
In ath(4)@pci, allocate memory for the right structure, which fixes possible page faults.
In bgpd(8), reload sessions every time the capabilities change.
An sd(4) fix for a case where free(NULL, ...) was possible and lead to a crash.
In umidi(4), fix corruption to multi-byte MIDI messages when a single real time byte is inserted.
Fix two hppa hardware erratas.
Teach file(1) about the flac audio format.
Many mvme88k improvements.
Make m4(1) SusV3-compliant and add various regression tests.
OpenCVS: add support for the CVS/Tag file writing/parsing, fix corrupt Entry files, various other improvements.
In pf(4), fix the DIOCCHANGERULE ioctl to properly initialize the NAT table, only affects custom programs using this ioctl.
In pciide(4), change matching code to only look at the PCI ID and ignoring the PCI class, enabling some mass storage devices to work.
Many pkg_add(1) improvements including -u option enabled now which automatically will update all installed packages.
--------
Changes made between OpenBSD 3.7 and 3.8
Initial support for Atmel atu(4) usb wlan devices.
Make it possible to add networks with attributes like communities or metrics dynamically in bgpctl(8).
Make sure rfc1583compat flag in ospfd.conf(5) is changeable.
Various logging fixes for sasyncd(8), handle peer disconnects better.
Fixes for dlclose() in ld.so(1).
Pin the sample rate at 44.1kHz on macppc snapper(4/MacPPC) audio device.
Use correct field names in atapi code and remove superflous and confusing defines.
Remove dead and wrong code from netstat(1).
Add 'listen on <interface name>' to sasyncd(8), and document the removal of SSL from it.
Call endpwent() after tcpdump(8) is done with the passwd fields.
More removals of unnecessary stuff in the atapi code.
Fix some signed-vs-unsigned warnings in bc(1). Mostly pedantic.
Fix buffer overflow, memory leaks, and NULL pointer dereference in cvs. CAN-2005-0753
Fix a panic in ccd(4) where second component could be wrongly treated as failed, leading to uvm_faults.
Make sure the optimized regression tests for PF also reflect recent changes.
Add missing getpwent() to portmap(8).
Put VLOCKSWORK under a single option, VFSDEBUG. Disabled by default.
Removed some superflous code from the atapi driver.
Added our own conversion routine for mono-to-stereo in the macppc snapper(4/MacPPC) audio device.
Change VOP_CLOSE to take a locked vnode.
Preparations for VFSDEBUG in vnode_if code.
Add support for kill states that match networks in PF.
Fix building of i830-driver in X11 without DRI enabled.
Move from SSL to shared AES+SHA between peers for sasyncd(8).
Add missing bits to 'ospfctl show rib detail'.
More "0x" removals in pointer printfs.
ALTQ cleanout in the de(4) interface code.
Document "mediaopt" for iwi(4) interfaces.
Added more encodings for macppc snapper(4/MacPPC) audio device.
Remove superflous interface search code in PF.
Fix signal race in tcpdump(8) statistics output.
Various fixes for the macppc snapper(4/MacPPC) audio device.
Code to allow PF to match on interface groups.
Handle cost2 for AS-external in ospfd(8).
Sync the i810 X11 driver with X.org. Fixes problems for IBM X40 laptops and gives shadowfb, DirectColor and gamma correction support. Also helps those with i915 and Intel E7221 chipsets.
Only dump the RIB for AS-External once in ospfd(8).
Don't iterate over the list of vnodes when we want to skip all of them. Makes nfs_sync() faster.
Fix setting of the "need ack" flag on iwi(4) and cosmetic change to not initialize the read index in if_iwi.c
Honor the 'no' in 'no scrub' rules for PF.
Add monitor mode support for the Intel iwi(4) chipsets, no fast channel hop yet. Also some changes for IBSS mode support and the fragmentation threshold.
Shorten netstart(8) by introducing 'ifmstart' to deal with starting multiple interfaces.
Remove ifdef KAME from isakmpd(8).
Make the signal handler of libedit safer.
Update pfctl(8) regression tests to keep up with recent changes.
Enable parity error detection on 900B and 635(A) on sis(4) devices. Set max size of Rx/Tx DMA to 64 bytes and remove call to mii_pollstat() from within device tick routines.
Fix NTFS format string "0x" duplication when printing pointers.
Add epic(4) to i386 and sparc64 intro(4) manpages.
Added new Realtek RT8185 PCI/Cardbus to the list of supported devices.
Fix power hooks for dc(4)-based cards.
Add ahc(4) and re(4) to sparc64 documentation and release notes.
Synced latest p0f OS fingerprints.
Enable re(4) and ciphy(4) on sparc64.
hppa64 device scan match code update.
Signedness fix and check for 0 size wrap in uvm_mmap() calls.
More checks in the scsi code to make sure requests really are completed, and remove a recompute of saved flags on retries.
Rewrite of ifconfig interface group printing code.
Fix potential infinite loop in tcpdump BGP print code.
Make all interfaces join the interface group "all".
Remove several layers of indirection in the pfctl interface abstraction code.
krb5_verify_user(3) links added, and spelling fixes for krb(3) manpage.
Sync power management settings for ar5120, ar5121 and ar5122. Should fix sleep mode timeouts.
Add hostapd early check for root privs, since it wont do much otherwise.
Add an i386-optimized in4_cksum.
Improved powersaving code in the ath(4) driver for ar5212 chipsets.
Many NTFS 64bit-fixes and cleanup. Some gcc-3.4 fixups while there.
elf64 loader fixes for hppa64.
Back out other bge(4) code which broke 5704-based IBM/Intel machines.
Add BroadCom 5174C to the list of supported bge(4) chipsets.
More fixes to make m4(1) in gnum4-mode work as wanted.
SOCKS5 improvements in nc(1) and regression test for ssh(1) dynamic forward using SOCKS5.
Split protocol v1 auth code into separate functions in ssh(1).
Remove address lookups when using nc(1) for HTTP proxy. Saves time on failed lookups.
Add proxyexample with nc(1) for the ssh_config(5) manpage.
Man page fixes for various keyboard manpages to prevent bad line splits.
Cosmetic fix for output from pgrep(1) when it doesn't find any matches.
Fixes for the i82810 pchb(4) RNG.
More fixes for the French Apple keyboard layout.
Fixes for the bktr(4) video capture code.
Added French layout for Apple USB keyboards.
Usage and option corrections for shutdown(8).
Fix cast in ssh(1) includes.h file.
Cleanup and SOCKS5 fixes for nc(1).
Some cleanup in sshd_config(5).
Add __unused macro to cdefs in the kernel sources similar to Net- and FreeBSD.
Also move wsconsctl.conf parsing in rc(8) to a function instead of a subshell.
Remove screen burner code from wscons when SMALL_KERNEL is defined.
Updates for calendar(1) regarding LOTR.
Remove certpatch(8) from isakmpd(8), not needed anymore.
Dont initialize bbp registers on some ral(4) adapters.
Allow payload 20 and 21 for NAT-T/IPSec in isakmpd(8).
Recognize more IKE payloads types in tcpdump.
m88k single-step fixes for delay slots and system calls.
Fixes for test(1) when testing unset variables.
Wchar fixes for C++, do not redefine wchar_t.
Move the rc(8) mixerctl and sysctl parsing into subroutine instead of a subshell and update resource limits if kern.maxproc/maxfiles changes.
Error message fix for file(1).
Check for null pointer when calling unp_mark in IPC code.
Added regression tests for m4(1).
End-of-line fixes for m4(1).
Remove debug code left in sk(4).
Check return codes for write(2) when writing microcode at various places under sys/dev/microcode and cleanup.
Stability fixes for ami(4).
Better documentation for spamd(8).
epic(4) added to amd64 and ep(4) added to RAMDISK_CD.
epic(4) should work on alpha. Untested.
Document that ptrace(2) PT_WCOOKIE is on sparc64 as well.
epic(4) support works on sparc64 as well.
Safe directory creation code in patch(1).
Miod is hacking mvme88k code again.
In pciide(4), use FLUSHCACHE EXT instead of FLUSHCACHE for LBA48 operations.
ep(4) support works on amd64 as well.
Use getopt(3) in rs(1).
Newer wscons(4) code merge.
umass(4) UFI/ATAPI USB devices always need 12 byte scsi commands.
Various gre(4) improvements; in particular, watch out the default MTU has changed.
Share more Sun keyboard map information between USB and serial models.
Various improvements to the 802.11 iwi(4), ural(4), and ral(4) drivers.
Make spkr(4) work on all architectures that have such devices.
Handle HP hil boxes seperately from keyboards.
Fix slightly incorrect handling of routing messages in bgpd(8) and ospfd(8).
Fix overflows in cruddy Kerberos compile_et(1).
For cats, i386 and amd64, enable spkr(4) by default in GENERIC.
Added another ural(4) device.
Various small fixes for OpenCVS.
Several fixes and new code for ageing LSAs in ospfd(8).
Made it non-fatal for ospfd(8) if it can't calculate a root node.
Add several "show database" subcommands to ospfctl(8).
Add a bzero() after malloc() on the ccd(4). Fixes a panic where the second component could wrongly be treated as failed.
Development continues on OpenCVS.
Fix bugs in ospfd(8) where it could set DR wrongly. Also fixes which makes it possible to drop from DR to BDR.
Define a keyboard layout for Apple international USB keyboards, and add a specific keymap for portuguese USB keyboard.
Fixes to ospfd(8) when connected to more than one area, now tracks the number of active neighbors for each area.
Improved the readability of the isakmpd.conf(5) manpage.
Make Zaurus stop the boot timeout on keypress as other platforms.
Document that sensorsd(8) reloads config files on SIGHUP.
Check for allocation failures in asn1_compile(1).
Fixes for ami driver, improves read performance. Only works for never firmwares.
Major ABI changes in libc in preparation for multibyte chars. Another libc major bump.
In libc, make vfscanf() a real function and use weak_alias for it where possible.
Use the libc ctype instead of using our own for libstdc++. Major bump in libstdc++.
Small fixes for the UDF filesystem.
Added code for OpenCVS "release" command. Needs more work.
Remove mii_pollstat() from various ethernet drivers that shouldn't call it, since the status is updated by mii_tick().
Add some Yukon chipsets to the sk(4) driver, add match on Yukon LP for Lite rev. A0.
Don't abort operation in OpenCVS when trying to unlink() a file that has already been removed.
Add ARM optimized version of in4_cksum.
Dont force default router priority to 0 in ospfd(8) since it can be used as both DR and BDR since quite some time.
IPv6 fixes in netstat(1).
Import i386 AES asm code from openssl.org.
Support NULL encryption for ESP in ipsec.
Take direction into account when matching source and destination addresses/ports while killing states in PF.
Lots of lowlevel hppa fixes.
Remove select() call from isakmpd(8) monitor code.
dereference strings in ddb(4) db_printf().
Nicer error messages for ssh when returning EADDRINUSE and report real errors if ControlMaster=no forces fallback to normal connect.
Remove strcpy() from libssl app code.
Add alt-escape key combination for entering ddb(4) on Zaurus.
Add vax optimized version of in4_cksum and deregister/ansify while there.
Recommitted the ld.so(1) destructor order fix.
Add epic(4) driver, which replaces tx(4). Allows bus_dma, multicast, big endian support and support for another EPIC chipset.
Fixes and updates for alpha root device detection. Makes DS20 (6600) detect the root device.
Add alpha optimized version of in4_cksum and deregister/ansify while there.
Add kbd(8),mt(1), ping(8) and ping6(8) to hp300 ramdisk.
Sync architectures list from distrib/ with kbd(8).
Check return values of cvs_getln() in OpenCVS.
Allow hp300 to compile even if wsmouse devices are missing.
Add SMC 83C175 to supported devices.
Remove WSDISPLAY_COMPAT_RAWKBD from hp300.
On the Zaurus, enable STUART clock, and enable com2 in GENERIC and RAMDISK. No console support yet.
Work on serial comms on arm Xscale to permit one of the UARTS to operate in SIR (Infra Red) mode.
Support for controlling the infrared LED on Zaurus added.
Bump Zaurus booter to 2.07. Added symbol loading and a few workarounds.
In ospfd(8), force as-external routes to point to the router advertising them.
Fix issue with IPv6 neighbor discovery where prefixes weren't getting purged.
Fix silicon version number and chipset printing in ath(4).
Make strerror(3) less likely to truncate the string.
For hp300 4bpp and 6bpp frame buffers, advertise color and highlighting capabilities after rasops init, so we don't think these are monochrome.
In sd(4), only fake geometry if we know the size of the disk.
On em(4), enable tx checksum offload.
Miod is hacking keyboard map support in wscons(4) and elsewhere.
Provide keyboard maps on hp300 for international dnkbd(4) Domain keyboards.
Fix display bug in "show database" in ospfd(8) when member of more than one area.
On sparc64, provide 8x16 and 12x22 fonts even if SMALL_KERNEL defined, just in case they are needed by cgthree(4).
On m88k, switch to optimized C version of in_{4}cksum. The optimizer does a good job on this and the resulting code is as fast as possible.
Set RUNNING flag on open in tun(4).
On amd64 ld.so(1), use saved source register rather than %rsi (not callee saved). This also allows propolice to be enabled in ld.so on amd64.
Update to libevent 1.0d, keeping local changes.
Kill some unused crud in libsa on i386 and amd64, trims 100 bytes from bootblocks.
Fix lost signal condition in isakmpd(8) where child dies before monitor sets its signal handlers.
Correct printing of large memory chunks in probing during boot.
Repair file mappings above 4gb in uvm(9).
Make hertz calculation in gprof(1) use documented APIs for predictable results. Also fix some issues on amd64.
Enable rx checksum offloading in vge(4).
Fix recently-introduced sd(4) crash during boot by not using disklabel values until SDEV_MEDIA_LOADED is checked.
Avoid an infinite loop in powerpc pmap(9) code.
Be more careful with snprintf(3) in libc and afs.
Add ichwdt(4): Intel 6300ESB ICH watchdog timer driver.
On sparc64, use optimized machine-dependent in_{4}cksum that gives a big performance boost.
Make ddb(4) more useful on zaurus by loading symbol table to the end of data/bss.
On ppc, use machine-dependent in_{4}cksum that is between 1.5 to 5 times faster (depending on CPU type) than the old MI version.
Use setres[ug]id for privilege dropping in ospfd(8), dhcpd(8), and elsewhere.
On mac68k, support a bunch more video cards (e.g. Miro PRISMA GX).
Fix issue with maximum sendqueue size on em(4).
Run password strength checking regexes as user in passwd(1). Regexes are scary.
Let dc(4) drain send queue so it can recover from link loss during heavy transmit.
Fix link state change and station address retrieval on vge(4).
Allow fsck_ext2fs(8) to check filesystems that have (or once had) files > 4GB.
Fix libstdc++'s printing of floating points. Bump major.
Bump libc major version after changing FILE internals.
Add isw* widechar classification functions to libc from citrus.
Hopefully make checksum offloading happen on most re(4) devices.
Use new MI timecounter code on mips64.
Add Fan3 support for IT8712 it(4) chip.
On amd64, make boot code use real mode with 64k segments instead of 1M. Improves stability with some controllers.
Import OpenSSL-0.9.7g on all arches.
Support ATI IXP 400 SATA pciide(4), which is a Silicon Image 3112 in sheep's clothing.
In bgpd(8), support "network connected" and "network static": announce directly connected and static routes, and dynamically update when routes change.
Be more consistent about NUL termination in pax(1)'s handling of ustar headers.
Improve support for umass(4)-based devices with multiple LUNs (e.g. card readers supporting multiple formats).
Fix a potential infinite loop in tcpdump(8)'s printing of BGP packets.
Fix interrupt handling issues in osiop(4) driver, which makes mvme88k happier.
Recognize Audiovox RTM-8000 GSM/GPRS CF card.
Support gcc trampolines support on m88k. Will support luna88k and mvme88k later.
Whack strcpy and sprintf in libstdc++, lets us pass our testsuite again.
Support cdrom booting on sgi.
Use new NuBus slot space mapping/probing code utilizing bus_space(9) for mac68k.
Make boot(8) use real mode with 64k segments instead of 1M segments. Improves stability on finicky disk controller cards.
On hppa, correctly handle boot drives with SCSI ID >= 10.
Swap a delay for a tsleep(9) in eap(4), makes Ensoniq CT5880 cards work.
Add microcode to support interrupt mitigation on fxp(4) 82551 F stepping chipset. Big performance boost.
Add ztsscale(8), our new Zaurus touchscreen calibration tool.
Support setting the MTU in dc(4).
Keep syslog(3) from spewing uninteresting things onto the console by default.
Fix a load of stability issues in ufs by paying more attention to failed operations.
Fix newer Xircom CBE2-100 dc(4) cards by making sure we attach to MII first.
Make sure bus-mastering is enabled for de(4).
Make ospfd(8) deal with MTU of 0 in the DB exchange packet. Fixes interop with Extreme Summit24 switches.
Add dnkbd(4), a driver for the Apollo Domain keyboard and mouse for the HP 9000/4xx.
Fix a rare pf(4) synproxy connection hang after handshake.
Import libevent 1.0c, keeping our local improvements.
Correctly handle allocations of size 1 at extent(9) boundary. Add a regress test for it.
Fix vi(1)'s handling of continuous resize events.
Fix inverted logic in ohci(4) when switching between SMM keyboard+mouse mode.
Fix various issues with ste(4): ignore phantom phy, deal with unreadable MAC address, etc.
In ftp(1), limit redirect recursion.
Keep track of the number of FPU lazy context switches on all supported architectures for vmstat(8).
Simulate pgup, pgdown, home, and end on Zaurus by using fn + arrow keys.
Make vlan(4) aware of the underlying link state, and report that up to other interfaces layered on top.
Add generic link state hooks to carp(4).
Fix potential security issues in GNU cvs(1) client (CAN-2005-0753).
A source code patch is available.
[Applied to stable]
Enable ural(4) on alpha.
Support 802.11a and 802.11b on Atheros 5211 ath(4). Pure 802.11g mode may also work now.
Support new SiS PCI SATA devices in pciide(4): SiS 180, 181, 661 and 760.
Add initial support for a new platform: Solbourne. Still in its earliest stages.
Use pool(9) allocator for vndbuf's in vnd(4).
Fix issue with isochronous pipes in uhci(4).
OpenCVS progress: much smarter handling of Entries files, and support update flags -P, -A, and -d.
More snprintf(3) cleanup for dhcpd(8), sendmail(8), and dhcrelay(8). We care a lot, even if others don't.
Bye bye libcurses++. It's GPL and nobody uses it.
Plug memory leaks and a potential use-after-free in ctags(1).
In ntpd(8), don't use a reply with negative delay (could happen when -s option used).
Fix vlan(4) tag handling issues and panics when parent interface is not running.
On ppc, generate a SIGTRAP instead of a SIGILL for breakpoint instructions.
Improve Sun4m page table performance by getting rid of an instruction that ends up being a no-op.
Work around a firmware crash in Intel 2915ABG iwi(4) devices in 802.11a mode.
Recognize some more Radeon 9800 Pro, Radeon 9200, and GeForce FX Go 5700 cards.
In ospfd(8), set F_STATIC flag earlier else the default route will end up as non-static
Allow Zaurus installer to install to any of the four possible DOS MBR partitions.
Recognize MegaRAID SATA 8 channel in ami(4).
More snprintf(3) handling cleanup in named(8), user(8), fsck_ffs(8), amd(8), and usb(4). You will thank us later.
Make gcc(1) -Wformat realize that our printf(9) knows about %q and %ll.
Fix NTFS panic due to stubbed out locking code.
Add ueagle(4) driver for ADI Eagle chipset ADSL modems.
Fix an mbuf leak in ral(4).
Make installer deal with DHCP failure due to no link status.
Recognize usb(4) Araneus True Random Number Generator.
Add zaudio(4): audio playback support for Zaurus SL-C3000.
Add pxadmac(4): pxa2x0 DMA controller.
Add luphy(4): a PHY driver for Lucent LU6612 10/100 PHY used on PCI quad port hme(4)'s and other newer Sun systems with hme(4)'s.
In compress(1), apply futimes(2)/fchflags(2)/fchmod(2) before closing descriptors.
Make spamd(8) stutter at greylisted connections for 10 seconds. Most spammers disconnect by then.
When synproxy state is used in pf(4), make sure outgoing proxy packets use the tag from the original state entry.
Add hostapd(8), our new 802.11f Host AP daemon that connects AP's together to track roaming clients.
Add wide-char functions such as wcscmp(3) to libc. Wide char support is very minimal at this stage.
Support some more ural(4) devices.
In bgpctl(8), show if a route is rejected or blackholed in fib output.
On Zaurus, resume only if lid is open and power key pressed.
During install, allow any valid kbd(8) mapping to be specified.
Add blink functionality in ses(4), so that SCSI enclosures are more useful. Document how to do this with bioctl(8).
Support per-prefix weights in bgpd(8), to tip prefixes with equally long AS paths in one direction.
Add -W option to netstat(1) to display 802.11 statistics.
Add new 'redistribute' option to ospfd.conf(5), which tells ospfd(8) to announce certain external routes.
Fix PMTU discovery when tunneling IP-in-IP in transport mode IPSEC.
Make dhcpd(8) log to stderr instead of syslog when -d option is given.
In sppp(4), ignore lcp up/down events in cisco mode.
Increase random stackgap size appropriately for each architecture.
Start sweep for snprintf(3) return value mishandling and truncation, the logical next step after sprintf->snprintf conversion. You will thank us later.
On Zaurus, handle battery-low events by suspending.
Fix pax(1) problem handling ustar entries with exactly 100 characters. Add pax regress tests.
Further restrict the allowed actions in privsep tcpdump(8) depending on command-line options.
Make ehci(4) devices handle suspend/resume without detaching and reattaching.
In em(4), gather error stats with a finer interval.
Deprecate sprintf(3) in libstdc++ and crank major version.
Support ICH6M IDE controllers.
Support Buffalo WLI-CB-B11 in rtw(4).
Begin major overhaul of VPN-related man pages: vpn(8), ipsec.conf(5), and isakmpd.conf(5).
Use vendor ID register for chip-matching in it(4) instead of configuration register patterns.
During install, create all disk, CD, and tape devices found in dmesg.boot, instead of just the ones used during install.
If, at boot, we find an /etc/resolv.conf.save, swap it back so we're in the right state when we start.
Fix rbus on big memory i386 machines (used by cbb(4) pcmcia).
On zaurus, synchronize synchronize ADS7846 and LCD communication to avoid jitter in touchscreen input.
Simplify and unify zssp(4) code.
In mount_* utilities, properly handle realpath(3) failure.
Enable checksum offloading and VLAN frame rx in re(4) and vge(4).
In pxaudc(4), clean up properly in case of attachment failure.
Handle at least the first port of a dual-port ufdti(4).
Recognize QLogic 2312 and 6312, Dell OEM 2312 isp(4) cards.
Mount UDF 'c' partitions with no fuss, just as we do with ISO9660 'c' partitions.
Plug a memory leak in isakmpd(8) message handling.
Make pdc(4) 64-bit friendly for hppa64.
No longer install ti(4) tigon firmware because of unresolved licensing questions.
OpenCVS continues to mature. RCS locks now supported. More branching features supported.
In ospfd(8), re-check expired LSA for updates before purging it.
Better support for short string-based WEP keys from ifconfig(8). But don't use them.
Allow ftp(1) to properly retrieve URIs with colons in them when specified on the command line.
Fix some incorrect register comparisons in creator(4).
Begin simplifying code in isakmpd(8). We have some cool features coming that need this.
Add support for TCP SACK statistics.
Properly protect WANPIPE ioctl(2) in san(4).
Enhance detection of supported devices in bioctl(8).
Add new -T flag isakmpd(8) to disable NAT-T from the command line. Makes binat setups happier.
Make ifconfig(8) complain if someone tries to set a multicast MAC address.
When media is loaded into SCSI cd(4) drives, don't send commands that might confuse the device. Speeds up device initialization.
Support blink and unblink for ami(4) RAID. This lets you identify which drive in an array needs servicing by blinking the drive's LED.
Add ipsecctl(8) to the tree: our new IPSEC flow manipulation tool. This allows us to quickly create and tear down IPSEC flows without using IKE.
Support ICH6 audio devices in auich(4). You'll find these integrated on many Intel SouthBridge motherboards.
Work around a hardware bug in sis(4) with short cables. Also fix excessive collisions in half-duplex mode.
Make interrupt sharing work on bge(4).
Recognize PRO/Wireless 2915ABG in iwi(4) driver.
Ignore mygate(5) when using dhcp on any interface. Lets you easily switch between a statically-configured interface and a dhcp interface (nice on zaurus).
On i386, allow ptrace(2) to examine and change SSE/SSE2 registers.
Implement yacc-based parser for sasyncd(8) config.
Simple sparc performance improvements: inline some small pmap functions and provide a real pmap_kremove(9) implementation.
In dc(1), fix raise (^) for negative exponents.
Initial support for installing/upgrading via IPv6.
Fix hostap mode and a device timeout error with ral(4).
Add initial support for our next platform: hppa64. Matured in mighty ukrainian oak for 23 months.
Support setting the MTU on ex(4).
Improvements to san(4): make tcpdump work, make ppp mode work, use ifconfig(8) mediaopts to switch between ppp and cHDLC modes.
Avoid a vclean deadlock in procfs.
Make sure all wireless drivers check ioctl(2) permissions in a consistent fashion.
In NFS, manage nfsreq objects with pool(9). Allows more control over resource consumption.
Implement command execution when limits are exceeded in sensorsd(8). Send email if your computer catches fire.
Report cache size for amd CPUs. Only try to enable PowerNow if processor supports it.
Handle burst size of 64 in hme(4).
Improve booting speed by only retrying SCSI commands when they are likely to succeed.
Support antenna selection for ral(4).
Sync RF and BBP code in ral(4) and ural(4), for later merging.
Initial support for uftdi(4) 2232c dual usb.
Add stat(1) command.
Allow em(4) hardware VLAN support to be disabled dynamically.
Add support for polled umass(4)/SCSI transactions. Fixes a panic seen at reboot after writing to umass devices.
Install known issuers CA bundle to /etc/ssl/cert.pem so browsers using libssl don't bitch about certs signed by these issuers.
Change quota(1) so it means KBytes when it says KBytes and blocks when it says blocks.
Disable write gathering for NFSv3. Big performance boost.
Fix preposterous time warnings in nfs client caused by false hits in the attribute cache.
Vax flag day: reduce MAX and Default DATA Segment sizes to leave more mmap space for use by mmap_malloc.
Make sure rcp(1) and scp(1) copy argv instead of overwriting it. This lets ps(1) output make more sense.
Add support for crypt authentication in ospfd(8).
Enable checksum offload for rx in em(4).
Output tcpdump(8)'s final capture summary to stderr so it doesn't get mixed in with capture data.
Make adduser(8) friendlier by only showing top-level login classes.
Make apm(8) work better on zaurus: avoid sticking on "battery full" signal, report battery life even while charging.
Add sasyncd(8) to the tree: our new IPSEC synchronization daemon.
OpenCVS: eliminate a lot of duplicate code in command processing.
Make ohci(4) suspend and resume work on zaurus.
Restore all registers on ohci(4) resume to cope with power loss on suspend, which leaves controller totally unconfigured.
Make bgpd(8) privsep parent open listeners on demand. Eliminates the potential for race conditions.
Clean up and consolidate the interface validation code in bgpd(8).
Make reading sparc core files in gdb(1) work.
Enable StackGhost on sparc64: a really nifty protection mechanism we developed for this architecture.
Add new RAID management program: bioctl(8).
Add support for UDF filesystem (generally used on DVDs).
DNS resolver now automatically updates itself when it detects resolv.conf has changed.
Add lladdr command to ifconfig(8) to set MAC address.
Switch i386 over to DWARF-based exception handling.
On zaurus, handle apm_battlow flag by suspending.
Improve security of checknr(1): handle argv correctly and make sure to NUL terminate all arguments when copying.
Add strcasestr(3) to libc: a case-insensitive version of strstr(3).
Remove line-length limitations in diff3(1).
Add -F option to arp(8) to force replacement of entries.
Zaurus now allows power button to suspend (2 seconds) or nice halt (6 seconds) if machdep.kbdreset=1.
Allow fdisk(8) to set partition flag with explicit value.
New thread-safe version of realpath(3) that does not use chdir(2) at all.
Initial support for tctrl(4) device on SPARCBooks (currently limited to power change events and battery status retrieval).
Improve tctrl(4) on sparc: program PCMCIA and power icons on 2nd line of LCD screen.
In bgpd(8), check for IFF_UP when validating routes.
Always use network byte order in isakmpd(8) when stuffing port numbers into IPSEC ID packets.
Clean up some de(4) code and fix Intel 21143 in full-duplex mode.
OpenCVS: start using the public-domain yacc(1)-based date parser. cvs dates can be ugly and this simplifies things quite a bit.
Recognize Radeon 9200 PRO variants.
Print UDF filesystem type in disklabel(8).
Fix an issue with ABNT2 keyboards that was stealing the slash key from .br users.
Make linewrap computation more POSIX-compliant in dc(1) programs. Adjust regression tests accordingly.
Add support for relocation type R_ALPHA_SREL32 to Xserver(1)'s ELF loader.
Rip out httpd(8)'s homegrown md5 and sha-1 implementations, use ours.
Change root login shell to ksh(1). And there was much rejoicing.
Use USB timeout periods instead of SCSI timeout periods in umass(4).
Make uhub(4) less chatty at startup.
Use getopt(3) in logresolve(8).
Dynamic call stack support in dc(1).
De-#ifdef the em(4) driver because it just leads to bugs.
Fix potential crash in bge(4).
Utilize new kbd(8) -l support on the install media.
Support another fxp(4) variant.
Provide support for the -l option in kbd(8) even if kvm support is not compiled in.
Improve hppa support for compat_hpux(8).
Shrink handling of kbd(8) in the install scripts.
Simplify privsep state engine in tcpdump(8).
Add an Objective-C regression test.
On the zaurus, delay slightly at reboot time to permit disk to de-cache or de-spin or whatever it is doing (attempting to avoid some filesystem corruptions).
Repair boot argument parsing on the zaurus.
Enable multicast support in atw(4).
Enable swap encryption by default. Use sysctl.conf(5) to disable if you wish.
hppa tape and cdrom booting now work.
Use font adding on the SPARCbook; use the ROM font in the pninek(4) so that the kernel messages line up with the rom messages.
Enable font adding on sparc.
Ongoing development in osfpd(8).
Fix a SIGCHLD signal race in osfpd(8).
A variety-pack of shrinkage in the ramdisk install script.
Adjust wording in a few APIWARNings.
Pad hppa ramdisk to 64K, resolves issues with some ROMS.
Fix APIWARNS on i386; ie. cope with moving to version 3 of gcc(1).
Prepare for more RAID-like functionality in ccd(4).
In a few programs, do not assume that optopt is valid in non-error return cases from getopt(3).
If the full memory window is not mappable in pcic(4) (because of lots of BIOS mappings) try to use smaller mappings.
Use getopt(3) in htpasswd(1).
Since scsi START_STOP is an optional command, do not require it to work. This may help some umass(4) devices.
vlan(4) error counter repair.
Change ahc(4) to prefer memory mapped IO.
Use microuptime(9) in sppp(4), because mono_time is no longer always there.
If scsi disks are found to contain more than the maximum supported blocks, truncate to maximum size.
Support bcrypt(3) passwords in htpasswd(1).
Missing range check in vfs_hang_addrlist().
Support another pcmcia(4) ne(4) variant.
Continuing work on OpenCVS...
In zx(4), use a shutdown hook to put display back in PROM-compatible mode.
Fix 32-bit mode in cgfourteen(4).
On SPARCbooks, cope if the pninek(4) blitter does not wake up.
Power control changes for SPARCbooks.
Fix some detach crashes in ath(4).
Packet counting fixes to ipw(4), iwi(4), ral(4), and ural(4).
Print MAC address on startup in ural(4).
Various improvements to ospfd(8), mostly catching up to shared bgpd(8) sections.
Fix various bugs in sppp(4) that help the san(4) T1 driver.
Add ospfd(8) chunks to /etc/rc and /etc/rc.conf.
Silence underrun/overrun errors in the auich(4) driver.
Fix chipset version errors in the i810 agp driver.
Handle :: effects in LD_LIBRARY_PATH in the i386 codepath through ld.so(1).
Let isakmpd(8) compile when nat traversal is disabled.
bind 9.3.1.
More sane interrupt priority levels, thereby fixing com(4) IO on the zaurus.
Avoid leaking keynote(3) sessions in isakmpd(8).
Be more careful in sparc compat_svr4(8).
Crank to 3.7-current
--------
Changes made between OpenBSD 3.6 and 3.7
Last minute fixes to WEP and reset in ath(4).
Adjust the selection of devices (based on expected popularity) on the very important i386 "laptop" floppy.
Repair AR5212 descriptor handling in ath(4).
Repair some spl(9) races in ural(4).
Repair rate adaption in ural(4).
Check channels 12, 13, 14 also in ral(4) and ural(4).
Disable aac(4) because Adaptec is run by total assholes who will not give us documentation on their RAID controllers. They will be the first against the wall...
A very cute Linux "ipkg" installer for the Zaurus.
Use the IFQ_* macros in ath(4) so that pf(4) queues will work.
Improve AR5212 initialization in ath(4).
Add IBSS and HostAP support to ural(4).
Fit lots of nice new drivers onto the i386, amd64 and macppc boot media.
Handle odd-length management frames in ural(4).
Back out a mistaken byte-order bug fix recently put into isakmpd(8).
Hurray. OFDM modulation now works in ural(4)!
Fix USB detach in the ural(4) driver.
Typical INSTALL.* repairs just before a release.
Support Option GlobeTrotter 3G in the ubsa(4) driver.
Silence noisy irrelevant messages from rtw(4) driver.
By increasing a timeout, fdformat(1) now works on sparc64.
Fix an important file descriptor passing bug in bgpd(8).
More changes to ospfd(8): we hope it is minimally ready for use in OpenBSD 3.7.
HostAP support in ral(4).
Change the daily(8) script to not remove .ICE-unix in either /var/tmp or /tmp.
bc(1) had a bug regarding EOF before newline... now fixed.
Big-endian support (and 64-bit, perhaps) for ural(4).
In chown(8) and chown(2), document that setuid/setgid bits are cleared when uid or gid are changed.
Meet ural(4) -- a driver for the Ralink Technology RT2500USB 802.11a/b/g chipset.
Change the daily(8) script to not remove .X11-unix or vi.recover in either /var/tmp or /tmp.
Fix double-counting of statistics in the em(4) driver.
When bgpd(8) reparses and finds errors in the configuration file, it should not attempt to merge this data into the running state.
On amd64, range check the "to" address of copyoutstr(9) more carefully.
A source code patch is available.
[Applied to stable]
Bug a memory leak in the ftp code path in faithd(8).
The Zaurus zkbd(4) prefers to run at IPL_TTY instead of IPL_BIO.
Enable hotplug(4) on macppc.
In macppc VGA driver, skip empty PCI ranges rather than aborting probe.
Correct configuration file line number counter in isakmpd(8).
A huge list of improvements cgfourteen(4) driver.
In sparc sbus(4) driver, if no "intrs" property try to utilize the "interrupts" property.
In pf(4), correct the byte order of MSS tracking in the synproxy code path.
Use the IFQ_* macros in re(4) so that pf(4) queues will work.
zkbd(4) needs more delay for discharge to avoid key rollover effects.
carp(4) should avoid tearing down routes in the carpdev case.
Support JVC MP-PRX1 in axe(4).
Add missing WSDISPLAYIO_[GS]VIDEO ioctl handling to several sparc video drivers.
Print out port numbers using host byte order in systat(1).
In Allow WEP MAC to be NULL for WEP broadcast keys in ath(4).
Fix a potential carp(4) crash that could occur when CARP_LOG is being used.
Fix printing of carp link addresses correctly in netstat(1).
When bgpd(8) fetches routing table, inherit the ifindex regardless of address family.
Tell init(8) to turn off accounting when switching to single-user mode.
In ntpd(8), handle errors from syscalls more gracefully.
Fix a tricky bug in pxeboot(8): on return from real mode, reload GDT using a 16-bit pointer rather than a 32-bit value.
Use "PXE env" calling rather than "PXE bang" calling into PXE BIOS for older spec PXE systems. Makes pxeboot(8) work better on older systems.
In apm(8), read battery voltage only once during calculations, which makes battery life estimates on zaurus more sane.
Fix panic trying to clean up non-existent interrupt handler when wi_attach fails in wi(4).
Support USB1 devices located beyond USB2 hubs. USB1 keyboards and network interfaces now work when connected to a USB2 hub.
In EHCI be even more liberal about what we accept as a completed transaction: some USB2 devices leave warning bits on when they shouldn't.
Clean up some error-path memory and descriptor leaks in popa3d(8).
Recognize a bunch more of sk(4) SysKonnect-based PCI devices.
In ipw(4), retrieve scan results from net80211 instead of from the NIC internal memory. Fixes a bug with multiple AP's.
Add "show rib" and "show rib detail" to ospfctl(8).
In syslogd(8) secure mode, shutdown(2) the incoming side of the Internet socket rather than just ignoring data.
Also improve rtw(4) diagnostics and make sure if_flags is consistent on reset.
For rtw(4), improve beacon and mgmt frame handling.
Be quite explicit about error behavior in getaddrinfo(3) man page.
Implement "greytrapping" for spamd(8). Blacklist hosts that send to spamtrap addresses.
In tip(1), detect illegal frame sizes. Fix file transfer when remote end is using emacs line-editing mode.
Make RTS protection mode and 802.11g work for ral(4).
Implement fast channel switching for ral(4). Kismet uses this.
Fix tx rate of beacons and management frames in 802.11a for ral(4).
Now support all options in OpenCVS "cvs admin" command.
Clean up printing of pf(4) rule numbers in tcpdump(8).
Add "transparent-as" to bgpd.conf(5): tells bgpd(8) to not prefix its AS to outgoing updates.
On the zaurus, apm(8) can now report estimated number of minutes left.
Sweep the tree for bind(2) calls with AF_UNIX/AF_LOCAL made without first setting umask(2). This could lead to race conditions. You will thank us later.
Recognize the Freescale 7447A processor as found in the Mac mini.
Enforce per-uid limits on the number of lockf(3) advisory locks a user can create. Add a new sysctl(8) to tweak this limit: kern.maxlocksperuid.
Avoid NULL pointer access during exchange finalization in isakmpd(8), which caused a crash with some configs.
[Applied to stable]
Add -n switch to mg(1) to disable backup file generation.
Upgrade to OpenSSH 4.0 (support hashing hostnames and IP's in known_hosts, improved password expiry support, sftp command history, etc.).
Recognize ral(4)-powered Cisco-Linksys Wireless-G USB Network Adapter.
Continue sweep for snprintf return value handling: most libc functions as well as ftp-proxy(8), tftpd(8), and httpd(8)'s mod_keynote are cleaner.
Support reading from and writing to floppy drives on Ultrasparcs.
Improve output of fmt_scaled(3): round fractionless numbers correctly and add some regression tests.
Fix a page fault in NTFS filesystem support that occurred when a reclaimed vnode is reused.
Recognize a ton more atu(4) wireless devices from many vendors (3com, Atmel, Linksys, Netgear), including some fairly obscure ones.
Do not unqueue EHCI interrupt QH's immediately after initialization. Improves performance for interrupt-transfer devices (mostly network cards).
tcpdump(8) now groks 802.11 protocol.
Recognize GeForce FX Go 5200 cards found in the latest 12" Powerbooks.
Let bge(4) devices work on macppc. Support for other big-endian architectures (sparc64) to follow.
Support NetMos 9805 parallel-port puc(4) card.
Track interface up/down state and media status in ospfd(8).
Ignore USB2 XactErr status if EHCI controller indicates success on retry. Improves performance with bad cabling and probably makes us compatible with a wider range of devices.
Work around VIA EHCI controllers that stall on large, fast USB2 data transfers.
Support Intel SpeedStep adjustments for ultra-low-voltage Pentium M processors: 723, 733, 738, 753, 758, and 768.
In wi(4) driver, support I-O DATA WN-B11/CFZ pcmcia(4) wireless card.
Document all supported modes in the man pages for each of our wireless devices.
OpenCVS: initial support for 'cvs admin' command.
In tcpdump(8), support multiple data-link types using -L and -y options.
Make sure incoming IPv6 packets on loopback get processed by pf(4) as they are for IPv4.
Implement rcs(1) program in OpenCVS.
Add RFC 3947 vendor ID string for NAT-T negotiation in isakmpd(8).
Port the cgtwelve(4) frame buffer driver to sparc64.
Implement support for the xbox(4) SBus Expansion System on sparc64, which allows frame buffers to be used.
Make TCP SACK handling stricter by checking that received ACKs fit within window.
Keep list of TCP SACK holes within hard pool(9) limits. Allow this limit to be adjusted with a new sysctl(8): net.inet.tcp.sackholelimit.
Improve ath(4) radiotap support.
On the zaurus, let sysctl(8) adjust the generation of apm(4) powerchange messages
In mac68k ae(4), support a bunch more, including the DaynaPORT E/II-3 card.
Move beacon allocation code into generic ieee80211 framework and out of some drivers.
Implement hardware WEP support for atu(4).
Import mbuf handling fixes for atu(4).
Support OQO model 01 internal USB wireless, which turns out to be a varient of atu(4).
Make pf(4) apply tags to all packets matching a state, rather than just the initial packet.
Clean up memory leaks in uucplock(3) and make uu_lock_txfr(3) work as documented.
More network randomness: use arc4random(3) instead of PIDs in login_radius(8).
Make netstat(1) counters work on amd64.
Add sparc support for SUNW,fas SCSI in esp(4).
Allow only superuser to change timeslot ranges and ppp modes on san(4) interfaces.
Support radiotap in rtw(4).
New man page for rssadapt(9).
Fix san(4) to not hang on large packets.
Keep traceroute(8) ttl from wrapping.
In MSDOS filesystem code, fix a panic when trying to write files larger than 4GB -1 byte. Reading files > 2GB now works.
In MSDOS filesystems ignore trailing dots and spaces in filenames are ignored to stay compatible with Windows.
Support MSDOS filesystems > 128GB by using a new hashing strategy.
Make sure errno does not get reset before returning from opendir(3), setmode(3), and rcmd(3).
Increase default number of usb device nodes to 6 for systems with many onboard USB devices (like Mac minis).
Fix integer wrapping in ffs that caused decreased performance reading past 2GB boundary in large files.
Add support for hashing host names and addresses in ssh(1) known_hosts files for more privacy.
Allow optional specification of bind address for ssh(1) port forwarding.
Shrink Zaurus kernel significantly by removing inlines.
Add radiotap, monitor, and promiscuous mode support for ral(4).
Make ral(4) do per-node rate adaptation. Paves the way for ibss support.
New perlpod(1)-style documentation for package-management APIs.
Document timeout on untrusted x11 forwarding sessions in ssh_config(5).
Allow SGC frame buffers to be used as console on hp300. Also allow serial console mode to be forced by hardware switch on 425e models.
Support 'tagged' keyword in translation rules in pf(4)
Improve RTT calculation code in TCP packet handling.
A source code patch is available.
[Applied to stable]
Add shortest path calculation in ospfd(8).
Fix sd(4) support for Hitachi DK23DA drives.
Improve RCS support in OpenCVS.
Make ftpd(8) privsep code quieter and more reliable in case of EINTR/EAGAIN.
Fix memory leaks in pfctl(8) parser.
Support atheros ar5211 802.11A/B/g wireless chipset in ath(4).
Get rid of -P option for isakmpd(8), which was never useful.
Correct bus_dma usage in re(4) which fixes alpha. Enable re(4) on alpha now.
Support software WEP in rtw(4).
Support integrated s3 video components from via.
Be precise in libc man pages when talking about nul ('\0') vs. NULL.
Fix some more bugs in atu(4).
Support Zoltrix TV/FM in bktr(4).
Reliability fixes for ccd(4) mirroring.
Add new -N option for isakmpd(8) to select port for udpencap. Allows multiple NAT-T isakmpd instances on a single machine.
Continue auditing tree for snprintf(3) return value handling: apply(1) is now clean. You will thank us for it.
Add regression tests for copystr(9) bounds-checking.
Fix a rare panic during init(8) seen under VMWare.
Document the 'source-track' stateful tracking option in pf.conf(5).
Stop isakmpd(8) from responding to 0-length packets. Makes ISAKMP quieter to port scanners.
Initial support for suspend/resume on zaurus.
Better error messages in isakmpd(8).
Enable hme(4) on sparc to take advantage of TCP/UDP checksumming in hardware.
Automatically blank screen on zaurus when hinge closes. Still need hysteresis to avoid rapid on/off cycles when bouncing.
More OpenCVS progress: privsep cvsd, handle noop, support -c and -s for checkout, send server stderr output to client.
Make ntpd(8) realize quickly when no network is available, so we wait less time when booting disconnected.
Call tzset(3) before chroot(2) in tftpd(8).
Reliability fix: rl(4) was improperly handling unaligned packets in IP input for architectures that care about alignment.
Enable ral(4) in i386 by default.
Support more Intel 6300ESB SATA controllers.
Enable memory-mapped I/O on ahc(4) SCSI controllers on macppc, resulting in more supported controllers and better performance.
Automatically enable SSH batch mode when in sftp(1) batch mode.
Make reboot from ddb(4) work properly on sgi.
Change CPU target on m68k to -m68020-60, which improves best-case performance without penalizing 68040 processors and below.
Make df(1) deal better with large filesystems.
New tool getcap(1) for querying capabilities databases.
Double the default value of MAX_KMAPENT to 2000 (more uvm for heavily loaded systems).
New iwi(4) driver for Intel PRO/Wireless 2225BG wireless PCI adapters.
Program the LEDs on rtw(4) devices based on activity.
Create new man page for the mutex(9) set of functions.
Remove embedded compilation dates from amd(8), ppp(8), and perl(1) so that binaries don't change all the time.
Support internal USB wireless adapters on PCChips A535 notebooks.
New, less restrictive license for the new ieee80211 framework and new ath(4) driver.
Better error messages for getnameinfo failures in ssh(1).
New USB driver for zaurus.
Make ieee80211 framework do a best-match instead of perfect-match when finding a node for a beacon.
Cleanup in the new ral(4) driver, add software WEP.
Print interface names in route(8)'s monitor mode when they go up and down.
Reenable ehci(4) on macppc.
Fix scoping errors in Apache's SSL engine, timed(8), and bad144(8).
Support enabling amp power on certain ac97(4) chips.
On isakmpd(8) shutdown, send delete messages for isakmp SAs.
New X11 pointing device driver for zaurus' touchscreen.
Remove useless always-changing compilation timestamps that are put into various binaries such as named(8), lynx(1), ppp(8), and others.
More progress on OpenCVS; basic repository handling code.
Support point-to-point links in ospfd(8).
Fix scoping errors in ath(4) and macppc's macintr code.
Provide better diagnostics when ssh(1) identity files are not accessible.
Add /usr/X11R6/bin to the default $PATH in the skeleton .cshrc and .profile files.
For installations and upgrades, allow the user to complete the process without installing all required sets.
Fix a kernel panic related to setting interface media.
Fix a bug in pfsync(4) that could cause some states to be erroneously purged.
New ral(4) driver for Ralink Technology RT2500 wireless adapters; not yet enabled.
Add a manual transmit power option to wi(4) and ifconfig(8); supported by some Prism2/2.5/3 cards in hostap mode.
More work and bug fixes on OpenCVS.
New pkg_mklocatedb(1) command to create locate(1) -style databases for packages.
Import some new features for rtw(4).
Enable atu(4) on macppc.
Fix a potential kernel panic in hp300's serial port interrupt handlers.
Eliminate a race condition in hp300's ppi(4).
Don't close Apache's SSL cache dbm before reading from it.
Don't crash during ahc(4) probe routines.
Import X11R6.8.2.
Enable bktr(4) on amd64.
Fix '-d' option to pkill(1).
More hacking on ospfd(8).
More httpd(8) code cleanup.
xsystrace(1) gets a policy destructor.
Plug some memory leaks in pstat(8).
On i386, range check the "from" address of copyoutstr(9) more carefully.
A source code patch is available.
[Applied to stable]
For amd64, build bn routines in libcrypto with the amd64-specific file to give a significant speedup for RSA.
Support Billionton Systems CFLT2 Compact Flash adapter in ne(4).
Truncate levels set with mixerctl(1) to be within the minimum and maximum values.
Repair seekability of a gzstream in grep(1).
Prevent carp(4) from attaching to other carp(4) interfaces.
Fix a panic-causing merge error in rtw(4).
Import sudo-1.6.8p7.
Support for Seeq 80225 PHY in sqphy(4).
Attach 3com 3c905C PHY with bmtphy(4).
Add some sanity checks to ospfd(8).
Add RX TCP/UDP checksum offloading to hme(4).
Fix setting 128-bit WEP keys on big endian archs.
Import and merge X.org X11R6.8.2rc4.
Simplify ifstated(8) syntax.
Import libarch for arm to allow for cache flushing, use it in the X11 loader.
Enable siop(4) on amd64.
Limit PERLIO_DEBUG environment variable to a sane length and ignore if setuid in perl(1).
Fix a few memory leaks in mixerctl(1).
Introduce POSIX hex and octal constants in arithmetic expressions in ksh(1).
More work on ospfd(8) and bgpd(8).
Replace broken frexp(3) with a working one from FreeBSD; share across platforms.
Backout previous NFS time warnings change; too close to release.
Proper permission enforcement in NTFS mount requests.
Sprinkle more paranoia on dhcpd(8)'s currently-acked lease database.
Use the Ethernet source address of a DHCP request instead of the one included in the DHCP packet in dhcpd(8).
Add OpenEXR image support to file(1).
Steady progress on OpenCVS.
Make zaurus' LCD brightness adjustable by wsconsctl(1).
Add mouse button emulation to zaurus.
Detect and warn about editors that move crontab(1)'s edited file out from underneath it.
Fix DontVTSwitch option in X11 when not using XKB.
Fix X11 breakage on vax and other archs without shared libs.
Avoid a null pointer dereference when deleting non-fully-established SAs in isakmpd(8).
Add more reason counters in pf(4), altering pfctl(8) and tcpdump(8).
Fix a memory leak in dhcpd(8).
Check the carpdev link state when attaching a carp(4) device to it to avoid preempting after a reboot.
Fix a broken uplcom(4) driver resulting from a previous merge error.
Add zts(4), a touch screen driver for zaurus.
Widen the columns in df(1) to accomodate modern large filesystems.
Import ospfd(8) and ospfctl(8), an OSPF daemon and its controller.
Make network unreachable errors in ntpd(8) non-fatal.
Import and merge X.org X11R6.8.2rc3.
Fix a bug in the rnd device which caused it to block on reads from srandom.
Add X.org support pieces for hp300 using the wsfb video driver and drop kick the old hp300 X11R5 server out of the XF4 tree.
Fix a denial of service in the validator code in the BIND resolution library.
Add a new device for the dedicated SSP unit on zaurus to report battery information to apmd(8).
Enable mavb(4) on sgi.
Switch hp300 wscons code to rasops for DIO frame buffers.
Import a new moduli(5) file.
Fix preposterous time warnings in the NFS client caused by false hits in the attribute cache.
Avoid a signal race condition in dump(8).
Enable sgc(4) and sti(4) devices on hp300.
Log source of connections denied by sshd(8)'s AllowUsers, DenyUsers, AllowGroups and DenyGroups options.
Warn in advance in sshd(8) for password and account expiry.
Enable zaurus apm/scoop drivers and report A/C power status correctly.
Fix i386 disassembler in binutils.
Use a packet's address family instead of the rule's when selecting a replacement address for an rdr rule in pf(4).
Change 'syncif' to 'syncdev' in ifconfig(8) and pfsyncreq ioctl struct.
Expire ipforward_rt cache in ip_slowtimeo.
Fix the '-S' flag for non-root in ftp-proxy(8).
Fix the '-I' option with '-D', '-T', and '-t' in ping(8).
Have ssh(1) keyboard-interactive code call the authentication drivers even for responses to invalid logins.
APM emulation framework for zaurus, as well as a scoop driver.
Use the correct source address for ICMP errors generated from packets that were not addressed to the machine.
Drop more privileges in popa3d.
Support hotplug on zaurus.
Add support for zaurus LCD controller.
Support Microsoft PCI/CardBus and Hawking CardBus adapters in dc(4).
Zaurus X11 support.
Import and merge perl-5.8.6.
Support the nForce2 Ultra 400 IDE controller.
Import and merge X.org X11R6.8.2rc2.
Make sure a given interface is running before touching the multicast filters.
Support the Psion Dacom Gold Port Ethernet device in kue(4).
Add screen rotation support to the X.org wsfb driver.
Switch hp300 port to wscons, still using on-board ROM fonts for now.
Use PCI Memory Write and Invalidate in fxp(4).
Add Protocol Independent Multicast (PIM) support.
Add Bluetooth protocol stack and ubt(4) USB driver support adopted from FreeBSD and de-netgraph-ified.
Remove old, unused ifgroups ioctls.
Using cc -Wbounded, support bounds checking for copystr(9), copyin(9), and copyinstr(9).
Cardbus re(4) support.
Sentinal support in gcc, taken from gcc 4.
Fix a kernel panic when pushing heavy traffic through ipw(4).
More progress on the zaurus port including keyboard, USB serial, wscons, reboot and powerdown support.
Fix i830 crash during startup in the X.org driver.
Import Sendmail-8.13.3.
Fix an off-by-one in the critical section clearing code of the aic7xxx driver; from FreeBSD.
Remove an annoyance in mg(1) when editing files where the working directory is not readable.
Reliability fixes for hil(4).
Make sure bogus values don't make their way into tcp_xmit_timer() calculations by converting them to valid ones.
[Applied to stable]
Add support in uplcom(4) for CTS modemsignal; from FreeBSD.
Add zaurus bootblocks.
Add support in iwi(4) for 2.2 firmware and other minor fixes.
Add new shortcuts for device and debug commands in cdio(1).
Increase the maximum username size for the in-kernel PPPoE driver.
Read MAC addresses correctly when initializing dc(4) interfaces.
Fix an infinite loop problem in certain options in vi(1).
Fix a potential buffer overflow with escaped characters in Apache's mod_include.
[Applied to stable]
Handle symlinks correctly in savecore(8) when determining if /var/crash has enough free space to dump.
Make carp(4) traffic always appear on the physical (carpdev) interface from pf's perspective.
Add BIOCGDLTLIST and BIOCSDLT ioctl support to bpf(4).
Fix profiled kernel builds on i386.
Add a preliminary display console for zaurus.
Turn off the GPL_MATH_EMULATE kernel option by default.
Improved import code for OpenCVS.
Add new IPv6 manpages written from scratch.
Make Ethernet packets sent via a carp(4) interface have a source MAC address of the virtual MAC.
Fix a very longstanding bug in getcwd(3) to allow returning very long paths.
[Applied to stable]
Make pfctl 'set' options no longer sticky.
Cleanup of the Zaurus display code.
Restrict forwarding to IPsec traffic when ip.forwarding is set to 2.
Enable ARP table manipulation on carp(4) interfaces.
Move processing of ARP packets to carp(4) interfaces when using them so ARP packets are sent with the virtual MAC address.
A bit more whacking zaurus into shape including USB support for the C3000.
Add support in ubsa(4) for the Vodafone Mobile Connect 3G adapter.
Plug a memory leak in the regex(3) engine; from FreeBSD.
Add a "show panic" command to ddb(4).
Add mavb(4), a Moosehead A/V board audio driver, to enable audio(4) on sgi.
Speed up dhclient on sk(4) interfaces.
Grok VLAN-sized frames on am7990 devices.
Fix some races on filesystems that don't have locks, such as NFS.
Enable rtw(4) driver in i386 GENERIC.
Import zaurus port, currently supported on the C860.
Preliminary support for the arm pxa270, pxa interrupt controller, pxa serial port, pxa PCMCIA (CF) adapter, and xscale.
Flag day! Switch i386 to gcc3.
Add a copy of the stripcom routine to netstart(8) so it can run standalone again.
Import M_CANFAIL support from NetBSD to remove a nasty panic during low-memory scenarios.
Import awk-20041222.
Add support in md5(1) for using multiple algorithms.
Add an rtw(4) driver for Realtek 802.11 devices.
Sync ieee80211 infrastructure with NetBSD to simplify logic and fix some bugs.
Fix a bug that caused vinvalbuf() panics.
More work on pkg_add(1) conflict handling.
Fix tag handling for non-U320/packetized ahd(4) devices.
Import and merge gdb-6.3, and add sgi support.
Fix broken pointer arithmetic when receiving an RSA key from the kernel in isakmpd(8).
Sprinkle list and queue macros on various drivers where applicable to make code easier to read.
Resolve some longstanding issues and reduce verbosity while debugging with ami(4).
Add minimal USB support to the RAMDISKC image.
Introduce a -DSMALL variant of ifconfig(8) for installation media.
Import and merge gcc-3.3.5.
Support AddressFamily in sshd_config(5) in sshd(8).
Reliability fixes in wscons(4); from NetBSD.
Make com1, 2, and 3 work as a console on i386.
Lower latency in bgpd(8) by processing no more than 25 messages at once for each peer.
Fix a few core dumps in ksh.
Avoid a null dereference when using membufs in syslogd(8).
Introduce 'set sip on <ifspec>' in pf(4) to avoid filtering on interfaces.
Support filesystem firmware loading in fxp(4).
Do more in the watchdog reset on Prism wi(4) cards to help recover from a wedged firmware.
Remove fallback AES support for old OpenSSL in ssh(1).
Add support for more commands in OpenCVS.
Add powerhooks to ipw(4) and iwi(4).
Create new icmp6(4), gai_strerror(3), getaddrinfo(3), and getnameinfo(3) man pages from new or free sources.
Discard unnecessary trailing space characters in ps(1).
Support filesystem firmware loading in yds(4).
Add support for displaying Shared Spanning Tree Protocol frames in tcpdump(8).
Remove various man pages and other documents that were based on RFCs due to licensing problems.
Import X.org 6.8.2 RC1.
Add a gzip handler to OpenCVS; not yet enabled.
Allow comments in the myname, mygate, and defaultdomain files from within netstart(8).
Support filesystem firmware loading in uyap(4) and clcs(4).
Block SIGALRM during writes in script(1).
Make it possible for carp to work on fddi and token ring again.
Cleanup ksh(1) and remove unused #ifdef'd code.
Fix an off-by-one error in sail(6).
Fix a bug in pf(4) where a NATed LAN client could lock up the kernel.
[Applied to stable]
Reorder code to make CARP(4) operate correctly on physical interfaces that are participating in a bridge(4).
More progress on pkg_add(1).
Import Sendmail-8.13.2.
Polled servers that resulted in an error are dropped to the maximum poll interval in ntpd(8).
Fix an off-by-one in sk(4); from FreeBSD.
Fix a double-free crash in pfctl(8).
[Applied to stable]
Support the 'tag' command in OpenCVS.
Allow the Address, Network, or Netmask values of the <IPsec-ID> to be specified with an interface name or the keyword "default" in isakmpd(8).
Prevent a possible endless loop in pf(4).
[Applied to stable]
Support filesystem firmware loading in txp(4).
Enable yds(4) on amd64.
Only warn in cp(1) when copying a socket to make moving trees containing sockets across filesystems much smoother.
Make mc(4) on mac68k start working.
Discard replies with an invalid stratum in the ntpd(8) client code.
Fix a panic in atu(4) on sparc64.
Permit long protocol names in tcpdump(8).
Support more Buffalo PCMCIA NS2K devices.
Support csh-style ! history completion in ksh(1).
Support the nForce3-250 IDE controller.
Correct an error in a compare function in disklabel(8).
Fix a bus hanging problem on fast systems with bge(4).
Fix a rare command ordering problem in the aic79xx driver; from FreeBSD.
Allow pf(4) to filter on route labels
Handle GNU-style checklist files for files with spaces in md5(1).
Fix an IPsec crash. (PR#4025)
[Applied to stable]
Fix ls globbing in sftp(1).
Support for jumbo frames and a bus hang fix for bge(4).
Plug a memory leak on mount failure in the ntfs driver.
Support the annotate command in OpenCVS.
More work on pkg_add(1) package replacement.
Fix a soft dependencies problem that caused processes to get stuck.
Fix a race condition that could cause random pool corruption when reconfiguring fxp(4) interfaces under heavy network load.
Fix serial interrupt registration on zs(4) on mac68k; from NetBSD.
Crank maxusers to 32 in mac68k's GENERIC.
Fix a Perl IO bug to avoid duplicating file descriptors when closing handles.
Allow ToS to be set on raw IP packets.
Fix a NAT/T bug in isakmpd(8) to avoid sending DPD messages to the wrong port.
Add powerhooks to wi(4) and em(4).
Add a powerhook to pci(4) to save and restore configuration space.
Support Falcom Twist-USB GSM/GPRS modems in uftdi(4).
Enable jumbo frames on Yukon sk(4) variants.
Add a 'carpdev' option to ifconfig(8) to set a carp(4) device's physical interface.
Make carp(4) behave more like a regular interface like vlan(4).
Lots of various work on OpenCVS.
Support ohci(4) and ehci(4) at cardbus(4); from NetBSD.
Change the default for 'overload <table> flush' to flush only states from the offending source created by the rule in pf(4).
Revert previous soft dependencies merge that could lead to inode wait deadlock.
Make ifconfig(8) default to printing interfaces in the absence of arguments.
Do not log tiny local clock drifting in ntpd(8).
Enable emu(4) in GENERIC on amd64.
Fix a memory access bug in as(1).
Use correct source address for relayed DHCP packets in dhcpd(8).
Discard over-sized authorized_keys entries in sshd(8) rather than complaining about them.
Support mice that have more than 7 buttons in ums(4).
Create a separate gai_strerror(3) man page.
Consider NFS_PORT to be a reserved port as it was before.
Import OpenCVS--a work in progress.
Fixed a bug in pf(4) where IPv6 packets with certain headers were silently dropped.
[Applied to stable]
Add kernel tracking for completed 3-way TCP connections to support connection rate and count limiting code in pf(4).
Fix a signal race in spamd(8).
Remove "route $hostname 127.0.0.1" from netstart(8).
Fix auto-repeat in new X.org keyboard driver.
Import zlib-1.22.
Default to A/UX partition types on newly created partitions on mac68k pdisk(8).
The Great Apache Cleanup of 2004 to remove code we don't use.
Make BUFCACHEPERCENT adjustable through UKC on hp300, mac68k and sgi.
Fix 10mbit mode on ZNYX ZX346Q and 21143-based dc(4) cards; from FreeBSD.
Change spl locking in pfioctl() to fix panics during heavy ioctl operations.
[Applied to stable]
Fix dlsym() when called from the last shared object loaded.
Plug memory leaks in units(1).
Fix stop condition for sqrt in dc(1).
Import a driver for the VIA VT612x PCI Gigabit Ethernet adapter from FreeBSD.
Import a driver for the Cicada CS8201 Ethernet PHY from FreeBSD.
Make Sun type 6 USB keyboards return extended keycodes for 'L' keys.
Make the default X.org Xkb model pc105 like it used to be.
No longer require write permissions for read-only SCSI ioctl commands.
Plug a memory leak in libpthread.
Port tvtwo(4) and vigra(4) sbus framebuffer drivers to sparc64.
Import sudo-1.6.8p5.
Allow pax(1) to build the table of created directories in-memory to avoid requiring a tmp file.
Introduce an IPv4-only in-kernel PPPoE driver; ported from NetBSD and modified to match our SPPP implementation.
Support Garmin Palm devices in uvisor(8).
Privilege separate ftpd(8).
Prevent ADB devices other than mice from generating extended events to help some iBooks.
Fix a bug in RAIDFrame reconstruction. (PR#3968)
[Applied to stable]
Remove a too-paranoid test in libXpm that made writing an XPM with an absolute pathname impossible.
Introduce pfkey sysctl subtree and use it in ipsecadm(8).
Fix a memory leak in SFTP.
Use the TTL from setsockopt() in IP code similar to BSD/OS.
Move mac68k towards a more flexible and generic interrupt system; from NetBSD.
Fix a race between TCP timers.
Fix a dhclient exiting problem by ignoring certain messages sent by dhclient iself.
Various fixes and tweaks for ipw(4) and iwi(4).
Add a CPU number to the STAT field in ps(1).
Disable kernfs in GENERIC because nothing uses it and it is not very safe due to the buffer cache.
Fix false positives when testing valid databases in kvm_mkdb(8) on certain machines.
Enable Kerberos 5 authentication and encryption in telnetd(8).
Fix a crash in pf(4) that occurred when using certain binat rules.
[Applied to stable]
Disable the layer filesystems by default in GENERIC kernels.
Support Intel PRO/Wireless 2915ABG in iwi(4).
Change init process to allow certain umass devices to attach properly; from NetBSD.
Use a prefixlen of 64 on tun(4) interfaces; from FreeBSD.
Support multiple communities in bgpd(8) to eventually support better filters.
Support the gpio(4) found on ath(4) devices.
Support Adaptec ASR2200S U320 RAID in aac(4).
Flat file firmware loading for iwi(4).
Flat file firmware loading and relaxed warmboot detection for kue(4).
Support hotpluggable gpio(4)'s.
Support setting mixerctl(1) values via mixerctl.conf(5) in the rc(8) infrastructure.
Extract the firmware into flat files from ti(4) and neo(4).
Fix some core dumps on malformed format strings in hexdump(1).
Revert part of a previous change in rtl(4) which was causing a performance drop.
Accept VLAN-sized frames in ste(4).
Add net80211 framework to the atu(4) driver.
Fix mpt(4) driver for amd64 machines and VMware.
Restore old aperture code in the i386 X.org video code.
Reliability fix for sysex stop packets in umidi(4).
Better Raven PREP initialization for mvmeppc.
Better i8259 slave handling in openpic(4) device on mvmeppc.
Write reject files in unified format for unified diffs in patch(1).
Allow spaces and other characters in path names in patch(1).
Repair display.focus functionality in wsconsctl(8). (PR#3990)
Unbreak chroot() code in named(8).
Plug a memory leak in PFKEYv2 code.
Support wantlib in pkg_add(1) framework.
Use the filesystem firmware loader in ipw(4).
Fix NAT-D interoperability problems in isakmpd(8).
[Applied to stable]
Support a few more codecs in ac97(4); from NetBSD.
Handle SONPROC in ps, w, and the kernel.
Enable receive() accounting in the kernel.
Announce IPv6 Unicast support in bgpd(8).
Supress multiple connect() failure logging in bgpd(8).
Merge X.org integer and buffer overflow fixes for libXpm.
[Applied to stable]
Import sudo-1.6.8p4.
Fix the QUIT command and implement RSET in spamd(8).
Enable atu(4) by default on i386 and load its firmware with loadfirmware(9).
Add loadfirmware(9) framework for loading device firmware out of the newly created /etc/firmware directory.
Added IPv6 support in tcpdump(8) on enc(4) devices.
Documented the new update framework for bulk builds in ports(7).
Fix memory display in top(1)
Improve logging for advertisement failures from carp(4)
Remove non-standard NI_WITHSCOPEID from libc and utilities that used it.
Add missing counters to netstat carp statistics.
Extract firmware from atmel(4) driver to create and install flat files.
Add a PFSTATE_STALE flag to pfsync(4) to prevent stale state updates from generating updates themselves. (PR#3983)
Decrease latency in sk(4) by lowering interrupt modulation; from NetBSD.
Re-implement LQM in ppp(8) according to the RFC; from FreeBSD.
Fix transmit queue in sk(4) to fix the onboard interface on some Asus amd64 motherboards; from NetBSD.
Fix a jumbo frame issue with 82547 chips in em(4); from FreeBSD.
Receive VLAN-sized frames in bge(4); from FreeBSD.
Work around an Intel 21143 chip bug in dc(4); from FreeBSD.
Print network interface stats with the 'ifstat' command in systat(1).
Add the output of the kern.version sysctl to the daily(8) report.
Add a -E option to pkg_info(1) to search all packages for a given filename.
Enable the progress meter by default in pkg_add(1); use -x to disable it.
Fix a timeout bug in the dart(4) device on mvme88k.
Fix a bug when filtering the ACK of packets from synproxy in pf(4).
Import sudo-1.6.8p2.
Support more 802.11B ioctl's in atu(4).
Import queue timing fixes for sk(4) from NetBSD.
First attempt at pmdb(1) support for mips64.
Import some link change fixes for bge(4) from FreeBSD.
Add support for the Amtel AT76c503a and the Linksys WUSB11 v2.8 to atu(4).
Various fixes to axe(4) from NetBSD.
More bug fixes in pkg_add(1).
Add an "rde route-age" configuration statement to bgpd(8) to evaluate or ignore prefix ages when doing best path selection; defaults to "ignore".
Remove unncessary locking in nvram(4).
Add a umass(4) quirk for iRiver 3xx.
Create a safer IF_INPUT_ENQUEUE macro in if.h.
Add support for the Conceptronic SnapPort USB 2.0 LAN adapter in axe(4).
More paranoia to avoid errors in timeclock(9).
Add PKGPATH support to pkg_info(1) for more useful reporting.
Create a cats install CD image.
Cleanup and KNF in the tun(4) driver.
More work on pkg_add(1) internals; make progress meter useful during package replacement.
New atu(4) USB wireless LAN driver for Amtel AT76c503, AT76c503a, AT76c505, and AT76c505a devices. Not enabled by default yet.
Add support for USB devices to do a full reset of a port during attach.
Cleanup and a bug fix for sgivol(8).
Fix a logic error when using wscons with the standard kbd protocol in Xorg.
Various cleanup in isakmpd(8).
Add inject support to systrace(4) for argument replacement.
Use cc's -pipe flag by default on most architectures when building the tree.
More work on pkg_add(1) internals.
Fix subshell handling in tip(1)/cu(1)
[Applied to stable]
Enable ath(4), iwi(4) and ipw(4) by default on i386 if firmware images are installed.
Fix the Raptor workaround in pf(4).
[Applied to stable]
Add basic control of a running multiplex master connection to ssh(1).
Save space in fdisk(8) and disklabel(8) by gzipping embedded man pages.
Add a "bssid" command to ifconfig(8).
Plug memory leaks in ntpd(8).
Add libedit command editing and history support in sftp(1).
Support more bash-style \letter expansion in ksh(1) prompt variables.
Adjust RTT estimates in the BIND resolver to fix an IPv6 problem.
[Applied to stable]
Fix a memory leak when deleting a screen in vga(4).
Add spamlogd_flags to the rc(8) infrastructure.
Various panic and memory leak fixes in ipw(4).
Fix a potential denial of service in pppd(8).
[Applied to stable]
Revert mpt(4) driver to cope with IBM onboard mpt's.
Initial import and merge of X.Org 6.8.1.
Change the default command history in ksh(1) to 500.
Add a manpage for the evcount(9) API.
Disable -fdelete-null-pointer-checks at -O2 by default.
Import and merge binutils-2.15.
Handle carp(4) interfaces in bgpctl(8).
Remove repeated state change logging and fix a memory leak in bgpd(8).
Memory leak fix in passwd(1).
Reliability fix for a panic in ipw(4).
Compatibility tweaks to ugen(4) and uhid(4) from NetBSD.
Some ehci(4) fixes from NetBSD.
Add BCM5705K and BCM5750/5751 support to bge(4). From FreeBSD.
Handle more gracefully corrupt keys in ssh(1) authorised_keys files.
Fix SIGWINCH handling for multiplexed ssh(1) connections.
Switch powerpc to use GCC 3.x.
Import and merge heimdal-0.6.3.
A couple of reliability fixes for dc(4). From FreeBSD.
Give carp(4) interfaces their own type, IFT_CARP.
Pass the right type to snprintf(3) in asctime(3) (PR#3970).
Modulate the TCP timestamp by a random value for each connection.
Remove assumption that a destination is on-link if the default router list is empty (RFC2461 5.2).
Updates and fixes to ipw(4) and iwi(4).
Add DWARF-based exception handling support for shlibs and dynamic executables in gcc(1).
Add support for setre[gu]id(2) under Linux emulation.
Use clock_getres(2) to calculate the precision in ntpd(8), and fill in the precision field when sending server-mode responses.
In crtbegin, make __register_frame_info() a weak symbol.
In bgpctl(8), try to show the peer description instead of the IP address in 'show summary' view. Revert to IPs with new -n option.
More work on mpt(4).
In the ffs code, don't assume a block is allocated if bread(9) or cg_chkmagic() fails.
Change the new getproto*_r(3) and getserv*_r(3) functions' return value to match the IBM/Digital API.
Allow rdate(8) to accept replies with an NTP version less than 4.
Minimise the delta with FreeBSD for aic(4), ahc(4) and ahd(4).
Start work on update support in pkg_add(1).
Correct some missing braces after an 'if' statement in xl(4).
Have ntpd(8) server mode return the stratum of the currently preferred peer plus one.
Add neighbor solicitation/advertisement messages into/out of the default IPv6 pf(4) rulebase loaded by rc(8).
Backout the change of amd(8) from select(2) to poll(2) due to problems.
Backport some fixes from lynx-2.8.6dev.7b preventing crashes due to memory exhaustion.
[Applied to stable]
Make the xdm(1) greeter able to use non-default login classes (X.Org bugzilla #1676).
Change all the route(8) commands in netstart(8) to use -qn and so not do DNS lookups.
Memleak fixes and cleanup in isakmpd(8).
Merge changes from mod_ssl 2.8.20, fixing CAN-2004-0885.
[Applied to stable]
New ipw(4) and iwi(4) drivers, and ipwcontrol(8) and iwicontrol(8) tools, supporting Intel 2100/2200BG/2915ABG wireless devices. Disabled and non-operational due to silly distribution restrictions on the device firmware files.
Support interrupt transfers on USB 2 controllers, allowing the use of USB 2 hubs with USB 2 hardware.
Disconnect ssh(1) sessions on out-of-range message types.
Pretty up bgpd(8)'s display of groups.
Allow bgpd(8) neighbor definitions to be dependent on interface state. If used with a carp(4) interface, for example, this can be used to reduce failover time.
Add suspend/resume support to ehci(4).
Add -e command-line expression support to bc(1).
Only set up the default IPv6 pf(4) rules on IPv6-enabled systems.
Update timezone data to tz(code|data)2004e from ftp://elsie.nci.nih.gov/.
Add a progress meter to pkg_add(1).
Reduce the amount of information pkg_add(1) displays by default.
Add -e option to dc(1) to evaluate expressions on the command line.
Defer the IP TTL decrement so that an ICMP error with the IP header embedded doesn't have a bad checksum.
Add strnunvis(3), a bounded version of strunvis(3).
Add reentrant getproto*_r(3) and getserv*_r(3) functions. Adapted from NetBSD.
Much cleanup in pciide(4), and some SATA fixups.
Only delete users and groups with -c in pkg_delete(1).
Implement -q and tidy up ICMP support in tcpdump(8).
In ld.so(1), better handle current directory searches listed in LD_LIBRARY_PATH.
Add support for the HTTP proxy CONNECT method to nc(1).
In st(4), fix bogus 'Tape block size...' errors from restore(8) and look for the SDEV_OPEN flag in the right place.
In netstat(1) -r, show only 0.0.0.0/0 as the default route, i.e. stop ignoring the netmask.
In df(1), don't display the header line if no usage lines are shown.
Display the ip_len field in tcpdump(8) with the -v option.
Support some new device types in bktr(4). From FreeBSD and NetBSD.
Only use IPTOS_LOWDELAY on IPv4 sockets in ntpd(8).
Parse pf(4) anchor names in tables the same way as anchor names in rules.
Use the arch-dependent MAXSSIZ instead of an arbitrary fixed value as the upper limit for sysctl(8) kern.stackgap_random.
Performance fixes to dc(4). From FreeBSD.
Handle gracefully a missing EEPROM in an sk(4) device.
Fix a missing brace following an 'if' statement in named(8)'s libdns (ISC #1744).
Use IPTOS_LOWDELAY in ntpd(8).
Allow newfs(8) to create valid filesystems with any legal combination of block and fragment sizes.
Print the expire route metric as a signed value in route(8).
Let cardbus RealTek 8138 devices attach to rl(4). More work to do.
New @sysctl keyword for packing lists.
Set the rootdelay in ntpd(8) server replies.
Improve ntpd(8)'s compatiblity with NTP v3 and earlier.
A number of fixes in ntpd(8).
Sync the installer's install-from-tape code with reality, add a few user interface and error-checking enhancements.
Change dhcrelay(8) to use a UDP socket for communication with the DHCP servers. The old bpf(4) method was forwarding packets out of the wrong interface.
Defer display of MESSAGE files until all packages have been installed.
Many fixes and cleanups in the package tools.
Add support for an 'UNMESSAGE' file to the package tools, used to show the information a package would display on uninstallation without actually uninstalling it.
Rewrite interface groups code, placing all groups on a tail queue, and internally referring to a group by pointer instead of by name.
Remove obsolete -P, -C options and the unimplemented mtree options from the package tools.
Add support for DWARF2 exception handling to libc.
Work around an 'overlapped command' issue on ahd(4)-attached devices slower than Ultra-320.
Inform the softdep code when the mode of an inode(5)'s mode changes. From FreeBSD.
Fix a busted API call when opening a midi(4) sequencer device.
Allow nm(1) to work on cross targets of different sizes as well as endianness.
Don't use 64-bit tests on 32-bit values when testing for void PCI memory regions.
Add another 500 microseconds of delay after a PHY reset, the DP83840A needs it.
Add 1000base*X autonegotiation and 1000baseT master-mode support. From NetBSD.
Update the tail pointer correctly when the hotplug(4) queue is full.
Remove a null dereference in bgpd(8).
Fix a couple of buffer overruns in kbd(8).
Don't ever increment past the end of a message in ipsecadm(8)'s monitor command.
Add a generic driver, gentbi(4), for Gigabit Ethernet ten-bit interfaces. From NetBSD.
Add constants to mii.h for 1000base*X autonegotiation, and a constant for 1000baseT nic-to-nic master mode to if_media.h.
In ssh-agent(1), don't unlink the agent socket if bind(2) fails.
New -p option and 'p' command to top(1), to show just a single process.
On Intel-chipped dc(4) devices, share the bus evenly between receive and transmit, improving forwarding performance under heavy load.
Set the TCP congestion window to two segments instead of one, matching the window size when entering the ESTABLISHED state.
Unshadow a variable and unbreak tcpdump(8) on carp(4) interfaces.
Call vsyslog(3) with a priority, not a facility in ifstated(8).
Drop the spamd(8) default passtime to 25 minutes, so that mailers with a quadratic retry schedule that causes a retry at 26 minutes are allowed through.
Lots of work on the package tools' new object system.
Don't reset the chip when attaching an it(4) hardware monitor, stopping the fans going into jet engine mode.
When sending carp(4) advertisements, protect the call to ip_output() with splsoftnet(9).
[Applied to stable]
Change the default return code from the spamd(8) greylister from 450 to 451. The latter code works better with mailer clusters, making them more likely to retry from the same IP address the next time.
Fix a buffer overflow in tput(1) with the -S option.
Don't allow a peer ID of zero in bgpd(8).
Handle connection failures more gracefully in the ntpd(8) client.
New udav(4) driver for Davicom USB DM960-based Ethernet devices. From NetBSD.
Change the doff_t field in struct iso_dnode to u_quad_t, so that DVDs and other ISO filesystems larger than 2GB can be read.
Stacks of manpage cleanup.
Switch amd(8) from select(2) to poll(2).
Allow for an additional character in the disklabel(8) fstype, so that type ISO9660 isn't truncated.
Reorganise pkg_add(1) etc.'s packing list items code into a basic class hierarchy.
In ntpd(8), take the median value for the offset instead of taking an average.
New nvram(4) driver for i386, read-only for now.
Remove a marginal mmap(2) optimization from grep(1) that was causing some newline problems (PR#3940, PR#3941).
Have diff(1) continually retry getdirentries(2) until our buffer is large enough to store it all.
Unbust <stdbool.h> for newer gcc(1) versions.
fseek(3)/ftell(3) and other cleanup in msgs(1).
Fix an off-by-one when calculating IO space for em(4).
Don't die in bgpd(8) if socket(2) fails with ENOPROTOSUPPORT for a default listener.
Fix memory corruption in libdb hash(3) when the cursor page becomes the LRU page.
Check for accept(2) errors before fork(2)ing the child process in ftpd(8). From FreeBSD.
Fix a segfault and an off-by-one in lpc(8).
Get the rl(4) MAC address right on big-endian architectures.
Add bus_dma(9) magic to rl(4).
Helpfully display the bogus netmask that pfctl(8) is busy choking on.
If the YP marker is present in the master.passwd(5) file, have adduser(8) insert new users before it (PR#3727).
Ethernet autonegotiation fixes to rl(4). From FreeBSD.
Add ECONNREFUSED to the list of recvfrom(2) errors that don't kill ntpd(8)'s client dispatch function, now that connect(2) is used on the client socket.
Don't pretend to have an ifmedia structure in le(4), fixing some panics (PR#3407, PR#3661).
Add back some snprintf(3) string cleaning lost in the BIND 9.3.0 merge.
Correct a missing NULLification in pf(4), stopping pflog(4) incorrectly attributing states to anchors, and fixing state counter display for pfctl -vvs[nr].
[Applied to stable]
Some refactoring and shrinkage in the installer.
Fix a buffer overrun in xman(1) when reading the search string (X.Org bugzilla #1481).
Clean up disklabel(8) output for modern large disks (based on PR#3847).
Import and merge ISC BIND 9.3.0, keeping local changes.
Fix memory leaks in a few lpr(1) error paths.
Update sudo(8) to version 1.6.8p1.
Add login_tis(8), supporting TIS Firewall Toolkit authentication.
Add 'prepend-neighbor' feature to bgpd(8).
Fix unaligned accesses in rl(4) that were crashing on alphas (PR#3795).
Let gem(4) handle vlan(4)-sized frames.
Reorganise mii(4) to use a structure of standard entry points instead of separate function pointers, and add a 'reset' entry point. From NetBSD.
Remove kx(1) from the tree.
Nicer buffer size allocation for file(1) (PR#3924).
Add X support for OpenBSD/sgi.
Correct an off-by-one in vfprintf(3).
Fix a crash on free(3) in which(1).
Add Path MTU Discovery support for ipsec(4)-in-UDP.
Pass the TCP segment size up to userland for trpt(8) to use.
Do a connect(2) on client-side sockets in ntpd(8).
Don't process NAT-T keepalives in isakmpd(8).
[Applied to stable]
Round off package tools @newuser/@newgroup support by making pkg_delete(1) delete the user/group if no longer needed.
Drop osi and mask keywords from route(8).
Change sysctl(3) KERN_INTRCNT_CNT to return a quad instead of an int.
Add some read(2) and write(2) error checks to route(8).
Fix ssh(1)'s handling of the -n option in multiplex client mode.
Have bpf(4)'s kqueue(2) code fill in kn_data with the number of available bytes, like FreeBSD and NetBSD.
Make sure bgpd(8) and ntpd(8) never send signals to their child processes after handling a SIGCHLD for them.
Allow midi(4) UARTs that don't support interrupts on output to write blocks larger than MIDI_MAXWRITE.
Add code (#ifdef'd out by default) to allow 32-bit code using libsa to print 64-bit int values.
Allow for the link-layer header when deciding whether or not to allocate a cluster in the syncache.
Add libexpat 1.95.6, an XML parser library, to the tree.
Remove source-routing support from route(8).
Initial support for @newuser and @newgroup packing elements in pkg_create(1) and friends.
If X is running, stop the wsdisplay(4) screen blanker firing when its settings are changed.
Add 'no-scrub' pf.conf(5) keyword, allowing specific traffic to bypass the normaliser.
Iconify xconsole(1) in the standard xinit(1) rc file.
Display route labels with route(8)'s show command.
Get parameters to m_gethdr(9) the right way round in IPX-in-IP code.
Fix the no-route pf(4) keyword for IPv6.
In gzip(1), look for the last instead of the first dot in a filename before tacking on a '.gz' extension, so foo.bar.gz is tried if foo.bar is given on the command line but doesn't exist.
splx(9) later in brelse(9) to protect flags being set on the buffer.
Disable dynamic standby on 82550-based fxp(4) cards.
New vnode(9)-related manual pages for vflushbuf(9) and vwakeup(9).
Check for waitpid(2) errors in disklabel(8).
Fix an off-by-one in awi(4)'s WEP algorithm selection code.
Install PostScript docs for yacc(1).
Set NOLINT for GNU code, there's just no way it's ever going to work.
In ntpd(8) with -s, only call settimeofday(2) if the offset is larger than 180 seconds. Otherwise, adjtime(2) can cope with the offset sensibly.
Move the ntpd(8) startup earlier in /etc/rc(8), and use the -s flag unconditionally.
New -s flag for ntpd(8), which sets the time using settimeofday(2) before daemonizing. This removes the need to run rdate(8) early in /etc/rc(8).
In libpthread, allow a thread in the FD[RW]_WAIT states to be suspended.
Fix the build process for the ahc(4) microcode.
New %z and %t modifiers to *printf(3) for displaying size_t and ptrdiff_t respectively.
Add a framework in the package tools to distinguish packages added manually by the user from those added as dependencies for other packages.
Enable @shell keyword in pkg_add(1) etc., adding and removing an /etc/shells(5) entry as required.
Make spamlogd(8) respect the -I option, and change its bpf(4) filter so that it only looks at TCP S/SA packets. From PR#3914.
Update sendmail(8) to version 8.13.1.
More pcmcia(4) CIS fixes. From NetBSD.
Set the keyboard encoding earlier in /etc/rc(8).
Clean up state creation and destruction reference counting in pf(4) and pfsync(4), fixing problems with adaptive timeouts, max-states limits and rule leaks.
Fix a segfault in hack(6) (PR#3923).
Reset MINCLSIZE back to the old value so that clusters are created as soon as the packet is bigger than the standard header size. This is a conservative measure for this release.
More signal flag race fixes, in isakmpd(8) this time.
Don't ignore next-payload type NAT-OA in isakmpd(8).
Have pkg_add(1) etc. warn about use of the deprecated @dirrm keyword.
Handle route labels in RTM_CHANGE messages.
In the installer, set the console device speed before selecting it as the console, unbreaking Soekris boxes when booted without a cable attached.
Stop dhcpd(8) calling inet_ntoa(3) twice per log message.
Handle '%ll' with positional arguments correctly in *printf(3).
Don't remove a cloned peer immediately when it goes back to IDLE, keep it around for a while. That way, if it went away because a capabilities negotiation failed, it doesn't come back later with the same (incompatible) capabilities and so fail again.
Unbreak MD5FileChunk(3) when passed a zero length, and so make MD5File(3) work again.
Have tcpdump(8) print the th_seq field from truncated TCP headers, e.g. in an icmp frag-needed-but-DF-set error.
Give TCP some extra smarts (SS_ISSENDING) so that it doesn't send partial segments when the socket layer is still busy sending to it. Inspired by FreeBSD and NetBSD.
New '-T tcp' button for tcpdump(8) to force interpretation as TCP.
Teach tcpdump(8) about NFSv3.
Correct an off-by-one in fmt_scaled(3), allowing it to show 1099512676352 == 2.0T properly.
Fix more signal flag races, this time in comsat(8) and rpc.rstatd(8).
Drop the 'fallback interface' code from dhcpd(8), and store enough state to send a relayed request back to the right place.
Fix an off_t->int truncation in rwhod(8), found by lint(1).
Add some additional pcmcia(4) CIS sanity checks.
Several manual page fixes.
Fix a stack of compiler warnings in libkvm.
Restore hotplugd(8)'s ability to handle events queued before the daemon starts.
New -Dvar=value option for pkg_create(1).
Don't use a double where an int will do in sshd(8).
Add a negative index check in the hardware sensor sysctl(3) handler.
Have mount(8) dump attribute caching parameters in verbose mode.
Fix races on the signal flags in bgpd(8) and inetd(8).
Have mount_nfs(8)'s noac option turn attribute caching off instead of on.
Let rdate(8) accept NTP responses with stratum 0.
A bunch of lint(1)-inspired cleanup in ntpd(8).
Teach pkg_add(1) etc. about GNU info directories.
Remove all use of system() in favour of System()/VSystem() in the package tools.
Fix a file descriptor leak in df(1).
Have pkg_add(1) complain when configuration files can't be installed.
In pkg_add(1) etc., use the uid/gid cache module and perl(1)'s own chown() function instead of system('chown',...).
Change arg 4 of kvm_openfiles(3) to unsigned so that KVM_NO_FILES is in range.
Add mtree and uid/gid cache modules and an error wrapper to pkg_add(1) etc.
Remove a gcc-specific constructs from bgpd(8), inetd(8) and syslogd(8).
In bgpd(8), treat ENOBUFS from sendmsg(2) like EAGAIN and retry later.
Add support for mtree(8) to the pkg_add(1) framework.
A bunch of delint(1)ing, especially signal handlers with unused signo, and other unused variables.
3.6 -> 3.6-current.
--------
Changes made between OpenBSD 3.5 and 3.6
Fix tcpdump(8)'s bpf(4) attachment on atw(4) devices.
SECURITY FIX: Eilko Bos reported that radius authentication, as implemented by login_radius(8), was not checking the shared secret used for replies sent by the radius server. This could allow an attacker to spoof a reply granting access to the attacker. Note that OpenBSD does not ship with radius authentication enabled.
A source code patch is available.
[Applied to stable]
Bail out of newfs(8) on errors when making very small filesystems.
Move MIPS to 64-bit.
Fix copyout(9) of pf(4) anchors with relative paths and wildcards.
Track the peer count correctly in bgpd(8) and ntpd(8), fixing memory corruption in both.
Fix a null dereference in dhcpd(8).
Just print the raw IP protocol number in netstat(1) instead of fetching the protocol name.
Stop routed(8) fiddling with routes controlled by bgpd(8).
SECURITY FIX: httpd(8)'s mod_rewrite module can be made to write one zero byte in an arbitrary memory position outside of a char array, causing a DoS or possibly buffer overflows. This would require enabling dbm for mod_rewrite and making use of a malicious dbm file.
A source code patch is available.
[Applied to stable]
Stop telnetd(8) closing the slave fd from openpty(3) and then reopening it.
Set a cleanup handler for HUP as well as INT, TERM and WINCH on the ssh(1) multiplex control socket.
Stop ntpd(8) dying on sendmsg(2) failures.
Unbreak route(8)'s -netmask option.
Fix a bad cast from mode_t to short in ar(1).
Check for interrupted waits in inetd(8), fixing late reaping of zombie processes and other ignored signals.
Don't busy-wait on ENOBUFS in pppoe(8).
Stop the mixer resetting emu(4)'s volume to very very loud.
Make sure kernfs_xread() isn't called with a negative offset.
SECURITY FIX: Chris Evans reported several flaws (stack and integer overflows) in the Xpm library code that parses image files (CAN-2004-0687, CAN-2004-0688). Some of these would be exploitable when parsing malicious image files in an application that handles XPM images, if they could escape ProPolice.
A source code patch is available.
[Applied to stable]
Stop non-MASTER carp(4) hosts replying to ARP requests, as this upsets some layer 3 switches.
Stop login(1) treating the 'bar' in username foo.bar as a Kerberos instance, that's a krb4 syntax we no longer use.
Fix fd passing problems with S/Key on sparc*.
Don't do DNS lookups when reading ntpd(8)'s config, save them for later.
In ntpd(8), don't log transient network errors from sendto(2).
Fix pfsync(4)'s handling of adaptive timeouts.
Enforce minimum lease time of 60 seconds in dhclient(8), to stop bogus 0s leases from the server causing the client to spin.
Fix oversized copies that were causing memory faults in usb(4).
Don't close stdin in sshd(8) unless we're reexec'ing.
Make sure pkg_create(1) keeps track of the current working directory.
RELIABILITY FIX: Due to incorrect error handling in zlib an attacker could potentially cause a denial of service attack (CAN-2004-0797).
A source code patch is available.
[Applied to stable]
Have /etc/security(8) store a copy of the disklabel and report any changes.
Only allow SIOCGET{VIF,SG}CNT from the multicast router socket (PR#3825).
Document the fact that collisions have been found for MD4, MD5 and ripemd.
Don't make ntpd(8) explode when getaddrinfo(3) returns EAI_NONAME.
Base the value of uvm_km_pages_lowat on the amount of physical memory.
Back out the IPv6 prefix len 'fix', the old code was right.
Make xargs(1)' behaviour match the manpage when the utility can't be executed.
Fix fgetln(3) and realloc(3) handling in libedit.
Do the '%s' replacement for less(1)'s LESSOPEN and LESSCLOSE environment variables ourselves instead of using snprintf(3).
Don't send a SIGINT or SIGTERM to the entire process group when received by the shell unless the shell is the process group leader (PR#3820).
In isakmpd(8), fix the test for whether a newly-created SA replaces an old one.
Enable Dead Peer Detection in isakmpd(8) by default.
Don't overwrite the raw IPv6 checksum field in a shared mbuf.
Fix high interrupt load in ste(4).
Remove the need for isakmpd.policy(5) file when starting isakmpd(8) from rc(8).
Fix the IPv6 prefix length sanity checks in in6_are_prefix_equal().
3.6-beta -> 3.6.
Add a new control message to bgpd(8) that allows a session to be downed and restarted, accessible with the bgpctl(8) command 'clear'.
Unbreak parsing of multiple -o options to mount_nfs(8).
Stop bge(4), sk(4) and ti(4) complaining about a lack of jumbo frame buffers for inbound frames, unless debugging is on.
On nexthop reachability status changes always notify the bgpd(8) RDE, not just when the nexthop was previously unavailable.
Don't send bad IP packets via bpf(4) when monitoring a gre(4) interface (PR#3852).
Fix descriptor passing in bgpd(8).
Stop networks disappearing on bgpd(8) reload by always updating the prefix timestamp.
Remove a null deref in isakmpd(8).
Implement the SMTP 'QUIT' command in spamd(8).
Fix an out-of-bounds read in makeinfo(1).
Remove ip6.int from the named(8) example config files.
Bump OpenSSH to version 3.9.
Put in a temporary fix for wi(4) cards with station firmware < 1.8. Real fix after the 3.6 release.
Remove spamd(8) greylist entries the second they expire.
Back out the recent pf(4)-skips-downed-interfaces change, it breaks IPv6.
Add an example sendmail(8) /etc/mail/genericstable.
When isakmpd(8)'s -K switch is active, check the peer's proposal against isakmpd.conf(5).
Map the whole ld.so hints file for a.out in one mmap(2), as was done for ELF.
Fix auto request sense handling in ahc(4) and ahd(4).
Stop a coredump in libregex(3).
Fix a busy-wait on transmit failure in ntpd(8).
Add an extra check for a NULL message in the privsep code for isakmpd(8), named(8), pflogd(8), sshd(8), syslogd(8), tcpdump(8) and the X server.
Finally fix ntpd(8) problems with DNS non-availability at startup.
Fix a bad dereference in gcc(1).
In bgpd(8), ignore RFC2545 and don't allow IPv6 link-local addresses to be a next hop.
Stop a core dump in newfs(8) by checking the block size against MAXBSIZE.
Validate the superblock size recorded in the superblock, to prevent a panic.
Use atomicio instead of a few pieces of homegrown code in ssh(1).
Some signedness cleanups in ssh(1).
Add dladdr(3) support to the dynamic loader, and extend dlsym(3) to match 'standards'.
Plug a memory leak in kvm_close(3).
Fix bgpd(8) MRT dumps from cloned sessions.
With -q in effect, stop grep(1) searching as soon as a match is found.
Skip over non-UP interfaces in pf(4), fixing some problems with pppd(8).
Fix a missing lseek(2) error check in sshd(8).
Only close a pipe if it's open in sshd(8).
Fix a minor memory leak in sshd(8).
Surround pkg_delete(1)'s main loop with an eval{} block, so that ldconfig(8), directory removal, manpage and font directory processing always occur.
Back out the mmap(2)-based malloc(3) for now, some architectures aren't working right yet.
A stack of ohci(4) fixes from NetBSD.
RELIABILITY FIX: Improved verification of ICMP errors in order to minimize the impact of ICMP attacks against TCP.
A source code patch is available.
[Applied to stable]
Show the difference between the expected and received IP checksum in tcpdump(8).
Now that tcpdump(8) decodes the IP fragment returned in an ICMP error message, allow the TCP parser to print the source and destination ports from incomplete TCP headers.
When tcpdump(8) receives an ICMP error and -vv is in effect, also dump the IP packet embedded in the error message. Based on tcpdump.org.
Fix a bad sizeof in ntpd(8).
Implement better RFC 3706 Dead Peer Detection in isakmpd(8).
Fix the MED setting in outgoing bgpd(8) updates.
In ntpd(8), handle DNS lookup failures properly in the case of server pools.
Have pkg_add(1)'s @mandir and @fontdir keywords do the right thing on package delete, and have @fontdir do the necessary font processing.
Fix a dynamic group-related panic in pf(4).
Support the setenv capability in login.conf(5) like in NetBSD, including '~' and '$' macro expansion for the homedir and username respectively.
Import and merge Perl 5.8.5 from CPAN. Crank libperl's major number.
3.5-current -> 3.6-beta.
Stability and performance fixes to ste(4) from FreeBSD.
Fix an out-of-bounds write in libafs, caught by the mmap(2)-based malloc(3).
Fix a missing initialisation of the route info structure in the kernel and stop a panic.
Stop doing unnecessary PHY resets on hme(4).
Remove the need for -w when setting values in radioctl(1).
Fix iostat(8)'s average KB per transfer calculation.
Do a chroot(2) before running ldconfig(8) when DESTDIR is set in pkg_add(1).
Add IPv6 router solicitation and router advertisement ICMP messages to the default pf(4) filter loaded in rc(8).
Initial work on SGI MIPS64 support.
Only close the stream passed to pclose(3) if it was opened by popen(3).
In pkg_add(1), invoke the OpenBSD::Makewhatis module directly insteading of forking makewhatis(8).
Reorganise makewhatis(8) to avoid using unnecessary code, and allow invocation as a perl(1) module.
Big update to bgpd(8), moving towards IPv6 support.
New @lib marker in pkg_add(1) packing lists, that lets the tools know when to run ldconfig(8).
Many more pkg_add(1) fixes and improvements.
Refactor pkg_add(1) etc. packing list code.
Now that malloc(3) uses mmap(2) instead of sbrk(2), remove the rlimit check from the userland code and let the kernel do it.
Use the new fd-passing functionality in BSD_AUTH(3) to implement record locking for S/Key logins.
Stop trying to change the cwd of processes after a forced unmount.
Don't send signals from hardclock to prevent SMP problems in the near future.
Add interrupt coalescing support to fxp(4)
Fix jumbo frames support in sk(4).
In ssh(1), return DH group 14 when /etc/moduli is empty, fixing a hang.
Allow a file descriptor to be passed on the BSD_AUTH(3) back channel, to be used for stateful login scripts.
Do a check for minval>maxval in strtonum(3)
Change the minval and maxval parameters to strtonum(3) from unsigned to signed long long, simplifying the code.
Allow an autonegotiation to be forced at mii(4) attach time.
Don't crash the kernel in autoconf when matching an indirect device with verbose mode switched on.
Allow NFS commits to be coalesced instead of always sending a commit for each block.
MRT dump compatibility fixes for bgpd(8).
Add route label support to route(8) via the -label keyword.
Introduce 'route labels', allowing up to 32 bytes of information to be attached to a route.
Fix reference counting bugs in isakmpd(8), avoiding leaks.
Make disk geometry parameters in fdisk(8/i386) unsigned values to avoid some signedness problems.
Don't trim device major and minor numbers to 8 bits when accessing device nodes over NFS.
Allow pfsync(4) to use a unicast sync peer, via the new 'syncpeer' keyword to ifconfig(8). This lets pfsync operate over IPsec.
Show if locking is present in pstat(8) -f output.
Add fxp(4) microcode for interrupt coalescing. From Intel via FreeBSD.
Have lint(1) allow more integer types in bitfields.
Set initial latency and cacheline size for cardbus(4) devices.
Out-of-line some functions in isp(4) to shrink the kernel a bit.
In isakmpd(8) don't expire phase 2 SAs that are not yet established on receipt of a SIGHUP.
Fix pcmcia(4) crashes (PR#3732, PR#3881). More work required.
New @man element for packing lists.
If LK_NOWAIT is passed to vget(9), return EBUSY if the vnode is lock(9)ed.
Rewind the tape less often when repositioning an st(4) device.
New malloc(3) implementation using mmap(2) instead of sbrk(2). This means that malloc now gets all the benefits of mmap's randomisation feature.
Deal with upward-growing stacks when checking for the end of the stackgap in sys/compat/common.
Major updates to ahc(4). From FreeBSD.
Kill GATEWAY and IPFORWARDING config(8) options, since their functionality has long been available from sysctl(8).
Have httpd(8) correctly use port information supplied by the client (if available) when UseCanonicalName is off.
New bgpd.conf(5) announce type "default-route", which will only announce the default route to a specified neighbour.
Drain hotplug(4)'s event queue on close, fixing a hang on shutdown (PR#3874).
Fix siop(4) probe problems on hppa.
Call /bin/ksh instead of /bin/sh in the installer scripts, since the ksh(1) mannerisms will be disabled when invoked as sh(1) soon.
Fix a missing initialisation when processing an RDE update in bgpd(8).
Helpfully, don't truncate the lease file to zero length on dhcpd(8) startup.
Keep a unique ID for each server ntpd(8) talks to.
Display IKE Dead Peer Detection notifications in tcpdump(8).
Fix the conditions under which pool_put(9) frees a page.
Fix NAT-T Aggressive Mode by putting NAT-D checks in the right place.
Don't set the output filename in compress(1) when in -t mode, avoiding an error which the input filename doesn't end in '.gz'.
Drop ip6.int query support for IPv6 reverse lookups with gethostbyaddr(3).
Use SHA1Pad(3) in libskey, instead of relying on undocumented behaviour from SHA1Final(3).
Add new timekeeping code, MI-only for now and not yet enabled anywhere.
In bgpd(8), prefer the path with the lowest MED value, not the highest.
Have bgpd(8) retry failed DNS lookups from the config file every sixty seconds.
Set the default localpreference in bgpd(8) to 100 instead of 0.
Fix a leak when passing a file descriptor between processes.
Support lists-within-lists for the AS and prefix in bgpd.conf(5).
Support list expansion for the AS in bgpd.conf(5).
In tcpdump(8), only print TCP sequence numbers for SYN, FIN or RST packets if -vv is in effect.
Use pool(9)s instead of R_Malloc() for rtentry and rttimer structs. Adapted from NetBSD.
Have inetd(8) set the user and group on UNIX domain sockets.
Add -ttttt option (timestamp difference since the first packet) to tcpdump(8).
In ssh(1), call setsid(2) before doing re-exec.
Support pf-style macro expansion for the peer spec and prefix in bgpd.conf(5).
Backport from Apache 2.0 a fix for a mod_usertrack coredump in httpd(8).
Some atw(4) fixes from NetBSD.
Fix IP header alignment in an(4).
Fix a use-after-free(3) in gprof(1).
Add in a missing NULL check in DIOCCHANGERULE, preventing a rare crash.
[Applied to stable]
Use 'directory/' instead of '@dir directory' in packing lists.
Ignore utime(3) failure in cron(8) poke_daemon(), it doesn't matter any more since tickling the socket is enough.
Use mutex instead of SIMPLELOCK around the kernel's deadproc list.
Don't allow m_dup1() to return an mbuf chain when it should return a single mbuf.
Start work on removing the size limit from the mg(1) minibuffer.
Fix a problem with X on 64-bit architectures that was causing some wsmouse(4) input events to be lost.
Don't clobber an existing /etc/fonts/local.conf in XF4 make install.
kqueue(2) support for NFS, adapted from NetBSD.
Use fseek(3) instead of fseeko(3) in hexdump(1), since the argument being used is an off_t.
Don't mess up the internal state of a pipe(2) when pipelock() fails, just return with an error.
Fix an unnecessary fatal() in sshd(8) when the remote dies quickly.
Don't display invalid usernames using setproctitle(3) in ssh(1) (OpenSSH bugzilla #899).
Fix a multiple-free in ntpd(8).
More umass(4) fixes from NetBSD.
Fix CPU speed-related sound slowdown in auich(4) (PR#3814).
More pointless inline removal in the kernel.
Implement outgoing interrupt pipes (part of the USB 1.1 spec) in usb(4). From FreeBSD.
Disable the XFree86 module loader on powerpc, ahead of upcoming malloc() changes.
Strip the strcpy() and strcat() builtins from GCC 3 (as was done for GCC 2) to make them easier to spot and eradicate.
New cdce(4) driver supporting USB CDC Ethernet devices.
Use mutexes in a few places where SIMPLELOCK was used before.
Add i386 and AMD machine-dependent mutex implementations.
Introduce mutex support to the kernel. Not optimally efficient, and not MP-safe.
New @info keywork to pkg_add(1) etc., supporting GNU info documents.
Reintroduce standalone popa3d(8) after fixes and more testing.
Stop wicontrol(8) displaying garbage when run against a nonexistent interface.
Make gprof(1) work properly on 64-bit architectures where the text is above 4GB.
Display correct labels in the output from pfctl(8) -st.
Fix an atw(4) panic on detach.
Correct mg(1)'s error checks for strtonum(3).
Start work on a tutorial for the make(1) we have, not PMake.
strtonum(3)ify id(1).
Fix a signal race in make(1).
Fix a leak in getrrsetbyname(3).
Don't let xterm(1) crash when selecting text.
React more rationally in ntpd(8) to (possibly) transient network errors from recvfrom(2).
More improvements to ntpd(8)'s query interval scaling.
Return EINVAL if a negative offset is passed to ftruncate(2).
Don't check for the non-existent md5 of an '@link' in pkg_delete(1).
Add bsd.rd to the list of filesets installed by default.
For NFS and URL installs, assume the network is already set up the way the user wants it.
Back out standalone support from popa3d(8).
Remove K&R support from libc/sys/makelintstub.sh.
Fix a use-after-free(3) in amd(8)'s AFS code.
Fix missing ssh(1) lastlog messages under certain circumstances (OpenSSH bugzilla #463).
Add an stty command to the boot.conf(8/i386) to set the serial console speed.
Deal gracefully with a null sub-timezone in the installer.
Unbreak the pf(4) normaliser's use of the timestamp as an extension to the sequence number.
Add a ruleset optimiser to pfctl(8) (new -o and -oo options).
In strtonum(3), add a test of the lower bound when the upper bound is greater than LLONG_MAX.
Updates to the san(4) driver.
Kill ksh(1) history functions on non-interactive shells. Based on NetBSD.
Back out a TCP change that left the ends of a newly-ESTABLISHED connection with asymmetric congestion windows.
Unbreak antenna diversity setting in ancontrol(8).
Stop pkill(1) whining when a process that it expects to be running has died, e.g. a privsep child that got reaped right away by the parent.
Fix core dumps from wicontrol(8) when fetching values a card doesn't support.
New -D option to nc(1) switching on SO_DEBUG.
In pkill(1), skip the pkill process itself and any processes marked P_SYSTEM every time.
The netiso code was removed from the tree. Noone cared.
Many fixes and improvements to atw(4) from NetBSD and the reference driver via NetBSD.
Add compat versions of msgctl(2), semctl(2) and shmctl(2) with 16-bit mode_t.
Add new versions of the msgctl(2), semctl(2) and shmctl(2) functions to deal with the changes to mode_t (included in struct ipc_perm).
Refactor SysV shared memory functions, allowing them to automagically handle conversions between new and old structures in compatibility mode.
Back out last vestiges of IPv6 fragment reassembly using pf(4) scrub.
Drop the stratum calculation from ntpd(8).
Ignore clock synchronisation status returned to rdate(8) -n clients.
Zero out the NFS generation number in struct stat in OpenBSD 3.5 and 4.3BSD compatibility modes.
Only retransmit relevant NFS requests on nfs_reconnect().
Rework pkg_add(1)/pkg_create(1)'s @dirrm directive, and add @dir.
Fix a double-free and some backwards logic in passwd(1).
Finally remove the deprecated passwd.conf functionality and files.
Change mode_t and nlink_t from u_int16_t to u_int32_t.
Add weak-aliased __errno(3) function to libc and bump all library major versions.
Have ntpd(8) return decent server statistics to the client, including the stratum, reference time and synchronisation status.
Ignore obviously malformed queries in ntpd(8).
Use socketpair(2) instead of pipe(2) in ntpd(8).
In pkg_create(1), mark links as what they are instead of computing a size and checksum for them.
When pkg_add(1) detects a file conflict, helpfully list the clashing file's originating package.
strtoul(3) -> strtonum(3) in mg(1).
Deal with count==0 correctly in newsyslog(8).
Save process context in namei(9) avoiding a crash (PR#3842).
Back out IPv6 fragment reassembly under the pf(4) scrub directive, it's not ready yet.
Have pf(4) create a group when adding a dynamic interface that's not yet plumbed in.
More usb(4) fixes from NetBSD.
An endianness fix in nm(1).
Fix lockup when unmounting a union filesystem.
Fix TCP NFS mount hangs after a server reset.
Scale ntpd(8)'s query interval based on the local clock offset. More work to come.
Endianness fixes to ehci(4) from NetBSD.
Remove descriptions of partition types from fdisk(8/i386), shrinking the executable.
HP-UX compatibility stuff for hppa.
Fix sed(1) failure when the last character of the line buffer was a backslash. From FreeBSD and NetBSD.
strtonum(3)ify procmap(1).
Fix cd9660 buffer writing code.
Improve patch(1)'s detection of whether or not a patch has already been applied.
Miscellaneous cleanup in reboot(8).
Don't use strlcpy(3) on a string that's not null-terminated in ftp(1).
Some ANSI prototypes in games, sbin and usr.sbin.
Don't update the clock in ntpd(8) without data.
When saving a file, have mg(1) check if it's null terminated and prompt the user to add it if desired.
Rework ntpd(8)'s DNS handling to better deal with responses containing multiple addresses. Two keywords, 'server' and 'servers', with different semantics.
Set the correct poll(2) timeout in ntpd(8).
A couple of network mask issues with pf(4) tables.
Fix a few missing close(2) and free(3) calls in an isakmpd(8) error path.
Fix overwriting of virtual MAC address by carp(4) on FDDI interfaces.
Don't mistakenly skip a file in rcp(1) and scp(1) by mistake when fchmod(2) fails twice.
Sync gdb(1)'s kvm interface with FSF, adding 'kvm proc' and 'kvm pcb' commands.
Check for stat(2) failure in pkg_add(1)'s virtual filesystem.
Fix a couple of MRT bugs in ntpd(8).
Open the dhclient(8) script execution window from 1 to 3 seconds.
Return -1 from ftw(3) and nftw(3) if fts_close(3) fails without returning an error.
Fix a memory leak in isakmpd(8).
Better client responses from ntpd(8).
Better time handling code for ntpd(8).
Fix a systrace(1) problem where argv[0] would be normalised and so break scripts that depend on the original path.
Stop logging ntpd(8) responses with bad cookies, so attackers can't spam the log files. Back off logging in general.
Don't listen by default in ntpd(8). New 'listen on' directive must be used instead.
Allow for multiple IP addresses associated with hostnames listed in ntpd.conf(5).
Add a 'trustlevel' for ntpd(8) peers, using the peer's timely network responses to judge its worthiness to affect the clock offset, and to set how often queries are sent.
Implement filtering on peer replies in ntpd(8).
Fix a couple of sizeof(wrongthing) in ntpd(8).
New -R option fro ftp-proxy(8) allowing pf(4) to safely accept client PASV-mode connections to a protected FTP server.
Have ntpd(8) log the IP address NTP replies and incorrect cookies are received from.
Allow and resolve hostnames in ntpd.conf(5).
Add a couple of missing initialisations in ntpd(8).
Set FTS_LOGICAL in ftw(3) and nftw(3) (unless FTS_PHYSICAL is explicitly passed in to the latter) as required by fts(3).
Some string cleaning and other fixes to ul(1).
Back out the bogus fix for the TCP simultaneous close bug from TCP/IP Illustrated vol. 2, exercise 29.5.
Some ehci(4) fixes from NetBSD. Multiple devices can now be simultaneously active.
Don't require -w for writes with audioctl(1).
Keep track of historical offset and delay values in ntpd(8), for later use in filtering.
RELIABILITY FIX: Under certain network load the kernel can run out of stack space. This was encountered in an environment using CARP on a VLAN interface. this issue initially manifested itself as an FPU-related crash on bootup.
A source code patch is available.
[Applied to stable]
Fix a segfault in routed(8) with rtquery(8) messages from a non-local host (PR#3841).
Fix ntpd(8)'s conversion from seconds to microseconds.
Don't queue hotplug(4) events if there's no hotplugd(8) running. When the last listening daemon exits, flush pending events.
strtonum(3)ify chpass(1).
Allow the argument to fstab(5) options groupquota and userquota to be optional
Implement 'set nexthop blackhole' and 'set nexthop reject' in bgpd(8).
Give a helpful error message when pkg_create(1) fails due to a missing @name.
Remote the single-server limitation in ntpd(8).
Use adjtime(2) to sync the local clock in ntpd(8), based on the median offset from the configured servers for now.
Some ehci(4) updates from NetBSD.
Keep track of the device and inode of objects loaded by ld.so(1), so that it's no longer possible to have the same object loaded from two different locations.
Die nicely if dhclient(8) can't read its config file.
Fix a few missing freeaddrinfo(3)s in spamd(8)
Drop the requirement in the installer for a 'b' partition. If one exists use it as swap, and don't allow a mount point to be created there.
SCHED_LOCK() before proc_stop() in issignal(), avoiding a panic from splassert(9) #ifdef MULTIPROCESSOR.
In ntpd(8) compute the local clock offset as per RFC 2030 section 5.
Make the backspace and delete keys do the right thing by default in xterm(1).
calloc(3) the right structure in ntpd(8) client_peer_init().
Some cleanup in lam(1).
Fix a vnode leak in mount(2).
Change bgpd(8)'s MRT dump code to use fd passing.
Put skey(1) code inside #ifdef SKEY in ssh(1). From FreeBSD.
Bypass the pf(4) normaliser for now when forwarding ip6 packets.
Support '@host:port' syntax in syslog.conf(5), allowing specification of the remote port.
Respect TMPDIR when creating a temporary mountpoint for the new mount_mfs(8) -P option.
Use strtoul(3) instead of strtol(3) in setmode(3), and return ERANGE consistently for invalid octal modes.
Update savecore(8) to new-style kernel time handling.
Allow (but ignore) the -E and -X options in src/distrib/special/more.
Fix a few division-by-zeros in vmstat(8).
Fix rare cases of bogus permissions from mtree(8), caused by a missing initialisation.
Add a few md use-before-init sanity checks in kvm(3).
Check for a nonexistent name in kvm(3) and print a useful error message.
Use the evcount API for interrupts counting on hppa.
Test for a tty break in the right place in ssh(1).
Fix inetd(8)'s handling of UNIX domain sockets.
In mpt(4) use SCSI_POLL during the probe since MP kernels don't enable interrupts until after the probe has completed.
strlcpy(9) -> copyoutstr(9) when copying from kernel to userland in vnd(4).
Allow shared library revision numbers to be overridden for libOSMesa, libXRes, libxkbfile and libkbui.
Remove interface name verification code from pfctl(8), so that once again a rule referring to a non-existent interface simply never fires. This has the handy side-effect of allowing pfctl to be run as non-root again.
Unbreak MSCHAP in pppd(8) due to local MD4Update(3) differences.
Don't allow bogus routes with a nexthop inside 127/8 in bgpd(8).
If no listener address is given to ntpd(8), listen on every IP address.
Change a few memcpy(3) into strlcpy(3) in pfctl(8) when copying the interface name.
Install sendmail(8)'s libmilter by default.
In net80211, allow WEP keys to have lengths other than 40 or 108 bits.
Don't try to strlcpy(9) from userland into the kernel in vnd(4).
Update zoneinfo files and ctime(3) to tzdata2004a. Respect Georgia's wish to have the right timezone again.
Remove '#if 0' around the real code for net80211 ioctl WI_RID_PRISM2. This allows atw(4) to do AP scanning via wicontrol(8).
New -z option for vmstat(8) to show devices even if they haven't generated an interrupt.
Use the new event counter API for interrupt counting on alpha, amd64, i386, macppc and sparc64.
Add generic interrupt counter retrieval via sysctl(3), removing the need for i386-specific code in vmstat(8) and systat(1).
Add generic 'evcount' event counter API to the kernel.
Hack around a panic in 802.11 crypto startup due to the rnd device not being initialised.
Add missing 802.11g and 802.11 'turbo' media types for the 802.11 framework to <net/if_media.h>.
Use congestion-sensitive IF_INPUT_ENQUEUE() in gre(4).
Alignment fixes in ppp(8) lcp and ipcp handling.
Allow the default console to be changed to a serial device from the installer. Only i386 uses this for now.
In fvwm(1), use two va_list and va_copy(3) instead of reusing a single va_list.
New -P option to mount_mfs(8), used to populate the mfs volume immediately after creation.
Make the root of an mfs partition inherit modes, owner and group from the mountpoint.
Only add the ipcomp(4) header if compression is actually used, i.e. if the packet got smaller after compression.
New timeslot keyword for ifconfig(8), used by telco cards.
Add SIOC[GS]IFTIMESLOT ioctls for telco cards (currently just san(4)).
New san(4) driver for Sangoma T1/E1 cards.
More narrowing down of isakmpd(8)'s privsep interface.
After switching most of the device drivers to use generic ether_crc32_be(), add a table-driven implementation of this function. From FreeBSD PR#49957.
Don't allow nanosleep(2) called with a zero timeout to sleep indefinitely, sleep for at least 1/hz seconds.
Enable ipsec(4) UDP encapsulation by default.
Allow keynote(1) policy checking to be disabled in isakmpd(8).
Remove netiso code from netstat(1).
Use the extended protocol in syslogc(8) to detect overflows (-o option).
Extend the syslogd(8) memory buffer protocol to include flags, starting with one to indicate that the buffers have overflowed.
Fix sshd(8) re-exec file descriptor handling.
Introduce interface groups, accessible via new ifconfig(8) keyword 'group'.
String cleaning in twm(1).
More work on IPv6 normalisation in pf(4).
Add SMP support for amd64.
Fix re(4) MAC address setup on big-endian machines.
When renaming files in the sftp(1) server, fall back to stat(2)-then-rename(2) if the underlying filesystem doesn't support link(2).
Some more string cleaning in the X server.
Fix a misplaced closing brace that was breaking xtrans unix socket creation (freedesktop.org bugzill #363).
Add layer 2 tunnelling (tap) support to tun(4).
Don't allow IPsec udpencap (4500/udp) to be a dynamic bind(2) port.
Enable propolice on XFree86 modules.
In sshd(8), only do TCP wrappers checks when the incoming connection is on a socket.
Narrow down isakmpd(8)'s privsep interface a bit.
Ditch autoconf stuff in libkeynote, it's not used here.
Set stricter modes on shared memory segments used by the X server.
Do IPv6 fragment reassembly with the pf(4) scrub directive. Work in progress.
String cleaning in the X server, fvwm(1) and xtrans.
Convert libXt to ANSI C. From XFree86 HEAD.
Some work on bgpd(8) multiprotocol support.
Reprint the boot(8) identity string after changing the console line.
Disable the boot(8) timeout once the user hits a key.
Big tidyup of sys/net/rtsock.c.
Some alignment fixups in bgpd(8).
In systrace(4), quit early if detached after an exec*(3), and avoid a double-free.
Remove the 8-page size limit on the sysctl(3)-returned argv array.
Strip netiso code from ifconfig(8) and route(8).
Make all kernel time access via functions so that locking is possible.
Re-exec(3) sshd(8) after accept(2). Can be turned off with the -r command line option.
Add C++ inclusion guards into <pcap.h> and <keynote.h>.
Add genericstable to the list of sendmail(8) databases that /etc/mail/Makefile can create automatically.
Don't realloc(3) so often when fetching process args in libkvm. Will be needed soon.
If one of pkill(1)'s targets can't be killed, carry on and kill the rest instead of stopping.
Fix SIGCHLD handling in isakmpd(8) so SIGSTOP and SIGCONT now work as expected.
Gracefully handle line buffer overruns when reading boot.conf.
Do ehci(4) on macppc as well.
Crank libc and libpthread majors again after hsearch(3) addition.
Allow isakmpd(8) to handle keys from X.509 certs embededed in keynote credentials.
Implement hsearch(3) and friends, for XPG4.2 reasons. From NetBSD.
Update sendmail(8) to 8.13.0.
Correct a missing dereference and unbreak logging of IPV4_ADDR_SUBNET IDs in isakmpd(8).
Fix the for loop that counts passed environment variables in multiplex ssh(1).
As with sysctl(8), make the -w option for writes with wsconsctl(8) optional.
Have tcpdump(8) show the time between packets when prodded with -tttt.
Some setuid(2)/setgid(2) fixes for systrace(1).
Shrink the dhclient(8) die-on-RTM_DELADDR window to one second.
Remove another stat(2)-then-open(2) from isakmpd(8).
Enable ahd(4) by default for i386.
Unbreak phase 1 IPV[46]_ADDR_SUBNET IDs in isakmpd.conf(5)
New config option 'Acquire-Only' (-a on the command line) for isakmpd(8), to stop the daemon playing with existing flows.
Add cdboot(8), a CD-specific second-stage bootstrap for i386.
In bgpd(8), support the NOPEER community from RFC 3706.
Import atw(4) ADMtek ADM8211 wireless driver from NetBSD.
Some strncpy(3) -> strlcpy(3) in sys/compat/*.
Add a no-emulation CD boot sector, based on a FreeBSD implementation.
Only ignore dhclient(8)-generated RTM_DELADDR messages for a five-second window after process startup, so that new instances of dhclient (started outside this window) cause the older instance to die like before.
Teach mkhybrid(8) how to create an El Torito no-emulation boot CD (for i386), with a 2048-byte boot sector.
Import the generic IEEE 802.11 framework from FreeBSD and NetBSD.
Fix probe hangs on some ahd(4) cards.
In the X server, fix malloc corruption when sending multiple glyphs to RenderAddGlyphs() (XFree86 bugzilla #1276, freedesktop.org bugzilla #349).
Rewrite mount(8)'s mount options parser, making it more robust and removing the need for duplicate code in mount_nfs(8) (PR#3642).
Fix some logic errors introduced in recent string changes to cron(8).
Don't exit wicontrol(8) if SIOCGWAVELAN fails, just print a warning and get whatever information is available without it.
Change bgpd(8)'s internal prefix lookup from a hash table to a per-address family red-black tree(3).
Don't assume in make(1) that '.' and '..' are the first two entries in a directory.
Handle division-by-zero in m4(1) with an error message instead of a core dump.
Fix a segfault in xdm(1) if a LISTEN keyword without hosts is found in the Xaccess file.
When decoding fragmented IPv6 packets in tcpdump(8), only try to interpret the contents of the first fragment.
Back out source-based routing code while some problems are fixed.
Start work on support for IPv6 routes (not just IPv6 sockets) in bgpd(8).
Wire ntpd(8) into the build.
Fix libXi XSelectExtensionEvent(3) on 64-bit machines (freedesktop.org bugzilla #285).
Remove pointless 5-second sleep(3)s in xtrans (freedesktop.org bugzilla #297).
Sync lynx(1) to 2.8.5.rel2.
Fix some endianness problems in X-Resource (freedesktop.org bugzilla #267).
Add a new 'filter drop' flag to bpf(4), so that an interface may be notified that a packet matches a filter and should be dropped.
Update to lynx 2.8.5rel1.
Have isakmpd(8) drop IKE messages arriving on port 500 after the NAT-T exchange has switched to port 4500.
Allow a bgpd(8) template peer with unknown AS to be an IBGP peer, instead of always being an EBGP peer.
Allow the IKE parser in tcpdump(8) to recognise a NAT-T payload.
Teach tcpdump(8)'s IKE parser about NAT-T keepalive packets.
In bgpd(8), don't reallocate the pollfd array every time the size changes because there's a risk that realloc(3) can fail. Reallocate only when there's a large potential saving.
String cleaning in cron(8).
time -> arc4random(9) in sppp(4).
Fix bogus 'panic: cylinder group too big' message from newfs(8).
Don't exit dhclient(8) on receipt of an RTM_DELADDR routing message, as this sometimes be generated by the dhclient itself. Instead, exit on RTM_NEWADDR iff an IP address is set that doesn't correspond to our lease. Not a perfect solution.
More sftp(1) ls(1) emulation: Don't show .dotfiles unless -a is specified.
Handle interface resets gracefully in dhclient(8).
Do more retries on st(4) devices to allow the tape drive to recover after a reset.
New xetc installation fileset, for all X configuration files installed under /etc.
Keep separate, 1-second resolution counters for walltime and uptime, and have code that only needs 1-second resolution use those instead of the microsecond counters.
Clean up properly on in_ifinit() failure.
Turn isakmpd(8) NAT-T support on. The crowd goes wild.
Implement NAT-T keepalive messages in isakmpd(8).
Check that UDP encapsulation is enabled (sysctl(8) net.inet.esp.udpencap) before allowing encapsulated SAs to be created in the kernel.
Add bounds-check gcc(1) attributes to libkern strl*() functions, and to strncpy().
Implement ls(1)-compatible sorting for sftp(1)'s ls command.
Allow ipsec(4) on IPv6 link-local addresses.
Have isakmpd(8) save the destination port if it is NATed, as one might reasonably expect it to be when using NAT-Traversal.
Don't leak a cloned PMTU route in netinet/ip_output.c.
arc4random(9)ise a previously time-based ID in atalk(4).
Fix an fd leak in ssh(1) when multiple subsystems are present.
Use arc4random(9) instead of the time for the ARCnet sequence ID.
Use getaddrinfo(3) and getnameinfo(3) instead of old-style conversion functions in spamd(8), but restrict resolution to AF_INET for now.
Allow - with a warning - the old package keyword @src, in pkg_add(1) etc.
Import and merge fontconfig 2.2.2.
Set the ESP marker on isakmpd(8) captured packets for NAT-T SAs.
If the pkg_add(1) 'don't run scripts' (-I) option is present, don't run scripts.
Have isakmpd(8) turn on kernel ESP-in-UDP encapsulation for NAT-T SAs.
Switch to port 4500 when required for isakmpd(8) NAT-T exchanges.
Use a red-black tree(3) instead of a hash table to track multiply-linked inodes in du(1).
Time is as dumb a 'random' value for IPX and ISO CLNP as it is for IP, so use arc4random(9) instead.
Add IPv6 support for standalone popa3d(8) as well as when run from inetd(8).
In crypto(9), always store the value returned by splimp(9) so we have something meaningful to give to splx(9).
Fix broken process runtimes in i386 MP.
Use the RTF_MPATH routing flag to skip over multipath routes in bgpd(8), since mpath make no sense for BGP.
For sftp(1)'s 'ls' command, make -l show user and group names, and -n show uid and gid just like real ls(1).
New -I option for diff(1), which ignores changes matching the supplied regex.
Have vnconfig(8) (with the -l option) use the new VNDIOCGET ioctl to fetch vnd(4) device status.
New VNDIOCGET ioctl for vnd(4) devices.
Fix a bad format string in tcpdump(8)'s IKE parser.
In bgpd(8), use descriptor passing to allow the creation of new listen sockets on privileged ports.
For multiplexed ssh(1) connections, filter passed environment variables in the slave.
Add bounds-check compiler attributes for memcpy(3) etc.
Remove support for TUBA (TCP/UDP over CLNP-Addresses Networks, as if you didn't know).
Change isakmpd(8) payload handling to deal with pre-RFC NAT-T messages.
Don't try to carry on in pax(1) if the chdir(2) needed by the -C option fails.
Start work on both RFC 3706 Dead Peer Detection, and full-on NAT-Traversal support for isakmpd(8).
Have isakmpd(8) accept an unencrypted final IKE message (Aggressive Mode only) for compatibility reasons.
New -dd switch for isakmpd(8) to make debugging the privsep child easier.
Let popa3d(8) work with IPv6 sockets, no daemon mode support yet.
Fix a rather serious SMP merge error affecting scheduler timeouts.
Correct some logic errors in kernel malloc_debug().
Fix congestion-sensitive IF_INPUT_ENQUEUE() so that freed mbuf(9)s no longer show up on interface input queues under certain circumstances.
Require the setting of new route flag RTF_MPATH (corresponding switch -mpath for route(8)) to add a multipath route.
Add defines in <net/if_media.h> for various telecoms carrier circuit types, i.e. E1, T1 etc.
Save curproc in svnd(4) so that lockmgr(9) doesn't get passed a null process. Stops svnd(4) blocking indefinitely (PR#3214).
Fix a null deref in make(1) if the .DEFAULT target has no commands.
Fix sending of jumbo frames on em(4) and ti(4).
Unbreak patch(1) when using standard diffs (i.e. no context).
Allow the user to interrupt the setup of a multiplexed ssh(1) connection (if, for example, the master gets wedged) by deferring signal setup until the connection is established.
Merge adjacent hunks in diff(1), making the output more like that from GNU diff.
Use execvp(3) instead of execv(3) in sftp(1) so -S ssh will work.
Use dynamically allocated pollfd struct for ntpd(8), just like bgpd.
Fix a bunch more memory leaks in isakmpd(8).
Be more careful in isakmpd(8) when evaluating the return code from X509_verify_cert(3).
Add much of the NTP client functionality to ntpd(8).
Abort rdate(8) on calloc(3) failure, warnx(3)ing and carrying on is just postponing the inevitable.
Add an option (ControlMaster=ask) to require confimation via ssh-askpass(1) before allowing a multiplexed ssh(1) connection.
Support environment variable passing over multiplexed ssh(1) connections.
Back out the recent IPv6 multicast change so that mandatory groups get joined, but achieve the same result by testing for a new host address before adding the multicast entries.
Add '-n' option to last(1) to do the same job as -number in a less ugly way.
Make <netinet/if_ether.h> safe for inclusion in C++ code.
Fix a bad dereference leading to a memory leak in isakmpd(8).
Fix a pasto in isakmpd(8)'s message decoder when printing IPv6 address/mask pairs.
Unbreak the IN6_LOOKUP_MULTI() macro definition.
Add support for new crypto functions on upcoming VIA C3 processors.
Build X on cats systems.
Fix a null deref crash in route(8)'s show command.
Don't add multiple multicast filter entries for a single IPv6 multicast address.
Remove the old pf(4) BEGIN*, COMMIT* and ROLLBACK* ioctls.
Use the newer pf(4) BEGIN and COMMIT ioctls in authpf(8).
Set the relay session id properly for outgoing pppoe(8) packets.
Teach patch(1) to detect already-applied diffs when the diff creates a file, or adds to an empty file.
In du(1), use a hash table instead of a linear list to keep track of multiply-linked files.
Use fmt_scaled(3) instead of do-it-yourself in du(1).
In ld.so(1), allow _dl_malloc() to allocate more than 4KB.
Fix a few stat(2)-then-open(2) races in isakmpd(8).
After going to the trouble of pulling the tcp6 options into a contiguous region with IP6_EXTHDR_GET, use the returned pointer instead of doing mtod() again.
Unbreak vmstat(8) on older kernels.
Build an SMP kernel (bsd.mp) in make release(8) for i386, and allow the user to install it.
Merge the SMP branch onto the trunk. Let the party begin.
Just quit rather than panic in cy(4) if interrupts can't be established for PCI.
Fix an off-by-one buffer size in sed(1).
Implement client-side session multiplexing (see ssh_config(5) options ControlMaster and ControlPath) for ssh(1), scp(1) and sftp(1). The server has supported this for some time.
Add diffie-hellman-group14-sha1 KEX method support to ssh(1).
Fix pf(4) table add/replace commands at securelevel 2.
Have mg(1)'s M-x gid command use the current word to try and guess which symbol to look up.
Make route(8) 'show' command output more like netstat -r.
Support the IPV6_USE_MIN_MTU option, mainly because BIND 9 wants it.
Disable apm(4) on i386 MP machines.
Show systat(1) and vmstat(8) where to find interrupt stats on MP i386 machines.
Only print 'status/cpu#' in top(1) if there's more than one CPU.
Fix a dereference-after-free (actually after pool_put(9)) in pf(4) tables.
In pax(1), fix backreference substitution in -s mode and unbreak bad regex detection.
Add a cpuid field to struct kproc2, and teach ps(1) and top(1) how to make use of it.
Only install the Intel F00F bug workaround once on MP machines, avoiding a panic.
Zero the restart counter before use, to fix a problem with uhub(4) port restarts giving up before starting. From FreeBSD.
Fix a sizeof(pointer) bug in carp(4).
Don't leak a softc when detaching a carp(4) cloned interface.
SECURITY FIX: Multiple vulnerabilities have been found in httpd(8) / mod_ssl. This is the second of two sets of fixes.
CAN-2004-0488: Stack-based buffer overflow ... in mod_ssl, when mod_ssl is configured to trust the issuing CA, may allow attackers to execute arbitrary code via a client certificate with a long subject DN.
CAN-2004-0492: [mod_proxy] Reject responses from a remote server if sent an invalid (negative) Content-Length: header.
A source code patch is available.
[Applied to stable]
SECURITY FIX: As disclosed by Thomas Walpuski, isakmpd(8) is still vulnerable to unauthorized SA deletion. An attacker can delete IPsec tunnels at will.
A source code patch is available.
[Applied to stable]
Add src/lib/libintl and libc i18n directories to the repository.
First merge of SMP code into the trunk, mainly structures to allow gradual introduction of the new APIs.
Fix IPv4 name-to-address translation, so invalid octet values won't be accepted and CIDR address/mask pairs finally work the way one expects.
In tcpdump(8)'s privsep localtime(3) replacement, deal better with timezones with granularity of less than one hour.
SECURITY FIX: Multiple remote vulnerabilities have been found in the cvs(1) server that will allow an attacker to crash the server or possibly execute arbitrary code with the same privileges as the CVS server program.
A source code patch is available.
On i386 (ppro and above), use the calibrated value for the CPU speed over the value returned by the CPU itself, fixing PR#3814.
Use a dynamically allocated array of pollfds in bgpd(8).
Try to prevent isakmpd(8) deleting SAs on receipt of malicious IKE messages.
rdate(8) improvements:
RFC 2030 compliance for NTP mode.
Much more robust error handling, with better messages.
Better detection of stale or spoofed NTP responses.
Support for multiple addresses if returned by the DNS, trying each listed server until one works.
Remove NMBCLUSTERS settings from config(8).
Factor out TCP md5sig code into tcp_subr.c:tcp_signature().
Fix buffer usage in umass(4) CBI transfers (NetBSD PR#25676).
Allow arc4random(3) code in ksh(1) to actually work.
Break the dependency of libc on <pthread.h>. Bump the major version of libc and libpthread.
Teach kdump(1) about gpio(4) ioctls.
Allow an authtype (-a option) in skeyinit(1) even when secure mode (-s) is in effect.
Add an alternative algorithm to make pf(4) table deletions faster for a small number of deleted items.
SECURITY FIX: Multiple vulnerabilities have been found in httpd(8) / mod_ssl. This is the first of two sets of fixes.
CAN-2003-0020: Apache does not filter terminal escape sequences from its error logs.
CAN-2003-0987: Apache mod_digest does not properly verify the nonce of a client response by using an AuthNonce secret.
A source code patch is available.
[Applied to stable]
Out-of-line spl(9) functions in SMP on i386, mirroring the UP change to fix VFS corruption.
Add SMP-related devices for i386 on the SMP branch.
Many fixups on the SMP branch for non-MP kernels.
Rework bgpd(8)'s listen socket handling to better support multiple listen addresses.
New -src and -srcmask options for route(8) supporting the new source-address routing functionality.
New -S flag for netstat(1) and route(8), to show the new source selector part of a route entry.
Extend the routing table to allow routing based on source as well as destination. IPv4 only for now, more to come.
Set the skey(1) first sequence number to 100 as promised by the manpage.
spl(9) and alignment fixes in portalfs.
Much merging and fixup as SMP is readied for prime-time.
Resurrect the 'fork1(9)-can-take-null-retval' change, this time leaving the setup of struct proc setup well alone.
Fix a bug with X and wsmouse(4) where an event of unknown type could cause a whole batch of other events to be discarded.
Set the length field in the TCP packet header earlier in tcp_output().
New re(4) driver supporting RealTek Gigabit Ethernet devices.
Clean up multicast addresses when unconfiguring carp(4) interfaces.
Clarify user(8) docs and error messages (PR#3792).
Add startup code for hotplugd(8) to rc(8) and rc.conf(8).
New usbhid(3) API hid_start(3), a non-noisy version of hid_init(3).
Don't send mail at all from cron(8) if MAILTO is set but empty.
Cleanup in at(1)/cron(8):
Check argc before using argv[0] in at(1).
Print the right filename for a job in the email.
Reset the sockaddr length value every time before accept(2).
New gpioctl(8) program to go with new gpio(4).
Have dhclient(8) fall back to user nobody if user _dhcp doesn't exist. Helps with upgrades.
In getopt(3)/getopt_long(3), don't allow an optional argument if it begins with a '-'.
Allow cron(8) to accept crontabs with more strict permissions than is the default.
New General Purpose I/O device gpio(4). Only enabled on i386 for now.
New '!!<prog>' syntax for syslogd(8), used to force messages from the named program to only go to certain files regardless of the rest of syslog.conf.
Update file(1)'s magic to that from file version 4.09, with a few local changes and additions.
Use the old _nointr pool(9) allocator for pf(4) tables.
Rearrange the pool(9) allocator code so the old allocation method can be used again.
Use the quirks mechanism to fix wdc(4) hangs on Geode SC1100 devices (PR#3729).
Implement SCSI-style quirks for wdc(4).
Use errx(3) instead of err(3) in find(1) when errno isn't set by the error.
When calling err(3) after a malloc(3) failure, don't specify a message.
Cleanup in rm(1).
Support multicast on kue(4).
Add IPv6 support to uucpd(8).
Trivial changes (sockaddr_in -> sockaddr_storage) to add IPv6 support to rpc.rquotad(8), rpc.rstatd(8), rpc.rusersd(8), rpc.rwalld(8) and rpc.sprayd(8).
Mark nullfs memory as M_MISCFSMNT instead of M_UFSMNT.
Swing hppa to gcc3, and enable shared library support.
Unbreak xterm(1) jump-scrolling on big-endian 64-bit systems.
Remove a somewhat useless current-process privilege check in the IPv6 input path. Based on KAME.
Compatibility fixes for some sk(4) devices (PR#3061). Workaround from FreeBSD.
Initialise the carp(4) interface structure before use.
Don't advertise an absurd TCP receive window on 64-bit architectures. From NetBSD.
Some Single UNIX Specification updates in <limits.h>.
Better error handling for rm(1)'s -P option. From FreeBSD.
First cut at a home-grown NTP daemon. Not built by default yet.
Remove ugly string code in bpf(4), used when no unit number was given to BIOCSETIF.
Fix a long-standing KAME pasto that was breaking SIOC[DG]LIFADDR.
Remove a bunch of redundant errno declarations.
Use generic crc32 code instead of local efforts in many Ethernet devices.
Sync xl(4) with FreeBSD, bringing in a lot of bug fixes and improvements.
Check the NTP server clock status returned to rdate(8) and don't use the response if the server thinks its clock is unsynchronised.
In uvm_map_clean() (called by msync(2) and madvise(2)), only free writable pages, and don't free copy-on-write pages because the permissions aren't known.
[Applied to stable]
Only call getprotobynumber(3) from ppp(8) when the logging level is high enough to need the result. From FreeBSD.
Some Emacs compatibility tweaks to binutils. Use the classic executable start addresses if ld(1) option -Z (disable W^X) is active.
New privsep user and group _ntp.
New monitoring daemon hotplugd(8) to go with hotplug(4).
New hotplug(4) device to pass device attach and detach events up to userland. Available for alpha, amd64, i386, macppc and sparc64, only enabled on i386 for now.
Use generic CRC code, remove bogus LLADDR use and handle multicast ranges better in nge(4) and sf(4).
Fix bge(4) multicast reception.
Add a description field for network interfaces, accessible via ifconfig(8) command 'description' and ioctl(2)s SIOC[GS]IFDESCR.
Use library CRC32 routines instead of a local implementation in sk(4).
Fix a memory leak in ccdconfig(8).
Remove multicast addresses and disable promiscuous mode when destroying a carp(4) interface.
Make ifconfig(8) up and down commands work as expected for carp(4) devices.
Create a few more USB devices by default in MAKEDEV(8).
Clean up scsi(4) sense error logic and display. Based on NetBSD.
Allow machine-dependent filesystem options to be passed for the root filesystem in src/distrib/miniroot.
Remove the old package tools (src/usr.sbin/pkg_install) from the tree.
Have bgpd(8) detect the absence of ipsec(4) and tcpmd5 capabilities at runtime.
More helpful boot-time display for aac(4).
Fix a typo in umapfs' unmount(2) implementation.
Backwards compatibility fixes in the hash functions, unbreaking skey(1) with sha1.
Make bpf(4) devices clonable.
Make AFS flock(2)/fcntl(2) locks work on the local system.
Make accounting optional, with the new config(8) option (wait for it) ACCOUNTING.
Allow login names longer than eight characters in uucpd(8).
Fix a memory leak in a pfctl(8) error path.
When shutting the system down, finalise accounting before the VFS to avoid panics.
Fix TCP corruption on rl(4) cards.
Much better rulefile parsing for brconfig(8).
Pool efficiency improvements:
Lower the default high watermark from UINT_MAX to 8 pages.
Modify uvm_km_getpage() to take a waitok flag and use it instead of uvm_km_alloc_poolpage1() for both the default and nointr pool allocators.
Use the default allocator for the mbuf and mbuf cluster pools.
Correct a missing freeaddrinfo(3) in ssh(1).
Fix a NetBSD merge error in the TCP syncache, allowing IPv6 to use it.
Fix fd leaks in a few isakmpd(8) error paths.
Call ld.so(1) contructors after setting up the debugger, similar to recent destructor changes.
In cu(1)/tip(1), if one process dies then kill the other ourselves.
In rdate(8) NTP mode, send a 64-bit random number as the 'current time' field, which the server copies back in its response. This avoids sending out the current system time, and makes it slightly harder for an attacker to send spoof replies on behalf of the real server.
Use _exit(2) instead of exit(3) in the sftp(1) child process.
Include the hostname in syslogd(8) memory-buffered entries.
Since the per-arch _dl_bcopy() in ld.so(1) is in all cases a simple for loop and not painstakingly optimised assembler, just use a single machine-independent version.
Allow ld.so(1) _dl_find_symbol() to return a pointer to the container object.
Handle interface removals gracefully in dhcpd(8), now that poll(2) wakes it up on interface detach.
Wake up any poll(2)ing process when a bpf(4) descriptor is closed.
If a bpf(4)-monitored interface is detached, send any buffered packets up to userland.
Scale the bge(4) timeout value correctly.
Since ULLONG_MAX+1 == 0 mod ULLONG_MAX+1, let the carp(4) sc_counter wrap around all by itself.
bktr(4) fixes from NetBSD and FreeBSD.
Move the addition of atexit destructors right to the end of ld.so(1) setup (after the gdb(1) helper code) so they can be debugged.
If ld.so(1) is running under ldd(1), exit earlier before a whole bunch of unnecessary setup gets done.
Check ifp is valid before using it in carp_setroute(), avoiding a panic.
Helpfully, use the right function names in isakmpd(8) error messages.
Fix multicast problems with sk(4).
Don't leak a socket in ndp(8).
Back out the recent fork1(9) change due to compatibility problems.
New MaxAuthTries option for sshd_config(5).
Allow the retval parameter to fork1(9) to be NULL (as the manpage says) without causing a panic.
strtonum(3)ify pflogd(8).
Add gscsio(4) and lmtemp(4) I2C drivers.
Add I2C framework (iic(4), iic(9)) based on that in NetBSD and enable on i386.
Fix a stat(2)-then-open(2) race in isakmpd(8) when checking the policy file for root-only permissions.
Let ipsecadm(8) delete tcpmd5 SAs.
Fix ipsecadm(8) so that ipcomp(4) can be used.
SECURITY FIX: With the introduction of IPv6 code in xdm(1), one test on the 'requestPort' resource was deleted by accident. This makes xdm create the chooser socket even if XDMCP is disabled in xdm-config, by setting requestPort to 0. See XFree86 bugzilla for details.
A source code patch is available.
[Applied to stable]
Fix a boot-time crasher in ahd(4).
Add (to i386 and amd64) ehci(4), a USB Enhanced Host Controller Interface driver, for USB 2.0 support.
Finally implement StackGhost buffer overflow exploit protection on sparc.
Correct a missing splx(9) in an igmp_joingroup() error path.
Fix VFS corruption (due to gcc(1)) on i386 by out-of-lining the spl(9) functions.
Fix size_t != off_t truncation in ahd(4).
Make vmstat(8)'s disk columns wide enough to show transfer numbers for modern disks without writing into the next column.
Change the pf(4) anchor path component separator from ':' to '/'. pfctl(8) now requires any anchor spec containing the separator to be in quotes.
Make /root/.klogin optional in /etc/mtree/special.
Import and merge gdb(1) version 6.1.
Support RFC2796 Route Reflection in bgpd(8), removing the need for an IBGP mesh.
Add support for dynamic network announcements in bgpd(8) and bgpctl(8).
Don't rely on ifp's validity when setting a floor on the TCP MSS in ip_input.c.
Allow an ssh(1) user to cancel a port forward (OpenSSH bugzilla #756).
Do a better job of copying pf(4) relative anchor paths out to userland.
Use the new DLT_PPP_ETHER datalink type to print pppoe(8) frames in tcpdump(8).
Use the right buffer size for strlcpy(3) in libreadline.
Zero the ifreq structure before use when fetching interface info in pfctl(8).
Fix a missing strdup(3) error check in bgpd(8).
Start work on adding the ahd(4) Adaptec PCI/PCI-X Ultra320 SCSI driver from FreeBSD.
Enable the fancy new i386 pagezero code by not resetting it to its old value after setting it up.
Allow anchors within anchors in pf(4). More work to come.
Don't recursively call nd6_output() when route allocation fails, just return a host unreachable error.
SECURITY FIX: A heap overflow in the cvs(1) server has been discovered that can be exploited by clients sending malformed requests. These clients can then run arbitrary code with the same privileges as the CVS server program.
A source code patch is available.
[Applied to stable]
Allow symbolic service- and protocol names in isakmpd(8), so e.g. "Protocol=tcp" now works.
SECURITY FIX: A flaw in the Kerberos V kdc(8) server could result in the administrator of a Kerberos realm having the ability to impersonate any principal in any other realm which has established a cross-realm trust with their realm. The flaw is due to inadequate checking of the "transited" field in a Kerberos request. For more details see Heimdal's announcement.
A source code patch is available.
[Applied to stable]
Add word boundary tests to the regexes that find @-commands in pkg_add(1) etc. packing lists.
Fix SIGINT handling in sftp(1).
Upgrade file(1) to version 4.09.
Updates to aic79xx code from FreeBSD in preparation for the upcoming ahd(4) driver.
Stop some fxp(4) devices creating PCI errors in 10Mbps mode by disabling 'dynamic standby mode' in the EEPROM. From NetBSD.
Handle CRC errors in fxp(4).
Fix a ssize_t != int overflow in rdate(8)'s NTP code.
Generate /etc/ttys(5) entries for all available pty(4) devices, now that more are available.
Fix a missing initialisation in ISA ie(4).
Remove trailer encapsulation support from ifconfig(8).
Fix a reference counting bug in pf(4) DIOCCHANGERULE.
Fix a buffer overrun in ip_output() (FreeBSD PR#66386).
Don't leak a mount structure when handling mount errors in nullfs.
ANSIfy src/libc/gen/*.
Merge new binutils, fix local differences, and enable on arm.
Import GNU binutils 2.14, minus testsuites, infodocs and I18N files.
Bump the default data size to 75MB from 64MB, so that XF4 can be built on amd64 with the imminent binutils upgrade without changing login.conf(5).
Teach file(1) about the b.out (i960) binary format. From NetBSD.
In pfsync(4), make sure the return code gets initialised (pfsync_request_update()).
Add basic COMMUNITIES attribute support in bgpd(8)'s filter language.
Update libiberty's floatformat.[ch] to those from gdb(1) 6.1.
Use arc4random(3) instead of rand(3) in httpd(8) mod_rewrite and mod_ssl, cleaning up surrounding code in the latter on the way.
[Applied to stable]
Remove the now-unused dhclient(8) pidfile stuff from /etc/rc(8).
Add a separate link type, DLT_PPP_ETHER, for pppoe(8) frames. From NetBSD.
Don't skip the graceful shutdown of carp(4) just because the system is being powered down.
When carp(4) backs off because of physical interface problems, advertise this fact immediately instead of waiting for the next scheduled announcement.
Add a workaround in ppp(8) for the recent multipath routing changes.
Fix a two-byte buffer overflow when printing sockaddr structs of unknown type in route(8).
Correct error output for bad limit modifiers in csh(1).
Fix a reference-counting bug in fifofs that could cause certain non-blocking FIFO users (e.g. qmail) to consume 100% CPU.
[Applied to stable]
Interpret ipsecadm(8) cpi and spi parameters as hex even if not preceded by '0x'.
Unbreak pppoe(8) server mode by not doing the chroot(8).
Use a nointr pool(9) instead of generic malloc(9) for pathname storage when doing name-to-inode lookups.
Have newfs(8) dump status information to stderr on receipt of SIGINFO if running in quiet (-q) mode.
Allow the authpf(8) shell to be overloaded by login.conf(5) like the manpage says.
Make the cron(8) socket close-on-exec.
Arrange for cron(8) to check both cron and at(1) databases for jobs if the newly-non-blocking cron socket returns EAGAIN.
Display the right fields in tcpdump(8)'s carp(4) parser.
Make carp(4) backoff work properly by heeding the raised advskew on received as well as sent packets.
Make dhclient(8)'s lease file handling work under the chroot.
Add some new configuration functionality to isakmpd(8)'s FIFO interface.
Allow carp(4) interfaces to be destroyed by ifconfig(8).
Fix systrace(1) examples in /etc/systrace (PR#3748).
Better scsi(4) sense display.
Replace the hand-crafted expr() parser in m4(1) with a standard lex(1)-and-yacc(1) combo. Easier to work on, and more standards compliant too.
Fix msdosfs on 64-bit systems.
Fix bgpd(8) and ppp(8) breakage caused by the new multipath routing code.
Make login_passwd(8) setuid root again, it's needed for 'secure' YP maps.
Call tzset(3) in dhcpd(8), dhcrelay(8) and mopd(8).
Don't print the sendmail(8) version if the helpfile is missing.
Build sendmail(8) with -D_FFR_QUEUERETURN_DSN, allowing faster expiration of spam bounces.
Unbreak checksum generation when using pf(4) scrub random-id.
Change pf(4) routing loop detection so that visiting a packet more than four times is an error, instead of more than once.
[Applied to stable]
Don't abort lint(1) because a child process fails, just move onto the next file.
When doing user mounts, inherit the MNT_NOEXEC flag from the mount point. This stops users bypassing noexec by null-mounting the filesystem on top of itself.
Filter and lock rbootd(8)'s bpf(4) descriptor before dropping privileges.
Unbreak chsh(1) after the recent pw_copy(3) changes.
Import and merge GNU readline 4.3p5.
Double ksh(1)'s command line buffer size to 2K.
Allow the banner page to be turned off by lpr(1).
Add /usr/local/sbin to root's .cshrc, and move /usr/X11R6/bin before /usr/local/{bin,sbin} for both csh(1) and ksh(1).
Remove a bunch of #ifdef ISO and #ifdef notyet crud from nfsd(8).
Make lint(1) understand the 'long long' type.
Make cron(8)'s accept socket non-blocking.
Clobber the 'clobber' command in mail(1).
When user(8) adds a new group, place it before the first '+' entry if one exists (part of a fix for PR#3727).
strtonum(3)-ify ipsecadm(8) and add some more integer value checks.
Properly initialise carp(4) advskew for values greater than 240.
[Applied to stable]
Remove unused variables in several programs on lint(1)'s say-so.
Use the freshly-generated MD5 digest for the SSH1 session ID instead of random stack garbage.
Fix a null deref panic in the pf(4) TCP normaliser.
Swap arc4random(3) for rand(3) in awk(1) unless the user sets the seed, in which case swap random(3) for rand(3).
Add a reference count for bpf(4) descriptors, and don't free resources until processes sleeping on a descriptor have been woken up.
Use a locked, filtered bpf(4) descriptor in mopd(8).
Replace rand(3) with arc4random(3) in ksh(1), unless the user sets the random seed manually in which case rand() is still used.
Allow manually-keyed ipsec(4) AH in bgpd(8).
Initialise ed(1)'s crypto using arc4random(3) instead of rand(3).
Fix a few memory leaks in regex(3).
Resolve hostnames in dhcpd.conf(5) at parse time (PR#3771).
Make carp(4) back off on other interfaces on IP output errors until reliable delivery is restored.
Use the right packet length in tcpdump(8)'s pfsync(4) parser.
Enable 802.1q long packets for vlan(4) support in fxp(4) on cardbus.
Don't allow command substitution characters in the environment variables passed through to dhclient-script(8) by dhclient(8).
Have afsd(8) drop privileges and chroot(2) to the cache directory.
Make the -w option work the same for grep(1)'s regex and fast paths.
Implement sysconf(3) values _SC_SEM_NSEMS_MAX and _SC_SEM_VALUE_MAX.
Fix sizeof(pointer) bugs in amd(8) and netstat(1).
Add a fast path for fgrep(1) and fix the -w option.
Replace the kernel's RSA-derived MD5 implementation with code derived from Colin Plumb's PD version.
Add a filter option to bgpd(8) to dump prefixes learned via UPDATEs into a pf(4) table.
Big FFS softdep merge with FreeBSD, fixing a number of bugs.
Some snprintf(3) and strlcpy(3) cleaning in the X server.
Stop grep(1) doing fseek(3) on stdin if it's a terminal.
Have grep(1) treat a '^H' character as non-binary.
Make dhclient-script(8) work with half-bridge ADSL routers that don't provide a real default gateway (PR#3747).
Apply The Process to pppoe(8): Create a filtered and locked bpf(4) descriptor, drop privileges and chroot(2) to /var/empty.
New _afs and _ppp users for privilege separation.
Fix bgpd(8) capability negotiation bugs and speed it up when working with picky peers.
Increase bgpd(8)'s socket buffer size to 64KB iff IPsec or md5sig is in use.
Fix a race condition in bgpd(8) when a session is closed but there are updates in the buffer.
Add strchr() and strrchr() to libkern.
SECURITY FIX: Check for integer overflow in procfs. Use of procfs is not recommended.
A source code patch is available.
[Applied to stable]
When a pf(4) scrub rule with the 'reassemble tcp' option is in effect, use RFC1913 PAWS as a means of extending the TCP sequence space by 10 to 18 bits. This makes blind insertion attacks much more difficult, because the timestamp needs to be guessed as well as the TCP sequence number.
Sprinkle strtonum(3) liberally all over ifconfig(8).
Match the sha2(3) functions up with the other hash types.
Add a bpf(4) write filter to dhclient(8) and lock the descriptor.
Use tzset(3) before chrooting dhclient(8).
Create the dhclient(8) privsep child before opening bpf(4), creating the routing socket and opening the lease file.
In make(1), keep statistics for suffix transformations.
Remove bootpd(8), bootpef(8) and bootpgw(8) from the tree, their functionality is present in dhcpd(8) and friends nowadays.
Teach nm(1) about ELF .plt*, .got*, .init and .fini sections.
The TCP-specific route metrics are rarely used, so use a trimmed down version in the kernel (struct rt_kmetrics) and fake up a full-fat struct rt_metrics on demand for userland compatility.
Apply bridge filter rules to frames destined for the local machine, so a single-interface bridge can do filtering and tagging.
Add privilege separation to dhclient(8).
Create /var/empty on the installer miniroot so some futuristic pie-in-the-sky privilege-separated dhclient(8) can work.
Convert ping(8) to use strtonum(3).
Add COMPAT_35 config(8) option for kernel binary compatibility with OpenBSD 3.5
Add *Pad (do padding like *Final without finishing) and *FileChunk (digest a portion of a file) functions for each of the hash types in libc.
Tweak ndbm(3), semop(2) and shmget(2) to match POSIX. Since this is an API change, crank libc's and libpthread's major version.
Define bsd_signal(3) as required by XPG. Of course, it's just an alias for signal(3) here.
New stdlib function strtonum(3), a safe replacement for atoi(3) and strtol(3) etc.
Clean up properly if wi(4) PCMCIA attachment fails.
Remove OpenBSD/pegasos. See the mailing list archives for some very good reasons why.
Make cron(8)'s crontab socket non-blocking.
When setting PROT_NONE with mprotect(2) on a wired entry, decrement the wired count and stop ntpd causing a panic (PR#3758).
[Applied to stable]
Some more fixes to strerror(3). Everything now goes via strerror_r(3).
Make cksum(1) a link (in /bin) to md5(1) and remove the old program.
Add support for cksum (three flavours), md4, sha256, sha384 and sha512 to md5(1).
Fix a call to disk_unbusy(9) that lacked the third argument.
Implement pthread_suspend_all_np(3) and pthread_resume_all_np(3), needed by the Java HotSpot compiler. From FreeBSD.
Fix the fixes to strerror(3).
Do privilege revocation in rbootd(8).
Fix a bug that could cause fxp(4) to lock up for 15 seconds under heavy load.
[Applied to stable]
Add _rbootd privilege separation/revocation user for rbootd(8).
Allow pfsync(4) to be built in a kernel without carp(4).
Start the 3.5-stable branch.
Fix non-reentrancy and other bad stuff in strerror(3).
Check isakmpd(8) payload lengths more carefully.
Speedups and cleanups in md4(3) and md5(3).
Fix alignment problems when copying sha2(3)'s data pointer around.
Have nm(1) report empty a.out objects as having "no name list" instead of accusing them of having "bad format".
Replace the old RSA Data Security Inc. implementations of md4(3) and md5(3) with code derived from Colin Plumb's public domain MD5 implementation.
Wire tcpdrop(8) into the build.
Fix a null-dereference crasher in bgpd(8).
Fix file descriptor leaks in pflogd(8), rpc.rusersd(8), spamd-setup(8), tcpdump(8) and tftpd(8).
Remove the old ISC DHCP code from the tree, much to Henning's delight.
In pkg_add(1), allow the PAGER environment variable to contain spaces.
Update libevent to 0.8 + local changes.
Add some Zebra bug compatibility into bgpd(8)'s capabilities announcements.
Put the IP addresses of users authenticated by authpf(8) into the <authpf-users> table.
Support AH as well as ESP flows for bgpd(8) IPsec.
Fix a bogus return statement in pf(4) tables code when dealing with non-IP packets.
Allow bgpd(8) peers to request route refreshes.
Keep track of SAs inserted by bgpd(8), making it easier to remove them later.
Make pf(4) return-rst work on pure bridges.
Remove the assumption, found in a number of places in pf(4), that af !=INET6 implies af==AF_INET.
Have tcpdump(8) print carp(4) packets as carp, and not VRRP.
Some fixes to carp(4) and pfsync(4) statistics counters.
Make carp(4) sensitive to its physical interface: If the physical interface drops, so does the carp interface; and have all other carp interfaces back off (i.e. don't preempt, and set high advskew) so this host is unlikely to stay as master.
Add IPv6 support to authpf(8).
Generate an isakmpd(8) host key in /etc/rc(8), just like the ssh(1) host keys.
Add IKE to bgpd(8)'s IPsec support.
Exit gracefully from pfctl(8) with the -vvsq option if no queues are in use.
Make spamd(8) pass a valid pointer as the fourth argument to getaddrinfo(3).
Add back a couple of missing break statements in bgpd(8), unbreaking tcpmd5.
Have pf(4)'s normaliser check that a TCP RST has exactly the right sequence number. The check only works when we're doing full fragment reassembly.
Stop ipsecadm(8) looping forever when displaying zero-sized extensions.
Allow only BGP traffic over the IPsec flows set up by bgpd(8).
A number of quad fixes in libc.
Allow ssh(1) to pass specified environment variables from client to server (OpenSSH bugzilla #815).
Support RFC2918 "Route Refresh Capability for BGP-4" in bgpd(8).
Fix incomplete removal of altq when loading a new rulebase that doesn't contain altq rules.
New program tcpdrop(8) that uses the sysctl interface to drop TCP connections. Not built by default yet.
Add a -n (no name lookup) flag to systat(1).
Fix select(2)'s readability detection for NFS filehandles (PR#3757). Broken in the change to poll(2) backends, fix from UFS code.
In spamd(8), clear the getaddrinfo(3) hints structure before use.
Break an infinite recursion between tcp_output() and tcp_mtudisc() when the TCP MSS gets to be larger then the interface MTU. Connections will still stall, however.
Allow TCP MSS below the failsafe 216 iff the interface MTU is less than 256.
Back out (for now) the em(4) buffer allocation increase (though not the deferred allocation) as it breaks older cards.
Allow cron(8) to send mail to logins containing an underscore character.
Add direct support in bgpd(8) for ipsec(4) between peers. Manual keying only for now.
Much stricter checking of bpf(4) code, preventing arbitrary reads and writes of kernel memory.
[Applied to stable]
Allocate more buffers for em(4) cards, but defer that allocation until ifconfig(8) up and remove it on interface shutdown.
Fix route(8)'s display of the gateway when set using an explicit -gateway modifier.
When IF_INPUT_ENQUEUE() queues an mbuf(9) with a cluster, check to see if the data in the cluster will fit into the mbuf and if so, copy the data and deallocate the cluster.
For fxp(4) and sis(4), permanently allocate only the minimum number of buffers. Allocate and deallocate receive buffers when ifconfig(8) brings the interface up and down respectively.
Bandwidth checking fixes in altq(9). Now a bandwidth of zero is allowed, producing a blackhole queue for CBQ and a realtime-only queue for HFSC.
Add some htonl(3) paranoia around arc4random(9) calls in pf(4), so that biases in the PRNG won't leak the firewall's byte order.
Fix corruption of pf(4)'s address pools when using more than 256 rules.
[Applied to stable]
In /etc/rc(8), check that carp(4) interfaces really exist before attempting to bring them down at shutdown time.
Start work on peer-to-peer IPsec support for bgpd(8).
Have bgpd(8) announce RFC2858 multiprotocol capabilities. Only IPv4 multicast is supported for now.
Make bgpd(8) prefer older (more stable) routes before resorting to comparison of BGP IDs and peer IP addresses.
Add a reference count for pf(4) anchor rules.
Since isprint(3) doesn't consider all whitespace printable, also use isspace(3) for the binary file test in less(1).
Fix float -> quad conversion in libc.
Prettier output from bgpctl(8).
Permit multiple default routes.
A few more unionfs fixes.
Respect access rights on a union filesystem (PR#745).
Add a few pieces missed in the merge of OpenSSL 0.9.7d.
Add input queue congestion flag support to a few interfaces that can't use the new IF_INPUT_ENQUEUE macro.
Prevent an endless loop in pf(4) with 'route-to lo0' rules (PR#3736).
[Applied to stable]
Have authpf(8) run pfctl(8) to change the rulebase instead of sucking in code from pfctl and doing it itself.
Set MINCLSIZE back to its smaller pre-KAME IPv6 value, so now clusters will be used more often.
In pfsync(4), purge only a specific expired state instead of doing an expensive purge all expired states while running at a high spl(9).
Make sure the local address and bgpd(8) neighbor address are of the same address family.
Use '|' instead of ':' as the field separator for spamd(8) database keys, in preparation for future IPv6 support.
Fix a potential null dereference in the ssl(3) application utility code.
Give routed(8) a local copy of the radix tree code, so it doesn't get (re)broken by net/radix.c changes.
Make ssl(3) S/MIME work again.
Add 'neighbor cloning' to bgpd(8), allowing a configuration to be specified for a network/prefixlength pair as well as the peer IP address. The configuration is cloned for each new peer in the given address range.
Add tcpdrop sysctl(3), allowing a userland program terminate a TCP connection.
Some string cleaning in ddb(4).
Fix a missing return statement in bgpd(8)'s control connection error path.
Add multipath support to the radix tree, allowing multiple routes to a single destination (though it won't actually get you anywhere just yet). From KAME.
Send pfsync(4) packets for IPv6 protocols other than TCP, UDP and ICMP.
Sync kernel radix tree code with 4.4BSD-Lite2 via NetBSD.
Don't add a PF_GENERATED tag to pf(4) synproxy generated packets for the second handshake, so they can match rules (and create state) on another interface.
Add a 'probability' modifier for pf(4) rules, setting the likelihood with which a rule will trigger.
Greatly simplify inetd(8)'s hostname/address lookup code.
Since OpenBSD has openpty(3), we may as well have telnetd(8) use it.
Initial support for IPv6 transport in bgpd(8).
Add spamd(8) config files to changelist(5) and /etc/mtree/special.
Some additional TCP option length paranoia in pf(4)'s normaliser.
Have netstat(1) display the new tcps.rcvacktooold statistic counter.
Sync <tree.h> with Niels Provos' version to get rid of a compiler warning for RB_NEXT(3).
Port the gcc2 bounds checking support to gcc3, enabled with -Wbounded (see gcc-local(1)).
Add some CMSG_ macros to get proper alignment in portalfs. From NetBSD.
In isakmpd(8), make sure the KEY_LENGTH attribute is present when checking AES proposals as this is required when acting as responder to SafeNet peers.
Silence getopt(3) errors in the privileged tcpdump(8) process.
Don't display rubbish on the first output line from vmstat(8), wait for the stats to stabilise.
Fix the calculation of a raw IPv6 UDP packet's checksum.
For dhcpd(8)'s ping probes, just use the pid for the ICMP id like ping(8) does, instead of some architecture-dependent wierdness.
Merge in new Omron LUNA port (luna88k), based on OpenBSD/mvme88k, NetBSD/luna68k and CMU Mach.
As with dhcrelay(8), set a write filter and lock the bpf(4) descriptor before privilege drop in dhcpd(8).
Change pw_copy(3) to take the old entry as an additional parameter, allowing both a change of username and a check that the file hasn't changed since it was last read (fixes PR#3698). Adapted from FreeBSD.
Set a write filter and lock dhcrelay(8)'s bpf(4) file descriptor before dropping privileges.
Drop the port-changing options in dhcrelay(8) too, always use standard ports.
New TCP stat counter tcps.rcvacktooold, counts the number of times we drop very old ACK packets when the sequence number isn't exactly right.
Set the km_page allocator's low watermark to a value that allows the system to boot.
Switch the build over to the new, improved dhcpd(8) and dhcrelay(8).
Remove the -p (listen port) option of new dhcpd(8).
Bump the default kern.maxclusters to a value high enough to deter all but the most determined tweakers.
Remove the GATEWAY config(8) option now that both IP forwarding and mbuf cluster allocation are configurable using sysctl(3).
Introduce a new sysctl(3) kern.maxclusters controlling (oddly enough) the maximum number of mbuf clusters. This deprecates the much-abused NMBCLUSTERS config(8) option.
Use the km_page allocator as the backend for the mbuf and mbuf cluster pools.
New km_page pool(9) allocator running in an interrupt-safe kernel thread (kmthread).
Resource starvation checks for sockets:
Check the level of mbuf(9) cluster utilisation when doing an accepting a listen socket, and fail if usage is greater than 95% of the hard limit.
New API sbcheckreserve() returns ENOBUFS if more than 50% of mbuf(9) clusters are in use
Use sbcheckreserve() when accepting a connection, and on setsockopt(2) for SO_SNDBUF and SND_RCVBUF, and allocate minimal buffers in low-memory situations.
Stop propolice tripping an assert in gcc3.
Make spamd(8) display an error if it can't open the /var/db/spamd database for writing, and return a proper error code.
Cure the angst in user(8) caused by the non-existence of the /nonexistent directory.
Correct new dhcpd(8)'s handling of very long lease times (PR#2888).
Fix a propolice bug in gcc(1) and unbreak MySQL (mysql bug id 1442).
Have ssh(1) perform strict permission checks on ~/.ssh/config files and abort unless they're correct.
If kernel ipsec(4) and/or ipcomp(4) processing is disabled by sysctl(3), pass any packets through as raw IP to give userland a chance to handle them.
Sync the em(4) driver with FreeBSD.
Tidy up usb(4) kernel configs in line with recent i386 changes.
RELIABILITY FIX: Restore the ability to negotiate tags/wide/sync with some SCSI controllers (siop(4), trm(4) and iha(4)).
A source code patch is available.
[Applied to stable]
Since dhcpd(8) can now be invoked legitimately without an interface, don't abort when the user doesn't give any options.
New _tftpd user and group.
Make sure m_pullup2(9) copies the M_CLUSTER flag when it creates a new mbuf (PR#3740).
Have pf(4) block unconditionally when the input queue congestion flag is set, instead of doing CPU-intensive rule tests.
If an interface input queue becomes full, set a new congestion flag in the queue structure. Since a full queue usually indicates processing overload, this flag can be used to allow other subsystems to cooperate in easing the situation.
Make netstat(1) show the number of mbuf clusters in use rather than the number of pages.
Fix a ufs directory-related panic (PR#3672). Fix from FreeBSD.
[Applied to stable]
Have the cvs(1) server check for attempts by a client to walk up the directory tree illegally.
Undo a non-fix in shared memory sysctl(3) kern.shminfo.shmmni.
[Applied to stable] SECURITY FIX: Pathname validation problems have been found in cvs(1), allowing malicious clients to create files outside the repository, allowing malicious servers to overwrite files outside the local CVS tree on the client and allowing clients to check out files outside the CVS repository.
A source code patch is available.
[Applied to stable]
Some address family agnosticism in bgpd(8).
Let bgpctl(8) show IPv6 peer addresses in neighbour view.
Now that dhcpd(8) doesn't need to continuously reopen the leases file for writing, have it chroot(2) to /var/empty and drop privileges after starting up.
Only open the dhcpd(8) leases file once instead of every time it needs to be written.
Set up new dhcpd(8)'s bpf(4) listen filter for the right port.
Have mopd(8) do a chroot(2) to /var/empty and drop its privileges.
Massive style(9) application to isakmpd(8).
Stop another instance of syslogd(8) from unlinking a socket that's in use.
TCP packets are now allowed to have IPv4 options.
Begin work of separating binary emulation type from the executable file format.
New user and group _mopd, for some obscure reason related to mopd(8).
Enable all supported USB devices in the i386 GENERIC config.
Pass the jobname to lpd(8)'s input filter via the -j option, some filters need it.
When the syncache aborts a connection, don't set an ACK in the RST packet.
Add entries for all supported USB devices to the GENERIC config on sparc64.
In crypto(9), add cases for sha2 algorithms in swcr_authcompute().
Fix systat(1) screen updates after resuming from a ^Z.
Make pf(4) antispoof rules work with dynamic interfaces.
Match on all characters of the interface name in the pfctl(8) parser.
[Applied to stable]
Make sure privsep tcpdump(8) transitions into STATE_RUN even when writing to stdout with '-w -'.
Implement AI_NUMERICSERV (from RFC3493) in getaddrinfo(3).
Since the UDP checksum in mandatory in IPv6, drop any input packets where it's absent and make sure it's set even for error output.
dhcpd(8) cleanup:
Use getopt(3).
Remove pidfile code.
Steal some already-sanitised code from dhclient(8).
Remove code to handle network access methods we don't care about, only bpf(4) is necessary here.
Break out dhcpd(8) into usr.sbin/dhcpd and begin The Process.
Have lpd(8) treat 'o' format files (PostScript) from MacOS 10.1 the same as 'l', not 'f', since PostScript can contain binary data. From FreeBSD.
Parse and handle RFC 2858 Multiprotocol Extensions in bgpd(8).
Allow restore(8) to recover files larger than 4GB by using size_t instead of long.
Have dhclient(8) retry up to ten times after a second's delay for interfaces showing no link.
More careful IKE payload parsing in tcpdump(8).
New _PATH_DEVFD and _PATH_VAREMPTY constants in <paths.h>.
Fix a null deref in syslogd(8).
Have new dhcrelay(8) do a chroot(2) to /var/empty and drop privileges.
In libpthread, update curthread immediately after a thread switch.
[Applied to stable]
New _dhcp user and group for, funnily enough, the DHCP programs.
Refactor the installer's network initialisation code into IPv4-specific sections in preparation for IPv6.
Start surgery on dhcrelay(8):
Move to /usr/src/usr.sbin/dhcrelay.
Kill pidfile code.
Use daemon(3) and getopt(3) instead of DIY.
Huge cleanup of mopd(8).
Drop very old TCP ACK packets.
[Applied to stable]
Implement a rate limit for TCP ACKs of 100pps, and use this more general mechanism for in-window SYN handling too.
Safely handle aborts in malloc(3) etc. without tripping the recursive call handler by mistake.
RELIABILITY FIX: Under load "recent model" gdt(4) controllers will lock up.
A source code patch is available.
[Applied to stable]
Fix an accidental busy-wait in sensorsd(8).
Increase the maximum number of pty(4) devices to 992. See the Upgrading Mini-FAQ item 3.5.1 for upgrade instructions.
Fix a typo in kern/tty_pty.c when generating pty(4) device filenames, soon to be exposed by changes to pty.
Compatiblity fixes to mpt(4).
Change snprintf(3)'s handling with size==0, in line with a vsnprintf(3) change (rev. 1.5) from years ago.
Fix a segmentation fault in Xlib when a .Xauthority file contains IPv6 XDM-AUTHORIZATION-1 data (NetBSD PR xsrc/25098).
Rearrange the GENERIC config file so clonable interfaces are together, and without the now-unnecessary device count.
When libpthread is poll(2)ing for read- or writability of an fd on behalf of a thread, check the ERR, HUP and NVAL flags as well as the read or write flags.
Sync uudecode(1) with FreeBSD, including base64 support.
Stop a number of network interfaces moaning about a failed mbuf(9) allocations, the complaint uses mbufs and just makes things worse.
Pass SIGINT and SIGQUIT through to syslogd(8)'s privsep child.
Move the pf(4) altq, OS fingerprint and table pool(9)s from the default (interrupt context) kmem allocator to the much-larger nointr allocator.
If newsyslog.conf(5) doesn't list a user or group, create new files with the uid or gid from the existing file.
Force cvs(1) to use the libc getopt(3) implementation instead of its own.
Have pfctl(8) check that the file it's trying to open isn't really a directory.
More gcc(1) optimiser fixes for mvme88k
Swap the last two parameters to TAILQ_FOREACH_REVERSE(3) in line with FreeBSD and NetBSD.
Use a more efficient realloc(3) size when displaying long lines in less(1). Speeds things up when, for example, your system crashes in the middle of a build leaving a pile of linefeedless binary crap in the typescript file.
After going to the trouble of saving errno before it gets overwritten, use the saved value in pflogd(8)'s error output.
Don't try to close invalid file descriptors in the tcpdump(8) privsep code.
Have isakmpd(8) set the timezone before privsep so the child has the right zone settings.
Within dhclient(8)'s new lease file naming scheme, allow for the -l filename override.
On sparc and sparc64, don't compare a RAMDISK kernel's root filesystem time with the system time, they're unlikely to have much in common.
Zero out the key data pointer for unknown isakmpd(8) key types.
Merge in Perl 5.8.3 and OpenSSL 0.9.7d. No lame new licenses for a change.
Now that dhclient(8) needs an instance per interface, having a single lease file won't do so use /var/db/dhclient.leases.<ifname>.
Make sure the list dereference when deleting all SAs in isakmpd(8) comes before the delete operation that free(3)s the list node.
Fix /etc/rc.local(8)'s handling of ntpd_flags.
Unbreak pxeboot(8/i386, 8/amd64) build under gcc3.
Allow dhclient(8) to work on more than the first physical interface found.
In several programs, fix getopt(3) calls containing option letters for which there's no corresponding case handler.
ISO C function declarations for make(1).
Fix a sizeof(pointer) bug in tcpdump(8)'s IPv6 options parser.
Fix some misplaced braces in route(8), making 'route add' a bit more -q.
Enable /dev/crypto(4) and hifn(4) on cats machines.
Make newsyslog(8)'s file renaming and copying operations set the same permissions in all cases.
Fix double call of the ktrace(2) signal trap handler.
Add missing prototypes (in <pwd.h>) for bcrypt(3) and md5crypt(3).
Fix some gcc(1) optimization bugs on mvme88k.
Fix a sizeof(wrongthing) bug in afsd(8) that was breaking 64-bit machines.
Have tcpdump(8) print IKE DELETE payload contents.
Remove the installer's special-case upgrade of the OpenSSL /usr/include symlinks.
Fix a double-free in libpthread (PR#3730).
Reenable libm compiler optimization on sparc64, since it works properly with gcc3.
sscanf(3) -> strtol(3) in newsyslog(8).
Don't initialise ncurses(3) until after options processing in backgammon(6).
Plug the new-and-improved dhclient(8) into the standard build.
Fix a sizeof(pointer) bugs in afsd(8), sup(1) and visudo(8).
Make pf(4)'s cache of m_tag_get() results actually work.
Check for fdopen(3) failure in vacation(1).
3.5 -> 3.5-current.
Change wskbd(4)'s AltGr key handling so shift-altgr-other has the same effect as altgr-shift-other.
Never allow pf(4) states propogated via pfsync(4) to overwrite newer states held locally. If an overwrite is attempted, broadcast the newer version to the network to speed resynchronisation.
Under Linux emulation, pass madvise(2) straight through to the native syscall.
RELIABILITY FIX: Reply to in-window SYN with a rate-limited ACK.
A source code patch is available.
[Applied to stable]
Don't try to recreate the xfs(1) logfile after dropping privileges.
Don't abort xfs(1) gracelessly when handling an unimplemented protocol request.
Many manual page fixes.
In a number of programs, don't close files that are known to be not open.
Fix a missing initialisation in tcpdump(8)'s privsep code.
Make spamd(8)'s -v logging option do something useful.
Fix line breaks in spamd(8)'s log output.
Allow non-GNU ANSI compilers (e.g. TenDRA) to build again by changing 'static inline' to 'static __inline'.
Don't close descriptors we know aren't open in syslogd(8).
Drop arc4random_8() api from the kernel.
Change rfork(2) so the RFMEM flag gives complete vmspace sharing including the stack, in line with other implementations.
Add --line-buffered option to grep(1) etc.
Remove some unbounded recursions in the libc regex engine, found with certain expressions containing backreferences.
Fix ls(1)' column alignment when using the -h option.
New axe(4) USB Ethernet driver.
Fix an off-by-one in procmap(1).
Better bounds checking in the ramdisk's strategy() routine.
Limit the trust between local and remote instances of the rcp(1) and scp(1) programs.
Change netstat(1)'s -p option so that, when used without -s, it shows a list of sockets for the given protocol.
Let rcmdsh(3) work on hosts without an IPv4 address.
Initialise the kqueue(2) subsystem in kernel main() instead of on first use.
Add IPv6 support to openssl(1)'s s_client command, complete with the usual '-4' and '-6' switches.
Reorder checks in ssh(1) so that the IP options check isn't skipped just because UseDNS=no.
Make /usr/src/Makefile's cross-tools target work again.
Have inetd(8) properly use the exec'd program's basename as argv[0] if no arguments are specified.
Fix includes search order in GNU ld(1) to help cross-ld builds.
Don't byte-swap a variable we'll need later in its original order in GNU ld(1).
On an msdos filesystem with long filenames support enabled, fix some false-positive name matches when an integer multiple of 13 characters match. From NetBSD.
Some portability fixups in isakmpd(8).
tcpmd5 changes for bgpd(8):
Allow either the source or destination to be a wildcard in SA lookups (netinet/ip_ipsp.c:gettdbbysrcdst()).
Add support for the wildcard to pfkeyv2.
Use the new pfkeyv2 wildcard support in bgpd(8) and remove the local address requirement for md5sig.
Unbreak libc's regex engine compilation with -DREDEBUG.
Change /etc/rc(8) so that a spamd(8) banner (configured via $spamd_flags) may contain spaces (PR#3720).
Teach pax(1) how to expand GNU tar long links. From NetBSD.
Change systrace(1)'s handling of filename-too-long errors so it just fails the syscall instead of stopping the process. Fixes PR#3140.
Some ELF name translation fixes in nm(1).
Add /etc/rc.conf.local to /etc/mtree/special.
Lots more activity on the SMP branch.
Wrap pkg_add(1) installation operations in perl(1) eval{} blocks so it's possible to at least register what did work.
Unknown entry types in a packing list now result in an error.
--------
Changes made between OpenBSD 3.4 and 3.5
Don't use FD_ZERO(2) in isakmpd(8)'s privsep monitor.
When binding UDP server sockets in isakmpd(8), check the sockaddr buffer is large enough before copying.
Add some extra sanity checks for incoming pfsync(4) packets.
Fix a kernel memory leak when deleting interface addresses (SIOCDIFADDR).
Add a missing spl(9) around if_down() in vlan(4).
In pf(4), properly m_copyback(9) the modified TCP sequence number after demodulation.
[Applied to stable]
Fix a use-after-free in carp(4).
Raise carp(4) advskew to 240 while waiting for the pfsync(4) bulk update. This makes sure that other hosts can preempt a host that's booting up but hasn't got its network bearings yet.
Fix a check-for-null-then-deref-anyway bug in icmp6.
Fix a cut-and-pasto in pf(4)'s stateful ICMP code.
Unbreak the ICMP checksum when pf(4) sequence number modulation is used.
[Applied to stable]
Disable carp error logging (sysctl(3) net.inet.carp.log) by default.
Remove an unnecessary null termination in the isakmpd(8) privsep monitor.
Teach file(1) about OpenBSD-amd64 binaries and coredumps.
Add a small delay before the bulk update to stop pfsync(4) looping unnecessarily.
Fix ssl(3) rmd160 breakage on sparc64.
Teach tcpdump(8) how to display the new pfsync(4) bulk updates.
Make pfsync(4) stop carp(4) preempting to become master until the bulk state table sync has completed.
Support best-efforts bulk transfers of states when a pfsync(4) syncif is first configured. This allows pfsync+carp clusters to come up gracefully without killing active connections.
Have rc(8) stop carp(4) interfaces on system shutdown.
Add pass rules for the pfsync and carp protocols to the default pf(4) rulebase installed by /etc/rc(8).
Make sure pfsync(4) interfaces are initialised before carp(4) interfaces in /etc/netstart(8).
Unbreak routing change handling in carp(4).
Bump OpenSSH to version 3.8.1.
Make pfctl(8)'s '-s osfp' option work by spelling it less like OSPF.
Update pf.os(5) to include OpenBSD 3.5, since that's where it's now at.
Have tn3270(1) check errno instead of setting it.
Fix yet another stray semicolon, this time in aac(4).
Implement firmware downloading for mpt(4).
Make bge(4) work on 64-bit machines even if they're not alphas.
Have privsep named(8) pass SIGINT to the child process.
Upgrade Puffy to 3.5 and lock XF4 for release.
Add final pieces of privilege separation for isakmpd(8) and switch it on.
Add pxeboot(8) for i386 and amd64, derived from NetBSD.
Fix another stray semicolon, in tcpdump(8)'s ASN.1 printer this time.
More mpt(4) fixes, more to come.
When initialising the new state in pf(4) DIOCADDSTATE, point to the default rule instead of NULL.
Merge parts of XFree86 4.4.0 Release not affected by the new license.
Allow a carp(4) device's state to be set explicitly with ifconfig(8).
Set permissions on the right files for the @owner, @group and @mode directives in pkg_add(1) when -B is in effect.
For wi(4) devices with Prism firmware version 1.6.3 or later, support an enhanced security mode for a hostap where the SSID can be hidden from snoopers.
Speed up bgpd(8) session reestablishment.
Fix timeout issues with eap(4) audio devices.
Stop the installer asking for the timezone when upgrading.
Fix spamd(8)'s logging when the blacklist limit is hit.
Allow users with write access to bgpd(8)'s control socket to send queries.
Fix an out-of-bounds read in ssl(3) (CAN-2004-0112). This code isn't used in OpenBSD.
Always read at least DEV_BSIZE (512) bytes of the disklabel, some disks have smaller block sizes.
RELIABILITY FIX: A missing check for a NULL-pointer dereference has been found in ssl(3). A remote attacker can use the bug to cause an OpenSSL application to crash; this may lead to a denial of service.
A source code patch is available.
[Applied to stable]
Fix a minor memory leak in isakmpd(8).
Lots of pre-release documentation fixes and additions.
If running at securelevel(7) 2, use the -x option to increase the chances of ntpd using slew mode, since stepping backwards is disabled at this level.
Some mpt(4) stability fixes.
Don't signal mountd(8) from mount(8) when all that's required is a listing of mounts (PR#3695).
Create bgpd(8)'s control socket later in the startup.
Remember to unlock USB wi(4) devices on errors.
Since we've allocated a cache for pax(1), let's go right ahead and use it.
Remove 'extern int errno' in favour of #include <errno.h> in a number of programs.
Have diff(1) in directory mode skip over anything that's not a regular file or directory, for POSIX reasons.
Yet another stray semicolon removed, pax(1) is the lucky program.
Prevent blacklist connections we're tarpitting from maxing out spamd(8)'s available connections. Controllable with the new -B option.
Have wi(4) hostap send an error response if a station sends a bogus challenge instead of just ignoring it.
Make software WEP work on wi(4) devices. Only in BSS (station) and hostap modes for now.
Fix another bug caused by a stray semicolon, this time in tcpdump(8).
daemon(3)ise ifstated(8) earlier.
Some logic fixes and additional error checks in USB wi(4).
Have sensorsd(8) deal gracefully with attempts to initialise unsupported sensor types.
Fix memory leak caused by a stray semicolon in arla.
panic(9) if an attempt is made to use the kernel arc4random generator too early.
Fix occasional locate.updatedb(8) failures due to a bug in sort(1).
Check chdir(2) return code after chroot(2) in bgpd(8) and isakmpd(8).
Fix a memory leak and a missing break in pf(4) ioctl processing error paths.
Clear struct sockaddr_un before use in syslogc(8).
In spamd(8), only shrink the window once we're in the DATA mode. This way, greylisted connections don't get held up by the tiny window but spam bodies are still sent. Very. Slowly.
Restore scsi(4) bus scans to full speed by not checking LUNs that will be skipped anyway.
Fix fd and another memory leak in routed(8).
Make the sane_install() tests in the installer match more useful reality.
Check the return code of chdir(2) after the privsep chroot(2) in pflogd(8), syslogd(8) and tcpdump(8).
Disable crypto(9) MAC functions for now, no current hardware can use them.
Some oosiop(4) cleanup based on osiop(4).
In wskbd(4), make the caps lock key do caps lock instead of shift lock (PR#2555).
Make it easier to kill spamd(8) greylisted processes.
Do pfsync(4) interface setup last in /etc/netstart(8), so that hopefully the syncif gets set up beforehand.
Make bgpctl(8)'s empty-as keyword work.
Extra free-then-NULL paranoia in spamd(8).
Fix wi(4) software WEP on big-endian machines.
Unbreak tail(1) -f mode for filesystems not blessed with kqueue(2) support.
Implement privilege separation for named(8). And there was much rejoicing.
Plug a rtentry leak when TCP gives up on a cached route (in_pcb.c:in_losing()).
Fix (guess what?) a memory leak in the yacc(1) skeleton code.
Check the payload size more carefully when printing IKE messages in tcpdump(8).
Plug a memory leak in the error path of execve(2).
[Applied to stable]
Preliminary port of the NetBSD oosiop(4) driver, supporting really old NCR SCSI chips on hppa machines.
Unbreak pkg_add(1)'s handling of packages from stdin.
Fix a bug in spamd(8) that stopped custom 450 messages being displayed.
Some apm(4) fixes on i386.
Sync the spamd(8) greylist database after each db operation, to minimise the likelihood of corruption.
Add basic community support to bgpd(8).
Correct a missing malloc(3) error check in bgpctl(8).
Fix byte-ordering problems in routed(8) (PR#3704). Based on NetBSD.
RELIABILITY FIX: Defects in the payload validation and processing functions of isakmpd(8) have been discovered. An attacker could send malformed ISAKMP messages and cause isakmpd to crash or to loop endlessly.
A source code patch is available.
[Applied to stable]
Obey the user's 'boot reboot' command at the ddb(4) prompt, even if the system is starting up.
Some signedness paranoia when handling carp(4) sysctls.
Fix missing checks for NULL returned from getpass(3) in login_*(8).
Make bgpd(8) work harder to clean up after itself on exit.
More work on capability announcements in bgpd(8).
Fix an isakmpd(8) crash when deleting an ESP SA with no authentication (PR#2429).
Symlink-handling improvements in pkg_add(1) etc.'s virtual filesystem code.
Simplify the new scsi(4) LUN scanning logic, and print better diagnostics.
New -b option to spamd(8), used to set the local bind address.
Allow the wsdisplay(4) screen blanker to be turned off again (PR#3123).
3.5-beta -> 3.5.
Increase the ssh(1) X11 cookie lifetime from two to twenty minutes.
Plug some memory leaks in error paths of isakmpd(8).
Fix multicast for recent sk(4) chipsets. From FreeBSD lists.
Be more thorough when URL-encoding usernames and passwords in the installer.
Prevent the user specifying an interface name longer than IFNAMSIZ in ifconfig(8).
Many, many more memory leak fixes in pfctl(8)'s parser.
Fix a few missing initialisations in ssh-keyscan(1).
Have pkg_add(1)'s dependency lookup check against local directory listings.
New -A (pretend to be another architecture) and -P (limit distribution type) options to pkg_add(1).
More memory leak fixes to ifstated(8)'s parser.
Fix a null deref in ifstated(8).
Have nc(1) print an error message if connect(2) fails.
Plug well-hidden memory leaks in bgpd(8), ifstated(8) and pfctl(8)'s parsers.
Signal-handling tweaks to syslogd(8).
Add mpt(4), a driver for LSI Fusion-MPT SCSI and Fibre Channel devices.
Plumb bgpd(8) into /etc/rc(8) and /etc/rc.conf(8).
More memory leak fixes in bgpd(8).
Just chdir("/") in mg(1) instead of panicking if the initial getcwd(3) fails.
Start work on capabilities announcement support in bgpd(8).
Since not rejecting optional attributes in BGP implies acceptance/support, make bgpd(8) reject attributes it doesn't support.
Send outstanding notifications to a bgpd(8) peer returning to the IDLE state.
Stop carp(4) sending duplicate route add/delete messages.
New IdentitiesOnly option for ssh_config(5), useful when an agent has many keys.
Don't leak memory in scandir(3) (FreeBSD PR#7923, from 1998!)
Fix a big greylist-related memory leak in spamd(8).
In kdump(1), fix an off-by-one and describe ptrace(2) calls better.
Allow -stable kernels to build without TCP_ECN.
Fix a few small key handling bugs in svnd(4).
Actually use the alternate RADIUS server in login_radius(8).
Make sure that svnd(4) mounts can read their disklablel as svnd, not vnd.
Extend md5(1)'s -c option so it can parse the output of GNU md5sum.
Remove dynamic bufq support from wd(4) due to problems.
Plug some memory leaks in bgpd(8).
Stop libreadline segfaulting when writing an empty history list to a file (PR#3690).
Fixes to sftp(1)'s progress meter.
Change sshd(8) child processes' proctitle to '[accepted]' after the, uh, accept(2) completes.
Repair procfs status output (PR#2102).
Fix unintentional ordering dependency in kernel module loading and unloading (PR#2910).
Allow forced unmount(2)s of nullfs, procfs (both from PR#2394,) and umapfs.
Fix an off-by-one in procfs so that it can be successfully unmounted (PR#2327).
Clean up badsect(8)'s error reporting (PR#3679).
Start spamd(8) later in /etc/rc(8).
Fix an mbuf(9) leak in tun(4) under failure conditions. From NetBSD.
Count mixerctl(1) devices starting at zero instead of stack garbage.
Fix wi(4) reset problems with newer Prism firmware.
Make hostap mode work for Prism wi(4) cards with newer firmware, and disable hostap mode for old firmware.
Socket types and error checks cleanup in talk(1).
64-bit fixes to brconfig(8).
More features for bgpctl(8)'s 'show rib' command.
Fix a memory leak in dhcpd(8)'s parser.
Use daemon(3) instead of DIY in new dhclient(8).
Start sshd(8) earlier in /etc/rc(8).
Generate new dhclient(8)'s transaction id (xid) using arc4random(3) instead of random(3).
Have dhclient(8) (old and new) exit cleanly if its interface goes away (PR#3648).
New sysctl(3) net.inet.tcp.reasslimit, to control the size of the memory pool for TCP out-of-order segment reassembly that was introduced in the last erratum.
RELIABILITY FIX: OpenBSD's TCP/IP stack did not impose limits on how many out-of-order TCP segments are queued in the system. An attacker could send out-of-order TCP segments and trick the system into using all available memory buffers.
A source code patch is available.
[Applied to stable]
Strip out all the multiple-interfaces code from new dhclient(8), it's not used any more.
Be sure to call fifofs' reclaim function from its host filesystems (ext2fs, ffs, nfs).
[Applied to stable]
Give fifofs a real reclaim function to prevent memory leaks on rovocation, and fix a potential null deref.
[Applied to stable]
Disable the COMPAT_25 compatibility option in GENERIC kernels.
Catch illegally large AS numbers in bgpd(8).
Rewrite of mount_portal(8), complete with IPv6 support.
Cleanup and paranoia in spamdb(8).
Support 'tagged <name>' specifiers on pf(4) anchor rules.
Better IPv4 address validation in spamd(8).
Process NOTE_TRUNCATE messages in tail(1) and unbreak file truncation handling in -f mode (PR#3689).
Allow bgpd(8) to run in route-collector mode, i.e. disable the decision process.
Build libf2c for GCC3 architectures.
New -d option for nc(1), which disables reading from stdin (PR#3694).
Fix a memory leak when the control socket detaches from bgpd(8).
Make bgpctl(8)'s control socket nonblocking.
Import libf2c from GCC 3.3.2.
Show the number of TCP connections drained (by new tcp_drain()) in netstat(1) output.
Don't stat(2) the compress(1) outfile when running in test mode.
Re-enable propolice if the X server is built without module support.
Check the sign of values given to the hw.setperf sysctl(8).
strtol(3) and signedness cleanup in ping(8).
Sync the installer with the ftp(1) fetch-mode fix.
Open a new connection for each file pulled down by ftp(1) in fetch mode. Fixes problems where 'CWD /' does unexpected things.
Fix the test that disallows interface unit numbers greater than INT_MAX (to avoid signedness confusion).
Don't allow leading zeros in cloner interface names.
Upgrade 3.4-stable to OpenSSH 3.8.
spamd(8) greylist cleanup and fixes.
In ssh(1), make the read buffer for moduli(5) large enough for 8Kbit primes.
Stop sshd(8) sending DH groups with a primitive generator of zero or one.
Fix a race condition in wi(4) by disabling interrupts before sending an ACK. From NetBSD.
Fix some over-zealous assert()ing in afsd(8).
Add DH group 14 (modp2048) to isakmpd(8)'s list of predefined quick mode suites.
3.4-current -> 3.5-beta.
Remove a null deref and unbreak WSDISPLAY_USEFONT for vga(4).
Fix an nfsv3-related panic that could occur when linking from a local fs into an NFS mount.
[Applied to stable]
Add an implementation for the tcp_drain() function, similar to ip_drain().
[Applied to stable]
Stop pfctl(8) '-s all' printing the entire OS fingerprint database and all the interfaces.
Interoperability fixes for isakmpd(8), particularly when talking to a Cisco PIX.
Don't use a regex when deleting a user from a group with userdel(8), since the username may contain regex special characters. Also, chmod(2) the new group file before moving it into place instead of after.
Fix IP data length calculation in mrinfo(8) and mtrace(8).
Fix ifconfig(8)'s matching of multi-digit interface names, e.g. stop vlan10 matching as vlan1.
Add __va_copy() in <stdarg.h>, following old ISO C89 behaviour. Used by GNU software.
Support dumping of the bgpd(8) RIB via bgpctl(8).
Have bgpd(8) check that the nexthop is a valid range (i.e. not a class D, class E or a loopback).
Better logging for ifstated(8), taken from bgpd.
More enhancements to bgpd(8)'s filter language.
Include tcps_rcvmemdrop in netstat(1)'s TCP statistics output.
Add 'greylisting' support to spamd(8). Oh yes.
Remove a sizeof(long)==4 assumption in ld.so(1) that could errnoeously zero four bytes of the next page.
Add -B (destdir) support to pkg_delete(1).
New Loglevel and Logverbose options for isakmpd.conf(5).
Stop pfctl(8) clearing too much when -Fa is used and an anchor is given.
Reorder code in dhcrelay(8) so that the server list is zero-filled before we add servers to it, not after.
Allow tuning of bpf(4) buffer sizes via sysctl(8) variables net.bpf.*.
Add /usr/local/share/fonts to /etc/fonts/fonts.conf, good for ports.
Fix send_packet() return value checks in dhcrelay(8).
Don't allow 'max-src-nodes' in a pf(4) rule if 'source-track global' is in effect.
Enhancements to bgpd(8)'s filter language.
Stop new dhclient(8) generating a pidfile.
Use getopt(3) instead of DIY in new dhclient(8).
Remove the interface discovery scan from new dhclient(8), and so require an explicit interface name.
Don't allow 'max-src-nodes' option anywhere other than in a 'source-track' pf(4) rule.
A number of fifofs fixes from FreeBSD.
64 bit-specific binutils fixups. From binutils CVS.
New slinear16-to-alaw audio format converters. From NetBSD.
Better pread(2) and pwrite(2) error checks in libkvm.
Fix a potential null deref when looking for a free pty(4) device.
A little bounds-check paranoia in procmap(1).
Make malloc(3) options work properly for programs that need ld.so(1).
Build and install procmap(1) by default.
Better heap discovery heuristic for procmap(1),
Explicitly disallow backward jumps in bpf(4) filter programs.
More cleanup and dead code removal in the new dhclient(8).
Remove raw socket fallback code from new dhclient(8), since OpenBSD always uses bpf(4).
Bump OpenSSH version to 3.8.
Bignum fixes in ssh(1).
Set sshd(8)'s listen socket to non-blocking mode again, reverting the change from 26 Sept 2003.
Fix an objdump(1) segfault on sparc64. From binutils CVS.
Fix an out-of-bounds read when comparing IPv6 prefixes if the prefix length is 128.
Add pthread_attr_[gs]etstack(3) and bump libpthread minor version. From FreeBSD libc_r.
String cleaning in fvwm(1) and wm2(1).
Some cleanup of <pthread.h>. From FreeBSD's libc_r.
Fix a locking-related crash when using a portal filesystem.
Have pkg_add(1) make a distinction between an unreadable or non-package, and an inaccessible package file.
Fix pciide(4) timeouts at the end of each cdrecord burn.
Build sparc64 with gcc3. Gulp.
Many USB device fixes from NetBSD.
Fix a race in scsi(4), now cdrecord can safely write at high speeds.
Re-fix 'VT black text on black background' and other XFree86 bugs for ATI cards, lost in the recent merge.
Teach passwd(1) about the master.passwd.byname map so it can work in a secure (makedbm -s) environment.
Uncomment and fix code for old tip(1) variables cdelay and ldelay.
Have tcpdump(8)'s pfsync output show the interface being cleared if available.
Update pfsync(4) to cope with interface-specific state clearing with e.g. pfctl -i fxp0 -Fs'.
Add PKG_DESTDIR (-B option) support to pkg_add(1).
Improvements to the new auto-generated MAKEDEV(8) manual pages.
Allow pkg_add(1) etc. flavor names to contain dots and other special characters.
Set files that ypbind(8) creates to mode 0644 with fchmod(2), just in case they're created with a more restrictive umask(2).
New .Ex, .In and .Rv mdoc(7) macros.
Fix some double-free(3)s in isakmpd(8).
Resurrect old-style fontconfig-config program, still needed by some ports.
Make sure that the guard page is also marked as MALLOC_FREE by free(3), to cut down on bleating #ifdef MALLOC_EXTRA_SANITY.
Basic filtering support for bgpd(8).
Add pfctl(8) -i support to -Fs, -ss, -sq and -w options.
New smartreadlog command for atactl(8) to, well, read SMART logs.
Fix SMART log-related panics in wdc(4).
Have mount(8) report the actual xfs device mounted, and not just 'arla.'
In isakmpd(8), handle SIGINT the same as SIGTERM when running with -d, and dump logs to syslog at LOG_INFO without -d.
Fix a memory leak in tftp(1).
Bring pf(4) queue id semantics into line with tag assignment, and remove last vestiges of userland qid code.
Stop bc(1) modifying argv and optind while inside the getopt(3) loop.
In gcc3, add a few missing open(2) third options when used with O_CREAT.
Revoke procmap(1)'s privileges immediately after kvm_openfiles(3).
Make sure doesn't call strtoul(3) on non-numbers.
In procmap(1), print the names of missing symbols instead of '(null)'.
Extra bzero(3) paranoia for data coming out of the scsi(4) xfer pool.
Memory and string cleanup in procmap(1).
Implement kevent(2) and kqueue(2) under FreeBSD emulation, using the native calls.
Fix mishandling of numeric options in sed(1) (PR#3677).
Add -i option to pfctl(8), restricting operations to the given interface. Only -sI implemented for now.
sparc64 alignment fixes in gcc3 propolice.
const'ify some more pthreads(3) prototypes for POSIX reasons. From FreeBSD libc_r.
In chmod(1), check that 'foo.bar' isn't an existing username before assuming it's old-style user.group and treating it like user:group.
Don't allocate a cluster in tcp_output() when the whole header fits into an mbuf(9).
Add -4 and -6 IP transport selectors to rdate(8). Oh yes.
Add an extra check for a null transport in isakmpd(8) exchanges.
Use off_t instead of long so that tail(1) can handle large offsets.
Remove more unnecessary checks for 8-bit values > 255, this time from libc/ethers.c.
Add a missing realloc(3) failure check in asn1_compile.
Generate the MAKEDEV(8) manpages automagically based on the same information as the MAKEDEV scripts themselves.
gcc(1) propolice fixes on i386.
First cut at procmap(1) from NetBSD (where it's called pmap). Not yet built by default.
New 'split' option in iostat(8) for the newly-separated disk read/write stats.
Check for TDB entries marked as invalid when looking up tcpmd5 connections.
Record separate disk statistics for read and write operations. Adapted from NetBSD.
In ifstated(8), don't bcopy(3) around a structure containing TAILQ pointers.
Better SIGHUP handling in ifstated(8).
Refactor processor speed settings sysctl code (hw.cpuspeed, hw.setperf) for clarity.
Fix broken tcpdump(8) IKE output for certain vendors' phase 1 proposals.
New driver, bce(4), for Broadcom 4401 10/100Mbps Ethernet devices.
Drop the osigaltstack() compatibility system call.
Import and merge XFree86-current of 2004/02/13, minus files with the new XFree86 License which contains text developed by The XFree86 Project, Inc (http://www.xfree86.org/) and its contributors.
Make sure all pf(4) anchors get updated after an anchor is removed.
Better signal handling and other cleanup in pflogd(8).
Print textual service and protocol names properly in tcpdump(8) even when -n is specified.
Some cleanup and an additional mode for acss(3).
Disallow em(4) PHY resets when IP is enabled on an interface to prevent lockups when using GigE copper.
Use a hash table instead of a linked list to speed up 802.1q tag -> vlan(4) interface lookup.
New -p flag for pfctl(8), allowing the device to be something other than /dev/pf.
Logging cleanup in ifstated(8).
Revert some propolice breakage in gcc3.
64-bit alignment fixes in ifstated(8).
RELIABILITY FIX: Several buffer overflows exist in the code parsing font.aliases files in XFree86. Thanks to ProPolice, these cannot be exploited to gain privileges, but they can cause the X server to abort.
A source code patch is available.
[Applied to stable]
Add missing volatile to a signal handler flag in dc(1).
in tcp_input(), stop an unsigned integer underflow from making the TCP MSS calculation return ridiculously large values when ifp==NULL.
Reduce makewhatis(8)'s newly-increased pickiness a little.
Fix another bug that allows a pf(4) antispoof rule on an interface with no IP addresses to result in all other interfaces blocking all IP packets.
Install bgpd.conf(5) root:wheel, mode 0600 and make bgpd(8) insist it be so.
Reduce the default number of pty(4) devices from 64 to 16, now that additional ptys will be created on demand.
Fix an off-by-one when generating pty(4) device names (ptydevname()).
Make tcpdump(8)'s pfsync(4) output more consistent with other tcpdump output.
Plug an mbuf(9) leak by making ip_fragment() free the mbuf on errors instead of expecting the caller to do it.
[Applied to stable]
Add a flag so that hardware sensors can be marked as invalid if, for example, they're disconnected.
Make picky mode in makewhatis(8) even pickier.
Fix an off-by-one in pf(4)'s interface management code.
Have ndp(8) flush stdout before sleeping in -A mode (KAME pr#584).
In the new dhclient(8), don't send pointless DHCPDISCOVER messages on interfaces that are known to have an inactive link status.
Allow for the presence of tcpmd5 signatures in the TCP MSS calculation.
Have pfctl(8) display a filter uptime now that we keep track of when it was last enabled.
Make pfsync(4) work on 64-bit alignment-sensitive architectures when IP options are present.
Unbreak ypset(8)'s -h option. From FreeBSD.
Have sysctl(8) politely inform users that pstat(8) with -t is the tool of choice for viewing terminal information.
Support -$ option (disallow '$' in identifiers) and -notraditional in cpp(1) for gcc2.
New ptm device (see pty(4)) that allows non-privileged processes to allocate a properly-permissioned pty. No more setuid(root) xterm(1)!
Stop assuming that tty sysctl(3) variables are quads. Some are now ints.
Dynamically allocate kernel memory for ttys, controlled via sysctl(3)s kern.tty.{maxptys,nptys}. Adapted from NetBSD.
Teach boot(8) how to load read-only data segments for ELF architecture kernels.
If the i386 bootloader fails, enable interrupts before halting so ctrl-alt-del will work.
Install the edit USD doc, reworked to be an ex(1) tutorial, under /usr/share/docs/usd/11.edit.
In the XF4 Makefile, fix -o operator precedence for the find(1) command when checking for incorrect file permissions.
Add missing MLINKS and do some .Nm macro cleanup to help makewhatis(8).
Don't flush pf(4) stats when using the -e or -d options to pfctl(8). Store the time at which the filter was last enabled.
Unbreak the pf.conf(5) 'set loginterface' command.
Have lex(1) declare errno for c++ users too.
Allow libstdc++ to build on architectures with no shared libraries.
Fix a panic when cleaning up after an interface (e.g a PC Card wi(4)) has gone away (PR#3649).
Unstick the -a option from ps(1) (PR#3676).
Sync the installer network startup with changes in netstart(8).
Fix a memory allocation-related panic in pfsync(4) that can occur under very high loads.
Fix a buffer overflow in XFree font aliasing. From XFree86 CVS.
[Applied to stable]
Don't fully unroll kernel rijndael code to save some space.
Some fixes to ahc(4), mostly from FreeBSD.
Additional sanity checks when probing scsi(4) luns.
Disable interrupts on a scsi(4) controller for polled commands, fixing a long-standing hang at attach time on i386.
Stop dhclient(8) burping interface information to stderr.
Have libpcap(3) use the kernel default buffer size instead of setting its own size.
Bump the bpf(4) maximum buffer size to 2MB, and the default size to 32KB, to allow for faster networks and larger frame sizes.
Turn on ddb(4) logging (sysctl(3) ddb.log) by default.
Allow bind(2) to work in an IPv6-only (no IPv4) configuration.
First cut of a filtering language for bgpd(8).
Another pass at making dhclient(8)'s code readable.
Fix a curiously familiar reference-counting bug in uvm(9).
SECURITY FIX: A reference-counting bug exists in the shmat(2) system call that could be used by an attacker to write to kernel memory under certain circumstances. Adapted from FreeBSD.
A source code patch is available.
[Applied to stable]
Fix a CVS merge error in xterm(1)'s app-defaults file.
Make pfctl(8) -vvsq loop again (PR#3675).
Unbreak the ssh(1) progress meter ETA for files larger than 4GB (OpenSSH bugzilla #791).
Fix a memory leak in dhclient(8) (PR#3668).
If ssh(1) is in privsep mode, pass the SIGALRM from LoginGraceTime expiry through to the child process.
Apply the same strict RFC 2460 interpretation used for the IPv6 MTU to the TCP MSS calculation.
New parser for ifstated(8), and more features. Still more to come.
Fix grep(1)'s ^ and $ anchors that were broken by the recent -w fixes.
For programs that don't support long options, stop getopt(3) treating '--foo' the same way it treats '--', as per POSIX (PR#3666).
[Applied to stable]
Let pfctl(8) deal gracefully with 'modulate state' on rules with protos to which it might not apply in the same way as 'keep state', e.g. 'pass proto {tcp udp} modulate state' is now acceptable.
Don't use a valid user id as a flag value in ps(1).
Remove the earlier fix for the IPv6 MTU crash bug now that the full fix is in place.
SECURITY FIX: An IPv6 MTU handling problem exists that could be used by an attacker to cause a denial of service attack against hosts with reachable IPv6 TCP ports. Fix this fully by applying a strict interpretation of RFC 2460 section 5, last paragraph.
A source code patch is available.
[Applied to stable]
Memory alignment fixes in tcpdump(8).
Huge amount of style(9), ANSI and other cleanup in dhclient(8). More to come.
Some std:: namespace and other C++ mode fixes for flex(1). From NetBSD.
Fix pfctl(8) macro expansion in tags (PR#3664).
Unbreak and reapply the don't-use-inet_net_pton(3)-without-a-slash fix (PR#3638).
Teach libcrypto(3) how to use the VIA C3 crypto functions for (seriously) accelerated aes-{128,192,256}-cbc.
Do temp file cleanup for signals as well as exits in spell(1).
Sanity check memory allocation when attaching wd(4) devices.
Have mg(1) create a buffer list window when started with more than two files, just like emacs.
Fix compile breakage in bridge(4) and netinet6 when pf(4) isn't present.
In ipsecadm(8) monitor mode, reorder memset(3) arguments so it works less like a nop.
For safety, only do pf(4) interface lookups (pfi_index2kif()) if the filter is enabled.
Remove the special-case LBL_ALIGN code in tcpdump(8) and act as if we're always on a platform that requires aligned memory access.
In leave(1), don't allow alarms to be set in the past as this is unlikely to be useful. Also some cleanup based on NetBSD.
On i386, allow userland apps to use the VIA C3 crypto instructions if they're present.
Temporarily work around an MTU-related crash in IPv6 by simply enforcing a minimum link MTU of 296. Real fix to come.
Add as(1) support for the VIA C3 xmove-rng and xcrypt-{ecb,cbc,cfb,ofb} instructions.
Allow '-' as a valid character in as(1) mnemonics, as required by a few VIA C3 instructions.
Add a 'paper.txt' make(1) target to generate ASCII output for the documents under /usr/share/doc.
Sync i386 option USER_LDT code with NetBSD, fixing some ports panics.
In libpthread, add a simple work-around for deadlocking on recursive readlocks on a rwlock while there are writers waiting (from FreeBSD PR#24641).
Add ARM support and a new port for cats boards.
Rename TCP socket option from TCP_SIGNATURE_ENABLE to TCP_MD5SIG.
Build protoize(1) for gcc3.
Reverse the enable logic for TCP selective acks, so TCP_SACK_DISABLE becomes TCP_SACK_ENABLE.
Really commit -L (localbase) support for pkg_create(1), as well as the related -S and -B options.
Some types cleanup and better SIGCHLD handling in privsep tcpdump(8).
Fix an old logic bug in nlist(3) that caused lookups for names with a leading underscore to fail on ELF systems.
Install ex(1) documentation in doc/usd/13.ex.
Back out the scsi(4) attach freeze fix for now.
Sync named(8)'s root.hint file after the IP address change of B.ROOT-SERVERS.NET.
Stop systrace(1) trying to normalize an empty filename.
Enable tcpmd5 on bgpd(8)'s listen socket. For peers configured with md5sig, require accept(2)ed sockets to have signatures enabled.
New TCP_SIGNATURE_ENABLE option to getsockopt(2), allowing a process to check the tcpmd5 status of an accept(2)ed socket.
Support ssh(1) version 2 password change. password-dead must be set to non-zero in login.conf(5) for this to work.
New update-moduli target in /usr/src/etc/Makefile, for regenerating /etc/moduli(5).
Format string fixes and other cleanup for fvwm(1) in the wake of -ansi removal.
Remove -ansi from the list of gcc(1) build options for XFree86.
On i386 systems with SSE2, halve the time taken to zero a page of memory. Based on FreeBSD.
Switch the new sigaltstack(2) code back on again on alpha and sparc64.
Make ddb(4)'s ps /n command show the correct state for a process.
Reset the TCP keepalive timer to tcp.keepidle (normally four hours) after the three-way handshake completes. (syncache sets it to tcp.keepinittime, normally 150 seconds).
Allow a single listen socket to be used for connections with and without tcpmd5.
Avoid a long scsi(4) freeze when attaching live scsibus* devices.
Support RFC 3390 'Increasing TCP's initial window' extension, enabled using sysctl(8) net.inet.tcp.rfc3390.
When TCP is in the SYN_SENT state, don't increase cwnd by 1*MSS on receipt of the SYN/ACK.
Note that 'pegasos' is not quite the same as 'pegosos'.
Clean up the output from pfctl(8) with '-s all'.
Allow the arch-specific bootloaders to change the program name to something other than 'BOOT'.
Use a more reliable reference count when deciding whether or not to free a FIFO vnode(9). Adapted from FreeBSD.
Allow Cisco/Juniper compatible (and keyspace-limiting) ASCII md5sig keys in bgpd(8).
Track the number of ftp or http connections to a host in pkg_add(1). Limit to one connection for now.
New -L option to set (pkg_create(1)) or use (pkg_add(1)) the package LOCALBASE. See bsd.port.mk(5) for details.
Use _exit(2) instead of abort(3) when xfs(1) dies due to an error.
Fix a potential double-free in m_split(9) (PR#3651).
Add privilege separation for tcpdump(8).
Move gcc2-specific files into the architecure-specific distribution setlists. Gulp.
Don't dump core in patch(1) when the file can't be found but user says to patch anyway.
Let <cdefs.h> compile on old gcc(1) and even on non-gcc.
Make bgpd(8) ignore extra (maskless) rtsock change messages sent by pppd(8).
Start work on the amd64 port. Based on work by NetBSD.
New mail-set-margin option for mg(1) mail mode.
Fix ipsecadm(8)'s use of getaddrinfo(3).
In pkg_add(1), exit instead of carrying on regardless when the pre-addition stage fails.
Better pfkeyv2 interface when setting up tcpmd5 in bgpd(8). More to do.
Add support for -f (force) option to pkg_add(1) and pkg_delete(1).
Allow skey(1)-format usernames (user:skey) in sftp(1) (OpenSSH bugzilla #777).
In pf_test and pf_test6, immediately drop packets on any interface that doesn't have an associated pfi_kif structure.
Hash tcpmd5 TDB lookups by source address instead of the spi
Add missing case for TCP MD5 sigs in SADB_GETPROTO().
Let ipsecadm(8) pass the spi for TCP signatures.
Handle tftpd(8) tsize and timeout options. From FreeBSD, as was the RFC 2347 support.
Add RFC 2347 "TFTP Option Extension" support to tftpd(8). Try to ignore trailing garbage that Apple OpenFirmware can leave where an option should be.
Make the package tools show strerror(3) output when die()ing on filesystem errors.
Allow pkg_delete(1) to handle removal of packages with bogus dependencies, as could be created by earlier versions of the new package tools.
Major changes to biosboot(8) and installboot(8), supporting EDD (LBA) mode boots and a shift key-triggered CHS fallback mode. For an encore, remove the previous version's 64KB limit on the size of boot(8).
Make pfctl(8) print even an all-zeros netmask, unless the address is all-zeros too.
Take an extra parameter to pthread_stackseg_np(3) to return stack info for any thread instead of just the current thread.
Only call destructors once on ELF architectures. Stops KDE apps moaning on shutdown.
Since dhclient(8), dhcpd(8) and dhcrelay(8) are now using getifaddrs(3), don't create the socket that used to be needed by SIOCGIFCONF.
Have cardbus(4) dump some useful information for non PnP devices.
Enable TCP signatures in the GENERIC kernel.
Initial TCP signature support for bgpd(8).
Add 802.11 datalink type support to the pcap(3) library.
Stop sd(4) blurting a bunch of Medium Not Present errors for 6-in-1 card readers.
Fix case where grep(1) with the -w option could miss some lines.
Separate ndp(8) from tcpdump(8) (gmt2local() was shared) before the latter begins mutation.
Lock the vnode(9) earlier in ffs_vget() to avoid unbalanced vrele(9) calls.
Have clri(8) use random generation numbers for the inodes it clears instead of just incrementing the old number.
Back out the recent pfctl(8) addresses-without-slashes-are-hosts change for now.
Add a few missing UNIX standards to the mdoc(7) St macro, and update some manpages to use them.
In ssh(1), clear the non-blocking flag on the socket after connection when the ConnectTimeout option is in effect.
Alignment fixes in ping6(8) and traceroute6(8).
Cleanup in traceroute6(8). Make sure the probe packets give very little away about the sending host.
Some *printf(3) type fixes in scsi(4), so very large disks don't appear to have <0 sectors.
Allow scsi(4) debugging to be limited to individual buses as well as specific targets and LUNs.
Don't enable loud debugging for every ahc(4) device by default.
Install vi(1) tutorial docs.
Add cradle mode support to xsystrace(1).
Add an rc.conf(8) switch for rpc.yppasswdd(8) and switch it off by default, instead of always running it if there's a YP directory in place.
New program, ifstated(8), which listens for interface state changes and runs commands when it sees them. Work in progress.
Remove seteuid(2) and setuid(2) calls from timedc(8).
New 'cradle mode' for systrace(1).
Add NTFS to the list of partition types that disklabel(8) has names for.
Now that our gcc3 has propolice, add USE_GCC3 switch (default is "No") to enable gcc3 build and install.
Fix sftp(1)'s display of long path names.
Enable acss(3) support in ssh(1).
Add acss(3) support to libcrypto, and bump the library minor version.
Liberally sprinkle closefrom(2) where needed.
Speed up scsi(4) probing by not checking for impossible LUNs.
Fix the @arch packing list command in pkg_add(1) and pkg_create(1).
Match compress(1) exit codes to GNU gzip, unbreaking perl(1)'s CPAN module.
[Applied to stable]
Stop mixerctl(1) segfaulting on non-existent fields.
Add a simple 802.3x printer to tcpdump(8).
Allow ftp-proxy(8) to set the outgoing address with the new -a option (PR#3538).
In pfctl(8), only use inet_net_pton(3) on addresses containing a '/', otherwise use inet_pton(3) (PR#3638).
New -S option to nc(1), enabling the TCP MD5 signature option.
Fix collapsing of multiple pfsync(4) update messages into one.
Fix pfsync(4) state timeouts.
As with sysctl(8), remove the need for -w in mixerctl(1).
Propolice fixes for gcc(1).
First propolice version of gcc3.
Add dynamic bufq support to wd(4). Doesn't do very much for now.
In kernel main(), initialise timeouts much earlier.
New spamd(8) configuration method, based around OpenBSD mirrors of common spammer lists.
Cleanup and fix tcpdump(8) pfsync protocol output.
Initialise the sftp(1) input file in main() rather than statically.
Some strncpy(3) -> strlcpy(3) in libpcap
Use _exit(2) instead of exit(3) from abort(3) so stdio buffers don't get flushed twice.
Support Intel 852/855/865 AGP chipsets on i386. From NetBSD.
Don't set a fake baud rate for pfsync(4) interfaces.
Only read in as many digits as can legally fit into a field in strptime(3). From NetBSD.
[Applied to stable]
Add some delay when reading the address off fxp(4) eeproms, otherwise the result may be garbage.
Actually use the RPC program name cache in tcpdump(8) since we've gone and allocated space for it.
Import some chunks of ffs2 support from FreeBSD.
Have pfsync(4) ignore pfsync protocol packets if the interface is not running.
Fix a few ssh(1) memory leaks.
Fix grep(1)'s -b option.
Fix a missing malloc(3) error check in syslogd(8).
New user _tcpdump for upcoming privsep of, uh, tcpdump(8).
Avoid half-open deadlock in ssh(1) (OpenSSH bugzilla #790).
Some sane defaults for afsd.conf(5) and ThisCell(5).
Update sendmail(8) to 8.12.11.
Throw away #ifdef spaghetti from XFS filesystem code, and enable it in GENERIC.
Remove a double htons() in pfsync(4).
Unbreak '*grep -w -l'.
Fix a missing initialisation in grep(1).
Sync tcpdump(8) DNS display with tcpdump.org to avoid problems with bogus DNS packets.
Allow pflogd(8) to create (safely) its log file if none exists.
Have carp(4) send RTM_IFINFO routing messages on interface state changes.
Prep dhclient(8) for surgery, under src/sbin/dhclient.
Have rsh(1) run ssh(1) instead of rlogin(1) or telnet(1) when run without a remote command.
Add a bunch of new DNS RR types to <arpa/nameser.h>.
Remove Kerberos IV code from rsh(1).
Major stability improvements to ahc(4).
Fix a typo causing a null deref in pf(4) IPv6 tcp scrubbing.
New -v option to isakmpd(8) to log successful completion of Phase 1 and 2 exchanges.
Sync mrouted(8) with changes to the raw sockets API affecting packet length.
Fix a string bug and a double free in the PEX font parser.
Import libobjc from GCC 3.3.2.
Move libobjc out of the GCC directory and into src/gnu/lib/libobjc.
In tcpdump(8) check that an IKE header is long enough before trying to display it.
Add a pthreads version of closefrom(2).
Remove autoconf stuff from the in-tree sudo(8).
Fix an early-free bug in mg(1) that was breaking compile-goto-error.
Make pflogd(8) less likely to cause logfile corruption on unexpected shutdowns, and more able to detect and deal sensibly with corrupted files on startup.
Synchronise pflogd(8) with the newly privilege-separated syslogd(8).
Unbreak awk(1)'s maketab.c after recent yacc(1) header file generation changes.
Temporarily work around alpha and sparc64 breakage caused by the recent sigaltstack(2) ABI change.
Teach tcpdump(8) about TCP signatures.
Some *printf(3) type cleanup in httpd(8).
Support RTM_IFANNOUNCE messages in route(8)'s monitor command.
Add TCP signature stats display to netstat(1).
Add TCP MD5 signature support to ipsecadm(8).
In syncache, defer updating the mss until the 3-way handshake is completed.
Use a pool(9) instead of malloc(9) for file locking structures. From NetBSD.
Add syncache and IPv6 support to the resurrected TCP signature code.
In pf(4), remove the predefined 'special' altq IDs, so all qids look alike.
Change the type of sigaltstack.ss_size from int to size_t. Rename old syscall to osigaltstack() for compatibility.
Remove extra 'sleep 1' from netstart(8) when doing IPv6 DAD.
Preliminary gcc(1) support for ARM.
Have nm(1) fall back to using pread(2) if mmap(2) fails, as it does for /dev/ksyms.
Don't issue Test Unit Ready to scsi(4) devices until we've checked that 'don't issue Test Unit Ready' quirk isn't needed.
Revamp scsi(4) LUN quirks handling.
Use the right type when checking the magic number in savecore(8).
printf(3) integer type cleanup in netstat(1).
Correct a use-after-free in cvs(1), fixing a coredump when the user hits ^C.
Fix authpf(8) ruleset names that contain the username (PR#3627).
'=' != '==' in fsck(8).
Let <ctype.h> compile on non-gcc compilers.
Reintroduce old TCP MD5 signature (RFC 2385) code from 4.5 years ago, hopefully with a reduced likelihood of kernel borkage.
Improvements to sftp(1) batch mode: Allow batchfile input from stdin, and remove stderr junk (OpenSSH bugzilla #754).
Add IPv6 loopback routes and allow connection to the carp(4) shared IPv6 address from the MASTER host, like for IPv4.
Fix a signed buffer length variable in syslogd(8).
Build local nm(1) and size(1) instead of those from binutils.
Allow ifconfig(8) to show all interfaces of a given type by giving it a device without a unit number, e.g. 'ifconfig vlan'.
Respect the quiet flag in newfs(8) and don't spew cpg warnings.
Change /dev/utty[0-9a-f] entries ucom(4) to /dev/ttyU[0-9a-zA-Z]
In syslogc(8), don't re-terminate a string after strlcat(3).
Sync pf.os(5) with the current p0f development snapshot.
A little string cleaning and extra error checking in swapctl(8).
Make shared C++ binary linking consistent between GCC 2.95 and GCC 3.
Stop g++(1) adding '-lm -lstdc++' when -shared is present, consistent with gcc(1).
Use closefrom(2) instead of looping up to the fd rlimit in sudo(8). From sudo CVS.
Fix up and install the vi(1) USD docs.
New system call closefrom(2), which closes all descriptors greater than or equal to the given fd. Bump libc and libpthread minor version.
Have tun(4) use klist_invalidate() so ifconfig destroy can work with kqueue(2) enabled.
Add klist_invalidate() function in kqueue(2) to clean up when the event source goes away.
Replace some hairy string code with a single asprintf(3) in sup(1).
Remove some portable-only #ifdef code around openpty(3) in ssh(1).
In sysctl(8), making an assignment by using '=' no longer requires a totally redundant -w option.
Remove ugly spaces from sysctl(8) 'var=value' output.
Sync the installer script with recent dhclient(8) changes.
Add IPv4 loopback routes much later in netstart(8).
Make dhclient(8) listen to the routing socket, and quit if anyone downs the interface or deletes an addresses.
Have dhclient-script(8) preserve a preexisting resolv.conf(5) and restore it when exiting.
Add a missing forward declaration of struct proc in <sys/rwlock.h>.
Remove code in auth_clean(3) that cleared the options list, since login(1) depends on it leaving them alone.
Print only valid sense info in scsi(4).
Correctly a missing bonus points for completed rows bug in tetris(6).
Stop tcpdump(8) screwing up the terminal by printing non-printable timed protocol hostnames.
Add a missing initialisation in kvm_open(3).
Reduce the TCP MSS lower bound to 256-(minimal TCP header size) = 216 bytes.
Don't restrict RFC 2385 TCP signature keys to ASCII-only.
Fix a memory leak when detaching an Ethernet interface.
In netstart(8) create all routes with the new improved -q option.
Make route(8)'s -q option really quiet.
Back out the storing of parent vnodes, due to exploding ports.
Have sysctl(8) politely tell the user that the tool of choice for viewing a list of processes is ps(1).
Carefully work around time_t != long in gdb(1).
Crucially, adjust worms(6)' delay based on the terminal speed.
Types cleanup in jot(1). Mostly from FreeBSD.
Convert fstat(1), ps(1), systat(1), top(1) and w(1) to use the new kvm_getproc2(3) interface.
Make ELF architectures handle constructors and destructors the way the ELF spec says they should.
Sync sensorsd(8)'s notion of zero Kelvin with that in the kernel.
Fix a typo in ndp(8) affecting the -s (set entry) option.
Fix a busted mkdtemp(3) return value check in binutils.
Use proper uid_t and gid_t types in id(1).
New -e option to systrace(1), which sends logs to stderr instead of syslog.
Promote dirhash to the GENERIC big time.
Increase the TCP MSS lower bound from 64 to 256 bytes.
sysctl(3)ify dirhash, under vfs.ffs.dirhash_*.
Plug an interface address memory leak in pf(4).
Stop sysctl(3) returning EINVAL for KERN_PROC_KTHREAD.
Logic fixes in diff3(1) where one file has changes but the other does not.
Some scsi(4) probe cleanups and fixes, inspired by NetBSD.
Implement the truly wonderful -p option for diff(1).
Fix an i386 crash in the ahc(4) device probe (PR#3630).
Add a field for the emulation type in the struct returned by the KERN_PROC2 sysctl(3).
Switch pkill(1) and pgrep(1) to kvm_getproc2(3), and so enable the -s option to work.
Add kvm_get{argv,envv,proc}2(3) using KERN_PROC2. Based on NetBSD.
Implement the KERN_PROC2 sysctl(3), allowing ps(1) etc. to be independent of changes to process-related kernel structures. From NetBSD.
On i386, sync fdisk(8)'s built-in MBR image with the recent changes.
Import generic IEEE 802.11 interface framework from NetBSD.
Have pf(4) do as non-pf udp_input() does, and drop UDP packets with destination port zero, or with zero or oversize payload.
Import pkill(1) and pgrep(1) from NetBSD. Selecting by session ID (-s option) doesn't work yet.
Fix signal handling in the case of an error in inetd(8)'s config file.
Import SYN cache code to deflect SYN flood attacks, controlled with sysctl(3)s net.inet.tcp.syncachelimit and net.inet.tcp.synbucketlimit. From NetBSD, based on work by David Borman.
Unbreak ifconfig destroy on vlan(4) interfaces when MROUTING is defined.
In yacc(1), make sure extern YYSTYPE doesn't get #ifdef'd out when generating a .h file.
Keep track of parent vnodes on ufs filesystems, this will be needed soon.
Add some rwlocks around kernel file descriptor code, avoiding some rare race conditions.
Don't allow a tun(4) cloner interface to be destroyed if there are any outstanding knote(9)s.
Fix a few strlcpy(3) off-by-ones in pfctl(8).
New -F flag for rtsold(8), which automagically sets the inet6 sysctl(3) values it needs. Useful for boot floppies.
Support NOTE_EOF for kqueue(2) read events.
Some string and memory leak cleanup in bgpd(8). Still work in progress.
Merge in libstdc++ (gcc 3.3.2) for gcc3.
Only prevent the removal of removable scsi(4) devices.
Merge nm(1) with size(1) under src/usr.bin/nm.
Teach nm(1) all about ELF.
Really stop the compiler optimising away memset(3) calls used to zero sensitive data in sudo(8). From sudo CVS.
Major changes to the i386 master boot record, which now uses EDD if available to support booting from a partition more than 8GB from the start of the disk. The 8GB size limit is still in place.
Begin a cleanup of config(8).
Don't ignore the '!' operator on the interface for pf(4) binat rules.
Implement buffered logging in syslogd(8). Logs may be stored in a ring buffer and extracted using a client such as the new syslogc(8).
Add option INET6, rtsol(8) and ping6(8) onto boot floppies/CD images where it will fit.
Work continues on bgpd(8).
Use fgets(3) instead of fgetln(3) in user(8), killing a sparc64 bus error along the way.
SECURITY FIX: Several message handling flaws in isakmpd(8) have been reported by Thomas Walpuski. These allow an attacker to delete arbitrary SAs.
A source code patch is available.
[Applied to stable]
In isakmpd(8) only allow an INITIAL-CONTACT when a main-mode SA is in place, and never delete SPIs based on it.
gcc3 handles varargs differently, change the kernel sources to deal with it.
Some poll(2)-related fixes to select(2) under pthreads. From FreeBSD.
Fix objcopy(1)'s long options list, unbreaking strip(1)'s -s option and others (PR#3623).
[Applied to stable]
Don't create a pid file for rtsold(8).
If the scsi(4) error code is unknown, at least show the code we didn't have a message for.
Use a memory pool(9) instead of MALLOC(9) for inet and inet6 PCBs. From NetBSD five years ago.
Recognise and handle a few more scsi(4) reset conditions.
Bring the scsi(4) error description list up to date with SCSI-3.
Add bgpd(8) control program bgpctl(8).
For i386 only, incread SHMMAXPGS from 2048 to 8192.
In the all-architectures kernel config, bump SHMMNI from 32 to 128, and SHMSEG from 8 to 128.
If pkg_add(1) fails in the postinstall script, record the package as a borked install instead of dying with a bunch of unregistered files all over the place.
In libpthread, make poll(2), readv(2) and writev(2) cancellation points too.
Undefer and handle pending signals in all code paths of pthread_join(3).
On i386, stop the FPU exception tests hanging amd64 and new Transmeta CPUs.
Have xdm(1)'s Xsession script reap the SSH agent on session shutdown even if the user has a ~/.xsession file.
Make 'vi -r foo' work the way the vi(1) manpage says it should instead of dying.
Many improvements to network interface handling in pf(4). See the commit log for details.
Add svc_getreq_poll(3) and switch libc RPC code to use its poll(2) interface instead of select(2).
Have ssh(1) properly ignore an (unupported) SSH2 password change request and the suggested new password.
Change wait4(2)'s prototype to take a pid_t instead of an int for the first argument, like the manpage says.
Define _FFR_DEAL_WITH_ERROR_SSL to stop SSL errors sending sendmail(8) into an endless loop.
Don't do TAILQ_REMOVE(3) while inside a TAILQ_FOREACH loop in pfctl(8).
As system startup, run vi.recover after ldconfig(8) so that perl(1) and the MTA can find their shared libraries.
Convert syslogd(8) to use poll(2) instead of select(2) in its main event loop.
Once grep(1) and friends have identified a file as binary, seek back to the beginning before continuing.
Unbreak zgrep(1) when the uncompressed file begins with a newline.
In disklabel(8) add new size unit types '%' and '&' to specify, respectively, percentage of disk size and percentage of remaining disk space.
Allow a precision (-p option) of zero in jot(1).
On i386, properly recognise SiS CPUs.
Hack around a reentrancy bug in the cvs(1) server's abnormal exit handler.
Allocate what's required for an identifier in config(8) instead of an arbitrary 500-byte buffer (PR#3614).
Stop libcurses++ fooling with libstdc++ internals so it compiles under gcc3.
Add -4 and -6 options to telnet(1) for IPv4- and IPv6-only operation (PR#1974).
Tag ahc(4) I/O operations requeued as a result of aborts, timeouts etc. so that they're not treated as successfully completed operations.
Update security(8) after the recent join(1) change prompted by PR#2208.
Make join(1) more POSIX for non-matching lines (PR#2208).
Add dirhash feature from FreeBSD, which uses an in-memory hash table for lookups in large directories. Not enabled by default yet. See UFS_DIRHASH in options(4).
Extend the pfsync(4) protocol to allow a peer to query for complete state information should it receive an update for a state it knows nothing about.
Check for oversize allocations earlier in kernel malloc(9).
Fix some peculiar macro token pasting in fvwm(1).
Properly initialise the C++ constructor and destructor lists for ELF, killing a gcc3 warning in libstdc++.
In huntd(6), stop doing va_end(3) on the varargs format string.
Add a missing zero-fill before contructing pfsync(4) output in tcpdump(8).
Fix a couple of bugs with negative values in fmt_scaled(3), and don't print fractions of bytes.
Overhaul bgpd(8)'s error handling and logging.
Allow an 'arch' annotation to be stored within packages by pkg_create(1).
Have pkg_add(1) report on the amount of space used on each filesystem.
In bgpd(8), treat localhost network 127/8 as if it were a connected network and don't allow it to be deleted.
Halve the amount of space allocated for AES in ipsec(4) by making the contexts encryption- or decryption-specific.
Enable nexthop verification in bgpd(8).
On m68k, m88k, sparc, sparc64 and vax, fix a signed comparison bug in brk(2).
[Applied to stable]
Update libiberty to that from binutils-2.14.
Add passive mode (no TCP connection to the peer) to bgpd(8).
Huge sync of ahc(4) to NetBSD, which in turn is sync'd to FreeBSD. Many bugs fixed, several left to fix.
Connect bgpd(8) to the build, along with an example bgpd.conf(5) file. Lots of work still needed.
Let the pkg_* tools' new virtual filesystem to cope with mount points with no options, e.g. AFS.
Enable hw.cpuspeed sysctl(3) on macppc.
Add stubs for pthread_[gs]etconcurrency(3). From FreeBSD.
Fix a descriptor leak in libpthread when doing close(2) on fds 0,1 or 2. Based on a fix in FreeBSD, but implemented differently.
In libpthread, make accept(2), connect(2), recvfrom(2), recvmsg(2), sendmsg(2) and sendto(2) cancellation points as required by POSIX.1-2001. From FreeBSD.
Deallocate xl(4) resources on attach failures.
Enable bus mastering on fxp(4). Oh yes.
New sshd(8) option KerberosGetAFSToken.
Have ifconfig(8) automagically create network pseudo-interfaces.
Mercifully, turn the non-monotonic time warning off #ifndef DEBUG.
Initialise the url(4) MAC address properly (PR#3612).
When sudo(8) is run with -k or -K only complain about missing usernames to stderr and don't log anything, since we may be running in a .logout script at shutdown and the YP etc. daemon may have gone away.
Fix a remotely exploitable crasher in tcpdump(8)'s l2tp parser (PR#3610).
[Applied to stable]
Properly clean up 3DES cipher contexts in ssh(1).
Make sure a signal handler-modified variable in sensorsd(8) is typed as volatile sig_atomic_t.
In wsmoused(8) (and bgpd) don't set up a handler for SIGKILL since that signal isn't passed to the process at all ever.
Fix a pasto (from the recent source-tracking additions) in the implementation of pf(4) DIOCSTART.
Fix end-of-tape handling under pthreads. Fix from FreeBSD PR#56274, including the fix to the fix in FreeBSD PR#59291.
Use a virtual filesystem in pkg_add(1) and pkg_delete(1) so they can test for available space and writeability before attempting to do the real operations.
Much work on the new bgpd.
Remove the recursive format string option '%:' from kernel printf(9).
Change in*_pcbnotify() to return the number of matches.
Check for multicasts earlier when processing TCP input, to reduce the amount of redundant processing.
For semop(2) calls with a small number of operations, use the stack instead of malloc(9)'d memory to reduce overhead. Adapted from FreeBSD.
Fix some unbounded sscanf(3)s in the usbhid(3) library.
On i386, add a driver for the Pentium 4's thermal control circuit.
Stop tcpdump(8) printing garbage pfsync(4) states when the snaplen is less than the sender's MTU.
Have dc(1) handle SIGINT in a rational way, and have bc(1) pass SIGINT to dc to handle in a rational way.
When updating process stats, check for non-monotonically-increasing time from microtime(9), deal with it by doing nothing instead of zeroing the counter, and complain #ifdef DIAGNOSTIC.
Enhanced Intel SpeedStep support on i386.
New sysctl(3) variables hw.cpuspeed and hw.setperf on i386, used to control LongRun.
Only modulate the TCP timestamp (pf(4) scrub reassemble tcp) if there's a valid timestamp to be modulated.
Allow ARP replies containing Ethernet multicast addresses, since some HA products want to do this.
Show tcpdump(8) how to recognise IKE NAT-D and NAT-OA payloads.
When isakmpd(8) gives up on a message, show the exchange name in the log.
Change pfsync(4) multicast group to 224.0.0.240, and IP protocol (pfsync in protocols(5)) to 240.
New pseudo-user _bgpd with matching group.
Begin spanning tree operation when a bridge(4) interface comes up.
New BGP daemon, bgpd. Not complete, and not built by default yet.
Do a real inverse-colour cursor for rasops(9)-based consoles. Based on a similar change in NetBSD.
New kqueue(2) filters NOTE_EOF and NOTE_TRUNCATE.
Add ccd(4) and a newly-shrunken version of ccdconfig(8) to the i386 CD ramdisk kernel.
Update the kernel zlib to 1.2.1.
Shrink even more the special gzip used for boot floppies. It now does decompress only and is directly compiled in.
Update userland zlib to 1.2.1, with local fixes. New major version, libz.so.3.0.
Don't let cvs(1) pass null labels through to its diff command when stat(2) fails for an input file.
When filtering on a bridge(4), compare the destination in the filter with the destination address of the packet, not the source address.
New queue(3) macros SLIST_FOREACH_PREVPTR (from FreeBSD) and SLIST_REMOVE_NEXT.
Allow cloner interfaces to return an error from their destroy function.
Much string cleaning and abort(3) -> exit(3) in the AFS library.
Stop newsyslog(8) segfaulting when given an empty command (PR#3578).
Fix a couple of missing printf(3) args in monop(6) and mopd(8).
New environment variable MANPAGER for man(1) (PR#3563).
Add app-layer keepalive option 'ServerAliveInterval' to ssh(1), analogous to ClientAliveInterval on the server.
Don't do expensive pfsync(4) processing if noone is using it (i.e. no bpf(4) listeners, and no network synchronisation).
Shorten or '#ifdef SMALL'-out some long message strings in the kernel.
A round of boot floppy space-saving begins.
When calculating CPU time usage, check for a time-going-backwards bug in microtime(9) found on some dual-clock systems.
Fix some fallout from the rlim_t change from signed to unsigned.
Add support for groups 14 through 18 (modp{2048,2072,4096,6144,8192} - see RFC 3526) to isakmpd(8).
Initial support for pf(4) state synchronisation over the network. See pfsync(4).
Make sh(1) and ksh(1) functions work the way the manual page suggests with respect to non-exported environment variables (PR#2450).
Allow pf(4) to track stateful connections based on the source IP address. Especially useful for load balancing configurations.
Add awk(1) USD paper in /usr/share/doc/usd/16.awk.
Don't assume that the IKE port is always 500 in isakmpd(8) log output.
Alignment fixes for kernel and libc RMD160 functions.
Initial support for ifconfig destroy in ppp(4) and sl(4)
Don't accept absolute pathnames for module names in cvs(1). From CVS 1.11.10.
Cleanup and POSIXness for join(1). From FreeBSD.
More POSIX type definitions (rlim_t now unsigned, RLIM_SAVED_{CUR,MAX} defined, id_t defined).
Kill annoying pf(4) assertion failure messages, and correct the underlying problem with NAT and table stats (PR#3587).
Fix sis(4) short cable problems properly. From Linux and the datasheets, via FreeBSD.
Also for poll(2), add pollfd_t (= struct pollfd) as in Solaris.
Add type nfds_t for poll(2) as per POSIX.
Make pkg_delete(1) flag an attempt to delete a non-existent package as an error.
For IPv6 multicast sockets, validate the get/setsockopt(2) argument more strictly to preventing a local user causing a kernel panic. From KAME.
Big register declaration purge in sys/net*.
Better non-repetitive ID generation for IPv4, IPv6 and resolver query IDs.
Some improvements to authpf(8)'s logging output.
Fix up netinet and netinet6 interface lookup code after the introduction of clonable devices.
Clear the exit code when ssh(1) with -N is terminated with SIGTERM.
Sync em(4) with FreeBSD, enabling support for a few more models.
Fix some *printf(char *) silliness in identd(8).
Rename the ssh(1) option KeepAlive to TCPKeepAlive to help people who just won't read manual pages.
Better -n handling for pkg_add(1) and pkg_delete(1) when dependencies are involved.
Make explicit the base package to which pkg_add(1)'s dependency resolution output applies.
Fix error-handling logic in pkg_add(1) that affected the -n option.
In ssh(1) and sshd(8), don't modify argv when parsing the -o option (unbreaks HUP for sshd).
Make ssh(1) option ClientKeepAlive work when the -N option (no login shell) is in effect.
Stop ssh-keygen(1)'s -T option from accepting primes with no known generator.
Add some PostScript docs for lex(1).
Fix some missing printf(3) args in tn3270(1) and kernfs.
Some cleanup in compress(1).
Allow more than one user at a time to use ftp(1) in active mode (PR#3596).
[Applied to stable]
Unbreak xfs symlinks (PR#3552).
[Applied to stable]
In patch(1), get a private mapping from mmap(2) instead of a default (file) mapping.
Fix a crash in troff(1).
Don't drop the newest TCP connection when doing SYN flood avoidance when we meant to drop the oldest.
Fix an endianness bug in gre(4) when sending to ip_output.
[Applied to stable]
In pf(4), make IPv6 redirects to loopback work the same way as for IPv4 and not require an additional route-to line.
Fix a too-low spl(9) in the nfs client code.
New ifconfig(8) option -C (and supporting ioctl(2) SIOCIFGCLONERS) that lists all cloning-capable devices.
New mbuf_tags(9) type ...PF_TRANSLATE_LOCALHOST, used so that pf(4) redirection to localhost doesn't defeat the ability of programs like portmap(8) to tell localhost connections from remote connections.
Add ifconfig create support to ppp(4) and sl(4). No ifconfig destroy yet.
Fix regex(3) handling of non-ASCII characters (PR#3594). Fix from FreeBSD.
Fix grep(1)'s handling of certain patterns containing multiple dots (PR#3597).
Make ifconfig destroy work on tun(4).
Fix an endianness bug that was causing wicontrol(8) to crash.
Set madvise(2) flag MADV_RANDOM for mfs(8) filesystems.
Validate the SPIs presented in DELETE messages when doing an isakmpd(8) informational exchange.
Have the installer ask whether sshd(8) should be enabled at first boot. The default is to enable it.
Enable multicast reception for em(4).
Do a screen split when more than one file is opened on mg(1)'s command line.
Unbreak mg(1)'s META key support.
Fix a sign comparison bug in semop(2).
Add cloning support to bridge(4), carp(4), faith(4), gif(4), gre(4), lo(4), tun(4) and vlan(4).
Support for interface 'cloning,' accessed by ifconfig(8) commands create and destroy. E.g. 'ifconfig vlan100 create'
Add a dmesg command to ddb(4).
Don't allow too many network interfaces (>65535) to be attached.
Merge Perl 5.8.2.
Add an hppa target to gcc3.
Add support for UDP encapsulation of ESP in transport mode (see draft-ietf-ipsec-udp-encaps-XX.txt,) enabled via new sysctl(3) toggle net.inet.esp.udpencap.
Use a consistent, high listen backlog for sshd(8), ssh-agent(1) and forwarding sockets.
Fix an off-by-one in dc(1).
Cosmetic improvements to ssh(1)'s progress meter.
Let bc(1) compile programs with more than 10,000 lines.
Add support for long variable names to bc(1), another non-portable extension.
Add kqueue(2) support to tun(4).
Use now instead of the epoch as the timebase for compat_linux(8) function alarm().
Avoid a null-deref in uvm_swap_markbad().
Check signedness before dereferencing in kernel descriptor management code.
Fix csh(1) variable substitution when shortening strings (PR#3591).
In aliases(5), direct mail for most fake users (e.g. _syslogd) to /dev/null instead of spamming root.
Add an amd64 target to gcc3.
Add extended register support in dc(1) (-x option,) ready for long variable names support coming to bc(1) soon.
Cleanup of mopd(8).
Add OpenBSD-specific options to gcc3.
Import (but do not yet enable) GCC 3.3.2, without the ADA frontend for space reasons.
New ':' (inclusive range) operator for pf(4), works anywhere in pf.conf(5) that '><' (exclusive range) works.
Fix the regex in security(8) that tests for valid group names.
More fixes to pf(4) stats gathering.
Fix NFS-over-TCP speed when OpenBSD is serving Linux clients (PR#3561).
Allow systrace(1) to accept usernames ending in '$'.
Fix missing printf(3) arguments in eeprom(8), elf2aout and elf2ecoff.
Discard the first 256 bytes of the arc4random(3) keystream as recommended by the "Weaknesses in the Key Scheduling Algorithm of RC4" paper.
Fix a core dump in dc(1) when reading uninitialised array locations.
Some gcc3 compatibility cleanup.
Fix SIOCGIFHWADDR under compat_linux(8).
Build more components of libiberty in preparation for gcc3.
Sync libiberty with the version from GCC 3.3.2.
Sync libedit with that of NetBSD on 8 Nov 2003.
Move libiberty into src/gnu/lib/libiberty, removing it from the egcs directory. The new library is a sync'd to "somewhere between binutils-2.10 and 2.11" with some local changes.
Avoid a double-free in pcap_setfilter(3).
Have the kernel's MD5 code use the per-architecture optimised bcopy() instead of its own implementation (PR#3549).
New meaning for the ssh(1) -k option, it's now equivalent to GSSAPIDelegateCredentials=no.
In ssh-keyscan(1), use sysconf(3) to get the maximum fd limit instead of returning an arbitrary number.
Fix an out-of-bounds access typo in the implementation of sysctl(3) KERN_VNODE.
Another getpass(3) return value check, this time in encrypt(1).
Fix a sign overflow in compat_svr4(8) streams code.
Make usernames containing underscores work in systrace(1).
While we're fixing diff(1) return values, fix that of the -q option which got broken when -i was fixed.
Stop the install(1) madvise() change breaking 'make release'.
Stop pfctl(8) allowing an antispoof for an interface without an IP address, since that amounts to blocking all on every other interface. Bad.
Add a few more pkg_create(1) packing list sanity checks.
Also give cmp(1) and patch(1) the madvise(2) sequential treatment.
Speed up install(1) by using madvise(2) with the MADV_SEQUENTIAL flag.
SECURITY FIX: Due to a bug in the parsing of Allow/Deny rules for httpd(8)'s access module, using IP addresses without a netmask on big endian 64-bit platforms causes the rules to fail to match. This only affects sparc64.
A source code patch is available.
[Applied to stable]
New -o option to kvm_mkdb(8), to put the database somewhere other than /var/db.
Fix return code from diff(1) when the -i option is in use.
Build ftp(1) statically linked, to help out when things go wrong.
RELIABILITY FIX: An improper bounds check makes it possible for a local user to cause a crash by passing the semctl(2) and semop(2) functions certain arguments.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: It is possible for a local user to cause a crash via sysctl(3) with certain arguments.
A source code patch is available.
[Applied to stable]
Add gcc(1) flags -fnobuiltin-{log,print} for kernel builds on some architectures, the others to be done as test results are collected.
Re-enable build of named(8)'s DNSSEC programs.
More wdc(4) probe fixes, sync'ing with NetBSD.
Fix timed(8) breakage caused by the change from select(2) to poll(2).
Add /etc/rc(8) startup for sensorsd(8).
Merge in BIND v9.2.3.
In crypto(3), enable assembler BN functions on vax, and assembler for most things on i386.
Fix password blinding for non-existent users in sshd(8).
Add new lightweight kernel reader/writer lock code, not used for anything yet.
Performance improvements to pool(9).
In sshd(8), fix the test for a valid authentication context when processing -R port forwards.
Fix unnecessary delays in wdc(4)'s device probe. From NetBSD.
Fix a missing initialisation in libkvm.
Don't expose the contents of named(8)'s rndc.key file when diff'd by security(8).
Merge in Apache 1.3.29 and mod_ssl 2.8.16.
Add a missing bounds check and fix an int overflow in compat_ibcs2(8) (not enabled by default).
[Applied to stable]
Two more non-portable extensions to bc(1): Add new boolean operators, and allow relational operators to appear anywhere.
Add drop operator 'R' to dc(1).
Replace ssh(1) authentication mechanism 'gssapi' with 'gssapi-with-mic'.
pf(4) stateful connections for generic protocols now work for IPv6 as well as IPv4.
Pull in a patch from XFree86 4.3, preventing a crash on Riva128 cards.
Remove win32 support files from the BIND tree.
Set the atime, ctime and mtime of the kernfs boottime file to, uh, the boot time. Useful for find(1).
Fix savecore(8) on big-endian 64-bit architectures.
More fine-grained CPU type detection on i386.
Test for a NULL return from getpass(3) in bdes(1), pppctl(8) and tn3270(1).
Fix bogus read(2) error check in mg(1) when writing a backup file.
Let compress(1) inflate multiple concatenated files just like GNU gzip.
Support in dc(1) for boolean operations soon to appear in bc(1).
Allow the pfctl(8) debug level to be set from pf.conf(5) with 'set debug'.
Some fixes in the ssh(1) GSSAPI client code.
Don't include the KAME interface index (used for IPv6 link-local addresses) in the carp(4) HMAC value.
Strip out some slightly pointless tests in wdc(4) for an 8-bit value < n, where n > 255.
Fix a bug in bc(1)'s print statement that left garbage on dc(1)'s stack.
Make bc(1)'s exponentiation operator '^' right- instead of left-associative.
Fix a potential DoS in ftpd(8) where an attacker could tie up the data port for long periods. From FreeBSD.
[Applied to stable]
New behaviour for ssh(1) option VerifyHostKeyDNS, allowing implicit trust for DNSSEC-verified SSHFP records.
Have scp(1) pass through the -q flag to its underlying ssh(1) process, suppressing SSH2 banners.
Merge in OpenSSL 0.9.7c.
Some nonportable syntactic sugar for dc(1) and bc(1).
free(9)ing stack variables is a bad idea, don't do it in ubsa(4).
Don't leak memory from ld.so(1) if the library name is invalid.
Better parsing of library version numbers in ld.so(1), so 'libpython2.1.so.0.0' and 'libpython2.2.so.0.0' can coexist in peace.
New 'print' statement for bc(1), a non-portable extension.
Fix ksh(1)'s handling of redirection of a file to the same file, e.g. '2>&2'.
Add more privacy flags to sendmail(8) cf/openbsd-proto.mc, requiring HELO/EHLO and disabling EXPN/VRFY.
Add a classic paper on password security in /usr/share/doc/smm/17.password.
Send diff(1) output 'no newline at end of file' to stderr instead of stdout, for compatibility.
Stop pkg_add(1) considering as errors attempts to add an already-added package.
Keep track of errors when adding multiple packages with pkg_add(1), and set a useful error code on return.
Remove the automatic setting of packing-list prefix from the first @cwd.
Restore printing of vlan(4) information in ifconfig(8), accidentally broken when carp(4) was added.
Really fix mg(1) insert-file.
Safer region handling in mg(1).
Restore the terminal correctly when aborting out of mg(1).
Undo the mg(1) insert-file operation properly.
Unbreak the anchor rule number returned by pfsync(4).
Avoid a race condition when swapping in a process.
On i386, fix a crash that occurred with a large number (>1500) of processes (PR#3528).
New 'no sync' state option to prevent state transitions for a particular rule appearing on the pfsync(4) interface.
Check that carp(4) packets are received on a carp-enabled interface.
Fix setting of the interface index for IPv6 link-local multicast joins.
Stop carp(4) responding to ARPs when the interface is down.
Fix a buffer overflow in sed(1) when doing regex substitutions. From FreeBSD.
Add non-portable extensions to dc(1): '#' (comment), 'n' (print without newline) and 'a' (byte to char).
Better pkg_add(1) dependency resolution.
Don't call the post-install script of packages that didn't fully install, and allow such packages to be fully removed.
Let pkg_add(1) install packages coming from stdin.
pkg_delete(1) allows the path to an installed package on the command line, so e.g. 'pkg_delete /var/db/pkg/zsh-*' now works.
The package tools now automatically use the target of the first @cwd in the packing list as the prefix.
Temporarily back out the recent reordering of interface capability tests and pf_test(). pf(4) rdr rules are now generating some bogus checksums.
In isakmpd(8), require encrypted messages as soon as we have the keystate for it, require DELETE payloads to be accompanied by HASHes, and add validation for HASH payloads without active exchanges.
Allow pf(4) tags to use the same macros as labels (see pf.conf(5)).
Teach gdb(1) about SIGINFO (PR#3173).
Add commented-out LoadModule config lines, along with a short description, for each httpd(8) module in the standard build.
In newfs(8) don't write the magic to the superblock until filesystem creation is completed.
Fix netstat(1)'s display of IPv6 link-local multicast addresses.
Redo the wdc(4) drive reset changes, more cautious this time.
Make tcpdump(8)'s -x flag work for pfsync(4) devices.
Use hash tables where possible for listen socket lookup as well.
Add a route when we're the carp(4) master host, so the local machine can use the common address.
Have pkg_create(1) spot duplicate packaging list entries and die noisily when it does so.
Stop carp(4) pretending that everything it sends to bpf(4) comes from AF_INET6.
Add GNU-compatible 'r' operator (swaps the top two stack items) to dc(1).
Kill an IPv4 pasto in carp(4) IPv6 support when setting the interface address.
RELIABILITY FIX: It is possible for a local user to cause a system panic by executing a specially crafted binary with an invalid header.
A source code patch is available.
[Applied to stable]
Make pkg_delete(1) handle dependencies properly when using package name stems.
Don't try to free a static string when checking ssh(1) host keys.
In regular (non-pf(4)) IP output code, defer the interface tests for hardware IPsec and checksum capability until after pf_test(), since pf might drop the packet, or send it to a different interface.
Make pf(4)-routed packets check the target interface for hardware IPsec and checksum capability.
Fix a memory leak when carp(4) fails to put the interface into promiscuous mode.
Add a missing check in IPv6 carp(4) for an interface on its way down.
Preserve the debug flag when enabling pf(4).
In top(1), check for signals at the right time and handle stdin failures better.
Have patch(1) determine the filename in same manner as GNU patch.
New --posix option for patch(1) for, uh, strict POSIX conformance.
Set pkgpath in the correct order in pkg_add(1) etc.
Re-add the SATA mode detection and reset-pause-IDENTIFY fixes to wdc(4). Drive reset fixes need further testing.
Allocate the right number of elements in hashinit(9) (PR#3537).
Look up the groupname (not the username) when getting the gid from a tarfile in pkg_add(1) and friends. Also set file ownership before the mode.
Add IPv6 support to carp(4).
Sync libedit to NetBSD as of 2003-10-01, with some local string cleaning and history bug fixes. There are some api changes as a result of this update.
New port, OPENBSD/pegasos.
Fix insufficient length check in route6d(8) (KAME PR#507).
Try to deal with strdup(3) failures in init(8).
More detective work from the spelling police, double-word branch.
Fix lc(4) multicast filter initialisation.
Backout recent wdc(4) reset, identify and mode detection changes, they are breaking things.
Fix pf(4) binat for incoming connections when a netblock (not just a single address) is used as the rule source (PR#3535).
[Applied to stable]
RELIABILITY FIX: A user with write permission to httpd.conf or a .htaccess file can crash httpd(8) or potentially run arbitrary code as the user www (although it is believed that ProPolice will prevent code execution).
A source code patch is available.
[Applied to stable]
Do a better job of finding the proper partition in growfs(8).
Evaluate dependencies earlier in pkg_delete(1), and if the check fails just give a list of the required removals and quit.
Don't die if getsockopt(..., TCP_NODELAY, ...) fails in ssh(1).
In wdc(4), add a pause between a drive reset and an IDENTIFY command, to allow for units that are sick just after a reset.
Don't do ATA mode detection for SATA drives, some drives really don't like it.
Set the skew properly when rescheduling carp(4) advertisements.
Fix an mg(1) startup crash.
Don't schedule a carp(4) advertisement if the interface is on its way down and we run out of mbufs.
Really stop sending advertisements if the carp(4) interface is down.
Set the maximum value for sysctl(3) kern.stackgap_random maximum to 256MB.
Remove artificial limit on the number of partitions that may be stretched by growfs(8).
Early support in wi(4) for PRISM 2.5/3 USB adapters. Very limited for now.
Make wdc(4) reset code more like that in FreeBSD and NetBSD, fixing slave device detection when the master behaves strangely.
Reorganise pf(4) state searches for a 30% memory saving.
Don't leak mbufs on carp_output() failures.
Replace a linked list with a hash table for local IP port lookup, dramatically reducing the lookup time (in_pcblookup()) when there are many sockets.
Precompute as much of the carp(4) sha1 hash as possible.
Prevent occasional syslogd(8) hangs on receipt of a SIGHUP with a modified syslog.conf file.
Remove a few comparisons of an int to NULL.
Do initgroups(3) before chrooting httpd(8) instead of after, since /etc/group may be of use.
Stop the new bpf(4) write filter blocking everything when no filter is set, and so unbreak DHCP.
Only try to remove a dependent package once in pkg_delete(1).
In carp(4), stir in the full inner hash instead of just sizeof(pointer) bytes of it.
Finally, stop the long long pause for i386 laptop users with disconnected floppy drives.
Make pkg_info(1) do the right thing with multiple packages sharing a common stem, e.g. multiple responses for 'pkg_info autoconf'.
Allow pkg_delete(1) to work with package name stems. Oh yes.
Another missing strdup(3) error check, this time in tn3270(1).
Reduce the amount of logging spamd(8) does by default. The new -v option does verbose logging.
Have privilege-separated syslogd(8) call setgroups when changing dropping privileges, in line with the same change in newly-separated pflogd(8).
Fix a panic when traversing a corrupt msdos filesystem. From NetBSD.
[Applied to stable]
Implement privilege separation in pflogd(8). Requires creation of _pflogd user and group.
Add locking and write-filtering to bpf(4), so programs running as non-root can hold bpf descriptors without being able to write whatever they like at the link layer or issue dangerous ioctl(2)s.
Fix dc(1)'s J operator with the new extended comparisons.
Switch carp(4) from keyed sha1 to hmac-sha1.
Implement extended comparison operators in dc(1), to allow for an if ... else construct in bc(1).
Make un-getting a character from a string work the same as from a file in dc(1).
Fix a kqueue(2) file descriptor leak under libpthread.
In libpthread, don't bother resetting O_NONBLOCK on descriptors that are not flagged to survive the imminent execve(2).
Add missing strdup(3) error check in tic(1).
In mg(1), make undo work per-window instead of per-buffer.
Fix late definition of enum XML_Status in <expat.h>. From expat CVS.
A huge number of comment spelling fixes all over the tree.
Make ssh(1) choke on too-short GSSAPI OIDs.
Switch over to the new package tools.
In netstart(8), don't try to initialise carp(4) interfaces until after physical interfaces are configured.
Fix an endianness bug in carp(4) sha1 code.
realloc(3) cleanup in ppp(8).
Stop all carp(4) hosts advertising master status when preempt is disabled.
When doing carp(4), only give an error in ifconfig(8) when the user tries to set both of advbase and advskew to zero.
Correct a missing strdup(3) return value check in nc(1).
Fix numfds==0 case in pthreads-optimised select(2).
Add functions to find package name 'stems' (package names without the version number) and use them in the soon-to-be-enabled new pkg_info(1).
Add direct support in named(8) for SSHFP resource records.
Fix bc(1)'s assignment operators (+=, -= etc.)
Add J(jump) and M(mark) operators in dc(1), and use them to implement the continue statement in bc(1).
Fix out-of-bounds reads in make(1), libfreetype and xterm(1).
Make the recent vnd(4) numbering change work the way it should.
Enter carp(4), OpenBSD's Common Address Redundancy Protocol for IP high availability and load balancing.
Unbreak httpd(8) SHA1 code on 64-bit architectures.
Make sure the inode generation number (obtained using arc4random()) is positive.
pciide(4) DMA reliability fixes. From NetBSD.
strlcpy(3) -> memcpy(3) for non-string buffers in vi(1), along with some extra paranoia.
Check for signals earlier in mountd(8), so they can be handled before we select(2) until a mount request comes in.
Import new package management tools under src/usr.sbin/pkg_add. Not built by default yet.
New 'G' malloc.conf option to add a guard page after pagesize-or-larger chunks, and to return less-than-pagesize chunks in random order.
Better SATA support in wdc(4).
Fix faithd(8) args to poll(2).
Fix an out-of-bounds read in libcurses.
Have tip(1) return the terminal to a sensible state on fatal errors.
Change malloc(3) so that it aborts the process on any error other than running out of memory. This is different to the 'A' malloc.conf switch that aborts on any error.
More randomness for temporary directories created by ssh-agent(1) and sshd(8).
Switch on the ssh(1) DNS fingerprint (sshfp) lookup code, previously not build by default. Still needs switched on in the config file.
Make e.g. 'MAKEDEV tty08 - tty7f' work.
Only endian-flip the fragment offset once on IPv6 input.
Do a hardware receive checksum in sk(4) too, working around the fact that sometimes the hardware gets it wrong.
On em(4) devices that support it, offload receive checksum calculation to the hardware. From FreeBSD.
Update timezone files again, this time to tzcode2003d.
Bring bge(4) and brgphy(4) more in line with updates in FreeBSD and NetBSD, both bug fixes and additional device support.
Remember the filename given when using ^X^W in mg(1).
Make shmat(2) under Linux compat work as expected.
Fix a buffer overflow in timedc(8). Found by FreeBSD, fixed differently here.
Add division and modulus operator '~' to dc(1).
Remove GNU bc and dc from the tree.
Merge in expat 1.95.6 from XFree86 4.3.99.14.
Search for keys in the ssh(1) agent in reverse order to solve duplicate key problems (OpenSSH bugzilla #684).
ssh(1) option ForwardX11 now has xauth(1) generate untrusted keys by default. Option ForwardX11Trusted restores the old behaviour.
Change vnd(4) major/minor numbering to allow more devices. Requires a MAKEDEV.
Do nfs-specific 'test -x' stuff in the right order in ksh(1) (PR#3465).
More work on vr(4).
Have the linker generate a warning when using 43compat's getwd(3).
Better calibration code for auich(4). From FreeBSD/NetBSD.
Re-enable the random increment on the return value of uvm_map_hint() (called by uvm_map(9)).
Install a sample config file for sensorsd(8).
Prevent symlink races in systrace(1).
Have GSSAPI default to off in the ssh(1) client as well as the server.
Unbreak pf(4) on 64-bit architectures.
Hack httpd(8) so digest authentication works with IE, Safari, etc. From FreeBSD.
Fix potential signedness bug in fgets(3) (PR#1709).
Correct __bounded__ attributes for {MD4,MD5,RMD160,SHA1}DATA functions (PR#3505).
Allow newfs(8) to build small filesystems again by making sure ncyls >= 2.
[Applied to stable]
Plug a memory leak in netstat(1).
Add nfs attribute cache tuning parameters to mount_nfs(8) (Inspired by PR#2567).
Kill a null deref in make(1).
Allow a semicolon to terminate label strings in sed(1), so one-liners with labels can work.
A few string and memory fixes in rup(1).
Stability fixes for vr(4). From FreeBSD.
Add arc4 support to the kernel, and have wi(4) use it instead of rolling its own.
Unbreak sftp(1)'s handling of quotes in pathnames.
More propolice fixes and improvements.
Remove httpd(8) addon-breaking newsyslog.conf(5) sample lines.
Install sensorsd(8) by default.
Really really give xfs a poll(2) backend.
Fix a badly broken gcc(1) optimization when calculating structure offsets under certain conditions. See the commit log for details.
Unbreak lge(4) compile.
Update timezone info files to tzcode2003c.
Stop em(4) stripping 802.1q headers from packets in a bridge(4).
Add vlan(4) support to em(4).
Avoid a division-by-zero panic when benchmarking the pchb(4) RNG device.
A couple of read-from-device fixes to an(4). From FreeBSD.
Remove non-free licensed xlock(1) bitmaps.
Properly free resources when ffs_mountroot() fails.
Stop isakmpd(8) crashing when the value for LIFE_DURATION is missing.
Back out the new environment variable load in ld.so(1) due to sparc breakage.
Unbreak the new xfs poll backend.
Fix a long-standing memory leak in kernel libz (PR#2886). From NetBSD.
Print a more useful error message when a bad port number is given to whois(1).
Fix broken time parsing in kadmin(8) (PR#3292).
Initialise environment variables in ld.so(1) before calling constructors and atexit(3) functions
Have inetd(8) exit if no config file is found.
In sendmail(8) submit.mc/cf, bind the msp to 127.0.0.1 instead of localhost just in case localhost doesn't resolve correctly.
Teach netstat(1) how to deal with KAME embedded scope IDs for -f encap route dumps.
Use arc4random(3) to generate cookies in the XSecurity extension.
Fix a few off-by-ones in gethostbyname(3) and friends.
Allow multiple RCPTs in spamd(8), and stop looping on invalid commands.
Bring in a number of pipe(2) stability fixes from FreeBSD.
Fix httpd(8)'s handling of SSLCertificateChainFile under the chroot.
sshd(8) usage output now dumps the OpenSSL version too.
Don't try to send incomplete IPv4 fragments in the ENOBUFS case. Note that this is a behaviour change from 4.4BSD and applies to output from bridge(4) and pf(4) as well as vanilla IP output.
A couple of endianness fixes when setting the IPv4 output fragment offset.
A couple of minor malloc(3) fixes related to recursive calls and debugging.
Clean up IPv6 flowlabel handling.
New IPv6 ID and flowlabel generation code using arc4random(9).
Remove a bad m_cat(9) call when fragmenting outbound IPv6 packets.
Add a missing initialisation in pflog(4) that allowed kernel stack garbage to leak into .pcap files.
Have the libc stack protector code use the kernel __sysctl() call directly instead of using the libc sysctl(3) interface.
Stop reading ~/.signature to pre-fill the Organisation: field in sendbug(1) (PR#3499).
Fixes to event(3) poll code.
Have ftpd(8) listen on both IPv4 and IPv6 ports by default.
Fix an out-of-bounds memory access in kernel compat_ibcs2(8) code.
Add missing check for strdup(3) error in talk(1).
Correct a couple of off-by-ones in banner(1) and ssl(3) (src/ssl/ssl_ciph.c).
Fix the code that grows ifindex2ifnet in sys/net/if.c.
Add a stack of missing switch break statements needed after the _dl_errno changes to ld.so(1).
Teach size(1) how to read ELF objects.
POSIX and interoperability fixes for bc(1) and dc(1),
SECURITY FIX: The use of certain ASN.1 encodings or malformed public keys may allow an attacker to mount a denial of service attack against applications linked with ssl(3). This does not affect OpenSSH.
A source code patch is available.
[Applied to stable]
Properly free resources on fxp(4) attach failures.
Some reliability fixes in ahc(4) and siop(4).
Allow sensorsd(8) to daemon(3)ize itself.
Fix an unchecked strdup(3) in getnetgrent(3).
Fix several kernel networking off-by-ones w.r.t. PRC_NCMDS.
Better error checking for new bc(1) and dc(1).
Make new bc(1) compile on sparc64.
PCI support for hppa through dino(4) bridge driver.
Further realloc(3) cleanup.
Re-engineer the pf(4) ioctl interface to allow near-100% atomicity for 'pfctl -f /etc/pf.conf' commands.
[Applied to stable]
Fix bogus getutmp() error check in battlestar(6).
Change the xfs backend from select to poll.
Introduce 64-bit byteorder(3) macros.
strdup -> strlcpy in apmd(8), and make sure the socket gets unlinked at exit.
Better malloc(3), realloc(3) and strdup(3) error checks in config(8).
Stop pflogd(8) shouting 'Reopened logfile' at syslog.
Add a number of missing checks for strdup(3) failure.
Add an sscanf(3) bounds check to the neighbour cache file code in ndp(8).
Reorder the pf(4) statistics counter code and fix some miscount bugs.
In isakmpd(8), don't listen on INADDR_ANY if the Listen-on option is specified.
Fix an off-by-one and a bad string bounds length in atc(6).
Don't set sshd(8)'s listen socket to non-blocking mode.
Build the new BSD bc(1) and dc(1) in favour of the GNU versions.
Drop authpf(8)'s 15-character username restriction, it's no longer necessary (PR#3491).
Allocate a buffer large enough to store a full IPX address in ipx_ntoa(3).
Unbreak netstat(1) -i display columns for interfaces with no address.
Stop spamd(8) dying unceremoniously on accept(2) failures.
Make talk(1) retry if accept(2) returns ECONNABORTED (the same as it does for EINTR).
realloc(3) fixes in brconfig(8), dhclient(8), lpd(8), pppd(8) and rwhod(8).
Add a 'recipe' datafile to fortune(6), starting with some barbecue recipes from the hackathon.
Use arc4random(3) instead of srand(3) to generate a more random salt for htpasswd(1).
Start removing unnecessary null checks before doing free(3) on a possibly null pointer.
Fix scrambled display when resuming a suspended less(1) process.
Use strlcpy(3) instead of bcopy(3) to avoid overflowing the nodename and netname in an(4).
Fix a couple of off-by-ones in adventure(6).
Fix an out-of-bounds write in the isakmpd(8) privsep monitor code.
Make dlerror(3) clear _dl_errno as expected (PR#3441).
Correct a couple of off-by-ones in libc.
Fix overflows in the X font server overflow fix. Sigh.
Add a missing free in cvs(1).
New, BSD-licensed version of bc(1).
Fix an off-by-one in csh(1) (PR#3163).
More realloc(3) fixes.
Fix a bad bounds check that could crash sort(1).
More paranoid privsep parent/child communication in syslogd(8).
SECURITY FIX: It is possible for a local user to cause a system panic by flooding it with spoofed ARP requests.
A source code patch is available.
[Applied to stable]
A number of realloc(3) fixes (removing instances of the bad idiom described in the manpage) in several programs.
New program sensorsd(8) to monitor hardware sensors as exposed by the hw.sensors sysctl. Not installed yet.
Unbreak tftp(1) put command.
Remove and re-add SHA2 support in isakmpd(8), minus OpenSSL EVP-related fd leaks.
Fix some realloc bugs in pfctl(8) tables code.
Initial HIFN 7955/7956 crypto accelerator support.
Increase spamd(8) maximum connections from 200 to 800.
Install a more complete set of sendmail(8) empty config files under /etc/mail.
Throttle 'proc: table is full' messages to once every ten seconds. From NetBSD.
Further improvements to ssh(1)'s fatal exit handling.
Use the much simpler getifaddrs(3) instead of sysctl(3) in rtadvd(8).
Use getaddrinfo(3) for name-to-address resolution in isakmpd(8).
Replace kernel select(2) backends with poll(2) backends. This allows for more complete poll() functionality. From NetBSD.
In mtrace(8) only do mask checks for AF_INET.
Add poll(2) support for event(3).
Fix a few suspect strlcpy(3) calls in ifconfig(8).
Allow getopt_long(3) to accept an optional argument separated by whitespace, unlike GNU getopt_long.
Stop tsort(1) reading past the end of its buffer.
Plug a realloc memory leak in mg(1).
Off-by-one fixes in nc(1), pmdb(1), ppp(8), libssl, libpthread and a few in the kernel.
Sync up named(8) with BIND 9.2.2-P3, with support for new zone type 'delegation-only'.
In the new dc(1), make all registers contain zero initially for compatibility.
Fix, clean up and simplify the installer's handling of yes/no responses from the user.
Use poll(2) instead of select(2) in skey_authenticate(3).
Plug a memory leak in rtadvd(8).
Stop extraneous 'no disk label' warnings in the installer.
Implement hardwareflow (hf) option for tip(1). Off by default.
Fix an out-of-order free() in rpc(3).
Don't leak memory if memory allocation fails in libc rpc(3) code.
Change the ld(1) script to make contructors and destructors in dynamic binaries non-writable.
Completely new BSD-licensed version of dc(1) using the OpenSSL bn(3) routines.
Have scp(1) check for an error code in remote->remote mode.
When chrooting httpd(8), use initgroups(3) so that supplementary group IDs are initialised as well.
Temporarily disable soft interrupts support in usb(4) for stability reasons.
[Applied to stable]
Several abnormal exit handler fixes to ssh(1).
Better disk device probe on i386.
Correct the signal number validity check in csh(1)'s kill command.
Make grep(1)'s binary file test work for gzipped files the same as for other files, testing against isspace(3) as well as isprint(3).
Make sure whois(1) can't zap straight past the beginning of the buffer when removing spaces from line endings.
Stop pfctl(8) checking for a netmask if the address type being examined is a table.
Fix a subtle use-after-free in modload(8).
Some int -> u_int paranoia in ssh(1).
More ssh(1) buffer management fixes (CAN-2003-0682).
Further EDD detection improvements on i386.
Properly flush the ssh(1) RSA1 public key from memory when its output file cannot be opened (OpenSSH bugzilla #662).
Correct a double-free in the ssh(1) buffer management code (OpenSSH PR#660).
Fix the ssh(1) ConnectTimeout option (OpenSSH PR#656).
On i386, try harder to boot from removable media by allowing for their removal and insertion.
Updated and better-commented openbsd-proto.mc for sendmail(8).
Upgrade sendmail(8) to version 8.12.10. The address parsing security fix went into 3.4 and -stable, but not the full version update.
3.4 -> 3.4-current.
--------
Changes made between OpenBSD 3.3 and 3.4
SECURITY FIX: A buffer overflow in the address parsing in sendmail(8) may allow an attacker to gain root privileges.
A source code patch is available.
[Applied to stable]
Bump OpenSSH version to 3.7.1 after the buffer management fixes.
SECURITY FIX: All versions of OpenSSH's sshd prior to 3.7 contain a buffer management error. It is unclear whether or not this bug is exploitable.
A source code patch is available.
[Applied to stable]
On i386, don't try to enable EDD support if the BIOS doesn't support extended disk access.
Add support for the AES instruction on new VIA C3 CPUs.
SECURITY FIX: Root may be able to reduce the security level by taking advantage of an integer overflow when the semaphore limits are made very large.
A source code patch is available.
[Applied to stable]
Pass -a to fgrep(1) in Texinfo to make sure info files don't get treated as binary.
Have grep(1) check for the correct error value from mmap(2), fixing a crash.
Allocate enough space for sysctl(3) in pstat(8).
Fix the endianness of tcpdump(8)'s icmp echo output.
Match up kernel and userland ioctls for AFS, allowing afsd(8) to turn on kernel debugging (PR#3442).
Mirror the crypto(9) sha2 context fix in libc sha2(3).
Make an invalid '-<num>' option to diff(1) give an error.
Fix grep(1)'s parsing of the '-<num>' option where num has more than one digit.
Resurrect the -u<num> unified context length syntax for diff(1).
Use more bytes of the file when testing for binary in grep(1).
Test more than just the first character of the input file for ASCIIness in diff(1).
Stop pppctl(8) coredumping (PR#3454).
Fix i386 hang on 'boot -a' (PR#2122, PR#3437).
Have the upgrader script perform the ssl -> openssl includes dir change, both in /usr/include and /usr/libdata/perl5/site_perl/*-openbsd.
Make strxfrm(3) standards-compliant.
Machine-dependent installation notes added or updated. Note especially upgrade instructions for i386.
Add a wi_detach() function for, uh, wi(4) and use it to shut down PC cards properly.
Sync pf.os(5) database with p0f 2.0 release.
Allow compress(1) to read from a symlink when writing to stdout (PR#3409).
Only trigger the gcc(1) bounds checker warning if the bounds length is less than zero, since some legal code uses the zero case.
Fix some bugs in the pkg_* tools (PR#3414).
Don't leak a socket in the isakmpd(8) setsockopt error path.
Add a SMALL define in compress(1) that leaves out bits not needed by the installer.
Add a null compressor to compress(1) so gzcat and friends can work on uncompressed files.
Fix a FILE* leak in sup(1).
Fix a crasher in netstat(1) by adding descriptions for icmp types up to ICMP_MAXTYPE (PR#3439).
Correct some ld.so(1) logic so that the GOT and PLT always get W^X applied.
Add a GOT symbol lookup cache to ld.so(1).
A few more bzero(sizeof pointer) fixes.
Temp file security fixes for sup(1).
Add dummy syscalls under Linux emulation for *xattr(), all returning ENOATTR.
Make the small window size feature of spamd(8) optional (see PR#3435).
Plug memory leaks in lpd(8) and lpq(1) (PR#3425).
Fix sizeof(pointer) bzero(3) args in crypto(9) sha2 code.
Add Broadcom BC5823 crypto accelerator support to ubsec(4).
OpenBSD 3.4 images for xdm(1).
Make xdm(1)'s error file directory (when under /tmp or /var/tmp) have a more random name.
Fix a missing initialisation in faithd(8), and specifically request a TCP socket just in case getaddrinfo(3) is SCTP-aware. From KAME.
Use poll(2) instead of select(2) in faithd(8).
Bump eephy(4)'s mode autonegotiation timeout to 5s so slow copper switches can do their work. Fixes sk(4) boottime problems.
Change vi(1) to use a dynamic select(2) fd_set for curses mode, and poll(2) in ex(1) mode.
More conservative settings and an additional error check for aac(4) to improve reliability.
3.4-beta -> 3.4.
Disable the patented TrueType bytecode interpreter code in freetype.
Sync up the X fontconfig int overflow fixes with those in the XFree86.org repository.
Add '?' and '!' as punctuation characters in mdoc(7). Lots of manual pages updated to reflect this.
Require encryption for all isakmpd(8) Phase 2 messages.
Add a random offset in the range 0-256MB to the address returned to uvm_map(9) by uvm_map_hint(), scattering libraries and mmaps about the place.
Fix old-style suser() calls in atalk(4).
Fix a use-after-free in libutil check_expire(3).
Bump OpenSSH version to 3.7.
[Applied to stable]
Fix symbol lookup in objects opened with dlopen(3) (PR#3371).
Add Solaris-compatible RTLD_* defines in <dlfch.h>.
Fix a memory leak in sshd(8) GSSAPI authentication.
New 'emacs-usemeta' +o option for ksh(1) that allows 8-bit characters to be input in emacs mode.
Add fadvise64() dummy syscall under Linux emulation, for compatibility with recent glibc.
Make pf(4) translation rules update the table counters, since that's the only place it could occur for a 'nat pass' rule.
In the Alpha X server config, disable the segfault-prone freetype module for now.
Since the freetype renderer can also render Type 1 fonts, remove the obsolete type1 module from default X server configurations.
A few GSSAPI fixes in ssh(1).
Fix truncation of filenames by ssh(1)'s progress meter.
Unbreak mopd(8)'s -a flag interface detection.
Apply the X font library fixes to the XFree 3.3.6 servers.
Pull in fixes from XFree 4.3 for a number of potential int overflows in the font libraries.
Remove three potential use-after-frees in pf(4) scrub code.
Remove some recent pfctl(8) binary operator sanity checks that were broken on big-endian architectures.
isakmpd(8) now supports AES for phase 1 also.
Remove Kerberos support from SSHv1 code in favour of GSSAPI, but keep Kerberos password authentication in SSHv1 and SSHv2.
Fix a bad size argument to bzero(3) in dc(4).
Correct pfctl(8) -vvsr output for tables inside anchors.
Fix a missing initialisation in the aic(4) microcode. From NetBSD.
Fix some memory leaks in sup(1).
Updates to the pf.os(5) database.
Remove a dangling else in OS fingerprint code, fixing the M and W tcp options.
Add some X key bindings missed in the XFree86 4.3.0 merge.
Make the pf(4) OS fingerprint allow for 'smart' DSL and NAT routers that tweak the tcp mss.
Escape out any special characters in the output of the ksh(1) emacs mode function 'expand-file.'
Remove a whole bunch of httpd(8) modules not used by OpenBSD.
Don't set the hostname from /etc/myname unless that file exists. Netbooted systems don't need it.
Install sed(1) USD docs.
Fix pkg_create(1)'s handling of the @cwd directive.
Remove the RNF_IGNORE route(4) flag.
Make pfctl(8) choke on port range binary operators (<>, ><) unless the first port given is less than the second.
Put back spamd(8) logging of blacklist matches.
Unbreak ksh(1) emacs-mode forward- and backwards-delete.
Fix afsd(8) crashes on alignment-sensitive architectures.
Do a dummy password calculation for nonexistent usernames in sshd(8), to prevent username discovery by timing.
Add new route(4) flag RTF_CLONED (displayed with a 'c' in netstat(1),) set for cloned routes and used to delete such routes when the parent goes away.
Don't insert the full gcc(1) string into objects by default (see -findent in gcc-local(1)).
Have pfctl(8) disallow return-rst ttl values greater than 255.
Add an interface init routine to struct ifnet, required for 802.11 support.
Correct a divide-by-zero in sftp(1)'s ls implementation.
Fix static ssh(1) builds.
Some 64-bit cleanup in the new ssh(1) GSSAPI code.
Stop pfctl(8) rejecting perfectly legitimate nat-with-tables rules.
When tables are used in pf(4) routing rules with address pools, only allow round-robin mode.
Structure and defines for generic IEEE 802.11 framework.
'Implement' pread(2) and pwrite(2) under FreeBSD emulation (they're identical to the native calls).
In the installer, if an interface is configured using DHCP then assume that the default route is via DHCP also.
Improvements to spamd(8):
New -s option to specify the delay in seconds between each character sent.
Shrink the TCP receive window to one byte, hurting the sender's stack.
Keep the connection open until ten lines of mail body have been received.
Better logging via syslog.
Use the correct format for printing time values in spamd(8).
Check the maximum size of an exec header after lkm(4) load or unload, since the module may just change it.
Allow sysctl(8)-toggled emulations to be switched off after being switched on.
Fix a bug in ksh(1) emacs-mode filename completion.
Fix 64-bit breakage in pfctl(8) counters output.
Build sendmail(8) with support for DSN-specific timeouts, so bounces can be timed out more quickly.
Fix ksh(1)'s end-of-word detection.
Remove ssh(1) and sshd(8) support for the kerberos-2@ssh.com authentication method, now obsoleted by GSSAPI.
Add GSSAPI authentication support to ssh(1) and sshd(8).
Don't age IPv6 non-gateway host routes. (NetBSD PR bin/22568.)
New keywords @extra and @extraunexec for pkg_create(1), to specify 'extra' package files that are only undeleted with pkg_delete -c.
tcpdump(8) can now show the operating system of TCP SYN packets with the -o option.
Add passive OS fingerprinting capability to pf(4), via the 'os' keyword.
Add pf.os(5) passive OS fingerprint database.
Add kern.emul.* sysctl(8) toggles for the various OS emulations instead of compile-time options.
Fix Apache bug #21737 (zombie suexec processes) by reverting to 1.3.27 behaviour.
Merge in Apache 1.3.28 and mod_ssl 2.8.15.
By default, use spamhaus instead of spews for spamd(8).
In libcrypto, add bignum zero to bignum zero without corrupting the result.
Backport a fix for an obscure g++(1) bug which propolice trips.
RELIABILITY FIX: An improper bounds check in the semget(2) system call can allow a local user to cause a kernel panic.
A source code patch is available.
[Applied to stable]
Queues that list themselves as a child queue are now disallowed by pfctl(8).
Have pfctl(8) print a more helpful error messages for bad queue definitions and invalid CBQ priorities.
Convert bootpd(8) from select(2) to poll(2).
Increase the default FD_SETSIZE from 256 to 1024.
Set the select(2) timeout properly for active mode FTP under faithd(8).
Change ioctl(...SIOCFIGCONF...) to getifaddrs(3) in lots of places.
Add dynamic select(2) fd_set handling to ypbind(8).
Convert map-mbone(8), mrinfo(8), mtrace(8), pppctl(8) and timed(8) from select(2) to poll(2).
Fix accidental fallthrough from SIOCSIFADDR to SIOCIFFLAGS for tl(4), tx(4) and wb(4).
As well as recommending su(1) instead root logins, clearly and distinctly suggest the user read afterboot(8). If that doesn't work, banner(1) is available...
Change /etc/mtree/4.4BSD.dist to reflect the move from /usr/include/ssl to /usr/include/openssl.
New mtd(4) driver for Myson Technologies 3-in-1 Fast Ethernet boards. From NetBSD.
New NOFONTS define for XF4, stops fonts being built. Oh yes.
Handle target lookup using the shell PATH nicely in pmdb(1).
Do a tzset(3) in syslogd(8) before doing the chroot.
Don't treat PKG_PATH-built URL paths to pkg_info(1) as if they refer to local files.
Make pkg_info(1)'s -a option look only at installed packages.
Have pfctl(8) detect nonsensical max-mss > 65535 in scrub rules.
Don't loop back a copy of a broadcast or multicast packet to a simplex interface if pf(4) routing is involved, preventing lockups.
Enable the --initial-tab long option to diff(1) by spelling it correctly.
Use only sysctl(3) to stir arc4random(3) using kernel arc4random(). No more messing with /dev/arandom.
Add a bunch of emacs commands to mg(1) dired mode.
Unbreak mg(1) dired mode directory listings.
In the kernel, change arguments to suser(), and add new suser_ucred() for instances where caller doesn't have a process.
New -S option to pkg_create(1), like -s only better.
Zero out unused directory entry fields on FAT12 and FAT16 filesystems, to avoid breakage on Win2k and WinXP (PR#3400).
Add a bunch more syscall stubs and implement exit_group() under Linux emulation. Needed for newer glibc binaries.
Fix wrongness, memory leakage and a panic on directory reads in other-OS emulation mode on some filesystems.
Have ssh-keygen(1) exit nicely after screening candidate primes (-T option).
Much cleanup in the new safe(4) driver.
Add the POSIX-mandated struct itimerspec to sys/time.h .
Install the sendmail(8) TUNING guide.
Better memory-use optimization for diff(1).
Remove the very deprecated RhostsAuthentication feature from ssh(1).
Use tcsendbreak(3) in sshd(8) instead of ioctl(...TIOCSBRK...), for portability.
Convert rshd(8) to use poll(2) instead of select(2).
Don't blindly pass FD_SETSIZE as the first argument to select(2), that's bad mmmkay?
New driver, safe(4), for the SafeNet crypto accelerator. From FreeBSD.
Remove a bunch of AFS stuff that isn't used by OpenBSD.
Merge in xfs from the ARLA-current as of 20030805.
Stop pkg_create(1) erasing the last checksum from CONTENTS.
Kill a panic when creating a block device on a full filesystem (NetBSD PR#22419).
[Applied to stable]
ftp(1), rsh(1) and talk(1) now use poll(2) instead of select(2).
Unbreak pf(4) DIOCCHANGEADDR.
[Applied to stable]
Some nice robustness-in-the-face-of-spam tweaks to the example sendmail(8) config in cf/courtesan.mc.
Do dynamic select(2) fd_set allocation in nfsd(8).
Handle realloc(3) failure nicely in the libedit tokenizer.
3.3-current -> 3.4-beta.
Implement CLOCK_MONOTONIC for clock_gettime(2). From NetBSD.
Don't attach a le(4) device if the interrupt for it can't be established.
Stop patch(1) adding an extraneous newline at the end of its output.
Have patch(1) warn if a context or unified diff comes without a context, since this makes detection of a previously applied patch impossible.
Remove uvm_useracc() from uvm(9).
Fix an off-by-one in vacation(1).
Allow tables to be used in pf(4) translation and routing rules.
In diff(1), do the initial memory allocation using a guesstimate based on the file size.
Fix a bunch of potential null derefs in isakmpd(8).
Stop patch(1) scanning the input file twice.
Disable a gcc(1) optimization, enabled by -fexpensive-optimizations and hence by -O2, on platforms where it was generating incorrect code.
Fix some memory leaks in ed(1).
Allow 192- and 256-bit AES in crypto(4).
Use setusercontext(3) instead of roll-your-own in httpd(8), so that login.conf(5) values apply.
Make pf(4) matching code handle 32-bit uid and gid values properly.
Make the sysctl(3) toggle net.inet6.ip6.redirect work as expected.
Fix a potential use-after-free in icmp6 redirect code.
Fix the abnormal exit code in ohci(4).
Plug memory leaks in modload(8), pkg_add(1) and usb(4).
Add -h option to ls(1) for human-readable sizes.
The gcc(1) -Wbounded checker can't handle variable-length arrays yet, so don't try.
Stop gdb(1) crashing on 'set enum' without an argument.
Now the information is actually copied into place, make mount(8) show procfs info.
Have procfs copy its mount options into statfs.mount_info.
Add a debugging lever that forces patch(1) to use plan B.
In patch(1) plan A, use mmap(2) instead of read(2)/malloc(3).
strlcpy() -> strncpy() in bos(8), un-busting the AFS wire protocol.
Merge in ARLA -current, set version to 'arla-20030805'.
systrace(1) updates from NetBSD and monkey.org.
Add a missing close() in libsa's exec().
Use strlcpy(3) to guarantee null termination of the coredump process name.
Implement the WCONTINUED flag in wait*(2), as per POSIX. Adapted from FreeBSD.
Fix Linux truncate64() emulation as well.
Remove GNU gzip from the tree.
New, BSD-licensed znew(1) script.
Properly check the result of attempts to read from and write to processes in pmdb(1).
Stop ksh(1)'s Emacs mode yank-pop command dumping core when run twice (PR#3384).
Correct emulation of Linux ftruncate64().
SECURITY FIX: An off-by-one error exists in the C library function realpath(3). Since this same bug resulted in a root compromise in the wu-ftpd ftp server it is possible that this bug may allow an attacker to gain escalated privileges on OpenBSD.
A source code patch is available.
[Applied to stable]
Back out the pthread itimer change (except when profiling) for compatibility reasons.
Add __bounded__ attribute definitions (see gcc-local(1)) for many library functions.
Don't print a pointless read-only warning message when running vi(1) in read-only mode.
New -q flag for pkg_delete(1) that doesn't do a checksum before removing package files.
Support for Marvell-based devices in sk(4).
Make pf(4) table tickets per-ruleset instead of global.
Remove undocumented '-p' == '-p0' behaviour from patch(1), like GNU patch and in accordance with POSIX.
Repair patch(1)'s relative path handling by not nuking a parameter needed later in the function.
Change the hash function used in the internals of diff(1) so it generates fewer collisions.
Privilege separation for syslogd(8). Note new HUP behaviour.
Have patch(1) complain about non-existent lines at most once per patch.
Make sure pfctl(8) doesn't attempt to display no-longer-existent queues.
In sshd(8), check that password authentication is enabled before trying to authenticate users using the 'none' method (i.e. a blank password).
Add a new, BSD-licensed gzexe(1).
Fix diff(1) exit codes when comparing against stdin.
Remove GNU diff from the tree.
Add basic support for ftp:// package paths via the PKG_PATH environment variable.
Make patch(1) prompting more POSIX, and add the POSIX -i option.
Make ifconfig(8) die (instead of just complaining) when addition or deletion of an interface address fails.
Use a sockaddr_storage instead of a sockaddr to avoid a stack smash in bpf(4).
Remove a stray backslash and unbreak 'make release' for XF4.
Save the interface associated with a pf(4) state table entry when the entry is first created, not when another packet matches the entry.
When running fsck(8) as root, bump the data size resource limit up to unlimited (instead of up to the hard limit) to avoid problems with large filesystems.
Better TMPDIR environment variable handling in patch(1).
Improved test for output on stdout in compress(1).
New ssh(1) progress meter implementation, with better licensing.
Add 'pass on lo' to the temporary boottime pf.conf(5) (PR#3376).
Fix ftp-proxy(8)'s handling of multiline server responses (PR#3378).
Add a new, BSD-licensed zforce(1) script.
Make compress(1) do the right thing when confronted with (e.g). 'gzip -lN < foo.gz'.
Another missing netinet byte-order fixup, this time in fragment reassembly code.
Fix a printf(%s) off-by-one in isakmpd(8).
Improvements to pf(4) skip-step calculation.
More propolice fixes.
Add growfs(8) from FreeBSD.
Remove unlicensed MATH_EMULATE code (written by some guy named Torvalds) from the kernel, leaving only the GNU emulation code for the moment.
Don't treat consecutive slashes as path components in patch(1), for POSIX reasons.
Make patch(1)'s exit value consistent with POSIX and with diff(1).
Add mbuf(9) markup (M_TUNNEL) for tunnel-mode IPsec connections so that gif(4) over IPsec can be detected and unencapsulated consistently (PR#3023).
ssh-keygen(1) can now generate the Diffie-Hellman groups as needed by moduli(5).
If compress(1) detects that compressed output would be larger than the input, fail so that the .gz file gets removed.
Fix a missing initialisation and cure a hang that could occur when diff(1)ing a directory.
Try to bound memory and CPU usage of diff(1), old (unbounded) behaviour available with -d.
Install ed(1) tutorial papers.
Stop mtree(8)'s -s option enabling -t by mistake.
More tweaks to compress(1).
Fix an x86 DoS (reported by Michal Zalewski) by zeroing the SYSENTER registers at kernel boot time.
[Applied to stable]
Remove some in-place IP header byte order changes in bridge(4), missed out before.
Print the right error line number in newsyslog(8).
Change references to the now non-existent kerberos(1) manpage to point at 'info heimdal.'
Add sha2 support to isakmpd(8).
A few *printf cleanups in sys/net/.
New __kprintf__ format attribute for gcc(1) that groks kernel *printf(9) format arguments. See gcc-local(1) for details.
Change patch(1)'s -b option to be POSIX ('save a backup') and give the old functionality (specify backup filename suffix) to the -z option like GNU patch. For now, -b is on by default.
Fix IP packet length setting for IPsec tunnels, lost in recent byte order changes.
Add sha2 support for IPsec.
Add _syslogd user for, um, syslogd(8), soon to get the privsep treatment.
Allow the kernel to build with inet enabled but ether disabled (PR#3356).
New APIWARN libc/Makefile define, disabled by default, which makes the linker complain whenever unsafe string functions are used.
Move nasty SCSI utility code out of libutil and into scsi(8), the only place it's used.
When detaching an interface, remove from software interrupt queues any packets pointing to that interface.
Enable DMA on all but really old Promise pciide(4) controllers.
Add some fixups for LBA48 support on old Promise pciide(4) controllers. From NetBSD, fixes from FreeBSD.
In Linux emulation mode, don't pass (as yet) unimplemented vfat ioctls through.
Remove unused scanner stuff in src/usr.sbin/ssio.
Implement the sysinfo() system call under Linux emulation.
Remove AFS code from sshd(8).
Redo the 'invalid line number' fix for patch(1).
Update CGI(3p) to version 2.98 to fix a cross-site scripting bug.
[Applied to stable]
Use libc getopt_long(3) in patch(1) instead of a local version.
POSIX tweaks to patch(1).
Switch over to the new diff(1) and diff3(1) code, disabling GNU diff. sdiff is no more.
Remove obsolete KerberosIV and AFS code from ssh(1) and re-enable the -k option.
Implement diff(1) options -L and -T for GNU diff compatibility.
getaddrinfo(3) and getaddrinfo(3) now share a mutex.
Check for invalid flags to mmap(2) and mprotect(2) and bomb out on errors.
A number of compatibility and POSIX compliance tweaks to diff(1)'s output.
Back out the patch(1) line number fix, it coredumped sometimes.
Add llabs(3) function for C99 compliance.
Add ftw(3) and nftw(3) functions, implemented using fts(3), for XPG compliance.
Dynamically grow diff(1)'s array of changes as required.
Fix a redraw bug in vi(1) that could cause endless recursion.
Compile modload(8) with the -Z option to ld(1) (disabling W^X).
Fix a typo in md5(1) that created an array of ints instead of chars.
Allow uhid(4) devices to be used as 'mice' for the X server.
In wd(4) only use LBA48 when absolutely necessary, to cut down on register-writing overhead.
Have ac(8) ignore entries that go back in time.
Fix a bug causing a segfault in grep(1) (PR#3358).
With MALLOC_EXTRA_SANITY defined, have malloc(3) just warn instead of dying on mmap(2)/brk(2) errors.
Updates to systrace(1): Bug fixes and new 'ask' action.
Fix sftp filename parsing for arguments with escaped quotes (OpenSSH bug #517).
Don't flip compress(1) into 'zcat' mode if the -o option is given.
Check that the mountpoint of the descriptor passed to fstatfs(2) is non-NULL.
Un-swap ld.so(1)'s display of (requested, available) library revisions when the available library is less than that requested.
GNU diff compatibility and many other fixes and cleanups to diff(1).
Fix pf(4) scrub rule fragment reassembly after the netinet byte order changes.
Add ESP decryption support to tcpdump(8) (-E option).
Make diff(1)'s no-newline-at-end-of-file handling consistent with GNU diff, now that patch(1) is expecting this.
Fix a sizeof(wrongthing) bug in grep(1).
Teach patch(1) how to deal with "\ No newline at end of file" as produced by GNU diff (and soon OpenBSD diff(1) as well). From NetBSD.
In newfs(8), remove the ffs default limit of 16 cylinders per group, and simply set to match other parameters. Change the default frag size to 2048, which bumps the block size to 16k. (From FreeBSD newfs.c late 2001.)
React rationally to bogus line numbers in input to patch(1).
Don't store Kerberos credentials in the privileged sshd(8) process.
Clear IUCLC flag (uppercase-to-lowercase translation) when setting raw tty mode in ssh(1).
Allow as many -d (sshd(8)) or -v (ssh(1)) options as the user cares to give. Max debug/verbose level is still 3.
Have mkdep(1) correctly handle '-o <file>' on the compiler command line.
In xargs(1), don't call err(3) (which uses exit(3)) after doing vfork(2).
Fix line ranges for unified diff(1) output.
Unbreak pflog(4) after the recent netinet byte ordering changes.
Stop compress(1) from re-compressing a file with a suffix indicating it's already compressed.
Fix memory management in pfctl(8)'s table parsing code.
Range-check numeric arguments to grep(1) against INT_MAX.
Un-swap the sec and usec uptime stats in an(4).
Fix file suffix handling code in compress(1).
Allow compress(1) to accept -t and an implied -c when we're taking piped input (normally -t and -c are mutually exclusive).
Enable build of KerberosV libraries under lib/.
More manpage cleanup.
Remove undocumented sshd(8) option '-V'.
Remove error(1).
Fix a couple of cases where malloc(3) fails due to lack of memory, but doesn't set ENOMEM.
Make fwohci (IEEE1394) cardbus code compile on big-endian systems.
Add zdiff(1) script using our new improved compress(1).
Remove a couple of unnecessary htons() calls in the pf(4) routing code.
Parsing improvements and better debugging/regression test support for tables in pfctl(8).
Make compress(1) magic number checking work when decompressing on a pipe.
Make sure an unlock message gets sent when handing NFS receive errors.
Add a cast to 64 bits to prevent a statfs(2) overflow on large disks.
Fix grep(1)'s -v semantics (print if no match of any pattern).
LBA48 support and compatibility tweaks for atactl(8).
Set the correct return code when grep(1) dies due to an error.
Fix parsing of -<num> (context) option to grep(1).
Bring in a diff3 from 32V UNIX, and start hacking it into shape.
Tweak the installer's ftp client operation so that sets are always fetched from the exact same place as the set list.
Prevent excessive rekeying in ssh(1) for ciphers with block size <= 128 bits by enforcing a fixed 1GB rekey limit for these ciphers.
Set all ulimit values to 'unlimited' in the installer, unbreaking fsck(8) for large filesystems.
Fix a couple of broken IPv6 packet length tests.
Unbreak merging of host lists in pfctl(8).
Stop spell(1) misinterpreting '+X' as option '-X'.
Tidy up a bunch of missing include files all over the place.
Have the IPv6 normalizer detect short packets, since the 'exact length' match was just removed.
When normalizing IPv6 packets, don't check against length fields that are only set after filter processing.
In the netinet stack, don't cheat by NTOHS()'ing ip_len and ip_off (modifying the packet buffer directly). Instead, call ntohs() every time.
Make ld.so(1) compatible with newer binutils.
Stop pkg_add(1) dumping core when the package contains an invalid package name.
Fix a double free in ex(1).
Give gem(4) a performance boost on sparc64 and macppc.
Merge in libevent 0.7a.
New 'remove manpage' option -u to makewhatis(8).
Fix a dangling pointer when deleting multicast router virtual interfaces (option MROUTING required).
Fix some PHY problems in sis(4).
Better temp file handling in diff(1).
diff(1)'s -l (paginate) option works again.
Sync USB code with NetBSD, in preparation for USB 2.0 support.
Don't kill other users' states when logging in to authpf(8). When killing (the correct user's) states, make sure they're all zapped.
[Applied to stable]
When using IPsec, fix a panic by not trying to forward truncated IP-in-IP encap packets.
Clear down multicast forwarding on IPv6 interface detach.
Make httpd(8)'s (normally not compiled) DBM SSL cache code build again.
Fix a double free in diff(1).
Try to avoid using an unnecessary temp file when diff(1)'ing against a regular file redirected to stdin.
If syslogd(8) is given (via -p) a UNIX socket name that's too long, fail instead of silently truncating the name.
Make sure compress(1) closes its open files properly.
Fare thee well, rpc.pcnfsd(8).
Fix security(8)'s password expiry check.
Pass the right length to readlink(2) in rdistd(1).
When given a unix domain socket name that's too long, nc(1) gives a helpful error instead of silently truncating the name.
Implement the cpuid() function for generic i386, not just for longrun.
Print dump(8) times correctly (PR#3296).
raidctl(8) dies noisily instead of silently truncating overlong command line options.
mount_nfs(8) now gives a helpful message when the hostname is too long.
Major updates to BSD diff, implementing many more 'standard' options and tidying up somewhat.
Properly reset all fields of a deleted ext2fs inode, fixing a panic. From NetBSD.
[Applied to stable]
Fix an off-by-one in kernel ext2fs filesystem code, the first ext2 inode is numbered one not zero.
[Applied to stable]
Further strn*() -> strl*() fixes.
Back out routing socket exact match fix after reports of problems.
Remove -h functionality from BSD diff, but allow the option for compatibility like GNU diff.
Various cleanup in pkg_add(1) et al.
Add 'pass' pf(4) modifier for nat rules, allowing a translation rule to bypass the filter ruleset altogether.
Remove a redundant (and wrong) copy in pf(4) tcp test code.
Better umask setting detection in security(8).
Use realpath(3) instead of roll-your-own code in mount_*(8) helpers. Fixes PR#1662.
String function cleanup in getNAME(8).
Table code and exit handling cleanup in pfctl(8).
Fix config file parsing of the ssh(1) AddressFamily option.
Make sendmail(8) use the system setreuid(2) instead of its own.
Add a 'real' mmap2() system call under Linux emulation, using the new MAP_TRYFIXED mmap(2) option so it works the way Linux does.
In ssh(1) force the host key alias to lowercase before matching.
Add SOCKSv5 support to ssh(1) with the -D option, as well as SOCKSv4.
Better ld.so(1) versioned library search algorithm.
Bump mktemp(3) randomness in lots of places from 6 to 10 'X's.
Allow newsyslog(8)'s -a option to archive across filesystems.
Add MAP_TRYFIXED option to mmap(2) to turn off heap address avoidance, which helps when emulating other OSes.
Remove the sys_omquery() compatibility system call.
Better umask safety check in security(8).
Stability fixes to siop(4).
Stop using mmap(2) in tail(1), fixes a variety of bugs and performance issues.
Fix a bad bounds check in the grep-without-regex part of grep(1).
Under-the-hood improvements to speed up m4(1).
Add some buffer management functions for pf(4) tables.
unifdef(1) fixes from FreeBSD.
Reset pf(4) interface statistics when the loginterface is changed (PR#3332).
Properly purge pf(4) tags when flushing bridge(4) filter rules.
Don't generate an icmp6 redirect if pf(4) rewrote the destination address.
Improve compress(1)'s gzip compatibility with silly configure scripts that expect 'gzip -h' to return success.
First pass at pf(4) normalisation of IPv6 packets. No fragment reassembly yet.
Improvements to the lm(4) hardware sensor driver.
Make compress(1) respond more usefully to gzip CRC errors.
Many manual page fixes and cleanups.
Fix some target probe problems in siop(4).
Unbreak string printing in locate(1).
Fix mdoc bug that put random blank lines into manpages. From NetBSD.
Better type checking for ssh(1) atomic I/O.
Don't give pfsync(4) interfaces an IPv6 link-local address.
sshd(8) now logs pidfile creation errors.
Allow ddb(4) to log output via syslog. Controlled via sysctl ddb.log.
Handle IPv6 neighbor discovery timers more quickly and with greater accuracy.
Make the installer mount all possible swap before creating devices, in an attempt to stop MAKEDEV bombing through lack of memory.
Make sure getanswer() (called by gethostbyname(3) etc.) doesn't stray past the end of its reply packet.
Remove a memory leak in arp(8).
Fix string cleanup breakage in siop(4).
Unbreak compress(1) gzip code on big-endian architectures.
Some more agressive string fixes in named(8).
Fix compress(1)' -t option.
Add kqueue support for ugen(4), uhid(4), usb(4) and uscanner(4). From NetBSD.
Fix pf(4) tag lookup for DIOCCHANGERULE.
Fix a subtle tag reference count bug in kernel pf(4).
Add alaw <-> ulaw conversion to the kernel ( alaw_to_mulaw(), mulaw_to_alaw() )
Check that the argument to "-o ProxyCommand" exists on the ssh(1) command line, instead of dumping core.
Add a simple static bounds checker to gcc(1). (See gcc-local(1).)
Switch diff3(1) and sdiff(1) to use libc getopt_long(3).
Add USD Beginners Guide document, and some historical papers.
Add USD docs for awk(1), ed(1) and sed(1), and PSD docs for m4(1), lint(1) (as xlint) and the ms macros.
Fix temp file handling and an off-by-one in BSD diff.
Fix isp(4)'s PCI probe.
Pad the osiop(4) script data scructure to 256 bytes to avoid cache problems.
Fix an endianness bug in an(4).
Add unified diff support to the BSD diff.
Have asn1_compile use arc4random(3).
Function prototype cleanup all over the tree.
New extensible bufq mechanism for manipulating buf queues, only in wd(4) for now.
Add -C option support (number of lines of context) to the BSD diff.
Fix some suspect type conversions in grep(1).
Allow bridge(4) to tag packets for later use in pf(4) rules. Oh yes.
Fix backwards arguments when seeking within gzipped files in grep(1).
Major cleanup (safe string functions, signal race avoidance) in the recently imported BSD diff.
Fix division-by-zeros in atapiscsi(4) that could occur when the system is unable to determine even the unit's blocksize.
Add diff program from 4.3BSD Reno. Much work to be done.
Add i386 a.out emulation for dynamic binaries.
Fix grep(1)'s -w option.
Make grep(1)'s -E, -F and -G options override the program name, and mutually exclusive.
Make fgrep functionality of grep(1) work.
Unbreak POSIX:: functions under Perl 5.8.0.
[Applied to stable]
Make pf(4)'s route-to option work for IPv6 link-local addresses.
Reintroduce some routing socket code (lost in a previous update) that could cause less-specific routes to be updated by mistake.
Lots of int -> u_int in ssh(1).
IPv6 neighbour discovery updates from KAME.
Avoid using regexes completely for simple string searches in grep(1).
Improve the compress(1)-based zmore(1) script and install instead of the GNU gzip version.
Teach kdump(1) about many more dev/, net*/ and crypto/ ioctls.
Remove the unnecessary (and broken) printf builtin from csh(1).
Don't use getopt(3) in printf(1) since this causes formats beginning with a hyphen to be interpreted as flags.
Add a simple zmore(1) script using compress(1).
Add pcmcia(4) and wi(4) support for sparc.
Install a host route for a point-to-point interface even if a connected net route via a broadcast interface exists (NetBSD PR 21903).
Check for nfds<0 in poll(2).
Better temp file handling in XFree's gccmakedep(1).
Temporarily work around a tables-related use-after-free in pf(4).
Improve grep(1)'s detection of binary files, and add/fix a number of compatibility options.
Improvements to the installer's handling of network settings when upgrading.
Remove ypserv(8) files without copyright information.
Install freegrep as {e,f,z,ze,zf}grep as well as grep(1).
Upgrade (non-GNU) grep(1) to freegrep 0.16.
Remove GNU grep and (most of) GNU gzip from the tree. BSD-licensed alternatives do the same jobs.
Reenable the ld.so(1) library load order randomiser, with fixes.
Make user filename selection in the installer more robust.
fflush(3) stdout when doing continuous queue monitoring with pfctl(8).
Add fine-grained counters for pf(4) state entries, allowing for traffic reporting via pfsync(4).
Add per-process exec/fork/exit hooks, use them the fix up brk(2) under Linux emulation, and so fix Java.
Add MSS support to pf(4)'s synproxy.
Initialise properly before calling getusershell(3) in su(1).
More helpful pf(4) BAD ICMP debug message.
Make isakmpd(8) print some log messages when giving up on a response to the last message.
Use _PW_NAME_LEN instead of a hard-coded 8 char username limit in top(1).
Remove roll-your-own string functions from top(1).
Have comsat(8) use fseeko(3) instead of fseek().
rpcgen(1) now generates much prettier ANSI C code.
Back out the recent xdm(1) '-nolisten tcp' change.
Plug some memory leaks in popa3d(8) and systrace(1).
Strip the newline from user input when requesting a continuation filename in restore(8) (PR#3324).
Fix a bug that condemned fortune(6) to be always inoffensive.
Have bpf(4) return ENOBUFS on malloc(9) failure instead of causing a panic (PR#2235,PR#2236,PR#2640).
Make m4(1)'s handling of builtin and user macros more consistent, and allow pushdef to work for builtins.
xdm(1) now passes '-nolisten tcp' to Xserver(1) by default for local display :0.
Re-enable UDMA mode 5 for HPT370A pciide(4) devices, now that timing and interrupt problems are fixed.
Fix a sizeof oops that broke less(1)'s -N option.
hme(4) now advertises its VLAN capability.
Properly display no-route addresses when expanding label macros in pfctl(8).
Back out the recent ssh(1) smartcard key fix, it violates PKCS#1.
When the expansion of the $srcaddr or $dstaddr label macro is a table, have pfctl(8) print the table name instead of garbage.
Unbreak vmstat(8) on diskless machines (PR#3322).
Relax rtadvd.conf(5) syntax, removing the need for the addrs option.
Use getifaddrs(3) in amd(8), fixing the 'wire' location selector.
Return the correct error message if the user tries to kill a non-existent process from top(1).
Add a few missing dead-key composition entries (PR#3295, with an entry for cedilla as well as for double-quote).
Avoid a null deref in cnkqfilter() (/dev/console kqueue(2) crash, PR#3317).
Fix a logic bug in mtree(8) that was making -U return an error just like -u.
Make ssh-add(1) redisplay the key comment when prompting after a bad passphrase.
Fix "bad decrypted len" errors in ssh(1) when using smartcard-stored public keys (OpenSSH bug 592).
Updates for systrace(1), support freeing of old policies and escaping of special characters.
Better byte-swapping behaviour in dc(4), fixing mac address reads on big-endian architectures.
Make dhclient-script(8) fix up resolv.conf(5)'s permissions.
Stop isakmpd(8) losing ID information when rekeying.
Add new '-c class' option to encrypt(1), which will use the login class to select the password cipher.
Fix kqueue(2) on ptys (PR#3209).
In user(8), only check login class validity when the login class is set.
Fix some sizeof oopses in top(1).
Allocate cleared memory for isakmpd(8) payload buffers.
Fix pf(4) TCP state checks when using a combination of asymmetric window scaling and SACK.
[Applied to stable]
Add __LP64__ and _LP64 cpp(1) predefined macros for alpha and sparc.
Sync em(4) with FreeBSD updates and enable on sparc64.
Add -0 (zero) flag to pax(1) allowing the filename separator to be a NUL instead of a newline (PR#3310).
In xargs(1), don't close the descriptor we just created with dup2(2).
security(8) allows dots in usernames consistent with user(8) changes.
pfctl(8)'s show anchor command now respects the 'quiet' flag.
Make dhclient-script(8) respect symlinks.
Remove obsolete Rijndael code from libcrypto.
Support more Intel Fast Ethernet and Gigabit Ethernet cards.
Use real varargs in top(1) instead of hacking it.
ssh(1) and ssh-agent(1) now use the key label from a PKCS#12 cert if one is available, instead of just showing 'smartcard key.'
Stop security(8) complaining about usernames ending in '$'.
Speed up m4(1) traced macros, helps with recent GNU autoconf.
Make queues work on tun(4) interfaces. Not recommended (should assign to tun, then queue on physical interface) but sometimes necessary, e.g. for pppoe(8).
In pfctl(8) don't apply a netmask to an interface name.
[Applied to stable]
Allow the kernel to compile with NFS but without FIFO.
POSIXify xargs(1), mostly from FreeBSD.
Much ansification and de-registering.
Add NAT-T dump support to tcpdump(8).
Make ssh-agent(1) lifetime and confirmation features work with smartcard keys.
Build bs(6) and hunt(6) again now that they have good licenses.
Add option MFS to the kernel on several architectures, to fix upgrade breakage.
Some RFC3542 Advanced Sockets API for IPv6 updates.
Add an ARM target for gcc(1).
De-uglify dhclient-script(8), and (mostly) fix resolv.conf(5) update problems.
Allow zero intervals in newsyslog(8) config files.
Fix a missing initialisation in pf_test() and avoid random state table additions.
Add login class support (-class option) to adduser(8).
rmail(8) now tells sendmail to deliver in the foreground.
Make rmail(8) pass the -G flag to sendmail(8) as expected.
Install rcs2log(1) properly (PR#3298).
In user(8) check that a login class exists before using it (PR#2699).
user(8) changes from NetBSD:
useradd(8) and usermod(8) now check that the encrypted password length is correct.
Log user and group modifications via syslog.
Pickier command line option checks.
When deleting a user including the profile, remove all references to that user from /etc/group.
Checks that a group is in the local files (not from YP) before attempting to modify it.
Don't allow /dev/crypto to be opened at all if the kernel is compiled without the CRYPTO option.
[Applied to stable]
Make mount(2) return EROFS instead of EPERM when trying to mount a dirty filesystem.
Make isakmpd(8) more robust when faced with unknown ID types.
[Applied to stable]
Change the timer pthread uses, allowing threaded apps to be profiled.
Allow newsyslog(8) to detect negative numbers in pid files.
Stop sudo(8) busy-waiting when waiting for sendmail(8) to do its work.
Better CDDB input checking for cdio(1).
Make the byte order more uniform in the pf(4) nat code.
Back out tcp_trace IPv6 changes and fix PR#3283.
Stability fixes for siop(4) when under heavy load.
[Applied to stable]
Allow user(8)'s -e and -f to accept both month-day-year and seconds-since-epoch times. From NetBSD.
Detect oversized usernames in pwd_mkdb(8).
Check for oversize group names to user(8) and fail the command.
Fix an off-by-one in user(8).
m4(1)'s patsubst command now accepts null patterns. This appears to fix GNU Autoconf 2.57.
A pf(4) table on an anchor rule creates a real anchor, so pfctl(8) works the way one expects.
Stop pfctl(8) (with the -ss option) printing IPv4 address/netmask pairs as a.b.c.d/128.
Have identd(8) run by default as user _identd if possible, and fall back to user nobody if that fails.
Replace setjmp/longjmp in less(1) with interruptible system calls.
Avoid a null deref in fontconfig(3) when $HOME is not set.
Fix the addition of /usr/local/lib/X11/fonts to /etc/fonts.conf.
Don't use M_WAIT in atalk(4).
Don't forward IPv6 multicasts to an interface that's no longer around to receive them.
Add large file support to distrib/special/more.
Teach distrib/special/more how to handle arbitrarily long lines and \r\n line endings.
Set rusers(1)' column width to 80 if stdout isn't a tty.
Add generic '-fno-builtin-<function>' option to gcc(1) (see gcc-local(1)).
Kill the parent ssh(1) process when scp(1) or sftp(1) receive a signal (OpenSSH bug 241).
Only drop setgid privileges the once in sshd(8).
Disable ssh(1) challenge/response and keyboard-interactive authentication methods if there's a host key mismatch, to reduce the likelihood of MiTM attacks catching out ignorant users (OpenSSH bug 580).
Make less(1)'s --More-- prompt more --less--, less More, and more POSIX.
Fix distrib/special/more on machines with unsigned chars.
Simply and fix tty handing in /distrib/special/more.
Stop event(3) honouring EVENT_NOKQUEUE when running set[ug]id.
Disable the ld.so(1) library load order randomiser, it seems to be exposing bugs elsewhere.
Provide a fast path for userland crypto(9) requests, bypassing the kernel queues where possible.
Add some tag-related utility functions in kernel pf(4).
In pfctl(8) process 'show' options before options that change the rulebase.
Huge license cleanup all over the tree.
Fix random lockups of cac(4) devices.
[Applied to stable]
Deprecate the dangerous VerifyReverseMapping sshd(8) option, and replace with new UseDNS option (enabled by default).
Install OpenSSL include files in /usr/include/openssl instead of ../ssl.
Remove the advertising clause from many license statements.
Use getopt_long(3) for getopt(3), instead of the old implementation.
Remove a potential double-free from systrace(1).
Fix a bad string bounds check in libedit.
String cleaning bootblocks for all architectures. Now only bind and src/gnu use unsafe string functions.
Fix a few long-missing initialisations, so we don't end up using random stack noise as a hint to uvm_map(9) via uvm_km_suballoc().
Improve ddb(4)'s symbol table lookup algorithm.
Properly mask off all but the last 8 bits of status in WSTOPSIG and WEXITSTATUS.
Add preliminary LBA support to the i386 bootloader.
Build a dynamic com_err(3) library.
Add pmdb(1) to the default build.
Fix timeout signedness bugs in brconfig(8) and bridge(4).
Some deeper string cleaning in bind9.
Stop pmdb(1) dumping core when the program to be run doesn't exist.
Add LD_NORANDOM to the list of environment variables that get zapped when running setuid/setgid.
Load dynamic libraries in random order, to reduce the probability of an attacker guessing the address of the loaded code. Define LD_NORANDOM to disable.
Make dhclient(8) more robust by accept non-DHCPNAK messages with yiaddr=0.0.0.0, as sent by some common DHCP servers that ignore the RFC.
[Applied to stable]
Reorder the sections in many manpages.
Use sete[ug]id(2) as well as set[ug]id() in ssh(1) when doing privsep and when permanently setting the [ug]id.
When setting the tcp6 mss, fetch the link mtu using IN6_LINKMTU() (which takes neighbour discovery mtu settings into account) instead of always using the interface mtu.
Allow numeric uid and gid in systrace, and '<' and '>' operators for ids.
Add support for IPv6 jumbograms.
Fix some bugs IPv6-related bugs in tcp_trace().
Incorporate distrib/special/more's helpfile into the program itself.
Fix the endianness of fxp(4)'s statistics for netstat -i.
Fix tab expansion, handle EDITOR not being a full pathname, and much cleanup in distrib/special/more,
Add pthread support for vax.
Don't risk an M_WAIT deadlock when processing raw IP output.
Make libwrap check for bogus PTR records containing numeric IP address in string form.
Make df(1) use the new fmt_scaled(3) stuff in libutil.
Fix a few bad *printf format strings in ssh(1).
Install the mod_ssl headers under /usr/lib/apache/include/
Add IPv6 support to trpt(8).
Fix xdm(1)'s XDMCP queries (XFree86 bug #277).
Unbreak pf(4) binat rules after recent netmask check changes.
Improve pfctl(8)'s netmask validity check.
Have pfctl(8) properly free buffers and initialise pointers when working on tables.
Push ssh(1) syslog output through strnvis(3) first.
Fix an fdset leak in ssh(1).
Remove unsafe sprintf(9) and vsprintf() functions from the kernel.
Ignore media changes for the first command issued to an sd(4) device. See the checkin comment for details.
Match kernel vprintf(9) prototype to that of userland.
Have getconf(1) return _POSIX_PATH_MAX instead of _POSIX_PIPE_MAX when asked for the former.
Now that kernels are built with propolice, build modules with it too.
New hardware monitoring sensors driver it(4).
Fix endianness problems in dc(4) that caused multicast reception to fail when using Centaur chips.
Add a missing initialisation in altq HFSC.
Add read-only NTFS support, ported from NetBSD. Not enabled in GENERIC.
Add a flag to reverse the stereo on auich(4).
Limit the return value of nice(3) to -NZERO  nice  NZERO, where NZERO=20.
Make pfctl(8) fail hard when fed invalid hostnames and netmasks.
Many games fixes from NetBSD.
Allow the i386 and hppa bootloaders to skip the interactive portion altogether.
Fix a badly broken switch statement affecting SO_DEBUG in tcp_input.c.
Stop lpr(1) from checking if the printed file is an executable. Leave this to lpd(8) filters.
Use a decay filter to get better altq throughput statistics out of pfctl(8).
In ssh(1)'s do_log(), use syslog_r(3) in code that can be called from a signal handler.
Severely restrict the paths that privsep isakmpd(8) can read from and write to.
Use sockaddr_storage instead of sockaddr in isakmpd(8) to fix interface rescanning.
Keep X.509 private keys only in the privileged part of privsep isakmpd(8).
When using the pf(4) SYN proxy, make sure ACKs are sent with the correct window size.
Wait longer for slow USB devices to be ready for attachment.
Don't build libperl in the libraries pass of 'make build', as we want Perl's configure to pick up details of the libraries that the build may be changing. Another leapfrog-in-waiting.
Add regen target in libkrb5 to remove (again) the dependency on an up-to-date asn1_compile.
Complain more consistently about a missing 80-wire IDE cable (for UDMA mode > 2).
In syslogd(8) don't use strlcpy(3) when printing strings out of struct utmp, since those strings aren't null terminated.
Don't ARP for our IP address aliases, treat them as local.
Merge in a number of USB SCSI device updates from NetBSD.
Add experimental support for aes-ctr ssh(1) ciphers.
Apply some of the USB SCSI improvements to the FireWire code as well.
Add string length bounds to an sscanf(3) in ssh(1)'s rhosts auth code.
Pull in a fix for directory creation under systrace(1).
Fix pf(4) rdr rules with address pools using bitmask and source-hash address selection.
[Applied to stable]
Allow inverse matching of pf(4) tags.
Fix media handling for Intel dc(4) devices.
Use the right buffer in spamd(8)'s connection handler.
Use mmap(2) instead of malloc(3) in vfprintf(3) when more memory is needed to store arguments. See the checkin comment for why.
New Renegotiate-on-HUP option for the [general] section of isakmpd.conf(5) will cause all Phase 2 SAs to be renegotiated.
Fix a couple of signedness nits in ksh(1).
Improvements to USB SCSI support.
Fix mg(1)'s up and down cursor movement.
Have ksh(1) use the libc dup2(2) instead of its own.
Fare thee well, Kerberos IV.
Another big-bucks firewall feature performed by pf(4): TCP SYN proxy, enabled with 'synproxy state' (this implies modulate state).
New AddressFamily option for ssh(1) that works like the -4 and -6 command line options (portable OpenSSH bug 534).
Allow address comparison in wi(4) to work on sparc64.
Prevent a spamd-setup(8) crash with a config file consisting of only invalid input.
Don't assume that rt->rt_ifp is valid in IPv6 neighbour discovery.
Add new ConnectTimeout option to ssh(1).
Disable Kerberos options to ssh(1) programs if Kerberos isn't compiled in, and warn if they're used.
Have 'ssh -V' print the OpenSSL version properly, instead of trying to %s on a long.
Repair IPsec forwarding for IPv6, fixing PR#3231.
Fix a hang in libwrap when the hosts_access(5) file has a line containing > 2048 characters. (NetBSD pr#15025.)
Add multi-column output to the ls command of sftp(1).
Wash untrusted input to mail(1) through vis(3) before display.
In isakmpd(8), don't store the private key in data structures we pass around a lot.
Fix a missing freerrset(3) in new ssh(1) dnsfp code.
New fmt_scaled(3) and scan_scaled(3) functions in libutil, for writing and reading numbers with human-readable scales.
Like for sysctl(8), add a -q option to shut mixerctl(1)'s -w option up.
Preliminary privilege separation support for isakmpd(8), not enabled by default for now.
Fix deregistration of per-authentication method handlers in ssh(1).
In faithd(8) specify IPPROTO_TCP explicitly in anticipation of a day when getaddrinfo(3) supports sctp.
Prepare to move all KerberosV libraries to /usr/lib.
More TCP scrubbing: Modulate TCP timestamps to frustrate NAT detection and prevent remote uptime guesses. New scrub option 'reassemble tcp'.
Kill more unwanted le(4) 'lost carrier' moans.
Remove the rather short-lived kernel option LONGRUN, it's now standard except SMALL_KERNEL is defined.
Enable pf(4) tagging support for rdr and binat rules.
Add _isakmpd user and group for isakmpd(8) privsep.
Allow ssh(1) clients to send a BREAK to the remote server if it supports it (SSHv2 only).
Add _kdc and _kadmin users and groups for the respective KerberosV kdc(8) and kadmind(8) daemons.
On i386, support Transmeta LongRun power management (kernel option LONGRUN, enabled by default).
Add a pf(4) tag for each rule that matches, not just the last one.
Remove gated stuff from /etc/rc and /etc/rc.conf.
Add experimental support for ssh(1) host key fingerprint verification using DNS records (dnsfp). Not built by default. See src/usr.bin/ssh/README.dns for details and build instructions.
Unbreak malloc(3) map_pages() failure test on 64-bit architectures.
Back out many recent isakmpd(8) changes until they're working right.
Disable KerberosIV support in XFree.
Make sure ssh(1) privsep children die when the monitor parent goes away (OpenSSH bug 560).
Upgrade pflogd(8) to use the new bpf(4) link type too.
Teach tcpdump(8) and libpcap about the new pflog(4) link type in bpf(4).
Upgrade bpf(4) support for the pflog(4) link type to the 'official' and more extensible version from the libpcap people.
Start stripping out KerberosIV support from programs.
When handling a numeric nodename in getaddrinfo(3), set the canonical hostname to the numeric address as per RFC3493.
Make vis(3)'s VIS_SAFE behaviour match the manpage w.r.t isgraph(3).
Allow tags to be specified for pf(4) block rules (which aren't allowed to keep state).
Allow the pf.conf(5) scrub keyword to take a protocol specifier again.
Remove KerberosIV support from KerberosV code.
Add packet tag support for pf(4) nat rules.
Correct a string length problem and a missing null init in libreadline.
Add kerberos-over-ssh2 support to ssh(1).
Reapply the move of Ethernet definitions to <net/ethertypes.h>, but this time have <netinet/if_ether.h> read them in for compatibility reasons.
New -q flag for sysctl(8) to suppress output from the -w option.
Fix a circular dependency by removing libtelnet, instead compile the code directly into telnet(1), telnetd(8) and tn3270(1) from files in libexec/telnetd.
Move contents of libkafs into libkrb5, leave libkafs as an empty dummy library.
Fix a use-after-free in the new pf(4) tagging code in the kernel.
Enable the increasingly popular em(4) driver by default on i386 RAMDISK* kernels.
Sync rdist(1) with freerdist version 0.92, minus the compress option.
Don't build KerberosIV programs. Libraries still built for the moment.
Move blktochr() and chrtoblk() into kernel MI code.
Add [bc]devsw_lookup() kernel convenience functions.
In pfctl(8) make sure packet tagging is only used on stateful filter rules.
Add NO_PROPOLICE kernel config(8) option to build the kernel without the stack protector. Handy for install media.
Fix a string length off-by-one in libreadline.
Add userland portion of pf(4) packet tagging support.
Disable afs until it can be made to work sans KerberosIV.
Force global 'time' structure to be quad_t aligned, unbreaking sparc microtime(9) and possibly other things too.
Add support in kernel pf(4) for tagging packets, and filtering based on those tags.
New mbuf(9) tag PACKET_TAG_PF_TAG.
Make sure lndir(1) doesn't try to use -1 as an array index when reading a directory.
On ELF architectures, support the blocking of thread switches during non-thread-safe dynamic loader operations.
Sync ELF identification indexes with the System V ABI specs.
Stop AM7990 (le(4)) devices emitting 'lost carrier' messages.
Back out <netinet/if_ether.h> changes after they caused userland meltdown.
Add propolice stack-smash protector support to the kernel, and build the kernel using it on architectures that support propolice.
Re-enable NULLFS, UMAPFS and UNION in the GENERIC kernel.
Move Ethernet definitions from <netinet/if_ether.h> to new <net/ethertypes.h>, like NetBSD.
Disable Kerberos V-to-IV conversion in login_krb5(8) and login_krb5-or-pwd(8)
Stop building login_krb4(8) and login_krb4-or-pwd(8).
Remove references to krb4 from login.conf(5).
Changes to the way protection fault traps are handled on i386, see the checkin comment for details and Intel abuse.
Merge in Heimdal KerberosV 0.6.
Stop user(8) from accepting usernames beginning with a slash.
Don't report unsupported scsi(4) devices as offline.
When testing TCP window sizes in pf(4), don't apply the window scaling factor for SYN packets. Do, however, apply the scaling factor when testing ACKs.
Fix a bug in pkg_add(1) that was causing recursive dependency searches to fail.
More isakmpd(8) definitions for NAT-T, IKEv2 and EAP.
Locking and other fixes to unionfs.
Add BLOCK_SIZE attribute to isakmpd(8), and rename AES ESP transform to AES_128_CBC.
Add UDP encapsulation type definitions (not code) to isakmpd(8) with an eye to future NAT-T support.
Adapt nullfs and umapfs to use common code from genfs.
New genfs code for layered filesystem support.
Wash print queue names through vis(3) before output.
Teach ctags(1) to understand '//' comments, ignore declarations of function types, and accept __attribute__. From NetBSD.
Correctly check for empty output from an at(1) command (PR#3252).
New ddb(4) command 'show proc' which, er, shows process information.
Sync popa3d(8) to version 0.6.2.
Improvements and bugfixes to the installer's handing of ftp and http downloads.
Reorder pf(4) IPv6 address comparison to check the least-significant bits first, since these are more likely to differ.
Make sure the state search trees are properly in initialised when attaching pf(4).
Remove a number of KerberosV files that are not used by OpenBSD.
When doing pubkey authentication in ssh(1), prefer agent-stored keys that are referred to in the config file. This can reduce the likelihood of the server disconnecting before it gets to a valid key when the agent is storing many keys.
Start preparations to remove KerberosIV.
Remove a number of redundant declarations in games/. From NetBSD.
file(1) now recognises Ogg Vorbis audio files.
Use the asn1_compile in src/usr.bin instead of that in src/kerberosV.
More string fixes to libreadline, this time with no ABI changes.
Fix a sign overflow in csh(1).
Merge in OpenSSL 0.9.7b (without IDEA, MDC2 and RC5).
Implement adaptive state table timeouts in pf(4), reducing the state timeout value inversely with the number of states present.
Break asn1_compile out from KerberosV into src/usr.bin.
First phase of pf(4) stateful TCP scrubbing: Frustrate TTL-based NIDS evasion by determining on the fly the highest TTL, and enforcing it as the minimim TTL for all subsequent packets.
In ssh(1), Do the xstrdup() of the remote_name inside channel_new() instead of making the caller do it.
Start to fix the annoying asn1_compile leapfrog problem when upgrading KerberosV by putting the generated files into the tree.
Make sure a hole at the end of a sparse file created by install(1) actually gets written on all filesystems.
The installer now accepts absolutely absolute paths (relative to the installer's root directory, not the virtual mountpoint) for local sets.
Make ssh-keygen(1)'s -e option fail gracefully if the user specifies an SSH1 key. (NetBSD pr#20550.)
Avoid offence to Klingons by spelling 'Kang' correctly.
Merge in Heimdal KerberosV 0.6rc1.
Since mfs doesn't try to force an unmount on receipt of a signal, there's no need to try to fix up processes' working dirs - the unmount(2) will fail.
Fix isakmpd(8)'s handling of the IPV6_ADDR ID-type.
Remove an unnecessary ntohs(3) in pfctl(8), unbreaking 'nat ... -> $if port n' rules.
The pf(4) return keyword now generates an ICMP unreachable message for all protocols other than TCP (rather than just UDP and ICMP).
Have the compiler generate warnings if unsafe string functions are used in the kernel.
Back out libreadline string fixes until static build works.
Consign swapon(2) to COMPAT_25 in favour of swapctl(2).
Clear unused and/or invalid globals in authpf(8) to prevent confusion.
Update authpf(8) to spot (and reject) the new 'load...from' syntax.
Support loading of anchors from the main pf(4) ruleset with new syntax 'load anchorname:rulesetname from filename'.
Allow for the null-terminator when calling strlcpy(3) in gcvt(3).
Remove a number of unnecessary executable mappings in the kernel, e.g. framebuffers and page tables don't really need to be x.
Add sha2(3) digest support to libc.
Clear libc digest buffers allocated on the stack with memset(3) before returning.
Move setrgid(3) and setruid(3) from libc to libcompat.
Move insque(3) and lsearch(3) and remque(3) from libcompat to libc, since they are now POSIX functions.
Don't leak socket fds in pfctl(8) queue code, otherwise we can hit the file limit if many queues are defined.
Fix a number of readlink(2) calls that forgot to leave space for the null-terminator that needs to be added manually.
Update sudo(8) to 1.6.7p5.
Add support for the userland portions of XFree86 DRI. Not yet enabled by default.
In csh(1), null-terminate the string returned by readlink(2) before passing it on.
Fix mmap(2)'ing of the dynamic linker hints file when the file size exceeds one page.
[Applied to stable]
Stop gcc(1) from inlining strcpy(3) so it can be more easily spotted in object files.
Add missing device name parameter when printing a nofn(4) RNG underflow error.
Fix a bad sizeof() in xedit(1).
Fix some sscanf(3) off-by-ones in makepsres(1).
Remove a string memory leak in ld(1).
Change xclock(1)'s default behaviour back to -norender.
Fix a few instances of sizeof(pointer instead of object) in expand(1), lbxproxy(1), skeyinit(1) and in the Kerberos IV and BIND libraries.
Plug a memory leak in the kernel ELF loader.
In the installer, give the -h option to tar(1) so symlinks on the existing system are honoured.
Make lynx(1) try active FTP if passive mode fails. This was missed out in the recent upgrade.
Have rdist(1) use POSIX regex(3).
Update rdist(1) to cope with rcmdsh(3)'s new ability to handle command line options.
Make pf(4) rdr and binat rules work again on protocols other than TCP, UDP and ICMP.
[Applied to stable]
After a forced unmount, try to change process back into real directories now that namei() won't do lookups under the old mountpoint.
Stop namei() doing lookups on unmounted volumes, prevents crashes with forced unmounts. From NetBSD.
Don't use M_WAITOK to sleep on failures when allocating hashtables for IP protocols (in_pcbinit()). Fail and panic.
Pretty up sysctl(8) display units for hw.sensors.
Only do setusercontext(3) in skeyaudit(1) when running as root.
Don't use string functions on non-strings in sd(4).
Kill a small asprintf(3) memory leak in mg(1).
In skeyinfo(1), convert the username to seven-bit before doing the skeylookup(3).
Make the fsirand(8) functionality built into newfs(8) non-optional.
Allow command-line arguments in rshprog passed to rcmdsh(3).
Add backquote to the list of characters escaped in ksh(1)'s vi-{esc,tab}complete mode.
Fix a couple of sscanf(3) off-by-ones in afs and makeinfo(1).
Write the correct amount of data when disconnecting tip(1) on biz22.
Another memory layout change on i386 to allow a larger MAXDSIZ (see the tech@ archive for details).
Add a mail mode to mg(1) that does proper line wrapping, and add the '-f' command line option to set the mode.
Properly restore the syncer vnode if unmount(2) fails.
Use the right buffer size for getcwd(3) to avoid unnecessary truncation in at(1).
Replace local (and wrong) basename logic in ln(1) with a call to the real basename(3).
Don't leak an mbuf when dropping non-ARPHRD_ETHER arp packets.
[Applied to stable]
Compatibility improvements to ossaudio(3), mostly from NetBSD.
Ditch newfs(8)/mount_mfs(8)'s homespun malloc() in favour of mmap(2).
Prevent a couple of use-after-frees in pfctl(8).
Defensively zero the m_flags field in mbuf(9) structures allocated on the stack.
Make what(1) more POSIX-compliant.
Stop skeyaudit(1) leaking file descriptors in -a mode, and be more paranoid about stdin, stdout and stderr.
Add Doug Gwyn's portable alloca(3) on platforms for which no assembler version yet exists, and use instead of gcc(1)'s alloca().
Greatly improved SIS chipset support in pciide(4).
Make eso(4) work on sparc64 and (probably) macppc.
A number of vnode(9) fixes and additions. See the checkin comment for details.
Update lynx(1) to 2.8.4release, patchset 1d, including IPv6 support.
Allow pf(4) antispoof rules to have labels.
Keep trying to unbreak apachectl(8) restarts for shared modules when running under the chroot.
Improve forward compatibility of fsck_ffs(8) by comparing only what we understand instead of trying to ignore what we don't.
Make the newly deprecated omsync() work under NetBSD emulation.
Several strvis(3) -> strnvis(3) changes, all part of the continuing Battle for Safe String Functions.
Fix some pthreads signal bugs that were causing MySQL to crash (PR#3179, PR#3238).
[Applied to stable]
Allow pf(4) tables to be loaded into anchors. pfctl(8) table options except show and flush now honour -a.
Have the dynamic linker stub functions in libc return -1 if called from a statically linked program.
Only build shared libXv if the target arch supports shared libraries.
Consign the omsync() system call to COMPAT_25 obscurity.
Fix parsing of the noac option to mount_nfs(8).
In netinet/tcp_input.c, correct a long-standing typo made when applying a deadlock-avoidance bug fix (TCP/IP Illustrated volume 2 fig. 28.30).
Fix a crasher in lkm(4), tripped when loading a module twice.
Make ELF dlfcn(3) calls thread-safe.
Add /usr/local/lib/X11/fonts to fontconfig(3)'s search list, to help ports.
Add some missing X server key definitions.
Re-introduce the mquery(2)-has-mmap(2)'s-signature change, once again renaming the old syscall to omquery().
Only close the keyfile once in skeyaudit(1) -a mode.
Do a return from main() instead of an exit(3) in md5(1) and spamd-setup(8),
Fix some more unbounded sscanf(3) calls in KerberosIV, still more to come.
Lock earlier when doing vnode ops in procfs to avoid a possible race condition.
Remove a potential double-free in the XFree wsfb driver.
Prepare pf(4) table structures for anchor support.
Much string cleanup in sys/dev.
Fix the isakmpd(8) fifo 'C set' command (PR#3148).
Use strdup(3) and asprintf(3) to eliminate some string length guesswork in rpcgen(1).
Allocate enough space for a *printf() %u in rpc.yppasswdd(8).
Correct libXp's shared library dependencies
Fix fat32 filesystem corruption when renaming directories.
New lm(4) (National Semiconductor LM78, LM79 and compatible) and viaenv(4) (VT82C686A South Bridge) hardware monitor drivers, adapted from NetBSD to use the new sysctl hw.sensor interface.
Make funopen(3)'s declaration match its prototype (PR#3236).
Back out the recent mquery(2)-uses-mmap() API change.
Add new sysctl(3) node hw.sensors for, er, hardware monitoring sensors.
Don't assume that asprintf(3) failures won't clobber the tempfile name in mktemp(1).
In the IPv4 case of inet_net_pton(3), infer the netmask the same way for all address classes (i.e. don't assume multicast networks are always */4).
Be more portable and check the asprintf(3) return value against -1 in pfctl(8).
Add size bounds to sscanf(3) strings in edquota(8) and tn3270(1).
Match mquery(2)'s function signature to that of mmap(2).
Fix pf(4) nat proxy port allocation for manually specified ranges.
[Applied to stable]
If one is given, properly copy the second port of a nat proxy spec in pfctl(8).
Fix a bad strlcpy(3) bound in the AFS library (PR#3228).
Use asprintf(3) to fix some buffer length problems in pdisk(8/MAC68K)
When handling the packet size option in traceroute(8), bounds check the right variable.
Properly detect EOF when generating policy interactively.
Stop pflogd(8) generating syslog messages on startup.
Swap a strchr(3) for a strrchr(3) in md5(1).
When upgrading, treat the /altroot filesystem like a 'noauto' filesystem and omit it from the upgrade fstab.
Do a proper bounds check when reading in the lynx(1) news server name from a file.
less(1)'s glob now does tilde and brace expansion as well.
On gre(4) IP input, use m_pullup(9) instead of assuming the header is in the first mbuf's data region.
Have make(1) stop parsing command line arguments after a '--'.
Better bounds checks when expanding curly braces in make(1).
In ld.so(1), don't set the object load_size field to a negative value because this is likely to be wrong.
Copy the null at the end of the name when adding a realm in Kerberos V.
Make authpf(8) die the way it should when authpf.conf is missing (PR#3217).
Fix ubsec(4) output statistics.
Sync sudo(8) with its CVS and bump the version to 1.6.7p4.
Some typedef perfectionism in libwrap.
String cleanup and extra paranoia in rd(4) and vnd(4).
The string cleanup drive continues.
Add support for the Davicom DM9009 chip to dc(4).
Help ld.so(1) further by making mquery(2) return EINVAL (instead of ENOMEM) if MAP_FIXED was requested but is unavailable.
New -x option for mount_msdos(8) to automagically make directories executable if they're readable.
Unbreak Emacs 21 by fixing a problem with the new mquery(2) part of ld.so(1).
Make tun(4) work when only IPv6 endpoints are specified.
Add 4.3BSD's more command for use on some floppies instead of less(1). More is less.
Change some return values in config(8) and cron(8) from char to int.
Changes to support the new i386 W^X scheme.
Move i386 to ELF, a binary upgrade is required for now.
Use the new mquery(2) syscall in ld.so(1), i386 only for now.
Avoid teeth-gnashing delays by making the installer use 'route -n show' instead of 'route show'.
In the kernel ELF loader, use the uvm(9) to make sure that ld.so(1) doesn't overwrite an area that's already in use.
Fix a buffer overflow that was causing a crash in mg(1) (PR#3090).
apachectl(8) now honours $httpd_flags from rc.conf(8).
Remove a race condition in mount_mfs(8).
Fix some allocation bugs in mg(1).
In the kernel's standalone ISO9660 driver, collapse extra slashes in the pathname. This allows files to be loaded from the root of a cd.
Uncomment the line that unloads httpd(8) shared modules on a server shutdown or restart.
Many string fixes to named(8), more to come.
pfctl(8) can now display basic HFSC stats.
Much cleanup in elf2ecoff(1) (not installed by default).
Allocate the right getaddrinfo(3) buffer size in rip6query(8) and route6d(8).
In audioctl(1), size(1) and spamd(8), don't use snprintf(3)'s return value for pointer arithmetic.
Back out the 'long ATAPI detection delay' fix due to problems with some devices.
Add a missing globfree(3) in sftp(1).
Correct a number of short space allocations for *printf() integer-to-string conversions.
Fix some problems with the xdm(1) OpenBSD logo, caused by the XFree86 4.3.0 merge.
Don't increment the ping(8) sequence number until we know the packet has been successfully queued for sending.
Include the at(1) job number in the process title.
Put less(1)'s help text back into a separate file, and allow a reduced-size build for the boot floppies.
Stop using hardcoded SOCK_* types when creating sockets in ssh(1), to facilitate ssh-over-sctp.
Have isakmpd(8) unlink its fifo and pid file on a clean shutdown (PR#3199).
Allow ping(8) to send zero-length packets with the -s0 option.
Some snprintf(3) buffer length fixes in isakmpd(8).
Add new mquery(2) system call, to provide hints (especially to ld.so(1)) on where to put memory mappings.
Make sure systrace(1) leaves space for the trailing null when displaying open(2) flags.
Fix bad format strings in extattrctl(8) and mopd(8).
Prevent timeout_add(9) from wrapping around on machines with a long uptime.
Fix some bogus size_t values in grops(1) and mg(1).
Update less(1) to version 381.
Have spamd(8) set file descriptor limits with setrlimit(2).
Relax the license on strlcat(3) and strlcpy(3) to encourage their bundling with other programs.
Initial support for HFSC queueing, pf(4)-style.
Back out recent 'X looks like a package' stuff.
Merge in expat-1.95.4 from XFree86-current.
Fix long delays when detecting ATAPI devices.
sudo(8)'s Makefile now honours the LDSTATIC flag.
Move queue ID assignment into the kernel and away from pfctl(8), solving a bunch of problems.
Back out the earlier fix for PR#2230, which is a no-op since zombies aren't on the allproc list being scanned.
De-allocate bus space on wi(4) device failures.
Only print the less(1) -d prompt if there's enough space left on the status line (PR#3189).
When fixing up process root and working directories after a filesystem mount, leave zombies well alone. (PR#2230.)
Fix an off-by-one in kernel malloc(9) diagnostic code.
Correctly initialise xkb memory in the X server.
Plug some file descriptor leaks in xman(1) (PR#3186).
Fix a broken sizeof() in gcc(1) when allocating a new sentinel_info.
Demote the isakmpd(8) 'missing CRL dir' moan to a debug message.
The kernel pf_state structure now points to both a rule and an anchor, so states created on anchors can use rule options properly.
Create the /etc/isakmpd/crls directory from 4.4BSD.dist to stop isakmpd(8) complaining about its absence.
Strip trailing whitespace before parsing ssh(1) options (OpenSSH bug 528).
Disable ssh(1)'s Kerberos IV support.
Fix spamd(8)'s select(2) error handling.
mg(1) now remembers the previous 'M-x compile' command.
Add a missing free() in httpd(8)'s dbm processing.
More fixes to osiop(4).
Change some old-style chown(8)s (user.group) to POSIX user:group style.
Fix a null deref in savecore(8).
Add some missing NetBSD copyright information to ftp(1).
Make ktutil(8) work properly over the network.
Improvements to string handling (not str[ln]* for once) in adventure(6).
Add fake package information so ports can check for XF4 installation.
Use ksh(1) instead of csh(1) for XFree distrib scripts.
Make pfctl(8) reject invalid ICMP types (>40) and codes (>255).
Fix a typo in the new ssh(1) rekeying code that was causing the wrong packet state counter to be fetched.
Update sudo(8) to 1.6.7p3.
Handle buffer length for strlcpy(3) properly in kvm_mkdb(8).
Many fixes to osiop(4).
Improve (as part of string function fixes) sort(1)'s handling of old-style + and - format specifiers.
Don't treat disklabel fields d_packname and d_typename as null-terminated fields when they're not.
Fix a bounds-check off-by-one in lam(1).
Simplify pfctl(8)'s parsing of CIDR masks.
Add 'queue foo on $i_bar' syntax to allow pf(4) queue specs to apply only to specified interfaces.
Add 230400 to the list of speeds supported by termios under compat_linux(8).
Use the default rule when a packet passes due to the implicit 'pass all' at the top of the rulebase, eliminating many NULL tests.
Add a 'default' pf(4) rule and use it to store the default timeouts.
Add some shared library version updates missed in the XFree86 4.3.0 merge.
Many string function fixes all over the tree.
Fix a bad bounds check in OpenSSL's ASN.1 parser.
Back out the earlier realloc() change to tcpdump(8).
Update sectok_fmt_fid(3) to take a string length parameter, and crank libsectok's major version for the new API.
With the XFree86 4.3.0 merge, add an additional definition so that ports libs end up in /usr/local/lib/X11.
Update sudo(8) to 1.6.7p2.
Fix user(8)'s empty group test (PR#3178).
Improve PRIQ queue id assignment, so same-priority queues on different interfaces work properly.
Use realloc(3) instead of leaking memory in tcpdump(8).
Some cleanup in ipcomp(4) and ipsec(4).
Add a missing initialisation in ssh(1) (OpenSSH bug #526).
When an interface doesn't support altq(9), have pfctl(8) print the interface name in the error message.
Add automatic ssh(1) rekeying in accordance with the current secsh newmodes draft, and fix some rekeying bugs.
Fix kqueue(2) notification of immediate-mode bpf(4) events (PR#3175).
Merge in XFree86 4.3.0.
Update sudo(8) to version 1.6.7p1, to fix some overzealous paranoia.
Bump OpenSSH version to 3.6.1.
[Applied to stable]
Fix an mbuf leak in icmp6.
Have ftp(1) treat empty environment variables as if they were unset.
Fix some use-after-FREE when handling crypto errors in ipcomp(4) and ipsec(4).
Add a missing splx() in ipcomp(4).
Clean up and additional paranoia in setusercontext(3).
Only remove a kernel pf(4) rule structure when no states refer to it.
Helpfully, allow netinet/tcp_debug.c to compile when TCP_DEBUG is defined.
Fix ahc(4)'s probe of dual-channel 7899 cards.
Use snprintf to construct device names in the kernel, instead of hand-rolling.
Give a more consistent message when passwd(1) is aborted one way or another by the user.
Begin the process of eradicating the remaining strcpy, sprintf, and strcat calls from the tree.
Fix logging bustage in spamd(8).
Update sendmail(8) to 8.12.9 to fix a buffer overflow in address parsing. Note that this fix went onto the OpenBSD 3.3 CDs and so is not a 3.3 erratum.
More fixes to iha(4).
Stop pmdb dumping core on stripped executables.
Show in log output the list against which spamd(8) matched.
Have spamd(8) report exactly how much of the filthy spammer's time was wasted.
Add a missing strdup(3) error check in pwd_mkdb(8).
Change login_passwd(8) from setuid(root) to setuid(_shadow).
Remove OCHIO* binary compatibility hacks from ch(4).
When retrieving the size of a ccd(4) device, check the device is initialised before attempting to open it.
Add USER_LDT to the list of kernel options(4) controllable via sysctl(3).
Sync the SMP branch to 3.3.
Improve iha(4)'s REQUEST_SENSE handling based on hard-won experience with osiop(4).
Actually look for the lpr(1) -q option when calling getopt(3).
Fix handling of -f and -h options to lpr(1).
Improve error handling for invalid pf(4) cbq and priq flags.
3.3 -> 3.3-current.
--------
Changes made between OpenBSD 3.2 and 3.3
3.3 release branch created.
SECURITY FIX: A buffer overflow in the address parsing in sendmail(8) may allow an attacker to gain root privileges.
A source code patch is available.
[Applied to stable]
Fix the sftp-server(8) race fix so that renames of symlinks and directories work again.
Have lpr(1) and lprm(1) do a better fake setuid(daemon), so that files to be printed no longer need to be world-readable.
Some robustness fixes to vlan(4).
Set splimp() before resetting xl(4) to prevent interrupts before we're ready to handle them.
Recognise (and ignore) the --soname argument to ld(1).
Add a missing return statement when dumping the state table in pfctl(8).
When adding hfsc queues in the kernel, return the correct value when unable to allocate memory, and add some missing error cleanup.
Fix ssh(1) rekeying when running in privsep mode.
Add some extra quoting paranoia to /etc/rc.
Don't close stdin in md5(1).
Stop sendbug(1) reporting spurious errors.
Restore ac97(4) state after an apm(4) resume.
Make the syslogd(8) default facility LOG_USER instead of (due to a bug) LOG_UUCP.
Make netstat(1) -m output of mbuf cluster stats much more useful.
Fix memory use percentage output of ps(1).
Some endianness fixes to ahc(4), making it works on macppc.
Fix some problems with pf(4) table statistics.
Disable by default (and add a switch to enable) cross-realm authentication from Kerberos IV realms in Kerberos V kdc(8). This addresses a recently found vulnerability.
[Applied to stable]
Disable the Kerberos IV kdc(8), since all its functionality is available in the Kerberos V kdc.
Enquote $lpd_flags in /etc/rc.
Fix a logic error in sudo(8)'s SIGCHLD handler.
SECURITY FIX: OpenSSL is vulnerable to an extension of the 'Bleichenbacher' attack designed by Czech researchers Klima, Pokorny and Rosa.
A source code patch is available.
[Applied to stable]
Tweak pfctl(8) host address parsing to catch exceptional cases.
Fix parsing of the dhcpd(8) leases file.
Add a missing return statement in mkhybrid(8).
Restore bootable tape functionality for sparc.
Longword-align struct sockaddrs passed to the kernel by arp(8).
An RFC 2553 compliance tweak to getaddrinfo(3).
Change perl(1)'s config hints file to reflect the promotion of setre[ug]id(2) to real system calls.
Some (v)sprintf -> (v)snprintf in libcurses and libcurses++.
Bump ssh(1) version to 3.6.
[Applied to stable]
Fix a bad string length when checking options to login_passwd(8).
Add a nicely free license to hack(6).
Fix a bogus string initialisation when printing IPv6 addresses that was causing a segfault in netstat(1).
More string function sanity in the 4.3BSD compat library, crypto(3) and sudo(8).
Fix a string under-allocation in mountd(8).
Update to sudo(8) 1.6.7.
SECURITY FIX: Various SSL and TLS operations in OpenSSL are vulnerable to timing attacks.
An 'RSA blinding' source code patch is available.
[Applied to stable]
Add a missing chroot path correction when creating the SSL mutex file in httpd(8).
Another fix in the gcc(1) stack protector.
More strcpy -> strlcpy, in cron(8) this time.
After all the hard work making the X server run as a non-root user, stop the scheduler lowering non-root processes' priority if they've had more than ten minutes of CPU time.
Check the length of all fixed-length IPv6 neighbor discovery options.
Enable RSA blinding in keynote(3).
Remove the redundant -t option from mt(1).
Fix a bug in pf(4) tables that could cause table-based filtering of packets with a source or destination address of 0.0.0.0 (e.g. DHCP) to corrupt the kernel.
Enable RSA blinding for mod_ssl private key operations.
Fix a bug that caused all jobs displayed by atq(1) to appear to be owned by the owner of the last job in the queue.
[Applied to stable]
Require spamd(8) control connections to originate from a reserved port.
Plug a pf(4) tables memory leak.
Scale the altq(9) RED thresholds to 10% (min) and 30% (max) of the queue limit.
Fix a one-byte underflow in raidctl(8).
Switch RSA blinding on for isakmpd(8), ssh-agent(1) and ssh-keysign(8).
Still more sprintf -> snprintf and strcpy -> strlcpy in many, many places.
More strcpy -> strlcpy, this time in badsect(8), restore(8) and scsi(8).
Fix a missing initialisation in pckbc(4) when the ps/2 keyboard is not the system console. Avoids a panic on alpha.
Remove sbin/photurisd from the tree.
(v)sprintf -> (v)snprintf in mrouted(8).
Add -c option to md5(1), for compatibility with GNU md5sum.
Set IFCAP_VLAN_MTU for sk(4).
Add a missing endianness fixup to bktr(4).
Hack compat_freebsd(8) to pick up recent FreeBSD binaries such as Opera.
Make cron(8)'s parser detect many more syntax errors.
Allow bridge(4) to send unfragmented full-length 802.1q packets on interfaces with IFCAP_VLAN_MTU set.
Make sure that pf(4) queues have a queue ID that is unique across all interfaces.
When acting on an anchor, make pfctl(8)'s -F option traverse all subrulesets in the anchor.
Remove larn(6) until some license issues are resolved.
Yet more gcc(1) stack-smash protector fixes.
Many spelling and double-word fixes.
Install lpr(1) and lprm(1) setuid root instead of setuid daemon (the latter is more risky) and setuid to daemon early on.
Add a missing getnameinfo(3) error check to ftp(1).
Always set a bpf(4) filter in pflogd(8), since bpf will otherwise grab full-length packets.
strcpy->strlcpy in mount_portal(8), quotacheck(8), route(8) and routed(8).
Make pf(4) queue code drop illegal non-PKTHDR mbufs, and whine loudly so any problem will get noticed and fixed.
Allow st(4) tape density codes up to 0xff (the old limit was 0x45).
Continued assault on manpage errors, omissions and bad English.
Fix a typo from pre-3.1 days that was stopping inode quotas from working.
Stop spamd-setup(8) always returning an error code.
Log that cron(8) has started after detaching from the controlling terminal, rather than before.
Make cron(8) show the correct error line number when the command is missing.
Make pfctl(8) give a helpful error message when multiple same-named queues are added to an interface.
Fix a problem in sis(4), found with a few DP83815 devices, where a cable length of less than 30m caused excessive receive errors.
Tighten pf(4) tcp state code in relation to a FIN received before any server response.
Add spamd and spamd-cfg tcp ports to services(5), and have spamd(8) obtain the port numbers from there.
Fix some problems adding pf(4) child queues.
Prise the correct line number for errors out of cron(8).
Warn about garbage lines before the EOF in crontab(1).
Fix a panic in ppp(4) by making sure the first mbuf in a chain contains a packet header.
Disable ptrace(2) for P_SUGIDEXEC as well as P_SUGID.
Make the kernel's P_SUGIDEXEC flag semantics match those for issetugid(2).
Make clear that mailwrapper(8) error and warning messages are not from the wrapped program but from the wrapper itself.
In mountd(8) only write to the pidfile if we've opened it.
Honour the :sh: printcap(5) flag for remote printers, instead of requiring -h to be given to lpr(1).
Add spamd.conf(5), configuration for spamd-setup(8).
Since spamd-setup(8) is no longer a Perl script, remove the Net::Netmask module.
Re-re-implement spamd-setup(8), this time in C.
Tweak queue rule expansion to fix problems when a queue spans multiple interfaces.
Base pfctl(8)'s 'bandwidth too small' whine on interface-specific calculations rather than always using '6Kb'.
Have a separate flag (-g) for pfctl(8) debugging output, instead of overloading -vv.
Fix a signedness bug (KAME PR 469) in the libc resolver.
Set some missing flags and fix ti(4)'s vlan tagging support.
Stability fixes to cac(4).
A huge number of manpage cross-reference fixes.
In kernel main(), configure devices later when process 0 is more fully initialised.
Avoid a null derefence in isakmpd(8) when converting text addresses to a sockaddr.
Fix pf(4) queue assignments when an interface is not specified.
For IPv6 etherip packets, set the next protocol field in the header.
Pass IP proto 97 (Ethernet-in-IP) packets up to bpf(4).
In the installer, delete the FTP password when no sets are found, so it doesn't get displayed in the URL.
Add a boot image ISO for alpha.
New images; the last X update before the release.
Fix a number of memory leaks in ssh(1) and its related programs.
Add a monolithic openssl(1) manpage, covering all the tool commands.
Media handling fixes to hme(4).
Set the right address family for IPv6 addresses in a pf(4) table.
Update named(8) to BIND 9.2.2-release.
Only have /etc/rc generate the rndc(8) key if named(8) is to be started.
named(8) always does setuid(named) and chroots to /var/named, so remove the variables for those actions from /etc/rc.
Turn off the stack protector when building lkm(4)s.
Don't install mrinfo(8) and mtrace(8) setuid root.
Recreate the rndc(8) key if /etc/rndc.key and /var/named/etc/rndc.key are not identical, or if either is absent.
3.3-beta -> 3.3
Fix user and group keywords with IPv6 pf(4) rules.
Create a baby ISO for i386, with just the CD boot image on it.
Move the spamd(8) configuration channel from the spamd listener port the next port up.
Add to file(1) support for additional image formats and a first pass at reading jpeg size.
strncpy->strlcpy in libc resolver code.
Upgrade file(1) to 3.41, to fix a buffer overflow. Get improved 64-bit ELF support as well.
[Applied to stable]
In the libc stack smash handler, straight away block all signal handlers from running.
More fixes and improvements to isp(4).
Sendmail updated to 8.12.8.
SECURITY FIX: A buffer overflow in the envelope comments processing in sendmail(8) may allow an attacker to gain root privileges.
A source code patch is available.
[Applied to stable]
Fix some nits in m_pulldown(9).
Return a meaningful partition size from rd(4).
Fix pfctl(8) display of altq bandwidth figures.
Fix a missing configuration message validity check in spamd(8).
Remove spamd-setup.sh script.
Add a configuration channel in spamd(8) so spamd-setup.pl can talk to it.
New spamd-setup.pl script to set up spamd(8), with support for multiple blacklists configured via spamd.conf(5).
Add perl module Net::Netmask for new spamd(8) setup perl script.
Remove the redundant 'control' keyword from altq CBQ.
Tag no-payload tcp ACK packets for priority queuing, see /usr/share/pf/ackpri for more information and an example.
Guarantee that two pf(4) queues with the same name on different interfaces have the same internal queue id.
Prevent gem(4) removing DMA mappings that are still in use, which causes faults on sparc64.
Stop the installer mistakenly deleting a default route that an FTP install may need to use.
Add a bootable CD iso image for sparc64.
Fix a few bad printf format specifiers in pflogd(8).
Disable GNU mmalloc on all architectures.
Update all disktab(5) files to show support for 16 partitions, and fix a few other glitches.
Finally, mrouted(8) and fellows have proper licensing and are now built by default.
Make sure the error value is set properly on SA expiry for AH and ESP.
Fix a Kerberos (IV and V) resolver overflow found by propolice.
Make libc random(3) and related functions use u_int32_t internally instead of long.
Update the isp(4) firmware images.
Increase the ata IDENTIFY command timeout from one to three seconds.
Use a bss copy of basename(argv[0]) for __progname, so even when there is real stack carnage a propolice stack-smash report has the right program name.
Add a missing splsoftnet() in pf(4) tables code.
Add WANT_LIBMILTER, WANT_SASL and WANT_LDAP mk.conf hooks for sendmail(8).
Add -trace-ctors-dtors option to gcc(1)'s collect2. See gcc-local(1).
Make rndc(8) die properly on errors.
In libz, check snprintf(3) return value to detect truncation.
[Applied to stable]
Stop syslog(3) always logging to the console when LOG_CONS is enabled.
Have updatedb(8) use /var/tmp instead of /tmp, and include ext2fs volumes in the database.
Handle invalid step sizes properly in cron(8).
Add IPv6 packet classification support for pf(4) queues.
Fix pf(4) tables' IPv6 support.
Correctly set the priority queue when expanding pf(4) rules.
Some cleanup in ti(4).
Make libz use snprintf(3) instead of sprintf(), since we're at it.
[Applied to stable]
Fix a bug in bind's isc_print_vsnprintf(), even though it's not used in OpenBSD.
Have named(8) listen on IPv6 interfaces by default.
More gcc(1) stack protector fixes.
Add 'show' and 'monitor' commands to ipsecadm(8).
Update xterm(1) to fix CAN-2003-0063 and CAN-2003-0071.
Fix pf(4) binat rule matching.
Clean up pfctl(8) binat rule parsing.
More bounds check fixes, in Linux compat and gdt(4).
Correct two off-by-ones in ami(4).
Fix a bad bounds check in midi(4).
Revert to the old pf(4) macro redefinition code, to stop a bad next pointer causing an endless loop.
Fix a crasher in the pfkeyv2 debugging code.
Add LZS compression support to hifn(4). Only usable by IPComp for now.
Set the portal filesystem file change time properly.
Remove tcfs due to licensing problems.
Fix a bogus vmstat(8) warning message.
Make libz use vsnprintf(3) instead of vsprintf().
[Applied to stable]
Add privilege separation to the old X servers too.
In the X server, open the keyboard and framebuffer drivers using privsep.
Plug a couple of mbuf leaks on errors in bridge(4).
Pull in from FreeBSD a better environment variable parser for cron(8).
Repair httpd(8) restarts, broken by the ETag inode leak fix. (The etags-state file wasn't readable after dropping privileges.)
Don't try to allocate < 0 bytes of memory in libcrypto.
[Applied to stable]
Re-enable 'set loginterface none' option in pfctl(8).
Fix a bad sizeof in ssh(1) auth_krb4.
Send BIND 4 to the attic. named(8) is now BIND 9.
Still more fixes to the gcc(1) stack protector.
Have tcpdump(8) check AH and ESP packets are of valid length before dumping their contents.
Teach tcpdump(8) to print IPComp packets.
Fix a crasher in systrace(1) by reparing some locking code in the kernel, and removing a null deref in userland.
Sync cron(8) with ISC cron -current, keeping the OpenBSD-specific at(1) integration.
Make xconsole(1) run as user _x11 instead of root (like the X server,) and use privilege separation for the parts that need root.
Add an empty cron.deny file, since POSIX requires that in the absence of cron.allow and cron.deny files, only root may run crontab(1).
Fix a null deref triggered by ipcomp(4).
pfctl(8) rejects non-existent interfaces in rules using dynamic interface syntax.
Move /var/at files into /var/cron since at(1) is now a part of cron(8).
Fix support for pf(4) syntax (if)/24 (dynamic interface name translation with a network prefix).
SECURITY FIX: In ssl(8) an information leak can occur via timing by performing a MAC computation even if incorrect block cipher padding has been found, this is a countermeasure. Also, check for negative sizes in memory allocation routines.
A source code patch is available.
[Applied to stable]
Add a counter for netstat(1) showing how often ipcomp(4) was skipped because the packet size was below the compression threshold.
Fix a buffer overflow in pfctl(8) on 64-bit platforms.
Stability updates to vr(4).
LFS is not supported, so remove support for it from df(1).
More niggly fixes to newly-added LZS support.
Don't load pf.conf(5) options when one of pfctl(8)'s load switches (-A, -N, -R) is in force.
Write the stack to core files properly for upward-growing stack architectures.
Enable LZS support in ipcomp(4), missed when LZS was added earlier.
Turn of BIND 9's logging of lame servers; some people never learn, and we don't want to know about them.
Make min-ttl and random-id operate on inbound as well as outbound pf(4) scrub rules.
Many missing copyright notices added to manpages.
Add privilege separation support to the X server. Fixes a lot of problems.
Fix a double-free in ftp(1).
Add -n 'no daemon' option to cron(8).
Enqueue the copy and not the original mbuf that's free four lines later, and so stop bridge(4) crashing the kernel.
Improve default route setup in the installer.
Fix ssh(1) forced commands with 'PermitRootLogin forced-commands-only' set.
Some RFC-compliance fixes to the httpd(8) multipart MIME pid leak fix.
Clean up pf(4) macro parsing.
Fix format string bugs in grep(1) and nohup(1).
strcpy -> strlcpy in rpc.pcnfsd(8).
Add support framework for LZS compression to crypto(9) and ipsec(4).
More write protection paranoia in ld.so(1).
Make bsd.rd an install/upgrade target.
SECURITY FIX: httpd(8) leaks file inode numbers via ETag header as well as child PIDs in multipart MIME boundary generation. This could lead, for example, to NFS exploitation because it uses inode numbers as part of the file handle.
A source code patch is available.
[Applied to stable]
Increase the size of the rates buffer in wi(4) hostap so 802.11g stations can associate.
When outputting raw IP and generating the header manually, make sure the packet is large enough for a full IP header.
[Applied to stable]
Fix an mbuf leak in IPv6 TCP. [Applied to stable]
Now that pf(4) tables spring into existence on demand, remove the unnecessary '-T create' option.
Have arc4random(3) stir the pool when the caller's pid changes.
Add 'scrub in all no-df' to the initial pf.conf(5) installed by /etc/rc. This helps diskless booters using Linux NFS servers.
Allow pf(4) redirect to loopback interfaces again, now that looping can't occur.
Fix an fd locking bug in libpthread.
Have spamd(8) use tables instead of regular rules on an anchor.
Improvements to ATAPI PIO mode selection.
Fix an mbuf leak in wi(4).
SECURITY FIX: A fix for an lprm(1) bug made in 1996 contains an error that could lead to privilege escalation. For OpenBSD 3.2 the impact is limited since lprm(1) is setuid daemon, not setuid root.
A source code patch is available.
[Applied to stable]
Finish nForce support in pciide(4).
When pfctl(8) complains about an illegal netmask, have it show the offending article.
Fix busted ypxfr(8), the key and values are no longer swapped around. Which is nice.
Add libedit line editing support to cdio(1).
Teach disklabel(8) to use units other than sectors on the command line.
3.2-current -> 3.3-beta.
Replace ssh(1)'s and wi(4)'s crc32 code with BSD-licensed versions.
Change pf(4) scrub option 'no-df' to better handle fragments with DF set, such as those sent by Linux NFS.
When in async mode, signal the process group instead of the process from WSEVENT_WAKEUP in wscons(4).
In newsyslog.conf(5), users can separated from groups now with ':' as well as '.'.
newsyslog(8) can now rotate files at a specific time.
Better bind(2) error checking in isakmpd(8).
Be consistent with ntohs() in pf(4) translation code.
Some consolidation and tidyup in pfctl(8)'s rule parsing code.
More fixes to pf(4) routing.
Don't ever send ICMP redirects for pf(4)-redirected packets .
Allow definition of pf(4) macros on the command line. Oh yes.
Remove sinful abbreviation of the unit of frequency as 'hz' (it's 'Hz', don't you know).
tcpdump(8) now displays the DF flag for IP fragments.
Have spamd(8) pass sensible parameters to memset().
Allow IPv6 addresses in yp(8) host maps.
More pf(4) rule compression: 'from' and 'to' keywords are optional if 'any' is one of the addresses, and 'any' itself is optional when a port is specified.
Change chroot(8)'s -u and -g options' semantics (-u is now what -U used to be, unless -g overrides it,) and remove -U and -G.
Sync up the spell(1) dictionaries with FreeBSD and NetBSD changes.
Add new 'random-id' option for pf(4) scrub rules. This randomises outbound IP IDs and defeats NAT detection and OS fingerprinting.
Stop a number of scripts that use mktemp(1) from leaving dead tempfiles around in failure cases.
A little extra paranoia in chpass(1), check that the temp file is owned by our real uid.
Don't burp syslog(3) output to the console unless syslogd(8) was not contactable.
Stop sshd(8) leaking information when PermitRootLogin is set to 'no'.
Install pf.conf(5) mode 0600 by default.
Fix races in the rename and symlink commands of sftp-server(8).
Allow 'ProxyCommand none' in ssh(1).
Hack around a tools bug in disklabel(8).
Improve handling of invalid pf(4) redirections.
Tidy up ssh(1) ProxyCommand option parsing.
Last part of the threaded fd improvements, fixing some bugs from stage one on the way.
Set an all-ones mask when doing pf(4) routing, since round-robin on the whole address space is unlikely to be the desired result.
First installment of improvements to threaded file descriptor handling (see the checkin comment for details).
isakmpd(8) now sets the Default-Phase-1-Configuration transform to 3DES-SHA-RSA_SIG, the same as OpenBSD 3.2.
Don't load a signed int into the ssh(1) buffer when doing BSD auth; the buffer type only supports unsigned ints.
Note in the documentation that snprintf(3) and syslog_r(3) are safe (with caveats) for use in signal handlers.
Stop pf(4) {dup,reply,route}-to rules using a loopback interface as the target - currently this can create loops.
Don't have pfctl(8) expand altq rules (and so check for parent queues etc.) unless altq rules are actually being loaded.
More gcc(1) stack protector fixes and tweaks.
Stop pfctl(8) closing a file it hasn't opened.
Make chpass(1) more paranoid when opening its temp file.
Make iostat(8)'s disk throughput bar smarter.
Implement key exchange guesses as per the secsh standard in ssh(1).
Relax parsing of usernames in scp(1).
Make pf(4) build without IPv6.
Fix an mbuf leak in the ESP code.
Correct a bad array index in netstat(1).
Fix multicast problems with vlan(4), and also remove some unnecessary Ethernet-specificity from the driver.
Really fix combination of pf(4) translation and route-to/reply-to.
Check TCP, UDP, ICMP and ICMP6 checksums in pf(4), and make the sum isn't recalculated when the packet hits layer 4 in the kernel. Packets with invalid checksums are silently dropped, to avoid firewall detection by use of filter responses to bad packets.
Make pf(4)'s TCP state inspection RFC 763 compliant, and send a reset when presented with SYN-cookie schemes that send out-of-window ACKs during the TCP handshake.
Now that route(8) is no longer setuid root, check the effective uid instead of the real uid.
Fix a number of filesystem locking issues, for details see the checkin comment.
Fix an ICMP mbuf leak.
[Applied to stable]
Create a fake siginfo_t for pthread_kill(3).
Stop dhcpd(8) and dhcrelay(8) trying to use dead interfaces.
For ELF images, put .rodata in a separate section to the program text, so the read-only data is no longer executable.
New pf.conf(5) interface modifiers: <if>:network for the interface's connected network(s) and <if>:broadcast for the interface's broadcast address(es).
Have spamd(8) revoke privileges earlier so it can bind to a priviliged port if desired.
Mirror the a.out initialise-dependent-libraries-first change for ELF.
For POSIX reasons, make setre[ug]id(2) real system calls again (albeit still implemented using setres[ug]id()) instead of 4.3BSD compatibility library calls.
authpf(8) sets the process title to '<user>@<ip>'.
Add a missing ntohs in tcpdump(8) so that pf(4) actions get printed correctly.
Make the resolver code in libc more thread-safe.
Fix an fd_set overflow in telnetd(8).
Improvements to pthreads signal handling. See the checkin comment for details.
For eg(4), el(4), ie(4/HPPA) and url(4) zero-pad frames smaller than the minimum frame length.
Update the termcap entry colours for wsvt25 to match reality.
If the -a option is given to pfctl(8) to specify an anchor, don't allow operations that have a global effect.
Make sure tcpdump(8) correctly exits from the loop that prints IPv6 option headers.
Use record instead of play parameters to calculate the record high watermark in audio(4).
Don't have ftp-proxy(8) remove leading spaces, this can break multiline commands.
Further cleanups and shrinkage of the installer scripts.
Correct operation of pf(4) rdr rules involving port ranges. Now the from- and to-range sizes can differ.
Stop bogus packet drops during pf(4) normalisation when an offset went negative.
Fix pfctl(8) -n option operation with table statements.
Allow pf(4) tables to be initialised from a file listed in pf.conf(5).
Better checking and error reporting for illegal table-related constructs in pf(4) rules.
Improve TCP performance by sending segments of no more than half the send buffer space limit. This means that (if enough data is available to be sent) there will always be at least two segments sent. A BSD receiver-TCP will turn off delayed ACKs with more than one un-ACK'd packet on a socket.
Improvements to newsyslog(8) monitor mode.
Plug a potential memory leak in spamd(8).
Make sure xinit(1) never leaks the MIT_MAGIC_COOKIE via the command line.
Fix vipw(8)'s use of timestamps to detect changes to the temp file.
Make sure a thread's signal handlers aren't run until the thread is made current.
Save the fpu state when switching threads on i386 and sparc64, floating-point preemption regression tests now pass on these architectures.
Fix ndc(8)'s reading of the rc.conf(8) variable NAMED_FLAGS.
Fixes to pf(4)'s TCP window scaling support.
pfctl -vvsq display (altq stats) gets more useful, showing bandwidth and packet rate stats for CBQ and PRIQ.
Install nslookup(8) along with BIND 9, and don't print the irritating deprecation warning.
ftp-proxy(8) now honours the TCP_WRAPPERS setting in mk.conf.
Allow cvs(1) Checkin-Prog and Update-prog to be disabled with the new CVSROOT/config option "DisableXProg"
Always use splimp(9) in wi(4), fixing some transmission failures.
Add -1 and -2 options to scp(1) to force SSH protocol 1 or 2 respectively.
New -l bandwidth-limiter option for scp(1).
New -c option to ssh-add(1), that forces ssh-agent(1) to pop up a dialog requesting confirmation of the use of a stored key.
Don't have pf(4) crash the kernel when translating icmp6 packets.
More updates to unifdef(1).
strcpy -> strlcpy in ftp(1) macro expansion.
pf(4) tables automatically spring into existence when referred to by pfctl(8) add or replace commands.
Add RFC 1323 TCP window scaling support to pf(4).
Improvements to wi(4) hostap timeouts.
Add new ssh-agent(1) -t option to set the default key lifetime.
Add a generic watchdog interface and sysctl(8) kern.watchdog.
Shrink wi(4) and save some space on the install floppies by removing hostap code when compiled with -DSMALL_KERNEL.
Use the right variable type when traceroute6(8) fetches the default hop limit via sysctl(3).
Tweak compat_linux(8) socket syscall emulation. Improves emulation of programs using UDP.
Fix an incorrect argument length passed to setsockopt(2) by traceroute6(8).
bzero() after malloc(9) in siop(4).
[Applied to stable]
Have /etc/rc generate the BIND 9 rndc(8) shared secret if it doesn't exist.
Add BIND 9 configuration files.
Skip DNSSEC programs in BIND 9.
Begin import of BIND 9.2.2rc1. (Local changes documented in README.OpenBSD.)
Fix some silly pastos in pfctl(8) table code.
Create /var/empty/dev/log for programs that chroot(2) to /var/empty.
Fix a typo in pf(4) DIOCRSETTFLAGS implmentation, so it doesn't look like changing a table flag created a table when in fact it deleted one.
Stop syslog(3) from reconnecting to /dev/log on an ENOBUFS as this doesn't help, and it hurts chroot(2)'ed processes.
[Applied to stable]
Change chroot(2)'ed daemons portmap(8), rstatd(8) and rusersd(8) to use openlog(3) with LOG_NDELAY.
Implement sigaltstack(2) under pthreads.
Copy the thread sources (including CVS history) from lib/libc_r to lib/pthread, and move libc_r into the Attic.
Make pfctl(8) show more information with -vvs[rn] for rules containing tables.
SECURITY FIX: A double free in cvs(1) could allow an attacker to execute code with the privileges of the user running cvs. This is only an issue when the cvs command is being run on a user's behalf as a different user. This means that, in most cases, the issue only exists for cvs configurations that use the pserver client/server connection method.
A source code patch is available.
[Applied to stable]
Add an invalid ioctl sanity check to gif(4).
Bring perl(1)'s build into line with the libc_r -> pthread move.
Big improvements to a.out library dependency handling.
Make select(2) a thread cancellation point as per the standard.
Fix some locking-related raidctl(8) panics.
Updates to unifdef(1).
Fix a null deref in pfctl(8) when processing the -k option.
Big cleanup of host() in the pfctl(8) parser.
When running pfctl(8) with insufficient privileges to open /dev/pf, make the -n option work as a syntax checker for table commands.
Unbreak pf(4) nat random source port assignment. Now a rule has to actually ask for static-port in order to get it.
Enable the pfctl(8) 'static-port' keyword.
Extensive ld(1) changes to better protect ELF executables from tampering (see the checkin comment for details).
Add new output format option '-f' to ncheck_ffs(8).
ncheck_ffs(8) no longer reports when the set[ug]id bits are set on directories, since these are meaningless in OpenBSD.
Fix a missing YYERROR in the pfctl(8) parser.
Deal with cd(4) drives that are picky about being asked to play the leadout track.
Note with regret and sadness that the freely available PCI vendor and device list is no longer available.
Bring protocols(5) more into line with current reality.
More improvements and device additions to pciide(4).
Explicity use the first path found by glob(3) instead of indexing with an uninitialised variable in sftp(1).
Small fixes to whois(1).
Create PIC archives for a number of X libs, useful for ports that create shared libraries.
Stop nfsstat(1) displaying info for the no-longer-supported NQNFS protocol.
Fix nfsstat(1)'s filesystem id lookup, and a minor buffer overrun.
Fix some minor bugs in pf(4) table creation.
Have pfctl(8) recognise the '-T load' option like it used to.
Plug a memory leak in the pf(4) table code when using PFR_FLAG_DUMMY.
For the benefit of dhclient(8), allow outbound pings from the initial pf(4) rulebase installed by rc(8).
Pull all the IP address parsing code of pfctl(8) into one place.
Goodbye libc_r and libnpthread, hello libpthread.
Check for and report read errors in md5(1).
Stop sftp(1) uploading or downloading non-regular files.
/etc/weekly is now built (by default) in /var/tmp rather than /tmp.
Add an extra sanity check in malloc(3) to prevent size_t overflows.
Better input checking and error handling in the pf(4) table code.
Begin converting vmstat(8) with the -i option to use sysctl(3) instead of kvm.
Start work on NVIDIA nForce support.
pfctl(8) now supports CIDR-notation IPv4 addresses when manipulating tables.
Some command-line fixes and tweaks to rusers(1).
Stop rm(1) with the -P option from overwriting files with multiple links.
Fix handling of addition and subtraction of negated addresses to tables in pfctl(8).
In ssh(1) only show the socket(2) error for the last address to which one tries to connect.
Don't fill files full of holes with ftruncate(2) after a write error in rcp(1) and scp(1).
Add a progress meter to the sftp(1) client.
Remove fetch(9) and store(9) from the kernel, and replace calls to them with their copy(9) descendants.
Various strl* return value checks in pfctl(8).
Initial support for queue statistics display for pfctl(8) (-vsq option).
'Default-Phase-1-Configuration' -> 'Default-phase-1-configuration', 'Default-Phase-2-Suites' -> 'Default-phase-2-suites' in isakmpd(8).
New table manipulation syntax for pf.conf(5), and a corresponding new -Tl option for pfctl(8).
Add support for active/inactive pf(4) tablesets in the kernel
Enable SET/ACK in isakmpd(8) when acting as an ike-mode-cfg responder.
[Applied to stable]
Improvements and fixes to batch mode sftp(1).
Big strlcpy/strlcat(3) makeover for csh(1).
Stop compress(1) from clobbering an existing output file if the input can't be opened.
gcc(1) attribute(sentinel) improvements.
Improvements to whois(1): Can specify port with -p; recursive IP lookup; INICHOST (-i) is now netsol.
Remove old altq packet-classifier code from the kernel now that pf(4) does its job instead.
pfctl(8)'s string parser can handle strings beginning with an underscore, useful for all those new daemon usernames.
Have authpf(8) clean up after failed previous incarnations of itself.
Don't allow s[eh]mmni to be set (via the newish sysctl(8) interface) greater than 0xffff, to prevent id collisions due to wraparound.
pf(4) tables now spring into and out of existence on demand.
Fix the sudoers(5) parser's handling of EOF not preceded by newline.
Stop sftp(1) from always adding u+w permissions to files pulled by get -p.
Values set in sysctl.conf(5) can contain spaces when quoted as for sh.
shmctl(2) can now operate on segments marked for removal.
In compress(1), don't trip the 'may not mix -o, -c or -t' warning by mistake, and don't choke on stdin when compressing.
Add mg(1) the +number option, which moves the point to the given line of each file.
Correct a couple of {dup,reply,route}-to problems related to nat pools.
Create a new group, _lkm, and install modstat(8) setgid to it instead of to kmem.
pstat(8) now only does kvm_openfiles(3) for the -v option, the rest is obtained using sysctl(3).
cp(1) sets permissions later, so -R works when copying directories with no write access.
Fix a null deref in dlsym(3).
Avoid a rare division-by-zero in ps(1) that could occur on non-IEEE systems like the vax.
Remove the endianness from bktr(4). Enable on macppc.
Make sure we don't try to free a null pointer in whois(1).
Change 'no-route' implementation from a flag in the pf(4) rule address to an address type.
Make pf(4) skip-step calculation honour the 'no-route' keyword.
Remove code in ld(1) to force linking against a specific library version.
[Applied to stable]
Add console support for Polish and Turkish keyboard layouts.
Add the userland support for pf(4) tables to pfctl(8) and authpf(8).
Remove reference to the now obsolete screenblank from /etc/rc.
Fix dig(1) time display on 64-bit big-endian targets.
Do a bridge(4) routing update if the source interface is in the LEARNING state, not the destination interface.
ftp(1) does a better job of detecting a failed cd command.
Have syslog(3) parse '%%m' correctly.
Fix a null deref in at(1).
Require a direction for pf(4) rules that do routing.
When combining (route|reply)-to and translation in pf(4) rules, make sure a state table insertion is only attempted once.
Note (in the system copyright message) that it's now 2003.
Update to sendmail 8.12.7.
Have tcpdump(8) display all pf(4) rule types instead of just pass/block rules.
Make the pf(4) table code handle duplicate table names and/or duplicate addresses in a single ioctl(2) call.
Remove the pf(4) skip-step for rule action (scrub or no-scrub).
Properly update pf(4) scrub rule statistics.
Put pf(4) scrub rules into a ruleset separate to filter rules.
Implement policy suggestions in xsystrace(1).
Adios amiga and sun3 platforms.
Don't overrun the buffer when listing route entries via sysctl(3).
Fix strtok_r(3) breakage in libwrap that was causing EXCEPT rules to fail.
Add a missing exit(3) in pfctl(8).
Correctly ignore the case where a directory with the desired executable name appears in one of the paths searched by exec[vl]p(3).
Set a default pf(4) state table size of 10000 entries.
In pf.conf(5), change keyword 'ipv6-icmp-type' to 'icmp6-type' and instead of 'proto ipv6-icmp' allow 'icmp6'
Fix a C++ compiler problem with Kerberos IV's krb.h, similar to the cdefs.h fix earlier.
Avoid a null deref when parsing the command line of make(1).
Allocate memory for connections to spamd(8) based on the -c command line option.
Make cd(4) try more often than other scsi devices, and don't ignore 'not ready' status from the bus.
Add a parameter for the number of retries when waiting for a scsi device to come ready (scsi_test_unit_ready()).
If semop(2) has to do a tsleep(9), wake it back up at a much lower priority.
Wait until a semaphore undo structure can be allocated if one isn't available immediately, and check that another hasn't been allocated to our process while we were waiting.
Properly check SOCKS connection return code in nc(1).
More firewire fixes. Concurrent devices support on the way.
Remove outdated references to NFS as an installation source from the install notes.
Fix HOSTAP_FLAG_BITS in wi(4).
Make 'pfctl -a name -s[rn]' show all rules or nats in all rulesets on anchor 'name'.
In authpf(8), set the macro '$user_id' to the username.
Fix a couple of missed semaphore counter updates.
Add kernel portion of pf(4) support for efficient tables of addresses (currently implemented as radix tables similar to the kernel routing table).
Remove an extraneous semicolon in <sys/cdefs.h> that broke some C++ compilers.
Fix an amusingly incorrect calloc(3) size in nc(1).
Allow the log keyword in pf(4) scrub rules.
Some fixes to pf(4) ioctl handling.
When pf(4) is routing a stateful connection, use the correct pool address.
Fix kernel pf(4)'s ability to match binat-anchor rules.
Add a missing initialisation that was causing a crash in pf(4).
Add spamd(8) support to rc(8). rc.conf and root's crontab.
More paranoia checks in kernel pf(4) routing.
Unbreak spamd(8)'s connection timeout.
Honour the -R and -N flags to pfctl(8).
Tweak gcc(1)'s handling of inline functions w.r.t. the stack protector.
New _spamd user and group for, uh, spamd(8).
Fix pfctl(8)'s display of 'control' keyword for CBQ rules.
Make libc/md/md5c.c compile again for big-endian machines.
Avoid a null deref in pppd(8).
Remove a couple of extra ntohs(3) calls in pfsync(4).
Cleanup of atactl(8).
Fix device attachment bug in siop(4).
[Applied to stable]
Update Perl's Safe(3p) module to 2.09, fixing a security hole.
[Applied to stable]
newsyslog(8) error messages now contain the line number.
Have 'chroot -U' do a setlogin(2) if the caller is, or can be made into, the session leader.
Make chroot(8) check for $SHELL defined as null as well as for undef.
Increase the receive buffer length of the correct socket in syslogd(8).
Fix pfctl(8)'s display of binat rules that use nat pools.
authpf(8) rules are now managed in their own anchor instead of at the end of the main rulebase. New *anchor rules are needed to activate authpf.
Make sure the queue identifier returned by msgget(2) is greater than zero.
Correctly display pf(4) rdr rules with no proxy port.
Fix a missing initialisation in pfctl(8).
Add spamd(8), which uses new pf(4) features to stop spammers even hitting the mail server.
Fix an Alpha-specific crash in pfsync(4) by using bcopy() instead of structure assignment.
Fix a use-after-free() in mailwrapper(8).
Add a new kernel pool(9) flag, PR_DEBUG, the use of which causes pool memory to be malloc(9)'d using M_DEBUG.
Add new kernel malloc(9) type M_DEBUG.
Also support CORENIC handles in whois(1).
Add dsiz and ssiz keywords to ps(1) to show data size and stack size respectively.
Update awk(1) to 'one true awk' version 20021213 (Friday 13th ed.)
Add the -6 and -c registry shortcuts to whois(1), and deal with VNIC handles starting with '!'.
Better resolver error checking, a few fixes and a lot of message cleanup in ftp-proxy(8).
Stop '-k' being used as an abbreviation for '--keep-locals' in GNU as(1).
Optimise pf(4) skip-step calculation to O(n) from O(n-squared).
Fix pf(4) 'no {binat,nat,rdr}' evaluation.
Allow pfctl(8) (with the -vsn) option to display translation statistics as -vsr does for rules.
When logging pf(4) rules from anchored rules, display the *anchor rule number, not the rule number within the anchored rules. (Hopefully both will be displayed sometime soon.)
Make sure that state table entry display doesn't try to print rules that are no longer in place.
Prevent changes to different rule types overwriting pf(4) DIOCCHANGE* tickets.
Support a single destination port in pf(4) rdr-anchor rules.
Match pf(4) {binat,nat,rdr}-anchor parsing to what is actually supported.
Always compile in PRIQ and HFSC schedulers if ALTQ is included in the kernel.
Make SysV shared memory and semaphore limits configurable via sysctl(8). Oh yes.
whois(1) no longer barfs totally if just one of its query list is not found.
Add PRIQ scheduler support to pfctl(8).
su(1) only calls setlogin(2) if it's the session leader (as noted in the setlogin manpage).
More compress(1)-works-like-gzip(1): Add -r (recurse) option, and make it truncate existing files when extracting.
Since pf(4) rule comparison is now done in userland, remove unused pf_compare* functions from the kernel.
pf(4) DIOCCHANGE* ioctls now require a ticket, to prevent races.
Merge pf(4) nat, binat and rdr structures and pools into pf_rule.
Fix the signedness of wsconsctl(8) variable display.focus, so a test against -1 now makes sense.
Teach imake(1) how to detect automagically the gcc(1) stack protector.
Now pf(4) supports other queue types, only try to create a root queue for CBQ.
For some peculiar reason, support decoding in ppt(6).
Make linux emultation *stat64() work again.
Convert altq(9) disciplines HFSC, PRIQ and RIO to pf(4)-based (CDNR and RED to come,) and remove other queuing disciplines.
iostat(8), systat(1) and vmstat(8) now update their disk stats automatically when a device is detached.
Enable login failure recording by default, by installing a blank /var/log/failedlogin (see login(1)).
Fix some problems with the new inlined <ctype.h> functions on 64-bit architectures.
Make cdio(1) deal properly with multiline CDDB responses.
Add a second 'priority' queue to be specified in a pf(rule), currently used for low-delay ToS packets. Great for ToS-savvy programs like ssh(1).
Revert nc(1) to the old behaviour, so it exits when the read descriptor is closed instead of requiring both read and write to close.
Cosmetic fixes to scp(1).
Allow some ordering freedom for pf(4) scrub rules.
Lots of firewire fixes. Add SCSI-over-FireWire support
Compare all the bytes of a pf(4) nat pools key, instead of comparing the first byte four times.
Fix a linkage problem that stopped 'make build' working with DESTDIR set.
Remove setgid(kmem) from trpt(8).
pstat(8) can now get the tty list using sysctl(3) insteam of kvm_read(3).
Fix systrace(1) logging so it works for non-translated calls too.
Stop close(2) clobbering errno in ld(1).
Convert <ctype.h> macros into functions so they are consistent with those in libc.
Change XDR.x_handy from int to u_int to avoid sign bugs.
Make ar(1) work more like its GNU and Solaris counterparts and not require an archive for the d,m,q and r operations.
Fix an mbuf-related panic in kernel PF_KEY v2 code.
More ANSIfication in /sbin.
Fix a potential (non-exploitable) buffer overrun in the httpd(8) macro FIX_PRECISION.
Add missing snprintf(3) error check to config(8).
When mounting the root partition via NFS, call inittodr(9) with the root filesystem's atime rather than its mtime (since it's likely to be read-only and pretty static).
Renumber some (debug only) tun(4) ioctls so they don't clash with ppp(4).
Make sure user(8) cleans up properly on failure by calling pw_abort(3).
Check the interface is running first to avoid doing unnecessary STP processing in bridge(4).
Before login_getcapstr(3) destroys the information, check that the value of $SHELL given to ssh(1) is the same as the user's real shell.
Remember to take the address of the structure on which we're using bzero(3) in the libc stack protector code.
Hack setsockopt(2) under linux emulation so that SO_REUSEADDR works as expected.
Use libc's getopt_long(3) instead of the private version found in a number of GNU programs.
Fix a typo in bridge(4) so that pf(4) actually gets applied to outbound frames...
Yet more string function paranoia in pfctl(8).
Allow bridge(4) to set the STP path cost.
Add support for regular expression matches in systrace(1) filters.
In systrace(1), don't allow 'permit' to be used on aliases.
Now that options to pf(4) rules can mostly be in any order, check for and disallow repeated options.
Handle '-' as stdin or stdout appropriately in uniq(1).
strncpy -> strlcpy in pfctl(8).
Make compress(1) accept most of gzip(1)'s long options. Some cleanup also.
Continuing compatibility tweaks to getopt_long(3).
pf(4) queue options can now be in any order. The 'scheduler' keyword is no longer used.
More rule shrinkage: The 'fromto' part of a pf(4) is now optional and defaults to 'all', so e.g. 'block' == 'block all' == 'block from any to any'.
pf(4) anchor rules now support parameters, so 'anchor name proto tcp from any to any port smtp' works.
Remove support for the '-a otp' flag from telnetd(8). Use login.conf(5) instead.
Make su(1)'s -a flag work again.
'pfctl -s' now prints out addresses in rules in the order they are entered.
When telnet(1) receives a SIGPIPE when writing to the terminal, treat it like a user SIGQUIT.
Have pfctl(8) use the actual interface MTU instead of assuming 1500.
Convert string key hashes in pfctl(8) to network byte order.
Fix a bug in Xaw that reads the wrong error return from open(2).
All the games set up the RNG with srandomdev(3) instead of by lesser means.
Have isakmpd(8) set the transform from the Default-Phase-1-Configuration.
Make srandomdev(3) fall back to using sysctl if it can't open /dev/arandom.
Make the libc getopt_long(3) more compatible with GNU.
Output from 'pfctl -v' is now valid input to pfctl(8).
Make section and tag comparisons in isakmpd(8) case-insensitive.
Allow a null direction in pf(4) rules, so e.g. 'block all' is now valid.
Add named rulesets support to pf(4), invoked from 'anchor' rules in the main ruleset.
Kernel memory allocation debugging can now be used anywhere - if the debugging pool is not yet initialised, it just does nothing.
Fixes to getopt_long(3).
Rule numbers are no longer output by 'pfctl -v'. Use '-v -v' to get them back.
Make scp(1) handle systems with odd block sizes better.
Drop unnecessary altq devices from the kernel.
Pass correct sizes to memset in ping6(8).
Make bridge(4) behave better when running spanning tree: Flush the dynamic MAC cache when the forwarding/blocking state changes, and only forward packets while in the forwarding state.
Make isakmpd(8) accept ACQUIRE requests with a null EXT_ADDRESS_SRC.
In pf(4), apply a netmask consistently.
Crank the major version numbers of the X libraries.
Continuing cleanup and shrinkage of the installer scripts.
arp(8) now prints the interface name with which an address is associated.
Big cleanup up mixerctl(1).
Import a GNUish getopt_long(3) from NetBSD.
Add -4 and -6 command line options to isakmpd(8) to select the address family to use.
Better MTU setting for pfsync(4).
Correct a missed initialiser in raid(4).
Have pfctl(8) play nice and shut down its sockets when it's done.
Crank all (system) library major numbers now that propolice is in.
Make a copy of rather than just refer to a string in ld(1). Cures some ports linking problems.
Allow options at the end of pf(4) pass and block rules to come in any order.
Make the bandwidth specifier optional in altq rules (as well as queue rules). As a side effect, the altq rules can now have "bandwidth xx%" where the percentage is taken w.r.t. the interface bandwidth.
Implement legacy functions ecvt(3), fcvt(3) and gcvt(3) for standards compliance.
Add propolice stack attack protection into gcc(1).
Updated unifdef(1).
Make a copy of the return value of basename() before recording it in the bfd, fixes the "NEEDED crtend.o" problem that many ports had to work around. [Applied to stable]
Don't have the X server drop privileges if started by root and from a non-standard config path.
Tweaks and fixes to pf(4)'s ioctl code.
Teach tcpdump(8) about pfsync(4).
Add new pseudo-device pfsync(4), exposing changes to the pf(4) state table.
Kill a null deref in pf(4).
Wrap some noisy altq printf()s with #ifdef ALTQ_DEBUG.
file(1) gets a new option, -b, which supresses the output of the pathname.
Allow a qlimit to be specified in pf(4) altq rules as well as in queue rules.
Use a custom hash function (based on that in if_bridge.c) for pf(4) source-hash nat pools instead of MD5.
tcpdump(8) checks for invalid icmp6 option length.
page_dir update fixed in realloc(3). MALLOC_OPTIONS=J is now honoured in realloc() as well.
'fc -e' now works when ksh(1) is invoked in 'sh' mode.
Allow usernames given to ssh(1) to contain '@' characters, i.e. the hostname follows the last '@'.
Tweaks to pf(4) altq rules display.
Stop daemon(3) closing descriptors that isakmpd(8) needs.
Have pfctl(8) read correctly the tbrsize spec.
Fix underflow and wraparound in socket timeout calculation.
Make IPv6 work in Linux emulation mode, though not for IPv4-mapped addresses.
The bandwidth statement in pf(4) queue rules is now optional.
Change pf.conf(5) ordering so translation is now after queue...
Parse more include files so that kdump(1) knows about more ioctls.
Pass in the right structure to DIOCCHANGEADDR.
Fix 'pfctl -Fq' so altq(9) gets flushed and reset properly.
setuid() -> seteuid() in ftpd(8).
Tweak pf(4)'s handling of address families in rules.
Make pfctl(8) fetch the address properly for lo(4) with LINK1 set.
Use 1KB = 1000B instead of 1024B when dealing with bandwidth in pf(4).
Fix URL CRLF injection bug in lynx(1).
[Applied to stable]
Add a missing check for snprintf errors in identd(8).
Protect arc4_getbyte() with an splhigh().
Some cleanup in talkd(8).
When malloc(3) stats dumps are enabled, warn if atexit(3) fails.
Enforce new pf.conf(5) ordering: options, normalization, translation, queue, filter.
Copy TAILQs properly in pfctl(8).
Remove a potential access-after-free in libc's syslog code.
New manual page gcc-local(1) documenting OpenBSD-specific changes to gcc(1).
So farewell, then, altqd(8) and friends.
Better pfctl(8) altq rule error checking.
Fix a potential null deref in pfctl(8)'s parser, and some general cleanup.
Make sure authpf(8) and pfctl(8) don't try to issue ioctls when running with -n.
Implement 'nat pools' in pf(4), allow redirection using (nat, rdr, route-to, dup-to and reply-to) to multiple addresses.
Improvements to the ELF loader.
Some snprintf paranoia in BSD auth, also some extra initialisation.
Added new example dir /usr/share/pf, and example queue rulebase /usr/share/pf/queue1 to show how cool pf+altq is.
Stop authpf(8) accepting non-interactive sessions.
'pfctl -v' displays altq and queue lines, including child queue assignment.
Match the queue to the return type (icmp-unreach or RST) for pf(4) block rules.
Use a quad_t instead of an int, and fix rlimit sizing for >2GB machines.
Fix some strncpy(3) lengths in telnetd(8).
Add _tokenadm and _radius groups so their respective login programs can be setgid instead of setuid(root).
Add _shadow group and change group and mode of /etc/spwd.db to match
Add atoll(3) and strerror_r(3) to libc.
Add simple multiple-card load balancing to crypto(9) and add a simplified driver registration API.
Some int -> unsigned int in isakmpd(8).
New -n option for syslogd(8) to disable DNS lookups.
Correct a format string bug in routed(8)'s, er, Makefile.
Fix at(1) breakage when two jobs are set for the same time.
[Applied to stable]
Correct a use-before-init in xterm(1).
Create a simple lookup table mechanism [dev/pci/pci.c:pci_matchbyid()] to match PCI device IDs, and have several drivers use it.
vi(1) catalog updates: Fix Russian, add Polish and Ukrainian.
Fix an off-by-one when reading ICMP types and codes by name in pfctl(8).
Merge of altq(9) and pf(4), still some work left to do.
Don't overwrite SIG{INT,QUIT,TERM} handlers in ssh(1) if they're set to ignore. This mirrors rsh(1) behaviour.
Make sure skey(1) issues a fake challenge for a user without an S/Key file.
Enable the pthread library, but install it as libnpthreads so autoconf scripts don't pick it up and use it with -lpthread as well as using -pthread.
In ftpd(8), prohibit user id changes once logged in, and run more stuff as the logged-in user.
Add 'Default-Phase-1-Configuration' to isakmpd(8).
Be more careful when loading RSA1 key files in ssh(1).
Fix isakmpd(8)'s handling of multiple values and continuation lines.
Improvements to ld.so(1) symbol lookup failure messages.
Allow DNS queries from the initial rulebase loaded by /etc/rc, so pfctl(8) can load at boot-time rulebases containing DNS entries.
SECURITY FIX: A buffer overflow in named(8) could allow an attacker to execute code with the privileges of named. On OpenBSD, named runs as a non-root user in a chrooted environment which mitigates the effects of this bug.
A source code patch is available.
[Applied to stable]
Create links from curses(3) libs to ncurses, to satisfy autoconfiguration scripts that expect the latter instead of checking properly.
pf(4) scrub rules now are subject to the same list expansion as other rules.
Add label macro '$if' to pf.conf(5), now we can have interfaces in expansion lists.
Add some missing pointer initialisations in pfctl(8).
Add a null transform to crypto(4), enabled via sysctl kern.cryptodevallowsoft=1.
Fix systrace(1)'s determination of the execve(2) filename.
Kernel IPsec code checks for short IP headers.
[Applied to stable]
systrace(1) checks for invalid system call numbers.
Make su(1)'s login emultation mode work even more like login(1).
Avoid a possible reference count leak in kernel file descriptor code.
Remove bogus operations on the not-yet-existent file descriptor table in libc_r.
Implement simple vnodeops inheritance for specfs and fifofs,
ftp(1) can now follow HTTP redirects.
Have scp(1) properly reflect check the exit status of its ssh(1) process if an error occurs.
Fix some invalid pointers in pf(4)'s ioctl(2) handler.
Stop makewhatis(8) moaning about non-existent directories.
Don't use the HostbasedAuthentication switch to ssh-keysign(8); instead, add new option EnableSSHKeysign to ssh_config(5).
Have groupdel(8) check that the named group exists.
Allow '$' as the last character of a username, to appease Samba.
Make sshd(8)'s -e option (log to stderr) work.
Make the minimum file rotation size 512 bytes instead of 512Kbytes...
Rearrange payload length check for ESP packets so packets with NULL encryption are tested also.
[Applied to stable]
Don't allow a simple non-existent server to crash altqstat(1).
Solve problems static linking with -lpthread. (-static -pthread still broken.)
Stop up a couple of memory leaks in isakmpd(8).
Fix a few bugs in mount(8), and make its command line arguments handling more consistent.
Keep a correct reference count to the file referenced by ioctl(2) under SVR4 emulation.
Gracefully handle broken firewalls that block ECN-enabled TCP sessions by falling back to non-ECN.
[Applied to stable]
Some thread-safety fixes to libc.
Add a cast to handle properly size_t larger than u_int in ssh(1).
Fix some problems gzip(1) had displaying information on files > 2GB.
Serve pf(4) a strong draught of CIDR (e.g. can use 10/8 now instead of 10.0.0.0/8).
-STABLE branch created for 3.2. smrsh, pfbridge and kadmind errata fixes applied to it.
When checking a filename in ssh(1), don't fail when realpath(3) for the user's home directory - this happens legitimately when using AFS.
Do a better job when comparing dynamic addresses in pf(4).
In pf(4) AF macros, operate on the whole address (all 128 bits) unless AF_INET is set.
Fix perl(1)'s MakeMaker so manpages get installed the way we like.
Plug a memory leak in IPv6 (ip6_output.c)
Make sure processes aren't added to the process list until they're completely initialised.
Implement some 4.3BSD emulation functions in terms of setresuid() etc.
Use the new setresuid() etc. calls for FreeBSD, HP-UX and Linux emulation of the same calls.
Implement [gs]etres[gu]id(2) system calls. Minor version bump for libc and libc_r.
Many fixes to signal and fd handing under threads.
Fix pf(4) interface expansion.
Better GRE output from tcpdump(8).
New -U option to chroot(8) that sets the uid, gid and group vector from the password database.
To a chorus of approval, add the 'set require-order [yes|no]' option to pf.conf(5).
Remove a bogus test in dd(1) that stopped a perfectly legal seek on a character device.
Merge mod_ssl 2.8.12, fixing a cross-site scripting bug and two off-by-ones.
[Applied to stable]
Add a missing break statement in systrace(1)'s arguments parsing code.
Add getdents64() support under Linux emulation.
Merge in Perl 5.8.0.
Have pool elements' sizes rounded up to the alignment passed to pool_init(9) instead of relying on the architecture's ALIGNBYTES value.
wi(4) can now do pointless-but-common WEP encryption in software for Prism and Symbol cards. Useful if your card doesn't do weak IV avoidance (or if you trust your BSD more than your hardware manufacturer,) and also serves as a framework for better wireless crypto protocols.
The installer unpacks siteXX.{tgz,tar.gz} files last so that site-specific tarballs always overwrite standard files.
Remove the error-prone and robustness-principle-defying 'flags X' (as opposed to 'flags X/Y') syntax from pf(4)
Be a little less 32-bit-centric in libcrypto.
Have route6d(8) and rtsold(8) use poll(2) instead of select(2) as well.
Change atoi(3) to strtoul(3) in route6d(8).
Change a number of header files so NULL is now defined as 0L instead of 0, and so is the same size as a pointer.
Add to chroot(8) the ability to set the uid, gid and group vector after doing the chroot(2) call.
Some additional paranoia added to authpf(8).
Have pf(4) test rule labels as well when comparing rules.
Fix a few instances where %ul was used instead of %lu.
Use poll(2) instead of select(2) in ping6(8)
More picky argument parsing in traceroute6(8) and ping6(8).
A couple of tmpnam(3)s become mkstemp(3) in httpd(8).
Lots of int -> u_long in traceroute6(8).
Correct an off-by-one in wi(4).
Fix a printf format string typo in pfctl(8).
Make pfctl(8) apply the netmask to addresses right away, so bogus netmasks show up as munges network numbers in -v output.
Correct a couple of typos in pf(4)'s ioctl() code.
Fix a null deref in libc_r.
Make sure the user process tally is right when kernel stack space can't be allocated for the new proc.
Correctly count the total number of processes in the system.
SECURITY FIX: A buffer overflow can occur in the kadmind(8) daemon, leading to possible remote crash or exploit.
A source code patch is available.
[Applied to stable]
Add partial support for the 21145 chip to dc(4).
Have xconsole(1) get a pseudoterminal using openpty(3) instead of going all #ifdef.
More NULL -> (void *)NULL, this time in XFree, to make sure varargs sentinel is pointer-width.
pax(1) now honours @LongLink, and has a new option to stop the next volume prompt.
Improved media support and a boundary check fix for wi(4).
Have route(8) correctly interpret -prefixlen 32 (or 128 for IPv6) network as a host route.
Enable uvm_tree_sanity() check #ifdef DEBUG.
Fix a potential null deref in route(8)'s arguments parser.
Renumber ch(4) CHIO* ioctls. Old definitions renamed to OCHIO*, binary backwards compatibility will be left in intact until post-3.3.
Teach kdump(1) to print AUDIO_* ioctls, and add a few missing syscall defines.
Support fxp(4) on big-endian architectures.
pf(4) allows protocols to be specified by a (valid) protocol number.
Add a missing free() in pflogd(8).
Treat manually- and auto-configured IPv6 address prefixes the same way.
For positively POSIX reasons, implement isfdtype(3).
Bring pax(1)'s date handling code back into sync with that in date(1). Four digit years parse now.
Start to break out machine-dependent parts of MAKEDEV(8) into separate files.
Send ksh.kshrc label() and ilabel() output to /dev/tty insted of stdout, so command output streams doesn't get messed up.
systrace(1) supports system call-granularity privilege elevation!
Correct a typo in systrace(1) that was causing group predicates to be evaluated incorrectly.
Range-check values given to atactl(8).
Better mask comparison for pf(4) binat.
Remove the setuid bit from login(1). If run with a non-root euid, it invokes su(1) with the new -L flag.
Add '-L' flag to su(1) to make it work like login(1).
Enable the META key in ksh(1) for 7-bit locales.
Make sure some varargs end-of-list sentinel NULLs are pointer-width.
Fix a subtle dangling pointer bug in BSD auth.
Sync Brazil's Daylight Savings Time handling with new reality.
[Applied to stable]
Stop makewhatis(8) grumbling about having Perl 5.8.x instead of 5.6.x.
In the X server, work around problems caused by certain MTRR configurations whose details are only available under NDA.
Kernel tweaks and hacks in preparation for GCC 3.x (kern/subr_prf.c)
A logic error in the pool(9) kernel memory allocator could cause memory corruption in low-memory situations, causing the system to crash.
A source code patch is available.
[Applied to stable]
pf(4) can now binat a whole netblock with one rule.
Remove a potential null pointer deref in BSD authentication code.
Fix a bad printf format string in ftpd(8). Non-critical because it's only ever fed by parts of the authentication system which sanitise the input first.
[Applied to stable]
Do some more unsigned checks to system call parameters, as with the setitimer(2) erratum.
[Applied to stable]
Prepare the GNU floating-point emulation code on i386 for ELF.
Update stable to OpenSSH 3.5.
Catch some endianness nits and add zero-padding of keys in wi(4).
Teach ALTQ CBQ the pf(4) API. The old API remains for now.
RELIABILITY FIX: Network bridges running pf with scrubbing enabled could cause mbuf corruption, causing the system to crash.
A source code patch is available.
[Applied to stable]
Fix a bug in m_tag_copy_chain().
Hush up noisy IPv6 neighbor discovery. Can be made loud again using sysctl net.inet6.icmp6.nd6_debug.
SECURITY FIX: An attacker can bypass the restrictions imposed by sendmail's restricted shell, smrsh(8), and execute arbitrary commands with the privileges of his own account.
A source code patch is available.
[Applied to stable]
Make predicates part of systrace(1)'s grammar.
Start work on a merge of altq(9) and pf(4) functionality. Oh yes.
Add a missing htons() in talkd(8).
In pmdb, fix a crash that occurred when an attempt to set a breakpoint failed.
Support SA_RESETHAND support to libc_r, in preparation for SA_SIGINFO support.
Merge in Apache 1.3.27 and mod_ssl 2.8.11.
New block-policy option to set the default response to a block rule.
More rulebase reduction: "block return ..." now does The Right Thing, RST for TCP, ICMP for UDP, silent block otherwise.
pf(4) support for icmpv6 returns in response to block rules.
New reply-to rule option for pf(4), works like route-to but applies to reply packets in a stateful connection.
httpd(8) restarts work even when srm.conf is not present.
Have the X server complain less about unknown scancodes.
Initialise the uvm_pglistalloc result list in the function, instead of requiring the caller to do it.
syslog(3) and syslog_r(3) now take the new __syslog__ format attribute.
Make the default httpd(8) config files use php4 instead of php3.
pfctl(8) expands lists left-to-right instead of right-to-left.
Teach pf(4) how to filter on the IP TOS field.
Fix list handling problem in ALTQ CBQ that showed up with three or more CBQ instances.
smtpd(8) has left the building.
By default, add the -H option to the sort(1) invoked by locate.updatedb(8).
Give window(1) the stdarg treatment.
When routing via pf(4), use the outgoing interface as decided by the normal routing code, not the interface to which the rule applies.
Fix cross-site scripting vulnerability (CAN-2002-0840) in the default error page of httpd(8). Only applies under specific (and non-OpenBSD default) conditions. [Applied to stable]
In kernel IP processing, block interrupts with splsoftnet(9) around interface address routing table manipulations.
Make sure wi(4) doesn't accept out-of-range TX keys.
Stop ami(4) matching I2O-configured devices.
3.2 -> 3.2-current.
--------
Changes made between OpenBSD 3.1 and 3.2
Release branch created.
Cool new xdm(1) images for 3.2.
SECURITY FIX: Incorrect argument checking in the setitimer(2) system call may allow an attacker to write to kernel memory.
A source code patch is available.
[Applied to stable]
Retrofit the SIGUSR1->SIGUSR2 console switching change to the old X server.
Fix a couple of crashers in kevent(2).
OpenBSD 3.2-beta -> 3.2, OpenSSH -> 3.5.
Try to initialise AGP GART in the privileged startup portion of the X server.
Plug a memory leak in url(4).
login_radius returns, complete with fixed license.
Still more cleanup and output trimming in the installer script.
xf86cfg(1) now runs the server with '-nolisten tcp'.
xdm(1) now drops privileges to run as user _x11 after starting as root.
daddr -> saddr in pf(4) binat code. Oops.
[Applied to stable]
Add a wildcard client string match against "probe-*" for SSH probes to use.
Disable login_radius, pesky licensing problems again.
[Applied to stable]
sppp(4) and lmc(4) are back, with better licenses.
ssh(1) can now do privsep and krb4 together.
Remove RC5 and MDC2 from libcrypto.
Have the installer set the nosuid flag for mount points that shouldn't contain setuid programs.
Fix a sizeof bug in bridge(4) spanning tree protocol support.
New driver em(4), supporting Intel Gigibit Ethernet adapters and replacing gx(4)
Some memory allocation and other tweaks to talkd(8).
Better handling of IPv6 deprecated addresses.
Fix the padding length for an IPv6 PADN option before a jumbo payload option.
Allow SSL session IDs of any length up to 32, removing the non-standard 16-char minimum imposed before.
Add a /dev/X0 entry for xdm(1), allowing the mouse to work with the upcoming xdm privilege drop. One for the Upgrading Mini-faq.
Properly dump radix tree nodes in netstat(1).
Template policy support for systrace(1).
sppp(4), lmc(4) and cz(4) drivers removed from release kernels due to license problems.
A bunch of gcc3 tweaks.
Don't build Kerberos ticket forwarding programs kf(1) and kfd(8) because of security issues. (Will come back when Heimdal 0.5 gets merged, after 3.2 release.)
Add support for ELF sections loaded relative to a base section.
Make pfctl(8)'s antispoof command also block incoming packets with the source set to one of the host's IP addresses.
Make the VT switching code use SIGUSR2 instead of SIGUSR1. The latter is also used by the X server to synchronise with xinit.
Have newsyslog(8) handle with more grace situations where some archived logfiles have been uncompressed in-place.
Continue to reduce the amount of output the installer generates, so we won't need a magnifier to read the installation instructions in the CD gatefold.
Add TBI (Ten-Bit Interface) mode support for fibre-based nge(4) cards, as well as some other bug fixes.
Make newsyslog(8) actually run the command it's asked to run. Also, add new interpretation of a null command.
Fix newsyslog(8)'s handling of empty lines.
Remove the obsolete access.conf and srm.conf files from httpd(8).
Make sure ssh(1) ProxyCommand programs get killed on exit (portable OpenSSH bug #223).
Fix a potential FREE() of an uninitialised pointer in the kernel (sys/exec_script.c)
Rewrite tcpdump(8)'s GRE decoder.
Fix signal trampoline problems with non-exec stack.
Remove EGP decode support from tcpdump(8) due to a duff license and apathy.
So farewell, then, trsp(8).
Allow newsyslog(8) to rotate only specific logfiles.
Make RAND_poll use arc4random(3) instead of /dev/arandom, so it works in under a chroot.
New -a flag to newsyslog(8) allows a directory to be specified for archived logs.
Set the close-on-exec flag for file descriptors created by kvm_open(3).
Fix DMA-related panics in the twe(4) driver.
In ssh(1), try harder to create the X11 forwarding listener socket.
Fix a potential buffer overrun in setlocale(3) (NetBSD-SA2002-012).
Don't chdir to / when systrace(1) goes daemon.
Add __syslog__ string formatting attribute to gcc(1).
Periodically save changes to systrace(1) policies.
Various fixes to newsyslog(8).
Re-sync the siop(4) driver with NetBSD.
Signal fixes in libevent.
Merge in Sendmail 8.12.6.
Give stdio's __cleanup handlers the same mprotect() treatment as atexit(3) now receives.
Further tweaks to handling of address families in NAT rules. Try to infer the AF from the rule, if that fails then require the user to specify it.
Various fixes to cy(4).
Merge in OpenSSL-0.9.7-stable-SNAP-20020911, bump libcrypto minor version.
Stop newsyslog(8) rotating logfiles that only contain logfile rotation messages.
License fixes to pppd(8), nearly there now.
Add -H option to identd(8) which hides info for non-existent users as well as existing ones. Useful when NATing.
Remove the need for /dev/null and /etc/localtime in named(8)'s chroot jail.
Add 'antispoof' keyword to pfctl(8). Oh yes.
Improvements to pfctl(8)'s netmask handling.
Add a missing pointer initialisation in in6_ifdetach().
Make the sftp(1) client's ls command useful, with globbing and short/long listings.
Fix initialisation of Broadcom 582x chips by ubsec(4).
Various signedness fixes.
Versioning info moves to 3.2-beta.
Have ssh-agent(1) check the peer using getpeereid(2).
pmap_{copy,zero}_page API changes.
Merge in OpenSSL 0.9.7beta3.
amd(8) now creates a socket listening on 127.0.0.1 as well as one on *, and only responds to amq requests on the former.
Add support for the Silicon Image 680 ATA133 chip to the pciide(4) driver.
sshd(8) now supports Kerberos authentication in PrivSep mode.
pf(4)'s parser takes more care parsing address families in NAT rules.
Add leap second support to rdate(8) running in RFC868 mode (it already supports this in NTP mode with the -N option).
Correct altq(9)'s representation of positive infinity.
Signal handler fixes in bootpd(8), rtadvd(8) and rtsold(8).
faithd(8) dies on FD_SET overruns.
Fix a couple of off-by-ones in mopd(8).
Make fsck(8) work properly with long block device filenames (handle MAXPATHLEN chars instead of 32).
Don't build the somewhat less than ubiquitous photurisd(8) by default any more.
Lots and lots of ANSIfication.
Lots of int -> socklen_t.
Some signedness fixes to arp(8).
Repair a missing msglog() arg in routed(8).
Fix ahc(4)'s interrupt sharing.
libusbhid(3) now available in the shared variety.
Don't allow data to be appended to the receive buffer of a socket that's been shut down (see NetBSD PR#18185).
Merge in OpenSSL 0.9.7beta1. To be continued.
isakmpd(8) interoperability fixes for FreeS/WAN and SSH Sentinel.
Make rwalld(8) revoke its group privileges as well as user privs.
Don't install safe_finger any more.
Add support for the SCSI Reduced Block Command Set (RBC).
Bump sshd(8)'s LoginGraceTime from one minute to two.
Various compatibility fixes and additions to ubsec(4).
ifconfig(8) can now set whether or not use of IPv6 deprecated addresses are allowed.
_x11 user and group added for xdm(1) to use.
Pull in XFree86's fix for a serious Xlib security bug (which didn't affect OpenBSD).
Fix parsing of NAT port ranges.
Check the interface specified with route-to/dup-to/fastroute actually exists. If it does, null terminate its name before moving on.
Fix an uninitialised pointer bug in ld.so(1).
The X server now tries to open the aperture driver before trying /dev/mem. Re-enable early privilege drop on i386.
traceroute(8) now warns if DNS returns multiple addresses, like traceroute6.
Add support for the Promise Ultra133 TX2 EIDE controller.
Fix an mbuf leak in wi(4).
Reenable the atexit(3) handler improvements backed out on 31 July.
Add -I option to traceroute6(8) to get ICMP probes instead of UDP.
Further reduce the amount of time ssh(1) runs as root when installed setuid.
Fudge isakmpd(8) so it only honours the requirement to check against a CRL if there is a CRL loaded...
Update the rt(4) Radiotrack driver, add isapnp support.
Some casts to make 64-bit kernel work with varargs calls.
Fixes to gem(4).
Properly limit EDNS0 size to 0xffff.
Fix a signedness problem in SSH so that RSA_public_decrypt(3) errors can be detected.
Make X's module loader set PROT_EXEC using mprotect(2) on malloc'd pages containing code (needed since the heap is now mapped without PROT_EXEC).
DNS responses from getaddrinfo(3), gethostby*() and getnetby*() now get a 64K receive buffer.
[Applied to stable]
traceroute6(8) warns if DNS returns multiple IP addresses for the target.
Do a yyrestart() after a longjmp in pcap(3).
Fix a dangling pointer bug in sbcompress().
Make the X server option NoSilkenMouse work again.
Make portmap(8) detect failure of svc_register and die nicely.
X aperture driver for Alpha, works like i386.
Skeleton ld.so(1) support for ELF in i386. Not enabled, nor is it promised anytime soon.
ld.so(1) warns about symbol size mismatches.
inet_ntop(3) handles snprintf errors properly.
Map the heap non-executable.
Change the way FREF() and FRELE() are called w.r.t. getvnode() and getsock().
Fix a locking problem that can occur when an executable tries to exec(3) itself.
Avoid a potential int overflow in comsat(8)
Make the resolver ignore DNS AAAA replies containing IPv4-mapped addresses.
Bump the listen() backlog from 5 to 128 (!) in ssh-agent(1).
sshd(8)'s default LoginGraceTime reduced from 600 to 60 seconds.
wscons(4) now attaches to each wsdisplay device by default.
Fixes to strip(1). -x now works.
net.inet6.ip6_use_deprecated is on by default again...
Fix some (but not all) signal races in fsck_ffs(8).
New -n option to ftpd(8) that disallows anonymous access even if the ftp user exists.
Perform /tmp/.{X11,ICE}-unix fixups before the system goes multiuser.
Fix sysctl copyout(9)s in IPv6 neigbour discovery.
Audit and cleanup of inet_net_ntop(3), inet_neta() and inet_ntop(3).
TCP now tries to act appropriately w.r.t. net.inet6.ip6_use_deprecated.
Use of IPv6 deprecated addresses switched off by default. (See RFC2462 and sysctl(8) variable net.inet6.ip6_use_deprecated.)
Fixes to the isp(4) SCSI driver.
Correct two sizeof bugs in crypto(9).
Allow a raw IP socket to see a gre(4) packets for tunnels we haven't configured.
Add some more cross-compilation targets in /usr/src/Makefile.
Backfit Perl 5.80's File::Glob implementation (based on OpenBSD's code) to our perl(1).
Fix a null pointer dereference in pfctl(8).
Using the state table instead of a special-purpose list, allow pf(4) NAT to use the same proxy port for multiple external peers.
Make ssh-agent(1) setgid(_sshagnt). setuid/setgid processes can't be ptrace(2)ed.
SPARC consoles now use wscons(4).
traceroute(8) now displays '!X' when packets come back as ICMP administratively prohibited by filter.
Have rsh(1) die on fd_set overruns.
In a number of places, switch the calloc(3) round the right way.
Switch SPARC to ELF.
Fix an XFree runtime loader problem seen on Alpha, PowerPC, SPARC and SPARC64.
SECURITY FIX: An insufficient boundary check in the select(2) and poll(2) system calls allows an attacker to overwrite kernel memory and execute arbitrary code in kernel context.
A source code patch is available.
[Applied to stable]
raid(4) no longer gets loud at boot time unless option RAIDDEBUG is used.
Sink a few bugs in bs(6).
Fix raw socket translation for Linux compatibility mode.
Properly clear the argument list in pmdb.
Die on fd_set overrun in mtrace(8), map-mbone(8) and mrouted(8) (not built by default).
When emulating Linux, don't have accept()ed sockets inherit flags from the listen socket.
[Applied to 3.1-stable]
Fix snprintf length in syslogd(8).
Correct a sizeof bug in photurisd(8).
Tweak IFF_PROMISC handling in wi(4) to avoid some unnecessary initialisations.
Fix a potential off-by-one in ld.so(1) that could cause mmap breakage on some architectures.
Make insertion of data into socket buffers run in constant time, a huge win especially with large buffers.
Relax slightly the conditions under which a TCP SYN packet will trigger the sequence number modulator. Handy for systems with ECN stacks.
Fix a number of && -> & bit-test typos in OpenSSH (v1 RSA key use,) routed(8), pic(1), fvwm(1) and a few in the kernel.
Add a couple of missing open(2) mode args in afsd(8) and msgs(1).
Improve TX interrupt handing in be(4/SPARC,4/SPARC64).
Fixes to mrinfo(8) (this isn't built by default).
Improve systrace(1)'s handling of interrupted system calls.
Fix a free-in-caught-alloc-failure-block (!) in ohci(4).
Rewrite the CRL support in isakmpd(8). Check for OpenSSL >= 0.9.7, the earliest supported version for now.
Retrofit the new early privilege revocation code to the old X servers.
xlock(1) defaults to blank mode (rather than random mode). Also remove bomb mode altogether, to the annoyance of noone.
Several fixes to the hme(4/SPARC, 4/SPARC64) driver.
Restore struct link_map ABI compatibility between ld.so and gdb, broken by the split of link.h into separate MI, ELF and a.out files.
Move AGP chipset support out of machine-independent section (AGP support is per-arch).
REVISED SECURITY FIX for the OpenSSL ASN.1 buffer overflows, see the erratum.
[Applied to stable]
Fix auth_call(3)'s error logging.
cron(8) cross-checks the crontab filename against the system username.
netstat(1) drops its privileges earlier.
systrace(1) can log matching rules to syslog.
write(1) drops privileges after opening the tty.
Refactor vmstat(8) slightly so kvm(3) is only ever opened once (it could be opened a second time by dkstats.c before).
Open the kvm(3) library earlier in fstat(1) and systat(1), and so drop privs earlier.
Test for a previously unchecked malloc() return value in the RPC library, and die unceremoniously on failure.
Catch file read errors in rdate(8)'s leapsecond handler.
Cleanup of amd(8).
Remove Kerberos support from the default login.conf (and its hardwired defaults for when login.conf is absent). See the log for why.
No more RPC by default. Expect a lot of 'NFS is broken' email to misc@ when 3.2 is released.
Rework some aspects of crontab(1)'s file checks.
Provide our own RSA_verify(3) implementation for OpenSSH.
Add the _sshagnt group for use by ssh-agent(1).
Correct a pointer comparison typo in libssl's ASN.1 parser library.
Check for correct return value of inet_aton(3) in isakmpd(8).
Add some overflow checks similar to the calloc(3) patch to ssh(1).
isakmpd(8) support for certificate revocation lists.
Prevent integer overflow in i386 USER_LDT code.
Fix NFS's handling of zero-length RPC fragments.
systrace(1) handles unlinking of a symlink correctly.
Limit file size to 2^31 * PAGE_SIZE in FFS code.
u_short -> u_int16_t in mtrouted(8).
REVISED SECURITY FIX for the xdr_array(3) buffer overflow, see the erratum.
[Applied to stable]
Spot zero-length keys or values in ypmatch_add(), and exit early.
Broken by the removal of atexit(3), chpass(1) now cleans up after itself properly again.
Use fork(2) instead of vfork(2) in make(1). Fixes hppa breakage.
Back out the new atexit(3) handler changes which appear to break Perl somehow. Bugger.
Get calloc(3) semantics right, while still not allowing the size_t overflow.
[Applied to stable]
Fix httpd(8) compilation without mod_ssl.
On i386, allow mprotect(2) to alter the execution protection of the stack.
Fix some more potential null pointer dereferences, this time in pfkey and netiso.
Plug a kqueue(2) file descriptor leak in the X server.
Have libc opendir(3) and scandir(3) check for size_t overflows like the new calloc().
Like in libc, fix the calloc() implementation in named(8) (only used by a feature disabled in OpenBSD).
Lots of work on the sparc and sparc64 console drivers.
Kernel IPsec was only doing ESP integrity checks on NICs that had already done so in hardware...
Fix a typo that caused a potential null pointer dereference in kernel NFS.
New 'PermitUserEnvironment' option for SSH. Off by default.
Add 'with or without modification' clause to gprof(1) licensing.
Sync with OpenSSL 0.9.6e-0.9.7 CHANGES file.
SECURITY FIX: Several remote buffer overflows can occur in the SSL2 server and SSL3 client of the ssl(8) library, as in the ASN.1 parser code in the crypto(3) library, all of them being potentially remotely exploitable.
A source code patch is available.
[Applied to stable]
In pf(4), allow TCP flags to be specified in all rules that include TCP (before the rules had to be exclusively TCP).
Fix a buffer overflow in backgammon(6), and replace its gameplay algorithm.
Kill a kernel tty memory leak.
[Applied to stable]
Super-cautious strcpy()->strlcpy() in exec*(3).
Return failure if the parameters given to calloc(3) would cause an overflow of size_t.
[Applied to stable]
Don't enable so many authentication methods by default in login.conf(5).
SECURITY FIX: A buffer overflow can occur in the xdr_array(3) RPC code, leading to possible remote crash.
A source code patch is available.
[Applied to stable]
Privilege drop in new X servers is disabled for now on x86 due to a problem with xf86OpenConsole().
Support DMA for two more ServerWorks pciide(4) devices.
SECURITY FIX: A race condition exists in the pppd(8) daemon which may cause it to alter the file permissions of an arbitrary file.
A source code patch is available.
[Applied to stable]
mprotect(2) function pointers stored by atexit(3) to stop bad guys tweaking the exit handlers.
"undrugs" gpr(4).
Fix two off-by-one bugs in ext2fs.
Add ld.so support for sparc.
Lookup of ip6.arpa, then ip6.int for IPv6 reverse resolution. See RFC3152 for why.
Small fix for GCC 3.1.1 in IPv4 checksum code.
Apply the 'broken PCI burst-write' workaround to all hifn(4) 7811-based devices.
Show uftdi(4) how to use hardware and software flow control.
Fix a potential access-after-free() in kue(4).
/tmp/.X11-unix and /tmp/.ICE-unix are created in rc, owned by root, removing the need for root privs later on.
Again, this time in ld(1), map BSS non-executable.
Rearrange the new XFree86 server so all tasks for which root privs are needed get done early in osinit(). Of course, revoke root right afterwards.
Add Dell-specific PERC (right) product IDs so that aac(4) configures Dell PowerEdge 2650 RAID.
Add leapsecond support to rdate(8)'s NTP client.
The install/upgrade scripts no longer automatically mount NFS filesystems.
Kernel a.out code now allocates (mostly) non-executable BSS.
Miscellaneous fixes to several games.
Lots of work on the sparc64 creator(4/sparc64) framebuffer driver.
In pf(4) the order of the log and quick keywords is now irrelevant.
Allow X servers to be built without DGA.
At securelevel 2, stop an attacker from setting the clock forwards to within a year of the time it wraps around to zero.
Allow altq(9) to work on pre-Pentium x86 machines that lack pentium_mhz stuff.
Add a distrib note that due to major changes to the port, the sparc installer won't allow upgrades to 3.2
Only include a single wscons(4) font when building with option SMALL_KERNEL.
Add a few more RFC2142-suggested mailbox aliases.
Improve mg(1)'s filename handling.
More hifn(4) fixes.
Fix comparison bug in IPv6 multicast routing MTU check.
Correct bad sizeof() in kernel NFS code.
Checks for snprintf(3) return values < 0.
Improve systrace(1)'s uid/gid tracking.
Fix the csh(1) large directory fix.
In ssh(1), help avoid a potential man-in-the-middle attack by showing all known host keys for a host when we're warning about an unknown host key.
Fix a TAILQ null deref in pmdb.
Make the second parameter to r?index()/strr?chr() an int instead of a char.
Stick a thread mutex around name lookups in getaddrinfo(3).
Fix a systrace(1) double free().
CardBus support for macppc.
Fix dc(4) cardbus reads.
Remove a signedness bug in sshd(8)'s handling of utmp_len (-u option).
Fix some bugs in pool(9).
More additions to GNU as(1), this time to make Ogle compile.
Fix graceful restarts of chroot'ed httpd(8).
Have SSH fall back to the standard path if setusercontext() can't set it.
Add a sequence number to kernel messages for systrace(1).
Teach pmdb about corefiles.
Map stack pages non-executable.
noct(4) now works around NSP2000 PCI bridge brokenness. Fix a similar problem in hifn(4).
Drop the requirement for commas in many pf(4) lists, useful when used in conjunction with the new variable concat feature.
Implement string concatenation for variable declarations in pf(4).
Big change to the way signal trampolines are stored and called.
Add milter build support to sendmail(8), see the Makefile.
Make sudo(8) and inetd(8) die if setusercontext() fails.
Fix a disk masher bug in siop(4), a little too late for some.
Don't install mk-amd-map(8) any more, we don't use it. And it's broken.
Merge Apache 1.3.26 and mod_ssl 2.8.10.
Have SSH remove fatal cleanups after calling fork().
/etc/systrace directory added along with policies for named(8) and lpd(8).
Make OpenSSL use /bin/sh instead of $SHELL when running scripts. Not everyone uses a Bourne-like shell.
String handling and other fixes to rogue(6).
Fix pax(1) -s replacement string truncation.
Fix a deref after free() in the kernel's routing socket code.
Add 'fdcache' to Apache, part of the work to make graceful restart work properly under the chroot().
The search for a shorter rulebase continues, pf(4) now recognises 'self' as an address, meaning all IPv4 and IPv6 addresses on all interfaces.
Fix wayward string termination in rbootd(8).
Fix a DIAGNOSTIC bug in ffs_softupdates(4), and also make panic() calls show the right type.
Some mbuf Fixes to the hifn(4) driver, more fixes to come.
Add DES and 3DES to noct(4) as well.
Fix some broken memset() and lseek() calls.
Work around some limitations of noct(4) hardware. Add MD5 and SHA1 support.
Small additions to as(1) to make gnupg compile.
Add some new users (names beginning with underscore) to replace user nobody for portmap, rstatd, identd, rusersd and fingerd.
Fix csh(1) directory completion SIGSEGV with large directories.
Make atrun(8) part of cron(8), removing the need for the atrun cronjob.
More pf(4): accept !<interface> syntax. Oh yes.
top(1) now has a BSD license.
pf(4) parser spots more silly combinations (return-rst on non-TCP rules, keep-state on block rules).
Fix a double free in BSD authentication.
Make ftpd(8) always use high port numbers for passive data connections (no more -h option).
Add SIGALRM to the list of signals that can be sent (after uid/euid checks) to set[ug]id child processes.
Enable list expansion for pf(4) NAT rules, broken since the pf.conf/nat.conf merge.
The XFree86 3.3.x servers that are left now revoke their root privileges right after getting I/O access.
Now that xterm(1) drops its root privileges, install it setgid(utmp) for utmp updates. Revoke setgid too if not needed.
Fix at least one tcpdump(8) buffer overflow.
[Applied to stable]
Teach MMX (not SSE) to as(1).
Add radio(4) device attachment for bktr(4) and fms(4).
Have pcibios(4) detect and ignore a too-short PCI IRQ routing table header.
Changes to ld.so(1): Search order now always looks like a.out, destructors are called on dlclose(), move some libc-like functions into private namespace.
Add support for AGP GART on some i386 AGP chipsets (see vga(4) and options(4)).
Remove '\\' -> '\' translation in crontabs to keep the shell happy.
Make xterm(1) revoke its root privileges.
Remove a race and some other bugs from the mountpoint locking code.
Add some flags to dohooks(8) and fix a time-honoured memory leak in hook_disestablish(9).
New, hard-won firmware image for the txp(4) driver.
Remove the www group's privileges to the mod_ssl mutex semaphore.
Really remove SuperProbe from X.
Create a skeleton UserDir tree under /var/www/users.
Have Apache initialise OpenSSL (opening /dev/crypto) before chroot. No more /var/www/dev/crypto.
Basic IPv6 fragment support (no normalisation yet) in pf(4).
Correct a memcpy error in the kernel and ssh's Rijndael code.
Make systrace(1) filename intercepts work with chroot().
Try to make resetting of USB ports work better.
Add fchmod translation support to systrace(1).
Stop systrace(1) closing the std file descriptors when going daemon.
Fix ni6_nametodns() pointer bug in icmp6; NetBSD PR17540.
Add support in uftdi(4) for FT8U232AM-based USB serial adapters, likewise add more devices to uplcom(4).
Fix miniroot typo that was breaking FTP installs.
Fix sed(1)'s r command (PR2755).
Add a daemon mode to systrace(1).
udbsr(4) driver for D-Link radio cards added.
Add a timeout value to USB I/O calls, rather than having a systemwide timeout.
Make httpd(8) chroot() and drop root privileges by default. A lot module chroot fixes to come.
Add syscall aliasing to systrace(1) (e.g. stat/fstat/readlink/access/... become 'fsread').
Some fixes to umidi(4) and uscanner(4).
Add SMC 2206 support to aue(4).
Fix a potential off-by-five error in systrace(1).
pf(4) now accepts an interface in most of the places it can take an IP address, and picks up all the IPv4 and IPv6 addresses on that interface.
Don't try to load a 32-bit quart into a 16-bit pint register in xl(4).
Always load ELF binaries to the address at which they were linked.
Rig opendir(3)'s sort so it can't fail due to lack of memory.
Compatibility fixes for the ubsec(4) 582x series.
Some updates to cron(8).
Grab a security fix to bcopy/memcpy from FreeBSD. See their cvsweb entry for bcopy.S.
Work around tl(4)'s broken multicast filter.
Remove ab(1) from the Apache installation.
Remove NTP support from the kernel.
Don't attempt to resubmit a structure we just freed in ipsec(4) / ipcomp(4).
Small fixes to IP-in-IP encapsulation code.
Add Security Mode options to atactl(8).
Support a few more HPT pciide(4) cards.
Make NEED_VERSION obsolete in bsd.port.mk(5).
Fill IPv6 null pointer dereference in cvs(1) pserver.
Remove some old upgrade hacks from the installer script.
pf(4) chokes on invalid '! <interface>' syntax, instead of just ignoring the '!'.
Fix pf(4) interface stats, and allow the loginterface feature to be disabled.
Make signal handler flags in isakmpd(8) of type volatile sig_atomic_t.
Fix a few GCC 3.1 moans in isakmpd(8).
Un-bloating of ahc(4).
Cleanup of rpcgen(1).
RELIABILITY FIX: Don't assume we have an active exchange during payload validation, otherwise isakmpd(8) can be made to crash.
A source code patch exists to remedy the problem.
[Applied to stable]
ep(4) on isapnp(4) now works on alpha.
Improve the way the installer's fileset selection UI works.
Fix a potential buffer overflow in xsystrace.
Add a note to the unwary in distrib/notes about the danger of skipping several versions when upgrading.
Don't have ssh(1) allocate memory for stuff we don't need, just to discard it straight away.
Set IP_PORTRANGE_HIGH for active mode data channel of ftp(1).
Add some more usb(4) product IDs.
Fix an off-by-one error in rmt(8) and improve string handling in general.
Normalise nc(1)'s EOF handling.
Plug a few ssh(1) memory leaks.
Tweak the tga(4/ALPHA) driver.
Fix several missing or broken malloc(3) and realloc(3) failure checks.
In rcs(1), actually exit(3) after spotting that LocalId is too long.
Lots of ANSIfication of function declarations and prototypes.
Fix bug causing 'SPL NOT LOWERED' errors from the ami(4) RAID controller.
Give ssh-keysign(8) its setuid(root) toys back, but only work at all if HostbasedAuthentication is globally disabled.
Use RSA_blinding_on(3) to ward off a Kocher timing attack on ssh-keysign(8).
Fix signal(3) race in ping(8).
Remove adv(4) from the i386 RAMDISK kernel until new ahc(4) un-bloats itself.
Catch a null pointer dereference when fetching the routing table via sysctl(3).
Make sis(4) compile and work on alpha.
Return correct result sizes from ubsec(4).
bridge(4) will now compile with ipsec(4) but no pf(4).
Cleanup of ftpd(8).
Fix PIO writes code in wdc(4), broken since OpenBSD 2.5!
Remove unnecessary longjmp(3) from login(1).
Pages allocated with debug_malloc() aren't ever executed, so don't use VM_PROT_ALL.
Finally fix bridge(4) address cache bug.
Properly handle endpoint differences of opinion on ssh(1) Compression options
Fix the wsdisplay(4) blanker after the X server has been running.
Make the installer deal correctly with passwords starting with '-X ' for some X, instead of misinterpreting them as options to encrypt(1).
Fix some compatibility quirks in ppp(8).
Add a pushback buffer to pfctl(8)'s parser.
Remove setuid(root) from ssh-keysign(8), disabling it for now.
Have named(8) call tzset(3) so /etc/localtime isn't needed after the chroot(2).
More fixes to the new ahc(4) driver.
Add AlphaServer 800 and 1000 support.
Enable lc(4) devices in alpha GENERIC kernel.
Fix isapnp(4) panics on alpha.
Make xf86config give the option of configuring a mouse wheel.
Gracefully handle i386_iopl(2) failure in the X server when trying to give up privileges.
Add wscons(4) files to fbtab(5) on i386.
Add kqueue(2) support to syslog(3).
Evolve strtou?q() into strtou?ll(). Use weak aliases if available (wrappers otherwise) to fake strtou?q().
Run rpc.rstatd(8) and rpc.rusersd(8) as root from inetd(8) again, but go to nobody's jail at startup.
Lots more bounds-checking all over the place.
Recognise a few more fxp(4) devices.
Correct misleading cgetclose() entry in getcap(3) manpage.
Try again with the new ahc(4) driver.
Cleanups of chpass(1) and passwd(1).
SECURITY FIX: The kernel would let any user ktrace(2) set[ug]id processes.
A source code patch is available.
[Applied to stable]
newsyslog(8) now doesn't follow symbolic links by default, fixing PR1913.
Change web site banner to "One remote hole in the default install, in nearly 6 years!" That's still an awesome record.
More audit of OpenSSH.
OpenSSH 3.4 was released, and there was much rejoicing.
SECURITY FIX: All versions of OpenSSH's sshd(8) between 2.3.1 and 3.3 contain an input validation error that can result in an integer overflow and privilege escalation. The problem is fixed in OpenSSH 3.4.
A source code patch is available.
[Applied to stable]
Add a number of resource limits to ssh(1).
Increase i386 kvm size to 768M.
The list of great Theo quotes for mg(1) continues to grow.
SECURITY FIX: A potential buffer overflow in the DNS resolver has been found.
A source code patch is available.
[Applied to stable]
Merge in Sendmail 8.12.5.
Start work on IP-over-FireWire and IP-over-SCSI.
Move a bunch of pfctl(8) options into pf.conf(5).
c2k2-inspired changes to the installer.
Skip routing table lookup when {broad,multi}casting and the outgoing interface is set using setsockopt(2). Removes the need for a 224/4 route.
Make X use /dev/wsmouse instead of /dev/wsmouse0 by default.
Add some m68k opcode aliases for GNU as(1) from recent binutils.
Fix the FTP relay in faithd(8).
Fix wi(4) reassociation after an AP reboot.
SECURITY FIX: A buffer overflow can occur in the .htaccess parsing code in the mod_ssl httpd(8) module, leading to possible remote crash or exploit (PR2767.)
A source code patch is available.
[Applied to stable]
Lots of uid_t and gid_t signedness fixes.
sshd(8) no longer calls setsid() when run from inetd(8).
Make cvs(1) pserver talk IPv6.
Increment boot(8) version to help debug the new memory probe and other fixes.
Make wi(4) less twitchy on quick inserts/ejects.
String handling and bounds checking fixes to login_fbtab(3).
Bump OpenSSH to version 3.3.
[Applied to stable]
Start adding kqueue(2) support to noct(4).
System call argument rewriting framework for systrace(4).
Enable wi(4) on sparc64, after a lot of groundwork.
Fix some endianness nits in wi(4).
Remove ifmcstat(8), the same information is available from netstat(1).
More improvements to 4GB memory probing on i386.
ssh(1) and sshd(8) options are now documented in their own sshd?_config(5) manpage.
Add option for smooth scrolling to talk(1).
Support a few more wireless cards in wi(4).
Build wicontrol(8) on sparc64 as well.
String handling cleanups in comsat(8).
Support magma(4/SPARC), magma(4/SPARC64) serial/parallel boards.
Support stp(4) sbus-PCMCIA bridge based on STP4020 chipset. (The nell driver on Solaris.)
Cleanup of timed(8).
Removing its setgid(kmem) was not enough, remove trsp(8) altogether.
Make yacc(1) errors look like C compiler errors, so parser utilities such as error(1) can deal with it.
Add kqueue(2) support to random(9).
Kill file descriptor leak in dhcpd(8).
Fix lots of format strings in the dhcp(8) programs.
ps(1) shows flag 'x' for systrace(4)'d processes.
Lots of work on the gpr(4) driver.
Fix uftdi(4).
Make systat(1) revoke its setgid(kmem) privileges.
Remove old pccons driver from i386, also the associated XSERVER option from the kernel.
Fix ftpd(8)'s SIGALRM handler.
SECURITY FIX: A buffer overflow can occur during the interpretation of chunked encoding in httpd(8), leading to possible remote crash.
A source code patch is available.
[Applied to stable]
Add the punctuation-challenged Nike psa[play^120 USB widget.
Remove setgid(kmem) from the enormously useful trsp(8).
Add UK keyboard map to macppc (with '#' on Option-3) and also option CAPS_IS_CONTROL.
Increase xl(4) timeout to squash 'command never completed!' warnings.
Add kqueue(2) support to audio(4).
Import event(3), an API on top of select(2) or kqueue(2).
Enable DMA on xl(4).
Allow transparent (statically keyed) ipsec(4) processing on a bridge(4).
Help ppp(8) to cope with yet more Microsoft PPP attributes.
Extend ssh-agent(1) key lifetime constraints more flexible (i.e. more than just key lifetime).
Teach ECN attributes to isakmpd(8).
Add eui64 option to ifconfig(8) for configuring the IPv6 interface index.
Add a sysctl(3) to get the CPU type on sparc and sparc64.
Throw away the first 256 words of arc4 output in random(9).
Gratuitous pid_t cleanup in /usr/bin.
Grab multicast vlan(4) code from NetBSD.
Add some inlined hash functions for the kernel, in <sys/hash.h>.
Cleanup work on conditional evaluation in make(1).
isakmpd(8) accepts IPComp flows.
Drop pf(4) scrub(fragcache) syntax in favour of the fragment ... option in scrub rules.
Teach tcpdump(8) about ipcomp(4).
Show sparc64's X server which device it wants to mmap().
Add ioctl to wscons(4) allowing sparc64 (other architectures later) to find out which PCI device it's using.
Enable userland crypto(4) support for DSA. Maybe logging in using ssh2 on a 486 needn't take 20 seconds after all.
Kernel changes and sysctl(3) switch for hardware asymmetric crypto(4) in userland.
Add initial Ultra Port Architecture (upa(4/SPARC64)) support. Attach creator(4) and schizo(4) using it.
Import new vax boot code from NetBSD.
Add umct(4) USB serial driver and .umidi(4) USB MIDI driver. Not tested, not in GENERIC.
Add IPL_STATCLOCK and add lots of splassert()s.
ssh(1) spends less time with euid==0 even if it is installed setuid(root).
Much cleanup in distrib/miniroot.
Make pfctl(8) -s state print UDP and 'other' states nicely.
New scrub(fragcache) ... syntax for pf(4).
pf(4) NAT proxy port ranges can be specified per-rule.
Don't panic(9) if pf(4) tries to insert a duplicate key.
pf(4) NAT and filter rules now all go in the one file (normally pf.conf(5)). New pfctl(8) file syntax. Oh yes.
Clean up semantics of gre(4) a bit.
ifconfig(8) prints the Ethernet address. Yippee!
route(8) now accepts DNS names (and naturally enough treats them as host routes).
Stop isakmpd(8) using the same range for SPIs and CPIs.
Ports can now be specified in pf(4) NAT rules.
Allow systrace(4) to attach to a running process.
Add ioctl systrace(4) to retrieve the current emulation of a process.
Remove dlopen(3) stuff from isakmpd(8).
Fix BPF code for a gif(4) tunnel, and add some more sanity checks.
Default RhostsAuthentication and RhostsRSAAuthentication to 'no' now that ssh(1) is now longer setuid(root) by default.
ssh-add(1) key lifetimes can now be specified in nice readable form, e.g. '-t 1h'.
Define __weak_alias() for mvme88k.
Merge GNU TeXinfo 4.2.
Prevent mbuf(9) leakage from bridge(4).
New bad144(8).
user(8) now checks the username length against MaxUserNameLen.
Add bio(4) device, so userland can talk to devices that don't have nodes in /dev.
Remove KerberosIV startup code from rc(8) files.
Make pf(4) NAT rules work more like normal filter rules.
Add SIO*PHYADDR to gif(4) so ifconfig(8) can set the outer address.
Make published arp(8) entries work again (PR2635).
Make dhcp(8) build faster (PR2715).
Start converting netstat(1) and systat(1) to sysctl(3) instead of kvm.
Set FDDI link MTU the same as IPv4 MTU, fixes PR2714.
Allow numeric group IDs in systrace(1).
Changes to initialisation and media config of ep(4).
Add list support for pf(4) rdr rules.
Fix a number of bad strlcpy(3) calls.
Fix PR2704 resuming eso(4) after standby.
Change a lot of index(3) calls to strchr(3).
Change "'cuz" to "because." Strewth!
Add another mbuf(9) flag M_AUTH_AH, changing the meaning of M_AUTH.
Remove a bunch of '\n's from syslog(3) and err(3) calls.
Make isakmpd(8) IKECFG support work for both SET/ACK and REQ/REPLY modes.
Fixes for OpenSSL when talking to hardware crypto(4).
Stop ftp(1) and ftpd(8) spilling the IPv6 scope ID onto the wire.
The hardware is willing, and now xl(4) is able to offload TCP, UDP and IP checksumming to it.
Support setting MTU on sk(4).
Add KERN_{NFILES,TTYCOUNT,NUMVNODES,MBSTAT} sysctl(3) entries.
For a bridge(4), handle IPv4 frag-needed-but-DF-set just like on a regular interface.
Pull in some pciide(4) fixes from NetBSD.
Remove (arguably) unnecessary setgid(operator) from df(1).
Remove setuid(kmem) from ps(1) and w(1) now kvm can use sysctl for some stuff. We don't need no proc filesystem...
Make the kvm(3) library try to use the shiny new sysctls to fetch process arguments and environment.
Add flag to stop kwm_open(3) opening any files, though limiting kvm functionality.
Add sysctl(3) to retrieve process arguments and environment.
Tweak kernel memory allocation on i386 to work better on 4GB machines.
Work started on schizo(4/SPARC64) PCI controller. Who said that?
Install script now puts FQDN in /etc/myname.
Make more use of splsoftnet() (instead of splnet()) in IPv6 code.
lo0 now only gets ::1 when it's brought up.
Merge kth-krb 1.1.1.
Enable weak aliases in libc for powerpc, sparc and alpha (already enabled on i386).
Add new splusb() to prevent USB initialisation lossage.
Improve SMART support in atactl(8).
Silently ignore deprecated options to ssh(1) since they may be passed in for a remote scp command.
Remove FallbackToRsh from scp(1) as well.
pf(4) NAT rules now do macro expansion as well.
Add Makefile-like (var += ...) macro concatenation to pfctl(8), then remove it again.
Add per-rule state timeouts to pf(4).
Fix well-hidden little bug in crypto(3) to unbork sparc64 SSL/TLS negotiation.
On alpha, don't allow kernel symbols to be paged out.
Deprecate FallbackToRsh and UseRsh options in ssh(1).
ssh-keysign(8) now insists on 20-byte session IDs.
Remove suspect DIAGNOSTIC block from softdep kernel code.
Make wsdisplay(4) screen blanker play nice with the X server.
lpr(1) and friends go from setuid(root) to setgid(daemon). Connections can come from unprivileged ports for now.
Add Realtek 8129/8139 cardbus device support to rl(4).
Switch macppc to use gem instead of gm.
Multicast fixes and Gigabit Ethernet support for gem(4).
Rule label length increased from 32 to 64 characters.
Allow modification of TTL with pf(4) return-rst.
Timeout handling improvements to ohci(4).
Make netstat(1) print RIP6 statistics.
Allow a per-rule limit to the number of state table entries a pf.conf(5) rule can create.
Switch pf(4) from AVL to red-black trees.
Add Gemplus GPR400 PCMCIA smartcard reader.
Don't propose IDEA when negotiating SSL connections.
$srcaddr, $srcport, $dstaddr, $dstport, $proto and $nr (rule number) can now be used in pfctl(8) rule labels.
Make a kernel TCP RST and a pf(4) return-rst look the same, to frustrate the nmap crowd.
Some systrace(4) filter list optimizations.
Remove IPv4 mapped address support from TCP input code, and remove is_ipv6().
Add net.inet6.ip6.v6only sysctl(8) flag.
Add ikecfg as a valid flag in isakmpd.conf(5). Start coding SET/ACK mode support.
inetd(8) no longer accepts UDP packets if the source is a broadcast address.
Start work on KDrive (TinyX) low-footprint X server support.
Add a missing bzero() in sys/netinet/tcp_input.c to fix link-local TCP.
Add flow type to ipsec(4) and isakmpd(8).
Fix isakmpd(8) crasher PR2729.
Deprecate SIO.*IFPREFIX_IN6 ioctls.
Merge arla release 0.35.7.
Merge OpenSSL 0.9.7-stable-20020605.
TCP wrappers and pfctl(8) accept scoped IPv6 addresses.
Remove [gs]etprogname() from KerberosIV
Fix ipsec(4) crash described in PR2721.
Disable XF86_SVGA drivers in old XFree that are as good or better in XFree86 4.2.0, as defined in their status page.
bpf(4) support for kqueue(2)
In isakmpd(8), add netmask, subnet and DHCP server request support to IKECFG.
Fix bktr(4) stereo.
Support the RNG of AMD-768 southbridge (device amdpm(4)).
Fix DMA handing of hme(4) (SPARC and SPARC64).
Pull in libcsu change from NetBSD to allow dlopen(3) to be used much earlier.
Add -t key lifetime option to ssh-add(1).
Use IPv4/IPv6 addresses in /etc/inetd.conf instead of 'localhost' to avoid DNS lookups.
Add predicate suffixes to systrace(1).
Add -x and -X options to respectively lock and unlock ssh-agent(1).
Compatibility tweaks to getpid(), getuid() and getgid() under Linux emulation.
Start work on new debugger, pmdb.
Additional check (#ifdef DIAGNOSTIC) for duplicate uvm(9) map entries.
If syslog(3) fails with ENOBUFS when sending to /dev/log, it now waits a millisecond and retries.
syslogd(8) doubles the socket receive buffer size.
Automatic policy generation for systrace(4).
lynx(1) now defaults to passive FTP.
Remove [gs]etprogname() from KerberosV.
New -a <bind_address> option to ssh-agent(1) so user can specify the agent's UNIX domain socket.
Make tbrconfig(8) statically linked.
Remove assumptions about MTU values for certain media types.
Use the same byte-order kung fu as the kernel in atactl(8).
Don't automagically set -prefixlen 128 on IPv6 host route.
rasops instead of rcons for vgafb(4/SPARC64).
Add xsystrace(1) [no manpage yet] UI for systrace(4).
Add sbus bwtwo(4) mono framebuffer support (untested).
PrivSep'd ssh monitor processes check each authentication method is enabled before use.
systrace(1) userland import.
Use arc4random(3) for rtadvd(8).
Make nice(3) standards compliant.
More wi(4) tweaks for Symbol cards.
Recognise VIA VT8233 PCI-ISA bridge.
Fix sparc64 64-bit relocation masks in ld.so(1).
Merge in Sendmail 8.12.4.
Detect stereo radio reception in fms(4).
Compatibility tweaks to creator(4/SPARC64).
Replace mr(4) radio driver with new gtp(4) driver, which is better tested.
'pfctl -s all' now prints labels as well.
Add volatile to sig_atomic_t. Stand well back.
Use rasops instead of rcons in cgthree(4/SPARC) and cgsix(4/SPARC).
Simplify IPv6 link MTU code.
Implement PMAP_CANFAIL flag for m68k pmap.
Enable console blanking on cgthree(4/SPARC).
Make sure some struct sockaddr are cleared before use.
Start work on NetOctave NSP2000 (hardware crypto) driver noct(4). Just the RNG for now.
Apply BSD Airtools 0.2 patches.
Teach ECN flags to pf(4).
Dump mkisofs(8) in favor of mkhybrid(8).
Avoid fd_set overruns in rtsold(8), route6d(8) and rtadvd(8).
Clue in inetd(8) to IPv6 FTP bounce attacks.
Fix /etc/ptmp deletion bug that occurred if rmuser(8) was aborted.
IBSS mode for Symbol cards (firmware >= 2.5) using the wi(4) driver.
Add leading-zero padding to RSA signatures in ssh.
Tweak altq(9) options(4) so the kernel compiles on i[34]86.
Add support in the fxp(4) driver for more Intel PRO/100 VM cards.
For those that do metric but refuse to work in meters and kilograms, kayser conversion has been added to units(1). Wow.
Fix signal races in ping(8).
Now that the Dungeon Master dm(1) has gone into well-earned retirement, make those games that need to save high scores, etc. run setgid games.
Per-socket ipsec(4) policies and options!
Stop a potential ipsec(4) DoS where an attacker could falsely advance the replay counter and so force valid traffic to be discarded.
Add German keyboard map for Apple laptops.
On ELF platforms, allow gcc(1) to link Fortran code with other languages.
Make sure every PCI interrupt is recorded, so ISA doesn't step on one of them later.
Better radio(4) devices attachment.
Fix VIA8233 support in auvia(4).
Make nc(1) timeouts behave more like netcat.
Make sure user's shell is /usr/sbin/authpf before running authpf(8) to prevent $SSH_CLIENT shenanigans.
In ssh, use OpenSSL's AES implementation instead of our own.
Add -[46] options to ftp(1).
Warn to syslog if IPv6 neighbor discovery tries to set the link MTU too small.
Make tip(1) query the driver with the user's baud rate setting rather than only accepting a compiled-in list.
Cleanup and small fixes to skeyaudit(1).
Fixes to fms(4).
Various fixes and enhancements to mg(1).
sshd(8) no longer starts in privilege-separated mode unless the PrivSep user sshd and chroot(2) dir /var/empty are both present.
Fix potential time overflow in dd(1).
Make bridge(4) refragment IP packets that are too large for the outgoing interface.
Remove libdl, support is in libc since a long time already.
Recognise Nokia C110 and C111 PC cards as wi(4) devices.
Really sanitize ld.so(1)'s environment as promised in the manpage when running set[ug]id, and test for set[ug]id earlier.
Don't allow mktemp(3) to back up past the beginning of its input buffer.
Use the correct string buffer size for printing port numbers in pfctl(8).
Remove arc4random_8().
struct ifnet now has an array of pointers to data for each address family. Move per-interface IPv6 state and neighbor discovery stuff here.
netstat(1) cleanup.
ping6(8) and traceroute6(8) updates from KAME.
unsigned -> unsigned int cleanup.
Repair machdep.chipset sysctl on alpha.
Audit pid_t type usage.
Audit incorrect signal(2) usage.
Fix big snprintf(3) parameter typo in strftime(3).
Don't use execlp(3) when invoking ssh-keysign(8).
Fix kill(2) parameter brainfade in amd(8) and KerberosIV's rlogin.
vax: Add board type for VXT2000+.
More IANA interface type values, including IFT_BRIDGE.
Split XFree86 bsd_video.c into architecture-specific files.
Add sysctl(8) toggle net.inet.icmp.tstamprepl (default: 1) for ICMP timestamp replies.
Even more steps toward the death of unsafe string functions.
In XFree86 build, honour COPTS variable when building third-party apps.
Add LIBS option for crunchgen so custom libraries can be added to boot images.
Run rpc.rstatd(8) and rpc.rusersd(8) as user nobody (boo!) from inetd(8).
From ld.so(1), remove tests that have no license, and for the same reason replace parts of ld(1) and ldconfig(8).
Remove unnecessary instruction cache flushes on sparc64.
Many cleanups in ld.so(1).
Support mixed IPv4/IPv6 address lists in pfctl(8).
Add ssh-keysign(8).
Remove obsolete dm(8).
Fix disklabel(8) warnings on CD-ROM (cd(4)) with no data track.
Allow incoming ssh(1) connections in the temporary pf(4) ruleset installed by /etc/rc, just in case the real rulebase fails to load later on.
Hunt for biodone() calls not made at splbio() spl(9), and fix them.
Improve cd9660(8) filesystem read-ahead performance.
Support software brightness and backlight control on various macppc models.
Allow wsconsctl(8) to control brightness and backlight on displays which support this.
New libc IEEE floating-point code and libm routines for hppa.
splassert (spl(9)) on i386.
More steps toward the death of unsafe string functions.
splassert (spl(9)) on sparc64.
Add a creator(4) driver for sparc64 Creator and Creator3D cards.
Jumbo lpr(1) changes including IPv6 support, new features, and bugfixes.
Still more hppa memory management and low-level code fixes.
Simple pmap optimization on macppc.
Did we mention the cleaning of the installation scripts, adding functionality yet reducing size?
Allow ddb(4) to do a stack trace into the kernel message buffer.
isp(4) fixes.
SECURITY FIX: Fix incorrect ACL check when using BSD authentication in sshd(8).
A source code patch is available.
[Applied to stable]
Fix a memory leak in mg(1).
New systrace facility.
Better Cyrix CPU support.
ECN support.
Support SNTP in rdate(8).
Fix infinite SIGFPE loop situations on vax.
Remove unnecessary setuid bit from binaries that either do not need it or whose functionality requiring root privileges should only be invoked by root anyways, or which can be changed into a setgid bit for a specific group.
Switch skey(1) management to per-user directories instead of a flat file and drop setuid bit on related tools.
Lots of ppp(8) goodies.
New splassert (see spl(9)) debug functionality on sparc.
Enable Altivec instructions in macppc kernels.
Support more Hifn cards (7814, 7851, 7854) via the nofn(4) driver.
OpenSSL 0.9.7.
Completely rework at(1) and related binaries, and make them POSIX-compliant.
More use of hardware crypto cards functionality via ubsec(4).
More hppa memory management fixes.
binutils 2.11.2.
Add per-gid filtering to pf(4).
Switch at(1) to be setgid crontab as well.
Handle host names resolving in several addresses in pfctl(8).
Fix compilation warnings for various userland programs.
Add a new user, crontab, and change cron(8) from being setuid root to being setgid crontab.
Add per-uid filtering to pf(4).
More usb(4) support updates.
More ubsec(4) hackery to get it to do more crypto operations, and hack hifn(4) and lofn(4) to work with this.
Your average extensive cleaning of the installation scripts, adding functionality yet reducing size.
Fix adb(4) french keyboard layout on macppc.
Switch ELF platforms to the native gprof(1).
Obtain a better licence for the hppa spmath routines.
Add an url(4) driver for Realtek RTL8150L-based USB cards.
mvme88k pmap bugfixes.
Various usb(4) driver updates.
Remove rlogin(1), rlogind(8) and rexecd(8).
Fix several wrong computations in newfs(8).
Workaround ghost pcibus detection in pchb(4).
Add a tuner driver for the fms(4) radio cards.
Allow userland to know which pf(4) rule created a specific state.
Prevent a 3.0 wsmoused(8) binary from panic'ing the kernel.
Enable privsep by default in sshd(8).
Fix find(1)'s -anewer and -cnewer options behaviour.
Sprinkle ptrdiff_t and size_t types instead of int all over the tree.
Support LBA48 addressing in wdc(4).
Bring back TURBOchannel alpha hardware support.
Fix a slightly incorrect behaviour of the device cloning in UKC (boot_config(8)).
SECURITY FIX: cause the exec(3) to fail if we are unable to allocate resources when dup-ing /dev/null(4) to fd(4)'s 0-2 for setuid programs.
A source code patch is available.
[Applied to stable]
Extended Attributes code updates.
Improve PS/2 mouse port detection in pckbc(4).
Better hifn(4) initialisation and memory usage.
Extensive cleaning of the installation scripts, adding functionality yet reducing size. No, you're not having a deja vu.
Fix ethernet interrupt level on sparc, and rework the sparc interrupt framework.
Better color depth detection in Xwsfb.
64-bit fixes in vmstat(8).
Improve dma processing in bge(4).
RELIABILITY FIX: constrain readdirplus request count in the nfs(8) filesystem.
[Applied to stable]
Switch macppc console from the rcons engine to the rasops engine.
Extensive cleaning of the installation scripts, adding functionality yet reducing size. Yes, once again.
Add IEEE754 floating point completion code on alpha.
Improve dma processing in gx(4).
Build the XFree86 GLX extension on sparc64.
Hunt for outdated prototypes for character devices entry points and fix them.
Switch mvme88k to the new MAKEDEV(8) generation framework.
Implement the -s option in m4(1), for it to be POSIX-compliant.
Kill all mvme68k kernel compilation warnings.
Assorted mac68k code cleanups.
Shared key support in hostap mode in wi(4).
Make Xwsfb support tga(4) cards on alpha.
Fix a lock leak in ami(4).
SECURITY FIX: update sudo(8) to sudo 1.6.6.
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: avoid buffer overrun on PASV from a malicious server in ftp(1).
[Applied to stable]
Add a Soundforte radio driver, sfr(4).
Add dynamic interface -> address translation in pf(4).
Add kernel hooks on ethernet interfaces, triggered by address changes.
Extended Attributes code updates.
Enable the Freetype library on sparc64.
Add queuing in the kernel crypto framework.
Make the system includes C++ friendly.
Allow explicit filtering of non-reassembled fragments in pf(4).
Support more hardware and fix stability issues in the mac68k sn(4) network driver.
Improved Lithuanian keyboard map for wscons(4).
SECURITY FIX: fix a buffer overflow in AFS/Kerberos token handling in sshd(8), and send a complete ticket.
A source code patch is available.
[Applied to stable]
Fix a memory leak in mg(1).
Assorted hppa memory management fixes.
Allow fractional delays in top(1).
Enable upgrade functionality again on alpha installation media.
Extensive cleaning of the installation scripts, adding functionality yet reducing size.
Make cvs(1) create the .cvspass file on a login operation if it does not exist, rather than failing.
Extend mac68k disklabels to 16 partitions, like all the other platforms.
Add cddb support to cdio(1).
Support more network cards with the dc(4) driver.
Improve sparc pmap behaviour in some low memory conditions.
sendmail 8.13.
Switch mvme68k to the new MAKEDEV(8) generation framework.
Improve the library logic in ld(1) to increase speed and decrease memory usage on a.out platforms.
New mvme68k installation media.
Change fpu probe routine on mac68k.
Fix an obscure bug in sed(1).
Support more wireless cards with the wi(4) driver, and fix a few issues within.
Fix 64-bit issues in pfctl(8).
Remove the wx(4) driver, which had been deprecated in favor of the gx(4) driver.
--------
Changes made between OpenBSD 3.0 and 3.1
Fix xim problems with zh_CN locale in xf86(4).
Enable Apache httpd(8) modules on ELF-based architectures.
Disallow ftpd(8) logins to accounts lacking passwords.
Log control signals on the IDE bus in wdc(4), obtainable through atactl(8).
Move xautolock(l) into the ports(7) system.
Import pmdb(1).
Improve ALTIVEC support in OpenBSD/macppc and powerpc.
Begin to split authorization in sshd(8).
Protect against overflows and null dereferences in OpenBSD/i386 CPU probing.
Morph ptrace(2) into one of the kernel config(8) options(4).
Repair some of the problems in the new ahc(4) driver.
Prefer the MAC address found in the local-mac-address property of hme(4), falling back on myetheraddr().
Rewrite the powerpc pmap handling.
Realize that suffixes given to gzip(1) may be longer than 3 characters and account for this in buffer sanity checks.
Permit user and group names to start with a numeral in identd(8).
Enable altq(9) support in more drivers.
Update to zlib 1.1.4, fixing a security hole.
Support reverse lookups when displaying states in pfctl(8).
Add the PT_IO API for reading and writing traced processes memory with ptrace(2).
Don't listen(2) on a port nc(1) really doesn't have.
Ensure tcp(4) code doesn't operate on freed memory.
Schedule tcp(4) timers with timeout(9) instead of tcp_slowtimo.
Phase in use of red-black tree(3) algorithms for uvm(9).
Implement a shutdown hook for raid(4) devices, allowing safe use of swap.
Export sha1(3) and md5(3) interfaces through crypto(4).
General crypto(4) and openssl(1) related work.
Recognize a preserve flag in mtree(8) to disable attribute modification.
Repair an off by one error in sshd(8).
Differentiate a closing connection from a bad greeting during read of the protocol version string in ssh(1).
Many improvements and cleanups to the trap handling in the installation system.
Implement machine specific commands to the bootblocks on OpenBSD/hppa.
Provide a toggle for immediate ack behaviour on tcp(4) TH_PUSH segments.
Use timeout(9) instead of tcp_fasttimo for delayed acks in the tcp(4) subsystem.
Vanquish a race condition in pciide(4) interrupt sharing.
Avoid rejecting valid leases in dhclient(8).
Add SOCKS4 support to nc(1).
Import the 4.4BSD deroff(1) and spell(1) programs.
Enhance the handling of quirky scsi(4) devices.
Improve debugability of unloaded pf(4) rules by printing meaningful rule numbers.
Safen SPLAY_MIN and SPLAY_MAX on an empty tree(3).
Support an optional pool(9) memory hard limit in pf(4).
Guard against pool_sethardlimit() decreasing the limit below the current size of the pool(9).
Disable Nagle in ssh(1) port forwarding.
Implement the splay and red-black tree(3) algorithms.
nwkey and powersave support in ifconfig(8).
Deal with groups in adduser(8) more thoroughly.
Optimize OpenBSD/vax sources with -O2.
Support an aperture driver on OpenBSD/macppc.
Add a sysctl(3) interface kern.usercrypto that allows userland programs to utilize hardware crypto(4) devices.
Send kind regards to the pool(9) option POOL_EXPOSE, as it's no longer with us.
Add extattr(9) (Extended Attribute) support.
Include a siginfo_t structure with ktrace(2) containing the fault address among other useful information.
Clean up and debug the iommu driver.
Remove flawed assumptions about memory layout in the stack sharing code in FORK_VMNOSTACK.
Account for process signal masks when dealing with signals in pthreads(3).
Reorder the network components initialization in netstart(8).
Fix some signal races in rbootd(8).
Improve mg(1) in many ways, including lots of buffer cleanups and undo support.
Enable beeper(4) on OpenBSD/sparc64 when pckbd(4) is enabled.
Silence the raid(4) subsystem a bit.
Include support for generic 802.11 ioctl(2) calls in the wi(4) driver.
Repair a fcntl(2) F_GETOWN issue on LP64 BE architectures.
Install "right" zoneinfo timezone(3) files in addition to the "posix" ones.
Remove xebec code.
Enable echo(1) in adduser(8) signal(3) handlers.
Don't require -n in conjunction with -x in xargs(1).
Use mktemp(1) in security(8).
Switch ssh(1) cipher operations to use the openssl(1) EVP API.
Allocate some in-kernel memory from a kmem_map-backed pool to avoid deadlocks and MAX_KMAPENT panics.
Avoid a possible panic on reboot(8) with mfs(8) file systems.
New trm(4) driver.
Remove a permissions loosening chmod(2) in pkg_install.
open(2) the console with O_NONBLOCK in syslog(3) to avoid blocking on a locked console.
Provide config(8) accessible hooks for modifying the NMBCLUSTERS, BUFCACHEPERCENT, and NKMEMPAGES options(4).
Calculate ip(4) checksums and copy back modified headers before logging a packet in pf(4) to ensure the integrity of logging.
Enable vnode(9) caching in the kernfs(8) code.
Support for nc(1) connecting to and listening on an AF_UNIX socket(2).
Treat the pound symbol (#) as an escaped character during vi/emacs filename completion in ksh(1).
New port of the ahc(4) driver.
Remove the getpw(3), vlimit(3), and vtimes(3) functions.
Simplify PID selection algorithm.
Immunize nanosleep(2) against system time changes.
Minimize time spent doing time management in pf(4).
New tvtohz(9) function.
Add skip steps for rule action and direction in pf(4), considerably hastening rule set evaluation.
altq(9) fixes and improvements through a sync with KAME.
Implement multiple overlapping read/write requests in sftp(1) file transfers.
Update to apache httpd(8) 1.3.23 with mod_ssl 2.8.6.
Relocate ssh(1) configuration files to /etc/ssh.
Remove dangerous agressiveness in NFS optimizations with symbolic links.
Improve the sis(4) driver a bit.
Update to heimdal-0.4e.
Fix a possible FIN retransmission mishap.
Account for temporary references to a struct file to avoid races in shared fd(4) situations.
Allow specification of the copy buffer length in ssh(1) via -B.
Some ssh(1) channels cleanup.
A potpourri of multi-faceted hppa improvements.
Double check the byte ordering in mpool(3).
Introduce many new and fruitful regression tests.
Add a driver to get a performance counters on sparc64.
Make ddb(4) understand "boot reboot" and "boot poweroff".
Include a bha(4) driver.
Improve support for header byte swapping in tcpdump(8).
Use "aes" in place of "rijndael" in ssh(1).
Mark execing processes with a flag to indicate to ptrace(2) and similar not to fiddle.
Handle DMA errors and big-endian systems in the ubsec(4) driver.
Upgrade to XFree86 4.2.0
Plug memory leaks in zlib, ftpd(8), and the login_getcap(3) family.
Support disklabel(8) style size/offset values (ala "300k", "500M", "2G") in fdisk(8).
Enable the serial console driver and keyboards found on some sparc64 systems.
Use more pool(9) based allocations throughout the system.
Update to sendmail-8.12.2.
Add magma(4) and spif(4) support to sparc64.
Don't let wdc(4) try UDMA modes if the controller doesn't support them.
Pay attention to direction with the fastroute and route-to options in pf(4).
Implement net.inet.icmp.rediraccept and net.inet.icmp.redirtimeout via sysctl(8), configuring an icmp(4) redirect ignore and timeout.
Use and support the UNIMPLEMENTED message in the ssh(1) protocol.
Prevent file descriptor close mistakes in faithd(8), route6d(8), rtadvd(8), and rtsold(8).
Remove requirement for reserved ports in the NFS server by using the vfs.nfs.norsvport sysctl(8).
Handle playback interrupts nicely in the cs4321 driver.
Correctly differentiate between reading and writing operations on a number of devices, including radio(4)
Allow port 0 to be used in pf(4) rules.
Improve tty(4) resizing support in mg(1).
In mixerctl(1), only open the mixer with RDWR when really needed.
Enforce sane port ranges in the pfctl(8) rule parsing logic.
Obey POSIX and don't update the modification time of the file if a write(2) is done with a length of zero bytes.
Allow pf(4) rules to be identified by arbitrary labels.
Support the HiFn 7811 in the hifn(4) driver.
Add ELF support to modload(8), among other improvements.
Support flags for savecore(8) in rc(8).
Recognize a "no" keyword in the nat/rdr/binat syntax of nat.conf(5) to avoid translation.
Allow a cvs(1) tagname to be expanded during checkout, export, and update to be specified on the command line.
Repair behaviour of ip(4) over ip6(4) tunneling when using gif(4).
Clean up the lkm(4) subsystem.
Consistently use SIG_DFL instead of SIG_IGN to disable a SIGCHLD signal(3) handler.
Do not allow root to login(1) via an insecure tty even if the auth method does not use plaintext passwords.
Don't let root change its password via login_chpass(8) and login_lchpass(8).
Add usbtablet(4), input support in XF4 for usb(3) devices.
Avoid hanging x11 channels in ssh(1) with rejected cookies.
ssh(1) protocol 2 HostKey default becomes /etc/ssh_host_rsa_key and /etc/ssh_host_dsa_key.
Enable usb(3) devices for sparc64.
Add a new m4(1) based makedev(8) generation system.
Have fdisk(8) remove references to the NT serial number when writing to the MBR.
Handle truncation to the middle of a file hole in FFS.
Update sudo(8) to 1.6.4.
Add more commands to ddb(4).
Fix PT_{READ,WRITE}_{I,D} on sparc64.
Migrate regression tests to a new, unified framework.
Ensure correct alignment in some bridge(4) code.
Many pthreads(3) fixes: only poll file descriptors when needed use scheduling ticks for better timing, and avoid a polling related overflow.
Only require write permission in pf(4) and pfctl(8) when modifying.
Various od(1) and hexdump(1) fixes and POSIXification.
Rename libusb to libusbhid(3).
Enable RAIDFrame auto-configuration.
Ignore the RSH environment variable in rdist(1) if it is empty.
Correctly retain yp(8) bindings in ypbind(8) when using more than two domains.
Plug a memory leak in the EPRT command of ftpd(8).
Repair hex mode output in skey(1).
Default to using the non-blocking behaviour on new accept(2) sockets.
Repair tty(1) related panics caused by the session pointer code.
Have ssh(1) and family exit on openssl(1) allocation failures.
Only require the -t option when using ssh-keygen(1) to generate keys.
Don't examine the tcp(4) header of non-tcp packets in PPP.
Strengthen permissions on ppp.conf.sample.
Use constant bitmasks as opposed to bitfields in the mmu segment and page table structure for mvme88k.
Correctly print the payload string of tcp(4) RST segments when tcpdump(8) is verbose.
Implement a scalable timeout(9) mechanism with constant-time add and delete.
Let mvme68k systems lacking a configured pcc device compile.
Don't default to generate rsa1 keys in ssh-keygen(1), and try all standard key files when invoked without arguments.
Have crontab(1) send SIGUSR1 to cron(8) when a crontab file has changed, making changes take effect sooner.
Send failing packet sequence number when sshd(8) is responding with an SSH_MSG_UNIMPLEMENTED.
Ensure that user and system times increase monotonically.
Add powerhook support to yds(4) to handle apm(8) resumes correctly.
Repair memory leak in pcap(3) associated with compiled bpf(4) programs.
Support span ports so that one can snoop a bridge from another interface/machine/network.
Disestablish the xl(4) powerhook on detach.
Add a -u flag to fdisk(8) which updates the MBR code but leaves the partition table intact.
Big isp(4) overhaul.
Improve signal handling in cron(8) so that processes run by cron(8) can't zombify until cron(8) wakes up.
Add a pf(4) DIOCADDSTATE ioctl(2) that adds state entries.
Support primitive stateful pf(4) filtering for other non-TCP/UDP/ICMP protocols.
Fix icmp6(4) MIB counter.
Better signal handling in login_skey(8) to avoid a possible race condition.
Update signal handlers in passwd(1) to complement new catching getpass(3) call.
Allow vnd(4) to create things larger than 2G.
Perform a sanity check on the inner IP header of IP-in-IP encapsulated packets.
Support -o for sshd(8), like ssh(1).
Catch -- don't block -- SIGINT and SIGTSTP in readpassphrase(3) and getpass(3).
Enable rootdev auto-configuration by device drivers during boot and add support for raid devices.
Parse hex numbers in pf(4) correctly.
Curtail the use of regex(3) in ssh(1).
Make NKMEMPAGES dynamic based on memory size, deprecating NKMEMCLUSTERS in favour of NKMEMPAGES, NKMEMPAGES_MIN, and NKMEMPAGES_MAX.
Forbid the coupling of different address families in pf(4) nat, binat, and rdr rules.
Release the right descriptors when pipe(2) fails.
Use pidfile(3) throughout the tree instead of hand-rolled imitations.
Don't let sshd(8) pass user-defined variables to login(1).
Nuke smartkey(1).
Remove pipe based interface to photurisd(8), leaving only PF_KEY.
Issue a "failed" message instead of a 2nd challenge if sshd(8) sees the same key in authorized_keys twice.
Let the sshd(8) fake X11 server listen on localhost by default.
Use ip6(4) in sendmail(1) when possible.
Fix an alignment bug on alpha by using getifaddrs(3) instead of various ioctl(2) calls in named(8).
Conform to historic behaviour in fmt(1); don't format lines that start with a dot.
Avoid a "thundering herd" problem in accept(2), and fix an infinite loop on 64-bit systems.
Use pool(9) for socket allocations.
Correctly signal an error condition in newsyslog(8) so we don't send a signal to PID 0.
Repair an error in uipc_socket that could make a transient error permanent.
Perform a pf_route() before logging in case the logging created a bogus rule, avoiding a panic.
Have socket connection queues use a tailq queue(3).
Add fastroute option to pf(4).
Support pasting characters with codes above 127 using the mouse via wscons(4).
Handle PID files terminated with newlines correctly in newsyslog(8).
Among other improvements, don't leak memory in ppp(8).
During installation, preserve blank space in responses.
Centralize the mount list, unifying locking, and add vfs_isbusy to help verify that a mount point is locked.
Strengthen the mbuf traversal code in pf(4), avoiding potential crashes on ip6(4) packets with options.
Make dummies for aclocal and the auto* family in cvs(1), hopefully mitigating upgrade hassles.
Don't allow the pf(4) CHANGEBINAT ioctl(2) when securelevel > 1.
Include stub dl* function definitions in libc on ELF, making libdl unneeded.
Enhance network handling during installations.
Block signals in find(1) when running fts_read().
Move NFS creds out of the standard buf structure and into the nfs node, and use pool(9) for NFS node allocation.
Fix the password length check in user(8).
Use lockmgr in procfs (mount_procfs(8)) instead of a home-made version.
Correctly mark items on the syncer worklist with VBIOONSYNCLIST, ensuring items not on the list don't have this mark.
Convert to using the vn_marktext() function instead of VTEXT to mark a vnode as executing a text image.
Enable the NI_WITHSCOPEID getnameinfo(3) flag by default.
sendmail(8) should listen on port 587 for ip(6), like ip4(6).
Add sanity to the apmd(8) battery alert when the battery is charging.
Let chdir(2) errors in rwhod(8) be seen.
SECURITY FIX: update ssh to OpenSSH-3.0.1.
A source code patch is available.
[Applied to stable]
Repair ipx frame-type handling in ifconfig(8).
SECURITY FIX: don't let pf wander off the end of ipv6 icmp packets.
A source code patch is available.
[Applied to stable]
Fix a recursive mutex problem in pthreads(3).
RELIABILITY FIX: quiet bogus interrupt messages on sparc64 pciide cdroms.
A source code patch is available.
[Applied to stable]
Support the "S" command in interactive mode in top(1) to toggle display of system processes.
Prepare for UBC by adding a daemon that processes async I/O and repairing some other things.
Don't memset(3) too much memory in ssh(1) or sshd(8).
Be much more sure that software cannot be used in crypto(9) stuff.
Fix behaviour of system(3) in phtreads(3) so it doesn't hang forever.
Use select(2) instead of unsafe SIGIO method for handling wscons(4) events in X11.
Increase buffer sizes in tcpd(8) and ssh(1) so they can hold a full hostname.
Add uscanner(4) device node to i386 and macppc.
SECURITY FIX: be more careful with file permissions in vi.recover
A source code patch is available.
[Applied to stable]
RELIABILITY FIX: provide illegal instruction trap handling for Altivec instructions on macppc.
A source code patch is available.
[Applied to stable]
Take advantage of the bus_dmamap_sync API.
RELIABILITY FIX: finally address the PCI abort problem on hifn7751.
A source code patch is available.
[Applied to stable]
Move accounting disk space watcher into a kernel thread, fixing accounting on NFS.
Fix many signal handlers throughout the tree.
Avoid overruning mbuf length in ip6(4) handling.
Big rusers(1) update, including protocol version 3 support, avoidance of duplicate issues on multihomed machines, and timeout tweaking.
Support mmap(2) past 4GB offsets.
Repair creation of the hosts(5) file during installation.
Size mprotect(2) allocations from malloc(3) to 0 bytes, resulting in a fault on access.
Handle autorepeat delays better in wskbd(4).
Send the User-Agent header when using ftp(1) to WWW servers and proxies.
Overhaul some fd(4) handling within the kernel.
Ensure isakmpd(8) dies promptly on reciept of the SIGTERM signal(3).
Fix a problem with bsd_auth(3) and passwords containing colons.
Make -h and -L in pax(4) and tar(1) follow symlinks on extraction of directories.
Support ddb(4) entry with usb keyboards using uskbd(4).
Enhance handling of console keyboard attaches and deattaches.
Allow the SCSI cd(4) driver to eject empty drives.
Repair backgrounding (~&) in ssh(1) for v1 and add support for v2.
Spiff up the isp(4) driver; protect against deranged fabric name servers and correctly handle the ISP_QUEUES_FULL status.
Cleanup wx(4), getting rid of a bogus pullup on small mbufs and setting a txint delay.
Polish wsconsctl(8): better usage output, print nice output when changing display.* settings, and prefer warn(3) over err(3).
Handle standard file handles better in cron(8), and change an unsafe vfork(2) call to fork(2).
Import xc-mit to build XhpBSD for hp300.
Don't let tcpdump(8) segfault on some radius traffic.
Fix some bugs in ppp(8), including a PASV bug, a set reconnect bug, and allowing for looser MRU handling.
Use a more specific error message when pfctl(8) is given a bad interface name.
Correct printing of RDR rules in pfctl(8) when using ! with destination rules.
Reset state counter when clearing states in pf(4).
Ignore SIGPIPE early in ssh(1), allowing operation to continue even if the agent dies.
Implement syslog_r(3).
Support the Creative Labs SB Live! sound card with emu(4).
Repair __PSEUDO_NOERROR on hppa.
--------
Changes made between OpenBSD 2.9 and 3.0
In pf(4), block packets that have IP options set by default.
Disable fd(4) sharing.
Repair a umask(2) in pflogd(8).
Fiddle with channel handling in ssh(8) and ssh(1).
Add interface name to address translation to pfctl(8).
Avoid /tmp races in cvs(1) by utilizing mktemp(1).
Handle illegal whois(1) server output that lacks a trailing newline.
Bring in FM radio(9) driver support; configuration through radioctl(1).
Work around buggy HTTP servers that need the Host: field to only contain the port number.
Use bpf_timeval instead of timeval in pcap(3), isakmpd(8), bpf(4), and tcpdump(8), improving portability.
Fix a network/host order bug in pf(4) that broke state searching on icmp(4) packets with the DF flag set.
New ssh(1) configuration option NoHostAuthenticationForLocalhost.
Import a new rmd160(1) implementation.
Upgrade to sendmail(8) 8.12.1, fixing a potential local security hole.
New -t and -d flags for mktemp(1) to account for the TMPDIR environment variable.
Add a -l flag to mtree(8) to do loose permissions checks.
Report error when the -N and -R flags of pfctl(8) can't open the specified file.
Have rcp(1) and scp(1) skip filenames containing newlines.
Big install documentation overhaul.
Support selectable preset FSM optimizations in pf(4).
Lots of RAIDFrame work.
Filter forwarded ip6(4) packets with pf(4).
Upgrade cvs(1).
New pidfile(3) call to write a daemon PID file.
Read user configuration first in ssh(1).
Allow macro names to contain underscores in pf.conf(5).
Overhaul /tmp handling in gzip(1).
Improve string handling in rwho(1).
Fix handling of icmp(4) packets in pf(4).
Plug memory leak in ssh(1)'s compression.
Connect usb(4) keyboards to the display after attach.
Correctly free mbuf when dropping a packet in the ip6(4) subsystem.
Default to 9600 baud in cu(1).
Many repairs to getcap(3), including an off-by-one malloc(3) error and a buffer overflow.
Import a new grep(1).
Update popa3d(8) to 0.4.9.4, adding support for selectable stand-alone or inetd use and tcpd(8).
Start pflogd(8) differently so it doesn't block NFS in diskless situations.
Avoid a memory leak in uvm(9).
Remove signal race from rpc.rstatd(8).
Re-order shlib_dirs in rc(8), prioritizing X11R6/lib over local/lib.
Speedup m4(1) by using inlines for common operations.
Cleanup the set of user(8) tools.
Implement a buffer flushing daemon, solving problems related to the syncer and improving performance with large numbers of buffers.
Remove buggy STATIC memory optimization from m4(1).
Have vi(1) abort if it can't create a temporary file.
Improve cross building support.
Repair some buffer handling in mail(1).
Add many more length checks when passing data from userland to kernel.
In pf(4), don't ignore the inner protocol of ip(4) icmp(4) packets, thus unbreaking traceroute(8), etc.
Support insecure1 and insecure2 options in resolv.conf(5).
SECURITY FIX: be careful with long commandline options in uuxqt and run uucp as non-root in daily.
A source code patch is available.
[Applied to stable]
Replace ru_SU with ru_RU in vi(1).
Import sendmail(8) 8.12.0, requiring a new smmsp user and group.
Mark buffers with dependencies as B_DEFERRED and skip them one time when doing sync(2).
Banish uucp to the ports tree.
Upgrade awk(1).
Cleanup adduser(8); clean up variables, clear hashes correctly, unlock ptmp before closing, etc.
Support 1:1 bi-directional Network Address Translation in pf(4).
proxy user required for ftp-proxy(8).
Add a stereo jitter suppressor to the maestro(4) audio driver.
Fix erroneous select(2) FD_SETSIZE uses.
Repair wall(1)'s -g flag.
pckbd(4) supports Ukranian keyboard layouts.
Better Russian calendar(1) support.
Implement skip steps and parameter lists for interfaces in pf(4).
Update username length limit in rmuser(8).
New src compilation target: cross-env; prints all environment variables that need to be set for cross-building.
Import usbhidctl(1), a userland program to manipulate USB HID devices.
Import usb(3) library libusb for USB HID processing.
Rename powerpc port to macppc, allowing for code sharing between different powerpc-based platforms.
Inherit vlan(4) baudrate from parent.
Various lpd(8) improvements and fixes.
SECURITY FIX: fix buffer overflow reading queue file in lpd.
A source code patch is available.
[Applied to stable]
Plug memory leak in scp(1) and rcp(1).
Avoid segfault in dhclient(8) when the server specifies its name.
Support the ! operator in host parameter lists in pfctl(8).
Send a reset request for every packet received by ppp(8) when the encryption dictionaries are out of sync.
Make pf(4) support ISN randomization (aka. phase modulation).
Store argc as a long on the stack as opposed to an int.
Switch rijndael code to the optimized AES reference release.
Have isakmpd(8) send DELETE notifications for all active SAs when shutting down.
In sudo(8), apply default login class if unable to look one up.
Support macro expansion in pf.conf(5).
Work some magic on the installation scripts for floppies, shrinking them.
Correct the setup of the initial tcp(4) state window in pf(4).
Import pflogd(8), logging daemon that writes pf(4) logs in tcpdump(8) binary format.
SECURITY FIX: fix out of bounds handling in sendmail debug handling
A source code patch is available.
[Applied to stable]
Repair ppp(8)'s iface-alias option.
Fix rule flushing code in bridge(4) devices.
Support ip6(4) in ppp(8); crude IPV6CP support; many other smaller changes.
Enhance file-change detection in vipw(8) and crontab(1).
Add per-rule statistics and byte counter to pf(4).
Don't reset xl(1)'s Rx/Tx without first turning them back on after a suspend.
Support parameter lists in pfctl(8).
Be sure to pass the interface to ipip_input() in the net subsystem so it can be used in bpf(4).
Import ftp-proxy(8), a transparent ftp proxy.
Loosen tcp(4) state code in pf(4), allowing "stupid stacks to shotgun their SYNs and provide better handling for pre-existing connections".
Initial import of sparc64 port; much subsequent development, too much to list.
Add the possibility to add a random offset to the stack on exec(3).
Make the siop(4) driver pay attention to quirks table, eliminating INQUIRY snooping and ifdef toggling.
New -s switch for pwd_mkdb(8) to only update the secure .db file.
-e switch for nm(1) to show extra symbol information.
Delay locking the passwd file until we have gotten a new password from the user. Also play with the file locking routine.
Attempt to recover from PCI aborts in the hifn(4) driver.
Import keyconv, a small utility to convert between openssl(1) and DNSSEC key formats.
Support trusted public RSA keys as files in isakmpd(8).
Fix lengths for PFKEYv2 and KAME messages in IPv4-in-IPv6 and IPv6-in-IPv4 flows.
Import popa3d(8), Solar Designer's POP3 daemon.
The valiant vm_extern.h, vm_inherit.h, vm_map.h, and vm_pager.h files ride off into the sunset.
pf(4) support for icmp(4) errors referring to icmp(4) queries/replies.
Allow file flags in mtree(8).
Don't compare the source address on packets to the one in SA when doing ipsec(4) processing.
Repair rijndael block alignment.
Unshare sigaction(2) signal handlers on exec(3).
Merge altq(9) options into just "altq" for base + red + cbq, and enable it by default.
Support the -h flag for ln(1) that prevents following a symlink to a directory.
Many new timeouts for a wide variety of devices.
Remove the IPCOMP option as it's now part of the IPSEC option.
Rewrite signal(3) handlers in altqd(8) to be race-safe.
Add support for RC4 operations in the hifn(4) driver.
Don't free(3) unallocated memory in mailwrapper(8).
Change tsleep(9) into an ltsleep wrapper. ltsleep takes one more argument than tsleep(9), a simplelock that it unlocks when safe.
Let kerberosV compile entirely on platforms without shared libraries.
Avoid /tmp race in rcs2log by using mktemp(1).
Tweak timekeeping code in dd(1) to produce a sane bandwidth measure for a short runs.
Enable the ESP and AH ipsec(4) protocols by default.
Make kernel crash(8) dumps work under mvme68k.
No longer drop packets when using an ACQUIRE policy and an error occurs when notifying key management.
New getrrsetbyname(3) function to retrieve arbitrary DNS records.
Support protocol version 2 in ssh-keyscan(1).
Move xdm(1)'s PID file from xdm-pid to xdm.pid in /var/run, maintaining consistancy.
Delay decision to make a new hash(3) table or not until after calling open(2), clearing up problems with file locking.
vlan(4) changes: utilize IFCAP_VLAN_MTU and IFCAP_VLAN_HWTAGGING capabilities; LINK0 and MTU ambiguity are no more; MTU's can only be changed within the scope of the parent's MTU.
Repair non-blocking mode issues in syslogd(8), avoiding grief with locked terminals.
Make all cases of .Sh AUTHOR and .Sh EXAMPLE plural in manual pages.
New sysctl(3) nkmempages that reports how many pages are in kmem_map.
Support stateless tcp(4) normalization in pf(4).
Import x99token(1), a software x99 token calculator.
Add support for EDNS0 extended flag DNSSEC OK to the resolver(3) routines.
Don't send a NUL on the end of CHAP SUCCESS packets in ppp(8) so that WindowsME and Windows98 won't mysteriously fail when encryption is enabled.
Allocate uvm(9) page buckets from kernel_map, saving kmem_map space on machines with lots of physical memory.
In ppp(8), compensate for a Windows 98 bug when sending a CHAP81 challenge response.
Support the SmartcardDevice option in ssh(1) to specify which smartcard device to use.
Step down only one Ultra DMA mode at a time when downgrading.
On DMA timeouts, stop busmaster PCIIDE and reset channel.
Don't malloc(3) too much and choke in ELF execution.
Support rule skipping in pf(4).
Allow negative lock length with lockf(3), making it compliant to specification.
In top(1), abort if stdout(4) ever produces EOF; prevents spinning output if controlling tty disappears.
Implement startup and shutdown hooks via dohooks(9) and family.
SECURITY FIX: check filehandle size copied from userland
A source code patch is available.
[Applied to stable]
Nuke edlabel.
Add support for disabling swap devices via swapctl(8)'s -d option.
Support sshd(8) configuration file and key testing via the -t option.
Change vop_symlink and vop_mknod so that they return the created node in a way that the caller can actually utilize it.
Use vfork(2) safely in sup(1).
New flag PMAP_CANFAIL that tells pmap_enter that it can fail if there aren't enough resources instead of panicing.
Make non-stateful and stateful pf(4) filtering work on bridge(4) devices.
Initialize arpcom later; it could be incorrectly initialized if done before bridge_input().
Enable challenge-response authentication by default in ssh(1).
Fix/complete pf(4) binary operators.
Repair signal race in m4(1).
Ensure make(1) doesn't dump core when reporting open conditionals.
Promote PMAP_NEW option to mandatory status.
In the netinet subsystem, zero the TCP checksum field before calculating the new value; fixes problem with bad checksums on keepalives.
Use 64-bit integers for some ipcomp byte counts, fixing strange results with netstat(1).
Support Addonics FlexPort 8S via addcom(4).
Ignore O_TRUNC on open(2) when not opening a regular file.
On ext2fs, ffs, and ufs partitions, don't truncate anything except for symlinks, directories, and regular files.
Repair kern_msgbuf under sparc.
Support DEC EtherWorks cards via lc(4).
Bring na.phone up to date.
The iha(4) driver wasn't able to update the EEPROM, so don't even bother.
Rework ata and wdc(4) probing code; deal better with floating buses and supress spurious interrupts.
Plug memory leak in pw_copy() found in libutil.
Put Kerberos 5 things in libkrb5, out of libkafs.
Allow sshd(8) to be compatible in all 4 combinations of Kerberos 4 and Kerberos 5 settings.
When ssh(1) is reading a password, don't panic if fork(2) or pipe(2) fail; just return an empty password.
Sync rtsold(8) to latest KAME, fixing a memory leak and a timer value.
Change quad types on alpha to "long long" as opposed to "long", allowing printf(3)'s "%lld" format to be used without a bogus cast.
In the iha(4) driver, allow sync to be negotiated even if wide is not.
Modify nv(4) XFree86(1) driver as to avoid the dimming text mode problem.
Add a BSD authentication module for radius authentication.
Make sure that ld(1) references all aliases to avoid them being only partially resolved.
Ensure ppp(8) calculates the number of key changes correctly.
Repair the NFS server's request tracking during write-gathering, thus avoiding client hangs.
Use login.conf(5) for passwd(1) variables as opposed to passwd.conf(5).
Yank PF_ENCAP support out of isakmpd(8).
Fix-up multicast settings in netstart(8).
Bump MSIZE up to 256.
IP/TCP/UDP hardware checksumming for nge(4); limited by MTU.
Avoid segmentation fault when mg(1) can't read an init file.
Support for ipcomp(4); disabled by default.
Show kern_fthread to the door.
Userland iopctl(8) control utility for iop(4).
In passwd(1), lock the passwd(5) file after having gotten a new password from the user; also change the actual locking procedure.
Support for /etc/wsconsctl.conf.
Handle descriptors 0, 1, or 2 being closed when ppp(8) is invoked.
Reduce MTU by 2 after MPPE has been negotiated in ppp(8).
Merge pdksh patch into ksh(1), fixing some problems with propagated return values in multi-command lines.
Utilize the welcome variable from login.conf(5), in ftpd(8), instead of hard-coding /etc/motd.
Discipline the audio(4) device so it gets along with revoke(2).
Repair NFS-related problem with diskless clients by getting the root filehandle via nfs_root.
Add support for screen switching to wsconsctl(8).
Change wsconsctl(8)'s interface to be more sysctl(8)-like.
Shuffle around maxlen setting inside the net subsystem to avoid potential problems.
Make icmp(4) error checking saner.
Initial ip6(9) support for isakmpd(8).
Packet normalization support for pf(4).
Userland sectok(1) control program.
Repair kern_fork brain-damage.
uvm(9) and MNN are no longer optional.
Import altq(9): alternate queuing support.
Poof! The old vm disappears.
No more M_COPY_* macros; use M_MOVE_* or M_DUP_*.
Add dmesg(8), wicontrol(8), and ancontrol(8) to powerpc's ramdisk.
New mvmeppc port.
Many mvme68k improvements including: switching to uvm(9), repairing system trace, cleanup of locore.s, KNF, etc.
pciide(4) support for powerpc.
Change icmp6(4) packet header length computation so it works with both 4.4BSD's M_COPY_PKTHDR and OpenBSD 2.9+'s M_COPY_PKTHDR.
Implement getpeereid(2), allowing local-domain servers to determine client credentials.
Support generic BSD authentication in xdm(1).
Disable usb(4) on alpha by default.
Kerberos v5 support for SSH1.
Hardware RNG support in lofn(4).
Smartcard support in ssh-agent(1) and ssh(1).
Large -Wall/-Werror/-W... ongoing cleanup throughout tree.
Nuke mips port.
Initial import of iop(4) (I2O) framework.
Rewrite nc(1), adding ip6(4) support.
In su(1), offload root instances for Kerberos to the auth program.
Disable SMB decoding in tcpdump(8).
Enable audio on alpha by default.
Endian fixes in the wi(4) driver.
Adios NQNFS.
Nuke the pmax port.
Don't perform TCP/UDP hardware checksumming when doing IP fragmentation.
Delayed checksum support in the netinet subsystem.
Support setting the Ethernet address through ifconfig(8) for vr(4) cards.
Bypass ipsec(4) for all dhcp(8) traffic, avoiding potential problems with newly booted clients.
Modify timeouts for IP spd expirations.
Internal fiddling of nfsd(8)'s handling of its root vnode.
Import pf(4), an ipf-compatible packet filter.
Avoid panics under i386 if bus/dev/func numbers for PCI are not valid.
New sysctl(3) KERN_POOLS to retrieve pool information from the kernel.
Cleanup and update dhcp(8) to 2.0pl5.
Utilize readpassphrase(3) in ssh(1).
Allow access to /dev/pci.
Repair multiple key handling in wicontrol(8).
New ether_input_mbuf to ease transition from ether_header in ether_input; drivers will migrate to this.
Wave goodbye to kernfs.
Replace existing telnetd(8) with the one from heimdal-0.3f.
Assorted modifications to uvm(9).
RELIABILITY FIX: link XF86Setup against the right version of libXxf86vm.a.
Fix the problem of corrupted XF86Config file produced by XF86Setup.
A source code patch is available.
[Applied to stable]
Avoid a pidfile/sigterm race in sshd(8).
Merge the system's crypto.h into crptodev.h, avoiding name conflicts with OpenSSL.
Various pool(9) improvements including a new pool_cache() function and cleaner locking.
Spelling audit throughout the manual pages.
Try to have ssh-keygen(1) decode ssh-3.0.0 private RSA keys.
New mg(1) feature: M-x theo.
Support PCI bus configuration from userland.
Add TCP, UDP, and IPv4 hardware checksum processing, excluding outbound TCP/UDP.
Internal shuffling of vnode(9) operations in some filesystems.
Disable interrupts in the wi(4) driver before mapping and establishing the interrupt, thereby avoiding a race condition.
MI loadfile support; currently only used on powerpc.
Obsolete *known_hosts2 in ssh(1).
Some hifn(4) fixes, largely related to descriptor lengths.
Don't let ssh(1) overwrite argv.
Shrink dmesg(8).
Merge authorized_keys2 into authorized_keys in ssh(1).
Provide a sysctl(3) interface to msgbuf; handy for dmesg(8), allowing it to run without setgid.
Upgrade to heimdal-0.3f.
Use moduli(5) instead of the deprecated primes.
Add RNG support in hifn(4) for the 7951.
In isakmpd(8), fallback to stat(2) when readdir(3) doesn't return d_type.
Apply KNF to many kernel sources.
Don't forward ip6(4) packets back into point-to-point link if the packet's destination address matches said p2p link's interface.
Lots of manual page cleanups.
Upgrade to openssl-engine-0.9.6a.
Many fixes in the kernel's lockf(3) code including avoiding livelocks on ptrace-related scenarios.
Modify file locking routine in the skey(3) library, preventing a race condition, plus other modifications; integrate.
Document physio(9).
More variables in login.conf(5): login-timeout, login-tries, and login-backoff.
Improve ppp(8): handle hardware-imposed MTU/MRU limitations; support stateful MPPE (Microsoft encryption).
Repair vi(1) to avoid spinouts when creating temporary files.
Make ftp(1) use binary for transfers as opposed to ascii.
Merge passwd.conf(5) into login.conf(5) and add passwordtime and minpasswordlen variables.
Move microcode includes around to avoid erroneously installing them, among other reasons.
Overhaul some kern_exec internals, cleaning up the setuid/setgid-checking code.
Adapt skeyinfo(1) to use BSD authentication and removal of the suid root bit.
Improve powerpc's awacs driver; many interrupt fixes.
Allow the use of ^T in passphrases read by readpassphrase(3).
SECURITY FIX: avoid race in execve(2) when checking flags for ptrace(2).
A source code patch is available.
[Applied to stable]
Update if_lastchange when IFF_UP is changed instead of on every packet transmission and receipt.
VM renovations on mvme88k.
Use va_start(3) and va_end(3) for every call to vfprintf(3) and associates.
Replace commonly used static lists with persistent growable arrays in make(1).
Have slstats(8) use an ioctl(2) so it doesn't need to be setgid.
Ensure *chi doesn't receive interrupts before being initialized.
Let pci_mapreg_map() take an extra argument to limit the size of the PCI region to map so we can still work with things publishing too much PCI memory.
Use lpd_flags in rc(8), allowing flags to be passed to lpd(8).
Support EDNS0 (RFC2671) buffer size notification for DNS queries.
Upgrade to binutils 2.10.1.
Protect include files in /usr/include/net against multiple inclusion.
Fix unmapped interrupt problems on some VIA-based boards.
New options, improvements, and fixes for wicontrol(8).
Palm support in libsectok.
Rewrite ldd(1).
RELIABILITY FIX: use correct db(3) pointers in pwd_mkdb(8), and don't star out empty passwords
A source code patch is available.
[Applied to stable]
Assorted ppp(8) alterations.
Correct initialization of the policy_id field for SA structures in isakmpd(8).
PCI shim for wi(4).
Repair preservation option in cp(1).
Allow the number of gre(4) devices to be changed in boot_config(8).
rc(8) no longer starts netatalk -- if installed -- by default.
RELIABILITY FIX: compute length correctly on certificates in isakmpd(8).
A source code patch is available.
[Applied to stable]
Ensure kqueue(2) works on ext2fs(8).
More pipe fiddling.
Enforce Remote-ID specified in Phase 1 peer section in isakmpd(8).
Ongoing license audit and copyright notice cleanup.
Extend pfkeyv2's RFC2367 compliance and fix backward compatibility problems.
Adjust routing socket message to the right size.
Switch UID when sshd(8) cleans up temporary files and sockets.
Speed up arc4random(3) in some net subsystems.
Upgrade to XFree86 4.1.0.
Use default hoplimit when icmp6_error doesn't know about the incoming interface.
Create sysctl(3) parameters for ccpu, diskstats, fscale, nprocs, and physmem.
New md5(1) implementation with a BSD copyright and other improvements; includes regression test.
Improve swapctl(8).
Don't allow packets that need IPsec(4) processing to be bridge-broadcast.
Expand handling of X.509 and KeyNote certificates in isakmpd(8).
Fix some tcp(4) behaviour with connections in the CLOSING state.
Some ld.so(1) renovations.
Repair kqueue(2) related panic.
SECURITY FIX: verify location when using fts(3) to pop up directories.
A source code patch is available.
[Applied to stable]
Update root device selection routines for sun3.
Miscellaneous fxp(4) improvements.
Remove ipf(4) from the tree.
Remove pcvt(4) from the tree.
Add BSD authentication support to userland programs; authorization defaults in login.conf(5).
SECURITY FIX: Update to sendmail(8) 8.11.4 which addresses signal race conditions.
A source code patch is available.
[Applied to stable]
Hardware clock support on powerpc.
Fix directory state tracking in fsck(8).
New BIOCGHDRCMPLT and BIOCSHDRCMPLT ioctls for bpf(4) to disable overwriting of the link-level source address.
Support interface capabilities.
Repair cluster_rbuild() in vfs_cluster.
Twiddle with the atapiscsi(4) driver.
fxp(4) bug fixes.
Bring back the old (no ECONNABORTED) accept(2) behaviour for Unix domain sockets.
Support Heimdal's Kerberos 5.
Upgrade to Perl 5.6.1.
Allow arbitrary atime/mtime setting on ext2fs(8) volumes.
Fix lookup code in procfs(8).
Many assorted mg(1) fixes and improvements.
Clean up and shrink make(1).
Various improvements to the ubsec(4) driver.
Fix panics in the ep(4) driver by initializing packet tags.
New PCMCIA products from NetBSD.
Utilize packet tags in the net subsystems.
Diversify time parameter parsing in sshd(8).
Better keyboard-interactive support for ssh(1).
Convert lseek(2) read(2)/write(2) to pread(2)/pwrite(2) in kvm(3).
Import libsectok, used for ISO 7816 smart cards and iButtons.
Tweak delays in the i82365 PCMCIA controller driver to avoid momentary freezes.
Improve rate support in auich(4).
Make vax use wscons(4) and enable the smg framebuffer.
More select(2) fixes in ssh(1).
Fix X11 client bug in ssh(1).
PMAP_NEW support on the vax and hp300.
Create COMPAT_23 and COMPAT_25 options.
In vr(4), handle suspend mode better on the VT6102.
Do not check return values for malloc(9) calls with M_WAIT or M_WAITOK.
New option: SMALL_KERNEL, subtly changes some kernel semantics to change the kernel size significantly. Use *only* for boot floppies.
Change ip_sum semantics in ip_output().
Compress ac97(4) vendor tables.
ac97(4) now knows about rev 2.2.
Squish compatopts to a more sensible set, killing COMPAT_09, COMPAT_10, COMPAT_11.
Shrink the alpha boot blocks a bit.
We no longer support ECOFF kernel loading in the alpha boot block.
Teach ac97(4) about more CODEC models.
At boot time, swapon(8) before fsck(8) is run.
Fix fts(3) to handle very long paths.
Repair various signal handler bugs in pppd(8).
Handle memory allocation failures in fsck_ffs(8) and fsck_ext2fs(8) better.
Fix a recently introduced bug in supfilsrv(8).
Correct acceptance of ARP packets coming in on non-IP bridge(4) interfaces.
[Applied to stable]
txp(4) now works on the alpha.
More fixes to make(1).
Check a calloc(3) in fsck_ffs(8).
Add a temporary DTYPE_CRYPTO until device cloning support shows up.
Fixes to fdescfs.
busdma changes to txp(4), preparing for the alpha.
Split wi(4) into bus dependent and independent parts.
On hp300, splhigh() in cpu_exit().
Misc cleanup of the shared m68k codebase.
More bus_dmamap_sync(9) in hifn(4).
Initial non-working alpha ld.so(1) support.
Support newer versions of the lmc(4) cards.
Kill a debug message in ubsec(4).
Add swiss german keyboard layout to wscons(4).
Smoke out the OLD_PIPE code.
krb4-1.0.8
Bug fix to make(1).
Speed up top-level tree Makefiles by doing exec for subshells in new directories.
Artful fiddling of the kernel pipe stat code.
No need for setgid kmem on iostat(8) anymore.
Add more sysctl(3) support in the kernel.
Make the alpha floppies fit again...
Make hifn(4) use bus_dma(9). Now works on the alpha.
Initial cut at userland hardware crypto(4) support.
In ubsec(4), initial support for the Broadcom 5820.
Honour ddb.console on sun3.
On the pmax, fix a curproc misuse.
In pcibios(4), deal with buggy BIOSs which incorrectly leave the router as 000:00:0.
hp300 cleanup in progress...
Solve a problem of Lilliputan proportions in powerpc isinf(3).
Mickey goes mad and does a strlcpy(3) whack on src/bin.
Unify rdsetroot and rd(4) support between almost all architectures.
Man page cleanups galore.
In hifn(4) attempt to support the Hifn 7951.
Do stdout/stderr flushing in sshd(8) using non-blocking mode.
Fix kerberosIV versioning link problem.
Cleanup MAP_COPY flags in the tree.
Use genassym.cf on alpha.
Unify the rd(4) support.
Update sysctl(8) and vmstat(8) to use the new interfaces.
Make more data available via the sysctl(3) interface.
Handle fastroute in the bridge(4).
hp300 man page cleanup.
Fix a resource leak in twe(4).
[Applied to stable]
Use madvise(2) option with MADV_FREE for malloc(3) 'h' flag.
Support MADV_DONTNEED and MADV_FREE in madvise(2).
Switch sparc to UVM and PMAP_NEW.
Support HP425e.
Refill txp(4) receive ring only when empty -- performance enhancement.
Fix SSH2 -R support in ssh(1).
More pmap/uvm interface changes.
Correct signal handling in ping6(8).
Implement screen blanker in wscons(4).
Attempt to support hifn7951 in hifn(4).
realloc(3) fixes to ipf(8).
ipf 3.4.17
Fix kernel extent code to be more careful about ranges.
UVM support for mac68k.
Change i386 in_cksum failure to a printf(9), instead of a panic(9).
[Applied to stable]
In txp(4), add support for hardware vlan(4).
Fix a bug in make(1) exposed by the recent jumbo patch.
Fix ti(4) to handle vlan(4) properly.
vsunlock fixes to UVM.
Signal ignore bug fix to ssh(1).
Kill i386 VM & pmap_old support.
Fix process priority bug in atrun(8).
Enable vlan(4) by default in GENERIC kernels.
Fix pread(3), preadv(3), pwrite(3), and pwritev(3) on big endian architectures.
In sendmail(8), use FAST_PID_RECYCLE.
Remove excess (vaddr_t) casts.
Get rid of CLSIZE and friends.
Increase strlcpy(3) in parts of the tree.
Some minor changes to isakmpd(8).
Cleanup M_* malloc types in the kernel.
UVM for the hp300.
Numerous cleanups to sup(1).
In systat(8), handle kvm_nlist(3) failing.
Fix a channel race in sshd(8).
Document that nc(1) no longer has a -e option.
Fix localhost handling bug in httpd(8).
Jumbo patch to make(1) that has been brewing for a while.
Various improvements to mg(1).
Big USB code update.
Fix a signed vs unsigned error in the gm(4) Ethernet driver.
In wump(6), improve our cave topology algorithm. Don't ask.
Force -h to override the BLOCKSIZE environment in du(1).
Substantial updates to sup(1).
Fix a register save/restore bug in clcs(4) so that suspend/resume works better.
Allow the right CTRL+ALT keys to work as the left ones do in wskbd(4).
Continue to hack our new txp(4) driver into shape.
In ifconfig(8), implement support for removing tunnel outer IP address pair.
Revert a buggy optimization in tsort(1).
Use pread(2) in nlist(3) instead of abusing lseek(2) with read(2).
Remove cruft leftover from the old PCVT console driver.
Fix filename tab-completion in mg(1).
Convert some more drivers to the new timeout(9) interface.
Whack dtom() in the kernel. Fo'get about it.
Avoid a NULL pointer dereference in faithd(8).
Various reset and delay fixes in wdc(4) to help certain ATAPI devices.
Deal with suspend/resume more cleanly in pccbb(4).
Better hints handling and memory allocation in tsort(1).
Correct an error condition in /etc/ksh.kshrc.
Add a koi8-r keyboard layout for wskbd(4).
Allow interoperability between OpenSSH and older ssh-2.0.x variants with weaker key generation.
Instrument improved locking and rework SCSI a bit in ami(4).
Cleanups to ancontrol(8).
Add a -b option to ssh(1), similar to telnet(1)'s equivalent.
Fix a memory handling bug in telnet(1).
Use pool(9) interface for the VFS cache.
Improve OpenSSH interoperability with ssh.com-2.0.x clients.
In the mvme88k port, replace resource maps with extents.
Numerous fixes and updates to sup(1).
--------
Changes made between OpenBSD 2.8 and 2.9
SECURITY FIX: Avoid DoS attack in ftpd using glob patch.
A patch is available.
[Applied to stable]
...
SECURITY FIX: Fix ipf(8) fragment caching bug.
A patch is available.
[Applied to stable]
...
SECURITY FIX: Fix buffer overflows contained in glob(3) function.
A patch is available.
[Applied to stable]
...
Check for short packets and bad types sent to timed(8).
[Applied to stable]
...
OpenSSH 2.5.2 released.
[Applied to stable]
...
SECURITY FIX: Be careful with file permissions in readline library
A patch is available.
[Applied to stable]
...
Make buffer size 8k on NE1000, and 16k otherwise for ne.
[Applied to stable]
...
Move bogus packet length test in udp packets to avoid being stuck at splsoftnet.
[Applied to stable]
...
SECURITY FIX: on i386, check arguments to USER_LDT (not enabled by default) mappings.
A patch is available.
[Applied to stable]
...
IMPLEMENTATION FIX: fix port number computation in libwrap client side ident implementation.
A patch is available.
[Applied to stable]
...
Fix several copyin/copyout bugs in sys/compat.
Provide a random start for tcp timestamps.
Support sharing disks between MacOS and the PowerPC port.
Add support for the SaramNcom NS-1100M in the wi(4) driver.
Fix support for the D-Link DE660 pcmcia card in ne(4)
In sis(4) add support for reading the MAC address from the APC CMOS RAM in SiS630E-based chipsets.
In ne(4), changes in media type initializion on DP8390-compatibles.
Implement read/write access to an IEEE 802.3u mii(4) bus using the bit-bang method.
Add support for DOZE mode on powerpc processors that support it.
Add support for the Symbios 53c1010 in the siop(4) driver.
Implement mincore(2), mlockall(2) and munlockall(2).
Added support for ami(4) MegaRAID Controllers.
Fixed several occurrences of exit(-#); exit(3) only passes the lower 8 bits of status on to the parent.
Fixed several occurrences of PATH_MAX+1 that should be PATH_MAX.
Fix interrupt handler registration on the mvme88k port, remove 68k-isms and add UKC support.
Add some non-US encodings to the USB keyboard driver.
Disable bogus file check in cvs(1).
[Applied to stable]
Enable tag queuing and fix some wide/sync negotiation problems in the siop(4) driver.
Add support for isapnp(4) i82365-based pcmcia(4) controllers.
Many man page fixes.
Fix checksum calculations in bridge(4) setups.
Avoid reading some AC97 registers in neo(4) driver as needed by some devices.
Avoid a deadlock condition in the syncer.
wscons(4) support for powerpc adb keyboard.
Plug many memory leaks in the libc rpc(3) code.
Drop packets with 127.0.0.0/8 in header field, if the packet is from outside. RFC1122 dictates that 127.0.0.8 must not appear on the wire.
In sudo(8), fix negation of path-type Defaults entries in a boolean context in sudoers(5).
Add open hashing functions to libc.
fsck(8) changes for soft updates support.
Extend kqueue(2) down to the device layer for better device support.
ncurses-5.2-20010224
In the i386 bios(4) driver, add a check for ROMs mapped into memory and setup an extent for each one found. This fixes a problem with ISA cards using iomem space already claimed by a ROM.
Update to sendmail(8) 8.11.3 which fixes potential data loss if a machine crashes.
A number of filesystem races and locking problems have been fixed.
In ne(4), add support for a D-Link DFE-650 model with a different vendor ID.
Improved stability with soft updates.
WEP support for the an(4) Aironet driver.
Default SSID in the an(4) Aironet driver; now it will connect to any SSID.
Better detection of the VAX VS4000/VLC and MV3100/{3,4}0.
Improved S3 Savage X11 driver for XFree86 3.3.6.
Add mii(4) support to the vr(4) Via Rhine network driver.
Add support for the Dlink 530TX+ to the rl(4) RealTek 8129/8139 network driver.
SECURITY FIX: for ipsec(4), handle AH packets with IP options more strictly.
A patch is available.
[Applied to stable]
In the powerpc port, add edge/level sense detection capability to the interrupt controller.
Add uftdi(4) driver for the FTDI USB->Serial converter device.
Tone down the verbosity levels in many SCSI drivers.
OpenSSH 2.5.1 released.
[Applied to stable]
Fix DMA memory allocations in twe(4).
SECURITY FIX: update to sudo-1.6.3p6 which fixes a non-exploitable buffer overflow on very long argv components.
A patch is available.
[Applied to stable]
Correctly detect Daylight Saving Time changes in cron(8).
Add bash-like double-tab completion support to ksh(1).
Avoid losing RTC after suspend/resume on some laptops.
Repair an integer conversion bug in pms(4) which fixes the mouse resolution setting in X.
Fix non-TCP protocol mappings in ipnat(4).
In isakmpd(8), encode X.509 expirations into KeyNote credientials/policies.
In pppoe(8), try every BPF device, not just even-numbered ones.
Support -C flag in nm(1).
Update ISC cron(8) to 4.0b1, maintaining our local changes, including signal handling fixes.
Rename old mvme68k and mvme88k siop(4) driver to ssh(4) to avoid naming conflicts.
Fix an uninitialized variable in wsmouse(4).
Some games fixes.
Nuke nlist(3) and kvm(3) usage in top(1).
More careful buffer handling in rusers(1).
Add MII support to the vr(4) driver.
Several IPv6(4) improvements from KAME.
OpenSSH 2.5.0 released.
[Applied to stable]
Sync many parts of the alpha port with NetBSD.
Fix 64-bit issues with the IPv6(4) multicast API.
Rewrite libwrap RFC931 support to avoid stdio issues with sockets.
Many man page fixes.
Pull in latest faithd(8) daemon from KAME.
In tcpdump(8), deobfuscate some IP protocols and improve IPsec(4) tunnelmode printing.
Set the offset for SCSI chain B properly in the VAX ncr(4) driver.
Import XFree86 4.0.3.
Long username fixes to lpd(8) and lprm(1).
Convert the powerpc port to UVM(9).
Import siop(4), a replacement for the ncr(4) SCSI driver.
Support more NE2000 PCMCIA devices.
Avoid passing shared mbufs around the kernel to prevent accidental overwrites.
Add pcscp(4), a driver which supports AMD Am53c974 SCSI controllers.
Modify sliplogin(8) to handle long usernames.
Allow X to work without pcvt(4).
Fix an authorizer removal problem in keynote(3).
Deactivate function pointers upon interface detach to avoid crashes.
Deal with the real time clock losing interrupts on i386.
Bump maxusers to 32 in the alpha port.
Avoid a theoretical buffer overflow in getpwent(3).
Fix an uninitialized variable in bsd.port.mk(5).
Disregard ospeed in tetris(6).
Modify wall(1) to handle long usernames.
Many isp(4) SCSI driver improvements and updates.
Fix goto-line 0 case in mg(1).
Fix PermitRootLogin option in ssh(1).
In brconfig(8), skip empty lines in the rulefile.
Fix HTTP installs, which were broken for quite awhile.
Repair statclock on mvme88k.
Ensure softupdates is enabled before performing softupdates-specific operations.
Define a sendmail(8) variable to workaround broken name servers.
Allow up to 12 virtual terminals in wscons(4).
Correct VAX signal handling.
Cleanup MAC support in SSH2.
Support attachment of Cheetah devices to vsbus as well as ibus in the VAX port.
Disable a bogus file check in cvs(1) to ease the pain of having replicated repositories.
Ensure $RSH is set in the rcmd(3) functions.
String table fixes to ddb(4) and modload(8).
Update wscons(4) code.
Pull in fixes for potential buffer overflows in xdm(1).
Compatibility fixes to tar(1).
Many OpenSSH cleanups and improvements.
New ELF symbol handling in ddb(4).
Enable wscons support in XFree86.
Modify PCI power state for clct(4) devices so they work after warm reboots.
Repair BPF support in gre(4).
Fix an uninitialized variable in wsdisplay(4).
Fix file attribute passing in sftp-server(8).
Correct a memory usage error in ssh-keyscan(1).
Add support to the powerpc for loading the bootloader and kernel from an HFS filesystem.
Better failure handling in vr(4).
Add support to dc(4) for parsing media blocks from Intel 21143 SROMs.
Strengthen SSH1 to make traffic analysis more difficult.
Updates to /etc/services from IANA.
In ssh(1), enforce non-batch_mode if StrictHostKeyChecking is set to "ask".
Backport a buffer overflow fix from XFree86 4.0.2 to in-tree XFree 3.3.6.
Stricter prototypes, type fixes, and other cleanups in OpenSSH.
Switch IPv6 raw socket code from NRL to KAME.
Stricter checking in SSH2.
OpenSSH 2.3.2 released.
[Applied to stable]
Implement an upper limit for icmp6(4) redirects.
Fix rwhod(8) to work, and make debug code a flag option.
Mark our tree such that we use wscons(4) as if it is vt220, instead of vt100.
In wscons(4), when scrolled back, if a new key is pressed, reset us to our previous location, as pcvt(4) used to do.
Permit sftp(1) over SSH1 protocol.
In sftp(1), do not forward agent or X11 traffic.
In tar(1), fix -T option and add support for -C option
Honor TMPDIR variable in tar(1), cpio(1), and pax(1).
perl(1) patch CHANGE6214.
New route6d(8).
Numerous more changes to sftp-server(8) and sftp(1).
Changes to accept(2) to permit return of ECONNABORTED.
Quieten IPv6 DN message reporting by default.
Improve xmalloc() and friends in ssh(1) code..
Remove dead architecture support from the tree.
Remove support for #! from syslogd(8).
cac(4) driver to support Compaq Smart ARRAY RAID controllers.
Ignore blank lines in hostname.if(5) files.
In ssh(1), add -1 option to force protocol 1.
Enable sftp-server(8) by default.
Numerous bug fixes to sftp-server(8) and sftp(1).
Make scsi work on the vaxstation 4000/90.
Same for tun(4), gif(4), and others..
Change lo(4) initialization code so that boot -c pseudo-device editing code can affect it in the expected fashion.
If kernel has ddb(4) support, add a ddb sub-command inside boot -c.
Teach the bridge to deal with ARP alignment in the presence of numerous previous layers...
EtherIP support in tcpdump(8).
Fix a bug introduced a few weeks ago in yppush(8).
A bit of a trawl through the source tree to please the alpha, since various problems occur in the absence of perfect weak symbols.
libc_r works on the alpha now.
Many new fixes to sort(1).
Teach config -e and boot -c about pseudo-devices.
Fix perl(1) h2ph scripts.
More bridge(4) fixes for unicast learning.
Add sftp(1) client.
Fix an off-by-{1,2,4} error in i386_space_copy(). wscons(4) now works perfectly.
More fixes to rtadvd(8).
Fix bugs in atc(6), snake(6), battlestar(6), phantasia(6), and adventure(6).
Enable scrollback from USB keyboards.
Numerous improvements in ppp(8).
At ELF execve(2) time, check for the OpenBSD note first, so that native binaries run best.
Attempt to share crtbegin/crtend in ELF csu, including an OS note.
Change powerpc ld.so(1) so all architectures use DT_INIT for ctors/init.
Fix overlapping bus space copy operations on i386.
Move EtherIP to version 3 (2 byte padded header).
Art does battle with ksyms(4), gets wounded, but eventually wins.
In sshd(8), S/Key is now called ChallengeResponse.
Make ReverseMappingCheck optional in sshd_config.
Mickey the madman goes on a new timeout crawl through pci and isa drivers.
Fix nlist(3) emulation for cases where the ELF header does not exist; permits /dev/ksyms to work on ELF machines.
Emulate some new freebsd signal(2) related things in compat_freebsd(8).
In IPv6, avoid panic when packet to nonexistent link-local address is issued.
xl(4) no longer needs to whine about tx underruns.
Fix ELF support for compat_freebsd(8).
Catch the alpha up to wscons(4) changes.
Fix wscons(4) wsmux(4) attachment.
Support mvme188 card in mvme88k port.
If a pccbb(4) bridge does not have the right voltages, assume it is dead. Permits single connector adapters to work.
Fix some bugs in the bridge(4), especially regarding gif(4).
IMPLEMENTATION FIX: fix memory allocation in the PCI LANCE ethernet driver, le(4).
A patch is available.
[Applied to stable]
In config(8) -e and -u, do not write out a new kernel if nothing changed.
Numerous fat utmp(5) changes to utilities.
Move utmp(5) to large format.
Fix some incorrect return values for mmap(2) functions.
[Applied to stable]
Make top(1) not setgid.
Update X11 to support the new i386 changes.
Configure wscons(4) defaults to be what our users expect.
moused(8) is dead for now.
Enable uhci(4) and ohci(4) devices by default in GENERIC.
Range-check invalid .max fields in inetd(8).
Various post-merge ipf(8) fixes. Some previous fixes got removed and had to be put back in.
In ATAPI code, ignore PIOMODE errors.
On many architectures, change console name to ttyC? instead of ttyE?.
Add -U option to ELF ldconfig(8).
Move i386 to wscons(4).
Re-org the alpha boot floppies.
More improvements against the Bleichenbacher pkcs#1 attack.
Fix more select overflow issues in ssh(1).
gcc 2.95.3, test 2.
ises(4), start of a driver for the Pijnenburg PCC-ISES crypto chip. Does random entropy insertion.
Permit many compat system calls to match to the same native call (was not permitted before).
A bunch of people are doing a kernel trawl to update drivers to new timeouts.
Support boot -c on the sparc.
Fix an early timeout bug in wdc/ata support, which caused problems with atapi tape drives.
Niklas runs through the tree doing commits in an attempt to keep up with Todd's much higher commit count.
Receive random numbers from ubsec(4) cards.
Make wdc mode printing more portable, so that the powerpc can use it too.
adb(4) drivers in powerpc port.
New upl(4) driver for Prolific PL2301/PL2302 USB host-to-host driver. This acts like a network device.
Remove -Q flag from sshd(8).
Change audio-driver interface so drivers can supply a minimum delta for mixer value changes.
USB sync.
SECURITY FIX: fix some buffer overflows in named(8).
A patch is available.
[Applied to stable]
Support Cheetah vaxes.
Improve MAKEDEV(8) manual pages on many architectures.
Cause pcibios(4) to route interrupts via the pci router at the time interrupts are established for each driver, not before.
Optimize pcidevs, usbdevs(8), and other tables in the kernel.
Both wi(4) and awi(4) now support more models of cards.
skey(1) SHA1 is supposed to be little endian.
Improve ping6(8) signal handling further.
Merge isakmpd(8) in. It is no longer separate.
Many ppp(8) improvements.
Handle binary data in install floppy dmesg.
Improve ELF handling of nlist(3).
Print CPU speed in GHz if it is that fast.
Detect Transmeta CPUs.
On powerpc, ensure that signal delivery fills in rval[1]; at least pthread was affected.
Move powerpc to MACHINE_NEW_NONCONTIG.
In mg(1), do not use rename(2) on the ~ file; make a new copy so that vipw(8) and crontab(1) do the right thing.
Tweak alpha so it sends SIGBUS for unaligned access, and does NOT do a fixup. This encourages people to fix their code.
KGDB support for the i386.
Pack alpha definition of infinity properly, other architectures too.
Recognize Intel P4 CPU.
Various space optimizations for alpha boot floppies.
Fix CF wdc, which was broken for a while.
Add "enable" keyword in config(8) files.
Merge and simplify emulation directory handling code.
Support Initio INI-91xx cards via new iha(4) driver.
In accept(2), when peer disconnects before accept is issued, do not return junk in mbuf by setting length to 0.
Support Hardware RNG on i850 and i860 hubs.
Fix sysctl(3) so that you can clear a string with it.
In sshd(8), rename "skey" to "challenge response", since this mechanism is now more flexible.
Reduce how long we wait for scsi devices to come ready; 50 seconds is enough.
pcvt(4) keyboard LED update lockup patch.
ncurses-5.2-20010114
Fix many more sshd(8) memory leaks.
Fix memory leak in isakmpd(8).
In timed(8), do not accept packets with an unterminated hostname.
[Applied to stable]
Alias map bios rom at both real address and it's own zero-relative address, because bios roms contain bugs.
In rtadvd(8), sync router renumbering flag bit to conform to 2292bis-02 and RR RFC.
Get rid of -R flag in ssh-keygen(1).
Avoid memory leak in ndp(8).
Establish pccbb(4), ohci(4), and uhci(4) interrupt handler much earlier, because of coming pcibios(4) changes.
Numerous small fixes to sshd(8) and friends.
In ssh(1), fix SIGSEGV for -o "".
On i386, validate gate targets.
The easy delete key always returns ^?, while the more difficult one returns ^H.
Incorporate a set of post-4.4BSD changes to the kernel routing code.
Support more than 256MB of ram on powerpc.
Be more careful with assuming with VIA chips can handle U66.
Document better how code using sigblock(3) and sigsetmask(3) would be converted to use sigprocmask(2).
Get sshd(8) ready for auth-login.
In ifconfig(8), permit prefixlen to work against ipv4 addresses.
Change savecore(8) to deal with machines dumping 1GB or more..
Attempt to deal with inverted signal races in terminal handlers better, throughout the source tree -- ie. main code is deep inside stdio, signal handler calls exit().
Document rules that apply to signal handlers in signal(3) and sigaction(2).
ipf 3.4.15
Fix a vi(1) crash.
SECURITY FIX: The rnd(4) device does not use all of its input when data is written to it.
A patch is available.
[Applied to stable]
Fix C sequence point issues in dd(1), monop(6), tail(1), and rbootd(8).
Fix previous inetd(8) fix.
Fix signal handler race in apmd(8), bootpd(8), syslogd(8).
Constrain isp(4) openings to 128, since the vendor code lies, cheats, steals, and makes us cry.
Fully support SSH2 RSA keys in sshd(8).
Change alpha bootblocks to ELF.
Fix fd_set overflows and signal races in pppoe(1).
Important pthread fix.
Large block of documentation and functionality changes to mail(1).
fd_set overflow fix to routed(8).
Signal handler fix to newfs(1).
Cleanup various signal races and buffer overflows in ed(1).
Fix signal race in mountd(8) by writing our own svc_run() routine.
Fix uninitialized variable bug in config(8) UKC code that ignored first command sometimes.
Various changes ensure that all known le(4) cards now work on sun4, sun4c, and sun4m machines.
Tweak subr_extent code with respect to boundary cases.
sftp-server(8) draft came out; convert our sftp-server(8) to be compliant.
sendmail 8.11.2
Signal race fixes to fsck_ffs(8), rcp(1), slattach(8), shutdown(8).
Change asm and volatile to __asm__ and __volatile__ in any file which might be compiled using -ansi -pedantic or similar.
Some signal handler cleanup in rcp(1).
Cleanup timeout code in adw(4).
Numerous alpha catchups.
New rtadvd(8) code.
Compute UDP checksum in dhcpd(8).
Move mvme88k to UVM(9).
clct(4) driver for Cirrus Logic CS4281 sound chips.
Support {Allow,Deny}Groups in sshd(8).
sshd(8) SSH2 protocol support for keepalives, IPTOS_LOWDELAY, TCP_NODELAY, and IPTOS_THROUGHPUT.
Add kerberos(1) password handling in sshd(8) for kerberosIV.
More memory leak fixes to sshd(8) and ssh(1).
Tweak strlcat(3) to not crash for a certain "illegal pointers, length 0" situation.
Clarify setjmp(3) variants in the manual pages.
Correct fd_set and signals in ping6(8).
Un-race three signal handlers, and fix select overflows in inetd(8).
Fix signal race in route6d(8).
Move mvme88k to MACHINE_NEW_NONCONTIG.
Fix signal races in rwhod(8).
Fix fd_set overflow in yppush(8).
Fix closedown stub generated and hand-whacked by rpcgen(1) in ypserv(8).
Audio driver for most ESS maestro(8) models.
Signal race repairs in talkd(8) and comsat(8).
Fix select overflow in ssh-agent(1).
Fix rpcgen(1) to deal with large fd_set.
Document various signal races in the source tree which are very difficult to fix, or which turn out to be safe even if they look flawed.
Rename ich(4) to auich(4).
Cleanup the sftp-server(8) implementation.
Support !command feature in bridgename.if(5) files as well.
Numerous other small changes to isakmpd(8).
Handle memory failures in passwd(1).
In finger(1), fail nicely if memory allocation fails.
Handle DELETE payloads in isakmpd(8).
Remove signal races from sshd(8).
Ease support for road-warrior scenarios in isakmpd(8), by intuiting the Local-ID when possible.
Change 802.11 DS drivers to operate in BSS mode by default.
Create links for FD_SET(3) and such to point to the select(2) page.
Support TCP_NDELAY on ipv6(4) in ssh(1).
Numerous spelling error corrections in the system.
Various other calendar updates.
Ensure replydirname in ftpd(8) does not ever truncate names.
Ensure ftpd(8) does not sometimes return a stray " at the end of a string.
Various large updates to isp(4).
In restore(8), do not skip TS_BITS or TS_CLRI are set.
Change our own custom EtherIP protocol to the standard one (which is very badly designed, but we are trying to get them to fix that).
Fix KerberosIV code to build better if src and obj are in strange places.
Support Banner option in sshd(8).
Make the openssh-p effort a bit easier by merging some simpler portability hacks.
Various missing free(3) calls repaired in ssh(1).
Attempt to support cardbus 3CXFEM656C 56k Global modem.
In pciide(4), support U100 on ICH2, U66 on Via Apollo, and other repairs to Promise.
Spelling changes to calendar files.
Be more careful with stat(2) handling in mv(1).
Fix %p handling in strptime(3).
Fix various buffer overflows and other fixes in indent(1).
Do not spit out icmp6 checksum messages if not a debug kernel.
Permit stripped VAX kernels to load despite unexpected values from libsa.
Simplify locking and a few more fixes to twe(4).
Plug some memory leaks in OpenSSH.
Fix -P in ftpd(8).
Emulation fixes to the VAX code.
Protect bits of dhclient(8) with a locking mechanism to prevent multiple instances from using the leases file simultaneously.
Fix 3 cases in mv(1) relating to the moving of symlinks across filesystems.
In ftpd(8), expand the tilde character in ftp-dir login.conf variable.
Prohibit binding to an anycast, notready, or detached IPv6 address.
Rename fsinfo(8) to xfsinfo in X11 to avoid naming conflict.
Set the correct pfkeyv2 direction for KAME SPD entries in isakmpd(8).
Save and restore errno properly in flex(1) since it may be whacked by isatty(3).
Fix sending/receiving passwords in routed(8).
Add an i386-specific sysctl(3) that modifies halt -p processing in APM to deal with some quirky machines.
More sun3 fixes, mostly to conform better to other m68k architecture code.
Handle login banners better in SSH2 instances of ssh(1).
Various spelling and grammar fixes across the tree.
Use new sysctl(3) interface for kernel memory bucket statistics and clock information.
Correctly check for empty mailq(1) in /etc/daily.
Y2K fix in the mvme68k NVRAM code.
Extend sysctl(3) to support quad values.
Improve SMB packet printing in tcpdump(8).
Add common pidfile-writing code to DHCP so each program doesn't need to roll its own.
To please cap_mkdb(1), make it an error to open a zero-length file for read-only access in hash(3).
Some sun3 architecture fixes.
Ignore environment variables in libssl if we're running setugid.
In ssh(1), log the remote IP address on disconnect.
Check for memory allocation failure in vmstat(8).
Fix a buffer overflow in fsinfo(8).
Handle another special case in apm(4).
Fix a panic in the RAIDframe locking management code.
Add setpid command to fdisk(8) for setting the partition ID.
Change bridge(4) to use gif* instead of enc*.
Set SO_REUSEPORT socket option in DHCP code, so multiple dhclients work.
Allow printing of 8-bit ASCII characters in talk(1) through an option.
Do not perform getnetbyname() in mountd(8) if the address is already in dot-notation.
In ftpd(8), log the actual number of bytes transferred instead of the original file size.
Fix ^C in termtype prompt.
Prevent fsck_ffs(8) from marking a filesystem clean if fsck(8) needs to be rerun.
Resolve scheduling conflict in newsyslog(8).
In dhclient(8), set a reasonable default lease time if the server does not provide one.
Suppress uninteresting PCI bus error messages in ahc(4).
Add m88k support to gprof(1).
Add HostKeyAlias option to ssh(1).
Behave nicely with fixed-rate codecs in auvia(4).
Fix a minor off-by-one error in gprof(1).
In the ports infrastructure, take the old non-fake code out-of-line.
Repair a disgusting rwhod(8) crash.
Fix buffer overflow in csh(1) builtin printf(1) implementation.
Convert atoi(3) to strtoul(3) in top(1).
Emulate Linux truncate64, stat64, lstat64, and fstat64 syscalls.
Revoke root privileges earlier in ping6(8) and traceroute6(8).
[Applied to stable]
Many man page fixes.
Use arc4random(3) in jot(1).
Handle quotas over 4GB in edquota(8) and repquota(8).
Fix IPv6 Path MTU Discovery.
Give up euid more carefully in mrinfo(8) and mtrace(8).
Various OpenSSH fixes.
Add support for ActivCard, CRYPTOCard, and SNK-004 authentication for the BSD authentication framework.
In ksh(1), remain in non-blocking mode if the shell is not interactive.
SECURITY FIX: xlock now authenticates via a pipe.
A patch is available.
[Applied to stable]
IMPLEMENTATION FIX: PS/2 mouse driver, pms, lockup fix.
A patch is available.
[Applied to stable]
Implement a workaround in atapiscsi(4) for buggy Toshiba drivers.
SECURITY FIX: Fix holes in procfs(8).
A patch is available.
[Applied to stable]
Put strlcat(3) and strlcpy(3) into libkern for kernel use.
Fix setting of nwid for wi(4).
[Applied to stable]
Change /etc/security to spit out unified diffs.
Add driver for Compaq SMART Array RAID controllers, cac(4).
Extend the i386 allowaperture sysctl(3) to allow access to the whole 1st MB of memory.
Add some more sanity checking to the PCMCIA code to fix some obscure panics.
Import Apache 1.3.14 + mod_ssl 2.7.1.
Support multiple pfkeyv2 keying daemons.
Compute diffie-hellman in parallel between server and client in OpenSSH.
Support Amigas with more than 64MB of RAM.
Ensure /etc/sudoers is created with a proper secure mode.
Import OpenSSL 0.9.6.
More photurisd(8) improvements.
Update kernel pfkeyv2 code for better conformance to the RFC.
Enable loading of ELF kernels for alpha.
Add extraction support for shell archives to the bsd.port.mk infrastructure.
In ipsec(4), look for TDB if gateway is unspecified.
[Applied to stable]
Fixes to patch(1) -f and -b.
Convert some more drivers to the new timeout(9) interface.
Add bytecounter statistics reporting to netstat(1).
Instrument more random TCP sequence numbers.
IMPLEMENTATION FIX: Compute crypto(9) session IDs correctly for kernel.
A patch is available.
[Applied to stable]
In sshd(8), permit logins with read-only root filesystems if the tty already has sane modes set.
Source port < 1024 is no longer required for rhosts-rsa in sshd(8).
Remove dead code in hifn(4) driver.
Proper getopt(3) usage in compress(1).
Fix a time specification in last(1).
Do not disable PMTU for established TCP connections unless there is data to send.
Add support for the 802.1D spanning tree protocol to bridge(4).
New BSD authentication login scripts.
Listen to pfkeyv2 acquire messages in photurisd(8), and setup SAs accordingly.
isakmpd(8) update.
apm(4) bug fix that helps a few laptops.
Remove unnecessary code from photurisd(8) in preparation of new SPD framework.
Repair a memory leak in ICMPv6 code.
Turn off PMTU when ICMP needfrag messages get blocked.
Finnish updates for inter.phone.
Display number of successful IPv6 PMTU changes in netstat(1) -s output.
Do not re-print ETA on completion in scp(1) when copying 0-sized files.
Validate ICMPv6 "too big" messages based on PCB.
Do not use already-freed memory in route(8).
Avoid repeated host controller halted messages in uhci(4).
Remove unused libgmp.
Import KerberosIV v1.0.4.
Always request a new challenge for skey/tis-auth in ssh(1).
Support newer cy(4) communication cards.
Provide new international keymaps for pcvt(4).
Ignore filesystems marked "xx" in the install scripts.
Document that pipe(2) is bidirectional, although this behavior is unportable.
Move the default cvs(1) connection protocol from rsh(1) to ssh(1).
Remove a bogus memory free in getnetgrent(3).
Fix a buffer overflow in bad144(8).
Revert back to the old rijndael implementation and solve byte ordering bugs there instead.
Drop unneeded support for RTF_TUNNEL in route(8).
Maintain count of routing table timer entries in route(8).
In makewhatis(8), strip weird characters first, then sequences of spaces.
Big improvements to adw(4).
Teach tcpdump(8) about VRRP, SMB, and timed.
Force calendar(1) to only accept real calendar files as input.
Fix various perror(3) overflows in pcvt(4).
Repair a tftp(1) argv parsing overflow.
Conditionalize some BPF code in wx(4).
Finally remove remaining references to extra RSA libs, since the patent has expired.
New rijndael implementation which solves endian issues.
Support Intel 82801BA pciide(4) controllers.
Exercise more paranoia with passed KRB environment settings in telnetd(8).
Convert some more drivers to the new timeout(9) interface.
Many improvements and modernizations to isp(4).
Update wx(4) with LIVENGOOD support.
Recognize and support the IODATA USB-ET/T Ethernet adapter in kue(4).
Implement asynchronous connections for ssh(1) -R and -L.
Simplify atrun(8) tasks by using asprintf(3).
Kill unused libtermlib.
Import new pool(9) code.
Fix RIPv0 packet printing and NFS port number parsing in tcpdump(8).
Make pcap(3)-generated BPF filters work on the tun(4) interface.
Import David Maziere's ssh-keyscan(1).
SECURITY FIX: Fix buffer overflow in ftpd(8).
A patch is available.
[Applied to stable]
IMPLEMENTATION FIX: Fix fastroute related panic.
A patch is available.
[Applied to stable]
Teach OpenSSH about more version strings to improve interoperability.
SECURITY FIX: Fix another security problem in the KerberosIV code.
A patch is available.
[Applied to stable]
SECURITY FIX: Fix two security problems in the KerberosIV code.
A patch is available.
[Applied to stable]
Permit ftpd(8) umask setting via both the command line and through a login class in login.conf(5).
Prevent vlan(4) devices from emitting packets if the parent interface is not up and running.
Better error checking in ping6(8).
[Applied to stable]
Some stability fixes to isakmpd(8).
In ssh(1), disable agent/X11 port forwarding if the hostkey has changed.
Fix a coredump in ssh-agent(1).
Reset 16-bit PCMCIA during chip initialization in pccbb(4).
Correct PCI interrupt setup for TI PCI113X CardBus bridges.
Properly powerdown PC cards in pccbb(4) at shutdown time.
Add -D option to sshd(8) to cause startup without a daemon.
Show both the IP address and hostname when a new key is encountered in ssh(1).
Fix a bug in MSChapv2 challenge hashing in ppp(8).
More make(1) tweaks.
Use -n to test for non-zero variables in /etc/netstart.
Be more careful with ARP packets.
Fix deletion of flows in pf_key_v2 handling of isakmpd(8)
[Applied to stable]
Prevent setusercontext(3) in ftpd(8) from setting the umask as this conflicts with any command-line umask specification.
clock(3) fixes for the alpha architecture.
Print select collisions in vmstat(8) -s output.
Implement login_check_expire(3) for libutil.
Add -u username support to pwd_mkdb(8).
Properly implement errno handling for the threaded libc (libc_r) on powerpc.
In adduser(8), get rid of a race condition and use /etc/ptmp as a lock file.
Set reasonable defaults for RSA1, RSA, and DSA keys in ssh-keygen(1).
Reorder check for illegal ciphers in ssh(1) protocol 1 connection code.
Fix pciide(4) support on Alpha 164SX models.
Support 16 slices per device on VAX machines.
Considerable cleanups to make(1).
Improve key repeat logic in wskbd(4).
Changes from KAME to make ifm_data available in getifaddrs(3).
Fix absolute path handling in crunchgen(1).
Shorten /dev/ttyC* device names.
Complain about invalid ciphers in ssh(1), falling back to reasonable defaults when necessary.
Avoid tty races in wsdisplay(4) when switching virtual terminals.
Update isakmpd(8).
Repair lun support in umass(4).
Zero pw_passwd before freeing its memory in the libc BSD authentication routines.
Train makewhatis(8) to handle more special cases.
Avoid double fclose(3) in getcap(3).
Increase delay in RAM probe for hifn(4).
Suffix list fix in make(1).
Various bug fixes in ksh(1).
When using the tail(1) -f flag on stdin, don't reopen a local file named stdin.
Extend kqueue(2) to support kernel events on vnodes.
Bring in BSD authentication support for sudo(8).
Zap MULOG in inetd(8) to improve code readability.
Avoid whacking errno in top(1) signal handlers.
Do not include MFS partitions in quot(8) statistics output.
Add support for the Acenic Copper and Netgear GA620T Gigabit Ethernet cards.
Prevent a type overflow in recno(3).
IMPLEMENTATION FIX: Imac DV reports the VGA device improperly.
A patch is available.
[Applied to stable]
Import BSD authentication mechanisms from BSDI BSD/OS.
Implement pw_dup(3), a function which copies struct passwd.
Replace getpass(3) with a more flexible readpassphrase(3) interface.
Add strnvis(3), a length-bounded version of the strvis(3) libc function.
Better prompting logic in libskey.
Resurrect binutils on alpha.
Recognize newer Intel audio devices in auich(4).
Stop amphy(4) from attaching to network devices it doesn't belong to.
Enable support for pciide(4) found in newer Intel chipsets.
Correct URL handling in the install scripts.
Limit the number of SCSI luns in umass(4).
Page size fixes to the alpha port.
Import ssh-ask-pass support for X11.
Fix a signal race in ypserv(8) SIGHUP handling.
Enable uaudio(4) by default in GENERIC/i386.
Reserve all-1s addresses in the IPsec code for future policy discovery features.
Resolve HMAC nomenclature issues.
Be sure to clear passwords out of memory after use in ppp(8).
Support kernel event queues.
Add support for USB scanners through the uscanner(4) driver.
More fixes to qec(4).
Recognize newer AMD CPUs.
Repair incorrect buffer size logic in telnetd(8).
Add a slew of devices to usbdevs(8).
Do not use perror(3) in sshd(8) after forking a child.
RELIABILITY FIX: The qec+qe ethernet cards should not generate NMIs.
A patch is available.
[Applied to stable]
Add ifmedia(4) support to qec(4), among other improvements.
Extra sanity checking in skeyinit(1).
Repair timeout computations in atapiscsi(4).
Add initial support for DEC Alpha 21264 systems.
Bring the alpha port a bit closer to a fully operational console.
Support Accton EN2242 MiniPCI Ethernet adapters.
Permit O_RDWR on FIFOs to handle legacy applications that depend on it.
Add scrollback support to wscons(4) through the vga(4) driver.
Color change in wscons(4) vt100 emulation to more closely imitate PCVT.
Repair overriding of pseudo devices in config(8)
[Applied to stable]
Accept -inet and -inet6 as options for the show command in route(8).
Don't reorder keys in ssh-agent(1) upon key removal.
Avoid parsing options in ssh(1) if there is an RSA key mismatch.
Various cleanups to ftpd(8).
In many programs, sync usage() output with their respective man page SYNOPSIS.
RELIABILITY FIX: The ThunderLAN driver, tl(4), should not claim all interrupts.
A patch is available.
[Applied to stable]
In pciide(4), do not map unsafe registers from controllers that require 16-bit I/O space.
Import new pckbc(4), pckbd(4), vga(4), pcdisplay(4), and ega(4) drivers for wscons(4).
In ftpd(8), assert check_login upon receipt of EPSV/LPSV.
Make the aha(4) driver compile without UVM.
Enforce non-cacheable device space on real 80386 machines.
Add RSA authentication support for SSH2 to OpenSSH.
Allow serial mice to work with moused(8) and XFree86 simultaneously.
Repair an off-by-one error in ssh-agent(1).
Convert some old drivers to the new timeout(9) interface.
RELIABILITY FIX: repair AES (rijndael) kernel support.
A patch is available.
[Applied to stable]
Import PCI support for Alpha EB164 machines.
Add bus_space_barrier macros for the powerpc.
Endian fixes to the USB code.
Better command line parsing in encrypt(1).
Numbering fixups in pfkeyv2 to match IANA assignments.
Crank maximum mbuf size in ppp(8) in order to handle full-sized HDLC frames.
Improve handling of IPv6 Node Information Query packets for better specification conformance.
Fix a panic induced by assigning lo0 an IPv6 alias.
IMPLEMENTATION FIX: In sshd(8), fix skey support in SSH1 protocol.
A patch is available.
[Applied to stable]
Deprecate pltime=0 in ifconfig(8).
Modifications to the ktrace(2) interface to reduce redundancy.
Do not advertise dynamic/cloned routes in route6d(8).
Allow ping6(8) to send ICMP6 packets smaller than 8 bytes.
[Applied to stable]
Correct free-before-reference bugs in rshd(8) and rlogind(8).
Improve queue handling in gdt(4).
New Adaptec FSA RAID driver called aac(4).
Fix DMA error problems in adw(4).
[Applied to stable]
If MANPS environment variable is set, the system will also build and install postscript manual pages into /usr/share/man/ps[1-9]/.
In date(1), fix an off-by-one error which would happen when changing time over DST.
Permit -Tps in nroff(1).
Make some pfkeyv2 interfaces conform to RFC 2367 numbering.
New timeouts in a couple of network drivers.
Prevent nfsd(8) from swapping out.
Use PHOLD/PRELE in various kernel components.
Buffer overflow fix to telnet(1).
Many man page improvements.
Permit handling more than 6 arguments in a hostname.if(5) file.
kcore handling in kvm(3) for alpha.
Update usb(4) code.
Update alpha architecture support. A snapshot will come out soon.
In pchb(4), for Intel random devices, do not busy wait for data.
Switch amiga to uvm(9).
Fix amiga pmap module submap allocations.
Centralized netisr dispatching.
ppp(8) updated.
In aue(4), fix multicast filter programming.
Repair an uninitialized variable bug in ipsec(4) output.
[Applied to stable]
Add pcibios(4) interrupt setup support for AMD750 chipset.
RELIABILITY FIX: In sparc zs(4), when using serial console, the interrupt routine was unable to distinguish it's own interrupts.
A patch is available.
[Applied to stable]
Generate new hashkey every time a bridge(4) is brought up.
Change bridge(4) code to use lower spl.
Passive FTP support in lynx(1).
In ssh(1), downgrade to SSH1.3 if server is SSH1.4.
In sshd(8), do not disable rhosts(rsa) if server port greater 1024.
In sshd(8) Agent forwarding and -R support for SSH2 protocol.
ipsecadm(8) man page repairs.
[Applied to stable]
In pfkeyv2, send the message to registered promiscuous listeners.
[Applied to stable]
Some minor bridge(4) fixes.
ld.so(1) support for the pmax.
On powerpc, print out the size of the L2 cache size on G3 and G4 machines.
2.8 release builds are running, but some of us are already working on post-release hacking.
--------
Changes made between OpenBSD 2.7 and 2.8
RELIABILITY FIX: Carefully check that a.out executable objects are rounded to a page.
A patch is available.
[Applied to stable]
OpenSSH 2.3.0 released.
[Applied to stable]
SECURITY FIX: Hostile servers can force OpenSSH clients to do agent or X11 forwarding.
A patch is available.
[Applied to stable]
Support Macronix 98727/98732 chips in dc(4).
Use mkstemp(3) in csh(1).
In dhclient(8), accept unknown options by default.
Repair mips support in gcc(1).
Repair config(8) ECOFF support.
In config(8), permit redefinition of pseudo-device directives.
Get rid of ST506 phantoms in wdc(4).
Handle Davicom dc(4) devices better.
Deny agent/X11 forwarding unless requested, in sshd(8).
Non-blocking IO on pty channels in sshd(8).
Avoid accidental random subsystem re-seeding.
Change BUFCACHEPERCENT calculations.
Remove the notion of "Copybuffer ownership" from pcvt(4).
Minor tweaks to isakmpd(8).
Significant pcidevs update.
Many man page changes.
Handle more Via chipsets in pcibios(4) interrupt repair.
Fix bpf(4) support in powerpc gm(4) driver.
Support Xircom X3201-based cardbus cards in dc(4).
In dhclient(8), only DHCPNAK bootreplies may be a yiaddr of 0.0.0.0.
Support older vandyke software in sshd(8).
Man page fixes.
Avoid NULL-deref in ipsec(4) + pmtu case.
Stop IPv6 multicast moaning and groaning on enc(4) interfaces.
Mark swap16() and swap32() with __extension__.
Restore i386 boot block pciprobe code, since some non-PCIBIOS machines need it to determine of pci bus is in mode 1 or 2.
spltty protection in pcvt(4) mouse support.
Unsigned counters in vmstat(8).
Support ^T status messages on the install media.
Add shared library awareness to powerpc gdb(1).
Fix setupterm() issues in telnetd(8) and telnet(1).
In hifn(4), only accept interrupts the driver really generated.
SECURITY FIX: 2 possible overflows exist in X11 xtrans code.
A patch is available.
Solve some of the powerpc data fault issues.
Many more vax improvements.
Fix hifn(4) on very fast machines, like p3/933.
Fix alignment fault in ssh(1).
Many documentation cleanups.
Use clearerr(3) in disklabel(1) so that ^D works in aborts.
Update to ncurses 5.2
Fix noprint/print/octal options in vi(1).
Add support for i815 motherboards and their devices.
Disable DMA support for Opti pciide(4) devices, since there are some boards that apparently wired them up wrong...
Use echo(1) instead of printf(1) to repair the format string bugs in /etc/security
Do not free an uninitialized variable in curses(3).
Switch to 2.8 release numbering.
Print powerpc MHz ratings.
Add support for major/minor numbers to powerpc shared library implementation.
Support ulpt(4) printers on powerpc.
Fix random(4) ioctl functions, to work as intended.
Fix -fpack-struct bug in i386 boot blocks.
Support random number generators on more Intel pchb(4) devices.
tcpdump(8) support for STP (spanning tree) packets.
Discover correct ethernet address for powerpc gm(4) ethernet driver.
Fix nasty dl_strcmp() bug in powerpc ld.so(1).
Generate proper /etc/resolv.conf files from dhclient(8).
Repair quotas greater than 4GB in quota(1).
SECURITY FIX: httpd(8) mod_rewrite and mod_vhost_alias modules could expose files on server if used.
A patch is available.
[Applied to stable]
More cool vax stuff.
In perl(1), set siteprefix and siteprefixexp to /usr/local as they should be.
Give bridge(4) devices their own IFT_BRIDGE type, so that IPv6 does not attempt to configure up.
Repair a short read issue in scp(1).
For i386 apm(4), if periodic checking fails repeatedly, shut it down.
Very amusing printf(1)-based format string bugs in /etc/security.
Prevent vlan(4) status changes until configuration is complete.
Workaround i386 bios serial call problem (helps DSR issues on some BIOS).
[Applied to stable]
Better error message out of ftp(1) regarding invalid port numbers.
Repair certain copyout() calls in bridge(4).
New amphy(4) driver, replacing dmphy(4).
Update tx(4) driver.
Authentication support in ray(4).
Fix file descriptor leak in ssl(3).
isakmpd update.
Fix byte order bug in ipsecadm(8).
Fix httpd(8) building for gcc -shared.
On i386, build a private descriptor for bios32 accesses, thus fixing even more pcibios(4) bugs.
Fix channel printing for pciide(4).
Repair probe vs attach confusion in the mii(4) layer.
In pcibios(4), protect %edx register from being whacked.
Update nearly entire isp(4) device driver.
Update isp(4) sbus microcode.
Various small fixes to moused(8) to make it more reliable.
Enable gm(4) ethernet driver on G4-style powerpc machines.
Lots of documentation improvements.
Repair gcc(1) shared library linking on powerpc.
Fix an uninitialized variable issue in xl(4) that prevented dual NICs from working.
Repair empty password support in login(1), for when kerberos is compiled in.
The 3c556 MiniPCI cards now work in the xl(4) driver.
Fix key option handling in sshd(8).
sshd(8) implementation of AllowTcpForwarding.
For ipsec(4), an ASKPOLICY message implementation in pfkeyv2.
TCP wrapper support for IPv6.
Vax support in ssl(3).
Fix a library buffer overflow in the X11 libraries.
Build a minimal powerpc CD boot image.
In sshd(8), rijndael/aes support in SSH2 protocol.
Fix -i handling in wicontrol(8) and ancontrol(8).
In sshd(8), a kludge for F-Secure Macintosh < 1.0.2.
Add lmccontrol(8) and spppcontrol(8).
Fix TM_YEAR_BASE issue in touch(1).
More isakmpd(8) updates.
setenv(3) cleanups in make(1).
Change powerpc crt0 startup code to deal with ctors/dtors properly.
New aue(4) supplies support for the usb(4) Kingston KNU101TX USB Ethernet adapter.
Some more DELAY() calls in hifn(4) permits some fast machines to work better.
Avoid a nasty mbuf sharing case in ip_forward().
Nuke old timeout code in mii(4) drivers, which collided with new timeout code in the same blocks.
Many manual page cleanups.
Change /root to be mode 0700 instead of 0755.
Enable DES support in SSH1 protocol clients (for compat with exported Cisco routers).
Fix numerous erroneous mmap(3) calls in the source tree.
Fix cc -shared issues in perl(1).
Fix scan code bug in pcvt(4) that prevented RIGHT_SHIFT+PGUP/DN key combinations from activating scrollback.
New cipher framework in sshd(8).
Add support for s/key (kbd-interactive) support in sshd(8) SSH2 protocol.
Implement -o support in scp(1).
Use terminfo(5) interfaces in tn3270(1).
In dc(4), fix ethernet address reading on ADMtek AN983.
In inetd.conf(5), disable talkd(8) and fingerd(8) by default.
Nuke IPv4 mapped address support in IPv6.
Implement diffie-hellman group exchange in ssh(1) and sshd(8).
Add mkhybrid(8) [need this for the powerpc port HFS CD].
Deal with KA52/53 in vax port, and other vax stuff.
Add /etc/primes, used for diffie-hellman key exchange.
Link telnetd(8) and telnet(1) against curses(3) instead of ocurses(3).
Correct environment variable handling in curses(3) library.
fd_set overflow handling in curses(3) library.
ICMP and RST rate limitation code, controlled using sysctl(8) on net.inet.icmp.errppslimit, net.inet6.icmp6.errppslimit, and net.inet.tcp.rstppslimit.
ppsratecheck(9) code added.
Alpha portability for routed6(8).
SECURITY FIX: Prune more environment variables in telnetd(8).
A patch is available.
[Applied to stable]
Avoid fd_set overflow in kerberos(8) and identd(8).
RELIABILITY FIX: Repair non-exploitable buffer overflow in sendmail(8).
A patch is available.
[Applied to stable]
libkeynote update.
isakmpd(8) update.
In login.conf(5), crank maxproc for staff login class.
In dump(8), do not dump core if the raw device cannot be determined.
More vax fixes.
In ppp(8), try to deal with bugs in pppoe(8).
Permit install time passwords to contain meta-characters.
AES support in ipsec(4).
Uninitialized variable in bridge(4).
Move gcc(1) to using -shared, as well as -fpic or -fPIC as relevant.
ncurses-5.1-20001007
Add support for Symbios 53C1510 and 53C1510D to ncr(4).
New isakmpd(8).
Permit moused(8) and X11 to coexist.
For now, work around powerpc pmap/cache bug by having ld.so(1) do extre cache flushes.
Use -q flag to ls(1) in /etc/security, for safety against non-printable characters.
Avoid fd_set overflows in ping(8), ping6(8), traceroute(8), traceroute6(8), ampd(8), kadmin(8), getty(8), ppp(8),
Remove unimplemented -edebug flag from telnetd(8).
Various improvements to ppp(8).
pthread support on the powerpc.
Check for root privs on SIOCSIFPHY*, and SIOCGIFP*ADDR repairs
[Applied to stable]
Fix format string bug in top(1).
Finally make sparc pthread support work.
Many vax fixes.
Fix bugs in libc db(3) functions.
Enhance hash buffer size in dev_mkdb(8)).
IKE support in tcpdump(8).
More careful byte order handling in tcpdump(8) bgp support.
SECURITY FIX: Ignore $HOME/.termlib in curses for setuid/setgid executables.
A patch is available.
[Applied to stable]
Routing header typo in inet6 fixed.
[Applied to stable]
SECURITY FIX: talkd(8) format string vulnerability.
A patch is available.
[Applied to stable]
More (low priority) format string errors.
Prevent panic in speaker(4).
Attempt to deal with Davicom DM9102A homePNA bugs in dc(4).
Make moused(8) support work in modes other than 25-line.
Do not attempt to use a copybuffer in pcvt(4) before it has been set.
Fix recently introduced bugs in rbootd(8).
New libkeynote.
Fix an ipsec(4) panic on alphas.
In chpass(1), do not permit non-printable characters in the passwd(5) file.
Implement getnulldev() machine-dependent API, and use it for the hack that stops fd 0, 1, and 2 from being played with in setuid programs.
More games fixes!
Cleanups in nc(1).
Ensure that ICMPs generated from date over IPSEC go back over the same IPSEC tunnel, if at all possible.
Performance improvement to twe(4).
Fix off-by-one in getnameinfo(3).
Support i82562 fxp(4) device.
More tweaking in pcibios(4) code for dealing with busted BIOS implementations.
gcc 2.95.pre3
Attempt to deal with a cardbus shutdown hang on some Toshiba systems.
Fix memory leak in kernel internal fdalloc() function.
Fix a locking bug in the pthreads implementation of getgrent(3) functions.
More games fixes.
In newfs(8), if a cylinder group does not fit inside a block, adjust secpercyl and ntracks until it does. Perhaps weird geometry setups to still build filesystems.
Clear pcvt(4) copy buffer as soon as any console device gets a last close.
Make pcvt(4) mouse copying mimic xterm functionality more.
Repair a mapping problem in pcibios(4).
Repair random number generation in pms(4).
More volatiles in hifn(4) (but all the bugs are not yet gone).
Trim RSS text relocation warnings in old ld(1).
Extend auth methods support in sshd(8).
In ssh(1), more bug compat for old ssh.com software.
Panic bugfix to tl(4).
Correct some -fPIC handling in old ld(1).
Fix year handling in touch(1).
Some pcibios changes, mostly in addresses repair.
Lots more ipsec changes, for automatic IKE setup.
Support 64 bit BARs on PCI.
subr_extent had a off by one in a validity check.
Correctly calculate MSS in tcp pmtu cases.
In ipsec(4) pfkeyv2, allow IDENTITY payloads in ADDFLOW messages.
Various ioctl additions so that X11 works on the powerpc.
On powerpc, use BATs to map devices.
Lots and lots of changes to ipsec internal layout.
Display SPD entries in netstat(8)'s -r option.
Path MTU discovery support in openbsd, enabled using the sysctl(3) variable net.inet.ip.mtudisc.
Repair AFS support on the mips platforms.
Some more fixes to the games!
Fix old bug with wildcard interfaces
[Applied to stable]
Various fixes to clcs(4) PCI audio driver.
RELIABILITY FIX: Drop dubious ESP/AH packets without crashing.
A patch is available.
[Applied to stable]
ldd(1) for powerpc ELF binaries.
Other misc improvements to ssh(1).
Support fxp(4) devices on cardbus(4), including detach.
Support 3C3FE575CT CardBus xl(4) devices.
Attempt to support 3C556[B] MiniPCI xl(4) devices.
Repair IPv6 multicast support.
[Applied to stable]
Fixes to faithd(8).
Many improvements in ep(4) support, including support for more eject/mii, and other newer models.
Support twe(4), the 3Ware IDE raid controller.
Check all calls to setenv(3) in userland.
More puc(4) devices.
Support IPSEC data flow in ppp(8).
More cleanups in make(1).
Use vis(3) for outputting data in syslogd(8).
Fix sorting bugs in the miniroot.
Multiple debug levels in ssh(1).
Cause getsid(2) and getpgid(2) to return EPERM if requesting out of session/pgrp, as well as fix other bugs.
natm fixes.
binutils 2.10
Fix INET6 components of atm support.
Update powerpc miniroot install stuff.
Handle LBA partitions even better in fdisk(8)
Fix user quota reporting in repquota(8)
arla-current
Re-enable ray(4) after resume.
Linux mmap() ignores the fd argument when MAP_ANON is set.
Some reliability fixes to asc(4) for pmax.
Another one byte overflow in getty(8)
ums(4) support.
More cleanups in pcibios(4)
Clarify licencing on components of ssh(1) and such.
Repair dcphy(4) problems for Macronix PMAC 98715 and family.
Fix TAILQ_FOREACH_REVERSE.
More use of new timeouts in the kernel.
Avoid excessive wakeup() in crypto subsystem.
Run powerhooks at splhigh(), and backwards from initialization order.
Bounds checking code in compat/emul code.
Open a file with egid in wall(1).
Inconsequential Buf overflow in getty(8).
When cards come up with very bad MAC addresses, generate a fake one.
tzdata2000f.
Start sendmail(8) even more carefully in /etc/rc, to avoid whining.
Mag tape ioctl emulation for compat_osf1(8).
Many improvements to powerpc, including wscons(4), usb(4), and rebooting support, amongst many other things.
Support different font sizes in wscons(4).
Fix inquiry problems in adw(4).
Various fixes to SACK and FACK.
Powerhook workaround, so that wi(4) suspends wake up properly.
Enable ssh-add(1) deletion support for DSA keys.
Support detach for cardbus(4) xl(4) devices.
Fix IO/memory space allocation in cardbus(4)/pci(4) rbus handling, so that some devices do not map on top of each other.
Increase page use in i82365 pcic(4).
Portability fixes to sftp-server(8).
Fix login time handling in sshd(8).
In sshd(8), cause SSH_ORIGINAL_COMMAND environment variable to be initialized.
Fix file descriptor leak in ssh(1).
Install kerberosIV info file.
Make pcvt(4) mouse support act more like an xterm.
Improvements in pcic(4) attachment on pci(4).
Fix EDP register handling in xe(4).
In ray(4), fix panic on detach.
More changes to hppa.
Add the L: modifier to all tweakable var tests in various Makefiles.
Various fixes to ppp(8).
Fix parsing problems in netstart(8) when reading hostname.if(5).
Cleanup and fix -S support in scp(1).
Add joy(4) driver for amiga.
Import moused(8), a userland mouse daemon the for new pcvt(4) features.
Add kernel console mouse support to pcvt(4).
In rtadvd(8), repair a routine to grab interface MTU information.
[Applied to stable]
Add sftp-server(8), capable of doing the things needed by ssh.com's scp2 and sftp clients. We have no client to talk the protocol ourselves.
Various build tweaks in kerberos.
In getaddrinfo(3), fix canonical name for /etc/hosts file-based search.
OpenSSH 2.2.0 released.
[Applied to stable]
Use arc4random(3) in ppp(8) plus various other fixes.
Correctly read MAC addresses on all ne(4) cards.
More svr4 emulation fixes.
Prevent csh(1) from coredumping in some situations.
Use srandom(3) in ppp(8).
x11-ssh-askpass 1.0.1.
In IPv6, do not forward packets with unspecified source.
Add filters logging and radius accounting support to ppp(8).
Lot of sun3 changes.
Various ssh(1) improvements.
brgphy(4) driver for broadcom 5400 and xmphy(4) for XAQTI XMACII phys.
ssh(1) compatibility with future ssh.com versions (which contain a bug in their HMAC handling).
Add detach support for xe(4) and aue(4).
Import newer mii(4) code, supporting mii subdevice detach.
In dc(4), avoid freezes on large data transfers.
ssh(1) now talks to ssh.com 2.3.0.
Some clarifications in manual pages regarding the format string bug in printf(3), setproctitle(3), syslog(3), warn(3), and err(3).
Performance improvements to sis(4).
Correctly match Promise Ultra/100 in pciide(4).
Fix shared library creation problems on mips.
Fix IPSEC flow deletion problem when using -transport.
[Applied to stable]
In scp(1), repair copying of files 2GB in size or larger.
Crank some defaults in login.conf(5).
Various fixes to lpc(8).
Repair sendmail(8) options handling.
Make timeouts happen with the expected frequency.
Implement svr4 emulation for pread64, pwrite64 and fcntl DUP2FD.
Manpage fixes.
We're at 2.8-beta now.
Use the user's default groups if user is specified in inetd.conf, but group is not.
Be more paranoid in cron(8).
Fix var handling in make(1).
Support FIONBIO and FIOASYNC on rnd.
[Applied to stable]
Proper template file creation on ksh(1).
Implement resource limits in several daemons.
Add login.conf(5) support, making possible limiting resources per class.
Minor bug fixes associated with the use of the UseLogin directive in sshd_config.
Bypass key generation in mod_ssl if SSL is not enabled in any (virtual) servers.
Add SSH2/DSA support to ssh-agent(1) and some DSA related cleanups.
Use specified home directory, if specified, and other fixes to user(8).
[Applied to stable]
Resolve a driver name conflict in the pmax platform. The pmax dc(4) driver has been renamed to dz.
Many updates to the ubsec(4) code.
Various IPv6 fixes.
Add -S option to scp(1) and ssh(1) to use a program for encrypted connections.
Lot of manpage updates.
Various improvements to linux emulation.
Add IPv6 support to telnetd(8).
Allow ppp(8) to be used without SUID privs.
Make pcibios(4) a real device making possible the use of flags.
Avoid duplicate utmp entries in ssh(1).
Update awi(4) driver.
Various ppp(8) improvements.
More fixes to ubsec(4) auth+enc code.
Convert pccom(4) to new timeouts.
Implement -a option on wicontrol(8), was documented but not present.
In mail.local(8), fix sendmail.cf location.
Catch bogus MAKEDEV(8) mouse and spit out an reasonable error.
In ppp(8), ISDN B channels have a bandwidth of 64000, not 65535.
More format string paranoia.
Several setproctitle(3) fixes in ppp(8).
SECURITY ISSUE: format string localhost root vulnerability in xlock(1).
A patch is available.
[Applied to stable]
Improvements and fixes in hppa land.
Increase if_obytes and if_omcasts in vlan(4) output routine as done in ether_output.
In ubsec(4), deallocate resources on attachment failure.
Fix auth-only mode in ubsec(4).
In hifn(4), deallocate resources on error and workaround memory problems in rev A boards.
mod_ssl 2.6.6.
fix locking in threaded getgrent(3)
[Applied to stable]
gdt(4) cache fixes and additional card support
[Applied to stable]
SECURITY ISSUE: several DoS holes in libX11, libICE and X clients.
A patch is available.
[Applied to stable]
mod_ssl 2.6.5
Repair ntpd/ntpdate handlings in /etc/rc.
Various improvements and fixes to ppp(8).
Correctly handle ip_off in a corner case of IPSEC.
[Applied to stable]
i386 now has another install floppy: floppyC27 contains cardbus support.
In ssh(1), disable FallBackToRsh by default.
In TCP, compute correct window scale when recvpipe option is set in route.
KTH Kerberos4 1.0.2
In sshd(8), fix MaxStartups code to work with -d.
RE-RELEASE: Re-release pmax release after dmesg(8) and /kern/msgbuf was fixed.
A patch is available.
[Applied to stable]
Fix simpleroot support.
ncurses 5.1
Do not default to empty passwords in adduser(8), simply because it's stupid.
Use strsep(3) instead of strtok(3) in ssh(1) and sshd(8).
Add -flags option to find(1).
In inetd(8), handle IPv6 addresses in hostname specifiers.
In systat(1), correct layout of the io page.
Support Intel 440MX Ultra/33 controller in pciide(4).
Handle Promise Ultra/100, deal with D2 AMD K7 controllers, and various other tweaks to pciide(4).
New release(8) page describes how to build a distribution.
Fix an spinning select(2) loop in nc(1).
For select(2) and poll(2), if we are awakened by a collision the timeout must be recalculated.
On powerpc, handle late configuration of the interrupt controller.
Fix port and X11 forwarding in sshd(8).
Change fingerd(8) back to using fgets(3) instead of fgetln(3), to reduce denial of service attacks.
Change compat_linux(8) so that it logs and returns ENOSYS rathern than deliver SIGSYS for unimplemented system calls.
Add ucomm(4) support to MAKEDEV.
Delay slightly longer after reset in xl(4) for some configurations.
Add support for National Semiconductor DP83815 fast ethernet to sis(4).
Ensure PCIBIOS32 does not panic if the BIOS lies.
Add support for 82801AA_LPC in PCIBIOS32.
Add spllowersoftclock() on all architectures, and correct splsoftclock() to avoid races.
Fix pmap activation on mvme68k.
Support ddb(4) entry from cl(4) on mvme68k.
In user(8), ensure that we do not generate passwd lines longer than 1023 characters.
[Applied to stable]
Latest wx(4) driver, works better with more switches.
Improve support for Ricoh cardbus bridges.
CardBus and PCIBIOS32 support enabled by default in i386 GENERIC kernel.
Update isp(4) driver.
Add a timeout structure per scsi transfer, so that controllers can do timeouts easier.
Fixed numerous cases of printf(3)-style functions being called with their first argument being user controlled, where it should be %s
More careful handling of IPV6 mapped addresses in the IPV6 code.
Repair X11 forwarding in ssh(1).
Make dmesg(8) once again work on the alpha.
setproctitle(3) misuse in faithd(8).
SECURITY ISSUE: remote hole via setproctitle(3) misuses in ftpd(8).
A patch is available.
[Applied to stable]
In /etc/rc, start sendmail(8) in the background.
Prepare ddb(4) internals for KGDB support.
Fix spl usage in sparc magma(4).
Stop kernel sleeps from returning up to a tick early by fixing hzto(9).
Latest version of the pcvt(4) scrolling region patch...
A patch is available.
[Applied to stable]
Make getaddrinfo(3) return EAI_NODATA for name resolution errors.
Greater care of rlimit handling in sbrk(2).
[Applied to stable]
Cleanup spl handling on the sparc.
Fix dmesg(8) and /kern/msgbuf on the pmax.
Support bigendian hardware in ahc(4).
Fix tail queue leakage in the crypto queue support.
New wscons on the alpha.
More carefully reset pcic registers when testing for working pcmcia(4) interrupts.
Plug two memory leaks in brconfig(8).
Various gcc(1) fixes for the vax.
SECURITY ISSUE: Buffer oflows in mopd(8).
A patch is available.
[Applied to stable]
More fixes in the games.
Make ipnat(4) detaching work with pcmcia(4).
Correct interrupt sharing types in pcmcia(4).
Fix to a fix in uvm.
[Applied to stable]
Change to 16 partitions in sun3 port.
Dynamically size the m4(1) internal machine stack.
Faster C version of ffs(3).
In vr(4), support VIA vt6102.
Import wsconsctl(8), wsconscfg(8), and wsfontload(8).
In fdisk(8), be more verbose about partition layout errors.
To aucat(1), add -f option for specifying audio device.
More regression tests for m4(1).
In xl(4), add support for 3CCFE575BT and 3CCFEM656C.
Import a regression suite for m4(1).
In make(1), recognize +cmd as a command that should still execute in make -n mode.
Correct giftunnel handling in ifconfig(8).
New fix for the pcvt(4) scrolling region bug.
A patch is available.
[Applied to stable]
mod_ssl 2.6.4
clcs(4) driver for the cs4280 Crystal Clear audio hardware found in some laptops.
Make UVM work on the powerpc.
Convert much kernel code to the new timeout API.
Fix multicast hashing problem in xl(4).
A patch is available.
[Applied to stable]
Fix numerous more bugs in the games.
Fix MAC address matching in pcap(3).
Make the ep(4) driver more friendly during detach.
Fix bpf code in ray(4).
For the err(3) family of calls and syslog(3), ensure that dynamic content never appears as the second argument -- use at least %s.
Update adw(4) driver.
Add creat64 and mmap64 system calls to svr4 emulation.
Handle strtol(3) instead of atoi(3) in the kill implementation in csh(1) and ksh(1).
Fix COPTS vs CFLAGS issues in the source tree.
Fix panic message from i386 in_cksum.
Fix path to kerberos master key file.
[Applied to stable]
SECURITY ISSUE: Stop libedit from opening the .editrc file in the current directory.
A patch is available.
[Applied to stable]
Fix an infinite loop in fsck_msdos(8).
Fix some racy interaction between pcmcia(4) insertion and suspends.
Add -U option to ldconfig(8).
Fix a stupid bug in m4(1) argument handling.
[Applied to stable]
Repair stupid bugs in ste(4), which prevented it from working in 2.7 release.
A patch is available.
[Applied to stable]
Connection limitation code for sshd(8).
Allow svnd(4) to work on sparse files.
In pciide(4), support CMD 648/649 UDMA66 controllers, and also fix the Promise UDMA66 cable check code.
ncurses 2000/6/10 update to termtypes.master.
In ne(4), re-fix Linksys Combo PCMCIA EthernetCard (EC2T) after AX88190 broke it.
Disable automatic crash(8) dumps for swap encryption.
SECURITY ISSUE: Be much more careful about dhclient(8)'s handling of external variables.
A patch is available.
[Applied to stable]
Implement svr4 emulation for getdents64, lstat64 and stat64.
Do not start snmpd by default if it is installed.
Implement sort(1) as a shell function on the boot floppies, to save a lot of space.
Ensure sshd(8) does not misbehave if the skey key file is missing.
Cleanups to tail(1).
Significant performance improvements to make(1).
Numerous more fixes to an(4), regarding bridging, ipv6, bpf logic, and pcmcia detach.
Newer ppp(8) code.
Change dhcpd(8) so that it is not as susceptible to abandoning addresses.
[Applied to stable]
For crypted vnd(4), zero the key on unconfig.
Kill the legacy vtrace(2) system call.
Avoid using 3c905b-specific multicast hash code, it is buggy.
[Applied to stable]
IPv6 support in the resolver. The nameserver line can now take ipv6 addresses.
Soft updates is now free.
Add epsv4 command to ftp(1), to disable epsv negotiations on IPv4 connections.
Fix various bugs in ip gatewaying that angelos introduced.
Sync with newed ndp(8).
Allow vnconfig(8) to turn on encryption for vnd(4).
Fix bpf mishandlings in an(4).
Avoid using IO port 0x370 on laptops for pcmcia(4), since some sound cards sometimes land there.
On i386, if only one CPU family is specified, pass flags to the optimizer.
Merge in new isakmpd(8) changes.
Funnel crypto completion events via crypto_done(), not directly to the caller.
Closer towards making some more sm(4) pcmcia(4) cards work.
More verbose information for pppoe(8) in tcpdump(8).
Teach ipv6 AH & ip-over-ip code to deal with ipv6 scoped addresses better.
Initialize mtu/hlim for enc(4) so that IPv6 icmp reflect works properly.
Do not double-log ipf(8) information into /var/log/messages.
Repair bridging issues in an(4) and tl(4).
Fix ipv6 ipsec AH length checks.
ncurses-5.0-20000617.
ipv6 ipsec(4) outbound direction code.
De-#ifdef bpf(4) code.
Start at fixing ubsec(4) AH support.
isakmpd(8) update.
Honor scopeid in inetd(8).
Fix sun3 pmap, MAKEDEV, and disktab(5) bugs.
Make ssh(1) userauth+pubkey interoperate with ssh.com-2.2.0.
More bugs in an(4) and wi(4). Anyone see a trend?
[Applied to stable]
Kill /etc/ifaliases in favor of the functionality in hostname.if(5).
Fix more pesky buffer overflows in ancontrol(8).
Import tcfs userland tools: tcfsuse(1) and tcfsmng(8).
Fix pesky buffer overflows in ancontrol(8) and wicontrol(8).
Fix many more things in tcfs.
Parse ${local_rcconf} in /etc/rc.conf instead of /etc/netstart.
More fixes to an(4).
[Applied to stable]
Modify vmstat(8)'s -f option to show kernel threads as yet another kind of process.
Modify ps(1) to hide system processes unless -k is given.
Mark kernel threads as system processes.
Cleanup some things in sparc hme(4) and qe(4).
Numerous other IPV6 kernel changes.
Too many for me to list in detail, but Itojun is busy in the other room hunched over a laptop screen with Angelos, and we are sure more are coming.
Do not mess with non-blocking mode on ttys in ssh(1).
Repair some multicast problems with IPV6.
[Applied to stable]
Fake FIONBIO and FIOASYNC in random(4).
Support i82559ER in fxp(4).
Improve handling of RIP in tcpdump(8).
Add Rijndael support to ipsec(4).
Import pppoe(8).
Fix some bugs in the IPSEC getsockopt(2)/setsockopt(2) API regarding sizeof(int) vs sizeof(u_char).
Support IPV6 in identd(8).
Move IPV6 mbuf alignment requirements into input routine, removing the last performance critical one in loopback.
ubsec(4) fixes to queue requests to the hardware properly. The device can now do ipsec with itself over loopback or the network, but something is still mangled about the actual ipsec packets.
SECURITY ISSUE: Two localhost denial of service problems in the an(4) Aironet Communications 4500/4800 IEEE 802.11DS driver. One bug prevents ancontrol(8) from working correctly, instead causing a panic, while the other allows unauthorized users to change settings.
A patch is available.
[Applied to stable]
crypto(9) kernel thread permits hardware crypto devices to run at any spl they prefer.
Initial OpenSSH support for ssh.com's 2.2.0.
For setsockopt(2) and getsockopt(2), do not assume non-PF_INET6 address family to be PF_INET.
In sshd(8), implement bug compatibility with ssh-2.0.13.
In ssh(1), include = in WHITESPACE, permitting commands like ssh -o keyword=argument.
Enable IPV6 support in sendmail(8).
Change ipsec processing sequence to handle inner and outer layers much better.
Add support for SSH2 subsystems in sshd(8).
On ifconfig(8) down & up operations, mark all radix tree routes down or up for the specified interface.
In mount_ffs(8), permit the -f command to mount dirty file systems. This is dangerous, but makes more sense now that we are moving towards soft update file systems, where the inherent danger is much less.
In ftpd(8), make -u block the chmod client command.
Allow extended server banners in sshd(8).
In mount(8), -o force is not a negative option.
Add support for AMD 53c974 scsi chipset.
Import of tcfs into the kernel, a file content crypto file system.
Remove traffic-time debugging messages in ssh(1).
Repair small list-based errors and uglinesses in make(1).
Commonalize MIN() and MAX() macros inside the kernel.
Use memcmp(3) in bridge(4) to fix a hashing algorithm error.
[Applied to stable]
memcmp(3) in the kernel as well, since implementing it in terms of bcmp(3) is very wrong.
Update vnode flag printing in pstat(8).
Do not whack directory in user(8).
[Applied to stable]
Hardware random number generator in i840 also works, like i810.
Fix an ESP status message in netstat(1).
Put RSA into our ssl(3) tree. Since our next release is not till after the patent expires, it's OK.
Split sysctl information for swapencrypt into an tree, and add more gunk.
In ftpd(8) correct STAT command output for LPSV output.
Correct an ipsec esp bug.
In ftp(1) make both ls and dir send a LIST command.
Minor bug fixes and optimizations in /etc/rc.
Update of ppp(8).
Put an upper bound on transaction queue of the ubsec(4).
Correct source length calculation in hifn(4).
[Applied to stable]
Initial import of ELF ld.so, for powerpc initially.
Correct secondary mbuf setup in hifn(4).
Broadcom Bluesteel 5x0x ubsec(4) crypto cards now supports ESP 3DES modes properly. No AH or MAC stuff yet.
Make flags field in newsyslog(8) files optional.
Modifications to traceroute6(8)
Fix ADMtek identity crisis in dc(4).
In ftpd(8) make sure that -h does high port binding in EPSV.
Correct ENI_SALEN case in getnameinfo(3).
Correct getnameinfo(3) behaviour against invalid sockaddr.
[Applied to stable]
Better fix for the pcvt(4) scrolling region problem.
Grok Plan9 file systems in fdisk(8).
Merge newer ppp(8) code.
Do not add empty lines to history in ftp(1).
Grok QNX file systems in fdisk(8).
Fix about 10 bugs in ubsec(4), which can now move a few packets before dying.
Support multiple pid files in newsyslog(8).
[Applied to stable]
On-going cleanup to make(1).
Add pci(4) routines for dealing with Cypress 82c693 chips.
Minor cleanup to pax(1).
Merge chgrp(1) and chown(8) into chmod(1), and provide backwards compat hard and soft links.
In xl(4), add support for 3c656, which is just the 3c575 + 56k modem.
SECURITY ISSUE: A serious bug in isakmpd(8) policy handling wherein policy verification could be completely bypassed in isakmpd.
A patch is available.
[Applied to stable]
Merge to new isakmpd(8).
OpenSSH is now at version 2.1.1
[Applied to stable]
RELIABILITY FIX: Avoid extra vrele in msdosfs, which would lead to a panic in some operations.
A patch is available.
[Applied to stable]
RELIABILITY FIX: Permit NFS export of CDs without panicing the system.
A patch is available.
[Applied to stable]
Fix ping6(8) -w option.
Let flags in kernel config(8) specify apm protocol version and other operation modes for apm(4), for machines apm fails on.
Change amiga ports loadbsd command to act more like other bsd loaders.
Add -iname support to find(1).
Sort option list in find(1); oops, "-and" was broken.
Catch a malloc(3) failure in paste(1).
Fix linux_compat(8) [gs]etrlimit emulation.
[Applied to stable]
Update ti(4) to support newer cards with more memory.
Kernel malloc(9) debug code.
Make quot(1) work when passed mount points.
Fix stack mishandling bugs in i387 libm, in particular, in exp(3) and friends.
[Applied to stable]
Be more careful about tuples in pcmcia(4).
gcc 2.95.3 (pre-release)
Busify eg(4), to avoid conflict with ne2000 at 0x300.
SECURITY ISSUE: Do not use the (non-default) UseLogin option in OpenSSH 2.1.*, it has a hole on other operating systems and does not work right in OpenBSD.
Update to OpenSSH 2.1.1 or later, or simply avoid using UseLogin.
[Applied to stable]
sudo 1.6.3p4
Fix a kernel race in _exit(2).
In cut(1) deal with last input line not containing a newline
One byte overflow in systat(8).
Add D and z commands to disklabel(8) to use the default partition or zero it.
A SIGCHLD fix in cron(8).
More work on ubsec(4).
Bug fixes to spif(4).
Bridge packets before vlan'ing them.
Fix a subtle bug in xe(4) which had a number of side effects.
In sshd(8), fix login count failures in SSH2 support.
Whack packet m_recvif field on bridged packets, permitting ipnat(4) to work with the bridge.
More visible /tmp file (and failure removal) in makewhatis(8).
Be more careful reading panic string from core in savecore(8).
[Applied to stable]
Many other changes to ssh(1).
Fix short malloc in faithd(8).
In ssh(1), permit logins if temporary file systems are full.
ich(4) audio driver onboard the Intel 810/820/440MX-based machines.
Support ax88190 in ne(4).
In apm(4) the time is kept in hours, not minutes.
Add -A support to ssh(1).
Support for 3c574 and 3CCFEM556BI pcmcia(4) in ep(4).
A start at documenting what goes on inside config(8) files.
Enable mg(1).
Space treatment in ipcs(1).
Do not treat bind(2) with IPv4 mapped address in a special way.
Creation of 2.7-stable release, see our page describing it.
Convert amiga port to UVM.
Arrange to have ahc(4) support Adaptec 2930CU.
SECURITY ISSUE: It was possible to bypass the learning flag on a bridge.
A patch is available.
[Applied to stable]
In ftp(1), do not attach Host: directive if we are using the proxy.
Make almost all manual pages machine independent.
DRIVER FIX: The isapnp(4) ef(4) driver failed to configure properly.
A patch is available.
[Applied to stable]
Helper script cleanup in httpd(8).
SECURITY ISSUE: Update to ipf 3.3.16.
A patch is available.
[Applied to stable]
On i386, place extra byte at end of pcb so that the iomap works for last 8 ports.
Fix some key parsing routines in ssh(1).
Permit detach of audio devices.
Properly configure multicast table in wi(4).
Handle 64 bit architectures in pstat(8) -f.
Update rtadvd(8).
Remove nfsiod(8) and replace it with an in-kernel thread based implementation.
Make ssh(1) X11 forwarding work on localhost.
Crank vnode use counts to 32 bits.
Correct ifconfig(8) printing of gif physical address on non-IPV6 kernel.
RELIABILITY FIX: Repair a routing table panic.
A patch is available.
[Applied to stable]
Make ancontrol(8) act like our changed wicontrol(8) semantics.
Use getifaddrs(3) in libc rpc code.
For boot_config(8) code, save enable command in the history for config(8)'s -eu updating.
Update multicasting support for IPV6.
Fix usage printing in passwd(1).
By default, do not vsync blank sparc cgsix(4) monitors, but provide a sysctl to do so.
Start at a BlueSteel (Broadcom) 5[56]01 crypto accelerator driver.
Accept empty shell specifications in sshd(8).
In ssh(1), do non-blocking on ssh1 protocol sockets too.
In makewhatis(8), do not stop if the directory does not exist.
[Applied to stable]
Some additions to keynote(3).
Crank rt_refcnt to 32 bits.
Supply entropy from i386 mouse drivers to the kernel random number generator.
Correct p2p interface address handling and various other bugs in route6d(8).
Few more tweaks to pcvt termcap definition.
Ensure SIOCSETVLAN gets a valid vlan tag.
After ftp(1) finishes downloading, change progress meter to show the total elapsed time.
Handle 0-size files in ftp(1)'s progress meter.
Parse RFC2732 ftp URLs in ftp(1).
In IPV6, perform NUD on p2p link, only if the destination/gateway is real neighbor.
In getaddrinfo(3), translate DNS error code into getaddrinfo error code (EAI_xxx).
[Applied to stable]
RELIABILITY FIX: Parse IPv4 options more carefully.
A patch is available.
[Applied to stable]
Translate DNS error codes in getaddrinfo(3).
cardbus(4) com(4) driver.
Support debugging libraries via DEBUGLIBS in /etc/mk.conf.
Driver for tcic(4) style pcmcia adapters.
Fix ipsec(4) ESP sanity checks that caused really short packets to be dropped. Only icmp was affected.
--------
Changes made between OpenBSD 2.6 and 2.7
2.7 source tree frozen.
Buffer overflow fix to xlockmore(1).
Fix kerberos slave server startup.
Fix a pkg_add(1) bug in %f handling.
OpenSSH is now at version 2.1.
Handle \ escapes in real ssh key format files.
Fix a X11 forwarding draining bug in sshd(8).
Be compatible to various bugs in various other real ssh versions.
Handle very large mbuf chains in hifn(4).
Complain about invalid ciphers in ssh(1).
Fix 12 hour handling in leave(1).
Fix a timeout queue crash.
Various nice tweaks to the install script for 2.7.
In ppp(8), correct a bad bug in m_prepend().
Support sparc tape installs.
Work around a sysctl(3)-based kvm(3) vs exit(3) race.
Fix the same basic ip timestamp bug in ipf(4).
On the ip(4) input path, avoid unaligned accesses for strangely placed ip timestamp options.
Fix resource limit race at exit time, if accounting is enabled.
Fix inet6(4) pcmcia(4) detach.
Support all ServerWorks and 451NX pchb(4) machines.
Many fixes to user(8).
Repair padding a uuencode stuff in sshd(8).
Do not support DMA on PCTECH RZ1000, its dma support is fundamentally broken.
Undo a broken i386 pmap fix.
Fix IEEE underflow in ps(1), affected 68060 machines with precise exceptions enabled by default.
Fix context memory sizing for various models of static ram hifn(4) cards.
dhclient(8) support for the hp300 ramdisk.
Improve mountd(8) behaviour for unresolveable hosts.
Add DSA/SSH2 information to the ssh(1), sshd(8), and ssh-keygen(1) manual pages.
Improve key generation in vpn(8).
Document our new IPsec(4) bridge(4) stuff.
New packages(7) man page.
Various isakmpd(8) updates.
Install isakmpd(8) sample files.
Correct proctitle updating in sshd(8).
Change pmax dc driver to dz(4), to avoid name conflict withdc(4).
SECURITY FIX: Do not use an undocumented semconfig(2) system call in ipcs(1), in fact, remove the system call altogether. A source code patch is available.
More mount(8) tweaks for dealing with weird paths.
Fix more pkg_add(1) bugs.
Support another RCC ServerWorks PCI host bridge.
sshd(8) now has a pidfile.
Better file descriptor handling in sshd(8).
buf mishandling in ed(1).
A fix for mandatory cache sun4m architectures like the SM71 and SM81.
Fix a race in scp(1).
ipf 3.3.13.
Prettier warnings from telnet(1) if bad port names are given.
Add emulation for memcpy(3) and such to i386 for non-optimized kernel builds.
Add OPENDEV_BLCK flag to opendev(3).
Repair groff(1) mkstemp(3) use.
Fix some perl 5.6.0 buglets.
Use more perl 5.6.0 feature in makewhatis(8) for greater security and reliability.
In the /etc/daily file cleaner, prune at /.X11-unix and ssh-* directories.
In sshd(8), check for keysize errors better.
On the amiga, recognize Linux ados(8) disk labels.
Fixes to the ray(4) driver.
Fix -H option in sudo(8).
Disable pcmcia(4) handling of non-CIS cards, since there are many bugs in it.
Document many afs(4) configuration files.
Fix a modify-after-free bug in tcp(4).
Attempt to have ld(1) and ld.so(1) deal better with C++ shared libraries on a.out architectures (i386, m68k, sparc...).
Document what sendmail(8) now does on port 587.
Deal with more non-compliant PHY setups in mii(4).
cmpci(4) driver for C-Media CMI8x38 Audio Chip present on several motherboards.
Support ext2fs properly.
ssh(1), sshd(8), and companions now support SSH 2 protocol as well as SSH 1 protocol! To properly use this, you want to make sure you update your /etc/rc(8), /etc/netstart, and /etc/rc.conf(8). Or just test the new snapshot...
Various additions and improvements in tcpdump(8).
libpcap 0.5.
Support jumbo frames in the fxp(4) models which support it.
Add support for the RCC ServerWorks pchb(4) which has additional pci(4) bridges on it. Huge PC's with 6+ pci busses now work fine.
On the i386, fix an errata relating to the Intel 82443BX pchb(4).
Various changes related to vlan(4) support.
Add a sysexits(3) man page.
getaddrinfo(3) and getnameinfo(3) improvements, repairs, and greater care.
Start of the vax port resurrection.
Fix more i386 isadmaattach bugs. At least 2GB of memory on an i386 now works.
Avoid divide by zero in igmp networking code.
In mail(1), make "new" count after an "inc" command reflect the new messages, as in SunOS.
ktrace(2) no longer follows symbolic links.
Repair adosfs(8).
The damned hifn(4) always dealing with aligned data causes even more of a fuss.
Repair a few hifn(4) bugs that slipped in recently.
Fix IPsec(4) for big-endian machines again.
Omit RC5 from ssl(3).
userinfo(8), userdel(8), useradd(8), groupmod(8), usermod(8), groupdel(8), groupadd(8), and groupinfo(8) commands added.
mii(4) detach support, needed by xe(4).
Fix promiscuous mode in xe(4).
Fix order of interrupt disabling for pcmcia(4) disabling; much more reliable.
Wait a bit longer after enabling pcmcia(4) cards; more pcmcia(4) cards now work.
Fix dump calculations in the i386 kernel crash dump code.
More careful dmesg(8) handling in the install script.
pcmcia(4) ep(4) now supports 3C1 and 3CCFEM556BI.
Repair a bug in fdalloc() that caused a panic in dup(2). This bug was introduced by the recent file descriptor allocation optimizations.
Support DOSPTYP_EXTENDL partitions in the kernel disklabel reader.
In ld(1), avoid duplicates in search path.
Support RFC2732 IPv6 address literal URLs in ftp(1).
Improve makewhatis(8) again, using new parts of perl(1) 5.6.0.
Fix a bug in at(1).
Add -keyfile and -authkeyfile options to ipsecadm(8).
Significant manual page improvements, as is usual just before a release.
Use fgetln(3) instead of fgets(3) in mail.local(8), and thus avoid header mangling.
Support for /etc/rc.conf.local, as documented in rc.conf(8).
https support in lynx(1).
Add CPAN File::Temp for perl(1) versions of mkstemp(3) and such.
Fix the vi(1) recover script to be safe for multiuser running (needed O_NOFOLLOW).
Move apm(4) into a kernel thread, so that filesystem syncing is less likely to block and cause panics. Suspending just got a lot more reliable.
For open(2), support O_FSYNC better.
For open(2), add a O_NOFOLLOW flag for dealing with symbolic links. This should not be used by generic software -- only use this for very rare and specific problems.
traceroute(8) gets a new option, -f skips early node checks.
Fix "freeing free block" panics.
Support /etc/resolv.conf.tail, as documented in dhclient-script(8).
Rewrite uio hog.
Do not abuse malloc(9) for small structures inside ktrace(2).
Add pread(2), pwrite(2), preadv(2), and pwritev(2) system calls.
In fdisk(8), favor BIOS geometry over physical geometry, fixing numerous problems with larger disks.
Split fxp(4) and dc(4) for pci(4) and cardbus(4).
In ktrace(2), if user does a large IO operation, split the loggin to avoid kmem(4) starvation.
Make nfsstat(1) on a live system use sysctl(3) instead of kvm(3) snooping.
Set mii(4) parameters for all variants of xl(4), cardbus(4) models.
scsi cd(4) detach is now possible.
Do even more scsi device locking via common routines.
In make(1), report errors with a Makefile line number, making large Makefile debugging much easier.
Significantly cleanup the isa(4), pci(4), isapnp(4), and related manual pages, making it easier to see what we currently support.
Deal with byte-order challenged Compaq laptops.
Fix memory leaks in sshd(8).
Numerous modifications for pkg_add(1) and companions, to better import various new styles of packages..
Fix even more braindamaged random device mis-handlings in ssl(3).
Make kvm(3) on the i386 understand the new core dump format.
In script(1), propagate window size changes to slave.
tzcode2000c.
Permit i386 kernel to compile without pccom(4) or com(4) drivers.
After scp(1) completes, replace progress bar ETA counter with a total elapsed time.
Fix more random device mis-handlings in ssl(3).
Fix exit code in du(1).
Fix sync(2) to actually sync all filesystems.
urio(4) driver for Diamond Multimedia RIO 500.
xlockmore 4.16.
OpenSSL 0.9.5a.
Change window(1) to use curses(3) instead of ocurses.
Do some repair on sys/queue.h.
Add colour support to pcvt25 termcap(5) entry.
In window(1), do not assume that termcap(5) entries start with 2 character short names.
Repair random(4) for the alpha.
In ssh(1), check payload for (illegal) extra data.
make "option TCPDEBUG" kernel compile.
Initialize the bus dma tag for EISA.
Use getifaddrs(3) instead of SIOCGIFCONF in ifconfig(8), rarpd(8), etc.
ifconfig(8)'s -a flag had been changed to be the same as -A. Fix that.
Have ahc(4) support Adaptec 2930U2.
Revert to up-to-date ipf(4) man pages, but ugly as sin. Everyone remind kjell to finish this job, ok?
When fragmenting a packet in ip_output(), inherit the multicast and broadcast flags so that link layer can choose the right address.
Use getifaddrs(3) in libpcap.
Make ahc(4) support Adaptec 2930U2 controller.
Match netsec hifn(4) 7751 card.
neo(4) is a Neomagic 256AV/ZX audio driver.
Unmute ac97 mixers by default.
ipf 3.3.12a.
ssh protocol 2 is now usable.
Add Protocols and Cipher keywords to ssh(1) and sshd(8).
compat_linux(8) emulation for setfsuid() and getfsuid().
If realpath(3) fails, just use old name in umount(8).
Add 802.11 nwid and mtu commands to ifconfig(8).
More bug fixes to hifn(4). Hifn support is now fully working.
Some fixes to route6d(8).
Use getifaddrs(3) instead of SIOCGIFCONF in ypbind(8).
Do not lose file descriptors in ftpd(8).
In random(4), first true random number source, based on intel 82802 firmware hub embedded true random number generator.
In random(4), make it use more sources for an entropy; make playing .mp3s produce entropy, big time, big time.
Improve range checking in timeouts.
Thread repair in malloc(3).
Various bug fixes to hifn(4), which is now even more reliable.
Fix another m4(1) bug.
PCI an(4) driver.
Repair spl bug in bridge(4).
wdc(4) and wd(4) detach logic, but missing scsi(4) disconnect for atapi(4).
Permit address setting on enc(4) interfaces, and various other tweaks leading to better bridge(4) integration.
Add various autoconfiguration child detach logic.
Rewrite and commonize disk driver locking which varied between drivers.
After the recent revamp of icmp(4) reply byte order, correct one last thing: Pass ip_off and ip_len correctly.
groff 1.15
In cd(4), do not trust the TOC as much when reading the disklabel.
Fix umass(4) so that it handles some non-compliant devices.
Modify the scsi(4) subsystem so that it can attach without polling.
Arrange so that IFF_LINK0 on enc(4) means IP-in-IP instead of Ethernet-in-IP.
Initial check-in of cardbus(4) support. xl(4) works on cardbus at the moment.
Set our status to 2.7-beta.
Update ppp(8).
Update isakmpd(8).
sendmail 8.10.1
sendmail 8.10.0: You must put your /etc/sendmail.cf file in /etc/mail/sendmail.cf now.
perl 5.6.0
Update to isp(4), mostly for Fibre Channel.
Seed perl(1) srandom() /dev/arandom, to avoid losing a lot of entropy.
Some kernel functions were eating a little bit too much entropy.
ipf 3.3.12
ahc(4) now supports AHA-29160 and other Ultra160 variants.
USB umodem(4) support.
USB umass(4) driver. Works with various devices, but does not support disconnection yet.
Support hmac processing in hifn(4).
ncurses-5.0-20000401
Put an expert mode into disklabel(8), that hides a lot of details. But most of the interface remains 100% the same.
Protocol 2 support in ssh(1) and sshd(8).
Do not have /etc/netstart pass -E to ipf(8), since our kernel now enables it by default.
Many more man page improvements. Aren't we pedantic?
compat_linux(8) system call emulation for pread(2) and pwrite(2).
Make ahc(4) do tagged queuing, and fix some locking bugs.
Support root drive detection for G4 powermac.
Add srandomdev(3) to libc.
DSA key exchange for sshd(8) and friends, moving us much closer to protocol 2 support.
Fix various flaws in the OpenSSL set of manual pages.
an(4) driver supporting AiroNet 802.11DS cards.
Repair some races and deadlocks in adw(4).
Fix buf oflow in ed(1).
Support USB Mass Storage devices.
Make zic(8)'s -l option actually work.
Some ppp(8) updates.
Auto-detect size of seeprom for fxp(4), for newer cards.
Some improvements in kerberos(1) man pages.
DES and 3DES hardware acceleration for IPsec(4) working in hifn(4) driver.
Run pod2man(1) on the OpenSSL pod documents, and carefully install them in the base system.
Expose MDXTransform functions for MD5 and MD4.
Permit wss(4) to work on irq 5.
Implement compat_linux(8) rt_sigreturn() emulation.
On the i386, enlarge pcic0 memory address space.
Implement compat_linux(8) getcwd(3) emulation.
IPsec(4) ingress ACL-checking is now on by default.
sudo 1.6.3
i386 PCI interrupt routing repair code (disabled by default, has lots of issues).
Drivers for USB ethernet adapters.
Sync USB.
lynx 2.8.2
Fix a number if IPsec(4) esp and ah related bugs introduced during the crypto splitout.
Numerous man page link repairs, so that just about any part of the system has a matching man page.
Make f_bsize signed.
Support newer Qlogic isp(4) scsi cards.
Support AMD 756 IDE controller in pciide(4).
Add FNM_NOSYS to fnmatch(3) for XPG conformance.
Flesh out mdoc.samples(7).
Disallow pkg_delete(1) when the pkg_prefix is on a read-only filesystem.
Handle expansion of @exec better in pkg_add(1).
Initial support for DSA keys in sshd(8).
In ssh(1), switch to raw mode only if we got a pty.
Replace kernel timeout(9) mechanism with one which permits dynamic allocation of timeout structures.
In fdisk(8), do not use BIOS geometry by default, a lot of newer BIOSs get upset when this is done with larger drives.
Make script(1) exit with a proper (and documented) exit code.
Fix AMD K6 mtrr(4).
Fix overflow in ftp(1).
Fix directory mishandlings in who(1).
Fix overflow in ul(1).
Fix modes for ch(4) and st(4) devices so that operator is more powerful.
ray(4) supports the raytheon/webgear ieee 802.11 FH wireless ethernet.
ahc(4) driver now supports 789x chipset based controllers (7892/9 not verified).
Add SIOCGIFMTU/SIOCSIFMTU.
Support for the uninorth PCI bridge on the G4 macs.
bus_dma support in the powerpc port.
apache 1.3.12 + mod_ssl 2.6.2
OpenSSL 0.9.5
Fix parsing of @-style commands in crontab(5) files.
Make m4(1) compatible enough with GNU m4 to handle autoconf 2.13.
Add ratecheck(9) API to the kernel.
Quieten, secure, and improve ipv6(4) boot-time route setup.
Cryptographic hardware services framework, first meant for use by IPsec(4).
Fix interrupt handling issue in dc(4).
Newer uvm(9) code.
Prevent overflow in subr_extent code.
Support FAT32 msdos partitions over 4GB.
Many man page improvements.
Disable suffix removal code in make(1), since it is buggy.
Fix blink and underline attribute handling for new PC display mode.
ncurses-5.0-20000311
IPFilter 3.3.11
Support more eisa ep(4) cards.
Implement realtime signal routines in compat_linux(8).
Disable K6 MTRR until it is fixed.
Update rtadvd(8)
Get rid of leading NULs in /kern/msgbuf.
Disallow packets to malicious 6to4 prefixes.
Fix radix tree mishandling bug in routing code.
Add more gnu-compatible options to m4(1)
Repair sub-shell execution handling in hostname.if(5)
Reverse engineer crypto lockout function on the aeon crypto card.
Fix file descriptor leak in compress(1)
Fix a memory corruption bug in the IPsec(4) skipjack implementation.
ncurses-5.0-20000304.
Disallow root password guessing in sshd(8).
grep(1) 2.4.1
Multiple inclusion protection problem solution on the sparc.
isakmpd(8) update.
Add support for new signals to the compat_linux(8) emulation routines.
Add 802.1Q support to tcpdump(8).
OpenSSH 1.2.3 released.
Fix a pipe close race in sshd(8).
Fix a panic in compat_ibcs2(8) emulation code.
Make P_tmpdir point to /tmp, not /var/tmp.
Attempt to handle corrupt inetd.conf files better.
Try to fix the uio hog problem.
Fix STAT in ftpd(8) to be RFC959 compliant.
Optimized kernel fdalloc()
Add some missing compat_linux(8) emulation routines.
Move kernel crypto code to /sys/crypto
Many ppp(8) fixes.
Some libc_r fixes.
mg(1) version 2a added to the source tree, and we are fixing many things in it.
Fix an entropy-robbing bug in the ssl(8) libcrypto.
Change wicontrol(8) so that multiple parameters can be set at the same time.
Add -m parameter to strings(1).
Add getifaddrs(3).
Permit enlarging of msgbuf on the various architectures.
On sun4m machines, replace .{u,}{mul,div,mod} functions with faster versions using the new sun4m instructions. A very significant performance improvement.
Add fseeko(3) and ftello(3) interfaces.
Two TCP SACK fixes -- SACK now appears to be completely reliable.
Optimize bridge(4) code by allocating less mbufs.
Fix alignment fault in amd(8) on the alpha.
Add support for ses(4) devices, and the sesd(8) tools for probing.
Add support for 12160 (Ultra3) in isp(4).
Buffer overflows in mopd(8)
Complete hypersparc support.
Link sparc boot and bootxx bootblocks at different addresses; repairs booting on the hypersparc.
update to latest KTH kerberosIV 1.0
Update to newer compile_et(1).
Full support for serial console on the i386, see boot(8).
Support PPPoE in tcpdump(8).
Fix alignment problem for ancillary data; affected 64 bit machines.
Do not call sleep(3) in rcmd(3).
On sparc, avoid flushing unmapped memory from the cache in dvma_mapout().
ipf 3.3.9
Move smrsh(8) to /usr/libexec.
Add traceroute6(8).
Use extents instead of rmaps to manage sparc dvma space.
Have extent_alloc_subregion() also handle an alignment offset.
More fixes to xl(4) for non-MII cards.
In sshd(8), move XAUTHORITY to a subdirectory, fixing security issues.
Handle directly connected lines better in pppd(8).
Y2K repairs in cvs(1).
Let weak symbols take precedence over second hand symbols in ld(1).
wx(4) driver supporting the Intel 82452 gigabit ethernet card.
Support hundreds of interfaces in dhclient(8) and dhcpd(8).
texinfo 4.0
Split i386 memory <16MB into it's own freelist, permitting large memory machines to work better.
New fhopen(2), fhstat(2), and fhstatfs(2) system calls to easier support userland filesystems.
Support newer LVD models in the ncr(4) driver.
gdt(4) driver for the ICP-Vortex RAID card series.
Update to FreeBSD newfs_msdos(8), which can support hard drives too
New OpenBSD art page.
Updates to the lmc(4) device driver.
uaudio(4) support.
ti(4) also supports Farallon PN9000SX.
ncurses-5.0-20000205.
adw(4) now supports Advansys U2W scsi cards.
Further sparc pmap improvements.
Allow ssh-keygen(1) to be used for generating signatures of any ssh(1) control file.
In sparc port, handle SM30 specially because it starts up with the cache running.
import usbdevs(8).
When handling an apm(4) suspend, power down pcmcia devices; when unsuspending, power them back up. Very nice.
Rewrite makewhatis(8) in perl(1).
Deal with empty path element in LD_LIBRARY_PATH variable.
On i386 prevent overflow in computation of buffer cache limitation, thus supporting machines with lots of memory.
Hardware encryption support added to wi(4) (the wavelan driver).
Performance optimizations to m4(1).
Fix a panic in nfsd(8).
Have mkdir -m support sticky and setuid bits.
Support -R flag in rtadvd(8).
Without a subcommand, have atactl(8) assume that the "identify" command is implied.
Workaround in ftp(1), for Y2K broken ftp servers that return 19100 for the year. Remind is this is here in the year 19098, ok?
ipf 3.3.8
Fix a pty close race in sshd(8).
Arrange so that dhclient(8) does not update /etc/resolv.conf if no DNS information is found.
isakmpd(8) update.
Support 93C66 and 93C56 SEEPROM chips (used by more modern ahc(4) cards).
Fix a number of bugs in fsplit(1).
Use ed(1) in /etc/rc, since grep(1) is in /usr.
i386 now runs libkvm instead of libkvm.old.
Add a dmesg(8) alias to the install media.
In gcc(1), add an i386 specific peephole optimization for stack adjustment.
Fix some APM version 1.2 issues, thus making IBM Thinkpads work.
On the i386, now use the memory map information supplied by the bootblocks.
Use alloca(3) instead of malloc(3) in execl(3) and execle(3), so that they are vfork(2) safe.
sudo 1.6.2p1
Arrange so that sshd(8) does not do port forwarding until shell successfully starts.
Repair a stupid cache-lockdown bug in the sparc pmap.
Repair memory leak in freeaddrinfo(3).
Significant code shrinkage in IPsec(4), as most AH and ESP code starts sharing more subfunctions.
Enable ipv6 support in rsh(1), rlogin(1), rshd(8), and rlogind(8).
Fix rcmd(3), iruserok(3), and ruserok(3) to be IPv6 capable, also add more address family independent routines: rcmd_af(3) and iruserok_sa(3).
Handle MVME1x2 boards with only one ZS serial chip.
Avoid some more cache flushes in the sparc pmap module.
Handle memory shortage better in yacc(1), closing some memory leaks.
Sparc pmap performance improved by optimizing some more pte table walks.
isakmpd(8) update.
Many more man page improvements.
More getaddrinfo(3) improvements to further match RFC2553.
Add MAC address filtering in the bridge(4) code.
Fix timestamp bug in make(1).
Apache 1.3.11 + mod_ssl 2.5.0 merge
MVME328 scsi card support in mvme68k port.
Portable code for handling architectures with backwards-running stacks, like hppa.
Fix Y2K non-compliancy in amiga port's clock chip code.
some minor repairs to grdc(6).
MVME376 ethernet card support in mvme68k port.
mvme68k and mvme88k ramdisk repairs.
sudo 1.6.2.
Make application mode arrow keys work in ksh(1).
Protocol independence added to bindresvport(3).
OpenSSH version 1.2.2 released.
Lots of IPsec(4) pfkey improvements.
Repair exception handling in gcc(1) i386 position independent code.
ncurses-5.0-20000122
Don't allow time to be set far forwards and thus wrap, and a warn for time reversing if securelevel(7) > 1.
Some compat_sunos(8) emulation improvements, particularly for getdents.
Various powerpc port fixes -- it is getting close to actually working well.
Handle SIGINT failures in ssh(1)/scp(1)/cvs(1) better.
Fix bugs in the robots(6), tetris(6), and grdc(6) games.
Make pax(1)/tar(1)/cpio(1) deal with files larger than 2 GB.
Deal with getcwd(3) returning NULL in at(1).
Rename ip4.allow sysctl(8) to ipip.allow. This variable no longer controls any explicitly configured IP-over-IP tunnels.
Deal with getcwd(3) returning NULL in the supfilesrv.
DRIVER IMPROVEMENT: Intel fxp(4) cards with nsphy(4) could not negotiate and maintain 100mbit link. A source code patch is available.
Fix a buffer overflow in the i386 bootblocks!
Fix vi(1) recover script to use sysopen(), to avoid magic in perl open().
Fix race condition in make(1) (only applies to make -j, which noone in OpenBSD ever uses).
Reduce console loggin in sshd(8).
Fix sshd -i.
SECURITY FIX: Systems with procfs enabled and mounted contain a root hole due to a tricky exploit. A source code patch is available.
Fix a possible NULL dereference in execve(2).
gcc 2.95.2
add rip6query(8).
Many man page fixes.
Change pcvt(4) so that all regular function key presses go to straight to the application.
Avoid botches in ftpd(8) and mtree(8) introduced from blind replacement of getwd(3) with getcwd(3).
Disable agent forwarding in ssh(1) protocol 1.3.
Support for another gigabit ethernet card using the alteon chipset.
Fix a garbage printout in ftpd(8).
Error message repair in from(1).
Fix fxp(4)+nsphy(4) problems.
Tons more man(1) page repairs.
Fix a bug in the pipe(2) system call.
v6 support in fstat(1).
Documentation improvements.
Fix "traceroute -P 41" codepath blocked by inet6 import.
Another fix improving on the earlier ld.so(1) version number fix.
tcpdump(8) support for L2TP, Mobile IP, BGP, VLAN 802.1q, and INET6.
ncurses-5.0-20000115
Crank pms(4) delay to 4000 for another laptop that takes a long time.
Make kernel know about the Coppermine CPUs.
Special case: one PCI bridge device... which is not a PCI bridge at all.
Handle SNAP encapsulated packets for the bridging blocknoip option.
Improve sparc pte handling for performance.
Show blackhole routes in route(8) and netstat(1).
Fix a Y2001 bug in the hp300 boot code and kernel.
Update the powerpc code. uvm(9) kernels do not work yet.
Avoid touching the sdh register too often during atapi(4) device probe; some devices freak.
More m4(1) fixes.
Fix an obscure bug in ld(1) that caused it to treat directory names called "lib" differently.
Y2K fix for a groff(1) macro.
Remove gifconfig(8); replaced by syntax in ifconfig(8).
Show problematic expressions in m4(1)'s expr error messages.
Recursion depth control in gre(4), similar to what is in gif(4).
Various cleanups are happening to the netipx codebase.
Fix Promise Ultra/66 and SiS 5513 pciide support.
blocknonip option in if_bridge and brconfig(8).
pn(4) cards now use dc(4).
More channel fixes in ssh(1).
XFree86 3.3.6
Handle glob() return values better in restore(8).
Hifn 7751 is the same as the Invertex board, the aeon driver.
Support command-execution in /etc/hostname.* files, using ! syntax.
Handle the bootpath properly in sbus isp(4).
IPsec(4) ingress control.
Merge IPV6 into the GENERIC kernel. As far as the kernel is concerned, we are ipv6 ready now. However, lots of userland changes remain..
Reduce recursion in gif(4).
Support Davicom DM910x in if_dc.
Numerous IPsec(4) fixes and enhancements.
Allow aeon driver to match Hifn 7751.
Fix printing of SAs in route.
Add ESP/AH statistics to netstat(1).
Fix to use network byte order in several places.
Allow booting from Qlogic isp cards.
Several IPsec-related sysctls added.
Various termtypes fixes.
ncurses-5.0-20000108
Add fake dcphy(4).
In UKC, add a timezone command.
Handle fxp(4) using iophy(4); broken in 2.6 release.
Support LBA-mapped extended partitions in fdisk(8).
Use arc4random(3) in IPV6 code.
Import of gre(4) code.
Early check for udp destination port 0.
Newer raidframe code.
userland ppp 2.26.
Make NFS swap devices work once again.
In the mvme68k port, add support for the '060 based MVME177 card.
Make some macros in m4(1) special.
Improve column handling in ls(1).
V6 support in systat(1).
Y2K FIX: The at(1) command was unable to parse some kinds of dates. A source code patch is available.
Improve sleep(1) for out-of-range values.
Do not use kvm snooping in rtsold(8).
Fix ftp(1) URL support accidentally broken by KAME.
Fix a bug in smtpd(8).
Make ssh IPV6 clean. KerberosIV only works on a v4 connection.
Fix mbuf out-of-bounds write which caused great grief for NFSv2 in an INET6 kernel.
Add rmoption/rmoptions command to config(8), thus permitting a config file to include GENERIC and then remove things.
Various small improvements and fixes to ssh(1).
Fix pthreads(3) handling on the sparc.
Using weak symbols, support a real libpthread.
The mknod(8) -m option should ignore the umask.
More man page cleanups, as always.
Y2K FIX: A minor problem; the sparc eeprom(8) command is not Y2K compliant. A source code patch is available.
Permit midi compilation without other audio code.
Y2K FIX: A minor problem in the logging support for the adduser(8) command. A source code patch is available.
In config(8), permit multiple maxuser definitions. Newest overrides older ones.
Use the dc(4) driver instead for a few other tulip-like cards.
Change libc syslog() code to try to reopen the socket if a send fails. This handles the case of a restarted syslogd(8) better.
Correct SIGTERM handling in ssh-agent(1).
ncurses-5.0-20000101
Permit non-IPsec(4) kernels to compile.
Improve argument handling in wicontrol(8).
Various fixes to LKM(4) unloading.
Make ld/ld.so search all directories before accepting the best version of a shared library.
Do in6_if_up() at splsoftnet(), permitting drivers to get interrupts during the processing of their multicast reprogramming.
Provide sysctl(8) net.inet6.icmp6.nodeinfo to permit admin to enable icmp6(4) node information query if so desired.
Support various kinds of inet6 entries and in /etc/netstart as well.
Improve handling of signed math in NFS kernel code.
Parse /etc/sysctl.conf earlier in /etc/rc.
Move sysctl to /sbin.
For other architectures, also check db_panic in kdb_trap().
Remove PIC versions of libarch and libresolv from the distribution.
Correctly copy pkthdr in m_split().
Fix udp multicast option handling.
DRIVER IMPROVEMENT: Fix mii autoselect support for 3c900b. A source code patch is available.
Fix signed errors in df(1).
Repair netstat -ss.
Optional swap encryption support in uvm; see new options(4) page.
Do not strip international characters in fmt(1).
Initialize lo0 for ipv6 automatically.
Avoid a memory leak in telnet(1).
Honour the ddb.panic sysctl better.
Enable scopeid hack in ifconfig(8), ping6(8), and netstat(1).
Replace NRL get{addr,name}info() with KAME get{addr,name}info() in libc.
Fix a terminfo problem relating to unset capabilities.
More ISA PnP NE2000 clones - see ne(4)
TCP new reno
Fix IP multicast kernel panic
Upgrade ipf(4), now version 3.3.6
Major cleanup of make(1)
3c450-TX HomeConnect, see xl(4).
Add Qlogic 1240/1280 support to isp(4).
Update curses(3) to ncurses-19991218.
Speed up blowfish(3) encryption by > 20%.
More ipf(8) changes. Avoid rw_enter panic, coredumps when processing rules.
Preliminary token ring support.
Continuing ssh(1) improvements.
Add srcsa, dstsa, clearsa to ifconfig(8)
New ioctls for binding enc(4) interfaces when bridging.
Yet more make(1) cleanup.
Preserve file flags in mv(1).
Added the gif(4) interface for tunneling IPv4/IPv6. See gif(4), gifconfig(8).
Add more PCMCIA NE2000 devices.
Fix and re-enable TCP SACK code. Eliminate TCP_NEWRENO. See options(4).
Continuing IPV6 improvements.
Print ipv6 addresses correctly IPsec(4) flows. See netstat(1), route(8).
ipsecadm(8) now accepts ipv6 addresses.
Improve timeout handling for some ATAPI devices.
Add man pages for icmp6(4) and ip6(4)
traceroute(8) fixes. Add -c, -I. Fix -P.
Fix multicast kernel panic in ip_output.
Add forward reference for sockaddr to netinet/in.h
Some game fixes: fortune(6) and robots(6).
More make(1) cleanup.
Various IPV6 changes.
ipmon(8) -F now works properly.
Import of IPFilter 3.3.5. See ipf(8).
Long overdue make(1) cleanup.
ipf(8) can now use interface names.
Add support for Qlogic 1240 and 1280.
Preliminary awi driver code.
Fix privilege error in wi(4) driver.
Replace pn(4) driver with dc(4).
Overflows in at(1), ar(1), cdio(1).
Import of IPFilter 3.3.4. See ipf(8).
Changed termcap providers
Various fixes to hunt(6).
TI TNETE2101 PHY
Fix dlfcn(3) prototypes
Sync awk(1) with June 6, 1999 version
New dc(4) driver for DEC/Intel 21143 and clones
Don't use stdio for getpass(3).
Update of PHY subsystem
Various sparc and i386 pmap fixes for UVM
Sundance ST201 Ethernet from FreeBSD. See ste(4)
IPsec cleanup
Cleanup of make(1).
Lots of UVM work
MFS unmount race fixes
Add bindresvport_af(3) and rresvport(3) APIs to libc.
Updated curses(3) to ncurses-19991211
Overflows in crunchgen
Fix chpass(1) temp file handling
Various soft update fixes
Integration of KAME IPv6
Features added to find(1).
Fixes to eap(4) driver
Overflows is split(1), jot(1), ssio, telnet(1), file(1).
SiS 900/7016 Ethernet from FreeBSD. See sis(4)
Tape support and major code changes to atapiscsi(4).
The third ssh jumbo patch is now available. Numerous (non-security) additions/changes have been made to OpenSSH since the OpenBSD 2.6 release. A jumbo patch is available which adds many features.
The second ssh jumbo patch is now available. Numerous (non-security) additions/changes have been made to OpenSSH since the OpenBSD 2.6 release. A jumbo patch is available which adds many features.
Some overflows in patch(1).
Buffer overflow in dnsquery(1).
Buffer overflow in error(1).
Fix a buffer overflow in dhclient(8).
Fix two crashes in awk(1).
Fix off-by-one in apply(1).
Fix bug in pr(1).
Make soft updates mostly work with UVM.
SECURITY FIX: The USA version of the ssl library package, called sslUSA26, contained buffer overflows. A binary patch is available for people who installed before December 3.
Remove ctm(1) from the src tree -- look for it in ports now.
libkvm.old hacks for UVM.
Fix utmp handling in ftpd(8), for when running in daemon mode.
More m4(1) fixes.
Fix append keyword in dhclient(8).
Buglet in sort(1).
DPT SmartCache III/IV SCSI PCI/EISA driver.
mkisofs 1.11.3
Fix mangled files for put command in ftpd(8).
RELIABILITY FIX: Be more careful in poll(2). A source patch is available.
ncurses-5.0-19991127
Enable TI16750 UART support.
driver for ISA hostess 4-channel serial card.
Import ssh-askpass into our X11 src tree.
For i386: Winchip c6 TSC is broken, ignore it.
Fix descriptor leaks and potential double fclose() calls in skey(1) library code.
Correct icmp(4) packet length in ipmon(8).
Remove unused functionality from the i386 pcvt(4) driver.
Allow machine-dependent code to set the PAGE_SIZE constant, and set it in MD code if possible -- performance improvement.
new pthreads(3) code.
Parsing error fix to calendar(1).
Some more m4(1) fixes.
Set SO_REUSEADDR and SO_LINGER on forwarded ports in ssh(1).
SECURITY FIX: Limit newaliases run to root and trusted users. A source patch is available.
SSH_ASKPASS support in ssh-add(1).
Numerous ssh(1) and sshd(8) improvements... too many to mention.
Newer version of the isp(4) driver.
Fix a bug in rarpd(8).
Add support for SIGIO to lms(4), pms(4), and mms(4).
Fix two bugs in info(1).
select on pipes was broken, and occasionally someone would notice it (in particular rsync).
Use mkstemp(3) in crontab(1).
Improve egcs performance.
Add memconfig(8).
Add mtrr(4) support from freebsd.
SSH_CMSG_MAX_PACKET_SIZE support in sshd(8).
Improve whois(1) even more.
Many man page fixes.
sudo 1.6 (BSD licenced now!)
Fix more m4(1) bugs.
In scp(1), do not display banner if process is in the background.
Permit kernel to compile without FFS once again.
More links to man pages.
Bug fixes to rl(4) and tx(4) driver.
More ATAPI disk fixes (may come as a patch file later).
Other misc ssh(1) improvements.
RSA key fingerprints in the ssh(1) commands.
Do ANSI cursor save/restore in i386 pcvt(4) driver.
Fix more m4(1) bugs; patch for this problem is included in previous m4 errata entry.
A bit more playing around in sshd to deal with the broken key sizes that Datafellows ssh gives.
Honour ddb.console in the mac68k port.
Fix retransmission problem in TCP.
Improve whois(1) significantly to use *.whois-servers.net.
In lots of daemons, do not syslog getpeername complaints.
In ksh(1), quote metacharacters when completing filenames.
Fix a signal race crash in ksh(1).
link window(1) with -locurses.
top(1) should use stathz, not hz, for calculating process run times.
Shrink the puc(4) dmesg output.
Add OSS audio support to the BSD/OS emulation.
A kernel reliability fix for the alpha. A patch is available.
A kernel reliability fix for all m68k architectures. A patch is available (which all m68k architectures share).
Numerous (non-security) additions/changes have been made to OpenSSH since the OpenBSD 2.6 release. A jumbo patch is available which adds many features.
A kernel reliability fix for the sparc. A patch is available.
Counter overflow fix to scp(1).
Merge dvdio.h support into cdio.h, and cleanup various unportable bits.
Various other ssh(1) cleanups.
Print all bad options in sshd(8) and ssh(1) before exiting with a failure.
sshd(8) now has a IgnoreUserKnownHosts flag.
Optionally run a command in newsyslog(1), instead of sending a signal.
Some make(1) fixes.
Improve dhcp integration into the install media.
Logging cleanup of ssh(1).
Have sshd check the user's personal ~/.ssh/known_hosts file.
NOTE: OpenSSH does not have the ssh 1.2.27 rsa bug.
Install a shared libperl.
Fix m4, accidentally broken in 2.6. A patch is available.
Users should not be able to change the media configuration of interfaces. A patch is available.
Add strtok_r(3).
newsyslog race condition fixes. A patch is available.
Various make(1) fixes.
screen blanker code for the amiga.
Default network name in wi(4) is "", not "ANY".
Start of DVD support.
New sf(4) driver supports Adaptec "StarFire" AIC6915-based Ethernet PCI cards.
Numerous more ssh(1) and sshd(8) cleanups.
Slow down ATAPI IDENTIFY (final critical fix which shipped in 2.6).
Another critical i386 memory allocation fix (shipped in 2.6).
Critical brooktree driver fix (shipped in 2.6).
Fix some more atapi bugs (shipped in 2.6).
Fix byte order bugs in the new wdc/atapi code.
Sparc uses UVM by default now.
Allow rarpd(8) to work on aliased interfaces.
Support multiple enc(4) interfaces.
Reliability fixes for the ATAPI code (shipped in 2.6).
New driver: al(4) supports the ADMtek AL981/AN985 PCI ethernet cards.
Various other ssh(1) and sshd(8) cleanups.
Add ethernet-IP encapsulation.
In ssh, use libssl(8) md5 routines instead of our libc routines.
Disassociate interfaces from ipnat(8) after they've been removed from the interface list.
Make ASYNC pipes capable of generating SIGIO.
Emulate FreeBSD F[GS]ETOWN.
Fix some further ARP problems in bridge(4).
Fix scp(1) counters for > 1 hour.
Support LMC1200 in lmc(4).
Repair multicast routing description block in afterboot(8).
Support missing tty flags in stty(1).
libkeynote update.
Support UVM throughout userland.
Support for puc(4) (PCI serial/parallel cards).
Make disklabel.h safe for C++ use.
Use reference-copies of the mbuf in bridge(4) code again, instead of full copies.
Make ssh print the correct remote version number.
Make ssh(1) compile faster by using a library.
In ti(4), use bus_dma routines instead of uvm_page_alloc_contig.
Cleanup i386 disktab.
--------
Changes made between OpenBSD 2.5 and 2.6
2.6 source tree frozen.
Merge in some critical ATAPI fixes.
Force FDSCRIPTS.
RELIABILITY ISSUE: Fix a bug in the brooktree driver which permitted any user to crash some OpenBSD/i386 machines. A patch is available.
Separate help(1) command, and a separate help(1) man page.
Move wrapper handling to the child process, in sshd(8).
Various fixes for the bignum and RSA handling code in sshd(8).
ssh 1.5 protocol.
isakmpd policy man page.
Put gcc-lib in base, because the mac68k installer built-in tar command is stupid, and does not do a mkdir -p type operation internally.
In the install script, if the user skips network config and later chooses an option which requires network config, ask for network config to be done then.
Make i386 pcvt driver also support the traditional PC display, with 16 colours.
In the install script, support separate international and USA versions of the ssl package.
Fix another unmount/mfs race condition.
If no sshd_config file, have sshd(8) abort.
Fix for the i386 isadmaattach panic.
PermitRootLogin in sshd(8).
Document how we are dealing with SSL, crypto, and RSA issues in the ssl(8) man page even better.
Stir ARC4 after key use in sshd(4).
Fix mii tick tock stuff in the fxp(4) driver.
Fix connect() race in ssh agent handling.
Numerous fixes and improvements to the install scripts.
Avoid mbuf corruption in recvmsg(2).
Only attempt to read disklabels from CDs with a data track.
Fix a bug in newsyslog(8), which caused it to rotate empty log files near first system boot.
Do not call VOP_SETATTR on a pipe.
SilentDeny option for sshd(8).
Avoid an infinite loop in ping(8).
Add driver for i82553 phy, used by some fxp(4) cards.
Allow root logins in xmd, but provide a nice comment so people can disable it easily.
Document -e support in config(8).
Use setsid(2) on all connections to sshd(8), since our setlogin(2) is secure and needs that.
sshd(8) Allow/Deny Users/Groups features.
sshd(8) UseLogin feature.
Use a separate perl-based vi.recover script because sh is a terrible language.
Check permissions of directories leading up to ssh authorized_keys file.
For AF_UNIX sockets, do not follow symbolic links at creation time, since there is nothing equivalent to O_EXCL.
Permit build of system with NFSSERVER but without NFSCLIENT.
More keynote man pages.
pmax support is back in the tree, various tweaks everywhere.
Make eap(4) print it's interrupt at attach time.
As well as numerous repairs, now also support "pkg_add *".
Many many man page improvements.
Support newer model of the fxp(4) card.
Further improvements to ATA probing.
Support skey in sshd.
Use pkg_add -I for the ssl package install, in the install scripts.
Repair fd(4) motor off code.
Handle most xl(4) devices that lack a PHY.
On machines lacking shared libraries, install the ssh utilities with mode 0, so that /etc/rc will run the ones in /usr/local/bin instead.
Cluster fixes to ipsec code.
implement client NumberOfPasswordPrompts in ssh(1).
Support various effect modes on the ym(4) sound cards.
Y2K related fixes for some buggy i386 clock chips.
Fix various atapi sense detection bugs.
Big endian fixes to tcpdump(8).
Move sshd auth sockets to a private directory.
Various make performance enhancements.
Ensonic ES1371 support in the eap(4) driver.
Fix a sshd xauth race.
Lots of manpage improvements.
ssh crc32 compensation attach detection fix from core-sdi.
PCI Promise IDE controller support, not perfect yet.
Nuke minfd stuff in ssh.
config(8) gets -e and -u support.
Put sbin and /usr/sbin in the default path.
Fix garbled dmesg output on the console in the mvme68k port.
DNS spoof checking code in the ssh.
Double default shared memory for i386.
Various quality of software repairs to sshd, like errno trashing in signal handlers, and other stupid things like that.
Fix a missing memory initialization bug in the i386 bootblocks.
Avoid use of shutdown(2) in sshd.
For fts(3) and find(1), fix various off-by-one errors and some issues with -execdir for multiple relative directories.
libwrap support in sshd.
Nice setproctitle(3) changes to sshd, so that you can tell which process is which login.
Add -q support to whois(1).
Remove local blowfish code in ssh.
Improve the scp(1) progress meter.
Various games fixes.
mod_ssl 2.4.5
new isakmpd code.
Support DSO's in httpd, and build them into the normal tree.
sm(4) driver now supports SMC 8020 pcmcia cards.
sk(4) driver for SysKonnect 984x gigabit ethernet adapters.
add support for external storage to the mbuf layer, managed by external managers.
libkeynote 2.0
Support more ess(4) sound card models.
Numerous other ssh changes...
in ssh, use libc md5 code.
remove rc4 code from ssh
Remove ssh "-c none" code.
Improve ftpd's documentation.
Improve tcpdump's handling of ISAKMP packages.
Make bootblock memory probing work the same as 2.5.
More man page repairs and improvements. A day doesn't go by...
Some fixes to the games.
Many more ssh improvements.
Critical ipsec reliability fix for the i386.
Run ldconfig before any ssh stuff, because the ssl package now extracts into /usr/local/lib.
Apache 1.3.9 + Mod_ssl 2.4.2
ssleay(1) goes away, replaced by openssl(1).
OpenSSL 0.9.4
Fix tun(4) byte counters.
To ssh, add X11DisplayOffset, user@host, kerberos4 support, GatewayPorts, ssh -g, etc.
Fix rc scripts to start ssh nicely upon first and subsequent boots.
Rip all licensed and patented code out of ssh.
Support MVME188 and MVME197 models in the mvme88k port.
Fixes to the pci wb(4) driver.
pkg_add signing capability is being worked on.
Put uuencoded install bits for amiga into the tree, so that they can end up in the distribution.
Fix hp300 ramdisk.
32-bit ie(4) driver for the mvme68k and mvme88k ports.
More changes to pcvt scrollback code.
More fixes to pci ax(4).
In inetd.conf, disable telnet/ftp/login by default.
Simplify ssh configuration.
New mandoc pages for ssh(1) and friends..
Add ssh to the source tree (based on an old version, but all the bugs are fixed, and we are playing RSA license games with libssl/libcrypto and adding all the modern ssh features).
Add :L and :U modifiers to make(1).
stdbool.h from C9X.
Install script changes to support libssl package install. Not nice, but it will be improved.
Move towards 2.6-beta.
Fix icmp byte-order changes so that ip_forward() aliased packet doesn't bite us.
Many man page changes.
Some ipsec changes to tcpdump(1).
Add atactl(8).
Add opendisk(3) API to libutil.
Crank some i386 limits, now that kvm is larger.
Repair some URL handlings in pkg_install(8).
Significant changes to the install scripts.
Change makewhatis to accept arguments.
AC-97 CODEC support.
Fix device existence check in hp300 tape support.
Grow i386 kvm to 512MB.
Merge to tcpdump 3.4.
Use writev(3) in libc functions that talk to stderr.
Add raw support in tcpdump.
In xl(4), Support 3c980c.
Fix a FIFO handling bug in xe(4) driver.
Fix a caching bug in getpwent(3) seen with setuid binaries and YP.
i386 support for "isa0 at pcib?".
Upon bootup, permit i386 to modify the rootdev after looking at BIOS disk signatures.
Change rc.conf so that sendmail is started with -q30m by default (not -bd).
Various speed improvements by using round_page() instead of roundup(foo, NBPG).
cvs 1.10.7
Import uunencoded binary amiga things which need to be in a release.
64bit repair in ls(1)
ELF64 support.
Some man page improvements.
Detach code in the icsphy.
Support tadpole sparc microcontroller.
Ensure that adduser(8) sends the password to encrypt(1) via stdin, avoid ps(1) snooping.
Improved m4(1) extensively.
Improved fsck_msdos(8).
On i386, expand aperture because XFree86 3.9.15 want to look at the card BIOS.
p9100 console support for Tadpole sparc.
Scroll-back support for the i386 pcvt driver.
Use stathz to calculate CPU time, fixing CPU calculation when stathz is different from hz and profhz (affected i386).
Preliminary ATAPI tape drive support.
Support "short" mouse protocol for the Tadpole sparc.
More queue.h macros.
In /etc/rc during vi recovery, ensure vi recovery files are normal.
Change /etc/rc.shutdown handling, so that /etc/rc.shutdown is completely admin-editable and does not run if in single-user mode.
NOTE: If you follow current, this means that people need to install a new /etc/rc file.
On sparc, change pagetable pointers using atomic instructions.
Change pmap_enter() API.
Start doing an atoi(3) audit of the tree; most cases should use strtol() and strtoul().
Cleanup handling of signed and unsigned numbers in sysctl(8).
Many man page improvements.
Print i386 interrupts nicer in vmstat -i.
In bridge, do not flush static address when configuring down.
Permit bridge control before it is configured up.
Cleanup parsing of /etc/hostname.* files, and support new /etc/bridgename.* files.
In tcp's input path, for SACK, update the window information correctly.
If a patch contains zero patches, have patch(1) error out.
Start amd(8) in /etc/amd.
Fix buf overflow in amd(8).
Support AAA-131CF card in ahc(4) driver.
Check SACK hole validity better, and do sequence space arithmetic better.
SECURITY ISSUE: In cron(8), make sure argv[] is NULL terminated in the fake popen() and run sendmail as the user, not as root. A patch is available.
Some fixes to newsyslog(8).
Disable SACK for now; some issues remain.
Buffer overflow fixes in from(1).
Make res_random and ip_random attacks harder by adding a little xor.
Improved handling of BIOS memory maps, which should permit apm to work a bit better on some machines.
XFree86 3.3.5
Allow userland to figure out whether a scsi device is atapi or not; used by some things like tosha.
Fix fgets(3) bug in paste(1).
gcc 2.95.1
ncurses-5.0-990821
Disable -fstrict-aliasing by default: It causes gcc to generate very incorrect code when compiling code which isn't perfectly ANSI-conforming.
Add MOUSEIOCSCOOKED and MOUSEIOCSRAW ioctl() calls to the lms and mms drivers, so that X can figure out what driver is running.
Extend support in kbd(1) for the sparc.
Change default group ownership for tty and cua devices, so that locking works better in tip(1) and cu(1).
Crank kerberos default expiration date.
Teach i386 architecture code about Rise CPU models.
Build shared library called libperl.
Use new arch -s option for building perl.
Fix a few possible sparc pmap races.
Make ld.so work on mips again.
Merge machine(1) and arch(1) commands.
Fix a sun4m trap handling bug.
Get ready for emulating linux clone(2).
Make various forms of rup(1) produce the same formatted output.
Many man pages updated.
Various tiny fixes.
In fortune(6), a fix for a use after free().
hp300 CD booting.
Fix buglet in fts(3) handling of FTS_NOCHDIR.
Various dmesg and space-saving improvements to the pcmcia drivers.
Allied Telesis LA-PCM pcmcia ethernet card support.
ncurses-5.0-990814
Various improvements to the install scripts.
Correctly set the type and typename in the wd(4) driver generated label.
Support AmbiCom NE2000 pcmcia ethernet.
Fix the scheduler problems in the 2.5 release.
Driver for ASIX88140A/88141 PCI ethernet, ax(4).
In pcmcia ep(4) driver, support 3CXEM556B-INT.
Remove useless if_ep shutdown hook.
Import USB code.
SECURITY ISSUE: The procfs and fdescfs filesystems had an overrun in their handling of uio_offset in their readdir() routines. (These filesystems are not enabled by default.) A patch is available.
Repair: probe svr4 emulation before linux once again.
Support -M and -N flags in uptime(1).
Detect IDT WinChip models.
If we fail to match an isapnp device, and it looks like it has the resources a com(4) device would have, try seeing if it in fact is.
New i82365 pcmcia irq probing code that tries much harder to allocate a proper interrupt for the pcic.
Add DIOCRLDINFO ioctl, used by fdisk(8) to indicate that the MBR has been re-written, and the disklabel should be re-read off disk.
Support PChome-PCI LANCE (1Mbit phone wire "ethernet") using le(4).
Document "Precedence: list" in vacation man page.
In tar, fflush(stderr) at a critical point.
Skip hostname.* files if the interface does not exist.
Make mbuf panic messages unique.
Repair interface walking in rarpd(8).
SECURITY ISSUE: Stop profiling (see profil(2)) when we execve() a new process. A patch is available.
pcmcia device attach/dettachment code, supporting network and serial devices now.
vdevgone() internal kernel API.
If fread(3) returns EBADF, also set the error flag.
Fix a number of uid_t, gid_t and %u changes still broken in the source tree.
Split i386 ramdisks up a bit for the next release.
Fix sparc interrupt handler to recognize < 0 from an driver interrupt handler means "interrupt may have been for me, but I am not sure".
isakmpd(8) updates.
Add SADB_FLUSH logic to IPSEC PFKEYv2, and a ipsecadm flush subcommand.
Update bktr driver.
Shrink some device drivers; we're trying to make more fit onto the install floppy.
config_defer support in the kernel.
Some man page cleanups.
Make IDE work again on the alpha.
PCI ESS Solo-1 PCI audio card driver, see eso(4).
Make poll(2) system call a tiny bit faster for trivial calls.
Enable emacs tab completion by default in ksh(1).
/tmp race repairs in yacc(1).
Propagate TMPDIR better into locate.updatedb(8).
Kill gzip sub-processes in pax(1) instead of letting them die from SIGPIPE.
SECURITY ISSUE: In /etc/rc, use mktemp(1) for motd re-writing and change the find(1) to use -execdir. A patch is available.
Support for 3c515 isapnp 100mbit ethernet card, in ef(4).
Chown/chmod all of the pty devices.
If /etc/fstab is 0-length or not a regular file, have setfsent(3) fail.
Import of mailwrapper(8) into the tree.
Games updated.
SECURITY ISSUE: Do not permit regular users to chflags(2) or fchflags(2) character or block devices. A patch is available.
New raidframe code.
Make sure install scripts remove async mount conditions before attempting to installboot(8).
Have route flush skip PF_KEY flows.
tcpdump 3.4 merged.
Have pkg_create(1) use tar -T.
Add -T option to tar(1).
Fix fgetln(3) issue in pax(1).
SECURITY ISSUE: Make nroff(1) call groff(1) with the -S option. A patch is available.
If src file does not exist, have mv -i complain immediately.
Bug fix to pkg_add(8).
More man page cleanups.
Clean dmesg output from various drivers.
Make rc.shutdown work from single-user mode too.
PCI Tigon I and Tigon II driver, ti(4).
Disable DMA on Acer Labs PCI IDE chipset, for now.
Switch to new ATA/ATAPISCSI code for most architectures.
Make the i386 dkcsum stuff be quieter for empty removeable media devices.
Do installs faster by mounting the filesystems async.
Fix various bugs in bridging support, especially SIOCBRDGRTS.
Make tun(4) return EMSGSIZE for zero-length writes.
Fix a field count bug in join(1).
In ipnat(8), fix -n to work with -v.
Missing newline in id(1).
New drivers for the force CPU-5V (vme, sys config, D/A board driver, flash).
Handle _POSIX_VDISABLE better in telnet(1).
Run i386 audio at higher IPL.
Take greater care in head(1).
Less dmesg verbosity from media routines.
Various atapi/scsi/ide changes being worked on (LS-120 works).
powerpc ieeefp library routines.
insque is no longer in libiberty.
egcs-990718.
Bring back TCP_SIGNATURE support.
1000baseXX media support.
For isapnp drivers, we can do more resource checking in the xxmatch() function, and less in the xxattach() function.
Add fparseln(3).
new swap16_multi() macro in sys/endian.h.
More man pages.
wdc(4) on isapnp(4).
inetd(8)-started daemons should syslog(3) on startup failure.
wdc(4) on pcmcia(4).
More sparc keyboards in kbd(1).
rc.shutdown(8) manpage.
Add fpuparseln(3) to -lutil.
First cut at isapnp mpu, and ym mpu.
Document and complete skey(1) support in telnet(1).
Correct os_mask handling in OLF execve code.
Accommodations in the vm system for backward growing stack architectures.
Do not cache page tables on microsparc1 either.
Many more man page fixes.
Support floating accent and compose in sparc kbd driver.
libpcap 0.4 changes brought in.
In pcap library, fix pcap_open_offline() to handle snaplengths of -1.
Fix a memory mishandling in mixerctl(1).
Further fixes for some strange wss isapnp variants.
Create /var/db/host.random at install time.
Complete /etc/rc.shutdown support in reboot(8) and shutdown(8).
Lock ARP entries to an interface, and provide more diagnostics.
Import of PCI ATA/IDE stuff from NetBSD.
Retire libm_i387.
Remove some shared libraries that are better used in static form.
Support non-US sparc keyboards using kbd(8) command.
At execve() time, clear the P_NOCLDWAIT flag.
egcs 990629
Finer timing interval and standard deviation additions to ping(8).
Add pci_mapreg*() interfaces.
Implement more linux compat ioctl's.
Undo recent tcp_input changes which caused crashes.
Fix panic bug in readdisklabel() on several architectures.
Improve IPSEC SA hashing function.
New mii code that does async negotiation.
Default ksh(1) and sh(1) to emacs editing mode.
Generalize bc wrapper program.
Move /etc/host.random to /var/db.
In ipsec, demand keying for PF_KEY.
In disklabel(8), put in check for architectures that require partition a to start at sector 0.
For sparc svr4 emulation, put sun4X CPU class into SVR4_SI_PLATFORM.
pdksh-5.2.14
Introduce fdremove() kernel API; makes fdalloc() faster by making sure fd_freefile is correct.
Some small improvements to adduser(8) and rmuser(8).
pcmcia wavelan driver, wi(4).
Extend pcmcia IO space.
ncurses-990710
Fix a SIGSEGV in vi(1).
Many man page improvements.
Newer version of isakmpd(8).
Support PAGER properly in pkg_install(8).
SECURITY ISSUE: Fix an ipsec_in_use out-of-sync condition. A patch is available.
Add support for TCP MD5 (RFC 2385) option called TCP_SIGNATURE used for authenticating BGP sessions.
Support SIGUSR1 in init(8), used by i386 keyboard halt code, and make init(8) smart enough to run /etc/rc.shutdown
On i386 pcvt console, have CTRL-ALT-DEL sent a SIGUSR1 to init.
Improve ipf.conf file parsing in ipf(8).
New -q option for tar(1).
ncurses-5.0-990703
For identd(8) token support, constrain characters in the tokens more.
Have the resolver ignore SIGs in the answer section for now.
Many more man page tweaks.
Use getprotobynumber(3) in fstat(8)
SVR4 emulation fixes to systeminfo() system call.
m_apply() function permits a function to be run on an mbuf.
lmc(4) T1/T3 driver.
tzcode 1999d.
Support nullfs in fstat(1).
More man page improvements.
Fix a bug in savecore(8).
Add joliet support to the iso9660 filesystem.
Improve libm man pages.
Split out more crypto algorithm knowledge from the actual IPSEC engine.
Fix bpf attachment of bridges.
Fix arc4random(3) to still work correctly inside a chroot space, by adding a sysctl somewhat equivalent to /dev/arandom.
Permit tcpdump(8) of address-less interfaces.
ncurses version of tput, finally.
More man page improvements.
Improvements to many pci ethernet drivers.
ncurses-5.0-990626
Add net_addrcmp(3) to libc.
Add getaddrinfo(3), getnameinfo(3), if_indextoname(3), if_nameindex(3), and if_nametoindex(3) to libc.
In ksh(1), avoid reusing fd 0-2 even moreso than before, since ksh caches open files.
Improved SYSV shared memory support.
ESS audio driver.
Move sparc bootblocks in memory, because possible kernel sizes have gone up.
rangelan2 wireless network pcmcia driver.
Split out ipsec crypto transform handling.
egcs 990608
Return to UDP NFS until TCP NFS is properly fixed.
Fix breakpoint continues on the sparc.
Constrain strlcat(3) from walking past the specified length.
Fixed overflow issue in edquota(8).
Fix PIC label handling code in i386 as(1).
ncurses-5.0-990614
Handle multicast packets in ipf, too.
pdksh 5.2.13.7
Improvements to units(1).
In c++ mode, define NULL to be __null for better type checking.
Remove TCPCOOKIE stuff, which never worked in differentially SYN-filtering environments.
In various programs, handle PAGER environment variable according XPG.
Some large partition fixes in scan_ffs(8).
Bump maximum number of sockets in X server to 128.
Return ICMP_UNREACH_PROTOCOL for unimplemented protocols.
Fix an ipsec tdb_delete() bug.
Replace pipe() in libc and kernel with new version which does the data copy in kernel, making EFAULT possible.
Do not leak file descriptors in socketpair(2).
Propagate more build variables in the gnu sub-tree.
Add struct sockaddr_storage per RFC2553.
Drop a volatile into the ncr(4) driver; who knows how it worked before.
Crank sparc DFLDSIZ to 24MB.
Make adjtime(2) return an EFAULT for a bad olddelta ptr.
Permit non-broadcast replies in dhclient(8).
ncurses-4.2-990605
In sed(1), make 'G' create a newline if the hold buffer is empty.
Add dot_quad_addr_new() API to libwrap, which uses inet_aton(3) instead of inet_addr(3), and hence can handle masks of 255.255.255.255.
Sparc cs4231 audio support (SS5 audio).
Use inet_aton(3) instead of inet_addr(3) in many programs.
Use mkstemp(3) in httpd(8).
In the resolver, permit '/' in CNAMES to PTRs, same as forward references permit.
Use __builtin_next_arg() for va_start(), on i386 and m68k, to handle unaligned stdarg processing.
Support subject inclusion in vacation(1).
In ipnat, decode interface aliases before hostnames.
Handle misaligned file struct's coming out of the KERN_FILE sysctl(3) call.
More isakmpd(8) improvements.
Use auto mode by default in ukphy.
Avoid gcc fixinc (We do not want to run it, and even 1 second of machine time skew would screw up the previous avoidance tactic).
Another memory leak fix in the ipsec kernel code.
Change struct statfs use in the kernel, so that mount(8) can print more info.
For NFSv3, prefer TCP connections.
Fix a few more mkstemp(3) checks.
Make install(1) compare work for files > 8G in size.
Tons of man page improvements.
For crontab(1) and vipw(8), check file size change as well as mtime to detect change.
Better headphone/speaker handling in am7930 driver on sparc.
Implement DLT_RAW, DLT_SLIP, and DLT_PPP in bpf
egcs replaces gcc
Some improvements to the libc_r threading code.
Further keynote documentation improvements.
Move bsd.port.mk and friends into the ports tree.
On hp300, handle hil configuration more robustly.
Numerous -mandoc man page upgrades.
Permit mixed PIC/pic relocations on the sparc.
Change bridge code to use a NETISR. Significant performance improvement.
Set close-on-exec flag in vi, on files that are opened.
*NULL dereference in wall(1).
Permit threading using libutil/pty.c
Fix exit code in sa(8).
Dynamically allocate memory in sort(1), so that -k has no limit.
Correct handling of out-of-window SYNs in our TCP code.
Fix poll(2) return value.
Add Keynote trust management system.
Support mac68k Classic II video.
swapctl(8) and the necessary kernel support.
Longer delay in the i386 pms(4) probe routine, for Thinkpads.
Correct some DTR handling in pccom(4).
Add -p flag to encrypt(1).
Newer version of bktr(4) driver.
ncurses-4.2-990516
Correct some realloc(3) misuses in the fts(3) routines. A patch is available.
Add xe(4) xircom ethernet driver.
Add support for static arp entries that cannot be overwritten.
Many man page fixes.
Numerous performance and reliability fixes to isakmpd(8) and IPSEC.
Some more pthreads fixes.
Fix blowfish CBC mode.
Fix some more ipsec and tcp interaction bugs.
In vmstat(8), increase width of -i field.
Final unicast check ethernet driver fixes for bridging.
Fix bounds control in msgs(1).
Fix 'X' check in gcc printf format checker.
Fix divide by zero in libcurses.
A reliability patch for TCP over IPSEC ESP tunnels. A patch is available.
Improvements to the ss(4) driver.
Fix various endian related problems in nm(1), ranlib(1), strip(1), and size(1).
Do not rotate kerberos logs using newsyslog.conf
Fix xxsize() routines so that they do not call xxopen() and xxclose().
On i386, handle apm segments in low memory.
Add libcurses++.
ncurses-4.2-990424
More improvements to isakmpd(8), and ppp(8).
In sparc cgsix(4) driver, turn off sync so that monitors will go into standby.
Various improvements to the xl(4) driver.
Repair TIOCFLUSH use in telnet(1).
Fix an unlink related bug in cp(1).
For sparc, delay in CPU-forced power-down, so that serial port output does not get garbled.
Move perl lib files to /usr/libdata/perl5.
For make(1), permit embedded : or ! in target names.
Better range checking in inet_addr(3) functions.
gzip 1.2.4a
Support Vadem pcmcia controllers.
Add 3p man page sub-tree for perl pages.
In ls(1), defer conversion for non-printables till after symbolic link lookup.
For msdosfs, do not require the boot signatures in a filesystem.
Add support for new pipes to fstat(8).
Newer version of AFS code.
perl5.005_03
Y2K improvement in shutdown(8).
solve blocking daemon problem in ftpd(8).
Check for failure of strdup(3) in pax(1).
Greater care in tail(1), when going backwards.
Add wdt(4) driver for Industrial Computer Source PCI-WDT50x watchdog timers.
Implement -U username in ps(1).
Add "verbose" command to boot_config(8).
Check correct argument in sliplogin(8).
New kernel hashinit().
More ppp(8) improvements and bug fixes.
More isakmpd(8) improvements and bug fixes.
In calendar(1), fix offset bug for yearly events.
A reliability patch for ext2fs. A patch is available.
Repair a mis-handling of non-terminated utmp strings in w(1).
m68k optimized asm version of strlcpy(3).
Do not accept incoming packets on a down interface.
More strict isapnp detection for the isa ep(8) cards.
kcore handling for the m68k ports.
A serious reliability patch for the powerpc port, regarding traps and signals. Patches are available.
Support power-down mode in the mac68k port.
Fix a retransmission problem in tcp_newreno.
Fix a sequence wraparound bug in very large tcp transfers.
Greater care with arguments in pwd_mkdb(8).
Support the -susv2 macro in nroff tmac doc-syms.
Save a copy of the dmesg(8) output in /var/run/dmesg.boot.
Improve ddb ps output.
Repair filesystem mounting failure message in mount_msdos(8).
Merge IP-in-IP tunnel code so that both MROUTING and IPSEC versions work together, properly.
Do not let calendar(1) assume that it is run as root.
Fix /tmp cleanup code in lynx(1).
Move ipfstat(8) output files to /var/run to avoid a race.
Reenable TCP_SACK and TCP_FACK, so that development cycle can test them sufficiently.
Various man page fixes.
Various isakmpd(8) fixes and improvements.
Fix probing of ISA ex(4) cards.
More amiga keymaps.
Add yyfix(1), from 4.4BSD.
Merge mkfifo into mknod, so that mknod ends up having support for the -p option.
Fix a output buffer overflow in msgrcv(2).
Fix odbm support and permit opening a zero-length hash file.
new true awk, April 16 release.
Support sparc xbox sbus expansion box.
Bug fixes to sparc spif(4), hme(4), be(4) drivers.
Updated distrib/notes which shipped with the 2.5 release.
--------
Changes made between OpenBSD 2.4 and 2.5
2.5 source tree frozen.
Fix ln kernel bug in vfs_lookup.c. A patch is available.
Fix ipf return-rst panic bug.
Add a -q flag to newfs, so that it does not print out information about the superblock backups. This is used by the install process.
Do not permit any IPSEC code unless the admin has enabled it using sysctl.
More ISAPNP devices.
Do not permit local address spoofing using ip4.
Do not permit ip4 tunneling unless the admin has enabled it using sysctl.
More man page and games fixes.
Significant improvements to disklabel(8) and the install procedure.
For CD support, if READ_CD_CAPACITY fails as it does on some units, provide nice defaults so that other things do not fail later.
Rearrange default interrupt ordering for pcmcia somewhat more.
Improve multicast handling in /etc/rc.
Silence initgroups(3), it should not spew to stderr on failure.
sudo 1.5.9
Numerous ipsec changes, further making isakmpd useful, etc. etc.
Support hostname.bridge* files.
Support some 100Mbit ne2000-like pcmcia cards.
Further Qlogic ISP support for PCI and sbus versions..
Add ssl log rotation to newsyslog.conf
In sun4m trap handler stubs, rd %wim which makes viking CPUs much happier.
lifetime expiration notifications for the IPSEC stack.
PF_KEYv2 support in isakmpd(8).
In kvm_mkdb(8), better fallback from /dev/ksyms to /bsd if there are problems with nlist(3).
Fix in6 dependence in various netinet header files.
Tail anchor search in makewhatis.sed, so that overwritten titles are dealt with right.
Fix a problem regarding "\r" translation in talk(1).
Some more games fixes.
Workaround sun4m STP1020A errata #148494 regarding cache initialization.
In ipsend(8), do not crash if no options provided.
Various powerpc fixes, including further PIC support, and fix a kernel pmap crash.
SECURITY ISSUE: In poll(2), constrain the nfds parameter better, so that kvm starvation is less likely. A patch is available.
Make at(1) easier to use next year (ie. Y2K issue).
SECURITY ISSUE: Fix TSS fault handling. A patch is available.
In the ncr(4) driver, disable tagged queuing by default. Our filesystems and vfs layer is not prepared for this play-it-loose behaviour.
Repair ypwhich -h support; it was broken when running on non-server machines.
Add non-learning and non-discovery modes to the bridging code.
Many more man page fixes.
Do not allow users to mount umapfs, even if root chooses to permit kern.usermount activity.
termtypes database version 10.2.7, with our local modifications.
Many more non-standard isapnp devices.
On various architectures, more default swapgeneric swap devices.
If an MFS IO is successful, set b_resid to 0, so that vnd support works.
Add find -W support for white-outs.
Brand new version of the isp(4) driver for SBUS and PCI.
Ensure that sb(4) devices have at least one drq; thus not falsely probing one particularly stupid isapnp sb-like device.
ncurses-4.2-990316
A nice ssl(8) man page.
Various changes to the ssl install, so that /etc/ssl contains nicer default files.
Various disklabel(8) improvements and bug fixes, so that our 2.5 release will be easier to install.
Bug fixes to the tx(4) driver.
In /etc/daily, do /tmp pruning with a find -x so that sub-mounts do not get trashed.
Add a f.startwm function to twm(1), so that it can start other window managers.
On sparc cypress CPUs, do write-through instead of write-back caching.
In netstat(1), print subnets containing 0 octets correctly.
Fix an NFS bug which previously caused free()'ing of negative lengths.
ncurses-4.2-990314
In disklabel(8), permit "delete *".
Make ifa_refcnt a u_int, because of very large routing tables.
Kernel scheduler performance improvement.
Numerous more man page repairs.
A start at powerpc PIC support.
Fix atapi cdrom driver bug where last entry in TOC had seconds and frame zeroed.
Fix some more games.
Numerous more bridge improvements.
ncurses-4.2-990307
Turns out the RAMDISK for the 2.4 i386 release had errors for the default NE2000 device driver locations.
wb(4) PCI driver for Winbond W89C840F 100mbit cards.
Fix some more pcidevs and pnpdevs entries -- a few more new devices work as a result.
libpthread goes away, since libc_r now works really well.
Many more man page fixups.
For open(2) with O_TRUNC, both st_ctime and st_mtime are to be updated.
On the P3, disable the processor serial number.
Fix make depend in kerberosIV sub-tree.
On i386, add support for cpuid level 2, permitting L2 cache size probing.
In pkg_info(8), handle unterminated comments.
sudo 1.5.8p2.
Make sure httpd(8) works when the RSA SSL library is not installed.
In mountd(8), fix a parsing error for the file /etc/exports.
Man page clarifications for strncpy(3) and strncat(3), which people continue to misuse.
Fix another ipsec bug.
More bridge(4) tweaks.
Support -- argument separator in less(1).
Merge cap_mkdb(1) and info_mkdb(1).
Fix RAMDISK sizing problems on i386, alpha, and sparc.
Fix a DNS stall problem in login(1), related to AFS.
A couple of ipsec pfkey fixes.
Handle bogus priority specifications in renice(1).
Improve compress performance in compress(1).
Handle cs4232 isapnp cards better.
Fix various source-tree Makefile build-twice bugs
Fix a bug in cvs(1).
In calendar(1), correctly handle yearly events occurring on fixed weekdays in all cases.
Make more ethernet drivers bridge-aware.
In talk(1), print fatal errors to stderr after curses has terminated.
De-inline vnode_if stubs. This saves 120K in kernel size.
Fix another coredumping case in Kerberos kadm library.
Fix uninitialized variable bug in install(1).
Implement RFNOWAIT with the exact same semantics as Plan9.
Track SATYPE regs per PFKEY socket.
Fix skeyinit(1) -n without an argument.
Fix some panic cases in raidframe(4).
Fix NFS3 NFS3ERR_JUKEBOX panic bug.
Some ipsec error return patches.
Other man page repairs..
Add significant detailed information to select(2) manpage, which will help people not repeat mistakes others have made.
Document timer{clear,add,sub,cmp,isset} in the getitimer(2) manpage.
isapnp wss(4) support.
curses 4.2-990301
SIGINFO support in fsck_ffs(8). Try ^T during bootup.
Support stand-alone "up" command in /etc/hostname.* files, for bridges and such.
led driver support for Sun4 machines.
Revamp some bridge(4) ioctls.
Add mod_ssl 2.2.3 support to apache 1.3.4.
Rename disklabel -p flag to -d, and document for the first time.
apache 1.3.4
cvs 1.10.5
Incorporate extensive configuration work done on egcs, into our gcc tools.
Fix infinite recursion bug in libkafs, which hit during login(8) if DNS was dead.
On boot media, if swapon(8) exists on the install floppy, attempt to add swap early during install.
Rename OpenBSD 2.4 to OpenBSD 2.5 -- we are moving into 'release mode'.
Divide by zero bugfix to netstat(1).
Some fixes to the pkg_*(8) tools.
Add more isapnp card identifiers.
Fixes to the rl(4), pn(4), mx(4), xl(4), and tl(4) PCI ethernet drivers.
Many ethernet drivers were doing an packet ownership check which prevented bridging from working, and was better done in ether_input().
network bridging support. The packets go through ipf(8) on their way to delivery. See bridge(4) and brconfig(8).
Some nfsd(8) and nfsiod(8) changes.
Support the PNIC2 PCI ethernet controller in pn(4).
Many many man page fixes.
In ipsecadm(8), warn if DES or skipjack are used.
isakmpd(8) update.
newhashinit() kernel interface replaces hashinit() interface, and permits non-blocking malloc operation.
Begin uvm import.
Some man page improvements.
Move ls(1) into ftpd(8).. directly.
In setproctitle(3), if sysctl(2) fails do not crash.
Constify getcap(3) API.
For the i386, fix /boot argument mapping. A patch is available.
Put skipjack in libc.
Continue squishing new bugs in new ipsec PF_KEY code...
Fix autosetting of d_type and _dtypename in wd(4).
SECURITY ISSUE: Fix the nlink overflow in FFS and EXT2FS. A patch is available.
Add zegrep(1) and zfgrep(1).
Change IPSEC stack to support PFKEYv2.
PentiumIII detection.
Fix two bugs in ifconfig(8); do not configure an address if not specified, and complain if more than src and dst addresses are specified.
Fix another ping bug regarding payload alignment.
Fix -R option in inetd(8).
Fix send file function in cu(1).
Some man page fixes.
ncurses 4.2-990220
NRL netinet6 compiles now.
Two new kinds of rl(4) and vr(4) ethernet cards.
Better promisc and multicast handling in sparc hme(4).
Fix an rdist(8) bug.
Handle powered-down xl(4) cards better.
SECURITY ISSUE: Fix an overflow in ping(8). A patch is available.
In fork(2), always spare 5 last processes for root.
Better vis(3) support in savecore(8).
Quiet apm(4) and add machdep.apmwarn sysctl.
Fix endian-bug in the blowfish routines.
Various vis(3) related overflows (by one char).
First step at supporting >2G files in less(1).
Add -x, -p, and -m options to ls(1).
In ld(1) and ld.so(1), do not optimize the search path when dealing with duplicate shared library names (even though both alternatives have problems).
Fix an kernel ipf bug relating to out-going icmp.
SECURITY ISSUE: Fix an ipq race in ipintr(). A patch is available, which must be applied after the maxqueue patch has been installed.
Allocate u-area early in fork1(), instead of vm_fork().
Fix msdosfs bug regarding corrupted FAT32 root directories.
Improve vfs lkm interface.
sudo 1.5.8
Make vm_page_alloc_contig() a standard VM system function.
Fix DES weak key checking in libdes (and netinet/libdeslite).
Improve the ipsec(4) man page.
Fix netstat -A header.
SECURITY ISSUE: Improved fragment flood protection in the IP layer. A patch is available.
IPSEC skipjack support (do not bother using this unless you are .gov or .mil).
Check sub-regions better in subr_extent.c, which affects pcmcia.
Add -f option to comm(1) for case folding.
Some more man page fixups.
In traceroute(1), do not permit normal users to set the source address as non-local.
Make quoted strings work in the interactive mode in restore(8).
Fix a padding byte in ipsec esp new.
Use new pipe code on all architectures.
Some man page repairs.
Fix SIOCGIFCONF code in ypbind(8).
New raidframe code.
Improgve promisc/multicast support in a few sparc drivers.
Merge changes from db.1.86 (but do not merge new hash code, since it has an incompatible format)
Handle kernel malloc() failing, for TCP SACK block allocation.
Do more careful system call range-checking and introduce socklen_t.
Fix a bug we introduced before 2.4 shipped: readv(2) and writev(2) with iov_len == 0 is legal. A patch is available.
Fix a pcmcia mapping bug regarding address space allocation.
For wds(4) and ex(4) drivers, unmap address space if probing fails.
In ipsecadm(8), verify that keys and IVs are specified in hex.
Document that MD4 is pretty much broken, and MD5 is looking pretty bad too (so much for quality designs from RSA).
SECURITY ISSUE: i386 T_TRCTRAP DDB handling could cause a system crash. A patch is available.
tcpdump(8) out-of-range access in LLC decoding.
Flesh out the vpn(8) manpage.
Add old dbm-compatible interface code, from db-1.86
Support Return-Path: in vacation(1).
Network byte order for default lease time in dhclient(8).
Uninitialized memory in ktrace(2) system call.
Fix 88k support in libgmp.
Make types(5) more useful.
ncurses-4.2-990206
Correct various freebsd/linux emulation issues.
Correct directory entry reads for numerous binary emulators.
SECURITY ISSUE: Better RST handling in tcp input. A patch is available.
BeOS/i386 support in fdisk(8).
Two more nop instructions in sparc locore.s for greater reliability on Viking CPUs.
Pluralization fix in rup(1).
Much more mvme88k support. The port is coming alive...
In ftp(1), if http fetch returns less than Content-Length, error out.
gcc/binutils/ld support for mvme88k.
Fix cua device handling in com(4) and pccom(4).
Handle MNT_NODEV in nullfs.
Correct a tcp ISS bug.
Support sparc bootpath handling in qe(4) and be(4).
hp300 X in the 2.4 release has an installation issue. Further details available.
Fix isa_check_intr() support on the alpha.
Fix breaking support in fold -s.
Improve long line support in hexdump(1).
Improve some ipf-related man pages.
Fix a server-side NFS issue for the alpha.
Sendmail 8.9.3.
ipf 3.2.10.
Dynamically allocate some buffers in rdist to reduce memory footprint on directories that contain many hard-linked files.
Some other random netinet fixes.
Do not count ipsec related "route misses" as routing lookup failures.
Support MSG_BCAST and MSG_MCAST in recvmsg(2).
Allow higher uids in adduser(8).
Make h2ph grok hex constants with suffixes, exponential floats, and the [fF] suffixes.
Add '-p pattern' option to split for matching with a regexp.
More man page fixes.
Increase size of routing statistics variables.
More info from rarpd in -d (debug) mode.
${CC} and ${COPTS} were not always getting passed in Makefile.bsd-wrapper.
tail(1) and wc(1) can now deal with files > 2gig.
xterm patchlevel 91.
Permit non-root users to mkfifo onto NFS filesystems.
Fix AFS on mips.
sparc sbus spif driver (serial+parallel card).
Update curses to ncurses-4.2-990130 and import infocmp(1).
Correct handling of negative fields in df -h.
Fix i386 __asm clobber control, for egcs.
Various fixes to the bt848 driver.
Fix a multiple free patch in ipnat.
preliminary powerpc PIC support.
powerpc destructors were being called twice. Now only call them once.
Add support for more pcmcia cards.
Fix NEWRENO behaviour, which was buggy.
tzdata1999a
Add -b flag to install(1).
For the bootblocks, fix error returns when running in decompressing mode.
Disable i386 bootblocks E801 memory probing test.
SECURITY ISSUE: Fix a select(2)/accept(2) race condition. A patch is available.
Support & username expansion in sendbug, and fix the /tmp race.
Avoid a sendmail DOS regarding huge numbers of header lines.
rmdir(".") now returns EBUSY, as XPG2 says.
pdksh 5.2.13.7
In config(8), order probes according to device attachment, not device declaration.
Many more games fixes.
More man page fixes.
Correct st_blocks for files > 2GB.
Fix mktemp(3) behaviour in gcc(1). It now handles files safely! (Took 2 years to get this security issue resolved).
Many pid_t fixes to the source tree.
PID_MAX has to be at most 32766, due to interactions with sys/compat.
texinfo 3.12
Addition of raidframe.
PNIC ethernet driver.
Kernel threads (ie. kthread).
Fix a varargs related bug in patch(1).
MNT_NOATIME support in msdosfs.
VIA Rhine ethernet driver.
Fix an nfs v3 bug when talking to the pedantic solaris7 server. A patch is available.
Merge other fixes from ksh 5.2.13.6
Add RFNOWAIT support to rfork(2).
Careful strtol() use in make(1).
Fix a vm cache trashing bug.
XFree86 3.3.3.1
More care in getmntinfo(3).
Fix an msdosfs bug.
Driver for Macronix 98713, 98713A, 98715 and 98725.
Check for more possible divide-by-zero cases in disklabel handling.
Fix a display bug in tetris(6).
Make lpt accept polled mode when its interrupt is unavailable.
uint*_t types from newer POSIX standards.
Delay irq allocation for the i82365 pcmcia chipset -- we want better interrupts to be given to pcmcia cards.
Import of NRL IPv6.
new airports database.
Fix an apm bug for halt -p.
Update CellServDB.
In syslogd(8), be careful about sun_path termination.
Avoid kernel divide-by-zero panics in disklabel handling.
newsyslog(8) no longer needs to care about MAX_PID.
In find(1), correct ! handling in parenthesis
In strftime(3), document what an ISO 8601 year is. It's not what you think it is..
In rdump(8), use TCP_NODELAY for a significant performance enhancement.
Fix nsphy(4) MII driver to work on finicky hme(4) driver.
Put some named files in the right place (post-2.4 bug).
For nfs booting, print addresses using kernel inet_ntoa().
range overflow in edquota(8).
Provide pcmcia IO bus mapper with a list of regions where it should preferentially map new devices.
In patch(1), remove some local functions and use basename(3) and dirname(3) instead.
Integration of NetBSD's MIDI & sequencer support.
Sendmail 8.9.2
c++ does not permit a structure to have a member that is called the same name as the structure (ie. netinet/in.h had struct ip_opts containing a member called ip_opts[]. Fix that.
Fix ${PIPE} uses throughout the source tree (not kernel compiles though).
A few htdocs were missing in our httpd(8) install. Add them.
Some pcmcia fixes.
Correct nested ip_sum in icmp packets.
Correct the values of ip_len, ip_off, ip_id, and udp uh_sum fields for the embedded ip packet inside an icmp packet. (ip_sum is still wrong).
More locking fixes in the vfs layer.
Fix df(1) on NFS v3 filesystems. A source code patch is available which solves this problem.
Crank PID_MAX to 65535.
Do better pcmcia interrupt allocation.
Make ip_id non-repeating random, like DNS id's.
range check signal conversions in the compat layer.
make mount(2) return EOPNOTSUPP for filesystem missing in kernel.
Fix a pcmcia com(4) driver panic.
Many libc_r improvements.
In xl(4), if no MII found, do not panic.
Fix sh(1) and csh(1) builtin kill(1) clones so that they support -SIGXXX.
Activate isakmpd in the build process.
Newer version of isakmpd.
In kgmon(8), let libkvm decide the default kernel name.
Repeat open operations in cdio, in case of slow changers.
SECURITY ISSUE: Even more bootpd paranoia. Updated patches are available for 2.3 and 2.4.
Make sa(8) 64bit clean.
In install(1), handle sparse files the same way pax(1) does.
Replace raw termcap/terminfo databases with new ones based on a common and shared termtypes database. Since these databases had problems in the 2.4 release, updated versions are available.
Permit csh(1)-builtin printf function to have arguments.
Fix a display problem in hexdump(1).
Fix an i386 installboot bug which prevents proper installation when the root partition (or the root partition end) are placed BEYOND the 4GB line. A source code patch is available which solves this problem.
Flesh mktemp(3) manpage out significantly.
Working mvme88k port.
For IPHDRINCL, check ip_hl for validity, too.
Fix goal and max parameters in fmt(1).
Do not believe SS20 machines that claim to have BURST64 support.
In sparc le(3), be more careful about media handling and such.
In ftp, if passive connections fail, try active.
Morse decoding in morse(6).
Numerous fixes to calendar(1), in particular it can now calculate Easter correctly.
Various race/deadlock fixes to umount(2).
More man page fixes.
More isapnp devices.
Fix rand(3) bug introduced into 2.4.
Fix [:print:] in tr(1).
Merge make(1) fixes and changes from other projects.
Consider limits in fdavail().
Fix layer in VFS layer function vinvalbuf().
Fix a tl(4) bug which caused a particular IDE controller to look like an ethernet card...
Increase sparc obio le driver memory to 8K, enhances performance.
Remove itrunc3 panic case: It is invalid code.
fast retransmit statistics in netstat(1).
Many new ISA PNP devices.
Make -ltermcap be -lcurses; and -lotermcap be -locurses, via links.
For kerberosIV, install prot.h (some things require it).
XFree86 3.3.3
SECURITY ISSUE: Fix a remote exploit problem in bootpd (which noone runs anyways, without filtering, right?). This fixes a security problem. Patches are available for 2.3 and 2.4.
In cut(1), avoid an infinite loop.
In top(1), skip disabled swap spaces.
Even more man page fixes courtesy of our local man page repair fanatic.
Fix a crash in ps(1).
Make file(1) understand mp3 formats.
Repair a recent bug introduced with the SACK/FACK changes (only affected the alpha).
Add -C support to our patch(1).
Numerous IPSEC-related fixes inside the kernel and outside.
Many more man page fixes.
In ipf(8), do not crash for bad config file.
Do not permit tapesize estimate overflows in dump(8).
Fix memory leaks in yacc(1), lex(1).
In nslookup(1), fix an bug in some previous overflow handling.
Permit "Total" bar in "systat swap" to shrink.
Fix /tmp race in ctm(1).
Make /etc/security consistant to /etc/mtree for the /var/backups directory.
Fix a gzip bug.
More careful buffer handling in rpc library.
Handle spaced-out arguments in lorder(1).
Since some drivers occasionally return busted d_secpercyl fields to readdisklabel(), do more checking inside readdisklabel() for those ports that run into this issue.
A couple of missing prototypes added.
More man page fixes.
sudo 1.5.7
New getcat(1) manpage.
Serious improvements to libc_r. This is becoming usable.
More careful mmap handling in various device drivers.
Exponential space growth in v?asprintf(3).
More manpage fixes.
Fix a crash of ksh(1).
Ignore out-of-range environment LINES and COLUMNS in libocurses.
In libcurses in the issetugid(2) case, ignore $TERMINFO.
SECURITY ISSUE: In libocurses and libcurses in the issetugid(2) case, only ignore $TERMCAP if it is a path. A patch is available.
Support full set of pty devices in the MAKEDEV scripts.
Make rl(4) match the Accton 1207D cards too.
Prototype getpgid(2)
Handle COMMENTS better in pkg_info(8).
64-bit fixes in TCP SACK.
Fix a bunch of strtol() range check errors.
Improve tty permission checking in wall(1).
NEWRENO, SACK, and FACK support in our TCP implementation. SACK and FACK are enabled by default.
Added adw, the AdvanSys Ultra Wide PCI SCSI controller driver.
Make yacc's skeleton file pass gcc -Wall.
ncurses-4.2-981114
Fix pcvt attribute handling
Fix system() buffer mis-handlings in lynx(1)
Use -lcurses in xterm(1)
Preserve errno in a libutil/passwd.c function
In libm, use write(2,...) instead of stdio code.
Fix an IPSEC SPI mishandling bug.
ncurses based tset(1).
Fix an expression handling bug in as(1).
Improve setregid() and setreuid() emulated behaviour.
ftok() is now XPG compliant.
Put userdir support back into httpd(8). A patch is available.
Put userdir support back into httpd(8).
New daemon: isakmpd (ISAKMP/Oakley ipsec daemon).
Move /tmp/bootpd.dump to /var/run to avoid filesystem race.
Fix some manpages
sudo 1.5.6p6
Fix a remote lockup problem in the TCP packet decoding code. This fixes a security problem. Patches are available for 2.3 and 2.4.
Fix a deadlock in deadfs VOP_LOCK().
Support -p option in ipmon(8).
Change bpf to support full frame-grabbing for FDDI packets.
Support more ISAPNP devices.
A new web page contains a list of hardware that the project could use for our development process.
Newer soft updates code.
More manpage fixups.
Driver for rl(4) PCI ethernet cards (rtl8129/8139).
New phy drivers.
Repair a bad strlcpy(3) manpage error.
Support ftpd(8) running out of /etc/rc
Fix fsck_ext2fs(8) for FIFOs.
Detect and handle dma sbus cards in non-dma sbus slots.
Handle scsi devices which terminate inquiry strings with 0xff.
Fix append mode in freopen(3).
Cache and hash hostnames in ipmon(8).
Improvements to up-coming libc_r code.
Minor possible security fix to xlock(1).
Easter and Y2K leap year fix to calendar(1).
Use optimal xfer blocksize in rm(1) instead of assuming 8K.
Fix a bug in libocurses.
curses 4.2-981017
More man page fixes.
Be sure to enable pci cards that the BIOS forgot about.
Support hppa in rbootd(8)
Merge bug fixes from pdksh 5.2.13.4
Various new ppp(8) changes.
Use correct ioctl for flushing in ipmon(8).
Fix various tcp options bugs.
Fix tcp timestamps.
Repair sparc kvm dump header problem. A patch is available.
More carefully check /etc/hostname.* file contents before using it.
Fix mktemp() problems in lynx(1).
--------
Changes made between OpenBSD 2.3 and 2.4
Fix a bug in the midway ATM driver.
Update numerous documents for the 2.4 release.
Fix another off-by-one error in pax(1).
Addition of driver for sbus 'qe' 4-port 10mbit ethernet card.
Split X shareable files into a separate tar file.
Make tset(1) work with libcurses (before it was libocurses only).
Fix an ipsec panic bug.
/etc/rc startup code for afsd.
In default sendmail config, enforce valid Message-Id to help stop spammers.
Fix a rounding up problem in disklabel(8).
apache 1.3.3
Make clustering work fast even beyond 2GB into a file.
Fix a few ipnat bugs.
Support bt878 and bt879 in the bktr(4) driver.
Driver for the Compaq Thunderlan ethernet cards, called tl(4).
Fix null-function running in ksh.
Support the SMC EtherEZ PNP card.
Support 3c905B-FX cards (fast fiber ethernet).
Support Lite-On PNIC tulip clone chips in the de(4) driver.
Fix SIOCGIFCONF code in ipnat(8).
Import SSLeay-0.9.0b minus the patented algorithms (IDEA and RSA). The DSA certificate handling and other cryptography still remains.
Increase datasize in savecore(8) (as was done in fsck(8) a long time ago).
Fix a readlink(2) bug in ls(1).
Add new DIOCGPDINFO ioctl for disklabel(8)'s new -p option.
Fix a mathematical formula in photurisd(8).
apache 1.3.2
Fix other spoofed labels to contain more real information.
In i386 wd(4) driver, set d_type properly in spoofed labels.
Import learn(1) -- but still disabled.
Add file:// support to ftp(1).
The sparc hme(4) and le(4) drivers had bugs in the 2.4 release. Patches are available.
Fix media negotiation in the SS5/10 le(4) driver.
Fix mail(1) to deal with the changed lockspool(1) protocol.
In lockspool(1), permit root to lock other spools.
Add the AdvanSys narrow PCI SCSI driver, adv(4).
Correct vfs_refcount handling.
In cp(1), for -p flag also preserve the sticky bit.
In tar(1), fix storage of paths that are exactly 100 characters long.
Add smc91cxx ISA support.
Fix more setmode(3) memory leaks.
Continue integration of AFS.
In i386 bootblocks, clear NT bit in bootblocks whenever switching into prot mode.
Undo gzip nlist(3) support for the 2.4 release, will go back in afterwards.
Add optional support for alternate pid files in newsyslog(8).
Repair the license for boggle(6).
Repair a memory leak in mtree(1).
Fix a writer lock miscount in execve(2)...
Workaround a bug in newer versions of the xl(4) cards.
Repair the license for file(1).
Make tcpdump(8) understand SACK (RFC 2018).
Fix a bug in sed(1).
Media support in the fxp(4) driver.
Replace ed(4) driver with the ne(4), ec(4), and we(4) drivers.
In ftp(1), make the progress meter support ttys that do not have the width set.
Support uids > 32000 in adduser(8).
Make sparc and alpha floppies do dhclient, too.
Fix a few tiny sysctl related changes in route(1).
Add support for SMC EtherPower II 10/100 ethernet cards; tx(4) driver.
Tons more man page cleanups...
More games fixes...
Add a -1 option to dhclient: if the dhclient request fails, dhclient should exit.
In top(1), fix pid sorting on the alpha.
Make tar(1) print verbose output to stdout, not stderr.
Repair some badly written short write() handling in ftp(1).
In newsyslog.conf, rotate authlog and secure entries after 1 week.
Kill COMPAT_09 and COMPAT_10 options.
Provide a way for ftp(1) to show a progress meter, but create no other noise.
Media support for ep(4) driver.
Move ifaliases setup upwards in /etc/rc; now named(8) can use ifaliases.
In /etc/rc.conf, add a nice toggle for ntpd(8).
Finish media support on sparc le(4) driver.
buf oflows in restore(8).
Support media directives in dhcp-based /etc/hostname.* files.
Make the xfs system call always exist.
i386 option NO_APMPRINT for quieter apm driver.
Move dhclient-script to /sbin where it belongs.
Fix a panic in SOCK_RAW.
ncurses 4.2-980912.
Quite a number of install script improvements.
if_media support in lance driver.
With the -h option, add token reporting support to identd.
HP ScanJet IIp support.
Print OpenBSD copyright at boot-time.
Create the first version of the 2.4 install floppy, which includes dhclient on it.
ipf 3.2.9.
sudo 1.5.6.
Handle early-interrupting wdc drives which voilate the MMC2 specifications.
Fix recvfrom() MSG_PEEK to work with length 0, again.
Free AFS client integrated into the source tree.
Significant man page cleanups.
Add help(1), which is basically "man man".
in fdisk(8), for large disks, clamp CHS values to 0xffffff and then encode data in the LBA fields.
Neomagic support in X11.
libcurses version 20.3.
Restore chat -s and -S flags, they were lost.
Fix curses library to use all the possible ways of getting it's termcap definition.
More games fixes.
A new and improved more capable pcmcia code-base.
Support intel 82365SL pcmcia chipset.
Add aic6360 pcmcia support.
new sm driver -- SMC 91cxx ethernet chip support. Common pcmcia chip.
Fix error handling in bootblock filesystem detection code.
Fix a recently introduced bug in nslookup(1).
Fix mips constructor init/fini operation in ld.so.
Fix a signal race in mail(1).
Nice way of handling dhcp at boot-time.
Fix a bug in RMD160.
Make xl(4) driver work on the alpha.
Make the pci de(4) driver finally work fully on big-endian machines.
Fix a hanging-race in mail(1).
zlib 1.1.3
Fixes to the pkg_install tools.
For i386 pcvt, better keyboard timing code.
Teach fstat(1) AFS.
Add command-line selection of dates other than now to pom(6).
More man page repairs.
Add support for nlist(3) of a gzip'd kernel, only used by savecore(8).
Fix some mis-aligned faults in ppp(8).
Fix a gcc 2.8.1 bug which caused code to be mis-optimized.
if_media support in OpenBSD. Some drivers support it, others do not yet.
Buffer mishandling fixes in nslookup(1) and dig(1).
Make a few programs (time, mkdep, lorder) kill themselves with the signal they trapped, rather than provide an exit code.
Continuing work at integrating the ARLA free-AFS source code directly into OpenBSD.
More games fixes.
Teach libpcap that DLT_LOOP devices have a network byte order header.
Return ENXIO for /dev/mem minor devices which do not exist.
uuencode/uudecode get a new -p option.
ppp version 2.0 (MPP)
Make blowfish character interfaces work on unaligned-access-faulting hardware.
Another fix for i386 ptdi panic, in procfs.
Handle the MediaGXm processor.
Buckets of scanf-style overflows in nslookup(1) and dig(1).
Change protocol argument of pmap_set() to be u_int.
Newer version of Kirk's softdep code.
Fix fxp(4) for the alpha.
In the libc/db sub-library, sanitize memory that is being sent out to db files.
Fix a dlopen() bug in ld.so.
Numerous man page cleanups.
Add big-endian 21040 support to the de(4) driver, so that powerpc can use it.
Fix a premature free() bug in libpcap.
Install dhclient-script(8).
In ttyname(), reinitialize the tty buffer with the "/dev/" prefix each time.
More fixes to rpc.pcnfsd(8).
Fix a crash in csh(1).
Sparc qec/be 100mbit ethernet driver.
Support \e in printf built into csh, and document it too.
Significant progress in the powerpc port.
Fix a panic bug in the routing socket.
Better media support in fxp(4) driver.
In kvm_open(3), try /dev/ksyms before /bsd.
Add /dev/ksyms support the kernel. This emulates a fake a.out which has the kernel's ddb symbol table attached to it.
Change savecore(8) so that it tries /dev/ksyms before /bsd.
cvs version 1.10
More improvements to all the games.
Fix new blowfish functions to work on big-endian unaligned-access-faulting architectures.
Fix a malloc race in all filesystems.
More rpc.pcnfsd(8) changes. Again -- do not use rpc.pcnfsd.
Correct readlink(8) in adosfs.
Newer code for the fxp driver.
Change nlist(3) and kvm_mkdb(8) to work with the upcoming /dev/ksyms.
Fix an encryption-related bug in telnetd.
Support -o in top(1).
Add -q flag to mtree(1).
In cfmakeraw(3), also clear IMAXBEL.
realloc fixes to X11.
ecoff support in nlist(3).
In the nfs code, repair non-ANSI code that got incorrectly optimized on some of our architectures.
Many more realloc fixes.
More buf oflows in rpc.pcnfsd(8). Noone should use this code.
Fixes to numerous games.
Fix some important kvm_mkdb(8) bugs.
Add apm and dhcp starting chunks to /etc/rc and /etc/rc.conf.
For the i386, save more battery power by halting the CPU during the APM loop. This affects a part of the pctr driver...
In xterm(1), support VSTATUS.
Add *_ptob() and *_ptob() functions to architectures missing those.
Some updates to talk(1).
Add ISC dhcp to the source tree. This urgently needs a security audit.
Fix df -P for zero-sized filesystems (ie. amd(8)).
Fix FFS data-buffer leaking on segfaults during write.
Make i386 registers get saved correctly in a crash dump.
In /etc/security, do not include fifo's in setuid check.
Fix g++/FlexLexer.h support in lex(1).
Numerous more realloc fixes.
Separate mail.local(8) into two programs: new one is lockspool(8). mail.local is no longer setuid. Ensure that your /etc/sendmail.cf Mlocal line contains an 'S' at the end of the F= field, or local mail delivery will fail.
Add openbsd.m4 OSTYPE to the sendmail cf directories.
Fix numerous incorrect uses of realloc() in the system libraries.
One final fix for the chroot code in named(8).
update to sendmail 8.9.1a.
Fix fdformat(8) exit code.
Fix an incorrect detection problem in aha.c.
buf oflow fix to new rdist (no security effects).
Fix strtod(3) so that it is valid actual C code (ie. and doesn't generate bad code when optimized).
In hexdump(1), detect a format string of all spaces as bad.
Prototype poll().
In gprof, permit $ in symbol names.
Fix coredump in find when doing find . !
Add ECB and CBC encryption for octet streams to blowfish.
Fix base64 encoding in bcrypt(3).
Fix scon(1) to permit -d and -c to work together.
In i386 vt console driver, wait for ACK back from keyboard when setting typematic rate.
update to zlib 1.1.3.
Fix atime and mtime commands in fsdb.
Don't wrap 80 characters in rup -d.
Add russian message catalog.
Protect against SIGPIPE in fdisk(1).
Fix interrupt disabling in pms(4) driver.
Remove kill(-1, 0) code from reboot(8) which does not work exactly as intended.
Correct exit code of ls(1).
For dump, further improve the semantics for "filesystem not in fstab".
More work on big-endian support in the ncr(4) and de(4) drivers.
Support mem-mapped com ports on powerpc.
Support gdb, ptrace, and /proc on the powerpc.
Do not use libiberty version of vasprintf, since it is quite busted.
Make the powerpc install floppy work once more.
Support PAGER environment variable inside disklabel 'M' command.
Repair umapfs.
Repair portalfs.
Repair some kvm man pages glitches.
Genericize some internal vop functions to fix some NULLFS problems.
At attach time, print a single line for the geometry in wd(4).
For sendmsg() and recvmsg(), return EMSGSIZE not EINVAL for msg_iovlen <= 0.
Add the IOV_MAX define as required by XPG.
Fix a few more resid issues in the kernel.
Hack SIOCGIFCONF so that ifc_len=0 is a length inquiry, as in Linux.
Install perl .ph pages in the right directory.
In ftpd(8) manpage, fix the definitions of the high ports since the kernel definitions were changed.
Fix an argument parsing bug in chat(8).
Fix isapnp ym(4) audio driver.
Update to ncurses-4.2-980801.
Use SO_REUSEADDR in lpd(8) in case it is restarted by hand.
Crank tun(4) MTU to 16K.
Set the close-on-exec flag in two descriptors owned by chpass(8). This fixes a security problem. A patch which solves the problem is available.
Improve ipsecadm(8).
Fix some ipsec bugs related to IP-in-IP.
Fix some disklabel(8) bugs.
Fix some lint(1) bugs.
Make dump(8) work against filesystems not listed in fstab(5).
Rename libtelnet functions getent and getstr to avoid curses conflicts.
Disable all ISA PNP devices before doing the ISA scan. This works around BIOS's which pre-map ISA PNP devices into known locations.
Correct panics and EINVAL returning cases in iovec using code. A patch for this problem exists.
Fix battery remaining support in i386 apm.
Add i386 apm(4) manpage.
Fix mkstemp() calling code in libc/db/hash.
update to ncurses-4.2-980725.
Use a single-char buffer in snprintf() for the size==0 case.
Fix some problems in disklabel -E.
Fix bugs in pom(6), atc(6), quiz(6), hack(6), adventure(6).
Add tic, captoinfo, and infotocap from ncurses-4.2-980718.
Place a timezone file in the named chroot jail.
ncurses-4.2-980718 with our termlib library integrated. The separate termlib library no longer exists (although for a time libtermlib is a link to libcurses).
New libform, libmenu, and libpanel from ncurses-4.2-980718.
Change latencies permitted for certain scsi tape commands.
Make mt status show more information on scsi tape drives.
bt848 driver for the i386.
Fix MKD command in ftpd to properly show the path created.
Build mpool(3) manpage.
Support 8.4GB+ IDE drives.
Fix a serious TZ calculation error in the CD9660 filesystem which caused CD filesystem timestamps to be completely wrong.
Document LD_PRELOAD in ld.so(1) manpage.
Sparc cua support in the zs driver.
Add CAST encryption to libc.
More verbosity changes to apmd(8).
Make /var/backups mode 700.
Fix a crash in asa(1).
Fix usage messages in sort(1).
Fix sparc installer to deal with a dirty dmesg buffer.
Make SEM_R and SEM_A accessible to userland in sys/sem.h.
Do not permit uppercase login names in adduser(8); that's a bad default.
Fix a bug in less that prevented keypad keys from working on some terminals.
In the man(1) manpage, document -k and -f.
Rename curs_terminfo(3) man page to terminfo(3).
Make the ramdisk driver not force single-user if it is the root device.
Quieten the i386 apm driver.
Fix /tmp race in a man page example. (Sigh.)
isa_intr_establish() will never panic. It can return NULL for failure.
Split sparc hme driver into chip and board specific; be driver should not be far away now.
rpc.yppasswd(8) has no log file; fix docs.
Update to Lite2 getenv(), which returns NULL for getenv(NULL).
Fix a problem with the PCI ncr(4) driver if many scsi devices were in use.
Improve db cache sizing heuristic in pwd_mkdb(8).
Close a file descriptor leak in inetd(8). A patch which solves the problem is available.
Fix dump(8) to return exit code 1 for startup failures, as documented.
Improve performance of getpwent(3) in a YP environment.
Improve performance of pwd_mkdb(8).
More buffer overflow fixes in libpcap and such.
Fix "mount /mnt /mnt" so that it does not panic the machine.
cvs 1.9.28.
Fix locking code in unionfs. This fixes a serious problem in unionfs. A patch is available.
In ftpd, handle non-existent users as login now does -- sleep a while.
In the S3 audio driver, map additional registers at open() time instead of attach() time.
Use SEEK_SET and friends instead of L_SET and such, throughout the tree.
In the scsi cd driver, permit CDs to have up to 99 tracks in their TOC.
For the pmax, get the ld.script file from the right place when building kernels.
For the i386, fix a timing problem that affected keyboard controllers on PII/400 and such machines.
Fix a failure printing message in passwd(8).
Sendmail 8.9.1.
Disable debugging code in crontab(1).
In reboot(8), put more effort into killing processes before taking the machine down.
Fix some problems in sparc national keyboard handling.
Add a no-escape mode to tip which disables the ~ escape.
Fix the bhlcr shift values in the pci code.
Run kernel ppp code at splimp more often.
When pppd(8) is doing connects, cause kernel ppp code to drop packets so that mbuf starvation doesn't happen.
Cleanup more cosmetic uglies in the cd/acd disklabel spoofing code.
Do various cleanups of the various boot(8) pages.
In traceroute(1), change default TTL to be 64.
Fix makewhatis(8) to handle long NAME sections with multiple hyphens.
Provide TMP_MAX in <limits.h>, per XPG.
In /etc/security, improve the checks for "." in paths.
Ensure the acd drivers always return TOC contents in big-endian format.
Keep the "login myname" hack from clearing ut_host in utmp.
sparc hme 100Mbit ethernet driver.
Avoid buffer overflows in quota(1).
Do not call syslog(3) with "\n" at the end of the string.
Permit long names for months in at(1).
Fix various places where hostname buffers were not MAXHOSTNAMELEN long.
In rexecd(8), open stderr port after authentication has happened.
In cdio(1), permit playing CDs with over 100 tracks.
Fix i386 support for PCI mode 1.
A fix for the play command in cdio(1).
On the i386, if securelevels are in use, do not permit PSL_IOPL modification (well... except if the aperture driver is enabled).
Cleanup many gethostname(3) calls in the tree, which passed short buffers, long buffers, mangled buffers, etc.
Fix scorefile handling in robots(6).
In install scripts, treat sets selection of "all" just like "*".
In tcpdump(1), length check bp_file in bootp packets.
For the setuid /dev/null thing in execve(), open fd 1 and 2 as writeable.
In most setgid kmem utilities, revoke privs completely after calling kvm_openfiles(3) (this does not look like any gain in security, however).
Fix a vfork()-style bug in vacation(1).
Fix an off_t bug in quot(1).
In talkd(8), force NUL termination of strings received from client.
New S3 SonicVibes driver.
Make "ndc start" use rc.conf.
Fix ethernet/FDDI IPX support for big-endian machines.
Remove kpasswdd(8) -- use kadmind(8) instead.
KTH Kerberos 0.9.9
Remove mk_cmds(1), e2fsprogs, and libss -- no longer used.
Change gethostname(3) and getdomainname(3) to handle small buffers correctly.
Fix chrtoblk() for out-of-range device numbers.
If strftime(3) runs into the end of the buffer, terminate it nicely anyways.
Support wdc on isapnp.
Profiling support for powerpc.
Enable variable number of rounds for encrypted crypt, as BSDI does. This can now be controlled in /etc/passwd.conf.
Further reduce reliance on DNS in /etc/netstart.
Emulate Linux mremap().
On the i386, add a nop in the 2nd instruction slot because this fools some BIOSs that do virus checking. Pretty clever of them, eh.
On the i386, Fix assembly of the cmov* instructions.
Fix "cp b/ a" for the case when "a" is a directory.
Fix a buggy endian conversion which caused multicast vif statistics to be incorrect.
Add MI mtio(4) manpage.
Using username hashing and a host secret file, improve quality of users' spoofed skey challenges.
Fix a free-before-use bug in fts(3).
Fix fxp driver so that it works on buggy cards.
In make(1), fix bug for targets that began with "." and underwent suffix conversion.
Fix "mv b/ a" for the case when "a" is a directory.
Ensure setuid and setgid processes are not started with fd slots 0, 1, or 2 empty. The previous behaviour has security consequences. A patch which solves the problem is available.
In man(1), when a man page cannot be found in a specified section, indicate which section the failure happened in.
Add new strlcpy(3) and strlcat(3) interfaces for simple bounded string copies.
Add new mkstemps(3) interface which is basically mkstemp(3) but with suffix support.
Fix LED update lockup bugs in the i386 console driver (pcvt). A patch is available which fixes this problem.
Further improvements to photurisd(8).
Fix kvm_read(3) return values.
Overflow fix in ksh(1).
Add isa_intr_check() to lots of isa architectures. Fixes PMS irq 12 bug.
gnu bc 1.05a.
In ppp(8), numerous 64 bit fixes. Requires testing on alpha, please.
On the powerpc, run ofw drivers under better interrupt masks.
In sudo(8), require a password before telling the user whether or not the command exists.
Fix a panic in ipnat(4).
Remove most recent procfs patches relating to securelevels.
Disallow TCP connect() to multicast addresses.
update to rdist 6.1.4 (plus our many patches).
In pcap(3), permit single-character hostnames.
Convert all DLT_LOOP interfaces to have a network byte order u_int32_t header containing the protocol.
Fix a buffer overflow bug in the resolver. The previous behaviour has security consequences. A patch which solves the problem is available.
Fix select() on bpf descriptors.
Update the rc(8) manpage, and companion pages.
Fix at(1) to handle "now" as a valid time.
No luns on RICOH scanners.
Add CISCO netflow protocol to tcpdump(8).
Upgraded sh/ksh to pdksh-5.2.13.
In pstat(1) and top(1), handle the case of no swap partition.
Disable SORT_RESPONSE in named(8).
Support ISOFS in fstat(1).
Correct numerous uses of snprintf(3) throughout the source tree.
In xargs(1), use sysconf(3) to get ARG_MAX
Fix transarc AFS string-to-key functionality again.
Correct status bargraph in fdformat(8).
Fix vm bargraph in systat(8).
Fix some signal bugs in mail(1).
Properly truncate files in mail(1).
Change <sys/ipc.h> to use uid_t, gid_t, and mode_t for types. Provide emulation system calls for the old ushort-based structures.
Fix an mbuf chain corruption bug that affected large amounts of data flowing through ipsec(4).
Fix spelling and grammar in numerous man pages.
Fix a minor bug in mail(1).
Fix a bug in atalk(4).
In tcpdump(8), support DLT_ENC packets.
Make decoded IPSEC(4) packets available to bpf(4) via enc0, using linktype DLT_ENC.
Fix a minor bug in pwd_mkdb(8).
Make the 4th argument of semctl(2) optional.
Add new TCPCTL_IDENT sysctl for identd(8) to use, instead of kmem snooping. Significant performance improvement too.
Add DLT_LOOP to bpf; to handle 4-byte proto headers on some interfaces.
In the kill(2) patch, also permit SIGUSR1 and SIGUSR2.
buf oflow fix in libc/rpc.
In ftpd(8), also permit ftpchroot users to be multihomed.
Various fixes to ftp(1).
Make getty(8) default to 8 bit mode.
Autodetect ATAPI cdrom drives that do not support ATAPI_READ_CD_CAPACITY.
The following patch was deleted later, ignore it: If a process is being ptraced, do not permit execution of an immutable binary, also, if a process is running an immutable binary, do not permit ptrace. This can be a security issue. A patch is available which fixes this problem.
Various fixes to the i386 pctr(4) driver -- previously any user could crash most non-Intel processors. Fixes for 2.2 and 2.3 are detailed here.
Various new smtpd(8) fixes.
Change all modifications of struct sigaction's sa_mask field to use sigsetops(3).
Teach adduser(8) about the /sbin/nologin shell.
Ensoniq AudioPCI driver.
isapnp joystick driver (not tested).
Move named into a chroot space by default.
Fix the RMD160 code once again.
Fix a possible panic due to ktrace(2).
New fixes to the bpp support in the sparc magma driver.
Fix root password setting code in install script.
terminfo/termcap 10.2.3
Fix xdm(1) to close an excess file descriptor it left around.
Permit kill(2) to send signal 0 to processes that are setuid, as long as the existing uid check succeeds.
Change uudecode(1) to accept spaces in the filename.
Move temporary file used by chfn(1) to /var/tmp.
Add support for pcvt to kbd(1).
in chfn(1), unlink the temp file after finished using it.
Fix /tmp use in yacc.
On the i386, grow i386 kernel malloc area by 2MB.
In chfn(1), permit gecos sub-fields to be empty.
Fix sysctl net.inet.icmp.bmcastecho.
Fix an nfs crash.
Tweak IPSEC so that it supports VPNs trivially. A new vpn(8) manpage describes how to use this.
Integrate rt(8) and rtdelete(8) directly into ipsecadm(8).
Make named(8) run in a chroot space.
Integrate XFree86 3.3.2 patch 2.
Fix multi-address support in telnet(1).
Made i386 pctr driver compatible with all CPU vendors.
Added "feature bits" display to i386 CPU detection, and added more AMD and Cyrix processor models.
Modified named to stash its argument vector in pid file like sendmail does and modified ndc to use it. This means "ndc restart" will now restart named with the correct arguments.
bind 4.9.7, with the -u, -g and -t options from 8.1.2.
Handle constant numeric U and LL extensions.
Stop info gathering in uucpd(8).
Various TCP RPC fixes to deal with data streams that could cause lockups inside the library.
Add sparc magma serial device driver.
Install sendmail configuration goo in /usr/share/sendmail.
Fix two cases of incorrect timeout handling in the RPC library.
Add the required setsockopt(2) interface for IPSEC, update photurisd(8) to accept notify messages from the kernel.
Fix numerous uses of MAXHOSTNAMELEN+1 instead of MAXHOSTNAMELEN, and also do the same for other similar cpp variables.
Fix numerous source tree uses of readlink() with an incorrect length parameter.
Install gdb(1) info pages.
New distribution install notes that use m4 instead of cpp for formatting.
In gdb, do not use 4.3 compatibility tty ioctl() calls.
Constrain how kill(2) operates against target processes that are running setuid. The previous unrestricted behaviour may have had security consequences. The 4th revision of a patch which solves the problem is available.
Fix a free() related bug in csh(1).
Fix a memory trashing bug in the IPSEC SPI chain delete function.
Fix acct(2) to work with append-only files.
Fix buffer overflows in getNAME(1).
In mount_nfs(8), contact the portmapper about the correct protocol (tcp or udp).
Correct 64 bit timeval storage in ping(8) packets; also put the time in network byte order.
Start cron at the end of /etc/rc to avoid some security issues.
Compile the system with -O2 instead of -O.
Fix a bunch of scanf related buffer overflows.
Improve XR16C850 support.
Fix less -d option.
Fix i386 divide overflows traps which were possible in the NTP code.
Remove some more incorrect uses of long in kerberos code.
Add a man page for ndbm(3).
As described a few lines above, support even more commands in make(1).
Make the csh(1) command kill more standards compliant.
Improve documentation about how to properly enable YP client databases.
Emulate umask and exit script commands inside make(1) directly, to get closer to the expected behaviour. Later on we may want to emulate more commands, like gnumake does...
Make perl(1) support calls to lockf(3) now that we have it.
Disable dynamic loading in the mips version of perl(1).
Make size(1) work on files created via ld -Z.
A possible new security problem exists if you rely on securelevels and immutable or append-only files or character devices. The fix does not permit mmap'ing of immutable or append-only files which are otherwise writeable, as the VM system will bypass the meaning of the file flags when writes happen to the file. A patch exists which solves the problem.
Niklas is taking a shot at making our cross compiler toolset sufficient for a full cross compile of the vax port.
Fix a file parsing overflow in kdb_util(8).
Make config(8) store the first free unit number in its tables so that pcmcia device re-insertion can come back to the same unit number.
const the parameters to a few more system calls.
Fix 'z' command in mail(1).
Fix short read() and write() operation in the RFC1413 handling code in httpd(1).
Fix some bad uses of sscanf problems in the source tree.
Fix i386 copyoutstr().
Support 16 partitions in the pmax port.
Correct handling of escaped % correctly in crontab lines.
Make the AD1848 and Yamaha OPL3-SA3 sound drivers work.
pppd 2.3.5
Fix localtime(3) support inside perl(1).
Fix a number of disklabel issues in the hp300 and pmax ports.
Enable #pragma pack and #pragma weak support in gcc.
Fix at least one remotely activated buffer overflow in lynx(1).
Add information about more deviant scsi devices.
A security issue exists in 2.2 and 2.3. A lacking test for invalid padding length in IPSEC packets can cause a remote attack possibility if IPSEC is in use. A patch exists which solves the problem. (A similar patch exists for OpenBSD 2.2).
Fix a select(3) bug in syslogd(8).
In the hp300 port, use actual code to determine how fast the 68040 CPU is running.
Add libossaudio(3) to the source tree.
In mail(1), do not attempt to remove a mail spool since directory write permission may not exist. Instead, simply truncate it.
xterm(1) and libXaw contain security issues due to buffer mismanagement. A patch exists which solves the problem. (A similar patch which solves the problem for OpenBSD 2.2 also exists).
Permit relative adjustments in mixerctl(1) using +/- prefixes.
msdosfs in FAT32 mode would hang during a write.
Fix ZIP drive use on the hp300.
Fix a timeout bug in ping(8). (What a troublesome program it is...)
Use inet_ntoa() in a diagnostic in rwhod(8).
Our c++ compiler is called c++, not g++.
Fix iommu flushing on the sparc Microsparc-1 based machines.
Make 'y' command in sed(1) 8-bit clean.
Make ctype macros dealing with unsigned characters properly index into their respective tables.
For 3c9xx drivers, fix a bug where bpf attach caused a change to 10Mb mode.
Fix a bug in h2ph(1).
talk(1) cannot distinguish the host a reply comes from. If it is suspicious, it now prints that hostname in the connection banner.
In oldrdist(8), avoid attempting to create hardlinks between devices.
Permit socketpair(2) to accept PF_LOCAL.
Add audioctl(1) and mixerctl(1).
Merge OSS-like audio code into i386, sparc, amiga, and other architectures.
Teach dump(8) that ENOSPC on remote or local media means end of tape.
Change ld(1) to accept the first matching shared library it finds.
Fix a coredumping problem in oldrdist(1).
Delete old gdb; we use modern binutils everywhere now.
Make ps(1) look at the kernel physmem variable instead of the far uglier thing it did before this change.
Correct utimes(2) emulation in Linux compat.
64 bit cleanups to the uucp subsystem.
Fix a very strange bug in backgammon by using -ltermlib instead of -ltermcap.
Make hp300 use new m68k kcore format.
Completely rewritten fmt(1) with more features.
Run rc.shutdown even if -h or -r was not specified.
Fix the i386 versions of libm's scalb*() functions.
Make strptime(3) handling of month and weekday names case insensitive.
Change 3rd parameter to be size_t as required by XPG.
Let fdisk(8) and disklabel(8) compile if NOMAN= is defined.
Handle truncated reads in dumpfs(8).
Add /var/run/rarpd.pid and syslogging support to rarpd(8).
Fix gcc on the m68k to correctly invalidate cached condition codes when only a-registers are involved.
Fix relative tags in vi(1).
Use mkdtemp(3) in pkg_add(8) and friends.
Add dev command to cdio(1) so that user can change device.
Change tset(1) and /root/.cshrc behaviour so that ^C at the prompt does not result in noglob remaining set.
Improve numerous manpages.
Make last(1) report on the year.
Set d_bbsize and d_sbsize to defaults in the disk drivers.
Do not do gethostbyname(3) on "*" in pppd(8).
Ignore SIGPIPE in reboot(8).
--------
Changes made between OpenBSD 2.2 and 2.3
A security problem due to buffer mismanagement exists in lprm(1). A patch exists.
A security problem due to a buffer overflow exists in uucpd(8) (which is not enabled by default in our releases). A patch exists.
On the i386, fix installboot(8) so it works reliably on various filesystem layouts that did not work before.
Support lots of file descriptors in named(8), for when many virtual interfaces exist.
Fix installboot(8) on the sparc Sun4 models.
In disklabel(8)'s -E mode, set the bootblock sizes so that the hp300 install does not freak out.
In mktemp(3), repair a bug in the filename incrementing loop.
Various other install script fixes.
Fix /etc/fbtab handling in init(8).
Make disklabel(8) mentions IDE (which is an alias for ESDI).
For the i386, have the install procedure ask if the xf86 driver should be enabled by default.
Make install procedure prompt & set the initial root password.
When root logs in for the first time, let him find that he has an interesting piece of mail about how the system works.
Fix ipsec encap notifies.
Configure xdm(1) and the fwvm window manager sensibly enough for default users to not feel utterly lost.
Fix 'u'ndo support in disklabel(8)'s -E mode, and also add a new 'r' command.
Repair the pkg_add(1) sufficiently for the 2.3 release...
Fix a race condition in unmount(2).
Add support for the XR16850 serial chip (128 byte fifos).
mkisofs 1.11.2
Disable console ddb by default. sysctl can re-enable it.
Fix backtraces in gdb on m68k platforms.
Support 3c905B (well, actually, our support falls over. We need a card to do further work).
Modify i386 PS/2 driver to be read/write; this permits new XFree86 source to put mice into advanced modes of operation.
Remove KTH Kerberos "eavesdropping" message from telnet(1) and telnetd(8).
Fix bug oflow in ping(8) -R option.
In tar(1), only preserve the uid/gid if the -p flag is given.
sudo version 1.5.5
Do not prepend /usr/local/bin to the PATH in zdiff(1), zforce(1), zgrep(1), zmore(1), znew(1), or rcsfreeze(1).
Fix DNS fake-iquery bug.
In the le ethernet driver, if the detected ethernet address is ff:ff:ff:ff:ff ... fail.
Fixes for various (minor) Y2K problems.
Switch a.out ports in the tree (sparc, m68k, i386) to use the newer version of gdb that is part of the binutils tree.
Significantly improve the system install scripts.
Add disklabel spoofing to the hp300 port.
Add xlockmore(1) to the X11 tree.
Fix ru_majflt counting in the VM system.
Add AFS token fetching capability to various parts of the source tree.
In login(1), handle cleanup of environment variables correctly.
In ftp(1), for HTTP requests pass the hostname so that virtual hosts work.
In utimes(2) and futimes(2), handle tv_sec values of -1 more carefully, as they are really illegal cases.
Import kx into our X11 source tree.
Add a SIOCGIFDATA ifreq-style ioctl which will get the ifdata informational structure attached to each interface.
Add httpd(8) to the OpenBSD tree. It is apache 1.2.6.
Import xpm into our X11 source tree.
Support QLogic PCI scsi controllers (at least on the i386).
Fix rmd160(3) (and also the IPSEC algorithm) to properly handle data beyond its block boundary.
Emulate SunOS otimes(2) system call so that Netscape doesn't explode.
Fix rarpd(8) interaction with routed(8); too much routing information would pile up un-read on the AF_ROUTE socket and rarpd(8) would get too grumpy.
Remove libtelnet.so.* from the distribution. People compiling kerberos into their system were generating significantly different shared libraries; thus it is wrong to make this a shared library.
Make edquota(8) handle numeric names as uids only after checking that an account named so does not exist.
Add UID_MAX and GID_MAX to <machine/limits.h> on each architecture.
Fix ch(4) operation on ncr(4) scsi controllers.
On the sparc, switch to an alternate font if the console is < 800*600 resolution.
Add ISAPNP driver for the 3c509 cards.
Change SIOCGIFNETMASK, SIOCGIFDSTADDR, and SIOCGIFBRDADDR to return information for named/addressed mappings rather than simply named mappings, so that these calls can work on interface aliases.
Add (complete?) support for KerberosIV to our X11R6.
In mktemp(1), document why this should be used for temporary filename generation.
In telnet(1), fix connecting to IP addresses; this was recently broken by the new KTH kerberos telnet integration.
Make -R path work a well as -Rpath in cc(1).
In the ksh(1) manpage, clarify the behaviour of the CDPATH variable.
Add support for more PCI NE2000 cards.
Make %Y override an earlier %y in strptime(3).
Add support for atalk to ifconfig(8).
Make the functions described in ethers(3) more careful.
Fix support for VFS loadable kernel modules.
In get*ent() family of routines in libc, use fgetln(3) instead of fgets(3) so that parsing of overly long lines is more correct.
Add options(4). This manpage describes what all the kernel options do. If you spot an error in it, notify us immediately.
In strptime(3), make %C influence %y regardless of ordering.
Fix a NULL deference bug in make(1) when using the -j flag.
Fix %m, %I, %S, %y, %C, and %j conversions in strptime(3).
Merge Kirk McKusick's soft update code. This code is still experimental and under a non-commercial license. It will be included in the next release as an optional compile flag; we cannot ship it enabled by default.
Flesh out the man pages and explain the security problems behind mktemp(3) and other similar functions, plus explain how to handle these problems better.
Fully working KerberosIV encryption in telnet(1) and telnetd(8).
Fixes to a few more games.
CVS version 1.9.26
Fix mktemp(3) problems in two more YP tools.
Fix an interaction bug in inetd(8) due to SIGPIPE blocking; caused a bad effect in rlogind(8) or other inetd(8) children.
Configure cc(1) to pass the -R flag on to ld(1).
Add lynx 2.8 to the system.
Add support for 82553 and 82555B PHY in the fxp driver.
Fix tmpfile(3) to fchown() the file after unlink() (taking umask() into consideration, too). This is required by standards.
Fix vnd and ccd drivers to work properly with soft updates.
Fix a crash case in compress(1).
Add -s and -c options to last(1).
Add support for -s section and -S subsection to man(1).
Change the configuration of man(1) so that man4 is read much later; this makes it easier to see pages in man8 with similar names.
Fix KerberosIV password changing.
On the sparc, support 128KB lebuffer devices.
On the sparc, print hotfix information at the right place in the dmesg log.
Fix passwd(1) so that YP passwords do not get edited in the local password file.
Significant efforts made at fleshing out the device driver man page tree better.
Upgrade to gcc 2.8.1
Rename 2.2 to 2.3 tree-wide, for the upcoming release.
Improve IPSEC performance.
Add many new machine-dependent man4 man pages.
XFree86 3.3.2 is now in our X11 source tree.
Add another missing ntohl() in ipnat(8).
Use a p_os field to sub-divide operating system emulation capabilities (like for SVR4 binaries).
Spend almost a week finding and fixing minor goobers discovered by gcc 2.8 throughout the source tree.
Fix syslog(3) sockaddr initialization.
Add support for TIOCM* family of ioctl(2) values to the sparc serial driver.
New photurisd(8) that complies with draft-simpson-photuris-18.txt.
Fix a race bug in mkstemp(3) itself that would make mkstemp(3) have occasionally fail strangely.
Fix a few more mktemp(3) problems in f77 libraries, and other assorted GNU software.
Upgrade to gcc 2.8.0
Upgrade to libg++ 2.8.0
Make ping(8) work with very large packet sizes on all types of interfaces.
Correct behaviour -x and -p flags in tar(1) to be traditional.
Remove one of the two copies of math.h in the source tree.
Improve blowfish performance by a factor of 2, and hence increase the rounds by 1 in passwd.conf.
Handle unknown hostnames in mountd(8) better.
Inside the kernel, change struct file's members f_count and f_msgcount to longs, and then add checking for overflows as well.
Add XDM-AUTHORIZATION to X11.
In old gas, move to late resolution of symbols because gcc 2.8 will require this.
Fix a configuration file parsing bug in ipf(8).
In libpcap and tcpdump, use our system ethers(5) parsing routines.
Make netstat -r report better information about non-standard netmasks.
Fix some bugs in the 3c[59]xx device driver.
The 3rd revision of the patch for the mmap() security problem is available, and has been placed on top of the 2nd revision.
Add a command to ddb that reports out the extent tables.
Add a clarifying statement to all the Kerberos code that explains how it came to be that this code was released from the USA's crypto stranglehold.
In the RPC code, ensure that __svc_fdsetsize is always manipulated as a bitcount.
Clarify crypt(3) manpage as to how many characters each transform actually considers in its calculation.
Do not permit TCP connections to any of the broadcast addresses.
Do not let a user set their password to "s/key".
Permit the disabling of skey system-wide.
Convert the xdr(3) and rpc(3) manpages to mandoc format.
In mail.local(8), document how to use quotas on a mail spool.
Add -p option to uname(1), to display detailed CPU information.
Support for the ST16650 32-byte FIFO uart.
Do not copy from off the end of an nfs boot mbuf.
Some more repair in the games.
Support -rpath dir, -shared, -soname, --whole-archive, and --no-whole-archive in the old ld used on many of our platforms.
CVS version 1.9.24
For OLF/ELF binaries, remember the OS tag in execve(), so that emulation code can reference it later.
Make the kernel compile properly (with full warnings) under gcc 2.8.
Do not permit a read+write mmap() operation on a read-only file descriptor open on a device. This is a security problem in OpenBSD 2.2, and is described and fixed with a patch.
Rename /etc/nat.rules to /etc/ipnat.rules.
Add kerberos kauthd(8).
On the i386, move XFree86 aperture driver into the kernel. The new sysctl(8) variable machdep.allowaperture decides if this driver is active or not. (This variable can only be modified at high securelevel).
Remove the ftp(1) 'stdout redirection' hack and replace it with a -o filename option (which also understands a filename of "-" to mean stdout).
Pull in all the NetBSD changes to the old version of gas over the last year or so.
Fix two bugs in adduser(8).
Change chflags(2) and fchflags(2) to take a u_int for the second parameter.
New fancy OpenBSD logo for your use.
Add XPG4 -r option to du(1).
Support -[width] option in fmt(1).
New quirk for another Archive VIPER scsi tape drive.
Fix another signal handler bug in mail(1).
The mac68k 2.2 CD release had a few problems. These problems have been resolved in the FTP release. For more details...
Make lpd(8) use keepalives so that it can detect dead network printers.
Support the WINBOND pci ethernet cards.
Fixed "%c" in strftime(3).
Various fixes to some of the games, ie. rain, worms, wump.
If link0 is set on a loopback interface (ie. lo1) make the address/netmask sets on it make supernets instead of subnets.
Place separate so_ruid and so_euid fields in struct socket, so that in_pcb.c can still do its job, but also so that identd(8) can be fast and return the proper uid.
In the sparc 2.2 release, the SS4/SS5 kernel was not very reliable. A simple reliability patch is now available.
Fix a map corruption bug in ypxfr(8).
Make stty(1) recognize STRIPDISC.
In compress(1), if the st_flags is 0, do not attempt a chflags(2) call.
Make ruserok() significantly more paranoid when parsing the .rhosts file. This along with another issue is a security problem in OpenBSD 2.2, and is described and fixed with a patch.
raise IPPORT_USERRESERVED significantly. Random port numbers will now look much more random than they did before.
New -a logdev argument for syslogd(8), useful for setting up additional /dev/log devices in various chroot spaces.
Permit restore(8) to work on a filesystem that has a basic blocksize smaller than the blocksize of the filesystem that was dumped.
Make MIPS ldconfig emulate the -m flag better.
The web pages now have a new section on security advisories.
New compat_ibcs2(8) manpage.
Fix rarpd(8) to work properly in the presence of massive routing traffic.
A start at full lint library support.
smtpd(8) integration spiffied up. Everything you need is now in the system.
Emulate that disgusting linux connect() braindamage even better.
Fix some bugs in vacation(1).
Fix /etc/yp/domainname support in ypbind(8).
In the 2.2 release, the sparc scsi driver caused problems for the Sun 4/300 machines. Patches are now available.
Add FS_CCD partition type so that the ccd driver can ensure it has the right components.
Add /etc/sysctl.conf which specifies sysctl variables to change at boottime.
Fix a free page count bug in the vm system.
Create two new sysctl options: ddb.panic decides whether the kernel should enter ddb when it panics, and ddb.console controls if it is possible to enter ddb from the console via a hot-key.
Add scan_ffs(8), a very useful tool for reconstructing disks.
Add strptime(3).
Buffer overflow fix in the MIPS ld.so. Replacement binaries for the pmax and arc platforms are available.
Avoid DNS lookup timing effects in ping -R.
Fix the __{CTOR,DTOR}_LIST__ declarations in c++rt0.c
Two bugs existed in the 2.2 pmax release which all users should be aware of. Patches are now available.
Be more careful about sourcerouted packets, including never forwarding them. This is a security problem in OpenBSD 2.2, and is described and fixed with a patch.
Teach the kernel about newer PCI device types.
Workaround a race condition in syslogd's handling of SIGHUP.
Some man page fixes so that man -k is happier.
Low-memory bug fix in setenv(3).
Self-extending kernel maps in the vm subsystem.
In rc.local, bail on starting cfsd(8) if mountd(8) is not running.
Require commands started from in /etc/rc to be executable -- not just readable.
Glob extensions for XPG4.
Cleanups in wump(6).
Check both old and new shells in rpc.yppasswdd(8).
Add -a flag to which(1).
On binutils platforms, make ldd(1) work on static executables.
IPF 3.2.3. When you upgrade to this version, you must also upgrade the userland utilities (ipf, ipnat, etc.). You also need to get the latest MAKEDEV and run "sh MAKEDEV ipl" in /dev to create new device entries.
Fix a race in mkdir(1).
More cdrom ioctls in Linux emulation.
Fix select(2) use in sudo(8) so that it can handle large fd_set sizes.
In termcap databases, map the keyboard backspace key to DEL instead of BS as that is how it really is.
Fix argument handling in expand(1).
If tar(1) extracts as root, preserve uid/gid as is traditional.
Repaired the expansion of the kernel panic string.
Much more complete KerberosIV documentation.
Start at bus_dma support.
Properly error out if yp_match() or yp_first() is asked to lookup long keys.
Groff 1.11a
Properly ignore whitespace between a conversion and %n in *scanf(3).
Import of tzcode1998b and tzdata1998b.
Use new ypwhich(1) flag in ypinit(8) script to get maps from the real master server.
Support -h host flag to ypwhich(1).
pppd 2.3.3
Handle unparseable ulimit specifications as an error, not as the value 0.
ncurses 4.1-980103
In w(1), handle processes that set argv[0] to NULL, by printing p_pcomm.
Make pkg_install(1) feed a -p option to tar.
sudo version 1.5.4.
Merge some slight standardization fixes for *printf(3) from FreeBSD (some unlikely cases get handled better).
Bring gethostent() back to life, even though it is a bad interface.
In disklabel(8), make IDE drive type handling more obvious and intuitive.
Support all kinds of keyboards in pcvt, like pccons does.
Support for FAT32 partitions.
For scsi tape drives, be silent in the presence of ILI errors.
Fix a vnode creation race.
Fix a output error in finger(1).
Do not permit dumping corefiles over symbolic links. (We have wanted this changed for a long time, but it required Lite2 vfs.)
Permit extra / terminators in some path-based system calls.
Fix some problems regarding transfer of secure yp maps.
New rc.conf(7) manpage.
Make sure it is clear that so_linger is in seconds.
Add sysctl net.inet.icmp.bmcastecho to block the smurf problem.
Some fixes to fdisk(8) and disklabel(8).
Workaround a problem that happens if a TCP socket is shutdown(2)'d more than once.
Some more manpage cleanups.
Some slight changes to the PCI device subsystem to make it probe devices nicer (mostly dmesg printing).
Make md5(1), rmd160(1), and sha1(1) use getopt().
Make {f,}chflags(.., -1) return error EINVAL.
Make mmap() return void * instead of caddr_t, and add the MAP_FAILED define required by new standards.
Fix some gzip buf oflows.
Correct an splx botch in the tunnel driver.
Add sysctl ddb.panic_ddb; indicates whether to drop into ddb on a panic.
Swap quit and exit commands in fdisk.
Correct exit code of nohup(1).
lockf() implementation.
Handle DST changeovers automatically in cron.
IBCS2 emulation also requires fcntl() F_FREESP support.
The new KTH KerberosIV integration (and security audit) is almost complete.
If mountd(8) discovers getfh(2) not supported, it now aborts nicely.
Support fcntl() GETLK,SETLK,UNLK variants in SunOS emulation.
Fix a bug in make(1) regarding SYSV style : substitution on null variables.
Check the values of the ftp PORT command even more carefully.
Fail better for over-long usernames.
Change ftp(1) so that tries to use passive mode, and falls back to active mode. Provide environment variables to fall back. This is incredibly cool.
Provide workaround for the Cyrix 6x86 COMA bug. (A workaround for 2.2 is not available).
Implement fcntl() of F_FREESP in SVR4 emulation. Does this belong in ibcs2 also?
Fix Linux accept/recvmsg if kernel is compiled with other compat options.
In numerous programs, avoid fd_set overflows.
Fix MAKEDEV script regarding /dev/fd/* for some architectures.
Fix a kernel bug related to "route change ...".
Support IP_HDRINCL in Linux emulation.
Update the pkg_* tools a bit.
Honour TMPDIR in the locate(8) tools.
Make route(8) non-setuid.
In ftpd, default to RFC non-conforming behaviour for the PORT command, but provide a runtime switch for those who like holes.
Addition of Obtuse smtpd(8) and smtpfwd(8) v2.0.
Due to timing constraints, mac68k X11 binaries did not make it onto the 2.2 CDROM. But it is now available for ftp.
Do not clear the setuid/setgid file mode bits for a call to {,f,l}chmod(-1, -1).
Enable new FreeBSD ppp(8) daemon. There are now two ppp daemons in the source tree, they have quite different feature sets.
Fixed a panic problem in the i386 apm driver. A patch is available for 2.2.
Repair a number of retry operation problems in the wdc driver that mostly affected sleeping laptops.
Handle the controlling tty ioctl in linux emulation.
Handle SIOCGIFMETRIC and SIOCGIFMTU in linux emulation.
Handle nanosleep() in linux emulation.
Use recursive vnode locks to solve a page-in panic reported by chuck & chuck.
Handle SIOCGIFHWADDR ioctl in linux emulation.
Handle the cdrom ejecting ioctl in linux emulation.
Correct an XPG violation in stdlib.h.
Fix a problem in -current regarding open() of O_TRUNC and O_SHLOCK.
Fix numerous problems with new KTH kerberos.
A workaround for the Intel P5 F00F lockup problem. A patch is available for 2.2.
Fix minor numbers for /dev/ch* in the MAKEDEV scripts.
Add a kern.nosuidcoredump sysctl.
Enhance the performance of pwd_mkdb(8) by expanding the db(3) cache based on input filesize.
Use cp -R instead of cp -r for local copies in rcp(1).
Flesh out scsi(8) a tiny bit more.
In linux compat, handle the CDROM ioctl() calls.
Indicate connect direction for tcp sockets in fstat(1).
Fix scsi CDIOCREADSUBCHANNEL.
Prevent ipf/ipnnat configuration changes when securelevel > 1.
Fix an overflow in top(1).
Fix a deadlock on cd9660.
Update to ncurses-4.1-971129
On the i386, handle the nasty problem with distinguishing SVR4 and Linux binaries. A patch is available for 2.2.
Newer ncr device driver.
Fix SunOS emulation of TIOCGPGRP.
Add some more XPG4.2 *_t types.
Import perl 5.004_04.
Add hosts.equiv(3) and .rhosts(3) man page.
Add asprintf(3) and vasprintf(3).
Fix /etc/rc scripts to require IPF if NAT is requested.
Moving towards KTH kerberos 4-0.9.7.
Fix -amin option in find(1).
Fix arp(8) ethernet address parsing for the illegal cases.
Massive performance optimization of the ccd device (RAID-like striping disk driver).
Work around stupid linux emulation behaviour involving non-blocking connect(2).
Update to ncurses 4.1.
Fix a mget prompting error in ftp(1).
add -t option to disklabel(8).
Some man page cleanups.
Fix a memory leak in the kernel process group manipulation code.
Import of FreeBSD's ppp(8) program.
Update sudo(8).
Fixed bug in 'systat vm' output.
Fix the internals of open(2) when O_TRUNC and either O_SHLOCK or O_EXLOCK are set. (That was a nasty kernel bug).
Clean /var earlier in the /etc/rc script.
make readlink(1) terminate its buffer correctly. This affects CDROM builds so a patch is available for 2.2.
Make fstat(2) on AF_UNIX socket return proper st_[acm]time field values.
Implement FIONBIO in ibcs2 emulation code.
Consider only the 0177777 bits of the umask(2) value, as documented.
Added mode rangecheck in chmod(2) and fchmod(2).
Fix some Y2K problems in the nroff tmac macros.
Minor logging feature changes in fingerd(8).
in chat(8), replace Mini Getopt from hell with real getopt().
Add SHUT_RD, SHUT_WR, and SHUT_RDWR values for shutdown(2) as specified by XPG4.2.
Make the -Ss flag in rpcgen(1) work right.
Range-check the "how" argument for shutdown(2).
Change various system calls to take void * instead of caddr_t.
Fix a line continuation bug in sed(1).
Add inetd(8) -R rate flag, and crank default rate to 256.
Clear CLOCAL mode in pppd if modem is set but modem_chat is not.
Make the if_de driver support more cards.
Make msync(2) POSIX compliant.
Fix a ONLCR + FLUSHO situation in tty.c
Support -mmin, -amin, and -cmin in find(1).
Support an "object" keyword in config(8).
Make "expr a : /" work.
Make dumpfs(8) report if soft updates are requested by the superblock.
Add getsid(2) system call as mandated by XPG4.2.
Some minor fixes for the libc/db/btree code.
Flesh out compat_freebsd a fair bit more.
Some compat_svr4 fixes.
Update getNAME(8) and fix makewhatis(8) to use it more optimally.
Fix EXTPROC in pty code.
Correct TCP's handling of RST.
Add more things to afterboot(8).
Fix tty suspend during sh -c "less file".
double MAX_KMAPENT and MAX_KMAP
sendmail 8.8.8
add uu_lock(), uu_unlock() and uu_lockerr() to libutil.
Start named(8) earlier in /etc/rc.
Support execution sections in syslog.conf.
4.4BSD lite2 vfs integration.
usleep(3) returns int, and add useconds_t type as required by XPG4.2
Fixed ps(1) LIM and STAT columns.
makewhatis(8) manpage added.
Fix rpc.rquotad support if the quotas file resides on another filesystem.
Truncate large uid and gid values in ranlib(1), in the same way as this is handled in ar(1).
Document how crypt(3) handles blowfish and MD5 passwords.
Fix some memory leaks in the RPC code.
Fix an as(1) parsing bug relating to the .ascii directive.
Handle C++ and other languages in yacc(1) far better.
Be more careful with getpwent() information inside rcp(1).
Replace kernel printf with Torek's libc printf.
Make disklabel -E deal with multiple partitions which overlap.
If a non-existent user logs in and asks for s/key authentication, fake a proper s/key prompt.
SIGWINCH handling in systat(1).
Add blowfish and cast encryption to IPSEC.
In tftpd(8), permit syslog() to work when running chroot(2)'d.
a buffer underrun in ctags(1).
Make kdump(1) handle the newer emulations.
Add svr4 jioctl() compat interface.
--------
Changes made between OpenBSD 2.1 and 2.2
Prevent open(2) with wrong flag modes.
The new afterboot(8) man page. Everyone should look at this.
Addition of 'kbus' port for the Solbourne Series5 sparc-based machines.
Make clri(8) mark the filesystem dirty.
Add per-host locking support to supfilesrv.
Make the ncr scsi driver work on big-endian machines too.
Fix a select/read race in identd(8) which would make it spin wildly.
Make ac(8) use the correct timestamp if the user specifies a different wtmp file.
Fix mktemp() to work correctly when specified against non-existent directories.
Fix a memory leak in libdes.
Fix one last little problem case in the fts(3) library routine. This is a very complicated piece of code...
Some minor tftpd bug fixes.
Another lpd security fix.
Repair the msdosfs timestamping code so that NT/Win95 do not complain.
Make disklabel -E always succeed at writing a label. Now you can load a fictitious label, edit it, and write it out.
In fmt(1), support backslashed whitespace inside words better.
Support 'q' modifier in kernel vsprintf/kprintf
Implementation of the new disklabel -E mode.
Handle creation of /var/tmp/vi.recover more securely.
Quirks for two kinds of hitachi dk515 scsi drives and the Cipher ST150S tape drive.
Handle a potential crash in the bpf driver.
Rewrite of fdisk(8).
Make /etc/security handle blowfish-a passwd entries.
Ignore bogus hostnames in the /etc/exports file.
Fix prompting code in pw_edit(3)
The random(6) tool (game?) now uses arc4random(3).
A few pppd fixes.
More IPSEC improvements after the Interop ANX bakeoff.
Add -f option to readlink which does a realpath(3).
Fix a bug in libform.
Add support for FNM_LEADING_DIR, FNM_CASEFOLD, FNM_IGNORECASE to fnmatch(3).
Fix a network performance problem introduced with IPSEC.
Fix the : and . support in chown so that usernames can have . in them.
Make execle() use alloca() instead of malloc(); to ensure execle() can be safely called in a signal hander.
Fix an ifconfig bug related to interfaces that do not exist.
In struct sigaction, split sa_handler and the new sa_sigaction function pointers as is being done on newer POSIX systems. This permits proper prototyping of signal handlers.
Ignore SIGPIPE in inetd(8).
Fixed a pstat -s related bug in pcvt.
Do not init pgid in /dev/log's logopen().
Make ls -d sort directories with files.
Fix a few small problems in rarpd(8).
Shrink most of the install floppies ;-)
Fix tar to deal better with one more kind of strange tar file.
Make top(1) work better on very small screens.
Deal with some possible buffer overflows in sup.
Fixed various MAKEDEV bugs on lots of architectures.
Fix ftime(3).
Another important disk-full check in pwd_mkdb(8).
Run calendar -a in the background. (Points to whoever figures out why.)
Add mkisofs(8).
Add sigaction(2) SA_NOCLDWAIT support.
Don't error out of MDTM fails.
Fix SA_* sigaction(2) fields in the OS compat code.
Some syslogd fixes.
Permit a longer path buffer in tgetent(3).
Fix a ksh(1) bug.
Added ex (EtherExpress Pro/10) driver ported from FreeBSD
Always set the SCSI-1 LUN field correctly in all transfers.
Make popen(3) safe if vfork(2) does real parent address space borrowing.
Some fsck_msdos(8) fixes.
Made indent(1) handle unlimited number of -T options.
Fixed small pathname buffer in man(1).
Some setlogin() and getlogin() fixes in the tree.
Make ddb not think 'h' means hangman.
Ignore trailing spaces on priority in /etc/syslogd.conf.
Fix a long-standing and minor problem with ld.so on m68k.
Preliminary manual pages for the IPSEC utils.
Fix a coredumping problem in tip(1).
Extend buffer lengths in patch(1).
make bpfread() return ENXIO for uninitialized descriptors.
Cleaned up verbose scsi error reporting.
make mail(1) be permissive about <CR><LF> pairs in mailbox files.
Update ftp(1) to new NetBSD changes.
Print system call emulation in ps(1) output. Try "ps -axO emul".
New COMPAT_BSDOS binary compatibility subsystem.
Another tip(1) overflow fix.
ppp 2.3.1...
make glob(3) XPG4.2 compliant, which means use GLOB_ABORT.
Fix first directory handling in "find -execdir"
Some FreeBSD m4(1) fixes.
Do permission checking at delivery time for pgids derived from TIOCSPGRP, F_SETOWN, or FIOSETOWN.
Correct some remaining small inetd bugs.
Handle SIGCHLD better in rlogin.
Kill "union wait" in a few more places.
More SysVR4 emulation: sockets, NTP, POSIX time functions, pread(2)/pwrite(2).
In calendar(1), support "-t date" to let you see the calendar for other days.
Further IPSEC enhancement (but still no man pages for it though).
Fix a crash in systat(8).
Handle setgid lossage in tip(1).
Lucent Technologies (formerly AT&T) awk version 970821.
Correct 'sync' option to dd(1).
In dump(8), do not consider tape changing time in the timing estimates.
In join(1), require compat options start with '-'.
A few fixes to tip(1).
Various fixes to battlestar(6).
Few more 64 bit fixes in userland, in some rarely used system tools.
Don't print duplicate fields in ps(1) when called with silly arguments.
basename(1) and dirname(1) no longer give an error for paths starting with '-'.
Document a64l(3) and l64a(3).
The group vector could end up with duplicates esp. with YP. Now it won't.
ash is gone gone gone.
Fixed a bug where the kernel could lie about how many file descriptors are available and cause a panic.
shutdown(8) now gets its own session as it deserves.
Fixed err(3)/warn(3) argument usage in the tree.
Buffer overflow fixes in tip(1).
XPG4 compatibility for ps(1) format options.
Added basename(3) and dirname(3) for XPG4. dirname(1) is now trivial.
Verbose SCSI warnings are now available and on by default.
Fixed a bug in cp(1) when the -r option is used and the source dir ends in a '/'.
Changed realloc(foo,0) semantics to be like malloc(0), not free(foo).
More user-friendly error messages from mount_* when the filesystem is not in the kernel.
New PCMCIA Wavelan driver.
Be more careful about YP groups in getgrouplist().
Support simple add/delete operations on ports in the baddynamic masks via sysctl(8)
More 1003.2 conformance: cal, cksum, sleep, compress, expr, etc.
We are starting to pay attention to good things found in the XPG4 standard. We hope to never be compliant, because XPG4 goes way too far.
Put hostname in root crontab mailout subjects.
Attempt to deal with archive timestamp and filemode problems in texinfo...
ATAPI quirk for MATSHITA CR-574.
Fix another procfs security hole.
Add top(1) to the source tree. Fix some problems.
Be even more paranoid (if it can be believed) in mail.local(8).
In mountd(8), handle ext2fs specially, like most exported filesystems.
Fix pcap_inject(3) in libpcap.
Make gzexe(1) use mktemp to avoid races.
Make bad random allocation ports settable via sysctl(8).
Import ypserv performance.
Optional TCP syn cookie support enabled via TCPCOOKIE kernel option.
Change the bounds_check_with_label() API to handle a cpu_disklabel too.
Support -n better in pstat(8).
Make bsd.doc.mk use DOCDIR.
Fix vacation(1) properly.
Fix a memory leak in grep(1).
Seriously rework the identd daemon even further, to avoid even more input parsing problems and race conditions.
Work has started to fix the remainder of the signal handlers in the source tree with respect to errno clobbering.
Fix another race condition in identd.
Fix pdksh bugs: closed too many fds on exec, fix handling of (( )) to be compatible with POSIX sh spec without breaking $((, and explain how IFS works when splitting text after a substitution.
Make 127.0.0.1 assumed OK if /var/yp/securenet is in use.
save errno in most of the tree's SIGCHLD handlers, just in case.
More mdoc pages.
Cyclades driver fixed. Works on alpha, too.
Fixed getnetbyaddr() 'always tried DNS' resolution problem from 2.1.
Sendmail 8.8.7.
Fix a kernel bug regarding double m_freem()..
Make if_tun to prefix address family as a host byte order u_int32_t instead of a u_char, so that bpf can deal with the interface.
Deal nicer with rfork/execve interactions.
Attempt to cleanup identd. A long road left.
FSF GNU texinfo 3.11.
More fixes to the alpha vga driver. Curses-based programs now work on it.
Radius support in tcpdump.
Todd Miller is on a rampage, and making every single buffer inside mail(1) dynamically allocated...
Support fpx cards with i82555 PHY.
routed(8) is now disabled by default.
Various fixes and improvements to the 3cXXX ethernet drivers.
More buffer overflow fixes in mail(1).
An ugly identd race fixed.
Fix systat manpage.
Man page improvements in many areas.
Allocate reserved ports for NFS inside the kernel randomly.
Support -H flag in who(1).
More mail(1) fixes.... It's amazing Todd hasn't broken it.
stime(2) support for SunOS emulation.
Switch back to nvi; vim has copyright licensing issues.
mremap(2) support for Linux emulation.
Use sendmail -t instead of other invocation forms inside lots of programs in the source tree.
Hardcode a list of reserved ports that random port allocation should not reuse.
Support YP map mail.aliases set of maps.
Support lpc(8) "all" keyword option.
-d flag for shutdown(8).
Add -T support to last(1).
Fix pax to not need getcwd(3).
Implement IFF_NOARP handling in netinet.
make amd(8) use /tmp_mnt by default.
Do not use tempnam(3) in mail(1).
All Makefile.bsd-wrapper files can now strip GNU binaries during install (pr 188).
Some cribbage(6) fixes.
permit ftp(1) to download http pages without Content-Length.
Appletalk networking support.
S/Key keyfile is now readable only by root. skeyinfo(1) and skeyaudit(1) have been enhanced and rewritten as C programs.
mail(1) supports "inc" command.
mail(1) behaves correctly when interrupted while getting headers from the user.
IPSEC Photuris daemon is integrated into the source tree.
make ctags operate a bit better in the presence of extra spacing.
Add -d date support to last(1).
Import of the IPSEC photuris daemon.
Add rmd160 hash support throughout the source tree.
lpd security fixes.
man page cleanups.
Updated Sendmail to 8.8.6.
cua devices, new MAKEDEV script in the hp300 port.
More mail(1) fixes, particularly regarding long lines.
Add sha1 digest support to mtree(8).
Add sha1 support to md5(1).
Lots more IPSEC improvements.
Repair symbolic link handling during coredumps (correctly, this time).
Replace libc sha1 code with another version that is better in some respects.
Fix passive buffer overflow in rusers.
Make ed(1) work properly on a non-tty.
make compress(1) do gzip support too.
Maintain process size stats in forkstat struct for "vmstat -f".
Fix ruptime output for machines up > 99 days.
Amended issetugid(2) man page to be quite a bit more clear.
ATAPI devices may now reside in a kernel without wd (disk) devices.
Intel EtherExpress Pro/100B PCI driver.
More IPSEC changes. IPSEC is almost fully usable now.
Fix a number of rtld dynamic loading problems.
split ifconfig -a into -a/-A: -A prints ifaliases, -a does not.
Repaired nfs handling in tcpdump.
Fixed highscore handling in battlestar(6).
Fixed all(?) Makefile wrappers for GNU software to not build and install manpages when NOMAN is set.
libedit update with lots of fixes.
Many more 64 bit fixes for the alpha, in about 20 more programs.
Move libdes out of the kerberos tree so that it can be used by other parts of the system too.
Make sleep(1) handle fractions of seconds. This is a nice extension.
New kprop/kpropd man pages.
Permit tftpd to provide files over 32K blocks in size.
Fix readlink(1).
Import of cvs-1.9.10.
A few more minor netinet problems fixed.
Modify inetd to accept a "hostname,[hostname,...]:" token to added to the front of any line in /etc/inetd.conf. This permits services to be supplied only on certain interfaces.
Import of the gnu multi-precision math library, libgmp. This will be used by an IPSEC key daemon soon.
Support IP option handling in IPSEC packets.
Race fix to amd(8).
Y2K enhancement to date(1).
Repaired hundreds of long != int problems (in a bunch of programs) that affect the alpha.
Clip setsockopt SO_SND*/SO_RCV parameters.
Use O_EXLOCK for passwd locking to avoid a class of localhost denial of service attacks.
Fix a minor problem in popen().
IPF 3.1.11 + Darren's patches + 64-bit cleanup.
Added automatic power down framework at halt(8) time, currently only supported on sun4m machines with the power device.
Slightly improve ftpd log file.
More paranoia in procfs.
Add ELOOP error handling to realpath(3).
Some NLS improvements, notably some more language catalogs.
Change mount(2) to return EFTYPE for invalid filesystem.
More ipsec changes!
add -insecure flag to ypbind(8) so that it can bind to very old ypservs.
Make ifconfig(8) print full information about the full set of interface aliases.
Support "-d dir" in rpc.yppasswdd(8).
Fix some more /tmp races in various programs.
add per-interface bindings to inetd(8).
Better support for unmounted filesystems in df(1).
Correct -n behaviour in sort(1).
In newfs(8), fix -o and -m to work better.
Add tsearch(3) to libc.
Fix /tmp races in make(1).
Deal with atapi drives that cannot lock their doors.
Improved performance in /dev/*random.
Fixed a few netinet bugs as pointed out by TCP/IP Illustrated Vol.2.
Add tsearch(3) and friends to libc, as required by XPG3(?).
Repair many cross-references and other documentation problems in the section 2 and 3 man pages, and also fix a few minor other bugs discovered by analysis of recent changes in FreeBSD's and NetBSD's libc.
Implement hex/octal offsets in cmp(1), as documented.
Addition of readlink(1).
Move named tmp files to /etc/named/tmp/ to avoid localhost race attacks.
document the ddb hangman.
tftpd -c flag.
Use dynamic fd_set allocation in more places, particularly setuid programs.
Use /etc/namedb/tmp/ to avoid /var/tmp race conditions.
Ensure TCP RST is within window.
fix disklabel support in vnd/svnd.
add sysctl net.inet.tcp.{keepidle,keepintvl,slowhz}
fix SO_SNDTIMEO.
Add -P proto support to traceroute.
Some more security and robustness changes to traceroute and ping.
A few netinet fixes.
Kernel now generates random pid values in fork().
fix sendmsg() credential passing on 64 bit machines.
kill process timers if execve'ing a setuid/setgid executable.
Few more fixes to pax(1).
Fix lots more NetBSD PRs.
tcp wrappers 7.6
Add some more malloc options to malloc(3)
In ar(1), truncate uid & gid if too large.
getpgid(2) from XPG3(?)
tail(1) can now notice if the file been replaced or truncated.
Fix more overflows and other bugs in mail(1).
Lots of man page fixes.
New named root.cache from Internic.
Support SIGINFO in ping; also add more complete icmp reporting capabilities.
Make adduser understand /etc/passwd.conf
Newer version of ext2fs that is reliable for read/write operation. This is essentially FULLY OPERATIONAL.
Import newer version of vax port.
Fix a few more libc functions to generate very large fd_set's properly for select(2).
Few quirky changes to the way ISO9660 disklabel spoofing works in some ports.
--------
Changes made between OpenBSD 2.0 and 2.1
Fix keyboard and delay timing in i386 bootfloppy bootblocks. Whee!
Added gzip and cdrom support to the sparc and alpha bootblocks.
Support crunch on arc (for bootable installs).
Repaired install stuff for most architectures significantly, improving ftp/http installs, single bootable install floppies, and in some cases CDROM booting. Most floppies contain vi, too.
The vnd(4) device has a new safer mode of operation called svnd where you can trust a disk-image right after it's unmounted, i.e. cache-coherency.
sleep(3) and usleep(3) now call nanosleep(2) for significantly less overhead.
GNU Groff 1.10 with (improved) Makefile wrapper.
A bit more man page cleanup starting to happen...
Split rc.local, creating rc.securelevel. (Securelevels look like a worse and worse idea every month.)
newfs_msdos(8) can has enough brains to find the partition size itself.
Significantly improved the unpredictability of the DNS packet id's in the resolver and named.
libpthread works on the m68k.
Support for PCI NE2000 clones.
Some more userland 64 bit fixes.
Unify naming of architecture names between gcc & binutils.
Signal handling fix to crontab(1).
Various fixes to the YP utilities.
Support extended partitions in fdisk(8).
Support /etc/rc.shutdown from halt(8).
PCI aic7860 scsi support improved.
Support .group entries in /etc/passwd.conf
Repair some bugs in mail(1), especially regarding signal handling.
Always skip the first 8KB of all swap partitions (hint: disklabels & bootblocks)
The df(1) utility now has a human-readable "-h" option.
For the first time ever, an obj@ populated /usr/src tree compiles cleanly when mounted read-only.
Various man page fixes.
NAT now gets started from /etc/netstart.
Fix AFS string-to-key handling in kerberos.
Correct DEV_BSIZE and lp->d_secsize confusion throughout the source tree. CD9660 is much happier now.
Use in_addr_t and in_port_t all over the place.
For config(8), if any kernel options get added/deleted/changed since the previous commit, warn that the compile tree needs 'make clean'.
Make real i386 CPUs work again. In case no one noticed, they didn't work for about 5 months. The bug was very hard to find...
Once again, really correct the various source routing pieces of the userland source tree.
A whole bunch of 64 bit fixes in the source tree (hint: alpha).
Fix patch to honour Index lines better.
Solve a few resolver problems after the recent 4.9.5-P1 integration, not all our fault.
Use 10 X characters in many remaining mktemp() calls which are hard to excise.
getnetent() and friends now work a lot more like gethostent().
More buffer overflows, but none in sensitive programs.
Fixed some more mktemp races (sigh, will this ever end!)
Add support for YP v1 to ypserv.
Add md5 & blowfish passwd support to adduser(8).
Numerous more pax/tar fixes.
Add ./.message support to ftpd
16 partition support for the alpha port.
cvs 1.9.6
64 bit clean in.rarpd.
Change mail.local -H behaviour slightly, and convince mail(1) to use it for correct locking!
New termcap and terminfo database files.
Be more careful about modes of lost+found directories.
Implement NOFILE_MAX--hard limit on max descriptors per process.
gcc no longer defines -D__NetBSD__, only -D__OpenBSD__ now!
sysctl kern.osrevision gives OpenBSD date.
A few ypbind fixes.
Fixes to fts(3).
ddb improvements for 64 bit machines.
The NE2000 if_ed driver now works on the alpha, too.
Various atm fixes.
Support for "secure" YP password maps.
Substantial changes and fixes to the scsi scanner support.
noaccesstime option for filesystems (saves batteries on laptops)
Bye bye tahoe bits.
pccon(1) to control the pccons driver.
Merged changes from at 2.9 into our own at.
Fix pcmcia on the i386.
ipsecadm as an initial cut at controlling IPSEC sessions.
Various fixes to the fsck tools.
Let fsck and fsirand automatically work on very large filesystems.
Numerous improvements to pax, including full support for cpio and a lot of fixes to tar mode.
Import of libwrap and tcpd (tcp wrappers).
Import of the mvme88k kernel port.
Add support for FreeBSD md5 to /etc/passwd.conf.
BIND 4.9.5-P1.
deroff(1) 1.0 from Debian (a Linux).
settimeofday(2) won't roll back the date if securelevel > 0 (from lite2).
newfs(8) now has an inline fsirand(8) with no noticable speed decrease.
Replace which(1) with a C program.
libg++ pulls in libcurses automatically.
Fix weak symbol support in ld.
cvs 1.9.2
IPSEC package from John Ioannidis and Angelos D. Keromytis.
Working kadmind for kerberosIV.
Add support for /etc/passwd.conf which controls the format and strength of passwd entries for the next time a user changes their password. These options can be set per-user.
New scalable BLOWFISH-based crypt algorithm for passwd file entries. It uses a very large strong-random 'salt' and the number of rotor runs is configurable. Hence if you have faster machines you can slow the crypt routine down and make harder keys.
fix some more memory and file descriptor leaks in libc/rpc
Fix so that stack limits which are not a multiple of the pagesize work.
Fix a few netinet kernel crash problems.
Fix pax & tar to be POSIX compliant.
add RPC service name generation to netstat -a
Make dd(1) work fine with our 64-bit off_t types, now you can copy very large disks using it.
Improved NFS filehandle creation.
Use lots more XXXX characters in calls to the few remaining mktemp() calls in the source tree. This cuts out a whole class of races.
IPF 3.1.7 which includes fully working NAT support (ie. IP masquerading).
The hp300 joins many other ports in supporting 16 disk partitions.
Have libc/rpc save you from yourself if you do enable source routing.
Change mktemp(3) and family to generate more random filenames, yet still as collision free as possible.
Merge new ftp(1) changes from NetBSD.
Add cdev and partition support to the ramdisk driver.
New wgrisc port for Willowglen embedded r3081-based machine with ISA slots.
Support for gzip'd kernels in some bootblocks.
Be more careful if some fool decides to enable source routing ;-)
Added RFC-1812 ICMP unreachable codes to ip_icmp.h, traceroute, and ping.
/sbin/dump -a saves you from needing to deal with finicky tape length options (from FreeBSD)
config.old(8) has been removed from the tree, as the hp300 port switches to config(8).
A SA_SIGINFO implementation for sigaction() and signal handlers. This is a small part of POSIX 1003.1b and permits the signal handler to figure out the exact cause of a signal; such as fault address information for SIGSEGV or more detailed information for SIGFPE.
The Alpha port and all its utilities now compiles using in-tree versions of all tools. Yipee!
amd (the automounter) is now 64-bit and working on the alpha.
Changed netinet IP_HDRINCL option to require ip_len and ip_off in network byte order. This is a compatibility/portability fix and we expect other BSD systems to eventually follow suit.
Bug fixed that prevented bufpages/nbuf > 1 setups. This allows large buffer caches even when available kvm space is low, like for i386 & sparc.
Some ypbind(8) tightening up, includes a method to specify a list of valid servers
Completely in-tree PowerPC port for non-Apple hardware. This port requires nothing outside the in-tree development environment to build (except mkisofs for building distributions).
A working fsirand.
More kerberosIV security patches.
Repair many uses of the SIOCGIFCONF code for machines with an outrageous number of network interfaces.
pax in tar mode will understand multiple -v options to generate ls-like output.
Prevent stat() from disclosing inode generation numbers to non-root userland.
various adjtime() corrections inside the kernel.
No buffer lengths in fmt(1).
Support lchown(2) in dump(8), cp(1), pax(1), cpio(1), chown(8), and restore(8).
New gnu cpio 2.4.2
Added lchown(2) for compatibility with SVR4 implementations.
Sendmail upgraded to version 8.8.5.
Upgrade of awk(1), integration of BSD tsort(1), getopt fixes.
Support for the hp300 added.
Fix a fairly nasty security hole in all of the games.
new aucat command.
libcrypt goes away. We do not need this stub library anymore. Do not link against it on OpenBSD, all the pieces you need are in libc.
ppp 2.3b3
Permit building of kernels without a.out support.
Properly use _POSIX_SAVED_IDS throughout the source tree.
Import of the powerpc port.
Change the games to be run setgid games, not setuid games. This closes a whole slew of fascinating security holes.
Add disklabels to the vnd device driver.
Properly split fsck, mount, and newfs into multiple pieces. Use disklabel information if it is available.
Permit NFS attribute cache to be configured on a per-mount basis.
Add XCASE/IUCLC/OLCUC/OCRNL/ONOCR/ONLRET tty subsystem flags for backwards compatibility.
Repair some more KerberosIV buffer overflows. Hard to believe this is supposed to be security software.
f77 0.5.19
texinfo 3.9
sendmail 8.8.4
Fix a few setgroups() related security holes.
Add NetBSD's "route show" implementation, and at the same time fix the new buffer overflows that this provided.
Fix information gathering attack in ping(8).
tcpdump 3.3
If disklabel reading code discovers an ISOFS filesystem underlying, spoof a nice disklabel (enough to fool mountroot).
At boottime, have (*mountroot)() look at the root device's disklabel to determine which filesystem type is to be mounted.
Add disklabels to the floppy device drivers.
Multiple updates for GNU software
Hundreds of little fixes all over the place.
Some YP and bootparamd security changes.
Add FreeBSD md5 diffs to mtree(8). This can be used to implement a tripwire-like system.
GNU gdb works on the mips-based platforms.
Imported FreeBSD's calendar.
Increased compatibility in the pccons driver with BSDi features.
Added -C option to pax/tar. Also made -z support compressed files too.
Prevent generic users from mounting filesystems by default.
Use pdksh as our /bin/sh. This provides excellent POSIX compliance.
Numerous small security fixes again...
com driver is now bus-independent.
lpt driver is now bus-independent.
The Arc port family has a new member: The rPC44 works!
New bsd.*.mk feature: DEBUG=-g. Try it, you'll like it.
pdksh version is now 5.2.11
Make login get more consistently upset about failed logins, and tell user about these failures at the next successful login.
Memory leak paranoia in cron.
Numerous more difficult-to-exploit-but-possible-if-someone-really-wanted-to buffer overflows found in system utilities..
Various repairs to the scsi scanner support.
Import of ctm.
Integration of the pmax port.
Beware $HOME overflows throughout the source tree.
OLF binary type added. This is like ELF, but includes an OS-dependent tag. elf2olf(1) converts an elf binary to a tagged OLF binary which the kernel can recognize correctly.
In numerous utilities: prefer $LOGNAME, but also accept $USER.
The NIST suite showed numerous errors in libraries and the kernel. Only a few small errors remain now, mostly regarding serial ports.
More ftpd raging paranoia security fixes.
Numerous fixes to the lpr suite, including security.
Crank kvm space on the i386 port, also limit buffer cache usage so that 512MB machines may work (untested :-)
GPL i387 emulator added.
Skey revamped into full OTP (RFC1938) support, including sha1 and md5 support.
Add stack tracebacks to Arc port's kernel debugger.
The /dev/*random devices are now default on all architectures.
A number of security fixes to the way coredumping works.
upgrade to CVS version 1.9.
The NIST Posix test suite became free. As a result we have been correcting numerous problems in the source tree, and expect to be completely POSIX compliant very soon.
--------
Changes made between birth and OpenBSD 2.0
CTM is now a supported way of obtaining OpenBSD source code.
Added sudo (which is maintained by one of our developers)
Working Linux ext2fs.
We have completed security reviews of almost all userland programs and libraries except for the gnu stuff (where, based on preliminary inspection there is poor handling of temp files).
FreeBSD's adduser(8) command. Also an rmuser(8) command.
A 7% reduction in size of static binaries.
Compile time option to compile the source tree almost completely dynamic.
Almost a hundred more security fixes, including /tmp races because of strncpy.
Another kerberos security fix.
deal with the SYN bomb problem (denial of service attack) as well known.
less version 2.90
mopd for networking booting Digital machines
latest GNU groff, incorporated in a clean wrapperized form.
secure multicast tools against possible security problems.
sendmail gecos hole fixed (in a number of ways; other programs in the source tree were also vulnerable).
Nice sample files in /etc
16 partitions working on sparc and i386 (yipee!)
vim is replacing nvi, since nvi does not have a pure BSD license, and vim also works better.
And of course... more security related bugfixes... (ie. dump, restore, mt).
ftp command modified for easily scripted ftp & http downloads.
Complete in-tree development for MIPS/Alpha systems (ie. binutils).
New routed from SGI.
*Hobbit*'s netcat utility. The crackers use it, so should you.
Say goodbye to dump, restore, and mt security holes: They are no longer setuid.
DDB can now access symbol tables from LKM modules
Some serial driver support for /dev/cuaXX devices to support transparent out+dial
FreeBSD pipe() system call; quite a bit faster.
libgnumalloc is gone; our malloc() is better.
Kernel warns if /dev/console does not exist; nice warning for booting with an unpopulated /dev directory.
cdio command for using CD audio.
Even more security fixes.
latest version of perl, and a lndir command.
gcc 2.7.2.1 (to get closer to native alpha support ar gcc bugs).
vim version 4.5
a good start at NETIPX support
improved locate command
Fixed timeout support in RPC library, and also fixed it to support more than FD_SETSIZE file descriptors.
rudimentary support for ISA Plug-and-Play cards
'lsof'-style features in fstat.
Numerous ftpd improvements and fixes, including multihomed and skey support.
ncr53cXXX scsi scripts assembler
arc4-based random support in kernel
Kerberos is much more silent if not configured
scsi subsystem security fix
much newer join command (4.4lite2 with other fixes)
RCS version 5.7
added /etc/fbtab support to login & init.
partial protection against tcp SYN attacks.
POSIX & C2 requirement; lose setuid/setgid bits if owner/group changed by chown(). This can be turned off with sysctl.
a real adduser program, which can even be used uninteractively.
install now supports -C, -p, and -S flags.
20 or so more security fixes
at -f security fix.
generic protection against the bind() takeover problem.
new rdisc Router Discovery daemon
Numerous FreeBSD userland fixes and improvements incorporated.
FreeBSD malloc() that uses mmap() and is able to free unused memory.
Fixed long-standing vm swap-leak.
_POSIX_SAVED_IDS behaviour with permitted BSD extensions.
Newest version of pppd.
zlib (non-GPL'd gzip-compatible library)
Numerous more security policy and implementation improvements (OpenBSD defaults to installing in a very secure mode)
Significantly improved ftp daemon.
Protection from the udp spamming and ftp bounce attacks.
randomized port allocation in bind(), bindresvport(), and rresvport() -- security via unpredictability.
The most secure rdist support anywhere.
Fortran in the tree.
terminfo database support.
Working ATAPI audio support for multiple architectures.
Linux ext2fs and BSD4.4 LFS support being worked on.
Accepts FreeBSD MD5 passwords in password maps, soon will be able to generate them too
Even more security fixes.
using AT&T awk, gawk is toast
pax as tar, gnutar is toast
Boot kernels with "-c" to edit/enable/disable device configuration tables
ATM support (support for one company's sparc & i386 cards available)
kernfs extensions
select() that can handle any amount of file descriptors.
new system calls: rfork(), minherit(), poll().
/sbin/init now deals with non-existent ttys, no longer spins gettys madly.
ncheck utility for ffs
Numerous scsi fixes
Some ddb improvements and extensions
In-kernel update(8) with an adaptive algorithm
/dev/*random -- a device driver providing some kinds of random data
Solid YP master, server, and client capabilities.
Kerberos and other crypto in the source tree that is exportable
Numerous security related fixes
new scsi, md5, pkg_* commands
ATAPI support (should work on all ISA buses)
Some LKM support in the tree.
All the pieces needed for cross compilation are in the source tree.
Verbatim integration of the GNU tools (using a wrapper Makefile)
nlist() that understands ELF, ECOFF, and a.out, allowing non-a.out ports to use kvm utilities
better ELF support
ipfilter for filtering dangerous packets and Network Address Translation for IP masquerading.
The FreeBSD ports subsystem was integrated and is usable by you!
a termlib library which understands termcap.db, needed for new curses.
New curses library, including libform, libpanel and libmenu.
Many many NetBSD PRs fixed (which NetBSD has not yet fixed)
--------




